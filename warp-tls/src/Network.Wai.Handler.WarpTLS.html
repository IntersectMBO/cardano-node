<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE PatternGuards #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- | HTTP over TLS support for Warp via the TLS package.</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">--   If HTTP\/2 is negotiated by ALPN, HTTP\/2 over TLS is used.</span><span>
</span><span id="line-11"></span><span class="hs-comment">--   Otherwise HTTP\/1.1 over TLS is used.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">--   Support for SSL is now obsoleted.</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Wai.Handler.WarpTLS</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Runner</span></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLS"><span class="hs-identifier">runTLS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier">runTLSSocket</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Settings</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier">TLSSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier">defaultTlsSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Smart constructors</span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** From files</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettings"><span class="hs-identifier">tlsSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChain"><span class="hs-identifier">tlsSettingsChain</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** From memory</span></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsMemory"><span class="hs-identifier">tlsSettingsMemory</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainMemory"><span class="hs-identifier">tlsSettingsChainMemory</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** From references</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsRef"><span class="hs-identifier">tlsSettingsRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainRef"><span class="hs-identifier">tlsSettingsChainRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertSettings"><span class="hs-identifier">CertSettings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Dynamically retrieved</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsSni"><span class="hs-identifier">tlsSettingsSni</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Accessors</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-identifier">tlsCredentials</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsLogging"><span class="hs-identifier">tlsLogging</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsAllowedVersions"><span class="hs-identifier">tlsAllowedVersions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCiphers"><span class="hs-identifier">tlsCiphers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsWantClientCert"><span class="hs-identifier">tlsWantClientCert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerHooks"><span class="hs-identifier">tlsServerHooks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerDHEParams"><span class="hs-identifier">tlsServerDHEParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManagerConfig"><span class="hs-identifier">tlsSessionManagerConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManager"><span class="hs-identifier">tlsSessionManager</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#onInsecure"><span class="hs-identifier">onInsecure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#OnInsecure"><span class="hs-identifier">OnInsecure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Exception</span></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#WarpTLSException"><span class="hs-identifier">WarpTLSException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Low-level</span></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#attachConn"><span class="hs-identifier">attachConn</span></a></span><span>
</span><span id="line-59"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.Exception.html#IOException"><span class="hs-identifier">IOException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier">SomeException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#bracket"><span class="hs-identifier">bracket</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#finally"><span class="hs-identifier">finally</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier">fromException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#handle"><span class="hs-identifier">handle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#handleJust"><span class="hs-identifier">handleJust</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#onException"><span class="hs-identifier">onException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#try"><span class="hs-identifier">try</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Monad.html#guard"><span class="hs-identifier">guard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#void"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Streaming.Network</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bindPortTCP</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">safeRecv</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Typeable.html"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.Exception.html"><span class="hs-identifier">GHC.IO.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.Exception.html#IOErrorType"><span class="hs-identifier">IOErrorType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="hs-identifier">SockAddr</span></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="hs-identifier">Socket</span></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="hs-identifier">close</span></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="hs-identifier">getSocketName</span></span><span class="hs-special">,</span><span class="hs-cpp">
#if MIN_VERSION_network(3,1,1)
</span><span>    </span><span class="annot"><span class="hs-identifier">gracefulClose</span></span><span class="hs-special">,</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="hs-identifier">withSocketsDo</span></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.html"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket.BufferPool</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sendAll</span></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.TLS</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TLS</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.TLS.SessionManager</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SM</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Application</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.Wai.Handler.Warp.Internal</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html"><span class="hs-identifier">Network.Wai.Handler.WarpTLS.Internal</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.IO.Error.html"><span class="hs-identifier">System.IO.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.IO.Error.html#ioeGetErrorType"><span class="hs-identifier">ioeGetErrorType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.IO.Error.html#isEOFError"><span class="hs-identifier">isEOFError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.Timeout.html"><span class="hs-identifier">System.Timeout</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.Timeout.html#timeout"><span class="hs-identifier">timeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><span class="hs-comment">-- | A smart constructor for 'TLSSettings' based on 'defaultTlsSettings'.</span></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettings"><span class="hs-identifier hs-type">tlsSettings</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Certificate file</span></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Key file</span></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-113"></span><span id="tlsSettings"><span class="annot"><span class="annottext">tlsSettings :: FilePath -&gt; FilePath -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettings"><span class="hs-identifier hs-var hs-var">tlsSettings</span></a></span></span><span> </span><span id="local-6989586621679090240"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090240"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679090241"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090241"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromFile"><span class="hs-identifier hs-type">CertFromFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090240"><span class="hs-identifier hs-type">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679090241"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings' that allows specifying</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- chain certificates based on 'defaultTlsSettings'.</span><span>
</span><span id="line-120"></span><span class="hs-comment">--</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- Since 3.0.3</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChain"><span class="hs-identifier hs-type">tlsSettingsChain</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Certificate file</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Chain certificate files</span></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Key file</span></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-130"></span><span id="tlsSettingsChain"><span class="annot"><span class="annottext">tlsSettingsChain :: FilePath -&gt; [FilePath] -&gt; FilePath -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChain"><span class="hs-identifier hs-var hs-var">tlsSettingsChain</span></a></span></span><span> </span><span id="local-6989586621679090244"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090244"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679090245"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679090245"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span id="local-6989586621679090246"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090246"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromFile"><span class="hs-identifier hs-type">CertFromFile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090244"><span class="hs-identifier hs-type">cert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090245"><span class="hs-identifier hs-type">chainCerts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090246"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses in-memory representations</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-137"></span><span class="hs-comment">--</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- Since 3.0.1</span><span>
</span><span id="line-139"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsMemory"><span class="hs-identifier hs-type">tlsSettingsMemory</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Certificate bytes</span></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Key bytes</span></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-145"></span><span id="tlsSettingsMemory"><span class="annot"><span class="annottext">tlsSettingsMemory :: ByteString -&gt; ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsMemory"><span class="hs-identifier hs-var hs-var">tlsSettingsMemory</span></a></span></span><span> </span><span id="local-6989586621679090247"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090247"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679090248"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090248"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromMemory"><span class="hs-identifier hs-type">CertFromMemory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090247"><span class="hs-identifier hs-type">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679090248"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses in-memory representations</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-152"></span><span class="hs-comment">--</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- Since 3.0.3</span><span>
</span><span id="line-154"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainMemory"><span class="hs-identifier hs-type">tlsSettingsChainMemory</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Certificate bytes</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Chain certificate bytes</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Key bytes</span></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-162"></span><span id="tlsSettingsChainMemory"><span class="annot"><span class="annottext">tlsSettingsChainMemory :: ByteString -&gt; [ByteString] -&gt; ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainMemory"><span class="hs-identifier hs-var hs-var">tlsSettingsChainMemory</span></a></span></span><span> </span><span id="local-6989586621679090250"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090250"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679090251"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090251"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span id="local-6989586621679090252"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090252"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span>
</span><span id="line-164"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromMemory"><span class="hs-identifier hs-type">CertFromMemory</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090250"><span class="hs-identifier hs-type">cert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090251"><span class="hs-identifier hs-type">chainCerts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090252"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Smart constructor for TLS settings that obtains its credentials during</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- Server Name Indication. Can be used to return different credentials</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- depending on the hostname but also to retrieve dynamically updated</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- credentials from an IORef. Credentials can be loaded from PEM-encoded chain</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- and key files using 'TLS.credentialLoadX509'.</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- @since 3.4.13</span><span>
</span><span id="line-174"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsSni"><span class="hs-identifier hs-type">tlsSettingsSni</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.HostName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.Credentials</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-175"></span><span id="tlsSettingsSni"><span class="annot"><span class="annottext">tlsSettingsSni :: (Maybe FilePath -&gt; IO Credentials) -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsSni"><span class="hs-identifier hs-var hs-var">tlsSettingsSni</span></a></span></span><span> </span><span id="local-6989586621679090255"><span class="annot"><span class="annottext">Maybe FilePath -&gt; IO Credentials
</span><a href="#local-6989586621679090255"><span class="hs-identifier hs-var">onServerNameIndicationHook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-identifier hs-var">tlsCredentials</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TLS.Credentials</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerHooks"><span class="hs-identifier hs-var">tlsServerHooks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsServerHooks"><span class="hs-identifier hs-var">tlsServerHooks</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-type">defaultTlsSettings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.onServerNameIndication</span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><a href="#local-6989586621679090255"><span class="hs-identifier hs-type">onServerNameIndicationHook</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses references to in-memory</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- representations of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-185"></span><span class="hs-comment">--</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- @since 3.3.0</span><span>
</span><span id="line-187"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsRef"><span class="hs-identifier hs-type">tlsSettingsRef</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Reference to certificate bytes</span></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Reference to key bytes</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-193"></span><span id="tlsSettingsRef"><span class="annot"><span class="annottext">tlsSettingsRef :: IORef ByteString -&gt; IORef ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsRef"><span class="hs-identifier hs-var hs-var">tlsSettingsRef</span></a></span></span><span> </span><span id="local-6989586621679090258"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090258"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679090259"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090259"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromRef"><span class="hs-identifier hs-type">CertFromRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090258"><span class="hs-identifier hs-type">cert</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679090259"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">tlsSettingsRef</span><span> </span><span class="hs-pragma">&quot;This function was added to allow Warp to serve new certificates without restarting, but it has always behaved the same as 'tlsSettingsMemory'. It will be removed in the next major release. To retain existing behavior, swich to 'tlsSettingsMemory'. To dynamically update credentials, see 'tlsSettingsSni'.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- | A smart constructor for 'TLSSettings', but uses references to in-memory</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- representations of the certificate and key based on 'defaultTlsSettings'.</span><span>
</span><span id="line-202"></span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- @since 3.3.0</span><span>
</span><span id="line-204"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainRef"><span class="hs-identifier hs-type">tlsSettingsChainRef</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Reference to certificate bytes</span></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Reference to chain certificate bytes</span></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Reference to key bytes</span></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-212"></span><span id="tlsSettingsChainRef"><span class="annot"><span class="annottext">tlsSettingsChainRef :: IORef ByteString
-&gt; [IORef ByteString] -&gt; IORef ByteString -&gt; TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.html#tlsSettingsChainRef"><span class="hs-identifier hs-var hs-var">tlsSettingsChainRef</span></a></span></span><span> </span><span id="local-6989586621679090261"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090261"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679090262"><span class="annot"><span class="annottext">[IORef ByteString]
</span><a href="#local-6989586621679090262"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span id="local-6989586621679090263"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090263"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#defaultTlsSettings"><span class="hs-identifier hs-var">defaultTlsSettings</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#certSettings"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromRef"><span class="hs-identifier hs-type">CertFromRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090261"><span class="hs-identifier hs-type">cert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090262"><span class="hs-identifier hs-type">chainCerts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090263"><span class="hs-identifier hs-type">key</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">tlsSettingsChainRef</span><span> </span><span class="hs-pragma">&quot;This function was added to allow Warp to serve new certificates without restarting, but it has always behaved the same as 'tlsSettingsChainMemory'. It will be removed in the next major release. To retain existing behavior, swich to 'tlsSettingsChainMemory'. To dynamically update credentials, see 'tlsSettingsSni'.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><span class="hs-comment">-- | Running 'Application' with 'TLSSettings' and 'Settings'.</span></span><span>
</span><span id="line-222"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLS"><span class="hs-identifier hs-type">runTLS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span id="runTLS"><span class="annot"><span class="annottext">runTLS :: TLSSettings -&gt; Settings -&gt; Application -&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLS"><span class="hs-identifier hs-var hs-var">runTLS</span></a></span></span><span> </span><span id="local-6989586621679090265"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090265"><span class="hs-identifier hs-var">tset</span></a></span></span><span> </span><span id="local-6989586621679090266"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090266"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679090267"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679090267"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withSocketsDo</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="annottext">IO Socket -&gt; (Socket -&gt; IO ()) -&gt; (Socket -&gt; IO ()) -&gt; IO ()
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#bracket"><span class="hs-identifier hs-var">bracket</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HostPreference -&gt; IO Socket
</span><span class="hs-identifier hs-var">bindPortTCP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; Int
</span><span class="hs-identifier hs-var">getPort</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090266"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Settings -&gt; HostPreference
</span><span class="hs-identifier hs-var">getHost</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090266"><span class="hs-identifier hs-var">set</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>            </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">close</span></span><span>
</span><span id="line-228"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679090270"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090270"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>                </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">setSocketCloseOnExec</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090270"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-230"></span><span>                </span><span class="annot"><span class="annottext">TLSSettings -&gt; Settings -&gt; Socket -&gt; Application -&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier hs-var">runTLSSocket</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090265"><span class="hs-identifier hs-var">tset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090266"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090270"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679090267"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-231"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-type">loadCredentials</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.Credentials</span></span><span>
</span><span id="line-236"></span><span id="loadCredentials"><span class="annot"><span class="annottext">loadCredentials :: TLSSettings -&gt; IO Credentials
</span><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-var hs-var">loadCredentials</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tlsCredentials :: TLSSettings -&gt; Maybe Credentials
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-identifier hs-var">tlsCredentials</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679090273"><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679090273"><span class="hs-identifier hs-var">creds</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679090273"><span class="hs-identifier hs-var">creds</span></a></span><span>
</span><span id="line-237"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-var">loadCredentials</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679090274"><span id="local-6989586621679090275"><span id="local-6989586621679090276"><span id="local-6989586621679090277"><span id="local-6989586621679090278"><span id="local-6989586621679090279"><span id="local-6989586621679090280"><span id="local-6989586621679090281"><span id="local-6989586621679090282"><span id="local-6989586621679090283"><span id="local-6989586621679090284"><span id="local-6989586621679090285"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Credentials
Maybe SessionManager
Maybe Config
Maybe DHParams
Logging
ServerHooks
OnInsecure
CertSettings
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
tlsLogging :: TLSSettings -&gt; Logging
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsServerDHEParams :: TLSSettings -&gt; Maybe DHParams
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
onInsecure :: TLSSettings -&gt; OnInsecure
certSettings :: TLSSettings -&gt; CertSettings
certSettings :: CertSettings
onInsecure :: OnInsecure
tlsLogging :: Logging
tlsAllowedVersions :: [Version]
tlsCiphers :: [Cipher]
tlsWantClientCert :: Bool
tlsServerHooks :: ServerHooks
tlsServerDHEParams :: Maybe DHParams
tlsSessionManagerConfig :: Maybe Config
tlsCredentials :: Maybe Credentials
tlsSessionManager :: Maybe SessionManager
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CertSettings
</span><a href="#local-6989586621679090274"><span class="hs-identifier hs-var">certSettings</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromFile"><span class="hs-identifier hs-type">CertFromFile</span></a></span><span> </span><span id="local-6989586621679090287"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090287"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span id="local-6989586621679090288"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679090288"><span class="hs-identifier hs-var">chainFiles</span></a></span></span><span> </span><span id="local-6989586621679090289"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090289"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>        </span><span id="local-6989586621679090290"><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679090290"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Credential)
-&gt; (Credential -&gt; Credential)
-&gt; Either FilePath Credential
-&gt; Credential
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Credential
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">Credential -&gt; Credential
forall a. a -&gt; a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">(Either FilePath Credential -&gt; Credential)
-&gt; IO (Either FilePath Credential) -&gt; IO Credential
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
-&gt; [FilePath] -&gt; FilePath -&gt; IO (Either FilePath Credential)
</span><span class="hs-identifier hs-var">TLS.credentialLoadX509Chain</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090287"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621679090288"><span class="hs-identifier hs-var">chainFiles</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679090289"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Credentials -&gt; IO Credentials) -&gt; Credentials -&gt; IO Credentials
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential] -&gt; Credentials
</span><span class="hs-identifier hs-var">TLS.Credentials</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679090290"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromRef"><span class="hs-identifier hs-type">CertFromRef</span></a></span><span> </span><span id="local-6989586621679090296"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090296"><span class="hs-identifier hs-var">certRef</span></a></span></span><span> </span><span id="local-6989586621679090297"><span class="annot"><span class="annottext">[IORef ByteString]
</span><a href="#local-6989586621679090297"><span class="hs-identifier hs-var">chainCertsRef</span></a></span></span><span> </span><span id="local-6989586621679090298"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090298"><span class="hs-identifier hs-var">keyRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>        </span><span id="local-6989586621679090299"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090299"><span class="hs-identifier hs-var">cert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090296"><span class="hs-identifier hs-var">certRef</span></a></span><span>
</span><span id="line-243"></span><span>        </span><span id="local-6989586621679090301"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090301"><span class="hs-identifier hs-var">chainCerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(IORef ByteString -&gt; IO ByteString)
-&gt; [IORef ByteString] -&gt; IO [ByteString]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">[IORef ByteString]
</span><a href="#local-6989586621679090297"><span class="hs-identifier hs-var">chainCertsRef</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span id="local-6989586621679090303"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090303"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090298"><span class="hs-identifier hs-var">keyRef</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span id="local-6989586621679090304"><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679090304"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-246"></span><span>            </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Credential)
-&gt; (Credential -&gt; IO Credential)
-&gt; Either FilePath Credential
-&gt; IO Credential
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Credential
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">Credential -&gt; IO Credential
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either FilePath Credential -&gt; IO Credential)
-&gt; Either FilePath Credential -&gt; IO Credential
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
-&gt; [ByteString] -&gt; ByteString -&gt; Either FilePath Credential
</span><span class="hs-identifier hs-var">TLS.credentialLoadX509ChainFromMemory</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090299"><span class="hs-identifier hs-var">cert</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090301"><span class="hs-identifier hs-var">chainCerts</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090303"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Credentials -&gt; IO Credentials) -&gt; Credentials -&gt; IO Credentials
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential] -&gt; Credentials
</span><span class="hs-identifier hs-var">TLS.Credentials</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679090304"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#CertFromMemory"><span class="hs-identifier hs-type">CertFromMemory</span></a></span><span> </span><span id="local-6989586621679090306"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090306"><span class="hs-identifier hs-var">certMemory</span></a></span></span><span> </span><span id="local-6989586621679090307"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090307"><span class="hs-identifier hs-var">chainCertsMemory</span></a></span></span><span> </span><span id="local-6989586621679090308"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090308"><span class="hs-identifier hs-var">keyMemory</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>        </span><span id="local-6989586621679090309"><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679090309"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-250"></span><span>            </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Credential)
-&gt; (Credential -&gt; IO Credential)
-&gt; Either FilePath Credential
-&gt; IO Credential
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Credential
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">Credential -&gt; IO Credential
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either FilePath Credential -&gt; IO Credential)
-&gt; Either FilePath Credential -&gt; IO Credential
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-251"></span><span>                </span><span class="annot"><span class="annottext">ByteString
-&gt; [ByteString] -&gt; ByteString -&gt; Either FilePath Credential
</span><span class="hs-identifier hs-var">TLS.credentialLoadX509ChainFromMemory</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090306"><span class="hs-identifier hs-var">certMemory</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090307"><span class="hs-identifier hs-var">chainCertsMemory</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090308"><span class="hs-identifier hs-var">keyMemory</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="annottext">Credentials -&gt; IO Credentials
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Credentials -&gt; IO Credentials) -&gt; Credentials -&gt; IO Credentials
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential] -&gt; Credentials
</span><span class="hs-identifier hs-var">TLS.Credentials</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Credential
</span><a href="#local-6989586621679090309"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-type">getSessionManager</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.SessionManager</span></span><span>
</span><span id="line-255"></span><span id="getSessionManager"><span class="annot"><span class="annottext">getSessionManager :: TLSSettings -&gt; IO SessionManager
</span><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-var hs-var">getSessionManager</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsSessionManager"><span class="hs-identifier hs-var">tlsSessionManager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679090311"><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679090311"><span class="hs-identifier hs-var">mgr</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SessionManager -&gt; IO SessionManager
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679090311"><span class="hs-identifier hs-var">mgr</span></a></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-var">getSessionManager</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679090312"><span id="local-6989586621679090313"><span id="local-6989586621679090314"><span id="local-6989586621679090315"><span id="local-6989586621679090316"><span id="local-6989586621679090317"><span id="local-6989586621679090318"><span id="local-6989586621679090319"><span id="local-6989586621679090320"><span id="local-6989586621679090321"><span id="local-6989586621679090322"><span id="local-6989586621679090323"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Credentials
Maybe SessionManager
Maybe Config
Maybe DHParams
Logging
ServerHooks
OnInsecure
CertSettings
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
tlsLogging :: TLSSettings -&gt; Logging
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsServerDHEParams :: TLSSettings -&gt; Maybe DHParams
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
onInsecure :: TLSSettings -&gt; OnInsecure
certSettings :: TLSSettings -&gt; CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: CertSettings
onInsecure :: OnInsecure
tlsLogging :: Logging
tlsAllowedVersions :: [Version]
tlsCiphers :: [Cipher]
tlsWantClientCert :: Bool
tlsServerHooks :: ServerHooks
tlsServerDHEParams :: Maybe DHParams
tlsSessionManagerConfig :: Maybe Config
tlsCredentials :: Maybe Credentials
tlsSessionManager :: Maybe SessionManager
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Config
</span><a href="#local-6989586621679090320"><span class="hs-identifier hs-var">tlsSessionManagerConfig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">Maybe Config
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SessionManager -&gt; IO SessionManager
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SessionManager
</span><span class="hs-identifier hs-var">TLS.noSessionManager</span></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679090325"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679090325"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Config -&gt; IO SessionManager
</span><span class="hs-identifier hs-var">SM.newSessionManager</span></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679090325"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-comment">-- | Running 'Application' with 'TLSSettings' and 'Settings' using</span><span>
</span><span id="line-261"></span><span class="hs-comment">--   specified 'Socket'.</span><span>
</span><span id="line-262"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier hs-type">runTLSSocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span id="runTLSSocket"><span class="annot"><span class="annottext">runTLSSocket :: TLSSettings -&gt; Settings -&gt; Socket -&gt; Application -&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket"><span class="hs-identifier hs-var hs-var">runTLSSocket</span></a></span></span><span> </span><span id="local-6989586621679090327"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090327"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span> </span><span id="local-6989586621679090328"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090328"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679090329"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090329"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span id="local-6989586621679090330"><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679090330"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">Settings -&gt; IO () -&gt; IO ()
</span><span class="hs-identifier hs-var">settingsInstallShutdownHandler</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090328"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090329"><span class="hs-identifier hs-var">sock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679090332"><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679090332"><span class="hs-identifier hs-var">credentials</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; IO Credentials
</span><a href="Network.Wai.Handler.WarpTLS.html#loadCredentials"><span class="hs-identifier hs-var">loadCredentials</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090327"><span class="hs-identifier hs-var">tlsset</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621679090333"><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679090333"><span class="hs-identifier hs-var">mgr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TLSSettings -&gt; IO SessionManager
</span><a href="Network.Wai.Handler.WarpTLS.html#getSessionManager"><span class="hs-identifier hs-var">getSessionManager</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090327"><span class="hs-identifier hs-var">tlsset</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings
-&gt; Credentials
-&gt; SessionManager
-&gt; Socket
-&gt; Application
-&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket%27"><span class="hs-identifier hs-var">runTLSSocket'</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090327"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090328"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679090332"><span class="hs-identifier hs-var">credentials</span></a></span><span> </span><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679090333"><span class="hs-identifier hs-var">mgr</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090329"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">Application
</span><a href="#local-6989586621679090330"><span class="hs-identifier hs-var">app</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket%27"><span class="hs-identifier hs-type">runTLSSocket'</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.Credentials</span></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.SessionManager</span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Application</span></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span id="runTLSSocket%27"><span class="annot"><span class="annottext">runTLSSocket' :: TLSSettings
-&gt; Settings
-&gt; Credentials
-&gt; SessionManager
-&gt; Socket
-&gt; Application
-&gt; IO ()
</span><a href="Network.Wai.Handler.WarpTLS.html#runTLSSocket%27"><span class="hs-identifier hs-var hs-var">runTLSSocket'</span></a></span></span><span> </span><span id="local-6989586621679090335"><span class="annot"><span class="annottext">tlsset :: TLSSettings
</span><a href="#local-6989586621679090335"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679090336"><span id="local-6989586621679090337"><span id="local-6989586621679090338"><span id="local-6989586621679090339"><span id="local-6989586621679090340"><span id="local-6989586621679090341"><span id="local-6989586621679090342"><span id="local-6989586621679090343"><span id="local-6989586621679090344"><span id="local-6989586621679090345"><span id="local-6989586621679090346"><span id="local-6989586621679090347"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Credentials
Maybe SessionManager
Maybe Config
Maybe DHParams
Logging
ServerHooks
OnInsecure
CertSettings
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
tlsLogging :: TLSSettings -&gt; Logging
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsServerDHEParams :: TLSSettings -&gt; Maybe DHParams
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
onInsecure :: TLSSettings -&gt; OnInsecure
certSettings :: TLSSettings -&gt; CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: CertSettings
onInsecure :: OnInsecure
tlsLogging :: Logging
tlsAllowedVersions :: [Version]
tlsCiphers :: [Cipher]
tlsWantClientCert :: Bool
tlsServerHooks :: ServerHooks
tlsServerDHEParams :: Maybe DHParams
tlsSessionManagerConfig :: Maybe Config
tlsCredentials :: Maybe Credentials
tlsSessionManager :: Maybe SessionManager
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679090348"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090348"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679090349"><span class="annot"><span class="annottext">Credentials
</span><a href="#local-6989586621679090349"><span class="hs-identifier hs-var">credentials</span></a></span></span><span> </span><span id="local-6989586621679090350"><span class="annot"><span class="annottext">SessionManager
</span><a href="#local-6989586621679090350"><span class="hs-identifier hs-var">mgr</span></a></span></span><span> </span><span id="local-6989586621679090351"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090351"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><span class="annottext">Settings
-&gt; IO (IO (Connection, Transport), SockAddr)
-&gt; Application
-&gt; IO ()
</span><span class="hs-identifier hs-var">runSettingsConnectionMakerSecure</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090348"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">IO (IO (Connection, Transport), SockAddr)
</span><a href="#local-6989586621679090353"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679090353"><span class="annot"><span class="annottext">get :: IO (IO (Connection, Transport), SockAddr)
</span><a href="#local-6989586621679090353"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ServerParams
-&gt; IO (IO (Connection, Transport), SockAddr)
forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; params
-&gt; IO (IO (Connection, Transport), SockAddr)
</span><a href="Network.Wai.Handler.WarpTLS.html#getter"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090335"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090348"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090351"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">ServerParams
</span><a href="#local-6989586621679090357"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621679090357"><span class="annot"><span class="annottext">params :: ServerParams
</span><a href="#local-6989586621679090357"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">ServerParams
</span><span class="hs-identifier hs-var">TLS.defaultParamsServer</span></span><span>
</span><span id="line-283"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.serverWantClientCert</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090341"><span class="hs-identifier hs-type">tlsWantClientCert</span></a></span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.serverCACertificates</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.serverDHEParams</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090343"><span class="hs-identifier hs-type">tlsServerDHEParams</span></a></span><span>
</span><span id="line-286"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.serverHooks</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090363"><span class="hs-identifier hs-type">hooks</span></a></span><span>
</span><span id="line-287"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.serverShared</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090365"><span class="hs-identifier hs-type">shared</span></a></span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.serverSupported</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090367"><span class="hs-identifier hs-type">supported</span></a></span><span class="hs-cpp">
#if MIN_VERSION_tls(1,5,0)
</span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.serverEarlyDataSize</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">2018</span></span><span class="hs-cpp">
#endif
</span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- Adding alpn to user's tlsServerHooks.</span><span>
</span><span id="line-294"></span><span>    </span><span id="local-6989586621679090363"><span class="annot"><span class="annottext">hooks :: ServerHooks
</span><a href="#local-6989586621679090363"><span class="hs-identifier hs-var hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-295"></span><span>        </span><span class="annot"><span class="annottext">ServerHooks
</span><a href="#local-6989586621679090342"><span class="hs-identifier hs-var">tlsServerHooks</span></a></span><span>
</span><span id="line-296"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.onALPNClientSuggest</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>                </span><span class="annot"><span class="hs-identifier hs-var">TLS.onALPNClientSuggest</span></span><span> </span><span class="annot"><a href="#local-6989586621679090342"><span class="hs-identifier hs-type">tlsServerHooks</span></a></span><span>
</span><span id="line-298"></span><span>                    </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-type">&lt;|&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-var">settingsHTTP2Enabled</span></span><span> </span><span class="annot"><a href="#local-6989586621679090348"><span class="hs-identifier hs-type">set</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#alpn"><span class="hs-identifier hs-type">alpn</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-type">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621679090365"><span class="annot"><span class="annottext">shared :: Shared
</span><a href="#local-6989586621679090365"><span class="hs-identifier hs-var hs-var">shared</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">Shared
</span><span class="hs-identifier hs-var">TLS.defaultShared</span></span><span>
</span><span id="line-302"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.sharedCredentials</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090349"><span class="hs-identifier hs-type">credentials</span></a></span><span>
</span><span id="line-303"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.sharedSessionManager</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090350"><span class="hs-identifier hs-type">mgr</span></a></span><span>
</span><span id="line-304"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621679090367"><span class="annot"><span class="annottext">supported :: Supported
</span><a href="#local-6989586621679090367"><span class="hs-identifier hs-var hs-var">supported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><span class="annottext">Supported
</span><span class="hs-identifier hs-var">TLS.defaultSupported</span></span><span>
</span><span id="line-307"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedVersions</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090339"><span class="hs-identifier hs-type">tlsAllowedVersions</span></a></span><span>
</span><span id="line-308"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedCiphers</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090340"><span class="hs-identifier hs-type">tlsCiphers</span></a></span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedCompressions</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TLS.nullCompression</span></span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedSecureRenegotiation</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-type">True</span></a></span><span>
</span><span id="line-311"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedClientInitiatedRenegotiation</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-type">False</span></a></span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedSession</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-type">True</span></a></span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedFallbackScsv</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-type">True</span></a></span><span>
</span><span id="line-314"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedHashSignatures</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679090347"><span class="hs-identifier hs-type">tlsSupportedHashSignatures</span></a></span><span class="hs-cpp">
#if MIN_VERSION_tls(1,5,0)
</span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">TLS.supportedGroups</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TLS.X25519</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">TLS.P256</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">TLS.P384</span></span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#alpn"><span class="hs-identifier hs-type">alpn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-321"></span><span id="alpn"><span class="annot"><span class="annottext">alpn :: [ByteString] -&gt; IO ByteString
</span><a href="Network.Wai.Handler.WarpTLS.html#alpn"><span class="hs-identifier hs-var hs-var">alpn</span></a></span></span><span> </span><span id="local-6989586621679090391"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090391"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;h2&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090391"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;h2&quot;</span></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;http/1.1&quot;</span></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span id="local-6989586621679090037"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getter"><span class="hs-identifier hs-type">getter</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.TLSParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679090037"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679090037"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transport</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-334"></span><span id="getter"><span class="annot"><span class="annottext">getter :: forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; params
-&gt; IO (IO (Connection, Transport), SockAddr)
</span><a href="Network.Wai.Handler.WarpTLS.html#getter"><span class="hs-identifier hs-var hs-var">getter</span></a></span></span><span> </span><span id="local-6989586621679090398"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090398"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span> </span><span id="local-6989586621679090399"><span class="annot"><span class="annottext">set :: Settings
</span><a href="#local-6989586621679090399"><span class="hs-identifier hs-var">set</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">settingsAccept :: Settings -&gt; Socket -&gt; IO (Socket, SockAddr)
</span><span class="hs-identifier hs-var">settingsAccept</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679090401"><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="#local-6989586621679090401"><span class="hs-identifier hs-var">accept'</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679090402"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090402"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span id="local-6989586621679090403"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679090403"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679090404"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090404"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679090405"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679090405"><span class="hs-identifier hs-var">sa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO (Socket, SockAddr)
</span><a href="#local-6989586621679090401"><span class="hs-identifier hs-var">accept'</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090402"><span class="hs-identifier hs-var">sock</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">setSocketCloseOnExec</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090404"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><span class="annottext">(IO (Connection, Transport), SockAddr)
-&gt; IO (IO (Connection, Transport), SockAddr)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings -&gt; Socket -&gt; params -&gt; IO (Connection, Transport)
forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings -&gt; Socket -&gt; params -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#mkConn"><span class="hs-identifier hs-var">mkConn</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090398"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090399"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090404"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679090403"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679090405"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span id="local-6989586621679090049"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#mkConn"><span class="hs-identifier hs-type">mkConn</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.TLSParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679090049"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679090049"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transport</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-346"></span><span id="mkConn"><span class="annot"><span class="annottext">mkConn :: forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings -&gt; Socket -&gt; params -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#mkConn"><span class="hs-identifier hs-var hs-var">mkConn</span></a></span></span><span> </span><span id="local-6989586621679090411"><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090411"><span class="hs-identifier hs-var">tlsset</span></a></span></span><span> </span><span id="local-6989586621679090412"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090412"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679090413"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090413"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679090414"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679090414"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679090418"><span class="annot"><span class="annottext">tm :: Int
</span><a href="#local-6989586621679090418"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Int
</span><span class="hs-identifier hs-var">settingsTimeout</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090412"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000000</span></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621679090421"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679090421"><span class="hs-identifier hs-var">mbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString -&gt; IO (Maybe ByteString)
forall a. Int -&gt; IO a -&gt; IO (Maybe a)
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.Timeout.html#timeout"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679090418"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679090422"><span class="hs-identifier hs-var">recvFirstBS</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679090421"><span class="hs-identifier hs-var">mbs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; IO (Connection, Transport)
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><span class="hs-identifier hs-var">IncompleteHeaders</span></span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679090424"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090424"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO (Connection, Transport)
</span><a href="#local-6989586621679090425"><span class="hs-identifier hs-var">switch</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090424"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621679090422"><span class="annot"><span class="annottext">recvFirstBS :: IO ByteString
</span><a href="#local-6989586621679090422"><span class="hs-identifier hs-var hs-var">recvFirstBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; Int -&gt; IO ByteString
</span><span class="hs-identifier hs-var">safeRecv</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090413"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4096</span></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; IO () -&gt; IO ByteString
forall a b. IO a -&gt; IO b -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#onException"><span class="hs-operator hs-var">`onException`</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090413"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621679090425"><span class="annot"><span class="annottext">switch :: ByteString -&gt; IO (Connection, Transport)
</span><a href="#local-6989586621679090425"><span class="hs-identifier hs-var hs-var">switch</span></a></span></span><span> </span><span id="local-6989586621679090435"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090435"><span class="hs-identifier hs-var">firstBS</span></a></span></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.html#null"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090435"><span class="hs-identifier hs-var">firstBS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090413"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO (Connection, Transport) -&gt; IO (Connection, Transport)
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WarpTLSException -&gt; IO (Connection, Transport)
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">WarpTLSException
</span><a href="Network.Wai.Handler.WarpTLS.html#ClientClosedConnectionPrematurely"><span class="hs-identifier hs-var">ClientClosedConnectionPrematurely</span></a></span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; ByteString -&gt; Word8
ByteString -&gt; Word8
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.html#head"><span class="hs-identifier hs-var">S.head</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090435"><span class="hs-identifier hs-var">firstBS</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0x16</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ByteString
-&gt; params
-&gt; IO (Connection, Transport)
forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ByteString
-&gt; params
-&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#httpOverTls"><span class="hs-identifier hs-var">httpOverTls</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090411"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090412"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090413"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090435"><span class="hs-identifier hs-var">firstBS</span></a></span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679090414"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TLSSettings
-&gt; Settings -&gt; Socket -&gt; ByteString -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#plainHTTP"><span class="hs-identifier hs-var">plainHTTP</span></a></span><span> </span><span class="annot"><span class="annottext">TLSSettings
</span><a href="#local-6989586621679090411"><span class="hs-identifier hs-var">tlsset</span></a></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090412"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090413"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090435"><span class="hs-identifier hs-var">firstBS</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span id="local-6989586621679090062"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#isAsyncException"><span class="hs-identifier hs-type">isAsyncException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090062"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679090062"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-362"></span><span id="isAsyncException"><span class="annot"><span class="annottext">isAsyncException :: forall e. Exception e =&gt; e -&gt; Bool
</span><a href="Network.Wai.Handler.WarpTLS.html#isAsyncException"><span class="hs-identifier hs-var hs-var">isAsyncException</span></a></span></span><span> </span><span id="local-6989586621679090446"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679090446"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe SomeAsyncException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">E.fromException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">e -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#toException"><span class="hs-identifier hs-var">E.toException</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679090446"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.Exception.html#SomeAsyncException"><span class="hs-identifier hs-type">E.SomeAsyncException</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><span class="annottext">Maybe SomeAsyncException
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span id="local-6989586621679090068"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#throughAsync"><span class="hs-identifier hs-type">throughAsync</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090068"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090068"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-368"></span><span id="throughAsync"><span class="annot"><span class="annottext">throughAsync :: forall a. IO a -&gt; SomeException -&gt; IO a
</span><a href="Network.Wai.Handler.WarpTLS.html#throughAsync"><span class="hs-identifier hs-var hs-var">throughAsync</span></a></span></span><span> </span><span id="local-6989586621679090451"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679090451"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#SomeException"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span id="local-6989586621679090456"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679090456"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">e -&gt; Bool
forall e. Exception e =&gt; e -&gt; Bool
</span><a href="Network.Wai.Handler.WarpTLS.html#isAsyncException"><span class="hs-identifier hs-var">isAsyncException</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679090456"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">E.throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679090456"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621679090451"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span id="local-6989586621679090061"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#httpOverTls"><span class="hs-identifier hs-type">httpOverTls</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.TLSParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679090061"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679090061"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transport</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-380"></span><span id="httpOverTls"><span class="annot"><span class="annottext">httpOverTls :: forall params.
TLSParams params =&gt;
TLSSettings
-&gt; Settings
-&gt; Socket
-&gt; ByteString
-&gt; params
-&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#httpOverTls"><span class="hs-identifier hs-var hs-var">httpOverTls</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679090458"><span id="local-6989586621679090459"><span id="local-6989586621679090460"><span id="local-6989586621679090461"><span id="local-6989586621679090462"><span id="local-6989586621679090463"><span id="local-6989586621679090464"><span id="local-6989586621679090465"><span id="local-6989586621679090466"><span id="local-6989586621679090467"><span id="local-6989586621679090468"><span id="local-6989586621679090469"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Credentials
Maybe SessionManager
Maybe Config
Maybe DHParams
Logging
ServerHooks
OnInsecure
CertSettings
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
tlsLogging :: TLSSettings -&gt; Logging
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsServerDHEParams :: TLSSettings -&gt; Maybe DHParams
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
onInsecure :: TLSSettings -&gt; OnInsecure
certSettings :: TLSSettings -&gt; CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: CertSettings
onInsecure :: OnInsecure
tlsLogging :: Logging
tlsAllowedVersions :: [Version]
tlsCiphers :: [Cipher]
tlsWantClientCert :: Bool
tlsServerHooks :: ServerHooks
tlsServerDHEParams :: Maybe DHParams
tlsSessionManagerConfig :: Maybe Config
tlsCredentials :: Maybe Credentials
tlsSessionManager :: Maybe SessionManager
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679090470"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090470"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679090471"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090471"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679090472"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090472"><span class="hs-identifier hs-var">bs0</span></a></span></span><span> </span><span id="local-6989586621679090473"><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679090473"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><span class="annottext">IO (Connection, Transport)
</span><a href="#local-6989586621679090474"><span class="hs-identifier hs-var">makeConn</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Connection, Transport) -&gt; IO () -&gt; IO (Connection, Transport)
forall a b. IO a -&gt; IO b -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#onException"><span class="hs-operator hs-var">`onException`</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090471"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621679090474"><span class="annot"><span class="annottext">makeConn :: IO (Connection, Transport)
</span><a href="#local-6989586621679090474"><span class="hs-identifier hs-var hs-var">makeConn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>        </span><span id="local-6989586621679090489"><span class="annot"><span class="annottext">BufferPool
</span><a href="#local-6989586621679090489"><span class="hs-identifier hs-var">pool</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO BufferPool
</span><span class="hs-identifier hs-var">newBufferPool</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2048</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16384</span></span><span>
</span><span id="line-385"></span><span>        </span><span id="local-6989586621679090491"><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679090491"><span class="hs-identifier hs-var">rawRecvN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString -&gt; IO (Int -&gt; IO ByteString)
</span><span class="hs-identifier hs-var">makeRecvN</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090472"><span class="hs-identifier hs-var">bs0</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; IO (Int -&gt; IO ByteString))
-&gt; IO ByteString -&gt; IO (Int -&gt; IO ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; BufferPool -&gt; IO ByteString
</span><span class="hs-identifier hs-var">receive</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090471"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">BufferPool
</span><a href="#local-6989586621679090489"><span class="hs-identifier hs-var">pool</span></a></span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679090495"><span class="annot"><span class="annottext">recvN :: Int -&gt; IO ByteString
</span><a href="#local-6989586621679090495"><span class="hs-identifier hs-var hs-var">recvN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ByteString) -&gt; Int -&gt; IO ByteString
forall {a} {t}. IsString a =&gt; (t -&gt; IO a) -&gt; t -&gt; IO a
</span><a href="#local-6989586621679090496"><span class="hs-identifier hs-var">wrappedRecvN</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679090491"><span class="hs-identifier hs-var">rawRecvN</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span id="local-6989586621679090497"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090497"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; params -&gt; IO Context
forall (m :: * -&gt; *) backend params.
(MonadIO m, HasBackend backend, TLSParams params) =&gt;
backend -&gt; params -&gt; m Context
</span><span class="hs-identifier hs-var">TLS.contextNew</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; IO ByteString) -&gt; Backend
</span><a href="#local-6989586621679090499"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679090495"><span class="hs-identifier hs-var">recvN</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">params
</span><a href="#local-6989586621679090473"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-388"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; Logging -&gt; IO ()
</span><span class="hs-identifier hs-var">TLS.contextHookSetLogging</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090497"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Logging
</span><a href="#local-6989586621679090460"><span class="hs-identifier hs-var">tlsLogging</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679090503"><span class="annot"><span class="annottext">tm :: Int
</span><a href="#local-6989586621679090503"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Int
</span><span class="hs-identifier hs-var">settingsTimeout</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090470"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000000</span></span><span>
</span><span id="line-390"></span><span>        </span><span id="local-6989586621679090504"><span class="annot"><span class="annottext">Maybe (Connection, Transport)
</span><a href="#local-6989586621679090504"><span class="hs-identifier hs-var">mconn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IO (Connection, Transport) -&gt; IO (Maybe (Connection, Transport))
forall a. Int -&gt; IO a -&gt; IO (Maybe a)
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.Timeout.html#timeout"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679090503"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Connection, Transport) -&gt; IO (Maybe (Connection, Transport)))
-&gt; IO (Connection, Transport) -&gt; IO (Maybe (Connection, Transport))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>            </span><span class="annot"><span class="annottext">Context -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><span class="hs-identifier hs-var">TLS.handshake</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090497"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-392"></span><span>            </span><span id="local-6989586621679090506"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679090506"><span class="hs-identifier hs-var">mysa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; IO SockAddr
</span><span class="hs-identifier hs-var">getSocketName</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090471"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-393"></span><span>            </span><span class="annot"><span class="annottext">SockAddr -&gt; Context -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#attachConn"><span class="hs-identifier hs-var">attachConn</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679090506"><span class="hs-identifier hs-var">mysa</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090497"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Connection, Transport)
</span><a href="#local-6989586621679090504"><span class="hs-identifier hs-var">mconn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-395"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Connection, Transport)
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; IO (Connection, Transport)
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><span class="hs-identifier hs-var">IncompleteHeaders</span></span><span>
</span><span id="line-396"></span><span>          </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679090507"><span class="annot"><span class="annottext">(Connection, Transport)
</span><a href="#local-6989586621679090507"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Connection, Transport) -&gt; IO (Connection, Transport)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Connection, Transport)
</span><a href="#local-6989586621679090507"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679090496"><span class="annot"><span class="annottext">wrappedRecvN :: (t -&gt; IO a) -&gt; t -&gt; IO a
</span><a href="#local-6989586621679090496"><span class="hs-identifier hs-var hs-var">wrappedRecvN</span></a></span></span><span> </span><span id="local-6989586621679090513"><span class="annot"><span class="annottext">t -&gt; IO a
</span><a href="#local-6989586621679090513"><span class="hs-identifier hs-var">recvN</span></a></span></span><span> </span><span id="local-6989586621679090514"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679090514"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; IO a) -&gt; IO a -&gt; IO a
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO a -&gt; SomeException -&gt; IO a
forall a. IO a -&gt; SomeException -&gt; IO a
</span><a href="Network.Wai.Handler.WarpTLS.html#throughAsync"><span class="hs-identifier hs-var">throughAsync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; IO a
</span><a href="#local-6989586621679090513"><span class="hs-identifier hs-var">recvN</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679090514"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621679090499"><span class="annot"><span class="annottext">backend :: (Int -&gt; IO ByteString) -&gt; Backend
</span><a href="#local-6989586621679090499"><span class="hs-identifier hs-var hs-var">backend</span></a></span></span><span> </span><span id="local-6989586621679090518"><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679090518"><span class="hs-identifier hs-var">recvN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-399"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">TLS.Backend</span></span><span>
</span><span id="line-400"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">backendFlush :: IO ()
</span><span class="hs-identifier hs-var">TLS.backendFlush</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_network(3,1,1)
</span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendClose :: IO ()
</span><span class="hs-identifier hs-var">TLS.backendClose</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-403"></span><span>                </span><span class="annot"><span class="annottext">Socket -&gt; Int -&gt; IO ()
</span><span class="hs-identifier hs-var">gracefulClose</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090471"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5000</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#catch"><span class="hs-operator hs-var">`E.catch`</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; SomeException -&gt; IO ()
forall a. IO a -&gt; SomeException -&gt; IO a
</span><a href="Network.Wai.Handler.WarpTLS.html#throughAsync"><span class="hs-identifier hs-var">throughAsync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">TLS.backendClose</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">close</span><span> </span><span class="hs-identifier">s</span><span class="hs-cpp">
#endif
</span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendSend :: ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">TLS.backendSend</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><a href="#local-6989586621679090524"><span class="hs-identifier hs-var">sendAll'</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090471"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-408"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">backendRecv :: Int -&gt; IO ByteString
</span><span class="hs-identifier hs-var">TLS.backendRecv</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ByteString
</span><a href="#local-6989586621679090518"><span class="hs-identifier hs-var">recvN</span></a></span><span>
</span><span id="line-409"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621679090524"><span class="annot"><span class="annottext">sendAll' :: Socket -&gt; ByteString -&gt; IO ()
</span><a href="#local-6989586621679090524"><span class="hs-identifier hs-var hs-var">sendAll'</span></a></span></span><span> </span><span id="local-6989586621679090531"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090531"><span class="hs-identifier hs-var">sock</span></a></span></span><span> </span><span id="local-6989586621679090532"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090532"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><span class="annottext">(IOError -&gt; Maybe InvalidRequest)
-&gt; (InvalidRequest -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e b a.
Exception e =&gt;
(e -&gt; Maybe b) -&gt; (b -&gt; IO a) -&gt; IO a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#handleJust"><span class="hs-identifier hs-var">E.handleJust</span></a></span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679090533"><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679090533"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IOError -&gt; IOErrorType
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.IO.Error.html#ioeGetErrorType"><span class="hs-identifier hs-var">ioeGetErrorType</span></a></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679090533"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">IOErrorType -&gt; IOErrorType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">IOErrorType
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.Exception.html#ResourceVanished"><span class="hs-identifier hs-var">ResourceVanished</span></a></span><span>
</span><span id="line-414"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; Maybe InvalidRequest
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><span class="hs-identifier hs-var">ConnectionClosedByPeer</span></span><span>
</span><span id="line-415"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe InvalidRequest
forall a. Maybe a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-416"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><span class="annottext">InvalidRequest -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span>
</span><span id="line-418"></span><span>            </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">sendAll</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090531"><span class="hs-identifier hs-var">sock</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090532"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-comment">-- | Get &quot;Connection&quot; and &quot;Transport&quot; for a TLS connection that is already did the handshake.</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- @since 3.4.7</span><span>
</span><span id="line-422"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#attachConn"><span class="hs-identifier hs-type">attachConn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SockAddr</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.Context</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transport</span></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span id="attachConn"><span class="annot"><span class="annottext">attachConn :: SockAddr -&gt; Context -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#attachConn"><span class="hs-identifier hs-var hs-var">attachConn</span></a></span></span><span> </span><span id="local-6989586621679090536"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679090536"><span class="hs-identifier hs-var">mysa</span></a></span></span><span> </span><span id="local-6989586621679090537"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>    </span><span id="local-6989586621679090538"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679090538"><span class="hs-identifier hs-var">h2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Maybe ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;h2&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ByteString -&gt; Bool) -&gt; IO (Maybe ByteString) -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe ByteString)
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m (Maybe ByteString)
</span><span class="hs-identifier hs-var">TLS.getNegotiatedProtocol</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621679090540"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679090540"><span class="hs-identifier hs-var">isH2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (IORef Bool)
forall a. a -&gt; IO (IORef a)
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">I.newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679090538"><span class="hs-identifier hs-var">h2</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621679090542"><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679090542"><span class="hs-identifier hs-var">writeBuffer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO WriteBuffer
</span><span class="hs-identifier hs-var">createWriteBuffer</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">16384</span></span><span>
</span><span id="line-427"></span><span>    </span><span id="local-6989586621679090544"><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679090544"><span class="hs-identifier hs-var">writeBufferRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WriteBuffer -&gt; IO (IORef WriteBuffer)
forall a. a -&gt; IO (IORef a)
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">I.newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679090542"><span class="hs-identifier hs-var">writeBuffer</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-comment">-- Creating a cache for leftover input data.</span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621679090545"><span class="annot"><span class="annottext">Transport
</span><a href="#local-6989586621679090545"><span class="hs-identifier hs-var">tls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO Transport
</span><a href="Network.Wai.Handler.WarpTLS.html#getTLSinfo"><span class="hs-identifier hs-var">getTLSinfo</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><span class="annottext">(Connection, Transport) -&gt; IO (Connection, Transport)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef WriteBuffer -&gt; IORef Bool -&gt; Connection
</span><a href="#local-6989586621679090547"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679090544"><span class="hs-identifier hs-var">writeBufferRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679090540"><span class="hs-identifier hs-var">isH2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Transport
</span><a href="#local-6989586621679090545"><span class="hs-identifier hs-var">tls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621679090547"><span class="annot"><span class="annottext">conn :: IORef WriteBuffer -&gt; IORef Bool -&gt; Connection
</span><a href="#local-6989586621679090547"><span class="hs-identifier hs-var hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679090550"><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679090550"><span class="hs-identifier hs-var">writeBufferRef</span></a></span></span><span> </span><span id="local-6989586621679090551"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679090551"><span class="hs-identifier hs-var">isH2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span>
</span><span id="line-434"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">connSendMany :: [ByteString] -&gt; IO ()
</span><span class="hs-identifier hs-var">connSendMany</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ByteString -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ByteString -&gt; m ()
</span><span class="hs-identifier hs-var">TLS.sendData</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ())
-&gt; ([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Lazy.html#fromChunks"><span class="hs-identifier hs-var">L.fromChunks</span></a></span><span>
</span><span id="line-435"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connSendAll :: ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">connSendAll</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679090558"><span class="hs-identifier hs-var">sendall</span></a></span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connSendFile :: SendFile
</span><span class="hs-identifier hs-var">connSendFile</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SendFile
</span><a href="#local-6989586621679090560"><span class="hs-identifier hs-var">sendfile</span></a></span><span>
</span><span id="line-437"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connClose :: IO ()
</span><span class="hs-identifier hs-var">connClose</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679090562"><span class="hs-identifier hs-var">close'</span></a></span><span>
</span><span id="line-438"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRecv :: IO ByteString
</span><span class="hs-identifier hs-var">connRecv</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679090564"><span class="hs-identifier hs-var">recv</span></a></span><span>
</span><span id="line-439"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connRecvBuf :: RecvBuf
</span><span class="hs-identifier hs-var">connRecvBuf</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Buffer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-comment">-- obsoleted</span><span>
</span><span id="line-440"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connWriteBuffer :: IORef WriteBuffer
</span><span class="hs-identifier hs-var">connWriteBuffer</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679090550"><span class="hs-identifier hs-var">writeBufferRef</span></a></span><span>
</span><span id="line-441"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connHTTP2 :: IORef Bool
</span><span class="hs-identifier hs-var">connHTTP2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621679090551"><span class="hs-identifier hs-var">isH2</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">connMySockAddr :: SockAddr
</span><span class="hs-identifier hs-var">connMySockAddr</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679090536"><span class="hs-identifier hs-var">mysa</span></a></span><span>
</span><span id="line-443"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-445"></span><span>        </span><span id="local-6989586621679090558"><span class="annot"><span class="annottext">sendall :: ByteString -&gt; IO ()
</span><a href="#local-6989586621679090558"><span class="hs-identifier hs-var hs-var">sendall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ByteString -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ByteString -&gt; m ()
</span><span class="hs-identifier hs-var">TLS.sendData</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ())
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Lazy.html#fromChunks"><span class="hs-identifier hs-var">L.fromChunks</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; (ByteString -&gt; [ByteString]) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span id="local-6989586621679090564"><span class="annot"><span class="annottext">recv :: IO ByteString
</span><a href="#local-6989586621679090564"><span class="hs-identifier hs-var hs-var">recv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeException -&gt; IO ByteString) -&gt; IO ByteString -&gt; IO ByteString
forall e a. Exception e =&gt; (e -&gt; IO a) -&gt; IO a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#handle"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ByteString
</span><a href="#local-6989586621679090578"><span class="hs-identifier hs-var">onEOF</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; IO ByteString) -&gt; IO ByteString -&gt; IO ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ByteString
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ByteString
</span><span class="hs-identifier hs-var">TLS.recvData</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-447"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-448"></span><span>            </span><span id="local-6989586621679090578"><span class="annot"><span class="annottext">onEOF :: SomeException -&gt; IO ByteString
</span><a href="#local-6989586621679090578"><span class="hs-identifier hs-var hs-var">onEOF</span></a></span></span><span> </span><span id="local-6989586621679090586"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679090586"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-cpp">
#if MIN_VERSION_tls(1,8,0)
</span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TLS.PostHandshake</span></span><span> </span><span class="annot"><span class="annottext">TLSError
</span><span class="hs-identifier hs-var">TLS.Error_EOF</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe TLSException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">E.fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679090586"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-cpp">
#else
</span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">TLS.Error_EOF</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fromException</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">S.empty</span><span class="hs-cpp">
#endif
</span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679090590"><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679090590"><span class="hs-identifier hs-var">ioe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe IOError
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679090586"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IOError -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/System.IO.Error.html#isEOFError"><span class="hs-identifier hs-var">isEOFError</span></a></span><span> </span><span class="annot"><span class="annottext">IOError
</span><a href="#local-6989586621679090590"><span class="hs-identifier hs-var">ioe</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-455"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ByteString
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679090586"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-456"></span><span>        </span><span id="local-6989586621679090560"><span class="annot"><span class="annottext">sendfile :: SendFile
</span><a href="#local-6989586621679090560"><span class="hs-identifier hs-var hs-var">sendfile</span></a></span></span><span> </span><span id="local-6989586621679090592"><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621679090592"><span class="hs-identifier hs-var">fid</span></a></span></span><span> </span><span id="local-6989586621679090593"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679090593"><span class="hs-identifier hs-var">offset</span></a></span></span><span> </span><span id="local-6989586621679090594"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679090594"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679090595"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679090595"><span class="hs-identifier hs-var">hook</span></a></span></span><span> </span><span id="local-6989586621679090596"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090596"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>            </span><span id="local-6989586621679090597"><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679090597"><span class="hs-identifier hs-var">writeBuffer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer -&gt; IO WriteBuffer
forall a. IORef a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WriteBuffer
</span><a href="#local-6989586621679090550"><span class="hs-identifier hs-var">writeBufferRef</span></a></span><span>
</span><span id="line-458"></span><span>            </span><span class="annot"><span class="annottext">Buffer -&gt; Int -&gt; (ByteString -&gt; IO ()) -&gt; SendFile
</span><span class="hs-identifier hs-var">readSendFile</span></span><span>
</span><span id="line-459"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteBuffer -&gt; Buffer
</span><span class="hs-identifier hs-var">bufBuffer</span></span><span> </span><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679090597"><span class="hs-identifier hs-var">writeBuffer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteBuffer -&gt; Int
</span><span class="hs-identifier hs-var">bufSize</span></span><span> </span><span class="annot"><span class="annottext">WriteBuffer
</span><a href="#local-6989586621679090597"><span class="hs-identifier hs-var">writeBuffer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>                </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679090558"><span class="hs-identifier hs-var">sendall</span></a></span><span>
</span><span id="line-462"></span><span>                </span><span class="annot"><span class="annottext">FileId
</span><a href="#local-6989586621679090592"><span class="hs-identifier hs-var">fid</span></a></span><span>
</span><span id="line-463"></span><span>                </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679090593"><span class="hs-identifier hs-var">offset</span></a></span><span>
</span><span id="line-464"></span><span>                </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679090594"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-465"></span><span>                </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679090595"><span class="hs-identifier hs-var">hook</span></a></span><span>
</span><span id="line-466"></span><span>                </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679090596"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>        </span><span id="local-6989586621679090562"><span class="annot"><span class="annottext">close' :: IO ()
</span><a href="#local-6989586621679090562"><span class="hs-identifier hs-var hs-var">close'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-469"></span><span>            </span><span class="annot"><span class="annottext">IO (Either IOError ()) -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO (Either IOError ())
forall a. IO a -&gt; IO (Either IOError a)
</span><a href="Network.Wai.Handler.WarpTLS.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679090603"><span class="hs-identifier hs-var">sendBye</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#finally"><span class="hs-operator hs-var">`finally`</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO ()
</span><span class="hs-identifier hs-var">TLS.contextClose</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>        </span><span id="local-6989586621679090603"><span class="annot"><span class="annottext">sendBye :: IO ()
</span><a href="#local-6989586621679090603"><span class="hs-identifier hs-var hs-var">sendBye</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-473"></span><span>            </span><span class="hs-comment">-- It's fine if the connection was closed by the other side before</span><span>
</span><span id="line-474"></span><span>            </span><span class="hs-comment">-- receiving close_notify, see RFC 5246 section 7.2.1.</span><span>
</span><span id="line-475"></span><span>            </span><span class="annot"><span class="annottext">(InvalidRequest -&gt; Maybe InvalidRequest)
-&gt; (InvalidRequest -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall e b a.
Exception e =&gt;
(e -&gt; Maybe b) -&gt; (b -&gt; IO a) -&gt; IO a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#handleJust"><span class="hs-identifier hs-var">handleJust</span></a></span><span>
</span><span id="line-476"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679090614"><span class="annot"><span class="annottext">InvalidRequest
</span><a href="#local-6989586621679090614"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidRequest
</span><a href="#local-6989586621679090614"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; InvalidRequest -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><span class="hs-identifier hs-var">ConnectionClosedByPeer</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe () -&gt; Maybe InvalidRequest -&gt; Maybe InvalidRequest
forall a b. Maybe a -&gt; Maybe b -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest -&gt; Maybe InvalidRequest
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidRequest
</span><a href="#local-6989586621679090614"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; InvalidRequest -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><span class="hs-identifier hs-var">TLS.bye</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090537"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#getTLSinfo"><span class="hs-identifier hs-type">getTLSinfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TLS.Context</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transport</span></span><span>
</span><span id="line-481"></span><span id="getTLSinfo"><span class="annot"><span class="annottext">getTLSinfo :: Context -&gt; IO Transport
</span><a href="Network.Wai.Handler.WarpTLS.html#getTLSinfo"><span class="hs-identifier hs-var hs-var">getTLSinfo</span></a></span></span><span> </span><span id="local-6989586621679090617"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090617"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>    </span><span id="local-6989586621679090618"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679090618"><span class="hs-identifier hs-var">proto</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe ByteString)
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m (Maybe ByteString)
</span><span class="hs-identifier hs-var">TLS.getNegotiatedProtocol</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090617"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-483"></span><span>    </span><span id="local-6989586621679090619"><span class="annot"><span class="annottext">Maybe Information
</span><a href="#local-6989586621679090619"><span class="hs-identifier hs-var">minfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe Information)
</span><span class="hs-identifier hs-var">TLS.contextGetInformation</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090617"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Information
</span><a href="#local-6989586621679090619"><span class="hs-identifier hs-var">minfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-485"></span><span>        </span><span class="annot"><span class="annottext">Maybe Information
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transport -&gt; IO Transport
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Transport
</span><span class="hs-identifier hs-var">TCP</span></span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679090622"><span class="annot"><span class="annottext">Information
</span><a href="#local-6989586621679090622"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-487"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679090635"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679090635"><span class="hs-identifier hs-var">major</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679090636"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679090636"><span class="hs-identifier hs-var">minor</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Information -&gt; Version
</span><span class="hs-identifier hs-var">TLS.infoVersion</span></span><span> </span><span class="annot"><span class="annottext">Information
</span><a href="#local-6989586621679090622"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-488"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS.SSL2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS.SSL3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS.TLS10</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS.TLS11</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier hs-var">TLS.TLS12</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>                    </span><span class="annot"><span class="annottext">Version
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>            </span><span id="local-6989586621679090643"><span class="annot"><span class="annottext">Maybe CertificateChain
</span><a href="#local-6989586621679090643"><span class="hs-identifier hs-var">clientCert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; IO (Maybe CertificateChain)
</span><span class="hs-identifier hs-var">TLS.getClientCertificateChain</span></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679090617"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-495"></span><span>            </span><span class="annot"><span class="annottext">Transport -&gt; IO Transport
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-496"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">TLS</span></span><span>
</span><span id="line-497"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tlsMajorVersion :: Int
</span><span class="hs-identifier hs-var">tlsMajorVersion</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679090635"><span class="hs-identifier hs-var">major</span></a></span><span>
</span><span id="line-498"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsMinorVersion :: Int
</span><span class="hs-identifier hs-var">tlsMinorVersion</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679090636"><span class="hs-identifier hs-var">minor</span></a></span><span>
</span><span id="line-499"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsNegotiatedProtocol :: Maybe ByteString
</span><span class="hs-identifier hs-var">tlsNegotiatedProtocol</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679090618"><span class="hs-identifier hs-var">proto</span></a></span><span>
</span><span id="line-500"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsChiperID :: Word16
</span><span class="hs-identifier hs-var">tlsChiperID</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cipher -&gt; Word16
</span><span class="hs-identifier hs-var">TLS.cipherID</span></span><span> </span><span class="annot"><span class="annottext">(Cipher -&gt; Word16) -&gt; Cipher -&gt; Word16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Information -&gt; Cipher
</span><span class="hs-identifier hs-var">TLS.infoCipher</span></span><span> </span><span class="annot"><span class="annottext">Information
</span><a href="#local-6989586621679090622"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-501"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tlsClientCertificate :: Maybe CertificateChain
</span><span class="hs-identifier hs-var">tlsClientCertificate</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CertificateChain
</span><a href="#local-6989586621679090643"><span class="hs-identifier hs-var">clientCert</span></a></span><span>
</span><span id="line-502"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span id="local-6989586621679090108"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#tryIO"><span class="hs-identifier hs-type">tryIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090108"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.Exception.html#IOException"><span class="hs-identifier hs-type">IOException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090108"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-505"></span><span id="tryIO"><span class="annot"><span class="annottext">tryIO :: forall a. IO a -&gt; IO (Either IOError a)
</span><a href="Network.Wai.Handler.WarpTLS.html#tryIO"><span class="hs-identifier hs-var hs-var">tryIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Either IOError a)
forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Control.Exception.Base.html#try"><span class="hs-identifier hs-var">try</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#plainHTTP"><span class="hs-identifier hs-type">plainHTTP</span></a></span><span>
</span><span id="line-510"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Settings</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Transport</span></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span id="plainHTTP"><span class="annot"><span class="annottext">plainHTTP :: TLSSettings
-&gt; Settings -&gt; Socket -&gt; ByteString -&gt; IO (Connection, Transport)
</span><a href="Network.Wai.Handler.WarpTLS.html#plainHTTP"><span class="hs-identifier hs-var hs-var">plainHTTP</span></a></span></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#TLSSettings"><span class="hs-identifier hs-type">TLSSettings</span></a></span><span class="hs-special">{</span><span id="local-6989586621679090654"><span id="local-6989586621679090655"><span id="local-6989586621679090656"><span id="local-6989586621679090657"><span id="local-6989586621679090658"><span id="local-6989586621679090659"><span id="local-6989586621679090660"><span id="local-6989586621679090661"><span id="local-6989586621679090662"><span id="local-6989586621679090663"><span id="local-6989586621679090664"><span id="local-6989586621679090665"><span class="annot"><span class="annottext">Bool
[HashAndSignatureAlgorithm]
[Cipher]
[Version]
Maybe Credentials
Maybe SessionManager
Maybe Config
Maybe DHParams
Logging
ServerHooks
OnInsecure
CertSettings
tlsCredentials :: TLSSettings -&gt; Maybe Credentials
tlsLogging :: TLSSettings -&gt; Logging
tlsAllowedVersions :: TLSSettings -&gt; [Version]
tlsCiphers :: TLSSettings -&gt; [Cipher]
tlsWantClientCert :: TLSSettings -&gt; Bool
tlsServerHooks :: TLSSettings -&gt; ServerHooks
tlsServerDHEParams :: TLSSettings -&gt; Maybe DHParams
tlsSessionManagerConfig :: TLSSettings -&gt; Maybe Config
tlsSessionManager :: TLSSettings -&gt; Maybe SessionManager
onInsecure :: TLSSettings -&gt; OnInsecure
certSettings :: TLSSettings -&gt; CertSettings
tlsSupportedHashSignatures :: TLSSettings -&gt; [HashAndSignatureAlgorithm]
certSettings :: CertSettings
onInsecure :: OnInsecure
tlsLogging :: Logging
tlsAllowedVersions :: [Version]
tlsCiphers :: [Cipher]
tlsWantClientCert :: Bool
tlsServerHooks :: ServerHooks
tlsServerDHEParams :: Maybe DHParams
tlsSessionManagerConfig :: Maybe Config
tlsCredentials :: Maybe Credentials
tlsSessionManager :: Maybe SessionManager
tlsSupportedHashSignatures :: [HashAndSignatureAlgorithm]
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#tlsCredentials"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679090666"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090666"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679090667"><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090667"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679090668"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090668"><span class="hs-identifier hs-var">bs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OnInsecure
</span><a href="#local-6989586621679090655"><span class="hs-identifier hs-var">onInsecure</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><span class="annottext">OnInsecure
</span><a href="Network.Wai.Handler.WarpTLS.Internal.html#AllowInsecure"><span class="hs-identifier hs-var">AllowInsecure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-513"></span><span>        </span><span id="local-6989586621679090670"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679090670"><span class="hs-identifier hs-var">conn'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Socket -&gt; IO Connection
</span><span class="hs-identifier hs-var">socketConnection</span></span><span> </span><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679090666"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090667"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-514"></span><span>        </span><span id="local-6989586621679090672"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090672"><span class="hs-identifier hs-var">cachedRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; IO (IORef ByteString)
forall a. a -&gt; IO (IORef a)
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">I.newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090668"><span class="hs-identifier hs-var">bs0</span></a></span><span>
</span><span id="line-515"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679090673"><span class="annot"><span class="annottext">conn'' :: Connection
</span><a href="#local-6989586621679090673"><span class="hs-identifier hs-var hs-var">conn''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-516"></span><span>                </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679090670"><span class="hs-identifier hs-var">conn'</span></a></span><span>
</span><span id="line-517"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">connRecv</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#recvPlain"><span class="hs-identifier hs-type">recvPlain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679090672"><span class="hs-identifier hs-type">cachedRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-var">connRecv</span></span><span> </span><span class="annot"><a href="#local-6989586621679090670"><span class="hs-identifier hs-type">conn'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-519"></span><span>        </span><span class="annot"><span class="annottext">(Connection, Transport) -&gt; IO (Connection, Transport)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679090673"><span class="hs-identifier hs-var">conn''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Transport
</span><span class="hs-identifier hs-var">TCP</span></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>    </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.Internal.html#DenyInsecure"><span class="hs-identifier hs-type">DenyInsecure</span></a></span><span> </span><span id="local-6989586621679090676"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090676"><span class="hs-identifier hs-var">lbs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-521"></span><span>        </span><span class="hs-comment">-- Listening port 443 but TLS records do not arrive.</span><span>
</span><span id="line-522"></span><span>        </span><span class="hs-comment">-- We want to let the browser know that TLS is required.</span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-comment">-- So, we use 426.</span><span>
</span><span id="line-524"></span><span>        </span><span class="hs-comment">--     http://tools.ietf.org/html/rfc2817#section-4.2</span><span>
</span><span id="line-525"></span><span>        </span><span class="hs-comment">--     https://tools.ietf.org/html/rfc7231#section-6.5.15</span><span>
</span><span id="line-526"></span><span>        </span><span class="hs-comment">-- FIXME: should we distinguish HTTP/1.1 and HTTP/2?</span><span>
</span><span id="line-527"></span><span>        </span><span class="hs-comment">--        In the case of HTTP/2, should we send</span><span>
</span><span id="line-528"></span><span>        </span><span class="hs-comment">--        GOAWAY + INADEQUATE_SECURITY?</span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-comment">-- FIXME: Content-Length:</span><span>
</span><span id="line-530"></span><span>        </span><span class="hs-comment">-- FIXME: TLS/&lt;version&gt;</span><span>
</span><span id="line-531"></span><span>        </span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">sendAll</span></span><span>
</span><span id="line-532"></span><span>            </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090667"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-533"></span><span>            </span><span class="hs-string">&quot;HTTP/1.1 426 Upgrade Required\
            \\r\nUpgrade: TLS/1.0, HTTP/1.1\
            \\r\nConnection: Upgrade\
            \\r\nContent-Type: text/plain\r\n\r\n&quot;</span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; [ByteString] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Socket -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">sendAll</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090667"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; IO ()) -&gt; [ByteString] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Lazy.html#toChunks"><span class="hs-identifier hs-var">L.toChunks</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090676"><span class="hs-identifier hs-var">lbs</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><span class="annottext">Socket -&gt; IO ()
</span><span class="hs-identifier hs-var">close</span></span><span> </span><span class="annot"><span class="annottext">Socket
</span><a href="#local-6989586621679090667"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-539"></span><span>        </span><span class="annot"><span class="annottext">WarpTLSException -&gt; IO (Connection, Transport)
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">WarpTLSException
</span><a href="Network.Wai.Handler.WarpTLS.html#InsecureConnectionDenied"><span class="hs-identifier hs-var">InsecureConnectionDenied</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="hs-comment">-- | Modify the given receive function to first check the given @IORef@ for a</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- chunk of data. If present, takes the chunk of data from the @IORef@ and</span><span>
</span><span id="line-545"></span><span class="hs-comment">-- empties out the @IORef@. Otherwise, calls the supplied receive function.</span><span>
</span><span id="line-546"></span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#recvPlain"><span class="hs-identifier hs-type">recvPlain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">I.IORef</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#IO"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">S.ByteString</span></a></span><span>
</span><span id="line-547"></span><span id="recvPlain"><span class="annot"><span class="annottext">recvPlain :: IORef ByteString -&gt; IO ByteString -&gt; IO ByteString
</span><a href="Network.Wai.Handler.WarpTLS.html#recvPlain"><span class="hs-identifier hs-var hs-var">recvPlain</span></a></span></span><span> </span><span id="local-6989586621679090680"><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090680"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679090681"><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679090681"><span class="hs-identifier hs-var">fallback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-548"></span><span>    </span><span id="local-6989586621679090682"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090682"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef ByteString -&gt; IO ByteString
forall a. IORef a -&gt; IO a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">I.readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090680"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.html#null"><span class="hs-identifier hs-var">S.null</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090682"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679090681"><span class="hs-identifier hs-var">fallback</span></a></span><span>
</span><span id="line-551"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>            </span><span class="annot"><span class="annottext">IORef ByteString -&gt; ByteString -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">I.writeIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ByteString
</span><a href="#local-6989586621679090680"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/bytestring-0.11.5.4/src/Data.ByteString.Internal.Type.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span>
</span><span id="line-553"></span><span>            </span><span class="annot"><span class="annottext">ByteString -&gt; IO ByteString
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679090682"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-keyword">data</span><span> </span><span id="WarpTLSException"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#WarpTLSException"><span class="hs-identifier hs-var">WarpTLSException</span></a></span></span><span>
</span><span id="line-558"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="InsecureConnectionDenied"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#InsecureConnectionDenied"><span class="hs-identifier hs-var">InsecureConnectionDenied</span></a></span></span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ClientClosedConnectionPrematurely"><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#ClientClosedConnectionPrematurely"><span class="hs-identifier hs-var">ClientClosedConnectionPrematurely</span></a></span></span><span>
</span><span id="line-560"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679090685"><span id="local-6989586621679090687"><span id="local-6989586621679090691"><span class="annot"><span class="annottext">Int -&gt; WarpTLSException -&gt; ShowS
[WarpTLSException] -&gt; ShowS
WarpTLSException -&gt; FilePath
(Int -&gt; WarpTLSException -&gt; ShowS)
-&gt; (WarpTLSException -&gt; FilePath)
-&gt; ([WarpTLSException] -&gt; ShowS)
-&gt; Show WarpTLSException
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; WarpTLSException -&gt; ShowS
showsPrec :: Int -&gt; WarpTLSException -&gt; ShowS
$cshow :: WarpTLSException -&gt; FilePath
show :: WarpTLSException -&gt; FilePath
$cshowList :: [WarpTLSException] -&gt; ShowS
showList :: [WarpTLSException] -&gt; ShowS
</span><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679090699"><span id="local-6989586621679090702"><span id="local-6989586621679090705"><span class="annot"><a href="file:///nix/store/q5s037f3dqgwfpccw3qcagm27malqb1y-ghc-9.6.7-doc/share/doc/ghc-9.6.7/html/libraries/base-4.18.3.0/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Network.Wai.Handler.WarpTLS.html#WarpTLSException"><span class="hs-identifier hs-type">WarpTLSException</span></a></span></span></span></span><span>
</span><span id="line-562"></span></pre></body></html>