<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Network.TypedProtocol.Core</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">typed-protocols-0.3.0.0: A framework for strongly typed protocols</span><ul class="links" id="page-menu"><li><a href="src/Network.TypedProtocol.Core.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr><tr><th>Extensions</th><td><ul class="extension-list"><li>MonoLocalBinds</li><li>ScopedTypeVariables</li><li>TypeFamilies</li><li>TypeFamilyDependencies</li><li>ViewPatterns</li><li>GADTs</li><li>GADTSyntax</li><li>ConstraintKinds</li><li>PolyKinds</li><li>DataKinds</li><li>StandaloneDeriving</li><li>DerivingStrategies</li><li>DerivingVia</li><li>TypeSynonymInstances</li><li>FlexibleContexts</li><li>FlexibleInstances</li><li>ConstrainedClassMethods</li><li>MultiParamTypeClasses</li><li>KindSignatures</li><li>RankNTypes</li><li>TypeOperators</li><li>ExplicitNamespaces</li><li>ExplicitForAll</li><li>EmptyCase</li><li>PatternSynonyms</li><li>StandaloneKindSignatures</li></ul></td></tr></table><p class="caption">Network.TypedProtocol.Core</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Introduction</a></li><li><a href="#g:2">Defining protocols</a></li><li><a href="#g:3">Engaging in protocols</a><ul><li><a href="#g:4">PeerRole</a></li><li><a href="#g:5">Agency and its evidence</a><ul><li><a href="#g:6">FlipAgency</a></li><li><a href="#g:7">ActiveState</a></li></ul></li><li><a href="#g:8">Pipelining</a><ul><li><a href="#g:9">IsPipelined</a></li><li><a href="#g:10">Outstanding</a></li><li><a href="#g:11">N and Nat</a></li></ul></li></ul></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module defines the core of the typed protocol framework.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">class</span> <a href="#t:Protocol">Protocol</a> ps <span class="keyword">where</span><ul class="subs"><li><span class="keyword">data</span> <a href="#t:Message">Message</a> ps (st :: ps) (st' :: ps)</li><li><span class="keyword">type</span> <a href="#t:StateAgency">StateAgency</a> (st :: ps) :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></li><li><span class="keyword">type</span> <a href="#t:StateToken">StateToken</a> :: ps -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Kind.html#t:Type" title="Data.Kind">Type</a></li></ul></li><li class="src short"><span class="keyword">class</span> <a href="#t:StateTokenI">StateTokenI</a> st <span class="keyword">where</span><ul class="subs"><li><a href="#v:stateToken">stateToken</a> :: <a href="Network-TypedProtocol-Core.html#t:StateToken" title="Network.TypedProtocol.Core">StateToken</a> st</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:PeerRole">PeerRole</a><ul class="subs"><li>= <a href="#v:AsClient">AsClient</a></li><li>| <a href="#v:AsServer">AsServer</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:SingPeerRole">SingPeerRole</a> pr <span class="keyword">where</span><ul class="subs"><li><a href="#v:SingAsClient">SingAsClient</a> :: <a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> <a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a></li><li><a href="#v:SingAsServer">SingAsServer</a> :: <a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> <a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:Agency">Agency</a> <span class="keyword">where</span><ul class="subs"><li><a href="#v:ClientAgency">ClientAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></li><li><a href="#v:ServerAgency">ServerAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></li><li><a href="#v:NobodyAgency">NobodyAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:SingAgency">SingAgency</a> a <span class="keyword">where</span><ul class="subs"><li><a href="#v:SingClientAgency">SingClientAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></li><li><a href="#v:SingServerAgency">SingServerAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></li><li><a href="#v:SingNobodyAgency">SingNobodyAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:RelativeAgency">RelativeAgency</a> <span class="keyword">where</span><ul class="subs"><li><a href="#v:WeHaveAgency">WeHaveAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></li><li><a href="#v:TheyHaveAgency">TheyHaveAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></li><li><a href="#v:NobodyHasAgency">NobodyHasAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></li></ul></li><li class="src short"><span class="keyword">type family</span> <a href="#t:Relative">Relative</a> pr a <span class="keyword">where ...</span></li><li class="src short"><span class="keyword">data</span> <a href="#t:ReflRelativeAgency">ReflRelativeAgency</a> a r r' <span class="keyword">where</span><ul class="subs"><li><a href="#v:ReflClientAgency">ReflClientAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> r r</li><li><a href="#v:ReflServerAgency">ReflServerAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> r r</li><li><a href="#v:ReflNobodyAgency">ReflNobodyAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a> r r</li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:WeHaveAgencyProof">WeHaveAgencyProof</a> pr st = <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="Network-TypedProtocol-Core.html#v:WeHaveAgency" title="Network.TypedProtocol.Core">WeHaveAgency</a> (<a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> pr (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st))</li><li class="src short"><span class="keyword">type</span> <a href="#t:TheyHaveAgencyProof">TheyHaveAgencyProof</a> pr st = <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="Network-TypedProtocol-Core.html#v:TheyHaveAgency" title="Network.TypedProtocol.Core">TheyHaveAgency</a> (<a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> pr (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st))</li><li class="src short"><span class="keyword">type</span> <a href="#t:NobodyHasAgencyProof">NobodyHasAgencyProof</a> pr st = <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="Network-TypedProtocol-Core.html#v:NobodyHasAgency" title="Network.TypedProtocol.Core">NobodyHasAgency</a> (<a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> pr (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st))</li><li class="src short"><span class="keyword">type family</span> <a href="#t:FlipAgency">FlipAgency</a> pr <span class="keyword">where ...</span></li><li class="src short"><span class="keyword">class</span> <a href="#t:IsActiveState">IsActiveState</a> st (agency :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a>) <span class="keyword">where</span><ul class="subs"><li><a href="#v:activeAgency">activeAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st agency</li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:ActiveState">ActiveState</a> st = <a href="Network-TypedProtocol-Core.html#t:IsActiveState" title="Network.TypedProtocol.Core">IsActiveState</a> st (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st)</li><li class="src short"><a href="#v:notActiveState">notActiveState</a> :: <span class="keyword">forall</span> ps (st :: ps). <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a> =&gt; <a href="Network-TypedProtocol-Core.html#t:ActiveState" title="Network.TypedProtocol.Core">ActiveState</a> st =&gt; <a href="Network-TypedProtocol-Core.html#t:StateToken" title="Network.TypedProtocol.Core">StateToken</a> st -&gt; <span class="keyword">forall</span> a. a</li><li class="src short"><span class="keyword">type</span> <a href="#t:ActiveAgency">ActiveAgency</a> st = <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st)</li><li class="src short"><span class="keyword">data</span> <a href="#t:ActiveAgency-39-">ActiveAgency'</a> st agency <span class="keyword">where</span><ul class="subs"><li><a href="#v:ClientHasAgency">ClientHasAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> =&gt; <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></li><li><a href="#v:ServerHasAgency">ServerHasAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> =&gt; <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:IsPipelined">IsPipelined</a> <span class="keyword">where</span><ul class="subs"><li><a href="#v:Pipelined">Pipelined</a> :: <a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a> -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:IsPipelined" title="Network.TypedProtocol.Core">IsPipelined</a></li><li><a href="#v:NonPipelined">NonPipelined</a> :: <a href="Network-TypedProtocol-Core.html#t:IsPipelined" title="Network.TypedProtocol.Core">IsPipelined</a></li></ul></li><li class="src short"><span class="keyword">type family</span> <a href="#t:Outstanding">Outstanding</a> pl <span class="keyword">where ...</span></li><li class="src short"><span class="keyword">data</span> <a href="#t:N">N</a><ul class="subs"><li>= <a href="#v:Z">Z</a></li><li>| <a href="#v:S">S</a> <a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:Nat">Nat</a> (n :: <a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a>) <span class="keyword">where</span><ul class="subs"><li><span class="keyword">pattern</span> <a href="#v:Succ">Succ</a> :: () =&gt; m <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:S" title="Network.TypedProtocol.Core">S</a> n =&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n -&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> m</li><li><span class="keyword">pattern</span> <a href="#v:Zero">Zero</a> :: () =&gt; <a href="Network-TypedProtocol-Core.html#v:Z" title="Network.TypedProtocol.Core">Z</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> n =&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n</li></ul></li><li class="src short"><a href="#v:natToInt">natToInt</a> :: <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:unsafeIntToNat">unsafeIntToNat</a> :: <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Introduction</h1></a><div class="doc"><p>A typed protocol between two peers is defined via a state machine: a
 collection of protocol states and protocol messages which are transitions
 between those states.</p><p>Start from the idea that a protocol is some language of messages sent
 between two peers. To specify a protocol is to describe what possible
 sequences of messages are valid. One simple but still relatively expressive
 way to do this is via a state machine: starting from some initial state,
 all possible paths through the state machine gives the set of valid protocol
 traces. This then dictates what a peer participating in a protocol may
 produce and what it must accept.</p><p>In this style we have a fixed number of states and in each state there is
 some number of valid messages that move us on to the next state. This can be
 illustrated as a graph, which can be a helpful form of documentation.</p><p>We further constrain this idea by saying that the two peers will use the
 same state machine and change states in lock-step by sending/receiving
 messages. In this approach, for each protocol state, the description
 dictates which peer has the agency to choose to send a message, while
 correspondingly the other must be prepared to receive the message.</p><p>The views of the two peers are dual. In each state one peer can send any
 message that is valid for the current protocol state while the other
 must be prepared to receive any valid message for current protocol state.</p><p>We can also have terminal protocol states in which neither peer has agency.</p><p>So part of the protocol description is to label each protocol state with
 the peer that has the agency in that state, or none for terminal states.
 We use the labels &quot;client&quot; and &quot;server&quot; for the two peers, but they are
 in fact symmetric.</p></div><a href="#g:2" id="g:2"><h1>Defining protocols</h1></a><div class="doc"><p>The <code><a href="Network-TypedProtocol-Core.html#t:Protocol" title="Network.TypedProtocol.Core">Protocol</a></code> type class bundles up all the requirements for a typed
 protocol, which are in fact all type level constructs. Defining a new
 protocol and making it an instance of the <code><a href="Network-TypedProtocol-Core.html#t:Protocol" title="Network.TypedProtocol.Core">Protocol</a></code> class requires the
 following language extensions:</p><pre>{-# LANGUAGE GADTs, TypeFamilies, DataKinds #-}</pre><p>The type class itself is indexed on a protocol &quot;tag&quot; type. This type
 does double duty as the <em>kind</em> of the <em>types</em> of the protocol states.</p><p>We will use as a running example a simple &quot;ping/pong&quot; protocol. (You can
 see the example in full in <a href="Network-TypedProtocol-PingPong-Type.html">Network.TypedProtocol.PingPong.Type</a>.) In this
 example protocol the client sends a ping message and the serve must respond
 with a pong message. The client can also terminate the protocol. So modelled
 as a state machine this protocol has three states, the one in which the
 client can send a ping or terminate message, the one in which the server
 must send a pong, and the terminal state where neither can send anything.
 We somewhat arbitrarily choose label these protocol states as &quot;idle&quot;
 &quot;busy&quot; and &quot;done&quot;.</p><p>For this ping pong example the protocol tag and the protocol state types
 would be defined (via promoted data kinds) as:</p><pre>data PingPong where
  StIdle :: PingPong
  StBusy :: PingPong
  StDone :: PingPong</pre><p>We use <code>DataKinds</code> promotion here so <code>StIdle</code>, <code>StBusy</code> and <code>StDone</code> are
 <em>types</em> (of <em>kind</em> <code>PingPong</code>) representing the three states in this
 protocol's state machine. <code>PingPong</code> itself is both the kind of these types
 and is also the tag for protocol. We only ever use these as types, via the
 <code>DataKinds</code> promotion, never as value level data constructors.</p><p>Having defined our protocol tag and states we can instantiate the <code><a href="Network-TypedProtocol-Core.html#t:Protocol" title="Network.TypedProtocol.Core">Protocol</a></code>
 type class and fill out the other details.</p><p>The protocol must define what its messages are. These form the state
 transitions in the protocol state machine. Each transition specifies a
 &quot;from&quot; and &quot;to&quot; state as type parameters. This of course determines in
 which protocol states each message can appear.</p><p>In the &quot;ping/pong&quot; protocol example, the messages are of course ping and
 pong, which transition between the two main states. There is also a done
 message that moves the system into a terminal state.</p><pre>instance Protocol PingPong where
  data Message PingPong from to where
    MsgPing :: Message PingPong StIdle StBusy
    MsgPong :: Message PingPong StBusy StIdle
    MsgDone :: Message PingPong StIdle StDone</pre><p>This says that in the idle state a ping message takes us to the busy state,
 while a pong message takes us back to idle. Also in the idle state a done
 message takes us to the done state.</p><p>It is not required that protocols have any terminal states or corresponding
 transitions, as in this example, but it is often useful and it aids testing
 to have protocols that terminate cleanly as it allows them to return a
 result.</p><p>As described above, this style of protocol gives agency to only one peer at
 once. That is, in each protocol state, one peer has agency (the ability to
 send) and the other does not (it must only receive).</p><p>In the &quot;ping/pong&quot; protocol example, the idle state is the one in which
 the client can send a message, and the busy state is the one in which the
 server must respond. Finally in the done state, neither peer can send any
 further messages. This arrangement is defined as so:</p><pre>   -- still within the instance Protocol PingPong
   type StateAgency StIdle = ClientAgency
   type StateAgency StBusy = ServerAgency
   type StateAgency StDone = NobodyAgency</pre><p>In this simple protocol there is exactly one state in each category, but in
 general for non-trivial protocols there may be several protocol states in
 each category.</p><p>Finally we need to point which singletons to use for the protocol states</p><pre>   -- still within the instance Protocol PingPong, 'SPingPong' type is what we define next.
   type StateToken = SPingPong</pre><p>Furthermore we use singletons to provide term level reflection of type level
 states.  One is required to provide singletons for all types of kind
 <code>PingPong</code>.  These definitions are provided outside of the <code><a href="Network-TypedProtocol-Core.html#t:Protocol" title="Network.TypedProtocol.Core">Protocol</a></code> type
 class.  This is as simple as providing a GADT:</p><pre>data SingPingPong (st :: PingPong) where
  SingIdle :: SingPingPong StIdle
  SingBusy :: SingPingPong StBusy
  SingDone :: SingPingPong StDone</pre><p>together with <code><a href="Network-TypedProtocol-Core.html#t:StateTokenI" title="Network.TypedProtocol.Core">StateTokenI</a></code> instance (similar to <code>SingI</code> from the
 &quot;singletons&quot; package):</p><pre>instance StateTokenI StIdle where stateToken = SingIdle
instance StateTokenI StBusy where stateToken = SingBusy
instance StateTokenI StDone where stateToken = SingDone</pre><p>This and other example protocols are provided in &quot;typed-protocols-examples&quot;
 package.</p></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:Protocol" class="def">Protocol</a> ps <a href="src/Network.TypedProtocol.Core.html#Protocol" class="link">Source</a> <a href="#t:Protocol" class="selflink">#</a></p><div class="doc"><p>The protocol type class bundles up all the requirements for a typed
 protocol.</p><p>Each protocol consists of four components:</p><ul><li>the protocol itself, which is also expected to be the kind of the types
   of the protocol states. The class is indexed on the protocol itself;</li><li>the protocol messages;</li><li>a type level map from the protocol states to agency: in each state either
   client or server or nobody has the agency.</li><li>a singleton type for the protocol states (e.g. <code><a href="Network-TypedProtocol-Core.html#t:StateToken" title="Network.TypedProtocol.Core">StateToken</a></code> type family
   instance), together with <code><a href="Network-TypedProtocol-Core.html#t:StateTokenI" title="Network.TypedProtocol.Core">StateTokenI</a></code> instances.</li></ul><p>It is required provide <code><a href="Network-TypedProtocol-Core.html#t:StateToken" title="Network.TypedProtocol.Core">StateToken</a></code> type family instance as well as
 <code><a href="Network-TypedProtocol-Core.html#t:StateTokenI" title="Network.TypedProtocol.Core">StateTokenI</a></code> instances for all protocol states.  These singletons allow one
 to pattern match on the state, which is useful when defining codecs, or
 providing informative error messages, however they are not necessary for
 proving correctness of the protocol.  These type families are similar to
 <code>Sing</code> and <code>SingI</code> in the &quot;singletons&quot; package.</p></div><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">data</span> <a id="t:Message" class="def">Message</a> ps (st :: ps) (st' :: ps) <a href="src/Network.TypedProtocol.Core.html#Message" class="link">Source</a> <a href="#t:Message" class="selflink">#</a></p><div class="doc"><p>The messages for this protocol. It is expected to be a GADT that is
 indexed by the <code>from</code> and <code>to</code> protocol states. That is the protocol state
 the message transitions from, and the protocol state it transitions into.
 These are the edges of the protocol state transition system.</p></div><p class="src"><span class="keyword">type</span> <a id="t:StateAgency" class="def">StateAgency</a> (st :: ps) :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a> <a href="src/Network.TypedProtocol.Core.html#StateAgency" class="link">Source</a> <a href="#t:StateAgency" class="selflink">#</a></p><div class="doc"><p>Associate an <code><a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></code> for each state.</p></div><p class="src"><span class="keyword">type</span> <a id="t:StateToken" class="def">StateToken</a> :: ps -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="src/Network.TypedProtocol.Core.html#StateToken" class="link">Source</a> <a href="#t:StateToken" class="selflink">#</a></p><div class="doc"><p>A type family for protocol state token, e.g. term level representation of
 type level state (also known as singleton).</p><p>This type family is similar to <code>Sing</code> type class in the &quot;singletons&quot;
 package, but specific for protocol states.</p></div></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:StateTokenI" class="def">StateTokenI</a> st <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#StateTokenI" class="link">Source</a> <a href="#t:StateTokenI" class="selflink">#</a></p><div class="doc"><p>A type class which hides a state token / singleton inside a class
 dictionary.</p><p>This is similar to the <code>SingI</code> instance, but specific to protocol state
 singletons.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:stateToken" class="def">stateToken</a> :: <a href="Network-TypedProtocol-Core.html#t:StateToken" title="Network.TypedProtocol.Core">StateToken</a> st <a href="src/Network.TypedProtocol.Core.html#stateToken" class="link">Source</a> <a href="#v:stateToken" class="selflink">#</a></p></div></div><div class="doc"><p>The <code><a href="Network-TypedProtocol.html#v:connect" title="Network.TypedProtocol">connect</a></code> proof rely on lemmas about the
 protocol. Specifically they rely on the property that each protocol state is
 labelled with the agency of one peer or the other, or neither, but never
 both.  This property is true by construction, since we use a type family
 <code><a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a></code> which maps states to agencies, however we still need an evince
 that cases where both peer have the agency or neither of them has it can be
 eliminated.</p><p>The packages defines lemmas (in a hidden module) which are structured as
 proofs by contradiction, e.g. stating &quot;if the client and the server have
 agency for this state then it leads to contradiction&quot;. Contradiction is
 represented as the <code>Void</code> type that has no values except &#8869;.</p><p>The framework defines protocol-agnostic proofs (in the hidden module
 <code><a href="Network-TypedProtocol.html#v:Lemmas" title="Network.TypedProtocol">Lemmas</a></code>) which excludes that the client and server
 have agency at the same time.</p><ul><li><code>exclusionLemma_ClientAndServerHaveAgency</code>,</li><li><code>terminationLemma_1</code>,</li><li><code>terminationLemma_2</code>.</li></ul></div><a href="#g:3" id="g:3"><h1>Engaging in protocols</h1></a><a href="#g:4" id="g:4"><h2>PeerRole</h2></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:PeerRole" class="def">PeerRole</a> <a href="src/Network.TypedProtocol.Core.html#PeerRole" class="link">Source</a> <a href="#t:PeerRole" class="selflink">#</a></p><div class="doc"><p>Types for client and server peer roles. As protocol can be viewed from
 either client or server side.</p><p>Note that technically &quot;client&quot; and &quot;server&quot; are arbitrary labels. The
 framework is completely symmetric between the two peers.</p><p>This definition is only used as promoted types and kinds, never as values.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:AsClient" class="def">AsClient</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:AsServer" class="def">AsServer</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:PeerRole">Instances</h4><details id="i:PeerRole" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:PeerRole:SingI:1"></span> SingI '<a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a></span> <a href="src/Network.TypedProtocol.Core.html#line-234" class="link">Source</a> <a href="#t:PeerRole" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:PeerRole:SingI:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:sing">sing</a> :: Sing '<a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:PeerRole:SingI:2"></span> SingI '<a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a></span> <a href="src/Network.TypedProtocol.Core.html#line-236" class="link">Source</a> <a href="#t:PeerRole" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:PeerRole:SingI:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:sing">sing</a> :: Sing '<a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:PeerRole:Sing:3"></span> <span class="keyword">type</span> Sing</span> <a href="src/Network.TypedProtocol.Core.html#line-233" class="link">Source</a> <a href="#t:PeerRole" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:PeerRole:Sing:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="src"><span class="keyword">type</span> Sing = <a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SingPeerRole" class="def">SingPeerRole</a> pr <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#SingPeerRole" class="link">Source</a> <a href="#t:SingPeerRole" class="selflink">#</a></p><div class="doc"><p>Singletons for <code><a href="Network-TypedProtocol-Core.html#t:PeerRole" title="Network.TypedProtocol.Core">PeerRole</a></code>.  We provide <code>Sing</code> and <code>SingI</code> instances from
 the &quot;singletons&quot; package.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SingAsClient" class="def">SingAsClient</a> :: <a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> <a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:SingAsServer" class="def">SingAsServer</a> :: <a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> <a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SingPeerRole">Instances</h4><details id="i:SingPeerRole" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SingPeerRole:Show:1"></span> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> pr)</span> <a href="src/Network.TypedProtocol.Core.html#line-231" class="link">Source</a> <a href="#t:SingPeerRole" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SingPeerRole:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> pr -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> pr -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Network-TypedProtocol-Core.html#t:SingPeerRole" title="Network.TypedProtocol.Core">SingPeerRole</a> pr] -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:5" id="g:5"><h2>Agency and its evidence</h2></a><div class="doc"><p>The protocols we consider either give agency to one side (one side can send
 a message) or the protocol terminated.  Agency is a (type-level) function of
 the protocol state, and thus uniquely determined by it.</p><p>The following types define the necessary type-level machinery and its
 term-level evidence to provide type-safe API for `typed-protocols`.
 Required proofs are hidden in an (unexposed) module
 <code>Network.TypedProtocol.Lemmas</code>.</p></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Agency" class="def">Agency</a> <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#Agency" class="link">Source</a> <a href="#t:Agency" class="selflink">#</a></p><div class="doc"><p>A promoted data type which denotes three possible agencies a protocol
 state might be assigned.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ClientAgency" class="def">ClientAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></td><td class="doc"><p>The client has agency.</p></td></tr><tr><td class="src"><a id="v:ServerAgency" class="def">ServerAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></td><td class="doc"><p>The server has agency.</p></td></tr><tr><td class="src"><a id="v:NobodyAgency" class="def">NobodyAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></td><td class="doc"><p>Nobody has agency, terminal state.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Agency">Instances</h4><details id="i:Agency" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Agency:SingI:1"></span> SingI '<a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></span> <a href="src/Network.TypedProtocol.Core.html#line-271" class="link">Source</a> <a href="#t:Agency" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Agency:SingI:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:sing">sing</a> :: Sing '<a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Agency:SingI:2"></span> SingI '<a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a></span> <a href="src/Network.TypedProtocol.Core.html#line-275" class="link">Source</a> <a href="#t:Agency" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Agency:SingI:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:sing">sing</a> :: Sing '<a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Agency:SingI:3"></span> SingI '<a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></span> <a href="src/Network.TypedProtocol.Core.html#line-273" class="link">Source</a> <a href="#t:Agency" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Agency:SingI:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:sing">sing</a> :: Sing '<a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Agency:Sing:4"></span> <span class="keyword">type</span> Sing</span> <a href="src/Network.TypedProtocol.Core.html#line-270" class="link">Source</a> <a href="#t:Agency" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Agency:Sing:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="src"><span class="keyword">type</span> Sing = <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SingAgency" class="def">SingAgency</a> a <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#SingAgency" class="link">Source</a> <a href="#t:SingAgency" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SingClientAgency" class="def">SingClientAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:SingServerAgency" class="def">SingServerAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:SingNobodyAgency" class="def">SingNobodyAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SingAgency">Instances</h4><details id="i:SingAgency" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SingAgency:Show:1"></span> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> a)</span> <a href="src/Network.TypedProtocol.Core.html#line-268" class="link">Source</a> <a href="#t:SingAgency" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SingAgency:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> a -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> a -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Network-TypedProtocol-Core.html#t:SingAgency" title="Network.TypedProtocol.Core">SingAgency</a> a] -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:RelativeAgency" class="def">RelativeAgency</a> <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#RelativeAgency" class="link">Source</a> <a href="#t:RelativeAgency" class="selflink">#</a></p><div class="doc"><p>A promoted data type which indicates the effective agency (which is
 relative to current role).  It is computed by <code><a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a></code> type family.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:WeHaveAgency" class="def">WeHaveAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TheyHaveAgency" class="def">TheyHaveAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:NobodyHasAgency" class="def">NobodyHasAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type family</span> <a id="t:Relative" class="def">Relative</a> pr a <span class="keyword">where ...</span> <a href="src/Network.TypedProtocol.Core.html#Relative" class="link">Source</a> <a href="#t:Relative" class="selflink">#</a></p><div class="doc"><p>Compute effective agency with respect to the peer role, for client role,
 agency is preserved, while for the server role it is flipped.</p></div><div class="subs equations"><p class="caption">Equations</p><table><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> <a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> = <a href="Network-TypedProtocol-Core.html#v:WeHaveAgency" title="Network.TypedProtocol.Core">WeHaveAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> <a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> = <a href="Network-TypedProtocol-Core.html#v:TheyHaveAgency" title="Network.TypedProtocol.Core">TheyHaveAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> <a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a> = <a href="Network-TypedProtocol-Core.html#v:NobodyHasAgency" title="Network.TypedProtocol.Core">NobodyHasAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> <a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> = <a href="Network-TypedProtocol-Core.html#v:TheyHaveAgency" title="Network.TypedProtocol.Core">TheyHaveAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> <a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> = <a href="Network-TypedProtocol-Core.html#v:WeHaveAgency" title="Network.TypedProtocol.Core">WeHaveAgency</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> <a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a> = <a href="Network-TypedProtocol-Core.html#v:NobodyHasAgency" title="Network.TypedProtocol.Core">NobodyHasAgency</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ReflRelativeAgency" class="def">ReflRelativeAgency</a> a r r' <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#ReflRelativeAgency" class="link">Source</a> <a href="#t:ReflRelativeAgency" class="selflink">#</a></p><div class="doc"><p>Type equality for <code><a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></code> which also carries information about
 agency.  It is isomorphic to a product of <code><a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a></code> singleton and
 <code>r :~: r'</code>, where both <code>r</code> and <code>r'</code> have kind <code><a href="Network-TypedProtocol-Core.html#t:RelativeAgency" title="Network.TypedProtocol.Core">RelativeAgency</a></code>.</p><p>This is a proper type with values used by the <code>Peer</code>, however they are
 hidden by using <a href="Network-TypedProtocol-Peer-Client.html">Network.TypedProtocol.Peer.Client</a> and
 <a href="Network-TypedProtocol-Peer-Server.html">Network.TypedProtocol.Peer.Server</a> APIs.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ReflClientAgency" class="def">ReflClientAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> r r</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:ReflServerAgency" class="def">ReflServerAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> r r</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:ReflNobodyAgency" class="def">ReflNobodyAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a> r r</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:WeHaveAgencyProof" class="def">WeHaveAgencyProof</a> pr st = <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="Network-TypedProtocol-Core.html#v:WeHaveAgency" title="Network.TypedProtocol.Core">WeHaveAgency</a> (<a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> pr (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st)) <a href="src/Network.TypedProtocol.Core.html#WeHaveAgencyProof" class="link">Source</a> <a href="#t:WeHaveAgencyProof" class="selflink">#</a></p><div class="doc"><p>Type of the proof that we have the agency.</p><p><code><a href="Network-TypedProtocol-Core.html#v:ReflClientAgency" title="Network.TypedProtocol.Core">ReflClientAgency</a></code> has this type only iff `<code><a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a></code> st ~ <code>ClientAgency'</code>
 and `pr ~ <code>AsClient'</code>.</p><p><code><a href="Network-TypedProtocol-Core.html#v:ReflServerAgency" title="Network.TypedProtocol.Core">ReflServerAgency</a></code> has this type only iff `<code><a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a></code> st ~ <code>ServerAgency'</code>
 and `pr ~ <code>AsServer'</code></p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:TheyHaveAgencyProof" class="def">TheyHaveAgencyProof</a> pr st = <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="Network-TypedProtocol-Core.html#v:TheyHaveAgency" title="Network.TypedProtocol.Core">TheyHaveAgency</a> (<a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> pr (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st)) <a href="src/Network.TypedProtocol.Core.html#TheyHaveAgencyProof" class="link">Source</a> <a href="#t:TheyHaveAgencyProof" class="selflink">#</a></p><div class="doc"><p>Type of the proof that the remote side has the agency.</p><p><code><a href="Network-TypedProtocol-Core.html#v:ReflClientAgency" title="Network.TypedProtocol.Core">ReflClientAgency</a></code> has this type only iff `<code><a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a></code> st ~ <code>ClientAgency'</code>
 and `pr ~ <code>AsServer'</code>.</p><p><code><a href="Network-TypedProtocol-Core.html#v:ReflServerAgency" title="Network.TypedProtocol.Core">ReflServerAgency</a></code> has this type only iff `<code><a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a></code> st ~ <code>ServerAgency'</code>
 and `pr ~ <code>AsClient'</code></p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:NobodyHasAgencyProof" class="def">NobodyHasAgencyProof</a> pr st = <a href="Network-TypedProtocol-Core.html#t:ReflRelativeAgency" title="Network.TypedProtocol.Core">ReflRelativeAgency</a> (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="Network-TypedProtocol-Core.html#v:NobodyHasAgency" title="Network.TypedProtocol.Core">NobodyHasAgency</a> (<a href="Network-TypedProtocol-Core.html#t:Relative" title="Network.TypedProtocol.Core">Relative</a> pr (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st)) <a href="src/Network.TypedProtocol.Core.html#NobodyHasAgencyProof" class="link">Source</a> <a href="#t:NobodyHasAgencyProof" class="selflink">#</a></p><div class="doc"><p>Type of the proof that nobody has agency in this state.</p><p>Only <code><a href="Network-TypedProtocol-Core.html#v:ReflNobodyAgency" title="Network.TypedProtocol.Core">ReflNobodyAgency</a></code> can fulfil the proof obligation.</p></div></div><a href="#g:6" id="g:6"><h3>FlipAgency</h3></a><div class="top"><p class="src"><span class="keyword">type family</span> <a id="t:FlipAgency" class="def">FlipAgency</a> pr <span class="keyword">where ...</span> <a href="src/Network.TypedProtocol.Core.html#FlipAgency" class="link">Source</a> <a href="#t:FlipAgency" class="selflink">#</a></p><div class="doc"><p>A type function to flip the client and server roles.</p></div><div class="subs equations"><p class="caption">Equations</p><table><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:FlipAgency" title="Network.TypedProtocol.Core">FlipAgency</a> <a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a> = <a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:FlipAgency" title="Network.TypedProtocol.Core">FlipAgency</a> <a href="Network-TypedProtocol-Core.html#v:AsServer" title="Network.TypedProtocol.Core">AsServer</a> = <a href="Network-TypedProtocol-Core.html#v:AsClient" title="Network.TypedProtocol.Core">AsClient</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><a href="#g:7" id="g:7"><h3>ActiveState</h3></a><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:IsActiveState" class="def">IsActiveState</a> st (agency :: <a href="Network-TypedProtocol-Core.html#t:Agency" title="Network.TypedProtocol.Core">Agency</a>) <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#IsActiveState" class="link">Source</a> <a href="#t:IsActiveState" class="selflink">#</a></p><div class="doc"><p>A type class which restricts states to ones that have <code><a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></code> or
 <code><a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></code>, excluding <code><a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a></code>.</p><p>One can use <code>notActive</code> to eliminate cases for which both <code><code><a href="Network-TypedProtocol-Core.html#t:IsActiveState" title="Network.TypedProtocol.Core">IsActiveState</a></code>
 st</code> is in scope and for which we have an evidence that the state is not
 active (i.e. a singleton).  This is useful when writing a <code>Codec</code>.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:activeAgency" class="def">activeAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st agency <a href="src/Network.TypedProtocol.Core.html#activeAgency" class="link">Source</a> <a href="#v:activeAgency" class="selflink">#</a></p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:IsActiveState">Instances</h4><details id="i:IsActiveState" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:IsActiveState:IsActiveState:1"></span> '<a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st =&gt; <a href="Network-TypedProtocol-Core.html#t:IsActiveState" title="Network.TypedProtocol.Core">IsActiveState</a> (st :: ps) '<a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></span> <a href="src/Network.TypedProtocol.Core.html#line-461" class="link">Source</a> <a href="#t:IsActiveState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:IsActiveState:IsActiveState:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:activeAgency">activeAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st '<a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> <a href="src/Network.TypedProtocol.Core.html#activeAgency" class="link">Source</a> <a href="#v:activeAgency" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:ic:IsActiveState:IsActiveState:2"></span> '<a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st =&gt; <a href="Network-TypedProtocol-Core.html#t:IsActiveState" title="Network.TypedProtocol.Core">IsActiveState</a> (st :: ps) '<a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></span> <a href="src/Network.TypedProtocol.Core.html#line-464" class="link">Source</a> <a href="#t:IsActiveState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:ic:IsActiveState:IsActiveState:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:activeAgency">activeAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st '<a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> <a href="src/Network.TypedProtocol.Core.html#activeAgency" class="link">Source</a> <a href="#v:activeAgency" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ActiveState" class="def">ActiveState</a> st = <a href="Network-TypedProtocol-Core.html#t:IsActiveState" title="Network.TypedProtocol.Core">IsActiveState</a> st (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="src/Network.TypedProtocol.Core.html#ActiveState" class="link">Source</a> <a href="#t:ActiveState" class="selflink">#</a></p><div class="doc"><p>A constraint which provides an evidence that the protocol isn't in
 a terminal state.</p></div></div><div class="top"><p class="src"><a id="v:notActiveState" class="def">notActiveState</a> :: <span class="keyword">forall</span> ps (st :: ps). <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a> =&gt; <a href="Network-TypedProtocol-Core.html#t:ActiveState" title="Network.TypedProtocol.Core">ActiveState</a> st =&gt; <a href="Network-TypedProtocol-Core.html#t:StateToken" title="Network.TypedProtocol.Core">StateToken</a> st -&gt; <span class="keyword">forall</span> a. a <a href="src/Network.TypedProtocol.Core.html#notActiveState" class="link">Source</a> <a href="#v:notActiveState" class="selflink">#</a></p><div class="doc"><p>This is useful function to eliminate cases where the `ActiveState st` is
 provided but we are given a state in which neither side has agency
 (<code><a href="Network-TypedProtocol-Core.html#v:NobodyAgency" title="Network.TypedProtocol.Core">NobodyAgency</a></code>).  For example when writing a codec, we only need to encode
 / decode messages which are in active states, but to make such functions
 total, <code><a href="Network-TypedProtocol-Core.html#v:notActiveState" title="Network.TypedProtocol.Core">notActiveState</a></code> needs to be used to eliminate the states in which
 nobody has agency.</p><p>A good analogy for this function is <code><code><a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Void.html#v:absurd" title="Data.Void">absurd</a></code> :: <code>Void</code> -&gt; a</code>.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ActiveAgency" class="def">ActiveAgency</a> st = <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st (<a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st) <a href="src/Network.TypedProtocol.Core.html#ActiveAgency" class="link">Source</a> <a href="#t:ActiveAgency" class="selflink">#</a></p><div class="doc"><p>Evidence that the protocol isn't in a terminal state.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ActiveAgency-39-" class="def">ActiveAgency'</a> st agency <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#ActiveAgency%27" class="link">Source</a> <a href="#t:ActiveAgency-39-" class="selflink">#</a></p><div class="doc"><p>Evidence that one side of the protocol has the agency, and thus that the
 protocol hasn't yet terminated.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ClientHasAgency" class="def">ClientHasAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a> =&gt; <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st <a href="Network-TypedProtocol-Core.html#v:ClientAgency" title="Network.TypedProtocol.Core">ClientAgency</a></td><td class="doc"><p>Evidence that the client has the agency.</p></td></tr><tr><td class="src"><a id="v:ServerHasAgency" class="def">ServerHasAgency</a> :: <a href="Network-TypedProtocol-Core.html#t:StateAgency" title="Network.TypedProtocol.Core">StateAgency</a> st <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a> =&gt; <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st <a href="Network-TypedProtocol-Core.html#v:ServerAgency" title="Network.TypedProtocol.Core">ServerAgency</a></td><td class="doc"><p>Evidence that the server has the agency.</p></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:ActiveAgency-39-">Instances</h4><details id="i:ActiveAgency-39-" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ActiveAgency-39-:Show:1"></span> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st agency)</span> <a href="src/Network.TypedProtocol.Core.html#line-443" class="link">Source</a> <a href="#t:ActiveAgency-39-" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ActiveAgency-39-:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st agency -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st agency -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Network-TypedProtocol-Core.html#t:ActiveAgency-39-" title="Network.TypedProtocol.Core">ActiveAgency'</a> st agency] -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:8" id="g:8"><h2>Pipelining</h2></a><a href="#g:9" id="g:9"><h3>IsPipelined</h3></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:IsPipelined" class="def">IsPipelined</a> <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#IsPipelined" class="link">Source</a> <a href="#t:IsPipelined" class="selflink">#</a></p><div class="doc"><p>Promoted data type which indicates if <code>Peer</code> is used in
 pipelined mode or not.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Pipelined" class="def">Pipelined</a> :: <a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a> -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:IsPipelined" title="Network.TypedProtocol.Core">IsPipelined</a></td><td class="doc"><p>Pipelined peer which is using `c :: Type` for collecting responses
 from a pipelined messages. <code><a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a></code> indicates depth of pipelining.</p></td></tr><tr><td class="src"><a id="v:NonPipelined" class="def">NonPipelined</a> :: <a href="Network-TypedProtocol-Core.html#t:IsPipelined" title="Network.TypedProtocol.Core">IsPipelined</a></td><td class="doc"><p>Non-pipelined peer.</p></td></tr></table></div></div><a href="#g:10" id="g:10"><h3>Outstanding</h3></a><div class="top"><p class="src"><span class="keyword">type family</span> <a id="t:Outstanding" class="def">Outstanding</a> pl <span class="keyword">where ...</span> <a href="src/Network.TypedProtocol.Core.html#Outstanding" class="link">Source</a> <a href="#t:Outstanding" class="selflink">#</a></p><div class="doc"><p>Type level count of the number of outstanding pipelined yields for which
 we have not yet collected a receiver result. Used to
 ensure that <code>Collect</code> is only used when there are outstanding results to
 collect (e.g. after <code>YieldPipeliend</code> was used);
 and to ensure that the non-pipelined primitives <code>Yield</code>, <code>Await</code> and <code>Done</code>
 are only used when there are none unsatisfied pipelined requests.</p></div><div class="subs equations"><p class="caption">Equations</p><table><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Outstanding" title="Network.TypedProtocol.Core">Outstanding</a> '<a href="Network-TypedProtocol-Core.html#v:NonPipelined" title="Network.TypedProtocol.Core">NonPipelined</a> = <a href="Network-TypedProtocol-Core.html#v:Z" title="Network.TypedProtocol.Core">Z</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Network-TypedProtocol-Core.html#t:Outstanding" title="Network.TypedProtocol.Core">Outstanding</a> ('<a href="Network-TypedProtocol-Core.html#v:Pipelined" title="Network.TypedProtocol.Core">Pipelined</a> n _) = n</td><td class="doc empty">&nbsp;</td></tr></table></div></div><a href="#g:11" id="g:11"><h3>N and Nat</h3></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:N" class="def">N</a> <a href="src/Network.TypedProtocol.Core.html#N" class="link">Source</a> <a href="#t:N" class="selflink">#</a></p><div class="doc"><p>A type level inductive natural number.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Z" class="def">Z</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:S" class="def">S</a> <a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Nat" class="def">Nat</a> (n :: <a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a>) <span class="keyword">where</span> <a href="src/Network.TypedProtocol.Core.html#Nat" class="link">Source</a> <a href="#t:Nat" class="selflink">#</a></p><div class="doc"><p>A value level inductive natural number, indexed by the corresponding type
 level natural number <code><a href="Network-TypedProtocol-Core.html#t:N" title="Network.TypedProtocol.Core">N</a></code>.</p><p>This is often needed when writing pipelined peers to be able to count the
 number of outstanding pipelined yields, and show to the type checker that
 <code><a href="Network-TypedProtocol-Peer.html#v:Collect" title="Network.TypedProtocol.Peer">Collect</a></code> and <code><a href="Network-TypedProtocol-Peer.html#v:Done" title="Network.TypedProtocol.Peer">Done</a></code>
 are being used correctly.</p></div><div class="subs bundled-patterns"><p class="caption">Bundled Patterns</p><table><tr><td class="src"><span class="keyword">pattern</span> <a id="v:Succ" class="def">Succ</a> :: () =&gt; m <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> <a href="Network-TypedProtocol-Core.html#v:S" title="Network.TypedProtocol.Core">S</a> n =&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n -&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">pattern</span> <a id="v:Zero" class="def">Zero</a> :: () =&gt; <a href="Network-TypedProtocol-Core.html#v:Z" title="Network.TypedProtocol.Core">Z</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Type-Equality.html#t:-126-" title="Data.Type.Equality">~</a> n =&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Nat">Instances</h4><details id="i:Nat" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Nat:Show:1"></span> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n)</span> <a href="src/Network.TypedProtocol.Core.html#line-536" class="link">Source</a> <a href="#t:Nat" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Nat:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Network-TypedProtocol-Core.html">Network.TypedProtocol.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n] -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:natToInt" class="def">natToInt</a> :: <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n -&gt; <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Network.TypedProtocol.Core.html#natToInt" class="link">Source</a> <a href="#v:natToInt" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:unsafeIntToNat" class="def">unsafeIntToNat</a> :: <a href="file:///nix/store/q976m622jbq42nf9zkhq5axjca5xj9w0-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Network-TypedProtocol-Core.html#t:Nat" title="Network.TypedProtocol.Core">Nat</a> n <a href="src/Network.TypedProtocol.Core.html#unsafeIntToNat" class="link">Source</a> <a href="#v:unsafeIntToNat" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>