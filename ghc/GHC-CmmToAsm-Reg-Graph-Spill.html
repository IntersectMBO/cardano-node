<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.CmmToAsm.Reg.Graph.Spill</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.7: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.CmmToAsm.Reg.Graph.Spill.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.CmmToAsm.Reg.Graph.Spill</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>When there aren't enough registers to hold all the vregs we have to spill
   some of those vregs to slots on the stack. This module is used modify the
   code to use those slots.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:regSpill">regSpill</a> :: <a href="GHC-CmmToAsm-Instr.html#t:Instruction" title="GHC.CmmToAsm.Instr">Instruction</a> instr =&gt; <a href="GHC-Platform.html#t:Platform" title="GHC.Platform">Platform</a> -&gt; [<a href="GHC-CmmToAsm-Reg-Liveness.html#t:LiveCmmDecl" title="GHC.CmmToAsm.Reg.Liveness">LiveCmmDecl</a> statics instr] -&gt; <a href="GHC-Types-Unique-Set.html#t:UniqSet" title="GHC.Types.Unique.Set">UniqSet</a> <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a> -&gt; <a href="GHC-Types-Unique-Set.html#t:UniqSet" title="GHC.Types.Unique.Set">UniqSet</a> <a href="GHC-Platform-Reg.html#t:VirtualReg" title="GHC.Platform.Reg">VirtualReg</a> -&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> ([<a href="GHC-CmmToAsm-Reg-Liveness.html#t:LiveCmmDecl" title="GHC.CmmToAsm.Reg.Liveness">LiveCmmDecl</a> statics instr], <a href="GHC-Types-Unique-Set.html#t:UniqSet" title="GHC.Types.Unique.Set">UniqSet</a> <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-CmmToAsm-Reg-Graph-Spill.html#t:SpillStats" title="GHC.CmmToAsm.Reg.Graph.Spill">SpillStats</a>)</li><li class="src short"><span class="keyword">data</span> <a href="#t:SpillStats">SpillStats</a> = <a href="#v:SpillStats">SpillStats</a> {<ul class="subs"><li><a href="#v:spillStoreLoad">spillStoreLoad</a> :: <a href="GHC-Types-Unique-FM.html#t:UniqFM" title="GHC.Types.Unique.FM">UniqFM</a> <a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a> (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>)</li></ul>}</li><li class="src short"><a href="#v:accSpillSL">accSpillSL</a> :: (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>) -&gt; (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>) -&gt; (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:regSpill" class="def">regSpill</a> <a href="src/GHC.CmmToAsm.Reg.Graph.Spill.html#regSpill" class="link">Source</a> <a href="#v:regSpill" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="GHC-CmmToAsm-Instr.html#t:Instruction" title="GHC.CmmToAsm.Instr">Instruction</a> instr</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="GHC-Platform.html#t:Platform" title="GHC.Platform">Platform</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; [<a href="GHC-CmmToAsm-Reg-Liveness.html#t:LiveCmmDecl" title="GHC.CmmToAsm.Reg.Liveness">LiveCmmDecl</a> statics instr]</td><td class="doc"><p>the code</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Unique-Set.html#t:UniqSet" title="GHC.Types.Unique.Set">UniqSet</a> <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a></td><td class="doc"><p>available stack slots</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a></td><td class="doc"><p>current number of spill slots.</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Unique-Set.html#t:UniqSet" title="GHC.Types.Unique.Set">UniqSet</a> <a href="GHC-Platform-Reg.html#t:VirtualReg" title="GHC.Platform.Reg">VirtualReg</a></td><td class="doc"><p>the regs to spill</p></td></tr><tr><td class="src">-&gt; <a href="GHC-Types-Unique-Supply.html#t:UniqSM" title="GHC.Types.Unique.Supply">UniqSM</a> ([<a href="GHC-CmmToAsm-Reg-Liveness.html#t:LiveCmmDecl" title="GHC.CmmToAsm.Reg.Liveness">LiveCmmDecl</a> statics instr], <a href="GHC-Types-Unique-Set.html#t:UniqSet" title="GHC.Types.Unique.Set">UniqSet</a> <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-CmmToAsm-Reg-Graph-Spill.html#t:SpillStats" title="GHC.CmmToAsm.Reg.Graph.Spill">SpillStats</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Spill all these virtual regs to stack slots.</p><p>Bumps the number of required stack slots if required.</p><p>TODO: See if we can split some of the live ranges instead of just globally
         spilling the virtual reg. This might make the spill cleaner's job easier.</p><p>TODO: On CISCy x86 and x86_64 we don't necessarily have to add a mov instruction
         when making spills. If an instr is using a spilled virtual we may be able to
         address the spill slot directly.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SpillStats" class="def">SpillStats</a> <a href="src/GHC.CmmToAsm.Reg.Graph.Spill.html#SpillStats" class="link">Source</a> <a href="#t:SpillStats" class="selflink">#</a></p><div class="doc"><p>Spiller statistics.
   Tells us what registers were spilled.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SpillStats" class="def">SpillStats</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:spillStoreLoad" class="def">spillStoreLoad</a> :: <a href="GHC-Types-Unique-FM.html#t:UniqFM" title="GHC.Types.Unique.FM">UniqFM</a> <a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a> (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:SpillStats">Instances</h4><details id="i:SpillStats" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:SpillStats:Outputable:1"></span> <a href="GHC-Utils-Outputable.html#t:Outputable" title="GHC.Utils.Outputable">Outputable</a> <a href="GHC-CmmToAsm-Reg-Graph-Spill.html#t:SpillStats" title="GHC.CmmToAsm.Reg.Graph.Spill">SpillStats</a></span> <a href="src/GHC.CmmToAsm.Reg.Graph.Spill.html#line-378" class="link">Source</a> <a href="#t:SpillStats" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:SpillStats:Outputable:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="GHC-CmmToAsm-Reg-Graph-Spill.html">GHC.CmmToAsm.Reg.Graph.Spill</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="GHC-CmmToAsm-Reg-Graph-Spill.html#t:SpillStats" title="GHC.CmmToAsm.Reg.Graph.Spill">SpillStats</a> -&gt; <a href="GHC-Utils-Outputable.html#t:SDoc" title="GHC.Utils.Outputable">SDoc</a> <a href="src/GHC.Utils.Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:accSpillSL" class="def">accSpillSL</a> :: (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>) -&gt; (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>) -&gt; (<a href="GHC-Platform-Reg.html#t:Reg" title="GHC.Platform.Reg">Reg</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>, <a href="GHC-Prelude-Basic.html#t:Int" title="GHC.Prelude.Basic">Int</a>) <a href="src/GHC.CmmToAsm.Reg.Graph.Spill.html#accSpillSL" class="link">Source</a> <a href="#v:accSpillSL" class="selflink">#</a></p><div class="doc"><p>Add a spill/reload count to a stats record for a register.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>