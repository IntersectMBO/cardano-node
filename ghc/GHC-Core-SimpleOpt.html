<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>GHC.Core.SimpleOpt</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ghc-9.6.7: The GHC API</span><ul class="links" id="page-menu"><li><a href="src/GHC.Core.SimpleOpt.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">GHC.Core.SimpleOpt</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Simple expression optimiser</a></li><li><a href="#g:2">Join points</a></li><li><a href="#g:3">Predicates on expressions</a></li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:SimpleOpts">SimpleOpts</a> = <a href="#v:SimpleOpts">SimpleOpts</a> {<ul class="subs"><li><a href="#v:so_uf_opts">so_uf_opts</a> :: !<a href="GHC-Core-Unfold.html#t:UnfoldingOpts" title="GHC.Core.Unfold">UnfoldingOpts</a></li><li><a href="#v:so_co_opts">so_co_opts</a> :: !<a href="GHC-Core-Coercion-Opt.html#t:OptCoercionOpts" title="GHC.Core.Coercion.Opt">OptCoercionOpts</a></li><li><a href="#v:so_eta_red">so_eta_red</a> :: !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></li></ul>}</li><li class="src short"><a href="#v:defaultSimpleOpts">defaultSimpleOpts</a> :: <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a></li><li class="src short"><a href="#v:simpleOptPgm">simpleOptPgm</a> :: <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a> -&gt; <a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a> -&gt; <a href="GHC-Core.html#t:CoreProgram" title="GHC.Core">CoreProgram</a> -&gt; [<a href="GHC-Core.html#t:CoreRule" title="GHC.Core">CoreRule</a>] -&gt; (<a href="GHC-Core.html#t:CoreProgram" title="GHC.Core">CoreProgram</a>, [<a href="GHC-Core.html#t:CoreRule" title="GHC.Core">CoreRule</a>], <a href="GHC-Core.html#t:CoreProgram" title="GHC.Core">CoreProgram</a>)</li><li class="src short"><a href="#v:simpleOptExpr">simpleOptExpr</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a></li><li class="src short"><a href="#v:simpleOptExprWith">simpleOptExprWith</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a> -&gt; <a href="GHC-Core-TyCo-Subst.html#t:Subst" title="GHC.Core.TyCo.Subst">Subst</a> -&gt; <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a> -&gt; <a href="GHC-Core.html#t:OutExpr" title="GHC.Core">OutExpr</a></li><li class="src short"><a href="#v:joinPointBinding_maybe">joinPointBinding_maybe</a> :: <a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a> -&gt; <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> (<a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a>, <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a>)</li><li class="src short"><a href="#v:joinPointBindings_maybe">joinPointBindings_maybe</a> :: [(<a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a>, <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a>)] -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> [(<a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a>, <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a>)]</li><li class="src short"><a href="#v:exprIsConApp_maybe">exprIsConApp_maybe</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core.html#t:InScopeEnv" title="GHC.Core">InScopeEnv</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> (<a href="GHC-Types-Var-Env.html#t:InScopeSet" title="GHC.Types.Var.Env">InScopeSet</a>, [<a href="GHC-Core-Make.html#t:FloatBind" title="GHC.Core.Make">FloatBind</a>], <a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a>, [<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>], [<a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>])</li><li class="src short"><a href="#v:exprIsLiteral_maybe">exprIsLiteral_maybe</a> :: <a href="GHC-Core.html#t:InScopeEnv" title="GHC.Core">InScopeEnv</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Types-Literal.html#t:Literal" title="GHC.Types.Literal">Literal</a></li><li class="src short"><a href="#v:exprIsLambda_maybe">exprIsLambda_maybe</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core.html#t:InScopeEnv" title="GHC.Core">InScopeEnv</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> (<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>, <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>, [<a href="GHC-Types-Tickish.html#t:CoreTickish" title="GHC.Types.Tickish">CoreTickish</a>])</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:SimpleOpts" class="def">SimpleOpts</a> <a href="src/GHC.Core.SimpleOpt.html#SimpleOpts" class="link">Source</a> <a href="#t:SimpleOpts" class="selflink">#</a></p><div class="doc"><p>Simple optimiser options</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SimpleOpts" class="def">SimpleOpts</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:so_uf_opts" class="def">so_uf_opts</a> :: !<a href="GHC-Core-Unfold.html#t:UnfoldingOpts" title="GHC.Core.Unfold">UnfoldingOpts</a></dfn><div class="doc"><p>Unfolding options</p></div></li><li><dfn class="src"><a id="v:so_co_opts" class="def">so_co_opts</a> :: !<a href="GHC-Core-Coercion-Opt.html#t:OptCoercionOpts" title="GHC.Core.Coercion.Opt">OptCoercionOpts</a></dfn><div class="doc"><p>Coercion optimiser options</p></div></li><li><dfn class="src"><a id="v:so_eta_red" class="def">so_eta_red</a> :: !<a href="GHC-Prelude-Basic.html#t:Bool" title="GHC.Prelude.Basic">Bool</a></dfn><div class="doc"><p>Eta reduction on?</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:defaultSimpleOpts" class="def">defaultSimpleOpts</a> :: <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a> <a href="src/GHC.Core.SimpleOpt.html#defaultSimpleOpts" class="link">Source</a> <a href="#v:defaultSimpleOpts" class="selflink">#</a></p><div class="doc"><p>Default options for the Simple optimiser.</p></div></div><a href="#g:1" id="g:1"><h2>Simple expression optimiser</h2></a><div class="top"><p class="src"><a id="v:simpleOptPgm" class="def">simpleOptPgm</a> :: <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a> -&gt; <a href="GHC-Unit-Types.html#t:Module" title="GHC.Unit.Types">Module</a> -&gt; <a href="GHC-Core.html#t:CoreProgram" title="GHC.Core">CoreProgram</a> -&gt; [<a href="GHC-Core.html#t:CoreRule" title="GHC.Core">CoreRule</a>] -&gt; (<a href="GHC-Core.html#t:CoreProgram" title="GHC.Core">CoreProgram</a>, [<a href="GHC-Core.html#t:CoreRule" title="GHC.Core">CoreRule</a>], <a href="GHC-Core.html#t:CoreProgram" title="GHC.Core">CoreProgram</a>) <a href="src/GHC.Core.SimpleOpt.html#simpleOptPgm" class="link">Source</a> <a href="#v:simpleOptPgm" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:simpleOptExpr" class="def">simpleOptExpr</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> <a href="src/GHC.Core.SimpleOpt.html#simpleOptExpr" class="link">Source</a> <a href="#v:simpleOptExpr" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:simpleOptExprWith" class="def">simpleOptExprWith</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core-SimpleOpt.html#t:SimpleOpts" title="GHC.Core.SimpleOpt">SimpleOpts</a> -&gt; <a href="GHC-Core-TyCo-Subst.html#t:Subst" title="GHC.Core.TyCo.Subst">Subst</a> -&gt; <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a> -&gt; <a href="GHC-Core.html#t:OutExpr" title="GHC.Core">OutExpr</a> <a href="src/GHC.Core.SimpleOpt.html#simpleOptExprWith" class="link">Source</a> <a href="#v:simpleOptExprWith" class="selflink">#</a></p></div><a href="#g:2" id="g:2"><h2>Join points</h2></a><div class="top"><p class="src"><a id="v:joinPointBinding_maybe" class="def">joinPointBinding_maybe</a> :: <a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a> -&gt; <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> (<a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a>, <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a>) <a href="src/GHC.Core.SimpleOpt.html#joinPointBinding_maybe" class="link">Source</a> <a href="#v:joinPointBinding_maybe" class="selflink">#</a></p><div class="doc"><p>Returns Just (bndr,rhs) if the binding is a join point:
 If it's a JoinId, just return it
 If it's not yet a JoinId but is always tail-called,
    make it into a JoinId and return it.
 In the latter case, eta-expand the RHS if necessary, to make the
 lambdas explicit, as is required for join points</p><p>Precondition: the InBndr has been occurrence-analysed,
               so its OccInfo is valid</p></div></div><div class="top"><p class="src"><a id="v:joinPointBindings_maybe" class="def">joinPointBindings_maybe</a> :: [(<a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a>, <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a>)] -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> [(<a href="GHC-Core.html#t:InBndr" title="GHC.Core">InBndr</a>, <a href="GHC-Core.html#t:InExpr" title="GHC.Core">InExpr</a>)] <a href="src/GHC.Core.SimpleOpt.html#joinPointBindings_maybe" class="link">Source</a> <a href="#v:joinPointBindings_maybe" class="selflink">#</a></p></div><a href="#g:3" id="g:3"><h2>Predicates on expressions</h2></a><div class="top"><p class="src"><a id="v:exprIsConApp_maybe" class="def">exprIsConApp_maybe</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core.html#t:InScopeEnv" title="GHC.Core">InScopeEnv</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> (<a href="GHC-Types-Var-Env.html#t:InScopeSet" title="GHC.Types.Var.Env">InScopeSet</a>, [<a href="GHC-Core-Make.html#t:FloatBind" title="GHC.Core.Make">FloatBind</a>], <a href="GHC-Core-DataCon.html#t:DataCon" title="GHC.Core.DataCon">DataCon</a>, [<a href="GHC-Core-Type.html#t:Type" title="GHC.Core.Type">Type</a>], [<a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>]) <a href="src/GHC.Core.SimpleOpt.html#exprIsConApp_maybe" class="link">Source</a> <a href="#v:exprIsConApp_maybe" class="selflink">#</a></p><div class="doc"><p>Returns <code>Just ([b1..bp], dc, [t1..tk], [x1..xn])</code> if the argument
 expression is a *saturated* constructor application of the form <code>let b1 in
 .. let bp in dc t1..tk x1 .. xn</code>, where t1..tk are the
 *universally-quantified* type args of <code>dc</code>. Floats can also be (and most
 likely are) single-alternative case expressions. Why does
 <code><a href="GHC-Core-SimpleOpt.html#v:exprIsConApp_maybe" title="GHC.Core.SimpleOpt">exprIsConApp_maybe</a></code> return floats? We may have to look through lets and
 cases to detect that we are in the presence of a data constructor wrapper. In
 this case, we need to return the lets and cases that we traversed. See Note
 [exprIsConApp_maybe on data constructors with wrappers]. Data constructor wrappers
 are unfolded late, but we really want to trigger case-of-known-constructor as
 early as possible. See also Note [Activation for data constructor wrappers]
 in <a href="GHC-Types-Id-Make.html">GHC.Types.Id.Make</a>.</p><p>We also return the incoming InScopeSet, augmented with
 the binders from any [FloatBind] that we return</p></div></div><div class="top"><p class="src"><a id="v:exprIsLiteral_maybe" class="def">exprIsLiteral_maybe</a> :: <a href="GHC-Core.html#t:InScopeEnv" title="GHC.Core">InScopeEnv</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> <a href="GHC-Types-Literal.html#t:Literal" title="GHC.Types.Literal">Literal</a> <a href="src/GHC.Core.SimpleOpt.html#exprIsLiteral_maybe" class="link">Source</a> <a href="#v:exprIsLiteral_maybe" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:exprIsLambda_maybe" class="def">exprIsLambda_maybe</a> :: <a href="GHC-Utils-Misc.html#t:HasDebugCallStack" title="GHC.Utils.Misc">HasDebugCallStack</a> =&gt; <a href="GHC-Core.html#t:InScopeEnv" title="GHC.Core">InScopeEnv</a> -&gt; <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a> -&gt; <a href="GHC-Prelude-Basic.html#t:Maybe" title="GHC.Prelude.Basic">Maybe</a> (<a href="GHC-Types-Var.html#t:Var" title="GHC.Types.Var">Var</a>, <a href="GHC-Core.html#t:CoreExpr" title="GHC.Core">CoreExpr</a>, [<a href="GHC-Types-Tickish.html#t:CoreTickish" title="GHC.Types.Tickish">CoreTickish</a>]) <a href="src/GHC.Core.SimpleOpt.html#exprIsLambda_maybe" class="link">Source</a> <a href="#v:exprIsLambda_maybe" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.29.2</p></div></body></html>