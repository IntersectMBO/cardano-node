<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- (c) The University of Glasgow, 2006</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables, BangPatterns, FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="annot"><span class="hs-comment">-- | Unit manipulation</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Unit.State</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-9"></span><span>        </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html"><span class="hs-identifier">GHC.Unit.Info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Reading the package config, and processing cmdline args</span></span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier">UnitState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier">PreloadUnitClosure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier">UnitDatabase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier">UnitErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#emptyUnitState"><span class="hs-identifier">emptyUnitState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#initUnits"><span class="hs-identifier">initUnits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#readUnitDatabases"><span class="hs-identifier">readUnitDatabases</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#readUnitDatabase"><span class="hs-identifier">readUnitDatabase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#getUnitDbRefs"><span class="hs-identifier">getUnitDbRefs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#resolveUnitDatabase"><span class="hs-identifier">resolveUnitDatabase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#listUnitInfo"><span class="hs-identifier">listUnitInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Querying the package config</span></span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier">UnitInfoMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier">lookupUnit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupUnit%27"><span class="hs-identifier">lookupUnit'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#unsafeLookupUnit"><span class="hs-identifier">unsafeLookupUnit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupUnitId"><span class="hs-identifier">lookupUnitId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupUnitId%27"><span class="hs-identifier">lookupUnitId'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#unsafeLookupUnitId"><span class="hs-identifier">unsafeLookupUnitId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupPackageName"><span class="hs-identifier">lookupPackageName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#resolvePackageImport"><span class="hs-identifier">resolvePackageImport</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#improveUnit"><span class="hs-identifier">improveUnit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#searchPackageId"><span class="hs-identifier">searchPackageId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#listVisibleModuleNames"><span class="hs-identifier">listVisibleModuleNames</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupModuleInAllUnits"><span class="hs-identifier">lookupModuleInAllUnits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupModuleWithSuggestions"><span class="hs-identifier">lookupModuleWithSuggestions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupModulePackage"><span class="hs-identifier">lookupModulePackage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#lookupPluginModuleWithSuggestions"><span class="hs-identifier">lookupPluginModuleWithSuggestions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#requirementMerges"><span class="hs-identifier">requirementMerges</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#LookupResult"><span class="hs-identifier">LookupResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#ModuleSuggestion"><span class="hs-identifier">ModuleSuggestion</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier">ModuleOrigin</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnit"><span class="hs-identifier">UnusableUnit</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier">UnusableUnitReason</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprReason"><span class="hs-identifier">pprReason</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#closeUnitDeps"><span class="hs-identifier">closeUnitDeps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#closeUnitDeps%27"><span class="hs-identifier">closeUnitDeps'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier">mayThrowUnitErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Module hole substitution</span></span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#ShHoleSubst"><span class="hs-identifier">ShHoleSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#renameHoleUnit"><span class="hs-identifier">renameHoleUnit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#renameHoleModule"><span class="hs-identifier">renameHoleModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#renameHoleUnit%27"><span class="hs-identifier">renameHoleUnit'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#renameHoleModule%27"><span class="hs-identifier">renameHoleModule'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#instUnitToUnit"><span class="hs-identifier">instUnitToUnit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#instModuleToModule"><span class="hs-identifier">instModuleToModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Pretty-printing</span></span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprFlag"><span class="hs-identifier">pprFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprUnits"><span class="hs-identifier">pprUnits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprUnitsSimple"><span class="hs-identifier">pprUnitsSimple</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprUnitIdForUser"><span class="hs-identifier">pprUnitIdForUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprUnitInfoForUser"><span class="hs-identifier">pprUnitInfoForUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprModuleMap"><span class="hs-identifier">pprModuleMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#pprWithUnitState"><span class="hs-identifier">pprWithUnitState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Utils</span></span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#unwireUnit"><span class="hs-identifier">unwireUnit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#implicitPackageDeps"><span class="hs-identifier">implicitPackageDeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#/GHC.Unit.Database.html"><span class="hs-identifier">GHC.Unit.Database</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html"><span class="hs-identifier">GHC.Unit.Info</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Ppr.html"><span class="hs-identifier">GHC.Unit.Ppr</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html"><span class="hs-identifier">GHC.Unit.Home</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html"><span class="hs-identifier">GHC.Types.PkgQual</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/System.Environment.html#/System.Environment.html"><span class="hs-identifier">System.Environment</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/System.Environment.html#getEnv/System.Environment.html#getEnv"><span class="hs-identifier">getEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Data.ShortText.html#/GHC.Data.ShortText.html"><span class="hs-identifier">GHC.Data.ShortText</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.8.5/src/System.Directory.html#/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/System.FilePath.html#/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#/Data.Graph.html"><span class="hs-identifier">Data.Graph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#stronglyConnComp/Data.Graph.html#stronglyConnComp"><span class="hs-identifier">stronglyConnComp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier">SCC</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Char.html#/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Unicode.html#toUpper/GHC.Unicode.html#toUpper"><span class="hs-identifier">toUpper</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#intersperse/Data.OldList.html#intersperse"><span class="hs-identifier">intersperse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#partition/Data.OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#sortBy/Data.OldList.html#sortBy"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#isSuffixOf/Data.OldList.html#isSuffixOf"><span class="hs-identifier">isSuffixOf</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.html#/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.html#/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Monoid.html#/Data.Monoid.html"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Monoid.html#First/Data.Monoid.html#First"><span class="hs-identifier">First</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Semigroup.html#/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.html#/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Strict.html#/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MapStrict</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.html#/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.LanguageExtensions.html#/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Applicative.html#/Control.Applicative.html"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- The Unit state</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- The unit state is computed by 'initUnits', and kept in HscEnv.</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- It is influenced by various command-line flags:</span><span>
</span><span id="line-130"></span><span class="hs-comment">--</span><span>
</span><span id="line-131"></span><span class="hs-comment">--   * @-package \&lt;pkg&gt;@ and @-package-id \&lt;pkg&gt;@ cause @\&lt;pkg&gt;@ to become exposed.</span><span>
</span><span id="line-132"></span><span class="hs-comment">--     If @-hide-all-packages@ was not specified, these commands also cause</span><span>
</span><span id="line-133"></span><span class="hs-comment">--      all other packages with the same name to become hidden.</span><span>
</span><span id="line-134"></span><span class="hs-comment">--</span><span>
</span><span id="line-135"></span><span class="hs-comment">--   * @-hide-package \&lt;pkg&gt;@ causes @\&lt;pkg&gt;@ to become hidden.</span><span>
</span><span id="line-136"></span><span class="hs-comment">--</span><span>
</span><span id="line-137"></span><span class="hs-comment">--   * (there are a few more flags, check below for their semantics)</span><span>
</span><span id="line-138"></span><span class="hs-comment">--</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- The unit state has the following properties.</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="hs-comment">--   * Let @exposedUnits@ be the set of packages thus exposed.</span><span>
</span><span id="line-142"></span><span class="hs-comment">--     Let @depExposedUnits@ be the transitive closure from @exposedUnits@ of</span><span>
</span><span id="line-143"></span><span class="hs-comment">--     their dependencies.</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">--   * When searching for a module from a preload import declaration,</span><span>
</span><span id="line-146"></span><span class="hs-comment">--     only the exposed modules in @exposedUnits@ are valid.</span><span>
</span><span id="line-147"></span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span class="hs-comment">--   * When searching for a module from an implicit import, all modules</span><span>
</span><span id="line-149"></span><span class="hs-comment">--     from @depExposedUnits@ are valid.</span><span>
</span><span id="line-150"></span><span class="hs-comment">--</span><span>
</span><span id="line-151"></span><span class="hs-comment">--   * When linking in a compilation manager mode, we link in packages the</span><span>
</span><span id="line-152"></span><span class="hs-comment">--     program depends on (the compiler knows this list by the</span><span>
</span><span id="line-153"></span><span class="hs-comment">--     time it gets to the link step).  Also, we link in all packages</span><span>
</span><span id="line-154"></span><span class="hs-comment">--     which were mentioned with preload @-package@ flags on the command-line,</span><span>
</span><span id="line-155"></span><span class="hs-comment">--     or are a transitive dependency of same, or are \&quot;base\&quot;\/\&quot;rts\&quot;.</span><span>
</span><span id="line-156"></span><span class="hs-comment">--     The reason for this is that we might need packages which don't</span><span>
</span><span id="line-157"></span><span class="hs-comment">--     contain any Haskell modules, and therefore won't be discovered</span><span>
</span><span id="line-158"></span><span class="hs-comment">--     by the normal mechanism of dependency tracking.</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- Notes on DLLs</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- ~~~~~~~~~~~~~</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- When compiling module A, which imports module B, we need to</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- know whether B will be in the same DLL as A.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--      If it's in the same DLL, we refer to B_f_closure</span><span>
</span><span id="line-165"></span><span class="hs-comment">--      If it isn't, we refer to _imp__B_f_closure</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- When compiling A, we record in B's Module value whether it's</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- in a different DLL, by setting the DLL flag.</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- | Given a module name, there may be multiple ways it came into scope,</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- possibly simultaneously.  This data type tracks all the possible ways</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- it could have come into scope.  Warning: don't use the record functions,</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- they're partial!</span><span>
</span><span id="line-173"></span><span class="hs-keyword">data</span><span> </span><span id="ModuleOrigin"><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-var">ModuleOrigin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- | Module is hidden, and thus never will be available for import.</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- (But maybe the user didn't realize), so we'll still keep track</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- of these modules.)</span><span>
</span><span id="line-177"></span><span>    </span><span id="ModHidden"><span class="annot"><a href="GHC.Unit.State.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a></span></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Module is unavailable because the unit is unusable.</span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ModUnusable"><span class="annot"><a href="GHC.Unit.State.html#ModUnusable"><span class="hs-identifier hs-var">ModUnusable</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnit"><span class="hs-identifier hs-type">UnusableUnit</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Module is public, and could have come from some places.</span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ModOrigin"><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- | @Just False@ means that this module is in</span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-comment">-- someone's @exported-modules@ list, but that package is hidden;</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-comment">-- @Just True@ means that it is available; @Nothing@ means neither</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-comment">-- applies.</span><span>
</span><span id="line-188"></span><span>        </span><span id="fromOrigUnit"><span class="annot"><span class="annottext">ModuleOrigin -&gt; Maybe Bool
</span><a href="GHC.Unit.State.html#fromOrigUnit"><span class="hs-identifier hs-var hs-var">fromOrigUnit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-comment">-- | Is the module available from a reexport of an exposed package?</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-comment">-- There could be multiple.</span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="fromExposedReexport"><span class="annot"><span class="annottext">ModuleOrigin -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#fromExposedReexport"><span class="hs-identifier hs-var hs-var">fromExposedReexport</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><span class="hs-comment">-- | Is the module available from a reexport of a hidden package?</span></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="fromHiddenReexport"><span class="annot"><span class="annottext">ModuleOrigin -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#fromHiddenReexport"><span class="hs-identifier hs-var hs-var">fromHiddenReexport</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-comment">-- | Did the module export come from a package flag? (ToDo: track</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-comment">-- more information.</span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="fromPackageFlag"><span class="annot"><span class="annottext">ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#fromPackageFlag"><span class="hs-identifier hs-var hs-var">fromPackageFlag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="annot"><span class="hs-comment">-- | A unusable unit module origin</span></span><span>
</span><span id="line-200"></span><span class="hs-keyword">data</span><span> </span><span id="UnusableUnit"><span class="annot"><a href="GHC.Unit.State.html#UnusableUnit"><span class="hs-identifier hs-var">UnusableUnit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UnusableUnit"><span class="annot"><a href="GHC.Unit.State.html#UnusableUnit"><span class="hs-identifier hs-var">UnusableUnit</span></a></span></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="uuUnit"><span class="annot"><span class="annottext">UnusableUnit -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#uuUnit"><span class="hs-identifier hs-var hs-var">uuUnit</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Unusable unit</span></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="uuReason"><span class="annot"><span class="annottext">UnusableUnit -&gt; UnusableUnitReason
</span><a href="GHC.Unit.State.html#uuReason"><span class="hs-identifier hs-var hs-var">uuReason</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Reason</span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="uuIsReexport"><span class="annot"><span class="annottext">UnusableUnit -&gt; Bool
</span><a href="GHC.Unit.State.html#uuIsReexport"><span class="hs-identifier hs-var hs-var">uuIsReexport</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ Is the &quot;module&quot; a reexport?</span></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>    </span><span id="local-6989586621681679851"><span class="annot"><span class="annottext">ppr :: ModuleOrigin -&gt; SDoc
</span><a href="#local-6989586621681679851"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="GHC.Unit.State.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hidden module&quot;</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ModUnusable"><span class="hs-identifier hs-type">ModUnusable</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unusable module&quot;</span></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span id="local-6989586621681679854"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679854"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681679855"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679855"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621681679856"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679856"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621681679857"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679857"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679854"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hidden package&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;exposed package&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679855"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-215"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reexport by&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-217"></span><span>                    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; SDoc) -&gt; [UnitInfo] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; SDoc)
-&gt; (UnitInfo -&gt; GenUnit UnitId) -&gt; UnitInfo -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679855"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679856"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-220"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hidden reexport by&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-221"></span><span>                    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; SDoc) -&gt; [UnitInfo] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; SDoc)
-&gt; (UnitInfo -&gt; GenUnit UnitId) -&gt; UnitInfo -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679855"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679857"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package flag&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | Smart constructor for a module which is in @exposed-modules@.  Takes</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- as an argument whether or not the defining package is exposed.</span><span>
</span><span id="line-227"></span><span class="annot"><a href="GHC.Unit.State.html#fromExposedModules"><span class="hs-identifier hs-type">fromExposedModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-228"></span><span id="fromExposedModules"><span class="annot"><span class="annottext">fromExposedModules :: Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#fromExposedModules"><span class="hs-identifier hs-var hs-var">fromExposedModules</span></a></span></span><span> </span><span id="local-6989586621681679866"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679866"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; [UnitInfo] -&gt; [UnitInfo] -&gt; Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679866"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | Smart constructor for a module which is in @reexported-modules@.  Takes</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- as an argument whether or not the reexporting package is exposed, and</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- also its 'UnitInfo'.</span><span>
</span><span id="line-233"></span><span class="annot"><a href="GHC.Unit.State.html#fromReexportedModules"><span class="hs-identifier hs-type">fromReexportedModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-234"></span><span id="fromReexportedModules"><span class="annot"><span class="annottext">fromReexportedModules :: Bool -&gt; UnitInfo -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#fromReexportedModules"><span class="hs-identifier hs-var hs-var">fromReexportedModules</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621681679868"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681679868"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; [UnitInfo] -&gt; [UnitInfo] -&gt; Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681679868"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.Unit.State.html#fromReexportedModules"><span class="hs-identifier hs-var">fromReexportedModules</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621681679869"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681679869"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; [UnitInfo] -&gt; [UnitInfo] -&gt; Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681679869"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><span class="hs-comment">-- | Smart constructor for a module which was bound by a package flag.</span></span><span>
</span><span id="line-238"></span><span class="annot"><a href="GHC.Unit.State.html#fromFlag"><span class="hs-identifier hs-type">fromFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-239"></span><span id="fromFlag"><span class="annot"><span class="annottext">fromFlag :: ModuleOrigin
</span><a href="GHC.Unit.State.html#fromFlag"><span class="hs-identifier hs-var hs-var">fromFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; [UnitInfo] -&gt; [UnitInfo] -&gt; Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681679873"><span id="local-6989586621681679877"><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Semigroup/GHC.Base.html#Semigroup"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621681679901"><span class="annot"><span class="annottext">x :: ModuleOrigin
</span><a href="#local-6989586621681679901"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span id="local-6989586621681679902"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679902"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681679903"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679903"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621681679904"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679904"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621681679905"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679905"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681679906"><span class="annot"><span class="annottext">&lt;&gt; :: ModuleOrigin -&gt; ModuleOrigin -&gt; ModuleOrigin
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621681679907"><span class="annot"><span class="annottext">y :: ModuleOrigin
</span><a href="#local-6989586621681679907"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span id="local-6989586621681679908"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679908"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span id="local-6989586621681679909"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679909"><span class="hs-identifier hs-var">res'</span></a></span></span><span> </span><span id="local-6989586621681679910"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679910"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span id="local-6989586621681679911"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679911"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><span class="annottext">Maybe Bool -&gt; [UnitInfo] -&gt; [UnitInfo] -&gt; Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Maybe Bool
</span><a href="#local-6989586621681679912"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679902"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679908"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679903"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679909"><span class="hs-identifier hs-var">res'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679904"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679910"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679905"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679911"><span class="hs-identifier hs-var">f'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681679912"><span class="annot"><span class="annottext">g :: Maybe Bool -&gt; Maybe Bool -&gt; Maybe Bool
</span><a href="#local-6989586621681679912"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681679914"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679914"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681679915"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679915"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679914"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679915"><span class="hs-identifier hs-var">b'</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679914"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-246"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Maybe Bool
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ModOrigin: package both exposed/hidden&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; Maybe Bool) -&gt; SDoc -&gt; Maybe Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-247"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681679901"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;y: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681679907"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><a href="#local-6989586621681679912"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621681679919"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679919"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679919"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-249"></span><span>            </span><span class="annot"><a href="#local-6989586621681679912"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span id="local-6989586621681679920"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679920"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679920"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621681679921"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681679921"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span id="local-6989586621681679922"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681679922"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ModuleOrigin
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ModOrigin: module origin mismatch&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ModuleOrigin) -&gt; SDoc -&gt; ModuleOrigin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-252"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681679921"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;y: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681679922"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681679928"><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Monoid/GHC.Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621681679931"><span class="annot"><span class="annottext">mempty :: ModuleOrigin
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; [UnitInfo] -&gt; [UnitInfo] -&gt; Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-var">ModOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621681679933"><span class="annot"><span class="annottext">mappend :: ModuleOrigin -&gt; ModuleOrigin -&gt; ModuleOrigin
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mappend/GHC.Base.html#mappend"><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; ModuleOrigin -&gt; ModuleOrigin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">(Semigroup.&lt;&gt;)</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- | Is the name from the import actually visible? (i.e. does it cause</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- ambiguity, or is it only relevant when we're making suggestions?)</span><span>
</span><span id="line-260"></span><span class="annot"><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-type">originVisible</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-261"></span><span id="originVisible"><span class="annot"><span class="annottext">originVisible :: ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-var hs-var">originVisible</span></a></span></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="GHC.Unit.State.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-262"></span><span class="annot"><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ModUnusable"><span class="hs-identifier hs-type">ModUnusable</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-263"></span><span class="annot"><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span id="local-6989586621681679935"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679935"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681679936"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679936"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681679937"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679937"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681679935"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681679936"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679937"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- | Are there actually no providers for this module?  This will never occur</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- except when we're filtering based on package imports.</span><span>
</span><span id="line-267"></span><span class="annot"><a href="GHC.Unit.State.html#originEmpty"><span class="hs-identifier hs-type">originEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-268"></span><span id="originEmpty"><span class="annot"><span class="annottext">originEmpty :: ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#originEmpty"><span class="hs-identifier hs-var hs-var">originEmpty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-269"></span><span class="annot"><a href="GHC.Unit.State.html#originEmpty"><span class="hs-identifier hs-var">originEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-keyword">type</span><span> </span><span id="PreloadUnitClosure"><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-var">PreloadUnitClosure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="annot"><span class="hs-comment">-- | 'UniqFM' map from 'Unit' to a 'UnitVisibility'.</span></span><span>
</span><span id="line-274"></span><span class="hs-keyword">type</span><span> </span><span id="VisibilityMap"><span class="annot"><a href="GHC.Unit.State.html#VisibilityMap"><span class="hs-identifier hs-var">VisibilityMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- | 'UnitVisibility' records the various aspects of visibility of a particular</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- 'Unit'.</span><span>
</span><span id="line-278"></span><span class="hs-keyword">data</span><span> </span><span id="UnitVisibility"><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-var">UnitVisibility</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UnitVisibility"><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-var">UnitVisibility</span></a></span></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="uv_expose_all"><span class="annot"><span class="annottext">UnitVisibility -&gt; Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var hs-var">uv_expose_all</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-comment">--  ^ Should all modules in exposed-modules should be dumped into scope?</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="uv_renamings"><span class="annot"><span class="annottext">UnitVisibility -&gt; [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var hs-var">uv_renamings</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-comment">-- ^ Any custom renamings that should bring extra 'ModuleName's into</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-comment">-- scope.</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="uv_package_name"><span class="annot"><span class="annottext">UnitVisibility -&gt; First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var hs-var">uv_package_name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Monoid.html#First/Data.Monoid.html#First"><span class="hs-identifier hs-type">First</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-comment">-- ^ The package name associated with the 'Unit'.  This is used</span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-comment">-- to implement legacy behavior where @-package foo-0.1@ implicitly</span><span>
</span><span id="line-287"></span><span>      </span><span class="hs-comment">-- hides any packages named @foo@</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="uv_requirements"><span class="annot"><span class="annottext">UnitVisibility -&gt; Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var hs-var">uv_requirements</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedModule"><span class="hs-identifier hs-type">InstantiatedModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-comment">-- ^ The signatures which are contributed to the requirements context</span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-comment">-- from this unit ID.</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="uv_explicit"><span class="annot"><span class="annottext">UnitVisibility -&gt; Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var hs-var">uv_explicit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-comment">-- ^ Whether or not this unit was explicitly brought into scope,</span><span>
</span><span id="line-293"></span><span>      </span><span class="hs-comment">-- as opposed to implicitly via the 'exposed' fields in the</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-comment">-- package database (when @-hide-all-packages@ is not passed.)</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621681679969"><span class="annot"><span class="annottext">ppr :: UnitVisibility -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">uv_expose_all :: UnitVisibility -&gt; Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681679970"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679970"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">uv_renamings :: UnitVisibility -&gt; [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681679971"><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681679971"><span class="hs-identifier hs-var">rns</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">uv_package_name :: UnitVisibility -&gt; First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Monoid.html#First/Data.Monoid.html#First"><span class="hs-identifier hs-type">First</span></a></span><span> </span><span id="local-6989586621681679973"><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621681679973"><span class="hs-identifier hs-var">mb_pn</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="annottext">uv_requirements :: UnitVisibility -&gt; Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681679974"><span class="annot"><span class="annottext">Map ModuleName (Set InstantiatedModule)
</span><a href="#local-6989586621681679974"><span class="hs-identifier hs-var">reqs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">uv_explicit :: UnitVisibility -&gt; Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681679975"><span class="annot"><span class="annottext">Maybe PackageArg
</span><a href="#local-6989586621681679975"><span class="hs-identifier hs-var">explicit</span></a></span></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool, [(ModuleName, ModuleName)], Maybe FastString,
 Map ModuleName (Set InstantiatedModule), Maybe PackageArg)
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681679970"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681679971"><span class="hs-identifier hs-var">rns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621681679973"><span class="hs-identifier hs-var">mb_pn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (Set InstantiatedModule)
</span><a href="#local-6989586621681679974"><span class="hs-identifier hs-var">reqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe PackageArg
</span><a href="#local-6989586621681679975"><span class="hs-identifier hs-var">explicit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681679978"><span id="local-6989586621681679982"><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Semigroup/GHC.Base.html#Semigroup"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621681679992"><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679992"><span class="hs-identifier hs-var">uv1</span></a></span></span><span> </span><span id="local-6989586621681679993"><span class="annot"><span class="annottext">&lt;&gt; :: UnitVisibility -&gt; UnitVisibility -&gt; UnitVisibility
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621681679994"><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679994"><span class="hs-identifier hs-var">uv2</span></a></span></span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span>
</span><span id="line-309"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uv_expose_all :: Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679992"><span class="hs-identifier hs-var">uv1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679994"><span class="hs-identifier hs-var">uv2</span></a></span><span>
</span><span id="line-310"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_renamings :: [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679992"><span class="hs-identifier hs-var">uv1</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
-&gt; [(ModuleName, ModuleName)] -&gt; [(ModuleName, ModuleName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679994"><span class="hs-identifier hs-var">uv2</span></a></span><span>
</span><span id="line-311"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_package_name :: First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">First FastString -&gt; First FastString -&gt; First FastString
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mappend/GHC.Base.html#mappend"><span class="hs-identifier hs-var">mappend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitVisibility -&gt; First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679992"><span class="hs-identifier hs-var">uv1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitVisibility -&gt; First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679994"><span class="hs-identifier hs-var">uv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_requirements :: Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set InstantiatedModule
 -&gt; Set InstantiatedModule -&gt; Set InstantiatedModule)
-&gt; Map ModuleName (Set InstantiatedModule)
-&gt; Map ModuleName (Set InstantiatedModule)
-&gt; Map ModuleName (Set InstantiatedModule)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#unionWith/Data.Map.Internal.html#unionWith"><span class="hs-identifier hs-var">Map.unionWith</span></a></span><span> </span><span class="annot"><span class="annottext">Set InstantiatedModule
-&gt; Set InstantiatedModule -&gt; Set InstantiatedModule
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#union/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitVisibility -&gt; Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679992"><span class="hs-identifier hs-var">uv1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitVisibility -&gt; Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679994"><span class="hs-identifier hs-var">uv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_explicit :: Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679992"><span class="hs-identifier hs-var">uv1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PackageArg -&gt; Maybe PackageArg -&gt; Maybe PackageArg
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%7C%3E/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681679994"><span class="hs-identifier hs-var">uv2</span></a></span><span>
</span><span id="line-314"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681680003"><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Monoid/GHC.Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621681680005"><span class="annot"><span class="annottext">mempty :: UnitVisibility
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span>
</span><span id="line-318"></span><span>             </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uv_expose_all :: Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-319"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_renamings :: [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-320"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_package_name :: First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FastString -&gt; First FastString
forall a. Maybe a -&gt; First a
</span><a href="../../base-4.18.3.0/src/Data.Monoid.html#First/Data.Monoid.html#First"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastString
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-321"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_requirements :: Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (Set InstantiatedModule)
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-322"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_explicit :: Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PackageArg
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-323"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621681680008"><span class="annot"><span class="annottext">mappend :: UnitVisibility -&gt; UnitVisibility -&gt; UnitVisibility
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mappend/GHC.Base.html#mappend"><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; UnitVisibility -&gt; UnitVisibility
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">(Semigroup.&lt;&gt;)</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><span class="hs-comment">-- | Unit configuration</span></span><span>
</span><span id="line-328"></span><span class="hs-keyword">data</span><span> </span><span id="UnitConfig"><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-var">UnitConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UnitConfig"><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-var">UnitConfig</span></a></span></span><span>
</span><span id="line-329"></span><span>   </span><span class="hs-special">{</span><span> </span><span id="unitConfigPlatformArchOS"><span class="annot"><span class="annottext">UnitConfig -&gt; ArchOS
</span><a href="GHC.Unit.State.html#unitConfigPlatformArchOS"><span class="hs-identifier hs-var hs-var">unitConfigPlatformArchOS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Platform.ArchOS.html#ArchOS/GHC.Platform.ArchOS.html#ArchOS"><span class="hs-identifier hs-type">ArchOS</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Platform arch and OS</span></span><span>
</span><span id="line-330"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigWays"><span class="annot"><span class="annottext">UnitConfig -&gt; Ways
</span><a href="GHC.Unit.State.html#unitConfigWays"><span class="hs-identifier hs-var hs-var">unitConfigWays</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Platform.Ways.html#Ways"><span class="hs-identifier hs-type">Ways</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Ways to use</span></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigAllowVirtual"><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigAllowVirtual"><span class="hs-identifier hs-var hs-var">unitConfigAllowVirtual</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- ^ Allow virtual units</span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-comment">-- ^ Do we allow the use of virtual units instantiated on-the-fly (see</span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-comment">-- Note [About units] in GHC.Unit). This should only be true when we are</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-comment">-- type-checking an indefinite unit (not producing any code).</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigProgramName"><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigProgramName"><span class="hs-identifier hs-var hs-var">unitConfigProgramName</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-comment">-- ^ Name of the compiler (e.g. &quot;GHC&quot;, &quot;GHCJS&quot;). Used to fetch environment</span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-comment">-- variables such as &quot;GHC[JS]_PACKAGE_PATH&quot;.</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigGlobalDB"><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigGlobalDB"><span class="hs-identifier hs-var hs-var">unitConfigGlobalDB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Path to global DB</span></span><span>
</span><span id="line-342"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigGHCDir"><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigGHCDir"><span class="hs-identifier hs-var hs-var">unitConfigGHCDir</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Main GHC dir: contains settings, etc.</span></span><span>
</span><span id="line-343"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigDBName"><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigDBName"><span class="hs-identifier hs-var hs-var">unitConfigDBName</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ User DB name (e.g. &quot;package.conf.d&quot;)</span></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigAutoLink"><span class="annot"><span class="annottext">UnitConfig -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#unitConfigAutoLink"><span class="hs-identifier hs-var hs-var">unitConfigAutoLink</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Units to link automatically (e.g. base, rts)</span></span><span>
</span><span id="line-346"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigDistrustAll"><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigDistrustAll"><span class="hs-identifier hs-var hs-var">unitConfigDistrustAll</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Distrust all units by default</span></span><span>
</span><span id="line-347"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigHideAll"><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigHideAll"><span class="hs-identifier hs-var hs-var">unitConfigHideAll</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Hide all units by default</span></span><span>
</span><span id="line-348"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigHideAllPlugins"><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigHideAllPlugins"><span class="hs-identifier hs-var hs-var">unitConfigHideAllPlugins</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Hide all plugins units by default</span></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigDBCache"><span class="annot"><span class="annottext">UnitConfig -&gt; Maybe [UnitDatabase UnitId]
</span><a href="GHC.Unit.State.html#unitConfigDBCache"><span class="hs-identifier hs-var hs-var">unitConfigDBCache</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>      </span><span class="hs-comment">-- ^ Cache of databases to use, in the order they were specified on the</span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-comment">-- command line (later databases shadow earlier ones).</span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-comment">-- If Nothing, databases will be found using `unitConfigFlagsDB`.</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>   </span><span class="hs-comment">-- command-line flags</span><span>
</span><span id="line-356"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigFlagsDB"><span class="annot"><span class="annottext">UnitConfig -&gt; [PackageDBFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsDB"><span class="hs-identifier hs-var hs-var">unitConfigFlagsDB</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#PackageDBFlag"><span class="hs-identifier hs-type">PackageDBFlag</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Unit databases flags</span></span><span>
</span><span id="line-357"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigFlagsExposed"><span class="annot"><span class="annottext">UnitConfig -&gt; [PackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsExposed"><span class="hs-identifier hs-var hs-var">unitConfigFlagsExposed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span class="hs-special">]</span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Exposed units</span></span><span>
</span><span id="line-358"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigFlagsIgnored"><span class="annot"><span class="annottext">UnitConfig -&gt; [IgnorePackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsIgnored"><span class="hs-identifier hs-var hs-var">unitConfigFlagsIgnored</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#IgnorePackageFlag"><span class="hs-identifier hs-type">IgnorePackageFlag</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Ignored units</span></span><span>
</span><span id="line-359"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigFlagsTrusted"><span class="annot"><span class="annottext">UnitConfig -&gt; [TrustFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsTrusted"><span class="hs-identifier hs-var hs-var">unitConfigFlagsTrusted</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#TrustFlag"><span class="hs-identifier hs-type">TrustFlag</span></a></span><span class="hs-special">]</span><span>         </span><span class="annot"><span class="hs-comment">-- ^ Trusted units</span></span><span>
</span><span id="line-360"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigFlagsPlugins"><span class="annot"><span class="annottext">UnitConfig -&gt; [PackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsPlugins"><span class="hs-identifier hs-var hs-var">unitConfigFlagsPlugins</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span class="hs-special">]</span><span>       </span><span class="annot"><span class="hs-comment">-- ^ Plugins exposed units</span></span><span>
</span><span id="line-361"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitConfigHomeUnits"><span class="annot"><span class="annottext">UnitConfig -&gt; Set UnitId
</span><a href="GHC.Unit.State.html#unitConfigHomeUnits"><span class="hs-identifier hs-var hs-var">unitConfigHomeUnits</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-362"></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="GHC.Unit.State.html#initUnitConfig"><span class="hs-identifier hs-type">initUnitConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span>
</span><span id="line-365"></span><span id="initUnitConfig"><span class="annot"><span class="annottext">initUnitConfig :: DynFlags -&gt; Maybe [UnitDatabase UnitId] -&gt; Set UnitId -&gt; UnitConfig
</span><a href="GHC.Unit.State.html#initUnitConfig"><span class="hs-identifier hs-var hs-var">initUnitConfig</span></a></span></span><span> </span><span id="local-6989586621681680030"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681680031"><span class="annot"><span class="annottext">Maybe [UnitDatabase UnitId]
</span><a href="#local-6989586621681680031"><span class="hs-identifier hs-var">cached_dbs</span></a></span></span><span> </span><span id="local-6989586621681680032"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680032"><span class="hs-identifier hs-var">home_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-366"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681680033"><span class="annot"><span class="annottext">hu_id :: UnitId
</span><a href="#local-6989586621681680033"><span class="hs-identifier hs-var hs-var">hu_id</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-367"></span><span>       </span><span class="hs-glyph">!</span><span id="local-6989586621681680035"><span class="annot"><span class="annottext">hu_instanceof :: Maybe UnitId
</span><a href="#local-6989586621681680035"><span class="hs-identifier hs-var hs-var">hu_instanceof</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe UnitId
</span><a href="GHC.Driver.Session.html#homeUnitInstanceOf_"><span class="hs-identifier hs-var">homeUnitInstanceOf_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-368"></span><span>       </span><span class="hs-glyph">!</span><span id="local-6989586621681680037"><span class="annot"><span class="annottext">hu_instantiations :: [(ModuleName, Module)]
</span><a href="#local-6989586621681680037"><span class="hs-identifier hs-var hs-var">hu_instantiations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [(ModuleName, Module)]
</span><a href="GHC.Driver.Session.html#homeUnitInstantiations_"><span class="hs-identifier hs-var">homeUnitInstantiations_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>       </span><span id="local-6989586621681680039"><span class="annot"><span class="annottext">autoLink :: [UnitId]
</span><a href="#local-6989586621681680039"><span class="hs-identifier hs-var hs-var">autoLink</span></a></span></span><span>
</span><span id="line-371"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_AutoLinkPackages"><span class="hs-identifier hs-var">Opt_AutoLinkPackages</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>         </span><span class="hs-comment">-- By default we add base &amp; rts to the preload units (when they are</span><span>
</span><span id="line-373"></span><span>         </span><span class="hs-comment">-- found in the unit database) except when we are building them</span><span>
</span><span id="line-374"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Bool) -&gt; [UnitId] -&gt; [UnitId]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680033"><span class="hs-identifier hs-var">hu_id</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#baseUnitId"><span class="hs-identifier hs-var">baseUnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>       </span><span class="hs-comment">-- if the home unit is indefinite, it means we are type-checking it only</span><span>
</span><span id="line-377"></span><span>       </span><span class="hs-comment">-- (not producing any code). Hence we can use virtual units instantiated</span><span>
</span><span id="line-378"></span><span>       </span><span class="hs-comment">-- on-the-fly. See Note [About units] in GHC.Unit</span><span>
</span><span id="line-379"></span><span>       </span><span id="local-6989586621681680045"><span class="annot"><span class="annottext">allow_virtual_units :: Bool
</span><a href="#local-6989586621681680045"><span class="hs-identifier hs-var hs-var">allow_virtual_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681680035"><span class="hs-identifier hs-var">hu_instanceof</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680037"><span class="hs-identifier hs-var">hu_instantiations</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680046"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680046"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680047"><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680047"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680046"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680033"><span class="hs-identifier hs-var">hu_id</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">((ModuleName, Module) -&gt; Bool) -&gt; [(ModuleName, Module)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Bool
forall u. GenModule (GenUnit u) -&gt; Bool
</span><a href="GHC.Unit.Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; Bool)
-&gt; ((ModuleName, Module) -&gt; Module) -&gt; (ModuleName, Module) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, Module) -&gt; Module
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680047"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="annottext">(Maybe UnitId, [(ModuleName, Module)])
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span>
</span><span id="line-384"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">unitConfigPlatformArchOS :: ArchOS
</span><a href="GHC.Unit.State.html#unitConfigPlatformArchOS"><span class="hs-identifier hs-var">unitConfigPlatformArchOS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ArchOS
</span><a href="GHC.Platform.html#platformArchOS"><span class="hs-identifier hs-var">platformArchOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigProgramName :: String
</span><a href="GHC.Unit.State.html#unitConfigProgramName"><span class="hs-identifier hs-var">unitConfigProgramName</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#programName"><span class="hs-identifier hs-var">programName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigWays :: Ways
</span><a href="GHC.Unit.State.html#unitConfigWays"><span class="hs-identifier hs-var">unitConfigWays</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Ways
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigAllowVirtual :: Bool
</span><a href="GHC.Unit.State.html#unitConfigAllowVirtual"><span class="hs-identifier hs-var">unitConfigAllowVirtual</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680045"><span class="hs-identifier hs-var">allow_virtual_units</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigGlobalDB :: String
</span><a href="GHC.Unit.State.html#unitConfigGlobalDB"><span class="hs-identifier hs-var">unitConfigGlobalDB</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#globalPackageDatabasePath"><span class="hs-identifier hs-var">globalPackageDatabasePath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigGHCDir :: String
</span><a href="GHC.Unit.State.html#unitConfigGHCDir"><span class="hs-identifier hs-var">unitConfigGHCDir</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#topDir"><span class="hs-identifier hs-var">topDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-391"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigDBName :: String
</span><a href="GHC.Unit.State.html#unitConfigDBName"><span class="hs-identifier hs-var">unitConfigDBName</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package.conf.d&quot;</span></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigAutoLink :: [UnitId]
</span><a href="GHC.Unit.State.html#unitConfigAutoLink"><span class="hs-identifier hs-var">unitConfigAutoLink</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680039"><span class="hs-identifier hs-var">autoLink</span></a></span><span>
</span><span id="line-394"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigDistrustAll :: Bool
</span><a href="GHC.Unit.State.html#unitConfigDistrustAll"><span class="hs-identifier hs-var">unitConfigDistrustAll</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_DistrustAllPackages"><span class="hs-identifier hs-var">Opt_DistrustAllPackages</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-395"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigHideAll :: Bool
</span><a href="GHC.Unit.State.html#unitConfigHideAll"><span class="hs-identifier hs-var">unitConfigHideAll</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_HideAllPackages"><span class="hs-identifier hs-var">Opt_HideAllPackages</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigHideAllPlugins :: Bool
</span><a href="GHC.Unit.State.html#unitConfigHideAllPlugins"><span class="hs-identifier hs-var">unitConfigHideAllPlugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_HideAllPluginPackages"><span class="hs-identifier hs-var">Opt_HideAllPluginPackages</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigDBCache :: Maybe [UnitDatabase UnitId]
</span><a href="GHC.Unit.State.html#unitConfigDBCache"><span class="hs-identifier hs-var">unitConfigDBCache</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [UnitDatabase UnitId]
</span><a href="#local-6989586621681680031"><span class="hs-identifier hs-var">cached_dbs</span></a></span><span>
</span><span id="line-399"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigFlagsDB :: [PackageDBFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsDB"><span class="hs-identifier hs-var">unitConfigFlagsDB</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PackageDBFlag -&gt; PackageDBFlag)
-&gt; [PackageDBFlag] -&gt; [PackageDBFlag]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; PackageDBFlag -&gt; PackageDBFlag
</span><a href="#local-6989586621681680061"><span class="hs-identifier hs-var">offsetPackageDb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#workingDirectory"><span class="hs-identifier hs-var">workingDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([PackageDBFlag] -&gt; [PackageDBFlag])
-&gt; [PackageDBFlag] -&gt; [PackageDBFlag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [PackageDBFlag]
</span><a href="GHC.Driver.Session.html#packageDBFlags"><span class="hs-identifier hs-var">packageDBFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigFlagsExposed :: [PackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsExposed"><span class="hs-identifier hs-var">unitConfigFlagsExposed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [PackageFlag]
</span><a href="GHC.Driver.Session.html#packageFlags"><span class="hs-identifier hs-var">packageFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigFlagsIgnored :: [IgnorePackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsIgnored"><span class="hs-identifier hs-var">unitConfigFlagsIgnored</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [IgnorePackageFlag]
</span><a href="GHC.Driver.Session.html#ignorePackageFlags"><span class="hs-identifier hs-var">ignorePackageFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigFlagsTrusted :: [TrustFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsTrusted"><span class="hs-identifier hs-var">unitConfigFlagsTrusted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [TrustFlag]
</span><a href="GHC.Driver.Session.html#trustFlags"><span class="hs-identifier hs-var">trustFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigFlagsPlugins :: [PackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsPlugins"><span class="hs-identifier hs-var">unitConfigFlagsPlugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [PackageFlag]
</span><a href="GHC.Driver.Session.html#pluginPackageFlags"><span class="hs-identifier hs-var">pluginPackageFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680030"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitConfigHomeUnits :: Set UnitId
</span><a href="GHC.Unit.State.html#unitConfigHomeUnits"><span class="hs-identifier hs-var">unitConfigHomeUnits</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680032"><span class="hs-identifier hs-var">home_units</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="#local-6989586621681680061"><span class="hs-identifier hs-type">offsetPackageDb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageDBFlag"><span class="hs-identifier hs-type">PackageDBFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageDBFlag"><span class="hs-identifier hs-type">PackageDBFlag</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621681680061"><span class="annot"><span class="annottext">offsetPackageDb :: Maybe String -&gt; PackageDBFlag -&gt; PackageDBFlag
</span><a href="#local-6989586621681680061"><span class="hs-identifier hs-var hs-var">offsetPackageDb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680068"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680068"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PkgDbPath"><span class="hs-identifier hs-type">PkgDbPath</span></a></span><span> </span><span id="local-6989586621681680071"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680071"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#isRelative/System.FilePath.Posix.html#isRelative"><span class="hs-identifier hs-var">isRelative</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680071"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgDbRef -&gt; PackageDBFlag
</span><a href="GHC.Driver.Session.html#PackageDB"><span class="hs-identifier hs-var">PackageDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PkgDbRef
</span><a href="GHC.Driver.Session.html#PkgDbPath"><span class="hs-identifier hs-var">PkgDbPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680068"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680071"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><a href="#local-6989586621681680061"><span class="hs-identifier hs-var">offsetPackageDb</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681680074"><span class="annot"><span class="annottext">PackageDBFlag
</span><a href="#local-6989586621681680074"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackageDBFlag
</span><a href="#local-6989586621681680074"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-comment">-- | Map from 'ModuleName' to a set of module providers (i.e. a 'Module' and</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- its 'ModuleOrigin').</span><span>
</span><span id="line-416"></span><span class="hs-comment">--</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- NB: the set is in fact a 'Map Module ModuleOrigin', probably to keep only one</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- origin for a given 'Module'</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-keyword">type</span><span> </span><span id="ModuleNameProvidersMap"><span class="annot"><a href="GHC.Unit.State.html#ModuleNameProvidersMap"><span class="hs-identifier hs-var">ModuleNameProvidersMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-keyword">data</span><span> </span><span id="UnitState"><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-var">UnitState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UnitState"><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-var">UnitState</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-comment">-- | A mapping of 'Unit' to 'UnitInfo'.  This list is adjusted</span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-comment">-- so that only valid units are here.  'UnitInfo' reflects</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-comment">-- what was stored *on disk*, except for the 'trusted' flag, which</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-comment">-- is adjusted at runtime.  (In particular, some units in this map</span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-comment">-- may have the 'exposed' flag be 'False'.)</span><span>
</span><span id="line-429"></span><span>  </span><span id="unitInfoMap"><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var hs-var">unitInfoMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-comment">-- | The set of transitively reachable units according</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-comment">-- to the explicitly provided command line arguments.</span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-comment">-- A fully instantiated VirtUnit may only be replaced by a RealUnit from</span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-comment">-- this set.</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-comment">-- See Note [VirtUnit to RealUnit improvement]</span><span>
</span><span id="line-436"></span><span>  </span><span id="preloadClosure"><span class="annot"><span class="annottext">UnitState -&gt; PreloadUnitClosure
</span><a href="GHC.Unit.State.html#preloadClosure"><span class="hs-identifier hs-var hs-var">preloadClosure</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-comment">-- | A mapping of 'PackageName' to 'UnitId'. If several units have the same</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-comment">-- package name (e.g. different instantiations), then we return one of them...</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-comment">-- This is used when users refer to packages in Backpack includes.</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-comment">-- And also to resolve package qualifiers with the PackageImports extension.</span><span>
</span><span id="line-442"></span><span>  </span><span id="packageNameMap"><span class="annot"><span class="annottext">UnitState -&gt; UniqFM PackageName UnitId
</span><a href="GHC.Unit.State.html#packageNameMap"><span class="hs-identifier hs-var hs-var">packageNameMap</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#PackageName"><span class="hs-identifier hs-type">PackageName</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A mapping from database unit keys to wired in unit ids.</span></span><span>
</span><span id="line-445"></span><span>  </span><span id="wireMap"><span class="annot"><span class="annottext">UnitState -&gt; Map UnitId UnitId
</span><a href="GHC.Unit.State.html#wireMap"><span class="hs-identifier hs-var hs-var">wireMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A mapping from wired in unit ids to unit keys from the database.</span></span><span>
</span><span id="line-448"></span><span>  </span><span id="unwireMap"><span class="annot"><span class="annottext">UnitState -&gt; Map UnitId UnitId
</span><a href="GHC.Unit.State.html#unwireMap"><span class="hs-identifier hs-var hs-var">unwireMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-comment">-- | The units we're going to link in eagerly.  This list</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-comment">-- should be in reverse dependency order; that is, a unit</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-comment">-- is always mentioned before the units it depends on.</span><span>
</span><span id="line-453"></span><span>  </span><span id="preloadUnits"><span class="annot"><span class="annottext">UnitState -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#preloadUnits"><span class="hs-identifier hs-var hs-var">preloadUnits</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-comment">-- | Units which we explicitly depend on (from a command line flag).</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-comment">-- We'll use this to generate version macros and the unused packages warning. The</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-comment">-- original flag which was used to bring the unit into scope is recorded for the</span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-comment">-- -Wunused-packages warning.</span><span>
</span><span id="line-459"></span><span>  </span><span id="explicitUnits"><span class="annot"><span class="annottext">UnitState -&gt; [(GenUnit UnitId, Maybe PackageArg)]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var hs-var">explicitUnits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>  </span><span id="homeUnitDepends"><span class="annot"><span class="annottext">UnitState -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#homeUnitDepends"><span class="hs-identifier hs-var hs-var">homeUnitDepends</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-comment">-- | This is a full map from 'ModuleName' to all modules which may possibly</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-comment">-- be providing it.  These providers may be hidden (but we'll still want</span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-comment">-- to report them in error messages), or it may be an ambiguous import.</span><span>
</span><span id="line-466"></span><span>  </span><span id="moduleNameProvidersMap"><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var hs-var">moduleNameProvidersMap</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.State.html#ModuleNameProvidersMap"><span class="hs-identifier hs-type">ModuleNameProvidersMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A map, like 'moduleNameProvidersMap', but controlling plugin visibility.</span></span><span>
</span><span id="line-469"></span><span>  </span><span id="pluginModuleNameProvidersMap"><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#pluginModuleNameProvidersMap"><span class="hs-identifier hs-var hs-var">pluginModuleNameProvidersMap</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.State.html#ModuleNameProvidersMap"><span class="hs-identifier hs-type">ModuleNameProvidersMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-comment">-- | A map saying, for each requirement, what interfaces must be merged</span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-comment">-- together when we use them.  For example, if our dependencies</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-comment">-- are @p[A=\&lt;A&gt;]@ and @q[A=\&lt;A&gt;,B=r[C=\&lt;A&gt;]:B]@, then the interfaces</span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-comment">-- to merge for A are @p[A=\&lt;A&gt;]:A@, @q[A=\&lt;A&gt;,B=r[C=\&lt;A&gt;]:B]:A@</span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-comment">-- and @r[C=\&lt;A&gt;]:C@.</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-comment">-- There's an entry in this map for each hole in our home library.</span><span>
</span><span id="line-478"></span><span>  </span><span id="requirementContext"><span class="annot"><span class="annottext">UnitState -&gt; Map ModuleName [InstantiatedModule]
</span><a href="GHC.Unit.State.html#requirementContext"><span class="hs-identifier hs-var hs-var">requirementContext</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedModule"><span class="hs-identifier hs-type">InstantiatedModule</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-comment">-- | Indicate if we can instantiate units on-the-fly.</span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-comment">-- This should only be true when we are type-checking an indefinite unit.</span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-comment">-- See Note [About units] in GHC.Unit.</span><span>
</span><span id="line-484"></span><span>  </span><span id="allowVirtualUnits"><span class="annot"><span class="annottext">UnitState -&gt; Bool
</span><a href="GHC.Unit.State.html#allowVirtualUnits"><span class="hs-identifier hs-var hs-var">allowVirtualUnits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="annot"><a href="GHC.Unit.State.html#emptyUnitState"><span class="hs-identifier hs-type">emptyUnitState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-488"></span><span id="emptyUnitState"><span class="annot"><span class="annottext">emptyUnitState :: UnitState
</span><a href="GHC.Unit.State.html#emptyUnitState"><span class="hs-identifier hs-var hs-var">emptyUnitState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><span class="annottext">unitInfoMap :: UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><span class="annottext">preloadClosure :: PreloadUnitClosure
</span><a href="GHC.Unit.State.html#preloadClosure"><span class="hs-identifier hs-var">preloadClosure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">packageNameMap :: UniqFM PackageName UnitId
</span><a href="GHC.Unit.State.html#packageNameMap"><span class="hs-identifier hs-var">packageNameMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM PackageName UnitId
forall key elt. UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><span class="annottext">wireMap :: Map UnitId UnitId
</span><a href="GHC.Unit.State.html#wireMap"><span class="hs-identifier hs-var">wireMap</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-493"></span><span>    </span><span class="annot"><span class="annottext">unwireMap :: Map UnitId UnitId
</span><a href="GHC.Unit.State.html#unwireMap"><span class="hs-identifier hs-var">unwireMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><span class="annottext">preloadUnits :: [UnitId]
</span><a href="GHC.Unit.State.html#preloadUnits"><span class="hs-identifier hs-var">preloadUnits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><span class="annottext">explicitUnits :: [(GenUnit UnitId, Maybe PackageArg)]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var">explicitUnits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><span class="annottext">homeUnitDepends :: [UnitId]
</span><a href="GHC.Unit.State.html#homeUnitDepends"><span class="hs-identifier hs-var">homeUnitDepends</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-497"></span><span>    </span><span class="annot"><span class="annottext">moduleNameProvidersMap :: ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-498"></span><span>    </span><span class="annot"><span class="annottext">pluginModuleNameProvidersMap :: ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#pluginModuleNameProvidersMap"><span class="hs-identifier hs-var">pluginModuleNameProvidersMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-499"></span><span>    </span><span class="annot"><span class="annottext">requirementContext :: Map ModuleName [InstantiatedModule]
</span><a href="GHC.Unit.State.html#requirementContext"><span class="hs-identifier hs-var">requirementContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName [InstantiatedModule]
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><span class="annottext">allowVirtualUnits :: Bool
</span><a href="GHC.Unit.State.html#allowVirtualUnits"><span class="hs-identifier hs-var">allowVirtualUnits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="annot"><span class="hs-comment">-- | Unit database</span></span><span>
</span><span id="line-504"></span><span class="hs-keyword">data</span><span> </span><span id="UnitDatabase"><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-var">UnitDatabase</span></a></span></span><span> </span><span id="local-6989586621681679000"><span class="annot"><a href="#local-6989586621681679000"><span class="hs-keyword hs-type">unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UnitDatabase"><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-var">UnitDatabase</span></a></span></span><span>
</span><span id="line-505"></span><span>   </span><span class="hs-special">{</span><span> </span><span id="unitDatabasePath"><span class="annot"><span class="annottext">forall unit. UnitDatabase unit -&gt; String
</span><a href="GHC.Unit.State.html#unitDatabasePath"><span class="hs-identifier hs-var hs-var">unitDatabasePath</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-506"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="unitDatabaseUnits"><span class="annot"><span class="annottext">forall unit. UnitDatabase unit -&gt; [GenUnitInfo unit]
</span><a href="GHC.Unit.State.html#unitDatabaseUnits"><span class="hs-identifier hs-var hs-var">unitDatabaseUnits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#GenUnitInfo"><span class="hs-identifier hs-type">GenUnitInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679000"><span class="hs-keyword hs-type">unit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-507"></span><span>   </span><span class="hs-special">}</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681679005"><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679005"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679005"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-510"></span><span>  </span><span id="local-6989586621681680102"><span class="annot"><span class="annottext">ppr :: UnitDatabase u -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span id="local-6989586621681680103"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680103"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621681680104"><span class="annot"><span class="annottext">[GenUnitInfo u]
</span><a href="#local-6989586621681680104"><span class="hs-identifier hs-var">_u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DB:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680103"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-keyword">type</span><span> </span><span id="UnitInfoMap"><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-var">UnitInfoMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="annot"><span class="hs-comment">-- | Find the unit we know about with the given unit, if any</span></span><span>
</span><span id="line-515"></span><span class="annot"><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier hs-type">lookupUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-516"></span><span id="lookupUnit"><span class="annot"><span class="annottext">lookupUnit :: UnitState -&gt; GenUnit UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier hs-var hs-var">lookupUnit</span></a></span></span><span> </span><span id="local-6989586621681680105"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680105"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; GenUnit UnitId
-&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit%27"><span class="hs-identifier hs-var">lookupUnit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; Bool
</span><a href="GHC.Unit.State.html#allowVirtualUnits"><span class="hs-identifier hs-var">allowVirtualUnits</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680105"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680105"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PreloadUnitClosure
</span><a href="GHC.Unit.State.html#preloadClosure"><span class="hs-identifier hs-var">preloadClosure</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680105"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="hs-comment">-- | A more specialized interface, which doesn't require a 'UnitState' (so it</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- can be used while we're initializing 'DynFlags')</span><span>
</span><span id="line-520"></span><span class="hs-comment">--</span><span>
</span><span id="line-521"></span><span class="hs-comment">-- Parameters:</span><span>
</span><span id="line-522"></span><span class="hs-comment">--    * a boolean specifying whether or not to look for on-the-fly renamed interfaces</span><span>
</span><span id="line-523"></span><span class="hs-comment">--    * a 'UnitInfoMap'</span><span>
</span><span id="line-524"></span><span class="hs-comment">--    * a 'PreloadUnitClosure'</span><span>
</span><span id="line-525"></span><span class="annot"><a href="GHC.Unit.State.html#lookupUnit%27"><span class="hs-identifier hs-type">lookupUnit'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-526"></span><span id="lookupUnit%27"><span class="annot"><span class="annottext">lookupUnit' :: Bool
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; GenUnit UnitId
-&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit%27"><span class="hs-identifier hs-var hs-var">lookupUnit'</span></a></span></span><span> </span><span id="local-6989586621681680107"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680107"><span class="hs-identifier hs-var">allowOnTheFlyInst</span></a></span></span><span> </span><span id="local-6989586621681680108"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680108"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680109"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680109"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681680110"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680110"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680110"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-527"></span><span>   </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="GHC.Unit.Types.html#HoleUnit"><span class="hs-identifier hs-var">HoleUnit</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe UnitInfo
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Err.html#error/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Hole unit&quot;</span></span><span>
</span><span id="line-528"></span><span>   </span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span id="local-6989586621681680114"><span class="annot"><span class="annottext">Definite UnitId
</span><a href="#local-6989586621681680114"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Maybe UnitInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definite UnitId -&gt; UnitId
forall unit. Definite unit -&gt; unit
</span><a href="GHC.Unit.Types.html#unDefinite"><span class="hs-identifier hs-var">unDefinite</span></a></span><span> </span><span class="annot"><span class="annottext">Definite UnitId
</span><a href="#local-6989586621681680114"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680108"><span class="hs-identifier hs-var">pkg_map</span></a></span><span>
</span><span id="line-529"></span><span>   </span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span> </span><span id="local-6989586621681680118"><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680118"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-530"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680107"><span class="hs-identifier hs-var">allowOnTheFlyInst</span></a></span><span>
</span><span id="line-531"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- lookup UnitInfo of the indefinite unit to be instantiated and</span><span>
</span><span id="line-532"></span><span>         </span><span class="hs-comment">-- instantiate it on-the-fly</span><span>
</span><span id="line-533"></span><span>         </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo) -&gt; Maybe UnitInfo -&gt; Maybe UnitInfo
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; [(ModuleName, Module)]
-&gt; UnitInfo
-&gt; UnitInfo
</span><a href="GHC.Unit.State.html#renameUnitInfo"><span class="hs-identifier hs-var">renameUnitInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680108"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680109"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; [(ModuleName, Module)]
forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var">instUnitInsts</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680118"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Maybe UnitInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; UnitId
forall unit. GenInstantiatedUnit unit -&gt; unit
</span><a href="GHC.Unit.Types.html#instUnitInstanceOf"><span class="hs-identifier hs-var">instUnitInstanceOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680118"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680108"><span class="hs-identifier hs-var">pkg_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- lookup UnitInfo by virtual UnitId. This is used to find indefinite</span><span>
</span><span id="line-538"></span><span>         </span><span class="hs-comment">-- units. Even if they are real, installed units, they can't use the</span><span>
</span><span id="line-539"></span><span>         </span><span class="hs-comment">-- `RealUnit` constructor (it is reserved for definite units) so we use</span><span>
</span><span id="line-540"></span><span>         </span><span class="hs-comment">-- the `VirtUnit` constructor.</span><span>
</span><span id="line-541"></span><span>         </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Maybe UnitInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#virtualUnitId"><span class="hs-identifier hs-var">virtualUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680118"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680108"><span class="hs-identifier hs-var">pkg_map</span></a></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="annot"><span class="hs-comment">-- | Find the unit we know about with the given unit id, if any</span></span><span>
</span><span id="line-544"></span><span class="annot"><a href="GHC.Unit.State.html#lookupUnitId"><span class="hs-identifier hs-type">lookupUnitId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-545"></span><span id="lookupUnitId"><span class="annot"><span class="annottext">lookupUnitId :: UnitState -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId"><span class="hs-identifier hs-var hs-var">lookupUnitId</span></a></span></span><span> </span><span id="local-6989586621681680123"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680123"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681680124"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680124"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId%27"><span class="hs-identifier hs-var">lookupUnitId'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680123"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680124"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="annot"><span class="hs-comment">-- | Find the unit we know about with the given unit id, if any</span></span><span>
</span><span id="line-548"></span><span class="annot"><a href="GHC.Unit.State.html#lookupUnitId%27"><span class="hs-identifier hs-type">lookupUnitId'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-549"></span><span id="lookupUnitId%27"><span class="annot"><span class="annottext">lookupUnitId' :: UnitInfoMap -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId%27"><span class="hs-identifier hs-var hs-var">lookupUnitId'</span></a></span></span><span> </span><span id="local-6989586621681680125"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680125"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span id="local-6989586621681680126"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680126"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Maybe UnitInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680126"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680125"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><span class="hs-comment">-- | Looks up the given unit in the unit state, panicking if it is not found</span></span><span>
</span><span id="line-553"></span><span class="annot"><a href="GHC.Unit.State.html#unsafeLookupUnit"><span class="hs-identifier hs-type">unsafeLookupUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-554"></span><span id="unsafeLookupUnit"><span class="annot"><span class="annottext">unsafeLookupUnit :: HasDebugCallStack =&gt; UnitState -&gt; GenUnit UnitId -&gt; UnitInfo
</span><a href="GHC.Unit.State.html#unsafeLookupUnit"><span class="hs-identifier hs-var hs-var">unsafeLookupUnit</span></a></span></span><span> </span><span id="local-6989586621681680131"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680131"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681680132"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680132"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; GenUnit UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier hs-var">lookupUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680131"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680132"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-555"></span><span>   </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680133"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680133"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680133"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-556"></span><span>   </span><span class="annot"><span class="annottext">Maybe UnitInfo
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; UnitInfo
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeLookupUnit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680132"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><span class="hs-comment">-- | Looks up the given unit id in the unit state, panicking if it is not found</span></span><span>
</span><span id="line-559"></span><span class="annot"><a href="GHC.Unit.State.html#unsafeLookupUnitId"><span class="hs-identifier hs-type">unsafeLookupUnitId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-560"></span><span id="unsafeLookupUnitId"><span class="annot"><span class="annottext">unsafeLookupUnitId :: HasDebugCallStack =&gt; UnitState -&gt; UnitId -&gt; UnitInfo
</span><a href="GHC.Unit.State.html#unsafeLookupUnitId"><span class="hs-identifier hs-var hs-var">unsafeLookupUnitId</span></a></span></span><span> </span><span id="local-6989586621681680138"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680138"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681680139"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680139"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId"><span class="hs-identifier hs-var">lookupUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680138"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680139"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-561"></span><span>   </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680140"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680140"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680140"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-562"></span><span>   </span><span class="annot"><span class="annottext">Maybe UnitInfo
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; UnitInfo
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeLookupUnitId&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680139"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="hs-comment">-- | Find the unit we know about with the given package name (e.g. @foo@), if any</span><span>
</span><span id="line-566"></span><span class="hs-comment">-- (NB: there might be a locally defined unit name which overrides this)</span><span>
</span><span id="line-567"></span><span class="hs-comment">-- This function is unsafe to use in general because it doesn't respect package</span><span>
</span><span id="line-568"></span><span class="hs-comment">-- visibility.</span><span>
</span><span id="line-569"></span><span class="annot"><a href="GHC.Unit.State.html#lookupPackageName"><span class="hs-identifier hs-type">lookupPackageName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#PackageName"><span class="hs-identifier hs-type">PackageName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-570"></span><span id="lookupPackageName"><span class="annot"><span class="annottext">lookupPackageName :: UnitState -&gt; PackageName -&gt; Maybe UnitId
</span><a href="GHC.Unit.State.html#lookupPackageName"><span class="hs-identifier hs-var hs-var">lookupPackageName</span></a></span></span><span> </span><span id="local-6989586621681680141"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680141"><span class="hs-identifier hs-var">pkgstate</span></a></span></span><span> </span><span id="local-6989586621681680142"><span class="annot"><span class="annottext">PackageName
</span><a href="#local-6989586621681680142"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM PackageName UnitId -&gt; PackageName -&gt; Maybe UnitId
forall key elt. Uniquable key =&gt; UniqFM key elt -&gt; key -&gt; Maybe elt
</span><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UniqFM PackageName UnitId
</span><a href="GHC.Unit.State.html#packageNameMap"><span class="hs-identifier hs-var">packageNameMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680141"><span class="hs-identifier hs-var">pkgstate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PackageName
</span><a href="#local-6989586621681680142"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="annot"><span class="hs-comment">-- | Search for units with a given package ID (e.g. \&quot;foo-0.1\&quot;)</span></span><span>
</span><span id="line-573"></span><span class="annot"><a href="GHC.Unit.State.html#searchPackageId"><span class="hs-identifier hs-type">searchPackageId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#PackageId"><span class="hs-identifier hs-type">PackageId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-574"></span><span id="searchPackageId"><span class="annot"><span class="annottext">searchPackageId :: UnitState -&gt; PackageId -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#searchPackageId"><span class="hs-identifier hs-var hs-var">searchPackageId</span></a></span></span><span> </span><span id="local-6989586621681680144"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680144"><span class="hs-identifier hs-var">pkgstate</span></a></span></span><span> </span><span id="local-6989586621681680145"><span class="annot"><span class="annottext">PackageId
</span><a href="#local-6989586621681680145"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackageId
</span><a href="#local-6989586621681680145"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PackageId -&gt; PackageId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PackageId -&gt; Bool) -&gt; (UnitInfo -&gt; PackageId) -&gt; UnitInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; PackageId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; srcpkgid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitPackageId/GHC.Unit.Database.html#unitPackageId"><span class="hs-identifier hs-var">unitPackageId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#listUnitInfo"><span class="hs-identifier hs-var">listUnitInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680144"><span class="hs-identifier hs-var">pkgstate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="hs-comment">-- | Find the UnitId which an import qualified by a package import comes from.</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- Compared to 'lookupPackageName', this function correctly accounts for visibility,</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- renaming and thinning.</span><span>
</span><span id="line-580"></span><span class="annot"><a href="GHC.Unit.State.html#resolvePackageImport"><span class="hs-identifier hs-type">resolvePackageImport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#PackageName"><span class="hs-identifier hs-type">PackageName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-581"></span><span id="resolvePackageImport"><span class="annot"><span class="annottext">resolvePackageImport :: UnitState -&gt; ModuleName -&gt; PackageName -&gt; Maybe UnitId
</span><a href="GHC.Unit.State.html#resolvePackageImport"><span class="hs-identifier hs-var hs-var">resolvePackageImport</span></a></span></span><span> </span><span id="local-6989586621681680147"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680147"><span class="hs-identifier hs-var">unit_st</span></a></span></span><span> </span><span id="local-6989586621681680148"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680148"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621681680149"><span class="annot"><span class="annottext">PackageName
</span><a href="#local-6989586621681680149"><span class="hs-identifier hs-var">pn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-comment">-- 1. Find all modules providing the ModuleName (this accounts for visibility/thinning etc)</span><span>
</span><span id="line-583"></span><span>  </span><span id="local-6989586621681680150"><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680150"><span class="hs-identifier hs-var">providers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ModuleOrigin -&gt; Bool)
-&gt; Map Module ModuleOrigin -&gt; Map Module ModuleOrigin
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#filter/Data.Map.Internal.html#filter"><span class="hs-identifier hs-var">Map.filter</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Module ModuleOrigin -&gt; Map Module ModuleOrigin)
-&gt; Maybe (Map Module ModuleOrigin)
-&gt; Maybe (Map Module ModuleOrigin)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; ModuleNameProvidersMap -&gt; Maybe (Map Module ModuleOrigin)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680148"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680147"><span class="hs-identifier hs-var">unit_st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-comment">-- 2. Get the UnitIds of the candidates</span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680153"><span class="annot"><span class="annottext">candidates_uid :: [UnitId]
</span><a href="#local-6989586621681680153"><span class="hs-identifier hs-var hs-var">candidates_uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Module, ModuleOrigin) -&gt; [UnitId])
-&gt; [(Module, ModuleOrigin)] -&gt; [UnitId]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, ModuleOrigin) -&gt; [UnitId]
</span><a href="#local-6989586621681680155"><span class="hs-identifier hs-var">to_uid</span></a></span><span> </span><span class="annot"><span class="annottext">([(Module, ModuleOrigin)] -&gt; [UnitId])
-&gt; [(Module, ModuleOrigin)] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module ModuleOrigin -&gt; [(Module, ModuleOrigin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#assocs/Data.Map.Internal.html#assocs"><span class="hs-identifier hs-var">Map.assocs</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680150"><span class="hs-identifier hs-var">providers</span></a></span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-comment">-- 3. Get the package names of the candidates</span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680157"><span class="annot"><span class="annottext">candidates_units :: [(PackageName, UnitId)]
</span><a href="#local-6989586621681680157"><span class="hs-identifier hs-var hs-var">candidates_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; (PackageName, UnitId))
-&gt; [UnitInfo] -&gt; [(PackageName, UnitId)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681680158"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680158"><span class="hs-identifier hs-var">ui</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; PackageName
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; srcpkgname
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitPackageName/GHC.Unit.Database.html#unitPackageName"><span class="hs-identifier hs-var">unitPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680158"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680158"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>                              </span><span class="annot"><span class="annottext">([UnitInfo] -&gt; [(PackageName, UnitId)])
-&gt; [UnitInfo] -&gt; [(PackageName, UnitId)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Maybe UnitInfo) -&gt; [UnitId] -&gt; [UnitInfo]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681680162"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680162"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Maybe UnitInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680162"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680147"><span class="hs-identifier hs-var">unit_st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680153"><span class="hs-identifier hs-var">candidates_uid</span></a></span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-comment">-- 4. Check to see if the PackageName helps us disambiguate any candidates.</span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><span class="annottext">PackageName -&gt; [(PackageName, UnitId)] -&gt; Maybe UnitId
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.18.3.0/src/GHC.List.html#lookup/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">PackageName
</span><a href="#local-6989586621681680149"><span class="hs-identifier hs-var">pn</span></a></span><span> </span><span class="annot"><span class="annottext">[(PackageName, UnitId)]
</span><a href="#local-6989586621681680157"><span class="hs-identifier hs-var">candidates_units</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-593"></span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-comment">-- Get the UnitId from which a visible identifier is from</span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><a href="#local-6989586621681680155"><span class="hs-identifier hs-type">to_uid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-596"></span><span>    </span><span id="local-6989586621681680155"><span class="annot"><span class="annottext">to_uid :: (Module, ModuleOrigin) -&gt; [UnitId]
</span><a href="#local-6989586621681680155"><span class="hs-identifier hs-var hs-var">to_uid</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680164"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680164"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span id="local-6989586621681680165"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681680165"><span class="hs-identifier hs-var">mo</span></a></span></span><span> </span><span id="local-6989586621681680166"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680166"><span class="hs-identifier hs-var">re_exps</span></a></span></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-597"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681680165"><span class="hs-identifier hs-var">mo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-comment">-- Available directly, but also potentially from re-exports</span><span>
</span><span id="line-599"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680164"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; [UnitId] -&gt; [UnitId]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitId) -&gt; [UnitInfo] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680166"><span class="hs-identifier hs-var">re_exps</span></a></span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-comment">-- Just available from these re-exports</span><span>
</span><span id="line-601"></span><span>        </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitId) -&gt; [UnitInfo] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680166"><span class="hs-identifier hs-var">re_exps</span></a></span><span>
</span><span id="line-602"></span><span>    </span><span class="annot"><a href="#local-6989586621681680155"><span class="hs-identifier hs-var">to_uid</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="hs-comment">-- | Create a Map UnitId UnitInfo</span><span>
</span><span id="line-605"></span><span class="hs-comment">--</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- For each instantiated unit, we add two map keys:</span><span>
</span><span id="line-607"></span><span class="hs-comment">--    * the real unit id</span><span>
</span><span id="line-608"></span><span class="hs-comment">--    * the virtual unit id made from its instantiation</span><span>
</span><span id="line-609"></span><span class="hs-comment">--</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- We do the same thing for fully indefinite units (which are &quot;instantiated&quot;</span><span>
</span><span id="line-611"></span><span class="hs-comment">-- with module holes).</span><span>
</span><span id="line-612"></span><span class="hs-comment">--</span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.Unit.State.html#mkUnitInfoMap"><span class="hs-identifier hs-type">mkUnitInfoMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-614"></span><span id="mkUnitInfoMap"><span class="annot"><span class="annottext">mkUnitInfoMap :: [UnitInfo] -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#mkUnitInfoMap"><span class="hs-identifier hs-var hs-var">mkUnitInfoMap</span></a></span></span><span> </span><span id="local-6989586621681680170"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680170"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfoMap -&gt; UnitInfo -&gt; UnitInfoMap)
-&gt; UnitInfoMap -&gt; [UnitInfo] -&gt; UnitInfoMap
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfo -&gt; UnitInfoMap
forall {srcpkgid} {srcpkgname}.
Map
  UnitId
  (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
</span><a href="#local-6989586621681680172"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680170"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-616"></span><span>   </span><span id="local-6989586621681680174"><span class="annot"><span class="annottext">mkVirt :: GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; UnitId
</span><a href="#local-6989586621681680174"><span class="hs-identifier hs-var hs-var">mkVirt</span></a></span></span><span>      </span><span id="local-6989586621681680175"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680175"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#virtualUnitId"><span class="hs-identifier hs-var">virtualUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; [(ModuleName, Module)] -&gt; GenInstantiatedUnit UnitId
forall u.
IsUnitId u =&gt;
u -&gt; GenInstantiations u -&gt; GenInstantiatedUnit u
</span><a href="GHC.Unit.Types.html#mkInstantiatedUnit"><span class="hs-identifier hs-var">mkInstantiatedUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstanceOf/GHC.Unit.Database.html#unitInstanceOf"><span class="hs-identifier hs-var">unitInstanceOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680175"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; [(ModuleName, Module)]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [(modulename, mod)]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstantiations/GHC.Unit.Database.html#unitInstantiations"><span class="hs-identifier hs-var">unitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680175"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>   </span><span id="local-6989586621681680172"><span class="annot"><span class="annottext">add :: Map
  UnitId
  (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
</span><a href="#local-6989586621681680172"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621681680183"><span class="annot"><span class="annottext">Map
  UnitId
  (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
</span><a href="#local-6989586621681680183"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680184"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-618"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ModuleName, Module)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; [(ModuleName, Module)]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [(modulename, mod)]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstantiations/GHC.Unit.Database.html#unitInstantiations"><span class="hs-identifier hs-var">unitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; UnitId
forall {srcpkgid} {srcpkgname}.
GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; UnitId
</span><a href="#local-6989586621681680174"><span class="hs-identifier hs-var">mkVirt</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-620"></span><span>         </span><span class="annot"><span class="annottext">(Map
   UnitId
   (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
 -&gt; Map
      UnitId
      (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module))
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-621"></span><span>         </span><span class="annot"><span class="annottext">(Map
   UnitId
   (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
 -&gt; Map
      UnitId
      (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module))
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  UnitId
  (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
</span><a href="#local-6989586621681680183"><span class="hs-identifier hs-var">pkg_map</span></a></span><span>
</span><span id="line-622"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-623"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
-&gt; Map
     UnitId
     (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
-&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module
</span><a href="#local-6989586621681680184"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  UnitId
  (GenericUnitInfo srcpkgid srcpkgname UnitId ModuleName Module)
</span><a href="#local-6989586621681680183"><span class="hs-identifier hs-var">pkg_map</span></a></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="hs-comment">-- | Get a list of entries from the unit database.  NB: be careful with</span><span>
</span><span id="line-626"></span><span class="hs-comment">-- this function, although all units in this map are &quot;visible&quot;, this</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- does not imply that the exposed-modules of the unit are available</span><span>
</span><span id="line-628"></span><span class="hs-comment">-- (they may have been thinned or renamed).</span><span>
</span><span id="line-629"></span><span class="annot"><a href="GHC.Unit.State.html#listUnitInfo"><span class="hs-identifier hs-type">listUnitInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span id="listUnitInfo"><span class="annot"><span class="annottext">listUnitInfo :: UnitState -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#listUnitInfo"><span class="hs-identifier hs-var hs-var">listUnitInfo</span></a></span></span><span> </span><span id="local-6989586621681680186"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680186"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; [UnitInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680186"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-633"></span><span class="hs-comment">-- Loading the unit db files and building up the unit state</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span class="hs-comment">-- | Read the unit database files, and sets up various internal tables of</span><span>
</span><span id="line-636"></span><span class="hs-comment">-- unit information, according to the unit-related flags on the</span><span>
</span><span id="line-637"></span><span class="hs-comment">-- command-line (@-package@, @-hide-package@ etc.)</span><span>
</span><span id="line-638"></span><span class="hs-comment">--</span><span>
</span><span id="line-639"></span><span class="hs-comment">-- 'initUnits' can be called again subsequently after updating the</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- 'packageFlags' field of the 'DynFlags', and it will update the</span><span>
</span><span id="line-641"></span><span class="hs-comment">-- 'unitState' in 'DynFlags'.</span><span>
</span><span id="line-642"></span><span class="annot"><a href="GHC.Unit.State.html#initUnits"><span class="hs-identifier hs-type">initUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.Constants.html#PlatformConstants"><span class="hs-identifier hs-type">PlatformConstants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span id="initUnits"><span class="annot"><span class="annottext">initUnits :: Logger
-&gt; DynFlags
-&gt; Maybe [UnitDatabase UnitId]
-&gt; Set UnitId
-&gt; IO
     ([UnitDatabase UnitId], UnitState, HomeUnit,
      Maybe PlatformConstants)
</span><a href="GHC.Unit.State.html#initUnits"><span class="hs-identifier hs-var hs-var">initUnits</span></a></span></span><span> </span><span id="local-6989586621681680188"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680188"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680189"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680189"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681680190"><span class="annot"><span class="annottext">Maybe [UnitDatabase UnitId]
</span><a href="#local-6989586621681680190"><span class="hs-identifier hs-var">cached_dbs</span></a></span></span><span> </span><span id="local-6989586621681680191"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680191"><span class="hs-identifier hs-var">home_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680192"><span class="annot"><span class="annottext">forceUnitInfoMap :: (UnitState, b) -&gt; ()
</span><a href="#local-6989586621681680192"><span class="hs-identifier hs-var hs-var">forceUnitInfoMap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680193"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680193"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680193"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681680194"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680194"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680195"><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680195"><span class="hs-identifier hs-var">dbs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; ((UnitState, [UnitDatabase UnitId]) -&gt; ())
-&gt; IO (UnitState, [UnitDatabase UnitId])
-&gt; IO (UnitState, [UnitDatabase UnitId])
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680188"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initializing unit database&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>                   </span><span class="annot"><span class="annottext">(UnitState, [UnitDatabase UnitId]) -&gt; ()
forall {b}. (UnitState, b) -&gt; ()
</span><a href="#local-6989586621681680192"><span class="hs-identifier hs-var">forceUnitInfoMap</span></a></span><span>
</span><span id="line-649"></span><span>                 </span><span class="annot"><span class="annottext">(IO (UnitState, [UnitDatabase UnitId])
 -&gt; IO (UnitState, [UnitDatabase UnitId]))
-&gt; IO (UnitState, [UnitDatabase UnitId])
-&gt; IO (UnitState, [UnitDatabase UnitId])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; UnitConfig -&gt; IO (UnitState, [UnitDatabase UnitId])
</span><a href="GHC.Unit.State.html#mkUnitState"><span class="hs-identifier hs-var">mkUnitState</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680188"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe [UnitDatabase UnitId] -&gt; Set UnitId -&gt; UnitConfig
</span><a href="GHC.Unit.State.html#initUnitConfig"><span class="hs-identifier hs-var">initUnitConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680189"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [UnitDatabase UnitId]
</span><a href="#local-6989586621681680190"><span class="hs-identifier hs-var">cached_dbs</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680191"><span class="hs-identifier hs-var">home_units</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680188"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_mod_map"><span class="hs-identifier hs-var">Opt_D_dump_mod_map</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Module Map&quot;</span></span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SDocContext -&gt; SDocContext) -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#updSDocContext"><span class="hs-identifier hs-var">updSDocContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681680202"><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621681680202"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621681680202"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Utils.Outputable.html#sdocLineLength"><span class="hs-identifier hs-var">sdocLineLength</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">200</span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>                </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprModuleMap"><span class="hs-identifier hs-var">pprModuleMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680194"><span class="hs-identifier hs-var">unit_state</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680204"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621681680204"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState
-&gt; UnitId -&gt; Maybe UnitId -&gt; [(ModuleName, Module)] -&gt; HomeUnit
</span><a href="GHC.Unit.State.html#mkHomeUnit"><span class="hs-identifier hs-var">mkHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680194"><span class="hs-identifier hs-var">unit_state</span></a></span><span>
</span><span id="line-656"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680189"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe UnitId
</span><a href="GHC.Driver.Session.html#homeUnitInstanceOf_"><span class="hs-identifier hs-var">homeUnitInstanceOf_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680189"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [(ModuleName, Module)]
</span><a href="GHC.Driver.Session.html#homeUnitInstantiations_"><span class="hs-identifier hs-var">homeUnitInstantiations_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680189"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-comment">-- Try to find platform constants</span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-comment">-- See Note [Platform constants] in GHC.Platform</span><span>
</span><span id="line-663"></span><span>  </span><span id="local-6989586621681680206"><span class="annot"><span class="annottext">Maybe PlatformConstants
</span><a href="#local-6989586621681680206"><span class="hs-identifier hs-var">mconstants</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680189"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span>
</span><span id="line-664"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-665"></span><span>      </span><span class="hs-comment">-- we're building the RTS! Lookup DerivedConstants.h in the include paths</span><span>
</span><span id="line-666"></span><span>      </span><span class="annot"><span class="annottext">[String] -&gt; IO (Maybe PlatformConstants)
</span><a href="GHC.Platform.html#lookupPlatformConstants"><span class="hs-identifier hs-var">lookupPlatformConstants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsGlobal"><span class="hs-identifier hs-var">includePathsGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681680189"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-comment">-- lookup the DerivedConstants.h header bundled with the RTS unit. We</span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-comment">-- don't fail if we can't find the RTS unit as it can be a valid (but</span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-comment">-- uncommon) case, e.g. building a C utility program (not depending on the</span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-comment">-- RTS) before building the RTS. In any case, we will fail later on if we</span><span>
</span><span id="line-672"></span><span>      </span><span class="hs-comment">-- really need to use the platform constants but they have not been loaded.</span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId"><span class="hs-identifier hs-var">lookupUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680194"><span class="hs-identifier hs-var">unit_state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-674"></span><span>        </span><span class="annot"><span class="annottext">Maybe UnitInfo
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe PlatformConstants -&gt; IO (Maybe PlatformConstants)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PlatformConstants
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680210"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680210"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO (Maybe PlatformConstants)
</span><a href="GHC.Platform.html#lookupPlatformConstants"><span class="hs-identifier hs-var">lookupPlatformConstants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ShortText -&gt; String) -&gt; [ShortText] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ShortText -&gt; String
</span><a href="../../ghc-boot-9.6.7/src/GHC.Data.ShortText.html#unpack/GHC.Data.ShortText.html#unpack"><span class="hs-identifier hs-var">ST.unpack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; [ShortText]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [ShortText]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIncludeDirs/GHC.Unit.Database.html#unitIncludeDirs"><span class="hs-identifier hs-var">unitIncludeDirs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680210"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><span class="annottext">([UnitDatabase UnitId], UnitState, HomeUnit,
 Maybe PlatformConstants)
-&gt; IO
     ([UnitDatabase UnitId], UnitState, HomeUnit,
      Maybe PlatformConstants)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680195"><span class="hs-identifier hs-var">dbs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680194"><span class="hs-identifier hs-var">unit_state</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621681680204"><span class="hs-identifier hs-var">home_unit</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe PlatformConstants
</span><a href="#local-6989586621681680206"><span class="hs-identifier hs-var">mconstants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="annot"><a href="GHC.Unit.State.html#mkHomeUnit"><span class="hs-identifier hs-type">mkHomeUnit</span></a></span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-681"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>                 </span><span class="annot"><span class="hs-comment">-- ^ Home unit id</span></span><span>
</span><span id="line-682"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ Home unit instance of</span></span><span>
</span><span id="line-683"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Home unit instantiations</span></span><span>
</span><span id="line-684"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span>
</span><span id="line-685"></span><span id="mkHomeUnit"><span class="annot"><span class="annottext">mkHomeUnit :: UnitState
-&gt; UnitId -&gt; Maybe UnitId -&gt; [(ModuleName, Module)] -&gt; HomeUnit
</span><a href="GHC.Unit.State.html#mkHomeUnit"><span class="hs-identifier hs-var hs-var">mkHomeUnit</span></a></span></span><span> </span><span id="local-6989586621681680213"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680213"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span id="local-6989586621681680214"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680214"><span class="hs-identifier hs-var">hu_id</span></a></span></span><span> </span><span id="local-6989586621681680215"><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681680215"><span class="hs-identifier hs-var">hu_instanceof</span></a></span></span><span> </span><span id="local-6989586621681680216"><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680216"><span class="hs-identifier hs-var">hu_instantiations_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-686"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-comment">-- Some wired units can be used to instantiate the home unit. We need to</span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-comment">-- replace their unit keys with their wired unit ids.</span><span>
</span><span id="line-689"></span><span>        </span><span id="local-6989586621681680217"><span class="annot"><span class="annottext">wmap :: Map UnitId UnitId
</span><a href="#local-6989586621681680217"><span class="hs-identifier hs-var hs-var">wmap</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; Map UnitId UnitId
</span><a href="GHC.Unit.State.html#wireMap"><span class="hs-identifier hs-var">wireMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680213"><span class="hs-identifier hs-var">unit_state</span></a></span><span>
</span><span id="line-690"></span><span>        </span><span id="local-6989586621681680218"><span class="annot"><span class="annottext">hu_instantiations :: [(ModuleName, Module)]
</span><a href="#local-6989586621681680218"><span class="hs-identifier hs-var hs-var">hu_instantiations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ModuleName, Module) -&gt; (ModuleName, Module))
-&gt; [(ModuleName, Module)] -&gt; [(ModuleName, Module)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module -&gt; Module) -&gt; (ModuleName, Module) -&gt; (ModuleName, Module)
forall a b. (a -&gt; b) -&gt; (ModuleName, a) -&gt; (ModuleName, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; Module -&gt; Module
</span><a href="GHC.Unit.State.html#upd_wired_in_mod"><span class="hs-identifier hs-var">upd_wired_in_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680217"><span class="hs-identifier hs-var">wmap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680216"><span class="hs-identifier hs-var">hu_instantiations_</span></a></span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681680215"><span class="hs-identifier hs-var">hu_instanceof</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680218"><span class="hs-identifier hs-var">hu_instantiations</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-692"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Maybe (UnitId, [(ModuleName, Module)]) -&gt; HomeUnit
forall u. UnitId -&gt; Maybe (u, GenInstantiations u) -&gt; GenHomeUnit u
</span><a href="GHC.Unit.Home.html#DefiniteHomeUnit"><span class="hs-identifier hs-var">DefiniteHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680214"><span class="hs-identifier hs-var">hu_id</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UnitId, [(ModuleName, Module)])
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-693"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; HomeUnit
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; HomeUnit) -&gt; GhcException -&gt; HomeUnit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Use of -instantiated-with requires -this-component-id&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; HomeUnit
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; HomeUnit) -&gt; GhcException -&gt; HomeUnit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Use of -this-component-id requires -instantiated-with&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680223"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680223"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680224"><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680224"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>         </span><span class="hs-comment">-- detect fully indefinite units: all their instantiations are hole</span><span>
</span><span id="line-697"></span><span>         </span><span class="hs-comment">-- modules and the home unit id is the same as the instantiating unit</span><span>
</span><span id="line-698"></span><span>         </span><span class="hs-comment">-- id (see Note [About units] in GHC.Unit)</span><span>
</span><span id="line-699"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">((ModuleName, Module) -&gt; Bool) -&gt; [(ModuleName, Module)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Bool
forall u. GenModule (GenUnit u) -&gt; Bool
</span><a href="GHC.Unit.Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; Bool)
-&gt; ((ModuleName, Module) -&gt; Module) -&gt; (ModuleName, Module) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, Module) -&gt; Module
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680224"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680223"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680214"><span class="hs-identifier hs-var">hu_id</span></a></span><span>
</span><span id="line-700"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; [(ModuleName, Module)] -&gt; HomeUnit
forall u. UnitId -&gt; GenInstantiations u -&gt; GenHomeUnit u
</span><a href="GHC.Unit.Home.html#IndefiniteHomeUnit"><span class="hs-identifier hs-var">IndefiniteHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680223"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680224"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-701"></span><span>         </span><span class="hs-comment">-- otherwise it must be that we (fully) instantiate an indefinite unit</span><span>
</span><span id="line-702"></span><span>         </span><span class="hs-comment">-- to make it definite.</span><span>
</span><span id="line-703"></span><span>         </span><span class="hs-comment">-- TODO: error when the unit is partially instantiated??</span><span>
</span><span id="line-704"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-705"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Maybe (UnitId, [(ModuleName, Module)]) -&gt; HomeUnit
forall u. UnitId -&gt; Maybe (u, GenInstantiations u) -&gt; GenHomeUnit u
</span><a href="GHC.Unit.Home.html#DefiniteHomeUnit"><span class="hs-identifier hs-var">DefiniteHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680214"><span class="hs-identifier hs-var">hu_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId, [(ModuleName, Module)])
-&gt; Maybe (UnitId, [(ModuleName, Module)])
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680223"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680224"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-708"></span><span class="hs-comment">-- Reading the unit database(s)</span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span class="annot"><a href="GHC.Unit.State.html#readUnitDatabases"><span class="hs-identifier hs-type">readUnitDatabases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-711"></span><span id="readUnitDatabases"><span class="annot"><span class="annottext">readUnitDatabases :: Logger -&gt; UnitConfig -&gt; IO [UnitDatabase UnitId]
</span><a href="GHC.Unit.State.html#readUnitDatabases"><span class="hs-identifier hs-var hs-var">readUnitDatabases</span></a></span></span><span> </span><span id="local-6989586621681680227"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680227"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680228"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680228"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-712"></span><span>  </span><span id="local-6989586621681680229"><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680229"><span class="hs-identifier hs-var">conf_refs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; IO [PkgDbRef]
</span><a href="GHC.Unit.State.html#getUnitDbRefs"><span class="hs-identifier hs-var">getUnitDbRefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680228"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-713"></span><span>  </span><span id="local-6989586621681680230"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681680230"><span class="hs-identifier hs-var">confs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Maybe String] -&gt; [String]) -&gt; IO [Maybe String] -&gt; IO [String]
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#liftM/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe String] -&gt; [String]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#catMaybes/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Maybe String] -&gt; IO [String])
-&gt; IO [Maybe String] -&gt; IO [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(PkgDbRef -&gt; IO (Maybe String)) -&gt; [PkgDbRef] -&gt; IO [Maybe String]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; PkgDbRef -&gt; IO (Maybe String)
</span><a href="GHC.Unit.State.html#resolveUnitDatabase"><span class="hs-identifier hs-var">resolveUnitDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680228"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680229"><span class="hs-identifier hs-var">conf_refs</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span class="annot"><span class="annottext">(String -&gt; IO (UnitDatabase UnitId))
-&gt; [String] -&gt; IO [UnitDatabase UnitId]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; UnitConfig -&gt; String -&gt; IO (UnitDatabase UnitId)
</span><a href="GHC.Unit.State.html#readUnitDatabase"><span class="hs-identifier hs-var">readUnitDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680227"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680228"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681680230"><span class="hs-identifier hs-var">confs</span></a></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span class="annot"><a href="GHC.Unit.State.html#getUnitDbRefs"><span class="hs-identifier hs-type">getUnitDbRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#PkgDbRef"><span class="hs-identifier hs-type">PkgDbRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-718"></span><span id="getUnitDbRefs"><span class="annot"><span class="annottext">getUnitDbRefs :: UnitConfig -&gt; IO [PkgDbRef]
</span><a href="GHC.Unit.State.html#getUnitDbRefs"><span class="hs-identifier hs-var hs-var">getUnitDbRefs</span></a></span></span><span> </span><span id="local-6989586621681680234"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680234"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-719"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680235"><span class="annot"><span class="annottext">system_conf_refs :: [PkgDbRef]
</span><a href="#local-6989586621681680235"><span class="hs-identifier hs-var hs-var">system_conf_refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PkgDbRef
</span><a href="GHC.Driver.Session.html#UserPkgDb"><span class="hs-identifier hs-var">UserPkgDb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><a href="GHC.Driver.Session.html#GlobalPkgDb"><span class="hs-identifier hs-var">GlobalPkgDb</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>  </span><span id="local-6989586621681680238"><span class="annot"><span class="annottext">Either IOException String
</span><a href="#local-6989586621681680238"><span class="hs-identifier hs-var">e_pkg_path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; IO (Either IOException String)
forall a. IO a -&gt; IO (Either IOException a)
</span><a href="GHC.Utils.Exception.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="../../base-4.18.3.0/src/System.Environment.html#getEnv/System.Environment.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="../../base-4.18.3.0/src/GHC.Unicode.html#toUpper/GHC.Unicode.html#toUpper"><span class="hs-identifier hs-var">toUpper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigProgramName"><span class="hs-identifier hs-var">unitConfigProgramName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680234"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_PACKAGE_PATH&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680240"><span class="annot"><span class="annottext">base_conf_refs :: [PkgDbRef]
</span><a href="#local-6989586621681680240"><span class="hs-identifier hs-var hs-var">base_conf_refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException String
</span><a href="#local-6989586621681680238"><span class="hs-identifier hs-var">e_pkg_path</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-723"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680235"><span class="hs-identifier hs-var">system_conf_refs</span></a></span><span>
</span><span id="line-724"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681680241"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680241"><span class="hs-identifier hs-var">path</span></a></span></span><span>
</span><span id="line-725"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680242"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680242"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680243"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681680243"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe (String, Char)
forall a. [a] -&gt; Maybe ([a], a)
</span><a href="GHC.Utils.Misc.html#snocView"><span class="hs-identifier hs-var">snocView</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680241"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#isSearchPathSeparator/System.FilePath.Posix.html#isSearchPathSeparator"><span class="hs-identifier hs-var">isSearchPathSeparator</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681680243"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-726"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(String -&gt; PkgDbRef) -&gt; [String] -&gt; [PkgDbRef]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; PkgDbRef
</span><a href="GHC.Driver.Session.html#PkgDbPath"><span class="hs-identifier hs-var">PkgDbPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#splitSearchPath/System.FilePath.Posix.html#splitSearchPath"><span class="hs-identifier hs-var">splitSearchPath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680242"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PkgDbRef] -&gt; [PkgDbRef] -&gt; [PkgDbRef]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680235"><span class="hs-identifier hs-var">system_conf_refs</span></a></span><span>
</span><span id="line-727"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-728"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(String -&gt; PkgDbRef) -&gt; [String] -&gt; [PkgDbRef]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; PkgDbRef
</span><a href="GHC.Driver.Session.html#PkgDbPath"><span class="hs-identifier hs-var">PkgDbPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#splitSearchPath/System.FilePath.Posix.html#splitSearchPath"><span class="hs-identifier hs-var">splitSearchPath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680241"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-comment">-- Apply the package DB-related flags from the command line to get the</span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-comment">-- final list of package DBs.</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-comment">-- Notes on ordering:</span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-comment">--  * The list of flags is reversed (later ones first)</span><span>
</span><span id="line-735"></span><span>  </span><span class="hs-comment">--  * We work with the package DB list in &quot;left shadows right&quot; order</span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-comment">--  * and finally reverse it at the end, to get &quot;right shadows left&quot;</span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-738"></span><span>  </span><span class="annot"><span class="annottext">[PkgDbRef] -&gt; IO [PkgDbRef]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([PkgDbRef] -&gt; IO [PkgDbRef]) -&gt; [PkgDbRef] -&gt; IO [PkgDbRef]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[PkgDbRef] -&gt; [PkgDbRef]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PackageDBFlag -&gt; [PkgDbRef] -&gt; [PkgDbRef])
-&gt; [PkgDbRef] -&gt; [PackageDBFlag] -&gt; [PkgDbRef]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">PackageDBFlag -&gt; [PkgDbRef] -&gt; [PkgDbRef]
</span><a href="#local-6989586621681680249"><span class="hs-identifier hs-var">doFlag</span></a></span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680240"><span class="hs-identifier hs-var">base_conf_refs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; [PackageDBFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsDB"><span class="hs-identifier hs-var">unitConfigFlagsDB</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680234"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-740"></span><span>  </span><span id="local-6989586621681680249"><span class="annot"><span class="annottext">doFlag :: PackageDBFlag -&gt; [PkgDbRef] -&gt; [PkgDbRef]
</span><a href="#local-6989586621681680249"><span class="hs-identifier hs-var hs-var">doFlag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a></span><span> </span><span id="local-6989586621681680250"><span class="annot"><span class="annottext">PkgDbRef
</span><a href="#local-6989586621681680250"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681680251"><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680251"><span class="hs-identifier hs-var">dbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><a href="#local-6989586621681680250"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PkgDbRef -&gt; [PkgDbRef] -&gt; [PkgDbRef]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680251"><span class="hs-identifier hs-var">dbs</span></a></span><span>
</span><span id="line-741"></span><span>  </span><span class="annot"><a href="#local-6989586621681680249"><span class="hs-identifier hs-var">doFlag</span></a></span><span> </span><span class="annot"><span class="annottext">PackageDBFlag
</span><a href="GHC.Driver.Session.html#NoUserPackageDB"><span class="hs-identifier hs-var">NoUserPackageDB</span></a></span><span> </span><span id="local-6989586621681680253"><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680253"><span class="hs-identifier hs-var">dbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PkgDbRef -&gt; Bool) -&gt; [PkgDbRef] -&gt; [PkgDbRef]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">PkgDbRef -&gt; Bool
</span><a href="#local-6989586621681680254"><span class="hs-identifier hs-var">isNotUser</span></a></span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680253"><span class="hs-identifier hs-var">dbs</span></a></span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><a href="#local-6989586621681680249"><span class="hs-identifier hs-var">doFlag</span></a></span><span> </span><span class="annot"><span class="annottext">PackageDBFlag
</span><a href="GHC.Driver.Session.html#NoGlobalPackageDB"><span class="hs-identifier hs-var">NoGlobalPackageDB</span></a></span><span> </span><span id="local-6989586621681680256"><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680256"><span class="hs-identifier hs-var">dbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PkgDbRef -&gt; Bool) -&gt; [PkgDbRef] -&gt; [PkgDbRef]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">PkgDbRef -&gt; Bool
</span><a href="#local-6989586621681680257"><span class="hs-identifier hs-var">isNotGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><a href="#local-6989586621681680256"><span class="hs-identifier hs-var">dbs</span></a></span><span>
</span><span id="line-743"></span><span>  </span><span class="annot"><a href="#local-6989586621681680249"><span class="hs-identifier hs-var">doFlag</span></a></span><span> </span><span class="annot"><span class="annottext">PackageDBFlag
</span><a href="GHC.Driver.Session.html#ClearPackageDBs"><span class="hs-identifier hs-var">ClearPackageDBs</span></a></span><span> </span><span class="annot"><span class="annottext">[PkgDbRef]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span>  </span><span id="local-6989586621681680254"><span class="annot"><span class="annottext">isNotUser :: PkgDbRef -&gt; Bool
</span><a href="#local-6989586621681680254"><span class="hs-identifier hs-var hs-var">isNotUser</span></a></span></span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><a href="GHC.Driver.Session.html#UserPkgDb"><span class="hs-identifier hs-var">UserPkgDb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-746"></span><span>  </span><span class="annot"><a href="#local-6989586621681680254"><span class="hs-identifier hs-var">isNotUser</span></a></span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span>  </span><span id="local-6989586621681680257"><span class="annot"><span class="annottext">isNotGlobal :: PkgDbRef -&gt; Bool
</span><a href="#local-6989586621681680257"><span class="hs-identifier hs-var hs-var">isNotGlobal</span></a></span></span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><a href="GHC.Driver.Session.html#GlobalPkgDb"><span class="hs-identifier hs-var">GlobalPkgDb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-749"></span><span>  </span><span class="annot"><a href="#local-6989586621681680257"><span class="hs-identifier hs-var">isNotGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span class="hs-comment">-- | Return the path of a package database from a 'PkgDbRef'. Return 'Nothing'</span><span>
</span><span id="line-752"></span><span class="hs-comment">-- when the user database filepath is expected but the latter doesn't exist.</span><span>
</span><span id="line-753"></span><span class="hs-comment">--</span><span>
</span><span id="line-754"></span><span class="hs-comment">-- NB: This logic is reimplemented in Cabal, so if you change it,</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- make sure you update Cabal. (Or, better yet, dump it in the</span><span>
</span><span id="line-756"></span><span class="hs-comment">-- compiler info so Cabal can use the info.)</span><span>
</span><span id="line-757"></span><span class="annot"><a href="GHC.Unit.State.html#resolveUnitDatabase"><span class="hs-identifier hs-type">resolveUnitDatabase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PkgDbRef"><span class="hs-identifier hs-type">PkgDbRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span id="resolveUnitDatabase"><span class="annot"><span class="annottext">resolveUnitDatabase :: UnitConfig -&gt; PkgDbRef -&gt; IO (Maybe String)
</span><a href="GHC.Unit.State.html#resolveUnitDatabase"><span class="hs-identifier hs-var hs-var">resolveUnitDatabase</span></a></span></span><span> </span><span id="local-6989586621681680259"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680259"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><a href="GHC.Driver.Session.html#GlobalPkgDb"><span class="hs-identifier hs-var">GlobalPkgDb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; IO (Maybe String))
-&gt; Maybe String -&gt; IO (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigGlobalDB"><span class="hs-identifier hs-var">unitConfigGlobalDB</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680259"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span class="annot"><a href="GHC.Unit.State.html#resolveUnitDatabase"><span class="hs-identifier hs-var">resolveUnitDatabase</span></a></span><span> </span><span id="local-6989586621681680260"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680260"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="annot"><span class="annottext">PkgDbRef
</span><a href="GHC.Driver.Session.html#UserPkgDb"><span class="hs-identifier hs-var">UserPkgDb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT IO String -&gt; IO (Maybe String)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#runMaybeT/Control.Monad.Trans.Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT IO String -&gt; IO (Maybe String))
-&gt; MaybeT IO String -&gt; IO (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-760"></span><span>  </span><span id="local-6989586621681680262"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680262"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; ArchOS -&gt; MaybeT IO String
</span><a href="GHC.Driver.Session.html#versionedAppDir"><span class="hs-identifier hs-var">versionedAppDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigProgramName"><span class="hs-identifier hs-var">unitConfigProgramName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680260"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; ArchOS
</span><a href="GHC.Unit.State.html#unitConfigPlatformArchOS"><span class="hs-identifier hs-var">unitConfigPlatformArchOS</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680260"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680264"><span class="annot"><span class="annottext">pkgconf :: String
</span><a href="#local-6989586621681680264"><span class="hs-identifier hs-var hs-var">pkgconf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680262"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigDBName"><span class="hs-identifier hs-var">unitConfigDBName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680260"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-762"></span><span>  </span><span id="local-6989586621681680265"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680265"><span class="hs-identifier hs-var">exist</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; MaybeT IO Bool
forall a. IO a -&gt; MaybeT IO a
</span><a href="GHC.Data.Maybe.html#tryMaybeT"><span class="hs-identifier hs-var">tryMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; MaybeT IO Bool) -&gt; IO Bool -&gt; MaybeT IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#doesDirectoryExist/System.Directory.html#doesDirectoryExist"><span class="hs-identifier hs-var">doesDirectoryExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680264"><span class="hs-identifier hs-var">pkgconf</span></a></span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680265"><span class="hs-identifier hs-var">exist</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; MaybeT IO String
forall a. a -&gt; MaybeT IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680264"><span class="hs-identifier hs-var">pkgconf</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MaybeT IO String
forall a. MaybeT IO a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mzero/GHC.Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span>
</span><span id="line-764"></span><span class="annot"><a href="GHC.Unit.State.html#resolveUnitDatabase"><span class="hs-identifier hs-var">resolveUnitDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PkgDbPath"><span class="hs-identifier hs-type">PkgDbPath</span></a></span><span> </span><span id="local-6989586621681680269"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680269"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; IO (Maybe String))
-&gt; Maybe String -&gt; IO (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680269"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span class="annot"><a href="GHC.Unit.State.html#readUnitDatabase"><span class="hs-identifier hs-type">readUnitDatabase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span id="readUnitDatabase"><span class="annot"><span class="annottext">readUnitDatabase :: Logger -&gt; UnitConfig -&gt; String -&gt; IO (UnitDatabase UnitId)
</span><a href="GHC.Unit.State.html#readUnitDatabase"><span class="hs-identifier hs-var hs-var">readUnitDatabase</span></a></span></span><span> </span><span id="local-6989586621681680270"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680270"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680271"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680271"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621681680272"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-768"></span><span>  </span><span id="local-6989586621681680273"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680273"><span class="hs-identifier hs-var">isdir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#doesDirectoryExist/System.Directory.html#doesDirectoryExist"><span class="hs-identifier hs-var">doesDirectoryExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span>  </span><span id="local-6989586621681680274"><span class="annot"><span class="annottext">[DbUnitInfo]
</span><a href="#local-6989586621681680274"><span class="hs-identifier hs-var">proto_pkg_configs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-771"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680273"><span class="hs-identifier hs-var">isdir</span></a></span><span>
</span><span id="line-772"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO [DbUnitInfo]
</span><a href="#local-6989586621681680275"><span class="hs-identifier hs-var">readDirStyleUnitInfo</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span>
</span><span id="line-773"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-774"></span><span>            </span><span id="local-6989586621681680276"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680276"><span class="hs-identifier hs-var">isfile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#doesFileExist/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span>
</span><span id="line-775"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680276"><span class="hs-identifier hs-var">isfile</span></a></span><span>
</span><span id="line-776"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-777"></span><span>                 </span><span id="local-6989586621681680278"><span class="annot"><span class="annottext">Maybe [DbUnitInfo]
</span><a href="#local-6989586621681680278"><span class="hs-identifier hs-var">mpkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe [DbUnitInfo])
</span><a href="#local-6989586621681680279"><span class="hs-identifier hs-var">tryReadOldFileStyleUnitInfo</span></a></span><span>
</span><span id="line-778"></span><span>                 </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [DbUnitInfo]
</span><a href="#local-6989586621681680278"><span class="hs-identifier hs-var">mpkgs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-779"></span><span>                   </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680280"><span class="annot"><span class="annottext">[DbUnitInfo]
</span><a href="#local-6989586621681680280"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[DbUnitInfo] -&gt; IO [DbUnitInfo]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[DbUnitInfo]
</span><a href="#local-6989586621681680280"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-780"></span><span>                   </span><span class="annot"><span class="annottext">Maybe [DbUnitInfo]
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO [DbUnitInfo]
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; IO [DbUnitInfo])
-&gt; GhcException -&gt; IO [DbUnitInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; GhcException) -&gt; String -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-781"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghc no longer supports single-file style package &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-782"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;databases (&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-783"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) use 'ghc-pkg init' to create the database with &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-784"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;the correct format.&quot;</span></span><span>
</span><span id="line-785"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO [DbUnitInfo]
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; IO [DbUnitInfo])
-&gt; GhcException -&gt; IO [DbUnitInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; GhcException) -&gt; String -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-786"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can't find a package database at &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-789"></span><span>      </span><span class="hs-comment">-- Fix #16360: remove trailing slash from conf_file before calculating pkgroot</span><span>
</span><span id="line-790"></span><span>      </span><span id="local-6989586621681680283"><span class="annot"><span class="annottext">conf_file' :: String
</span><a href="#local-6989586621681680283"><span class="hs-identifier hs-var hs-var">conf_file'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#dropTrailingPathSeparator/System.FilePath.Posix.html#dropTrailingPathSeparator"><span class="hs-identifier hs-var">dropTrailingPathSeparator</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span>
</span><span id="line-791"></span><span>      </span><span id="local-6989586621681680285"><span class="annot"><span class="annottext">top_dir :: String
</span><a href="#local-6989586621681680285"><span class="hs-identifier hs-var hs-var">top_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; String
</span><a href="GHC.Unit.State.html#unitConfigGHCDir"><span class="hs-identifier hs-var">unitConfigGHCDir</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680271"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-792"></span><span>      </span><span id="local-6989586621681680286"><span class="annot"><span class="annottext">pkgroot :: String
</span><a href="#local-6989586621681680286"><span class="hs-identifier hs-var hs-var">pkgroot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#takeDirectory/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680283"><span class="hs-identifier hs-var">conf_file'</span></a></span><span>
</span><span id="line-793"></span><span>      </span><span id="local-6989586621681680288"><span class="annot"><span class="annottext">pkg_configs1 :: [UnitInfo]
</span><a href="#local-6989586621681680288"><span class="hs-identifier hs-var hs-var">pkg_configs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DbUnitInfo -&gt; UnitInfo) -&gt; [DbUnitInfo] -&gt; [UnitInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; UnitInfo -&gt; UnitInfo
</span><a href="GHC.Unit.State.html#mungeUnitInfo"><span class="hs-identifier hs-var">mungeUnitInfo</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680285"><span class="hs-identifier hs-var">top_dir</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680286"><span class="hs-identifier hs-var">pkgroot</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo)
-&gt; (DbUnitInfo -&gt; UnitInfo) -&gt; DbUnitInfo -&gt; UnitInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitKey -&gt; UnitId) -&gt; GenUnitInfo UnitKey -&gt; UnitInfo
forall v u.
IsUnitId v =&gt;
(u -&gt; v) -&gt; GenUnitInfo u -&gt; GenUnitInfo v
</span><a href="GHC.Unit.Info.html#mapUnitInfo"><span class="hs-identifier hs-var">mapUnitInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitKey"><span class="hs-identifier hs-type">UnitKey</span></a></span><span> </span><span id="local-6989586621681680292"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681680292"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; UnitId
</span><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-var">UnitId</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681680292"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenUnitInfo UnitKey -&gt; UnitInfo)
-&gt; (DbUnitInfo -&gt; GenUnitInfo UnitKey) -&gt; DbUnitInfo -&gt; UnitInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DbUnitInfo -&gt; GenUnitInfo UnitKey
</span><a href="GHC.Unit.Info.html#mkUnitKeyInfo"><span class="hs-identifier hs-var">mkUnitKeyInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>                         </span><span class="annot"><span class="annottext">[DbUnitInfo]
</span><a href="#local-6989586621681680274"><span class="hs-identifier hs-var">proto_pkg_configs</span></a></span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-796"></span><span>  </span><span class="annot"><span class="annottext">UnitDatabase UnitId -&gt; IO (UnitDatabase UnitId)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitDatabase UnitId -&gt; IO (UnitDatabase UnitId))
-&gt; UnitDatabase UnitId -&gt; IO (UnitDatabase UnitId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [UnitInfo] -&gt; UnitDatabase UnitId
forall unit. String -&gt; [GenUnitInfo unit] -&gt; UnitDatabase unit
</span><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-var">UnitDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680283"><span class="hs-identifier hs-var">conf_file'</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680288"><span class="hs-identifier hs-var">pkg_configs1</span></a></span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-798"></span><span>    </span><span id="local-6989586621681680275"><span class="annot"><span class="annottext">readDirStyleUnitInfo :: String -&gt; IO [DbUnitInfo]
</span><a href="#local-6989586621681680275"><span class="hs-identifier hs-var hs-var">readDirStyleUnitInfo</span></a></span></span><span> </span><span id="local-6989586621681680294"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680294"><span class="hs-identifier hs-var">conf_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-799"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680295"><span class="annot"><span class="annottext">filename :: String
</span><a href="#local-6989586621681680295"><span class="hs-identifier hs-var hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680294"><span class="hs-identifier hs-var">conf_dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package.cache&quot;</span></span><span>
</span><span id="line-800"></span><span>      </span><span id="local-6989586621681680296"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680296"><span class="hs-identifier hs-var">cache_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#doesFileExist/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680295"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680296"><span class="hs-identifier hs-var">cache_exists</span></a></span><span>
</span><span id="line-802"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-803"></span><span>          </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680270"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Using binary package database:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680295"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-804"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO [DbUnitInfo]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#readPackageDbForGhc/GHC.Unit.Database.html#readPackageDbForGhc"><span class="hs-identifier hs-var">readPackageDbForGhc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680295"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-805"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-806"></span><span>          </span><span class="hs-comment">-- If there is no package.cache file, we check if the database is not</span><span>
</span><span id="line-807"></span><span>          </span><span class="hs-comment">-- empty by inspecting if the directory contains any .conf file. If it</span><span>
</span><span id="line-808"></span><span>          </span><span class="hs-comment">-- does, something is wrong and we fail. Otherwise we assume that the</span><span>
</span><span id="line-809"></span><span>          </span><span class="hs-comment">-- database is empty.</span><span>
</span><span id="line-810"></span><span>          </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680270"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;There is no package.cache in&quot;</span></span><span>
</span><span id="line-811"></span><span>                      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680294"><span class="hs-identifier hs-var">conf_dir</span></a></span><span>
</span><span id="line-812"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, checking if the database is empty&quot;</span></span><span>
</span><span id="line-813"></span><span>          </span><span id="local-6989586621681680299"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680299"><span class="hs-identifier hs-var">db_empty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (String -&gt; Bool) -&gt; String -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#isSuffixOf/Data.OldList.html#isSuffixOf"><span class="hs-identifier hs-var">isSuffixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.conf&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>                   </span><span class="annot"><span class="annottext">([String] -&gt; Bool) -&gt; IO [String] -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO [String]
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#getDirectoryContents/System.Directory.html#getDirectoryContents"><span class="hs-identifier hs-var">getDirectoryContents</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680294"><span class="hs-identifier hs-var">conf_dir</span></a></span><span>
</span><span id="line-815"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680299"><span class="hs-identifier hs-var">db_empty</span></a></span><span>
</span><span id="line-816"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-817"></span><span>              </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680270"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;There are no .conf files in&quot;</span></span><span>
</span><span id="line-818"></span><span>                          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680294"><span class="hs-identifier hs-var">conf_dir</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, treating&quot;</span></span><span>
</span><span id="line-819"></span><span>                          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package database as empty&quot;</span></span><span>
</span><span id="line-820"></span><span>              </span><span class="annot"><span class="annottext">[DbUnitInfo] -&gt; IO [DbUnitInfo]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-821"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-822"></span><span>              </span><span class="annot"><span class="annottext">GhcException -&gt; IO [DbUnitInfo]
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; IO [DbUnitInfo])
-&gt; GhcException -&gt; IO [DbUnitInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; GhcException) -&gt; String -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-823"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;there is no package.cache in &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680294"><span class="hs-identifier hs-var">conf_dir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-824"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; even though package database is not empty&quot;</span></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-comment">-- Single-file style package dbs have been deprecated for some time, but</span><span>
</span><span id="line-828"></span><span>    </span><span class="hs-comment">-- it turns out that Cabal was using them in one place. So this is a</span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-comment">-- workaround to allow older Cabal versions to use this newer ghc.</span><span>
</span><span id="line-830"></span><span>    </span><span class="hs-comment">-- We check if the file db contains just &quot;[]&quot; and if so, we look for a new</span><span>
</span><span id="line-831"></span><span>    </span><span class="hs-comment">-- dir-style db in conf_file.d/, ie in a dir next to the given file.</span><span>
</span><span id="line-832"></span><span>    </span><span class="hs-comment">-- We cannot just replace the file with a new dir style since Cabal still</span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-comment">-- assumes it's a file and tries to overwrite with 'writeFile'.</span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-comment">-- ghc-pkg also cooperates with this workaround.</span><span>
</span><span id="line-835"></span><span>    </span><span id="local-6989586621681680279"><span class="annot"><span class="annottext">tryReadOldFileStyleUnitInfo :: IO (Maybe [DbUnitInfo])
</span><a href="#local-6989586621681680279"><span class="hs-identifier hs-var hs-var">tryReadOldFileStyleUnitInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-836"></span><span>      </span><span id="local-6989586621681680301"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680301"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
</span><a href="../../base-4.18.3.0/src/System.IO.html#readFile/System.IO.html#readFile"><span class="hs-identifier hs-var">readFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span> </span><span class="annot"><span class="annottext">IO String -&gt; (IOException -&gt; IO String) -&gt; IO String
forall a. IO a -&gt; (IOException -&gt; IO a) -&gt; IO a
</span><a href="GHC.Utils.Exception.html#catchIO"><span class="hs-operator hs-var">`catchIO`</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-837"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; String
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#take/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680301"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[]&quot;</span></span><span>
</span><span id="line-838"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-839"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680305"><span class="annot"><span class="annottext">conf_dir :: String
</span><a href="#local-6989586621681680305"><span class="hs-identifier hs-var hs-var">conf_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680272"><span class="hs-identifier hs-var">conf_file</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;d&quot;</span></span><span>
</span><span id="line-840"></span><span>          </span><span id="local-6989586621681680307"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680307"><span class="hs-identifier hs-var">direxists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#doesDirectoryExist/System.Directory.html#doesDirectoryExist"><span class="hs-identifier hs-var">doesDirectoryExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680305"><span class="hs-identifier hs-var">conf_dir</span></a></span><span>
</span><span id="line-841"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680307"><span class="hs-identifier hs-var">direxists</span></a></span><span>
</span><span id="line-842"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680270"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ignoring old file-style db and trying:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680305"><span class="hs-identifier hs-var">conf_dir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span>                     </span><span class="annot"><span class="annottext">([DbUnitInfo] -&gt; Maybe [DbUnitInfo])
-&gt; IO [DbUnitInfo] -&gt; IO (Maybe [DbUnitInfo])
forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#liftM/GHC.Base.html#liftM"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">[DbUnitInfo] -&gt; Maybe [DbUnitInfo]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO [DbUnitInfo]
</span><a href="#local-6989586621681680275"><span class="hs-identifier hs-var">readDirStyleUnitInfo</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680305"><span class="hs-identifier hs-var">conf_dir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [DbUnitInfo] -&gt; IO (Maybe [DbUnitInfo])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DbUnitInfo] -&gt; Maybe [DbUnitInfo]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ghc-pkg will create it when it's updated</span><span>
</span><span id="line-845"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [DbUnitInfo] -&gt; IO (Maybe [DbUnitInfo])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [DbUnitInfo]
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span class="annot"><a href="GHC.Unit.State.html#distrustAllUnits"><span class="hs-identifier hs-type">distrustAllUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-848"></span><span id="distrustAllUnits"><span class="annot"><span class="annottext">distrustAllUnits :: [UnitInfo] -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#distrustAllUnits"><span class="hs-identifier hs-var hs-var">distrustAllUnits</span></a></span></span><span> </span><span id="local-6989586621681680309"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680309"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitInfo
forall {srcpkgid} {srcpkgname} {uid} {modulename} {mod}.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680310"><span class="hs-identifier hs-var">distrust</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680309"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-850"></span><span>    </span><span id="local-6989586621681680310"><span class="annot"><span class="annottext">distrust :: GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680310"><span class="hs-identifier hs-var hs-var">distrust</span></a></span></span><span> </span><span id="local-6989586621681680311"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680311"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680311"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIsTrusted/GHC.Unit.Database.html#unitIsTrusted"><span class="hs-identifier hs-var">unitIsTrusted</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span class="annot"><a href="GHC.Unit.State.html#mungeUnitInfo"><span class="hs-identifier hs-type">mungeUnitInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-853"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-854"></span><span id="mungeUnitInfo"><span class="annot"><span class="annottext">mungeUnitInfo :: String -&gt; String -&gt; UnitInfo -&gt; UnitInfo
</span><a href="GHC.Unit.State.html#mungeUnitInfo"><span class="hs-identifier hs-var hs-var">mungeUnitInfo</span></a></span></span><span> </span><span id="local-6989586621681680313"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680313"><span class="hs-identifier hs-var">top_dir</span></a></span></span><span> </span><span id="local-6989586621681680314"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680314"><span class="hs-identifier hs-var">pkgroot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-855"></span><span>    </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitInfo
</span><a href="GHC.Unit.State.html#mungeDynLibFields"><span class="hs-identifier hs-var">mungeDynLibFields</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo)
-&gt; (UnitInfo -&gt; UnitInfo) -&gt; UnitInfo -&gt; UnitInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShortText -&gt; ShortText -&gt; UnitInfo -&gt; UnitInfo
forall a b c d e.
ShortText
-&gt; ShortText
-&gt; GenericUnitInfo a b c d e
-&gt; GenericUnitInfo a b c d e
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#mungeUnitInfoPaths/GHC.Unit.Database.html#mungeUnitInfoPaths"><span class="hs-identifier hs-var">mungeUnitInfoPaths</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShortText
</span><a href="../../ghc-boot-9.6.7/src/GHC.Data.ShortText.html#pack/GHC.Data.ShortText.html#pack"><span class="hs-identifier hs-var">ST.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680313"><span class="hs-identifier hs-var">top_dir</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShortText
</span><a href="../../ghc-boot-9.6.7/src/GHC.Data.ShortText.html#pack/GHC.Data.ShortText.html#pack"><span class="hs-identifier hs-var">ST.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680314"><span class="hs-identifier hs-var">pkgroot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span class="annot"><a href="GHC.Unit.State.html#mungeDynLibFields"><span class="hs-identifier hs-type">mungeDynLibFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-859"></span><span id="mungeDynLibFields"><span class="annot"><span class="annottext">mungeDynLibFields :: UnitInfo -&gt; UnitInfo
</span><a href="GHC.Unit.State.html#mungeDynLibFields"><span class="hs-identifier hs-var hs-var">mungeDynLibFields</span></a></span></span><span> </span><span id="local-6989586621681680318"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680318"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-860"></span><span>    </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680318"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-861"></span><span>      </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitLibraryDynDirs/GHC.Unit.Database.html#unitLibraryDynDirs"><span class="hs-identifier hs-var">unitLibraryDynDirs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitLibraryDynDirs/GHC.Unit.Database.html#unitLibraryDynDirs"><span class="hs-identifier hs-var">unitLibraryDynDirs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681680318"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-862"></span><span>         </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [ShortText]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [ShortText]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitLibraryDirs/GHC.Unit.Database.html#unitLibraryDirs"><span class="hs-identifier hs-var">unitLibraryDirs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680318"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-863"></span><span>         </span><span id="local-6989586621681680321"><span class="annot"><span class="annottext">[ShortText]
</span><a href="#local-6989586621681680321"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ShortText]
</span><a href="#local-6989586621681680321"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-864"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-867"></span><span class="hs-comment">-- Modify our copy of the unit database based on trust flags,</span><span>
</span><span id="line-868"></span><span class="hs-comment">-- -trust and -distrust.</span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span class="annot"><a href="GHC.Unit.State.html#applyTrustFlag"><span class="hs-identifier hs-type">applyTrustFlag</span></a></span><span>
</span><span id="line-871"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span>
</span><span id="line-872"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span>
</span><span id="line-873"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-874"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#TrustFlag"><span class="hs-identifier hs-type">TrustFlag</span></a></span><span>
</span><span id="line-875"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-type">UnitErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-876"></span><span id="applyTrustFlag"><span class="annot"><span class="annottext">applyTrustFlag :: UnitPrecedenceMap
-&gt; UnusableUnits
-&gt; [UnitInfo]
-&gt; TrustFlag
-&gt; MaybeErr UnitErr [UnitInfo]
</span><a href="GHC.Unit.State.html#applyTrustFlag"><span class="hs-identifier hs-var hs-var">applyTrustFlag</span></a></span></span><span> </span><span id="local-6989586621681680323"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680323"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span> </span><span id="local-6989586621681680324"><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680324"><span class="hs-identifier hs-var">unusable</span></a></span></span><span> </span><span id="local-6989586621681680325"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680325"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680326"><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681680326"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-877"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681680326"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-878"></span><span>    </span><span class="hs-comment">-- we trust all matching packages. Maybe should only trust first one?</span><span>
</span><span id="line-879"></span><span>    </span><span class="hs-comment">-- and leave others the same or set them untrusted</span><span>
</span><span id="line-880"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#TrustPackage"><span class="hs-identifier hs-type">TrustPackage</span></a></span><span> </span><span id="local-6989586621681680328"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680328"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-881"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
-&gt; PackageArg
-&gt; [UnitInfo]
-&gt; UnusableUnits
-&gt; Either [(UnitInfo, UnusableUnitReason)] ([UnitInfo], [UnitInfo])
</span><a href="GHC.Unit.State.html#selectPackages"><span class="hs-identifier hs-var">selectPackages</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680323"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PackageArg
</span><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-var">PackageArg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680328"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680325"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680324"><span class="hs-identifier hs-var">unusable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-882"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681680331"><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680331"><span class="hs-identifier hs-var">ps</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitErr -&gt; MaybeErr UnitErr [UnitInfo]
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TrustFlag -&gt; [(UnitInfo, UnusableUnitReason)] -&gt; UnitErr
</span><a href="GHC.Unit.State.html#TrustFlagErr"><span class="hs-identifier hs-var">TrustFlagErr</span></a></span><span> </span><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681680326"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680331"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680334"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680334"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680335"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680335"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; MaybeErr UnitErr [UnitInfo]
forall err val. val -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitInfo
forall {srcpkgid} {srcpkgname} {uid} {modulename} {mod}.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680337"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680334"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680335"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681680337"><span class="annot"><span class="annottext">trust :: GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680337"><span class="hs-identifier hs-var hs-var">trust</span></a></span></span><span> </span><span id="local-6989586621681680338"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680338"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname uid modulename mod
</span><a href="#local-6989586621681680338"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIsTrusted/GHC.Unit.Database.html#unitIsTrusted"><span class="hs-identifier hs-var">unitIsTrusted</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span class="hs-special">}</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#DistrustPackage"><span class="hs-identifier hs-type">DistrustPackage</span></a></span><span> </span><span id="local-6989586621681680340"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680340"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-887"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
-&gt; PackageArg
-&gt; [UnitInfo]
-&gt; UnusableUnits
-&gt; Either [(UnitInfo, UnusableUnitReason)] ([UnitInfo], [UnitInfo])
</span><a href="GHC.Unit.State.html#selectPackages"><span class="hs-identifier hs-var">selectPackages</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680323"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PackageArg
</span><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-var">PackageArg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680340"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680325"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680324"><span class="hs-identifier hs-var">unusable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-888"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681680341"><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680341"><span class="hs-identifier hs-var">ps</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitErr -&gt; MaybeErr UnitErr [UnitInfo]
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TrustFlag -&gt; [(UnitInfo, UnusableUnitReason)] -&gt; UnitErr
</span><a href="GHC.Unit.State.html#TrustFlagErr"><span class="hs-identifier hs-var">TrustFlagErr</span></a></span><span> </span><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681680326"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680341"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680342"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680342"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680343"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680343"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; MaybeErr UnitErr [UnitInfo]
forall err val. val -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#distrustAllUnits"><span class="hs-identifier hs-var">distrustAllUnits</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680342"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680343"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span class="annot"><a href="GHC.Unit.State.html#applyPackageFlag"><span class="hs-identifier hs-type">applyPackageFlag</span></a></span><span>
</span><span id="line-892"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span>
</span><span id="line-893"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-894"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span>
</span><span id="line-895"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span>
</span><span id="line-896"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- if False, if you expose a package, it implicitly hides</span><span>
</span><span id="line-897"></span><span>           </span><span class="hs-comment">-- any previously exposed packages with the same name</span><span>
</span><span id="line-898"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-899"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a></span><span>           </span><span class="hs-comment">-- Initially exposed</span><span>
</span><span id="line-900"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span>             </span><span class="hs-comment">-- flag to apply</span><span>
</span><span id="line-901"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-type">UnitErr</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a></span><span> </span><span class="hs-comment">-- Now exposed</span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span id="applyPackageFlag"><span class="annot"><span class="annottext">applyPackageFlag :: UnitPrecedenceMap
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UnusableUnits
-&gt; Bool
-&gt; [UnitInfo]
-&gt; VisibilityMap
-&gt; PackageFlag
-&gt; MaybeErr UnitErr VisibilityMap
</span><a href="GHC.Unit.State.html#applyPackageFlag"><span class="hs-identifier hs-var hs-var">applyPackageFlag</span></a></span></span><span> </span><span id="local-6989586621681680345"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680345"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span> </span><span id="local-6989586621681680346"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680346"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680347"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680347"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681680348"><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680348"><span class="hs-identifier hs-var">unusable</span></a></span></span><span> </span><span id="local-6989586621681680349"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680349"><span class="hs-identifier hs-var">no_hide_others</span></a></span></span><span> </span><span id="local-6989586621681680350"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680350"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680351"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680351"><span class="hs-identifier hs-var">vm</span></a></span></span><span> </span><span id="local-6989586621681680352"><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681680352"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681680352"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-905"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#ExposePackage"><span class="hs-identifier hs-type">ExposePackage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681680354"><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680354"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#ModRenaming"><span class="hs-identifier hs-type">ModRenaming</span></a></span><span> </span><span id="local-6989586621681680356"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680356"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681680357"><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681680357"><span class="hs-identifier hs-var">rns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-906"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; PackageArg
-&gt; [UnitInfo]
-&gt; UnusableUnits
-&gt; Either [(UnitInfo, UnusableUnitReason)] [UnitInfo]
</span><a href="GHC.Unit.State.html#findPackages"><span class="hs-identifier hs-var">findPackages</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680345"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680346"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680347"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680354"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680350"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680348"><span class="hs-identifier hs-var">unusable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-907"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681680359"><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680359"><span class="hs-identifier hs-var">ps</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitErr -&gt; MaybeErr UnitErr VisibilityMap
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackageFlag -&gt; [(UnitInfo, UnusableUnitReason)] -&gt; UnitErr
</span><a href="GHC.Unit.State.html#PackageFlagErr"><span class="hs-identifier hs-var">PackageFlagErr</span></a></span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681680352"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680359"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-908"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680361"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680361"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[UnitInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; MaybeErr UnitErr VisibilityMap
forall err val. val -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680362"><span class="hs-identifier hs-var">vm'</span></a></span><span>
</span><span id="line-909"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-910"></span><span>           </span><span id="local-6989586621681680363"><span class="annot"><span class="annottext">n :: FastString
</span><a href="#local-6989586621681680363"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; FastString
</span><a href="GHC.Unit.State.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680361"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span>           </span><span class="hs-comment">-- If a user says @-unit-id p[A=&lt;A&gt;]@, this imposes</span><span>
</span><span id="line-913"></span><span>           </span><span class="hs-comment">-- a requirement on us: whatever our signature A is,</span><span>
</span><span id="line-914"></span><span>           </span><span class="hs-comment">-- it must fulfill all of p[A=&lt;A&gt;]:A's requirements.</span><span>
</span><span id="line-915"></span><span>           </span><span class="hs-comment">-- This method is responsible for computing what our</span><span>
</span><span id="line-916"></span><span>           </span><span class="hs-comment">-- inherited requirements are.</span><span>
</span><span id="line-917"></span><span>           </span><span id="local-6989586621681680365"><span class="annot"><span class="annottext">reqs :: Map ModuleName (Set InstantiatedModule)
</span><a href="#local-6989586621681680365"><span class="hs-identifier hs-var hs-var">reqs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span id="local-6989586621681680367"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680367"><span class="hs-identifier hs-var">orig_uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680354"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; Map ModuleName (Set InstantiatedModule)
forall {u}.
GenUnit u
-&gt; Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
</span><a href="#local-6989586621681680368"><span class="hs-identifier hs-var">collectHoles</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680367"><span class="hs-identifier hs-var">orig_uid</span></a></span><span>
</span><span id="line-918"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (Set InstantiatedModule)
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>           </span><span id="local-6989586621681680368"><span class="annot"><span class="annottext">collectHoles :: GenUnit u
-&gt; Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
</span><a href="#local-6989586621681680368"><span class="hs-identifier hs-var hs-var">collectHoles</span></a></span></span><span> </span><span id="local-6989586621681680373"><span class="annot"><span class="annottext">GenUnit u
</span><a href="#local-6989586621681680373"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenUnit u
</span><a href="#local-6989586621681680373"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-921"></span><span>             </span><span class="annot"><span class="annottext">GenUnit u
</span><a href="GHC.Unit.Types.html#HoleUnit"><span class="hs-identifier hs-var">HoleUnit</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-922"></span><span>             </span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="hs-comment">-- definite units don't have holes</span><span>
</span><span id="line-923"></span><span>             </span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span> </span><span id="local-6989586621681680374"><span class="annot"><span class="annottext">GenInstantiatedUnit u
</span><a href="#local-6989586621681680374"><span class="hs-identifier hs-var">indef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-924"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680375"><span class="annot"><span class="annottext">local :: [Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
</span><a href="#local-6989586621681680375"><span class="hs-identifier hs-var hs-var">local</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; Set (GenModule (GenInstantiatedUnit u))
-&gt; Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#singleton/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span>
</span><span id="line-925"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule (GenUnit u) -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule (GenUnit u)
</span><a href="#local-6989586621681680378"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule (GenInstantiatedUnit u)
-&gt; Set (GenModule (GenInstantiatedUnit u))
forall a. a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#singleton/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule (GenInstantiatedUnit u)
 -&gt; Set (GenModule (GenInstantiatedUnit u)))
-&gt; GenModule (GenInstantiatedUnit u)
-&gt; Set (GenModule (GenInstantiatedUnit u))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit u
-&gt; ModuleName -&gt; GenModule (GenInstantiatedUnit u)
forall unit. unit -&gt; ModuleName -&gt; GenModule unit
</span><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-var">Module</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit u
</span><a href="#local-6989586621681680374"><span class="hs-identifier hs-var">indef</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680380"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680380"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680380"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680378"><span class="annot"><span class="annottext">GenModule (GenUnit u)
</span><a href="#local-6989586621681680378"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit u -&gt; GenInstantiations u
forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var">instUnitInsts</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit u
</span><a href="#local-6989586621681680374"><span class="hs-identifier hs-var">indef</span></a></span><span>
</span><span id="line-928"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenModule (GenUnit u) -&gt; Bool
forall u. GenModule (GenUnit u) -&gt; Bool
</span><a href="GHC.Unit.Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule (GenUnit u)
</span><a href="#local-6989586621681680378"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-929"></span><span>                      </span><span id="local-6989586621681680381"><span class="annot"><span class="annottext">recurse :: [Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
</span><a href="#local-6989586621681680381"><span class="hs-identifier hs-var hs-var">recurse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GenUnit u
-&gt; Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
</span><a href="#local-6989586621681680368"><span class="hs-identifier hs-var">collectHoles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule (GenUnit u) -&gt; GenUnit u
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule (GenUnit u)
</span><a href="#local-6989586621681680382"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680382"><span class="annot"><span class="annottext">GenModule (GenUnit u)
</span><a href="#local-6989586621681680382"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit u -&gt; GenInstantiations u
forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var">instUnitInsts</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit u
</span><a href="#local-6989586621681680374"><span class="hs-identifier hs-var">indef</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-931"></span><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Set (GenModule (GenInstantiatedUnit u))
 -&gt; Set (GenModule (GenInstantiatedUnit u))
 -&gt; Set (GenModule (GenInstantiatedUnit u)))
-&gt; [Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
-&gt; Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
(a -&gt; a -&gt; a) -&gt; f (Map k a) -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#unionsWith/Data.Map.Internal.html#unionsWith"><span class="hs-identifier hs-var">Map.unionsWith</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GenModule (GenInstantiatedUnit u))
-&gt; Set (GenModule (GenInstantiatedUnit u))
-&gt; Set (GenModule (GenInstantiatedUnit u))
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#union/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="annot"><span class="annottext">([Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
 -&gt; Map ModuleName (Set (GenModule (GenInstantiatedUnit u))))
-&gt; [Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
-&gt; Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
</span><a href="#local-6989586621681680375"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">[Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
-&gt; [Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
-&gt; [Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Map ModuleName (Set (GenModule (GenInstantiatedUnit u)))]
</span><a href="#local-6989586621681680381"><span class="hs-identifier hs-var">recurse</span></a></span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span>           </span><span id="local-6989586621681680384"><span class="annot"><span class="annottext">uv :: UnitVisibility
</span><a href="#local-6989586621681680384"><span class="hs-identifier hs-var hs-var">uv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span>
</span><span id="line-934"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uv_expose_all :: Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680356"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-935"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_renamings :: [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681680357"><span class="hs-identifier hs-var">rns</span></a></span><span>
</span><span id="line-936"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_package_name :: First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FastString -&gt; First FastString
forall a. Maybe a -&gt; First a
</span><a href="../../base-4.18.3.0/src/Data.Monoid.html#First/Data.Monoid.html#First"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Maybe FastString
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681680363"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_requirements :: Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (Set InstantiatedModule)
</span><a href="#local-6989586621681680365"><span class="hs-identifier hs-var">reqs</span></a></span><span>
</span><span id="line-938"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_explicit :: Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackageArg -&gt; Maybe PackageArg
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680354"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-939"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-940"></span><span>           </span><span id="local-6989586621681680362"><span class="annot"><span class="annottext">vm' :: VisibilityMap
</span><a href="#local-6989586621681680362"><span class="hs-identifier hs-var hs-var">vm'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitVisibility -&gt; UnitVisibility -&gt; UnitVisibility)
-&gt; GenUnit UnitId
-&gt; UnitVisibility
-&gt; VisibilityMap
-&gt; VisibilityMap
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insertWith/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">Map.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; UnitVisibility -&gt; UnitVisibility
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mappend/GHC.Base.html#mappend"><span class="hs-identifier hs-var">mappend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680361"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681680384"><span class="hs-identifier hs-var">uv</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680386"><span class="hs-identifier hs-var">vm_cleared</span></a></span><span>
</span><span id="line-941"></span><span>           </span><span class="hs-comment">-- In the old days, if you said `ghc -package p-0.1 -package p-0.2`</span><span>
</span><span id="line-942"></span><span>           </span><span class="hs-comment">-- (or if p-0.1 was registered in the pkgdb as exposed: True),</span><span>
</span><span id="line-943"></span><span>           </span><span class="hs-comment">-- the second package flag would override the first one and you</span><span>
</span><span id="line-944"></span><span>           </span><span class="hs-comment">-- would only see p-0.2 in exposed modules.  This is good for</span><span>
</span><span id="line-945"></span><span>           </span><span class="hs-comment">-- usability.</span><span>
</span><span id="line-946"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-947"></span><span>           </span><span class="hs-comment">-- However, with thinning and renaming (or Backpack), there might be</span><span>
</span><span id="line-948"></span><span>           </span><span class="hs-comment">-- situations where you legitimately want to see two versions of a</span><span>
</span><span id="line-949"></span><span>           </span><span class="hs-comment">-- package at the same time, and this behavior would make it</span><span>
</span><span id="line-950"></span><span>           </span><span class="hs-comment">-- impossible to do so.  So we decided that if you pass</span><span>
</span><span id="line-951"></span><span>           </span><span class="hs-comment">-- -hide-all-packages, this should turn OFF the overriding behavior</span><span>
</span><span id="line-952"></span><span>           </span><span class="hs-comment">-- where an exposed package hides all other packages with the same</span><span>
</span><span id="line-953"></span><span>           </span><span class="hs-comment">-- name.  This should not affect Cabal at all, which only ever</span><span>
</span><span id="line-954"></span><span>           </span><span class="hs-comment">-- exposes one package at a time.</span><span>
</span><span id="line-955"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-956"></span><span>           </span><span class="hs-comment">-- NB: Why a variable no_hide_others?  We have to apply this logic to</span><span>
</span><span id="line-957"></span><span>           </span><span class="hs-comment">-- -plugin-package too, and it's more consistent if the switch in</span><span>
</span><span id="line-958"></span><span>           </span><span class="hs-comment">-- behavior is based off of</span><span>
</span><span id="line-959"></span><span>           </span><span class="hs-comment">-- -hide-all-packages/-hide-all-plugin-packages depending on what</span><span>
</span><span id="line-960"></span><span>           </span><span class="hs-comment">-- flag is in question.</span><span>
</span><span id="line-961"></span><span>           </span><span id="local-6989586621681680386"><span class="annot"><span class="annottext">vm_cleared :: VisibilityMap
</span><a href="#local-6989586621681680386"><span class="hs-identifier hs-var hs-var">vm_cleared</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680349"><span class="hs-identifier hs-var">no_hide_others</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680351"><span class="hs-identifier hs-var">vm</span></a></span><span>
</span><span id="line-962"></span><span>                      </span><span class="hs-comment">-- NB: renamings never clear</span><span>
</span><span id="line-963"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName, ModuleName)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681680357"><span class="hs-identifier hs-var">rns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680351"><span class="hs-identifier hs-var">vm</span></a></span><span>
</span><span id="line-964"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; UnitVisibility -&gt; Bool)
-&gt; VisibilityMap -&gt; VisibilityMap
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#filterWithKey/Data.Map.Internal.html#filterWithKey"><span class="hs-identifier hs-var">Map.filterWithKey</span></a></span><span>
</span><span id="line-965"></span><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681680388"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680388"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681680389"><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681680389"><span class="hs-identifier hs-var">uv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680388"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; GenUnit UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680361"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-966"></span><span>                                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe FastString -&gt; First FastString
forall a. Maybe a -&gt; First a
</span><a href="../../base-4.18.3.0/src/Data.Monoid.html#First/Data.Monoid.html#First"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Maybe FastString
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681680363"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">First FastString -&gt; First FastString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681680389"><span class="hs-identifier hs-var">uv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680351"><span class="hs-identifier hs-var">vm</span></a></span><span>
</span><span id="line-967"></span><span>         </span><span class="annot"><span class="annottext">Either [(UnitInfo, UnusableUnitReason)] [UnitInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MaybeErr UnitErr VisibilityMap
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;applyPackageFlag&quot;</span></span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#HidePackage"><span class="hs-identifier hs-type">HidePackage</span></a></span><span> </span><span id="local-6989586621681680392"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680392"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-970"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; PackageArg
-&gt; [UnitInfo]
-&gt; UnusableUnits
-&gt; Either [(UnitInfo, UnusableUnitReason)] [UnitInfo]
</span><a href="GHC.Unit.State.html#findPackages"><span class="hs-identifier hs-var">findPackages</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680345"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680346"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680347"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PackageArg
</span><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-var">PackageArg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680392"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680350"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680348"><span class="hs-identifier hs-var">unusable</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-971"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681680393"><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680393"><span class="hs-identifier hs-var">ps</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitErr -&gt; MaybeErr UnitErr VisibilityMap
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackageFlag -&gt; [(UnitInfo, UnusableUnitReason)] -&gt; UnitErr
</span><a href="GHC.Unit.State.html#PackageFlagErr"><span class="hs-identifier hs-var">PackageFlagErr</span></a></span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681680352"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681680393"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-972"></span><span>         </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681680394"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680394"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; MaybeErr UnitErr VisibilityMap
forall err val. val -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="annot"><span class="annottext">(VisibilityMap -&gt; MaybeErr UnitErr VisibilityMap)
-&gt; VisibilityMap -&gt; MaybeErr UnitErr VisibilityMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(VisibilityMap -&gt; GenUnit UnitId -&gt; VisibilityMap)
-&gt; VisibilityMap -&gt; [GenUnit UnitId] -&gt; VisibilityMap
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; VisibilityMap -&gt; VisibilityMap)
-&gt; VisibilityMap -&gt; GenUnit UnitId -&gt; VisibilityMap
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; VisibilityMap -&gt; VisibilityMap
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#delete/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">Map.delete</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680351"><span class="hs-identifier hs-var">vm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; GenUnit UnitId) -&gt; [UnitInfo] -&gt; [GenUnit UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680394"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span class="hs-comment">-- | Like 'selectPackages', but doesn't return a list of unmatched</span><span>
</span><span id="line-975"></span><span class="hs-comment">-- packages.  Furthermore, any packages it returns are *renamed*</span><span>
</span><span id="line-976"></span><span class="hs-comment">-- if the 'UnitArg' has a renaming associated with it.</span><span>
</span><span id="line-977"></span><span class="annot"><a href="GHC.Unit.State.html#findPackages"><span class="hs-identifier hs-type">findPackages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span>
</span><span id="line-978"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-979"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span>
</span><span id="line-980"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-981"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span>
</span><span id="line-982"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-983"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-984"></span><span id="findPackages"><span class="annot"><span class="annottext">findPackages :: UnitPrecedenceMap
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; PackageArg
-&gt; [UnitInfo]
-&gt; UnusableUnits
-&gt; Either [(UnitInfo, UnusableUnitReason)] [UnitInfo]
</span><a href="GHC.Unit.State.html#findPackages"><span class="hs-identifier hs-var hs-var">findPackages</span></a></span></span><span> </span><span id="local-6989586621681680397"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680397"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span> </span><span id="local-6989586621681680398"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680398"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680399"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680399"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681680400"><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680400"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681680401"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680401"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680402"><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680402"><span class="hs-identifier hs-var">unusable</span></a></span></span><span>
</span><span id="line-985"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680403"><span class="annot"><span class="annottext">ps :: [UnitInfo]
</span><a href="#local-6989586621681680403"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Maybe UnitInfo) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackageArg -&gt; UnitInfo -&gt; Maybe UnitInfo
</span><a href="#local-6989586621681680404"><span class="hs-identifier hs-var">finder</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680400"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680401"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-986"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680403"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
-&gt; Either [(UnitInfo, UnusableUnitReason)] [UnitInfo]
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((UnitInfo, UnusableUnitReason)
 -&gt; Maybe (UnitInfo, UnusableUnitReason))
-&gt; [(UnitInfo, UnusableUnitReason)]
-&gt; [(UnitInfo, UnusableUnitReason)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681680405"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680405"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680406"><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680406"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackageArg -&gt; UnitInfo -&gt; Maybe UnitInfo
</span><a href="#local-6989586621681680404"><span class="hs-identifier hs-var">finder</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680400"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680405"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UnitInfo
-&gt; (UnitInfo -&gt; Maybe (UnitInfo, UnusableUnitReason))
-&gt; Maybe (UnitInfo, UnusableUnitReason)
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681680407"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680407"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UnitInfo, UnusableUnitReason)
-&gt; Maybe (UnitInfo, UnusableUnitReason)
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680407"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680406"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-988"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnusableUnits -&gt; [(UnitInfo, UnusableUnitReason)]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680402"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Either [(UnitInfo, UnusableUnitReason)] [UnitInfo]
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitPrecedenceMap -&gt; [UnitInfo] -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#sortByPreference"><span class="hs-identifier hs-var">sortByPreference</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680397"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680403"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-990"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-991"></span><span>    </span><span id="local-6989586621681680404"><span class="annot"><span class="annottext">finder :: PackageArg -&gt; UnitInfo -&gt; Maybe UnitInfo
</span><a href="#local-6989586621681680404"><span class="hs-identifier hs-var hs-var">finder</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span id="local-6989586621681680409"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680409"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681680410"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680410"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-992"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680409"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680410"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-993"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Maybe UnitInfo
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680410"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-994"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe UnitInfo
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-995"></span><span>    </span><span class="annot"><a href="#local-6989586621681680404"><span class="hs-identifier hs-var">finder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span id="local-6989586621681680412"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680412"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681680413"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680413"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680412"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-997"></span><span>          </span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-type">Definite</span></a></span><span> </span><span id="local-6989586621681680415"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680415"><span class="hs-identifier hs-var">iuid</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680415"><span class="hs-identifier hs-var">iuid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680413"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-999"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Maybe UnitInfo
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680413"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1000"></span><span>          </span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span> </span><span id="local-6989586621681680416"><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680416"><span class="hs-identifier hs-var">inst</span></a></span></span><span>
</span><span id="line-1001"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; UnitId
forall unit. GenInstantiatedUnit unit -&gt; unit
</span><a href="GHC.Unit.Types.html#instUnitInstanceOf"><span class="hs-identifier hs-var">instUnitInstanceOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680416"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680413"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1002"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Maybe UnitInfo
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; [(ModuleName, Module)]
-&gt; UnitInfo
-&gt; UnitInfo
</span><a href="GHC.Unit.State.html#renameUnitInfo"><span class="hs-identifier hs-var">renameUnitInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680398"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680399"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; [(ModuleName, Module)]
forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var">instUnitInsts</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680416"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680413"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1003"></span><span>          </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe UnitInfo
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span class="annot"><a href="GHC.Unit.State.html#selectPackages"><span class="hs-identifier hs-type">selectPackages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1006"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span>
</span><span id="line-1007"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1008"></span><span>                  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span id="selectPackages"><span class="annot"><span class="annottext">selectPackages :: UnitPrecedenceMap
-&gt; PackageArg
-&gt; [UnitInfo]
-&gt; UnusableUnits
-&gt; Either [(UnitInfo, UnusableUnitReason)] ([UnitInfo], [UnitInfo])
</span><a href="GHC.Unit.State.html#selectPackages"><span class="hs-identifier hs-var hs-var">selectPackages</span></a></span></span><span> </span><span id="local-6989586621681680417"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680417"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span> </span><span id="local-6989586621681680418"><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680418"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681680419"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680419"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680420"><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680420"><span class="hs-identifier hs-var">unusable</span></a></span></span><span>
</span><span id="line-1010"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680421"><span class="annot"><span class="annottext">matches :: UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680421"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackageArg -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matching"><span class="hs-identifier hs-var">matching</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681680418"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1011"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681680423"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680423"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680424"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680424"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; ([UnitInfo], [UnitInfo])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#partition/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680421"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680419"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1012"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680423"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1013"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
-&gt; Either [(UnitInfo, UnusableUnitReason)] ([UnitInfo], [UnitInfo])
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((UnitInfo, UnusableUnitReason) -&gt; Bool)
-&gt; [(UnitInfo, UnusableUnitReason)]
-&gt; [(UnitInfo, UnusableUnitReason)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680421"><span class="hs-identifier hs-var">matches</span></a></span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool)
-&gt; ((UnitInfo, UnusableUnitReason) -&gt; UnitInfo)
-&gt; (UnitInfo, UnusableUnitReason)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">(UnitInfo, UnusableUnitReason) -&gt; UnitInfo
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnusableUnits -&gt; [(UnitInfo, UnusableUnitReason)]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680420"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([UnitInfo], [UnitInfo])
-&gt; Either [(UnitInfo, UnusableUnitReason)] ([UnitInfo], [UnitInfo])
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitPrecedenceMap -&gt; [UnitInfo] -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#sortByPreference"><span class="hs-identifier hs-var">sortByPreference</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680417"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680423"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680424"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span class="annot"><span class="hs-comment">-- | Rename a 'UnitInfo' according to some module instantiation.</span></span><span>
</span><span id="line-1017"></span><span class="annot"><a href="GHC.Unit.State.html#renameUnitInfo"><span class="hs-identifier hs-type">renameUnitInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-1018"></span><span id="renameUnitInfo"><span class="annot"><span class="annottext">renameUnitInfo :: UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; [(ModuleName, Module)]
-&gt; UnitInfo
-&gt; UnitInfo
</span><a href="GHC.Unit.State.html#renameUnitInfo"><span class="hs-identifier hs-var hs-var">renameUnitInfo</span></a></span></span><span> </span><span id="local-6989586621681680426"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680426"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680427"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680427"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681680428"><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680428"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span id="local-6989586621681680429"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680429"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1019"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680430"><span class="annot"><span class="annottext">hsubst :: UniqFM ModuleName Module
</span><a href="#local-6989586621681680430"><span class="hs-identifier hs-var hs-var">hsubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)] -&gt; UniqFM ModuleName Module
forall key elt. Uniquable key =&gt; [(key, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#listToUFM"><span class="hs-identifier hs-var">listToUFM</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681680428"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-1020"></span><span>        </span><span id="local-6989586621681680432"><span class="annot"><span class="annottext">smod :: Module -&gt; Module
</span><a href="#local-6989586621681680432"><span class="hs-identifier hs-var hs-var">smod</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UniqFM ModuleName Module
-&gt; Module
-&gt; Module
</span><a href="GHC.Unit.State.html#renameHoleModule%27"><span class="hs-identifier hs-var">renameHoleModule'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680426"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680427"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName Module
</span><a href="#local-6989586621681680430"><span class="hs-identifier hs-var">hsubst</span></a></span><span>
</span><span id="line-1021"></span><span>        </span><span id="local-6989586621681680433"><span class="annot"><span class="annottext">new_insts :: [(ModuleName, Module)]
</span><a href="#local-6989586621681680433"><span class="hs-identifier hs-var hs-var">new_insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ModuleName, Module) -&gt; (ModuleName, Module))
-&gt; [(ModuleName, Module)] -&gt; [(ModuleName, Module)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681680434"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680434"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680435"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680435"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680434"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Module -&gt; Module
</span><a href="#local-6989586621681680432"><span class="hs-identifier hs-var">smod</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680435"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; [(ModuleName, Module)]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [(modulename, mod)]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstantiations/GHC.Unit.Database.html#unitInstantiations"><span class="hs-identifier hs-var">unitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680429"><span class="hs-identifier hs-var">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680429"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1023"></span><span>        </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstantiations/GHC.Unit.Database.html#unitInstantiations"><span class="hs-identifier hs-var">unitInstantiations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681680433"><span class="hs-identifier hs-type">new_insts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1024"></span><span>        </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitExposedModules/GHC.Unit.Database.html#unitExposedModules"><span class="hs-identifier hs-var">unitExposedModules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-type">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681680437"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680437"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680438"><span class="annot"><span class="annottext">Maybe Module
</span><a href="#local-6989586621681680438"><span class="hs-identifier hs-var">mb_mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680437"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Module -&gt; Module) -&gt; Maybe Module -&gt; Maybe Module
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module
</span><a href="#local-6989586621681680432"><span class="hs-identifier hs-var">smod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Module
</span><a href="#local-6989586621681680438"><span class="hs-identifier hs-var">mb_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1025"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitExposedModules/GHC.Unit.Database.html#unitExposedModules"><span class="hs-identifier hs-var">unitExposedModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681680429"><span class="hs-identifier hs-type">conf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1027"></span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span class="hs-comment">-- A package named on the command line can either include the</span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- version, or just the name if it is unambiguous.</span><span>
</span><span id="line-1031"></span><span class="annot"><a href="GHC.Unit.State.html#matchingStr"><span class="hs-identifier hs-type">matchingStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1032"></span><span id="matchingStr"><span class="annot"><span class="annottext">matchingStr :: String -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matchingStr"><span class="hs-identifier hs-var hs-var">matchingStr</span></a></span></span><span> </span><span id="local-6989586621681680439"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680439"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621681680440"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680440"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-1033"></span><span>        </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680439"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; String
forall u. GenUnitInfo u -&gt; String
</span><a href="GHC.Unit.Info.html#unitPackageIdString"><span class="hs-identifier hs-var">unitPackageIdString</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680440"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1034"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680439"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; String
forall u. GenUnitInfo u -&gt; String
</span><a href="GHC.Unit.Info.html#unitPackageNameString"><span class="hs-identifier hs-var">unitPackageNameString</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680440"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1035"></span><span>
</span><span id="line-1036"></span><span class="annot"><a href="GHC.Unit.State.html#matchingId"><span class="hs-identifier hs-type">matchingId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1037"></span><span id="matchingId"><span class="annot"><span class="annottext">matchingId :: UnitId -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matchingId"><span class="hs-identifier hs-var hs-var">matchingId</span></a></span></span><span> </span><span id="local-6989586621681680444"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680444"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621681680445"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680445"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680444"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680445"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span class="annot"><a href="GHC.Unit.State.html#matching"><span class="hs-identifier hs-type">matching</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1040"></span><span id="matching"><span class="annot"><span class="annottext">matching :: PackageArg -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matching"><span class="hs-identifier hs-var hs-var">matching</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span id="local-6989586621681680446"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680446"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680446"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1041"></span><span class="annot"><a href="GHC.Unit.State.html#matching"><span class="hs-identifier hs-var">matching</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-type">Definite</span></a></span><span> </span><span id="local-6989586621681680447"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680447"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matchingId"><span class="hs-identifier hs-var">matchingId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680447"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-1042"></span><span class="annot"><a href="GHC.Unit.State.html#matching"><span class="hs-identifier hs-var">matching</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">UnitInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- TODO: warn in this case</span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span class="hs-comment">-- | This sorts a list of packages, putting &quot;preferred&quot; packages first.</span><span>
</span><span id="line-1045"></span><span class="hs-comment">-- See 'compareByPreference' for the semantics of &quot;preference&quot;.</span><span>
</span><span id="line-1046"></span><span class="annot"><a href="GHC.Unit.State.html#sortByPreference"><span class="hs-identifier hs-type">sortByPreference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1047"></span><span id="sortByPreference"><span class="annot"><span class="annottext">sortByPreference :: UnitPrecedenceMap -&gt; [UnitInfo] -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#sortByPreference"><span class="hs-identifier hs-var hs-var">sortByPreference</span></a></span></span><span> </span><span id="local-6989586621681680449"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680449"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo -&gt; Ordering) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#sortBy/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo -&gt; Ordering)
-&gt; UnitInfo -&gt; UnitInfo -&gt; Ordering
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitPrecedenceMap -&gt; UnitInfo -&gt; UnitInfo -&gt; Ordering
</span><a href="GHC.Unit.State.html#compareByPreference"><span class="hs-identifier hs-var">compareByPreference</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680449"><span class="hs-identifier hs-var">prec_map</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span class="hs-comment">-- | Returns 'GT' if @pkg@ should be preferred over @pkg'@ when picking</span><span>
</span><span id="line-1050"></span><span class="hs-comment">-- which should be &quot;active&quot;.  Here is the order of preference:</span><span>
</span><span id="line-1051"></span><span class="hs-comment">--</span><span>
</span><span id="line-1052"></span><span class="hs-comment">--      1. First, prefer the latest version</span><span>
</span><span id="line-1053"></span><span class="hs-comment">--      2. If the versions are the same, prefer the package that</span><span>
</span><span id="line-1054"></span><span class="hs-comment">--      came in the latest package database.</span><span>
</span><span id="line-1055"></span><span class="hs-comment">--</span><span>
</span><span id="line-1056"></span><span class="hs-comment">-- Pursuant to #12518, we could change this policy to, for example, remove</span><span>
</span><span id="line-1057"></span><span class="hs-comment">-- the version preference, meaning that we would always prefer the units</span><span>
</span><span id="line-1058"></span><span class="hs-comment">-- in later unit database.</span><span>
</span><span id="line-1059"></span><span class="annot"><a href="GHC.Unit.State.html#compareByPreference"><span class="hs-identifier hs-type">compareByPreference</span></a></span><span>
</span><span id="line-1060"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span>
</span><span id="line-1061"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-1063"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-1064"></span><span id="compareByPreference"><span class="annot"><span class="annottext">compareByPreference :: UnitPrecedenceMap -&gt; UnitInfo -&gt; UnitInfo -&gt; Ordering
</span><a href="GHC.Unit.State.html#compareByPreference"><span class="hs-identifier hs-var hs-var">compareByPreference</span></a></span></span><span> </span><span id="local-6989586621681680450"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680450"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span> </span><span id="local-6989586621681680451"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680451"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span id="local-6989586621681680452"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680452"><span class="hs-identifier hs-var">pkg'</span></a></span></span><span>
</span><span id="line-1065"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Version) -&gt; UnitInfo -&gt; UnitInfo -&gt; Ordering
forall a t. Ord a =&gt; (t -&gt; a) -&gt; t -&gt; t -&gt; Ordering
</span><a href="GHC.Unit.State.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Version
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Version
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitPackageVersion/GHC.Unit.Database.html#unitPackageVersion"><span class="hs-identifier hs-var">unitPackageVersion</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680451"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680452"><span class="hs-identifier hs-var">pkg'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1066"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-1067"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680455"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681680455"><span class="hs-identifier hs-var">prec</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitPrecedenceMap -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680451"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680450"><span class="hs-identifier hs-var">prec_map</span></a></span><span>
</span><span id="line-1068"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680456"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681680456"><span class="hs-identifier hs-var">prec'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitPrecedenceMap -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680452"><span class="hs-identifier hs-var">pkg'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680450"><span class="hs-identifier hs-var">prec_map</span></a></span><span>
</span><span id="line-1069"></span><span>           </span><span class="hs-comment">-- Prefer the unit from the later DB flag (i.e., higher</span><span>
</span><span id="line-1070"></span><span>           </span><span class="hs-comment">-- precedence)</span><span>
</span><span id="line-1071"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681680455"><span class="hs-identifier hs-var">prec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681680456"><span class="hs-identifier hs-var">prec'</span></a></span><span>
</span><span id="line-1072"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1073"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-1074"></span><span>        </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span id="local-6989586621681679174"><span id="local-6989586621681679175"><span class="annot"><a href="GHC.Unit.State.html#comparing"><span class="hs-identifier hs-type">comparing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621681679174"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681679175"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681679174"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681679175"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681679175"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span></span><span>
</span><span id="line-1077"></span><span id="comparing"><span class="annot"><span class="annottext">comparing :: forall a t. Ord a =&gt; (t -&gt; a) -&gt; t -&gt; t -&gt; Ordering
</span><a href="GHC.Unit.State.html#comparing"><span class="hs-identifier hs-var hs-var">comparing</span></a></span></span><span> </span><span id="local-6989586621681680460"><span class="annot"><span class="annottext">t -&gt; a
</span><a href="#local-6989586621681680460"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681680461"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681680461"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681680462"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681680462"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; a
</span><a href="#local-6989586621681680460"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681680461"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; a
</span><a href="#local-6989586621681680460"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681680462"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span class="annot"><a href="GHC.Unit.State.html#pprFlag"><span class="hs-identifier hs-type">pprFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1080"></span><span id="pprFlag"><span class="annot"><span class="annottext">pprFlag :: PackageFlag -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprFlag"><span class="hs-identifier hs-var hs-var">pprFlag</span></a></span></span><span> </span><span id="local-6989586621681680463"><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681680463"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681680463"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1081"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#HidePackage"><span class="hs-identifier hs-type">HidePackage</span></a></span><span> </span><span id="local-6989586621681680464"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680464"><span class="hs-identifier hs-var">p</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-hide-package &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680464"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1082"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#ExposePackage"><span class="hs-identifier hs-type">ExposePackage</span></a></span><span> </span><span id="local-6989586621681680465"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680465"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModRenaming
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680465"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span class="annot"><a href="GHC.Unit.State.html#pprTrustFlag"><span class="hs-identifier hs-type">pprTrustFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#TrustFlag"><span class="hs-identifier hs-type">TrustFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1085"></span><span id="pprTrustFlag"><span class="annot"><span class="annottext">pprTrustFlag :: TrustFlag -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprTrustFlag"><span class="hs-identifier hs-var hs-var">pprTrustFlag</span></a></span></span><span> </span><span id="local-6989586621681680467"><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681680467"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681680467"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1086"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#TrustPackage"><span class="hs-identifier hs-type">TrustPackage</span></a></span><span> </span><span id="local-6989586621681680468"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680468"><span class="hs-identifier hs-var">p</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-trust &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680468"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1087"></span><span>    </span><span class="annot"><a href="GHC.Driver.Session.html#DistrustPackage"><span class="hs-identifier hs-type">DistrustPackage</span></a></span><span> </span><span id="local-6989586621681680469"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680469"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-distrust &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680469"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1090"></span><span class="hs-comment">-- Wired-in units</span><span>
</span><span id="line-1091"></span><span class="hs-comment">--</span><span>
</span><span id="line-1092"></span><span class="hs-comment">-- See Note [Wired-in units] in GHC.Unit.Module</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="hs-keyword">type</span><span> </span><span id="WiringMap"><span class="annot"><a href="GHC.Unit.State.html#WiringMap"><span class="hs-identifier hs-var">WiringMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span class="annot"><a href="GHC.Unit.State.html#findWiredInUnits"><span class="hs-identifier hs-type">findWiredInUnits</span></a></span><span>
</span><span id="line-1097"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-1098"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span>
</span><span id="line-1099"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- database</span><span>
</span><span id="line-1100"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a></span><span>             </span><span class="hs-comment">-- info on what units are visible</span><span>
</span><span id="line-1101"></span><span>                                </span><span class="hs-comment">-- for wired in selection</span><span>
</span><span id="line-1102"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- unit database updated for wired in</span><span>
</span><span id="line-1103"></span><span>          </span><span class="annot"><a href="GHC.Unit.State.html#WiringMap"><span class="hs-identifier hs-type">WiringMap</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- map from unit id to wired identity</span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span id="findWiredInUnits"><span class="annot"><span class="annottext">findWiredInUnits :: Logger
-&gt; UnitPrecedenceMap
-&gt; [UnitInfo]
-&gt; VisibilityMap
-&gt; IO ([UnitInfo], Map UnitId UnitId)
</span><a href="GHC.Unit.State.html#findWiredInUnits"><span class="hs-identifier hs-var hs-var">findWiredInUnits</span></a></span></span><span> </span><span id="local-6989586621681680472"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680472"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680473"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680473"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span> </span><span id="local-6989586621681680474"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680474"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680475"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680475"><span class="hs-identifier hs-var">vis_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1106"></span><span>  </span><span class="hs-comment">-- Now we must find our wired-in units, and rename them to</span><span>
</span><span id="line-1107"></span><span>  </span><span class="hs-comment">-- their canonical names (eg. base-1.0 ==&gt; base), as described</span><span>
</span><span id="line-1108"></span><span>  </span><span class="hs-comment">-- in Note [Wired-in units] in GHC.Unit.Module</span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1110"></span><span>        </span><span class="annot"><a href="#local-6989586621681680476"><span class="hs-identifier hs-type">matches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1111"></span><span>        </span><span id="local-6989586621681680477"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680477"><span class="hs-identifier hs-var">pc</span></a></span></span><span> </span><span id="local-6989586621681680476"><span class="annot"><span class="annottext">matches :: UnitInfo -&gt; UnitId -&gt; Bool
</span><a href="#local-6989586621681680476"><span class="hs-operator hs-var hs-var">`matches`</span></a></span></span><span> </span><span id="local-6989586621681680478"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680478"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; PackageName
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; srcpkgname
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitPackageName/GHC.Unit.Database.html#unitPackageName"><span class="hs-identifier hs-var">unitPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680477"><span class="hs-identifier hs-var">pc</span></a></span><span> </span><span class="annot"><span class="annottext">PackageName -&gt; PackageName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; PackageName
</span><a href="GHC.Unit.Info.html#PackageName"><span class="hs-identifier hs-var">PackageName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FastString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680478"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span>        </span><span class="hs-comment">-- find which package corresponds to each wired-in package</span><span>
</span><span id="line-1114"></span><span>        </span><span class="hs-comment">-- delete any other packages with the same name</span><span>
</span><span id="line-1115"></span><span>        </span><span class="hs-comment">-- update the package and any dependencies to point to the new</span><span>
</span><span id="line-1116"></span><span>        </span><span class="hs-comment">-- one.</span><span>
</span><span id="line-1117"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1118"></span><span>        </span><span class="hs-comment">-- When choosing which package to map to a wired-in package</span><span>
</span><span id="line-1119"></span><span>        </span><span class="hs-comment">-- name, we try to pick the latest version of exposed packages.</span><span>
</span><span id="line-1120"></span><span>        </span><span class="hs-comment">-- However, if there are no exposed wired in packages available</span><span>
</span><span id="line-1121"></span><span>        </span><span class="hs-comment">-- (e.g. -hide-all-packages was used), we can't bail: we *have*</span><span>
</span><span id="line-1122"></span><span>        </span><span class="hs-comment">-- to assign a package for the wired-in package: so we try again</span><span>
</span><span id="line-1123"></span><span>        </span><span class="hs-comment">-- with hidden packages included to (and pick the latest</span><span>
</span><span id="line-1124"></span><span>        </span><span class="hs-comment">-- version).</span><span>
</span><span id="line-1125"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1126"></span><span>        </span><span class="hs-comment">-- You can also override the default choice by using -ignore-package:</span><span>
</span><span id="line-1127"></span><span>        </span><span class="hs-comment">-- this works even when there is no exposed wired in package</span><span>
</span><span id="line-1128"></span><span>        </span><span class="hs-comment">-- available.</span><span>
</span><span id="line-1129"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1130"></span><span>        </span><span class="annot"><a href="#local-6989586621681680480"><span class="hs-identifier hs-type">findWiredInUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>        </span><span id="local-6989586621681680480"><span class="annot"><span class="annottext">findWiredInUnit :: [UnitInfo] -&gt; UnitId -&gt; IO (Maybe (UnitId, UnitInfo))
</span><a href="#local-6989586621681680480"><span class="hs-identifier hs-var hs-var">findWiredInUnit</span></a></span></span><span> </span><span id="local-6989586621681680481"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680481"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680482"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680482"><span class="hs-identifier hs-var">wired_pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IO (Maybe (UnitId, UnitInfo))] -&gt; IO (Maybe (UnitId, UnitInfo))
forall (m :: * -&gt; *) (f :: * -&gt; *) a.
(Monad m, Foldable f) =&gt;
f (m (Maybe a)) -&gt; m (Maybe a)
</span><a href="GHC.Data.Maybe.html#firstJustsM"><span class="hs-identifier hs-var">firstJustsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; IO (Maybe (UnitId, UnitInfo))
</span><a href="#local-6989586621681680484"><span class="hs-identifier hs-var">try</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680485"><span class="hs-identifier hs-var">all_exposed_ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; IO (Maybe (UnitId, UnitInfo))
</span><a href="#local-6989586621681680484"><span class="hs-identifier hs-var">try</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680486"><span class="hs-identifier hs-var">all_ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (UnitId, UnitInfo))
</span><a href="#local-6989586621681680487"><span class="hs-identifier hs-var">notfound</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1132"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1133"></span><span>                </span><span id="local-6989586621681680486"><span class="annot"><span class="annottext">all_ps :: [UnitInfo]
</span><a href="#local-6989586621681680486"><span class="hs-identifier hs-var hs-var">all_ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680488"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680488"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680488"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680481"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680488"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId -&gt; Bool
</span><a href="#local-6989586621681680476"><span class="hs-operator hs-var">`matches`</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680482"><span class="hs-identifier hs-var">wired_pkg</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1134"></span><span>                </span><span id="local-6989586621681680485"><span class="annot"><span class="annottext">all_exposed_ps :: [UnitInfo]
</span><a href="#local-6989586621681680485"><span class="hs-identifier hs-var hs-var">all_exposed_ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680489"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680489"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680489"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680486"><span class="hs-identifier hs-var">all_ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; VisibilityMap -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#member/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">Map.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680489"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680475"><span class="hs-identifier hs-var">vis_map</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span>                </span><span id="local-6989586621681680484"><span class="annot"><span class="annottext">try :: [UnitInfo] -&gt; IO (Maybe (UnitId, UnitInfo))
</span><a href="#local-6989586621681680484"><span class="hs-identifier hs-var hs-var">try</span></a></span></span><span> </span><span id="local-6989586621681680491"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680491"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap -&gt; [UnitInfo] -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#sortByPreference"><span class="hs-identifier hs-var">sortByPreference</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680473"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680491"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1137"></span><span>                    </span><span id="local-6989586621681680492"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680492"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[UnitInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UnitId, UnitInfo) -&gt; Maybe (UnitId, UnitInfo)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, UnitInfo) -&gt; Maybe (UnitId, UnitInfo))
-&gt; IO (UnitId, UnitInfo) -&gt; IO (Maybe (UnitId, UnitInfo))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; IO (UnitId, UnitInfo)
</span><a href="#local-6989586621681680493"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680492"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1138"></span><span>                    </span><span class="annot"><span class="annottext">[UnitInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (UnitId, UnitInfo) -&gt; IO (Maybe (UnitId, UnitInfo))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UnitId, UnitInfo)
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>                </span><span id="local-6989586621681680487"><span class="annot"><span class="annottext">notfound :: IO (Maybe (UnitId, UnitInfo))
</span><a href="#local-6989586621681680487"><span class="hs-identifier hs-var hs-var">notfound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1141"></span><span>                          </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680472"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1142"></span><span>                            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;wired-in package &quot;</span></span><span>
</span><span id="line-1143"></span><span>                                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall doc. IsLine doc =&gt; FastString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FastString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680482"><span class="hs-identifier hs-var">wired_pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1144"></span><span>                                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; not found.&quot;</span></span><span>
</span><span id="line-1145"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (UnitId, UnitInfo) -&gt; IO (Maybe (UnitId, UnitInfo))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (UnitId, UnitInfo)
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1146"></span><span>                </span><span class="annot"><a href="#local-6989586621681680493"><span class="hs-identifier hs-type">pick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span>                </span><span id="local-6989586621681680493"><span class="annot"><span class="annottext">pick :: UnitInfo -&gt; IO (UnitId, UnitInfo)
</span><a href="#local-6989586621681680493"><span class="hs-identifier hs-var hs-var">pick</span></a></span></span><span> </span><span id="local-6989586621681680495"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680495"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1148"></span><span>                        </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680472"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1149"></span><span>                            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;wired-in package &quot;</span></span><span>
</span><span id="line-1150"></span><span>                                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall doc. IsLine doc =&gt; FastString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FastString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680482"><span class="hs-identifier hs-var">wired_pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>                                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; mapped to &quot;</span></span><span>
</span><span id="line-1152"></span><span>                                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680495"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>                        </span><span class="annot"><span class="annottext">(UnitId, UnitInfo) -&gt; IO (UnitId, UnitInfo)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680482"><span class="hs-identifier hs-var">wired_pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680495"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span>  </span><span id="local-6989586621681680496"><span class="annot"><span class="annottext">[Maybe (UnitId, UnitInfo)]
</span><a href="#local-6989586621681680496"><span class="hs-identifier hs-var">mb_wired_in_pkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; IO (Maybe (UnitId, UnitInfo)))
-&gt; [UnitId] -&gt; IO [Maybe (UnitId, UnitInfo)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; UnitId -&gt; IO (Maybe (UnitId, UnitInfo))
</span><a href="#local-6989586621681680480"><span class="hs-identifier hs-var">findWiredInUnit</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680474"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="GHC.Unit.Types.html#wiredInUnitIds"><span class="hs-identifier hs-var">wiredInUnitIds</span></a></span><span>
</span><span id="line-1157"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1158"></span><span>        </span><span id="local-6989586621681680498"><span class="annot"><span class="annottext">wired_in_pkgs :: [(UnitId, UnitInfo)]
</span><a href="#local-6989586621681680498"><span class="hs-identifier hs-var hs-var">wired_in_pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe (UnitId, UnitInfo)] -&gt; [(UnitId, UnitInfo)]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#catMaybes/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (UnitId, UnitInfo)]
</span><a href="#local-6989586621681680496"><span class="hs-identifier hs-var">mb_wired_in_pkgs</span></a></span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span>        </span><span class="annot"><a href="#local-6989586621681680499"><span class="hs-identifier hs-type">wiredInMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1161"></span><span>        </span><span id="local-6989586621681680499"><span class="annot"><span class="annottext">wiredInMap :: Map UnitId UnitId
</span><a href="#local-6989586621681680499"><span class="hs-identifier hs-var hs-var">wiredInMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(UnitId, UnitId)] -&gt; Map UnitId UnitId
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span>
</span><span id="line-1162"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680501"><span class="hs-identifier hs-var">realUnitInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680502"><span class="hs-identifier hs-var">wiredInUnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680502"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680502"><span class="hs-identifier hs-var">wiredInUnitId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680501"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680501"><span class="hs-identifier hs-var">realUnitInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UnitId, UnitInfo)]
</span><a href="#local-6989586621681680498"><span class="hs-identifier hs-var">wired_in_pkgs</span></a></span><span>
</span><span id="line-1164"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Bool
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIsIndefinite/GHC.Unit.Database.html#unitIsIndefinite"><span class="hs-identifier hs-var">unitIsIndefinite</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680501"><span class="hs-identifier hs-var">realUnitInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span>        </span><span id="local-6989586621681680504"><span class="annot"><span class="annottext">updateWiredInDependencies :: [GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
-&gt; [GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
</span><a href="#local-6989586621681680504"><span class="hs-identifier hs-var hs-var">updateWiredInDependencies</span></a></span></span><span> </span><span id="local-6989586621681680505"><span class="annot"><span class="annottext">[GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
</span><a href="#local-6989586621681680505"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
 -&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module)
-&gt; [GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
-&gt; [GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
forall {srcpkgid} {srcpkgname} {modulename}.
GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
</span><a href="#local-6989586621681680506"><span class="hs-identifier hs-var">upd_deps</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
 -&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module)
-&gt; (GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
    -&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module)
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
forall {srcpkgid} {srcpkgname} {modulename} {mod}.
GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680507"><span class="hs-identifier hs-var">upd_pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
</span><a href="#local-6989586621681680505"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1168"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681680507"><span class="annot"><span class="annottext">upd_pkg :: GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680507"><span class="hs-identifier hs-var hs-var">upd_pkg</span></a></span></span><span> </span><span id="local-6989586621681680509"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680509"><span class="hs-identifier hs-var">pkg</span></a></span></span><span>
</span><span id="line-1169"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680510"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680510"><span class="hs-identifier hs-var">wiredInUnitId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Map UnitId UnitId -&gt; Maybe UnitId
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680509"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680499"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span>
</span><span id="line-1170"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680509"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681680510"><span class="hs-identifier hs-type">wiredInUnitId</span></a></span><span>
</span><span id="line-1171"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstanceOf/GHC.Unit.Database.html#unitInstanceOf"><span class="hs-identifier hs-var">unitInstanceOf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681680510"><span class="hs-identifier hs-type">wiredInUnitId</span></a></span><span>
</span><span id="line-1172"></span><span>                           </span><span class="hs-comment">-- every non instantiated unit is an instance of</span><span>
</span><span id="line-1173"></span><span>                           </span><span class="hs-comment">-- itself (required by Backpack...)</span><span>
</span><span id="line-1174"></span><span>                           </span><span class="hs-comment">--</span><span>
</span><span id="line-1175"></span><span>                           </span><span class="hs-comment">-- See Note [About units] in GHC.Unit</span><span>
</span><span id="line-1176"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-1177"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1178"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680509"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1179"></span><span>                </span><span id="local-6989586621681680506"><span class="annot"><span class="annottext">upd_deps :: GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
-&gt; GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
</span><a href="#local-6989586621681680506"><span class="hs-identifier hs-var hs-var">upd_deps</span></a></span></span><span> </span><span id="local-6989586621681680512"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
</span><a href="#local-6989586621681680512"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module
</span><a href="#local-6989586621681680512"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1180"></span><span>                      </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitDepends/GHC.Unit.Database.html#unitDepends"><span class="hs-identifier hs-var">unitDepends</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-type">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#upd_wired_in"><span class="hs-identifier hs-type">upd_wired_in</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681680499"><span class="hs-identifier hs-type">wiredInMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitDepends/GHC.Unit.Database.html#unitDepends"><span class="hs-identifier hs-var">unitDepends</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681680512"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1181"></span><span>                      </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitExposedModules/GHC.Unit.Database.html#unitExposedModules"><span class="hs-identifier hs-var">unitExposedModules</span></a></span><span>
</span><span id="line-1182"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-type">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681680515"><span class="annot"><span class="annottext">modulename
</span><a href="#local-6989586621681680515"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680516"><span class="annot"><span class="annottext">Maybe Module
</span><a href="#local-6989586621681680516"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">modulename
</span><a href="#local-6989586621681680515"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Module -&gt; Module) -&gt; Maybe Module -&gt; Maybe Module
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; Module -&gt; Module
</span><a href="GHC.Unit.State.html#upd_wired_in_mod"><span class="hs-identifier hs-var">upd_wired_in_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680499"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Module
</span><a href="#local-6989586621681680516"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1183"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitExposedModules/GHC.Unit.Database.html#unitExposedModules"><span class="hs-identifier hs-var">unitExposedModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681680512"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1185"></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span>  </span><span class="annot"><span class="annottext">([UnitInfo], Map UnitId UnitId)
-&gt; IO ([UnitInfo], Map UnitId UnitId)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [UnitInfo]
forall {srcpkgid} {srcpkgname} {modulename}.
[GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
-&gt; [GenericUnitInfo srcpkgid srcpkgname UnitId modulename Module]
</span><a href="#local-6989586621681680504"><span class="hs-identifier hs-var">updateWiredInDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680474"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680499"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span class="hs-comment">-- Helper functions for rewiring Module and Unit.  These</span><span>
</span><span id="line-1190"></span><span class="hs-comment">-- rewrite Units of modules in wired-in packages to the form known to the</span><span>
</span><span id="line-1191"></span><span class="hs-comment">-- compiler, as described in Note [Wired-in units] in GHC.Unit.Module.</span><span>
</span><span id="line-1192"></span><span class="hs-comment">--</span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- For instance, base-4.9.0.0 will be rewritten to just base, to match</span><span>
</span><span id="line-1194"></span><span class="hs-comment">-- what appears in GHC.Builtin.Names.</span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span class="annot"><a href="GHC.Unit.State.html#upd_wired_in_mod"><span class="hs-identifier hs-type">upd_wired_in_mod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#WiringMap"><span class="hs-identifier hs-type">WiringMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-1197"></span><span id="upd_wired_in_mod"><span class="annot"><span class="annottext">upd_wired_in_mod :: Map UnitId UnitId -&gt; Module -&gt; Module
</span><a href="GHC.Unit.State.html#upd_wired_in_mod"><span class="hs-identifier hs-var hs-var">upd_wired_in_mod</span></a></span></span><span> </span><span id="local-6989586621681680517"><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680517"><span class="hs-identifier hs-var">wiredInMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span id="local-6989586621681680518"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680518"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621681680519"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680519"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; ModuleName -&gt; Module
forall unit. unit -&gt; ModuleName -&gt; GenModule unit
</span><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-var">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#upd_wired_in_uid"><span class="hs-identifier hs-var">upd_wired_in_uid</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680517"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680518"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680519"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1198"></span><span>
</span><span id="line-1199"></span><span class="annot"><a href="GHC.Unit.State.html#upd_wired_in_uid"><span class="hs-identifier hs-type">upd_wired_in_uid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#WiringMap"><span class="hs-identifier hs-type">WiringMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-1200"></span><span id="upd_wired_in_uid"><span class="annot"><span class="annottext">upd_wired_in_uid :: Map UnitId UnitId -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#upd_wired_in_uid"><span class="hs-identifier hs-var hs-var">upd_wired_in_uid</span></a></span></span><span> </span><span id="local-6989586621681680521"><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680521"><span class="hs-identifier hs-var">wiredInMap</span></a></span></span><span> </span><span id="local-6989586621681680522"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680522"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680522"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1201"></span><span>   </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="GHC.Unit.Types.html#HoleUnit"><span class="hs-identifier hs-var">HoleUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
forall uid. GenUnit uid
</span><a href="GHC.Unit.Types.html#HoleUnit"><span class="hs-identifier hs-var">HoleUnit</span></a></span><span>
</span><span id="line-1202"></span><span>   </span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-type">Definite</span></a></span><span> </span><span id="local-6989586621681680523"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680523"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; UnitId -&gt; UnitId
</span><a href="GHC.Unit.State.html#upd_wired_in"><span class="hs-identifier hs-var">upd_wired_in</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680521"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680523"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>   </span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span> </span><span id="local-6989586621681680524"><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680524"><span class="hs-identifier hs-var">indef_uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1204"></span><span>      </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; GenUnit UnitId
forall uid. GenInstantiatedUnit uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-var">VirtUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(GenInstantiatedUnit UnitId -&gt; GenUnit UnitId)
-&gt; GenInstantiatedUnit UnitId -&gt; GenUnit UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; [(ModuleName, Module)] -&gt; GenInstantiatedUnit UnitId
forall u.
IsUnitId u =&gt;
u -&gt; GenInstantiations u -&gt; GenInstantiatedUnit u
</span><a href="GHC.Unit.Types.html#mkInstantiatedUnit"><span class="hs-identifier hs-var">mkInstantiatedUnit</span></a></span><span>
</span><span id="line-1205"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; UnitId
forall unit. GenInstantiatedUnit unit -&gt; unit
</span><a href="GHC.Unit.Types.html#instUnitInstanceOf"><span class="hs-identifier hs-var">instUnitInstanceOf</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680524"><span class="hs-identifier hs-var">indef_uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ModuleName, Module) -&gt; (ModuleName, Module))
-&gt; [(ModuleName, Module)] -&gt; [(ModuleName, Module)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681680525"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680525"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680526"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680526"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680525"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; Module -&gt; Module
</span><a href="GHC.Unit.State.html#upd_wired_in_mod"><span class="hs-identifier hs-var">upd_wired_in_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680521"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680526"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; [(ModuleName, Module)]
forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var">instUnitInsts</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681680524"><span class="hs-identifier hs-var">indef_uid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span class="annot"><a href="GHC.Unit.State.html#upd_wired_in"><span class="hs-identifier hs-type">upd_wired_in</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#WiringMap"><span class="hs-identifier hs-type">WiringMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1209"></span><span id="upd_wired_in"><span class="annot"><span class="annottext">upd_wired_in :: Map UnitId UnitId -&gt; UnitId -&gt; UnitId
</span><a href="GHC.Unit.State.html#upd_wired_in"><span class="hs-identifier hs-var hs-var">upd_wired_in</span></a></span></span><span> </span><span id="local-6989586621681680527"><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680527"><span class="hs-identifier hs-var">wiredInMap</span></a></span></span><span> </span><span id="local-6989586621681680528"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680528"><span class="hs-identifier hs-var">key</span></a></span></span><span>
</span><span id="line-1210"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680529"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680529"><span class="hs-identifier hs-var">key'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Map UnitId UnitId -&gt; Maybe UnitId
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680528"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680527"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680529"><span class="hs-identifier hs-var">key'</span></a></span><span>
</span><span id="line-1211"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680528"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span class="annot"><a href="GHC.Unit.State.html#updateVisibilityMap"><span class="hs-identifier hs-type">updateVisibilityMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#WiringMap"><span class="hs-identifier hs-type">WiringMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a></span><span>
</span><span id="line-1214"></span><span id="updateVisibilityMap"><span class="annot"><span class="annottext">updateVisibilityMap :: Map UnitId UnitId -&gt; VisibilityMap -&gt; VisibilityMap
</span><a href="GHC.Unit.State.html#updateVisibilityMap"><span class="hs-identifier hs-var hs-var">updateVisibilityMap</span></a></span></span><span> </span><span id="local-6989586621681680531"><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680531"><span class="hs-identifier hs-var">wiredInMap</span></a></span></span><span> </span><span id="local-6989586621681680532"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680532"><span class="hs-identifier hs-var">vis_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VisibilityMap -&gt; (UnitId, UnitId) -&gt; VisibilityMap)
-&gt; VisibilityMap -&gt; [(UnitId, UnitId)] -&gt; VisibilityMap
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; (UnitId, UnitId) -&gt; VisibilityMap
</span><a href="#local-6989586621681680533"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680532"><span class="hs-identifier hs-var">vis_map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; [(UnitId, UnitId)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680531"><span class="hs-identifier hs-var">wiredInMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681680533"><span class="annot"><span class="annottext">f :: VisibilityMap -&gt; (UnitId, UnitId) -&gt; VisibilityMap
</span><a href="#local-6989586621681680533"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681680535"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680535"><span class="hs-identifier hs-var">vm</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680536"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680536"><span class="hs-identifier hs-var">from</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680537"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680537"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; VisibilityMap -&gt; Maybe UnitVisibility
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680536"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680532"><span class="hs-identifier hs-var">vis_map</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1216"></span><span>                    </span><span class="annot"><span class="annottext">Maybe UnitVisibility
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680535"><span class="hs-identifier hs-var">vm</span></a></span><span>
</span><span id="line-1217"></span><span>                    </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680538"><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681680538"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitVisibility -&gt; VisibilityMap -&gt; VisibilityMap
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680537"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681680538"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1218"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; VisibilityMap -&gt; VisibilityMap
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#delete/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">Map.delete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680536"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680535"><span class="hs-identifier hs-var">vm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>
</span><span id="line-1220"></span><span>
</span><span id="line-1221"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span class="annot"><span class="hs-comment">-- | The reason why a unit is unusable.</span></span><span>
</span><span id="line-1224"></span><span class="hs-keyword">data</span><span> </span><span id="UnusableUnitReason"><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-var">UnusableUnitReason</span></a></span></span><span>
</span><span id="line-1225"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | We ignored it explicitly using @-ignore-package@.</span></span><span>
</span><span id="line-1226"></span><span>    </span><span id="IgnoredWithFlag"><span class="annot"><a href="GHC.Unit.State.html#IgnoredWithFlag"><span class="hs-identifier hs-var">IgnoredWithFlag</span></a></span></span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-comment">-- | This unit transitively depends on a unit that was never present</span><span>
</span><span id="line-1228"></span><span>    </span><span class="hs-comment">-- in any of the provided databases.</span><span>
</span><span id="line-1229"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="BrokenDependencies"><span class="annot"><a href="GHC.Unit.State.html#BrokenDependencies"><span class="hs-identifier hs-var">BrokenDependencies</span></a></span></span><span>   </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1230"></span><span>    </span><span class="hs-comment">-- | This unit transitively depends on a unit involved in a cycle.</span><span>
</span><span id="line-1231"></span><span>    </span><span class="hs-comment">-- Note that the list of 'UnitId' reports the direct dependencies</span><span>
</span><span id="line-1232"></span><span>    </span><span class="hs-comment">-- of this unit that (transitively) depended on the cycle, and not</span><span>
</span><span id="line-1233"></span><span>    </span><span class="hs-comment">-- the actual cycle itself (which we report separately at high verbosity.)</span><span>
</span><span id="line-1234"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CyclicDependencies"><span class="annot"><a href="GHC.Unit.State.html#CyclicDependencies"><span class="hs-identifier hs-var">CyclicDependencies</span></a></span></span><span>   </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1235"></span><span>    </span><span class="annot"><span class="hs-comment">-- | This unit transitively depends on a unit which was ignored.</span></span><span>
</span><span id="line-1236"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="IgnoredDependencies"><span class="annot"><a href="GHC.Unit.State.html#IgnoredDependencies"><span class="hs-identifier hs-var">IgnoredDependencies</span></a></span></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1237"></span><span>    </span><span class="hs-comment">-- | This unit transitively depends on a unit which was</span><span>
</span><span id="line-1238"></span><span>    </span><span class="hs-comment">-- shadowed by an ABI-incompatible unit.</span><span>
</span><span id="line-1239"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ShadowedDependencies"><span class="annot"><a href="GHC.Unit.State.html#ShadowedDependencies"><span class="hs-identifier hs-var">ShadowedDependencies</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1242"></span><span>    </span><span id="local-6989586621681680563"><span class="annot"><span class="annottext">ppr :: UnusableUnitReason -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="GHC.Unit.State.html#IgnoredWithFlag"><span class="hs-identifier hs-var">IgnoredWithFlag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[ignored with flag]&quot;</span></span><span>
</span><span id="line-1243"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#BrokenDependencies"><span class="hs-identifier hs-type">BrokenDependencies</span></a></span><span> </span><span id="local-6989586621681680564"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680564"><span class="hs-identifier hs-var">uids</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;broken&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680564"><span class="hs-identifier hs-var">uids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#CyclicDependencies"><span class="hs-identifier hs-type">CyclicDependencies</span></a></span><span> </span><span id="local-6989586621681680566"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680566"><span class="hs-identifier hs-var">uids</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cyclic&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680566"><span class="hs-identifier hs-var">uids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#IgnoredDependencies"><span class="hs-identifier hs-type">IgnoredDependencies</span></a></span><span> </span><span id="local-6989586621681680567"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680567"><span class="hs-identifier hs-var">uids</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ignored&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680567"><span class="hs-identifier hs-var">uids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>    </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#ShadowedDependencies"><span class="hs-identifier hs-type">ShadowedDependencies</span></a></span><span> </span><span id="local-6989586621681680568"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680568"><span class="hs-identifier hs-var">uids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;shadowed&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680568"><span class="hs-identifier hs-var">uids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1247"></span><span>
</span><span id="line-1248"></span><span class="hs-keyword">type</span><span> </span><span id="UnusableUnits"><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-var">UnusableUnits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1249"></span><span>
</span><span id="line-1250"></span><span class="annot"><a href="GHC.Unit.State.html#pprReason"><span class="hs-identifier hs-type">pprReason</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1251"></span><span id="pprReason"><span class="annot"><span class="annottext">pprReason :: SDoc -&gt; UnusableUnitReason -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprReason"><span class="hs-identifier hs-var hs-var">pprReason</span></a></span></span><span> </span><span id="local-6989586621681680569"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681680569"><span class="hs-identifier hs-var">pref</span></a></span></span><span> </span><span id="local-6989586621681680570"><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680570"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680570"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1252"></span><span>  </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="GHC.Unit.State.html#IgnoredWithFlag"><span class="hs-identifier hs-var">IgnoredWithFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1253"></span><span>      </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681680569"><span class="hs-identifier hs-var">pref</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ignored due to an -ignore-package flag&quot;</span></span><span>
</span><span id="line-1254"></span><span>  </span><span class="annot"><a href="GHC.Unit.State.html#BrokenDependencies"><span class="hs-identifier hs-type">BrokenDependencies</span></a></span><span> </span><span id="local-6989586621681680571"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680571"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1255"></span><span>      </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681680569"><span class="hs-identifier hs-var">pref</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unusable due to missing dependencies:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1256"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; SDoc) -&gt; [UnitId] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680571"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>  </span><span class="annot"><a href="GHC.Unit.State.html#CyclicDependencies"><span class="hs-identifier hs-type">CyclicDependencies</span></a></span><span> </span><span id="local-6989586621681680574"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680574"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1258"></span><span>      </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681680569"><span class="hs-identifier hs-var">pref</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unusable due to cyclic dependencies:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1259"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; SDoc) -&gt; [UnitId] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680574"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>  </span><span class="annot"><a href="GHC.Unit.State.html#IgnoredDependencies"><span class="hs-identifier hs-type">IgnoredDependencies</span></a></span><span> </span><span id="local-6989586621681680575"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680575"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1261"></span><span>      </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681680569"><span class="hs-identifier hs-var">pref</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unusable because the -ignore-package flag was used to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1262"></span><span>                     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ignore at least one of its dependencies:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1263"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; SDoc) -&gt; [UnitId] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680575"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span>  </span><span class="annot"><a href="GHC.Unit.State.html#ShadowedDependencies"><span class="hs-identifier hs-type">ShadowedDependencies</span></a></span><span> </span><span id="local-6989586621681680576"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680576"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1265"></span><span>      </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681680569"><span class="hs-identifier hs-var">pref</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unusable due to shadowed dependencies:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1266"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; SDoc) -&gt; [UnitId] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680576"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span class="annot"><a href="GHC.Unit.State.html#reportCycles"><span class="hs-identifier hs-type">reportCycles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span id="reportCycles"><span class="annot"><span class="annottext">reportCycles :: Logger -&gt; [SCC UnitInfo] -&gt; IO ()
</span><a href="GHC.Unit.State.html#reportCycles"><span class="hs-identifier hs-var hs-var">reportCycles</span></a></span></span><span> </span><span id="local-6989586621681680578"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680578"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680579"><span class="annot"><span class="annottext">[SCC UnitInfo]
</span><a href="#local-6989586621681680579"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SCC UnitInfo -&gt; IO ()) -&gt; [SCC UnitInfo] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">SCC UnitInfo -&gt; IO ()
</span><a href="#local-6989586621681680581"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC UnitInfo]
</span><a href="#local-6989586621681680579"><span class="hs-identifier hs-var">sccs</span></a></span><span>
</span><span id="line-1270"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1271"></span><span>    </span><span id="local-6989586621681680581"><span class="annot"><span class="annottext">report :: SCC UnitInfo -&gt; IO ()
</span><a href="#local-6989586621681680581"><span class="hs-identifier hs-var hs-var">report</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#AcyclicSCC/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span>    </span><span class="annot"><a href="#local-6989586621681680581"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#CyclicSCC/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621681680584"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680584"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1273"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680578"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1274"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;these packages are involved in a cycle:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1275"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; SDoc) -&gt; [UnitInfo] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; SDoc) -&gt; (UnitInfo -&gt; UnitId) -&gt; UnitInfo -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680584"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span class="annot"><a href="GHC.Unit.State.html#reportUnusable"><span class="hs-identifier hs-type">reportUnusable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1278"></span><span id="reportUnusable"><span class="annot"><span class="annottext">reportUnusable :: Logger -&gt; UnusableUnits -&gt; IO ()
</span><a href="GHC.Unit.State.html#reportUnusable"><span class="hs-identifier hs-var hs-var">reportUnusable</span></a></span></span><span> </span><span id="local-6989586621681680586"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680586"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680587"><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680587"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((UnitId, (UnitInfo, UnusableUnitReason)) -&gt; IO ())
-&gt; [(UnitId, (UnitInfo, UnusableUnitReason))] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, (UnitInfo, UnusableUnitReason)) -&gt; IO ()
</span><a href="#local-6989586621681680588"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnusableUnits -&gt; [(UnitId, (UnitInfo, UnusableUnitReason))]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680587"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1280"></span><span>    </span><span id="local-6989586621681680588"><span class="annot"><span class="annottext">report :: (UnitId, (UnitInfo, UnusableUnitReason)) -&gt; IO ()
</span><a href="#local-6989586621681680588"><span class="hs-identifier hs-var hs-var">report</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680589"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680589"><span class="hs-identifier hs-var">ipid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680590"><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680590"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1281"></span><span>       </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680586"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1282"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; UnusableUnitReason -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprReason"><span class="hs-identifier hs-var">pprReason</span></a></span><span>
</span><span id="line-1283"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680589"><span class="hs-identifier hs-var">ipid</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680590"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1284"></span><span>
</span><span id="line-1285"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-1286"></span><span class="hs-comment">--</span><span>
</span><span id="line-1287"></span><span class="hs-comment">-- Utilities on the database</span><span>
</span><span id="line-1288"></span><span class="hs-comment">--</span><span>
</span><span id="line-1289"></span><span>
</span><span id="line-1290"></span><span class="hs-comment">-- | A reverse dependency index, mapping an 'UnitId' to</span><span>
</span><span id="line-1291"></span><span class="hs-comment">-- the 'UnitId's which have a dependency on it.</span><span>
</span><span id="line-1292"></span><span class="hs-keyword">type</span><span> </span><span id="RevIndex"><span class="annot"><a href="GHC.Unit.State.html#RevIndex"><span class="hs-identifier hs-var">RevIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1293"></span><span>
</span><span id="line-1294"></span><span class="annot"><span class="hs-comment">-- | Compute the reverse dependency index of a unit database.</span></span><span>
</span><span id="line-1295"></span><span class="annot"><a href="GHC.Unit.State.html#reverseDeps"><span class="hs-identifier hs-type">reverseDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#RevIndex"><span class="hs-identifier hs-type">RevIndex</span></a></span><span>
</span><span id="line-1296"></span><span id="reverseDeps"><span class="annot"><span class="annottext">reverseDeps :: UnitInfoMap -&gt; RevIndex
</span><a href="GHC.Unit.State.html#reverseDeps"><span class="hs-identifier hs-var hs-var">reverseDeps</span></a></span></span><span> </span><span id="local-6989586621681680592"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680592"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RevIndex -&gt; UnitInfo -&gt; RevIndex)
-&gt; RevIndex -&gt; UnitInfoMap -&gt; RevIndex
forall a b k. (a -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#foldl%27/Data.Map.Internal.html#foldl%27"><span class="hs-identifier hs-var">Map.foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">RevIndex -&gt; UnitInfo -&gt; RevIndex
forall {a} {srcpkgid} {srcpkgname} {modulename} {mod}.
Ord a =&gt;
Map a [a]
-&gt; GenericUnitInfo srcpkgid srcpkgname a modulename mod
-&gt; Map a [a]
</span><a href="#local-6989586621681680594"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">RevIndex
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680592"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-1297"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1298"></span><span>    </span><span id="local-6989586621681680594"><span class="annot"><span class="annottext">go :: Map a [a]
-&gt; GenericUnitInfo srcpkgid srcpkgname a modulename mod
-&gt; Map a [a]
</span><a href="#local-6989586621681680594"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681680601"><span class="annot"><span class="annottext">Map a [a]
</span><a href="#local-6989586621681680601"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681680602"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod
</span><a href="#local-6989586621681680602"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map a [a] -&gt; a -&gt; Map a [a]) -&gt; Map a [a] -&gt; [a] -&gt; Map a [a]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Map a [a] -&gt; a -&gt; Map a [a]
forall {k} {a}. Ord k =&gt; a -&gt; Map k [a] -&gt; k -&gt; Map k [a]
</span><a href="#local-6989586621681680603"><span class="hs-identifier hs-var">go'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod -&gt; a
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod
</span><a href="#local-6989586621681680602"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map a [a]
</span><a href="#local-6989586621681680601"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod -&gt; [a]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; [uid]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitDepends/GHC.Unit.Database.html#unitDepends"><span class="hs-identifier hs-var">unitDepends</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod
</span><a href="#local-6989586621681680602"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>    </span><span id="local-6989586621681680603"><span class="annot"><span class="annottext">go' :: a -&gt; Map k [a] -&gt; k -&gt; Map k [a]
</span><a href="#local-6989586621681680603"><span class="hs-identifier hs-var hs-var">go'</span></a></span></span><span> </span><span id="local-6989586621681680608"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681680608"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621681680609"><span class="annot"><span class="annottext">Map k [a]
</span><a href="#local-6989586621681680609"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681680610"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681680610"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a] -&gt; [a]) -&gt; k -&gt; [a] -&gt; Map k [a] -&gt; Map k [a]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insertWith/Data.Map.Internal.html#insertWith"><span class="hs-identifier hs-var">Map.insertWith</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681680610"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681680608"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Map k [a]
</span><a href="#local-6989586621681680609"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1300"></span><span>
</span><span id="line-1301"></span><span class="hs-comment">-- | Given a list of 'UnitId's to remove, a database,</span><span>
</span><span id="line-1302"></span><span class="hs-comment">-- and a reverse dependency index (as computed by 'reverseDeps'),</span><span>
</span><span id="line-1303"></span><span class="hs-comment">-- remove those units, plus any units which depend on them.</span><span>
</span><span id="line-1304"></span><span class="hs-comment">-- Returns the pruned database, as well as a list of 'UnitInfo's</span><span>
</span><span id="line-1305"></span><span class="hs-comment">-- that was removed.</span><span>
</span><span id="line-1306"></span><span class="annot"><a href="GHC.Unit.State.html#removeUnits"><span class="hs-identifier hs-type">removeUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#RevIndex"><span class="hs-identifier hs-type">RevIndex</span></a></span><span>
</span><span id="line-1307"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-1308"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span id="removeUnits"><span class="annot"><span class="annottext">removeUnits :: [UnitId] -&gt; RevIndex -&gt; UnitInfoMap -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="GHC.Unit.State.html#removeUnits"><span class="hs-identifier hs-var hs-var">removeUnits</span></a></span></span><span> </span><span id="local-6989586621681680612"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680612"><span class="hs-identifier hs-var">uids</span></a></span></span><span> </span><span id="local-6989586621681680613"><span class="annot"><span class="annottext">RevIndex
</span><a href="#local-6989586621681680613"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621681680614"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680614"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; (UnitInfoMap, [UnitInfo]) -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="#local-6989586621681680615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680612"><span class="hs-identifier hs-var">uids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680614"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1310"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1311"></span><span>    </span><span id="local-6989586621681680615"><span class="annot"><span class="annottext">go :: [UnitId] -&gt; (UnitInfoMap, [UnitInfo]) -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="#local-6989586621681680615"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680616"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680616"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680617"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680617"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680616"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680617"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1312"></span><span>    </span><span class="annot"><a href="#local-6989586621681680615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680618"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680618"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681680619"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680619"><span class="hs-identifier hs-var">uids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680620"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680620"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680621"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680621"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1313"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680622"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680622"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Maybe UnitInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680618"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680620"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1314"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; RevIndex -&gt; Maybe [UnitId]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680618"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">RevIndex
</span><a href="#local-6989586621681680613"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1315"></span><span>            </span><span class="annot"><span class="annottext">Maybe [UnitId]
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; (UnitInfoMap, [UnitInfo]) -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="#local-6989586621681680615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680619"><span class="hs-identifier hs-var">uids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; UnitInfoMap
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#delete/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">Map.delete</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680618"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680620"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680622"><span class="hs-identifier hs-var">pkg</span></a></span><span class="annot"><span class="annottext">UnitInfo -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680621"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1316"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680623"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680623"><span class="hs-identifier hs-var">rdeps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; (UnitInfoMap, [UnitInfo]) -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="#local-6989586621681680615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680623"><span class="hs-identifier hs-var">rdeps</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; [UnitId] -&gt; [UnitId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680619"><span class="hs-identifier hs-var">uids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; UnitInfoMap
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#delete/Data.Map.Internal.html#delete"><span class="hs-identifier hs-var">Map.delete</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680618"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680620"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680622"><span class="hs-identifier hs-var">pkg</span></a></span><span class="annot"><span class="annottext">UnitInfo -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680621"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1317"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1318"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; (UnitInfoMap, [UnitInfo]) -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="#local-6989586621681680615"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680619"><span class="hs-identifier hs-var">uids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680620"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680621"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1319"></span><span>
</span><span id="line-1320"></span><span class="hs-comment">-- | Given a 'UnitInfo' from some 'UnitInfoMap', return all entries in 'depends'</span><span>
</span><span id="line-1321"></span><span class="hs-comment">-- which correspond to units that do not exist in the index.</span><span>
</span><span id="line-1322"></span><span class="annot"><a href="GHC.Unit.State.html#depsNotAvailable"><span class="hs-identifier hs-type">depsNotAvailable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-1323"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-1324"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1325"></span><span id="depsNotAvailable"><span class="annot"><span class="annottext">depsNotAvailable :: UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsNotAvailable"><span class="hs-identifier hs-var hs-var">depsNotAvailable</span></a></span></span><span> </span><span id="local-6989586621681680625"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680625"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680626"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680626"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Bool) -&gt; [UnitId] -&gt; [UnitId]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (UnitId -&gt; Bool) -&gt; UnitId -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#member/Data.Map.Internal.html#member"><span class="hs-operator hs-var">`Map.member`</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680625"><span class="hs-identifier hs-var">pkg_map</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; [UnitId]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; [uid]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitDepends/GHC.Unit.Database.html#unitDepends"><span class="hs-identifier hs-var">unitDepends</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680626"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1326"></span><span>
</span><span id="line-1327"></span><span class="hs-comment">-- | Given a 'UnitInfo' from some 'UnitInfoMap' return all entries in</span><span>
</span><span id="line-1328"></span><span class="hs-comment">-- 'unitAbiDepends' which correspond to units that do not exist, OR have</span><span>
</span><span id="line-1329"></span><span class="hs-comment">-- mismatching ABIs.</span><span>
</span><span id="line-1330"></span><span class="annot"><a href="GHC.Unit.State.html#depsAbiMismatch"><span class="hs-identifier hs-type">depsAbiMismatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-1331"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-1332"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1333"></span><span id="depsAbiMismatch"><span class="annot"><span class="annottext">depsAbiMismatch :: UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsAbiMismatch"><span class="hs-identifier hs-var hs-var">depsAbiMismatch</span></a></span></span><span> </span><span id="local-6989586621681680629"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680629"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680630"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680630"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((UnitId, ShortText) -&gt; UnitId)
-&gt; [(UnitId, ShortText)] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, ShortText) -&gt; UnitId
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(UnitId, ShortText)] -&gt; [UnitId])
-&gt; ([(UnitId, ShortText)] -&gt; [(UnitId, ShortText)])
-&gt; [(UnitId, ShortText)]
-&gt; [UnitId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, ShortText) -&gt; Bool)
-&gt; [(UnitId, ShortText)] -&gt; [(UnitId, ShortText)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((UnitId, ShortText) -&gt; Bool) -&gt; (UnitId, ShortText) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, ShortText) -&gt; Bool
</span><a href="#local-6989586621681680631"><span class="hs-identifier hs-var">abiMatch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(UnitId, ShortText)] -&gt; [UnitId])
-&gt; [(UnitId, ShortText)] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [(UnitId, ShortText)]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [(uid, ShortText)]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitAbiDepends/GHC.Unit.Database.html#unitAbiDepends"><span class="hs-identifier hs-var">unitAbiDepends</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680630"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1335"></span><span>    </span><span id="local-6989586621681680631"><span class="annot"><span class="annottext">abiMatch :: (UnitId, ShortText) -&gt; Bool
</span><a href="#local-6989586621681680631"><span class="hs-identifier hs-var hs-var">abiMatch</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680632"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680632"><span class="hs-identifier hs-var">dep_uid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680633"><span class="annot"><span class="annottext">ShortText
</span><a href="#local-6989586621681680633"><span class="hs-identifier hs-var">abi</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1336"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680634"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680634"><span class="hs-identifier hs-var">dep_pkg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Maybe UnitInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680632"><span class="hs-identifier hs-var">dep_uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680629"><span class="hs-identifier hs-var">pkg_map</span></a></span><span>
</span><span id="line-1337"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; ShortText
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; ShortText
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitAbiHash/GHC.Unit.Database.html#unitAbiHash"><span class="hs-identifier hs-var">unitAbiHash</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680634"><span class="hs-identifier hs-var">dep_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ShortText -&gt; ShortText -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ShortText
</span><a href="#local-6989586621681680633"><span class="hs-identifier hs-var">abi</span></a></span><span>
</span><span id="line-1338"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1339"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1340"></span><span>
</span><span id="line-1341"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1342"></span><span class="hs-comment">-- Ignore units</span><span>
</span><span id="line-1343"></span><span>
</span><span id="line-1344"></span><span class="annot"><a href="GHC.Unit.State.html#ignoreUnits"><span class="hs-identifier hs-type">ignoreUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#IgnorePackageFlag"><span class="hs-identifier hs-type">IgnorePackageFlag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span>
</span><span id="line-1345"></span><span id="ignoreUnits"><span class="annot"><span class="annottext">ignoreUnits :: [IgnorePackageFlag] -&gt; [UnitInfo] -&gt; UnusableUnits
</span><a href="GHC.Unit.State.html#ignoreUnits"><span class="hs-identifier hs-var hs-var">ignoreUnits</span></a></span></span><span> </span><span id="local-6989586621681680637"><span class="annot"><span class="annottext">[IgnorePackageFlag]
</span><a href="#local-6989586621681680637"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span id="local-6989586621681680638"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680638"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(UnitId, (UnitInfo, UnusableUnitReason))] -&gt; UnusableUnits
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IgnorePackageFlag -&gt; [(UnitId, (UnitInfo, UnusableUnitReason))])
-&gt; [IgnorePackageFlag]
-&gt; [(UnitId, (UnitInfo, UnusableUnitReason))]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">IgnorePackageFlag -&gt; [(UnitId, (UnitInfo, UnusableUnitReason))]
</span><a href="#local-6989586621681680639"><span class="hs-identifier hs-var">doit</span></a></span><span> </span><span class="annot"><span class="annottext">[IgnorePackageFlag]
</span><a href="#local-6989586621681680637"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1346"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1347"></span><span>  </span><span id="local-6989586621681680639"><span class="annot"><span class="annottext">doit :: IgnorePackageFlag -&gt; [(UnitId, (UnitInfo, UnusableUnitReason))]
</span><a href="#local-6989586621681680639"><span class="hs-identifier hs-var hs-var">doit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#IgnorePackage"><span class="hs-identifier hs-type">IgnorePackage</span></a></span><span> </span><span id="local-6989586621681680641"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680641"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1348"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; ([UnitInfo], [UnitInfo])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#partition/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; UnitInfo -&gt; Bool
</span><a href="GHC.Unit.State.html#matchingStr"><span class="hs-identifier hs-var">matchingStr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680641"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680638"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1349"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681680642"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680642"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680643"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680643"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="GHC.Unit.State.html#IgnoredWithFlag"><span class="hs-identifier hs-var">IgnoredWithFlag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1350"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680643"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680643"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680642"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1351"></span><span>        </span><span class="hs-comment">-- missing unit is not an error for -ignore-package,</span><span>
</span><span id="line-1352"></span><span>        </span><span class="hs-comment">-- because a common usage is to -ignore-package P as</span><span>
</span><span id="line-1353"></span><span>        </span><span class="hs-comment">-- a preventative measure just in case P exists.</span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-1356"></span><span class="hs-comment">--</span><span>
</span><span id="line-1357"></span><span class="hs-comment">-- Merging databases</span><span>
</span><span id="line-1358"></span><span class="hs-comment">--</span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span class="hs-comment">-- | For each unit, a mapping from uid -&gt; i indicates that this</span><span>
</span><span id="line-1361"></span><span class="hs-comment">-- unit was brought into GHC by the ith @-package-db@ flag on</span><span>
</span><span id="line-1362"></span><span class="hs-comment">-- the command line.  We use this mapping to make sure we prefer</span><span>
</span><span id="line-1363"></span><span class="hs-comment">-- units that were defined later on the command line, if there</span><span>
</span><span id="line-1364"></span><span class="hs-comment">-- is an ambiguity.</span><span>
</span><span id="line-1365"></span><span class="hs-keyword">type</span><span> </span><span id="UnitPrecedenceMap"><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-var">UnitPrecedenceMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span class="hs-comment">-- | Given a list of databases, merge them together, where</span><span>
</span><span id="line-1368"></span><span class="hs-comment">-- units with the same unit id in later databases override</span><span>
</span><span id="line-1369"></span><span class="hs-comment">-- earlier ones.  This does NOT check if the resulting database</span><span>
</span><span id="line-1370"></span><span class="hs-comment">-- makes sense (that's done by 'validateDatabase').</span><span>
</span><span id="line-1371"></span><span class="annot"><a href="GHC.Unit.State.html#mergeDatabases"><span class="hs-identifier hs-type">mergeDatabases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1372"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1373"></span><span id="mergeDatabases"><span class="annot"><span class="annottext">mergeDatabases :: Logger
-&gt; [UnitDatabase UnitId] -&gt; IO (UnitInfoMap, UnitPrecedenceMap)
</span><a href="GHC.Unit.State.html#mergeDatabases"><span class="hs-identifier hs-var hs-var">mergeDatabases</span></a></span></span><span> </span><span id="local-6989586621681680646"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680646"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((UnitInfoMap, UnitPrecedenceMap)
 -&gt; (Int, UnitDatabase UnitId)
 -&gt; IO (UnitInfoMap, UnitPrecedenceMap))
-&gt; (UnitInfoMap, UnitPrecedenceMap)
-&gt; [(Int, UnitDatabase UnitId)]
-&gt; IO (UnitInfoMap, UnitPrecedenceMap)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#foldM/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitInfoMap, UnitPrecedenceMap)
-&gt; (Int, UnitDatabase UnitId)
-&gt; IO (UnitInfoMap, UnitPrecedenceMap)
</span><a href="#local-6989586621681680648"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Int, UnitDatabase UnitId)]
 -&gt; IO (UnitInfoMap, UnitPrecedenceMap))
-&gt; ([UnitDatabase UnitId] -&gt; [(Int, UnitDatabase UnitId)])
-&gt; [UnitDatabase UnitId]
-&gt; IO (UnitInfoMap, UnitPrecedenceMap)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [UnitDatabase UnitId] -&gt; [(Int, UnitDatabase UnitId)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1374"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1375"></span><span>    </span><span id="local-6989586621681680648"><span class="annot"><span class="annottext">merge :: (UnitInfoMap, UnitPrecedenceMap)
-&gt; (Int, UnitDatabase UnitId)
-&gt; IO (UnitInfoMap, UnitPrecedenceMap)
</span><a href="#local-6989586621681680648"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680649"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680649"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680650"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680650"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680651"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681680651"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span id="local-6989586621681680652"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680652"><span class="hs-identifier hs-var">db_path</span></a></span></span><span> </span><span id="local-6989586621681680653"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680653"><span class="hs-identifier hs-var">db</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1376"></span><span>      </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680646"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1377"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;loading package database&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681680652"><span class="hs-identifier hs-var">db_path</span></a></span><span>
</span><span id="line-1378"></span><span>      </span><span class="annot"><span class="annottext">[UnitId] -&gt; (UnitId -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#forM_/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680656"><span class="hs-identifier hs-var">override_set</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((UnitId -&gt; IO ()) -&gt; IO ()) -&gt; (UnitId -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681680657"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680657"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1379"></span><span>          </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680646"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1380"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680657"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1381"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;overrides a previously defined package&quot;</span></span><span>
</span><span id="line-1382"></span><span>      </span><span class="annot"><span class="annottext">(UnitInfoMap, UnitPrecedenceMap)
-&gt; IO (UnitInfoMap, UnitPrecedenceMap)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680658"><span class="hs-identifier hs-var">pkg_map'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680659"><span class="hs-identifier hs-var">prec_map'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1383"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-1384"></span><span>      </span><span id="local-6989586621681680660"><span class="annot"><span class="annottext">db_map :: UnitInfoMap
</span><a href="#local-6989586621681680660"><span class="hs-identifier hs-var hs-var">db_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; UnitInfoMap
forall {srcpkgid} {srcpkgname} {modulename} {mod}.
[GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod]
-&gt; Map
     UnitId (GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)
</span><a href="#local-6989586621681680661"><span class="hs-identifier hs-var">mk_pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680653"><span class="hs-identifier hs-var">db</span></a></span><span>
</span><span id="line-1385"></span><span>      </span><span id="local-6989586621681680661"><span class="annot"><span class="annottext">mk_pkg_map :: [GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod]
-&gt; Map
     UnitId (GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)
</span><a href="#local-6989586621681680661"><span class="hs-identifier hs-var hs-var">mk_pkg_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(UnitId,
  GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)]
-&gt; Map
     UnitId (GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(UnitId,
   GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)]
 -&gt; Map
      UnitId (GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod))
-&gt; ([GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod]
    -&gt; [(UnitId,
         GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)])
-&gt; [GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod]
-&gt; Map
     UnitId (GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
 -&gt; (UnitId,
     GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod))
-&gt; [GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod]
-&gt; [(UnitId,
     GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681680664"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680664"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680664"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681680664"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span>      </span><span class="hs-comment">-- The set of UnitIds which appear in both db and pkgs.  These are the</span><span>
</span><span id="line-1388"></span><span>      </span><span class="hs-comment">-- ones that get overridden.  Compute this just to give some</span><span>
</span><span id="line-1389"></span><span>      </span><span class="hs-comment">-- helpful debug messages at -v2</span><span>
</span><span id="line-1390"></span><span>      </span><span class="annot"><a href="#local-6989586621681680656"><span class="hs-identifier hs-type">override_set</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1391"></span><span>      </span><span id="local-6989586621681680656"><span class="annot"><span class="annottext">override_set :: Set UnitId
</span><a href="#local-6989586621681680656"><span class="hs-identifier hs-var hs-var">override_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#intersection/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap -&gt; Set UnitId
forall k a. Map k a -&gt; Set k
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#keysSet/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680660"><span class="hs-identifier hs-var">db_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1392"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap -&gt; Set UnitId
forall k a. Map k a -&gt; Set k
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#keysSet/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680649"><span class="hs-identifier hs-var">pkg_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1393"></span><span>
</span><span id="line-1394"></span><span>      </span><span class="hs-comment">-- Now merge the sets together (NB: in case of duplicate,</span><span>
</span><span id="line-1395"></span><span>      </span><span class="hs-comment">-- first argument preferred)</span><span>
</span><span id="line-1396"></span><span>      </span><span class="annot"><a href="#local-6989586621681680658"><span class="hs-identifier hs-type">pkg_map'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-1397"></span><span>      </span><span id="local-6989586621681680658"><span class="annot"><span class="annottext">pkg_map' :: UnitInfoMap
</span><a href="#local-6989586621681680658"><span class="hs-identifier hs-var hs-var">pkg_map'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfoMap -&gt; UnitInfoMap
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">Map.union</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680660"><span class="hs-identifier hs-var">db_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680649"><span class="hs-identifier hs-var">pkg_map</span></a></span><span>
</span><span id="line-1398"></span><span>
</span><span id="line-1399"></span><span>      </span><span class="annot"><a href="#local-6989586621681680659"><span class="hs-identifier hs-type">prec_map'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitPrecedenceMap"><span class="hs-identifier hs-type">UnitPrecedenceMap</span></a></span><span>
</span><span id="line-1400"></span><span>      </span><span id="local-6989586621681680659"><span class="annot"><span class="annottext">prec_map' :: UnitPrecedenceMap
</span><a href="#local-6989586621681680659"><span class="hs-identifier hs-var hs-var">prec_map'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap -&gt; UnitPrecedenceMap -&gt; UnitPrecedenceMap
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">Map.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; Int) -&gt; UnitInfoMap -&gt; UnitPrecedenceMap
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#map/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; UnitInfo -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681680651"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680660"><span class="hs-identifier hs-var">db_map</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680650"><span class="hs-identifier hs-var">prec_map</span></a></span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span class="hs-comment">-- | Validates a database, removing unusable units from it</span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- (this includes removing units that the user has explicitly</span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- ignored.)  Our general strategy:</span><span>
</span><span id="line-1405"></span><span class="hs-comment">--</span><span>
</span><span id="line-1406"></span><span class="hs-comment">-- 1. Remove all broken units (dangling dependencies)</span><span>
</span><span id="line-1407"></span><span class="hs-comment">-- 2. Remove all units that are cyclic</span><span>
</span><span id="line-1408"></span><span class="hs-comment">-- 3. Apply ignore flags</span><span>
</span><span id="line-1409"></span><span class="hs-comment">-- 4. Remove all units which have deps with mismatching ABIs</span><span>
</span><span id="line-1410"></span><span class="hs-comment">--</span><span>
</span><span id="line-1411"></span><span class="annot"><a href="GHC.Unit.State.html#validateDatabase"><span class="hs-identifier hs-type">validateDatabase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-1412"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span id="validateDatabase"><span class="annot"><span class="annottext">validateDatabase :: UnitConfig
-&gt; UnitInfoMap -&gt; (UnitInfoMap, UnusableUnits, [SCC UnitInfo])
</span><a href="GHC.Unit.State.html#validateDatabase"><span class="hs-identifier hs-var hs-var">validateDatabase</span></a></span></span><span> </span><span id="local-6989586621681680670"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680670"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621681680671"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680671"><span class="hs-identifier hs-var">pkg_map1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1414"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680672"><span class="hs-identifier hs-var">pkg_map5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680673"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SCC UnitInfo]
</span><a href="#local-6989586621681680674"><span class="hs-identifier hs-var">sccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1416"></span><span>    </span><span id="local-6989586621681680675"><span class="annot"><span class="annottext">ignore_flags :: [IgnorePackageFlag]
</span><a href="#local-6989586621681680675"><span class="hs-identifier hs-var hs-var">ignore_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IgnorePackageFlag] -&gt; [IgnorePackageFlag]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; [IgnorePackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsIgnored"><span class="hs-identifier hs-var">unitConfigFlagsIgnored</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680670"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1417"></span><span>
</span><span id="line-1418"></span><span>    </span><span class="hs-comment">-- Compute the reverse dependency index</span><span>
</span><span id="line-1419"></span><span>    </span><span id="local-6989586621681680676"><span class="annot"><span class="annottext">index :: RevIndex
</span><a href="#local-6989586621681680676"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; RevIndex
</span><a href="GHC.Unit.State.html#reverseDeps"><span class="hs-identifier hs-var">reverseDeps</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680671"><span class="hs-identifier hs-var">pkg_map1</span></a></span><span>
</span><span id="line-1420"></span><span>
</span><span id="line-1421"></span><span>    </span><span class="hs-comment">-- Helper function</span><span>
</span><span id="line-1422"></span><span>    </span><span id="local-6989586621681680681"><span class="annot"><span class="annottext">mk_unusable :: (t -&gt; b)
-&gt; (t -&gt; GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; t)
-&gt; t
-&gt; [GenericUnitInfo srcpkgid srcpkgname k modulename mod]
-&gt; Map k (GenericUnitInfo srcpkgid srcpkgname k modulename mod, b)
</span><a href="#local-6989586621681680681"><span class="hs-identifier hs-var hs-var">mk_unusable</span></a></span></span><span> </span><span id="local-6989586621681680682"><span class="annot"><span class="annottext">t -&gt; b
</span><a href="#local-6989586621681680682"><span class="hs-identifier hs-var">mk_err</span></a></span></span><span> </span><span id="local-6989586621681680683"><span class="annot"><span class="annottext">t -&gt; GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; t
</span><a href="#local-6989586621681680683"><span class="hs-identifier hs-var">dep_matcher</span></a></span></span><span> </span><span id="local-6989586621681680684"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681680684"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681680685"><span class="annot"><span class="annottext">[GenericUnitInfo srcpkgid srcpkgname k modulename mod]
</span><a href="#local-6989586621681680685"><span class="hs-identifier hs-var">uids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1423"></span><span>      </span><span class="annot"><span class="annottext">[(k, (GenericUnitInfo srcpkgid srcpkgname k modulename mod, b))]
-&gt; Map k (GenericUnitInfo srcpkgid srcpkgname k modulename mod, b)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; k
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname k modulename mod
</span><a href="#local-6989586621681680686"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname k modulename mod
</span><a href="#local-6989586621681680686"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">t -&gt; b
</span><a href="#local-6989586621681680682"><span class="hs-identifier hs-var">mk_err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; t
</span><a href="#local-6989586621681680683"><span class="hs-identifier hs-var">dep_matcher</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681680684"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname k modulename mod
</span><a href="#local-6989586621681680686"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1424"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680686"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname k modulename mod
</span><a href="#local-6989586621681680686"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenericUnitInfo srcpkgid srcpkgname k modulename mod]
</span><a href="#local-6989586621681680685"><span class="hs-identifier hs-var">uids</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1425"></span><span>
</span><span id="line-1426"></span><span>    </span><span class="hs-comment">-- Find broken units</span><span>
</span><span id="line-1427"></span><span>    </span><span id="local-6989586621681680687"><span class="annot"><span class="annottext">directly_broken :: [UnitInfo]
</span><a href="#local-6989586621681680687"><span class="hs-identifier hs-var hs-var">directly_broken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (UnitInfo -&gt; Bool) -&gt; UnitInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Bool) -&gt; (UnitInfo -&gt; [UnitId]) -&gt; UnitInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsNotAvailable"><span class="hs-identifier hs-var">depsNotAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680671"><span class="hs-identifier hs-var">pkg_map1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap -&gt; [UnitInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680671"><span class="hs-identifier hs-var">pkg_map1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1429"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681680688"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680688"><span class="hs-identifier hs-var">pkg_map2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680689"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680689"><span class="hs-identifier hs-var">broken</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; RevIndex -&gt; UnitInfoMap -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="GHC.Unit.State.html#removeUnits"><span class="hs-identifier hs-var">removeUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitId) -&gt; [UnitInfo] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680687"><span class="hs-identifier hs-var">directly_broken</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RevIndex
</span><a href="#local-6989586621681680676"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680671"><span class="hs-identifier hs-var">pkg_map1</span></a></span><span>
</span><span id="line-1430"></span><span>    </span><span id="local-6989586621681680690"><span class="annot"><span class="annottext">unusable_broken :: UnusableUnits
</span><a href="#local-6989586621681680690"><span class="hs-identifier hs-var hs-var">unusable_broken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; UnusableUnitReason)
-&gt; (UnitInfoMap -&gt; UnitInfo -&gt; [UnitId])
-&gt; UnitInfoMap
-&gt; [UnitInfo]
-&gt; UnusableUnits
forall {k} {t} {b} {t} {srcpkgid} {srcpkgname} {modulename} {mod}.
Ord k =&gt;
(t -&gt; b)
-&gt; (t -&gt; GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; t)
-&gt; t
-&gt; [GenericUnitInfo srcpkgid srcpkgname k modulename mod]
-&gt; Map k (GenericUnitInfo srcpkgid srcpkgname k modulename mod, b)
</span><a href="#local-6989586621681680681"><span class="hs-identifier hs-var">mk_unusable</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; UnusableUnitReason
</span><a href="GHC.Unit.State.html#BrokenDependencies"><span class="hs-identifier hs-var">BrokenDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsNotAvailable"><span class="hs-identifier hs-var">depsNotAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680688"><span class="hs-identifier hs-var">pkg_map2</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680689"><span class="hs-identifier hs-var">broken</span></a></span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span>    </span><span class="hs-comment">-- Find recursive units</span><span>
</span><span id="line-1433"></span><span>    </span><span id="local-6989586621681680674"><span class="annot"><span class="annottext">sccs :: [SCC UnitInfo]
</span><a href="#local-6989586621681680674"><span class="hs-identifier hs-var hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnitId, [UnitId])] -&gt; [SCC UnitInfo]
forall key node. Ord key =&gt; [(node, key, [key])] -&gt; [SCC node]
</span><a href="../../containers-0.6.7/src/Data.Graph.html#stronglyConnComp/Data.Graph.html#stronglyConnComp"><span class="hs-identifier hs-var">stronglyConnComp</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680691"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680691"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [UnitId]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; [uid]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitDepends/GHC.Unit.Database.html#unitDepends"><span class="hs-identifier hs-var">unitDepends</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680691"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680691"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680691"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; [UnitInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680688"><span class="hs-identifier hs-var">pkg_map2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1435"></span><span>    </span><span id="local-6989586621681680692"><span class="annot"><span class="annottext">getCyclicSCC :: SCC (GenericUnitInfo srcpkgid srcpkgname b modulename mod) -&gt; [b]
</span><a href="#local-6989586621681680692"><span class="hs-identifier hs-var hs-var">getCyclicSCC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#CyclicSCC/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621681680693"><span class="annot"><span class="annottext">[GenericUnitInfo srcpkgid srcpkgname b modulename mod]
</span><a href="#local-6989586621681680693"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo srcpkgid srcpkgname b modulename mod -&gt; b)
-&gt; [GenericUnitInfo srcpkgid srcpkgname b modulename mod] -&gt; [b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname b modulename mod -&gt; b
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">[GenericUnitInfo srcpkgid srcpkgname b modulename mod]
</span><a href="#local-6989586621681680693"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1436"></span><span>    </span><span class="annot"><a href="#local-6989586621681680692"><span class="hs-identifier hs-var">getCyclicSCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#AcyclicSCC/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname b modulename mod
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1437"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681680694"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680694"><span class="hs-identifier hs-var">pkg_map3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680695"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680695"><span class="hs-identifier hs-var">cyclic</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; RevIndex -&gt; UnitInfoMap -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="GHC.Unit.State.html#removeUnits"><span class="hs-identifier hs-var">removeUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SCC UnitInfo -&gt; [UnitId]) -&gt; [SCC UnitInfo] -&gt; [UnitId]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">SCC UnitInfo -&gt; [UnitId]
forall {srcpkgid} {srcpkgname} {b} {modulename} {mod}.
SCC (GenericUnitInfo srcpkgid srcpkgname b modulename mod) -&gt; [b]
</span><a href="#local-6989586621681680692"><span class="hs-identifier hs-var">getCyclicSCC</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC UnitInfo]
</span><a href="#local-6989586621681680674"><span class="hs-identifier hs-var">sccs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RevIndex
</span><a href="#local-6989586621681680676"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680688"><span class="hs-identifier hs-var">pkg_map2</span></a></span><span>
</span><span id="line-1438"></span><span>    </span><span id="local-6989586621681680696"><span class="annot"><span class="annottext">unusable_cyclic :: UnusableUnits
</span><a href="#local-6989586621681680696"><span class="hs-identifier hs-var hs-var">unusable_cyclic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; UnusableUnitReason)
-&gt; (UnitInfoMap -&gt; UnitInfo -&gt; [UnitId])
-&gt; UnitInfoMap
-&gt; [UnitInfo]
-&gt; UnusableUnits
forall {k} {t} {b} {t} {srcpkgid} {srcpkgname} {modulename} {mod}.
Ord k =&gt;
(t -&gt; b)
-&gt; (t -&gt; GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; t)
-&gt; t
-&gt; [GenericUnitInfo srcpkgid srcpkgname k modulename mod]
-&gt; Map k (GenericUnitInfo srcpkgid srcpkgname k modulename mod, b)
</span><a href="#local-6989586621681680681"><span class="hs-identifier hs-var">mk_unusable</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; UnusableUnitReason
</span><a href="GHC.Unit.State.html#CyclicDependencies"><span class="hs-identifier hs-var">CyclicDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsNotAvailable"><span class="hs-identifier hs-var">depsNotAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680694"><span class="hs-identifier hs-var">pkg_map3</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680695"><span class="hs-identifier hs-var">cyclic</span></a></span><span>
</span><span id="line-1439"></span><span>
</span><span id="line-1440"></span><span>    </span><span class="hs-comment">-- Apply ignore flags</span><span>
</span><span id="line-1441"></span><span>    </span><span id="local-6989586621681680697"><span class="annot"><span class="annottext">directly_ignored :: UnusableUnits
</span><a href="#local-6989586621681680697"><span class="hs-identifier hs-var hs-var">directly_ignored</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[IgnorePackageFlag] -&gt; [UnitInfo] -&gt; UnusableUnits
</span><a href="GHC.Unit.State.html#ignoreUnits"><span class="hs-identifier hs-var">ignoreUnits</span></a></span><span> </span><span class="annot"><span class="annottext">[IgnorePackageFlag]
</span><a href="#local-6989586621681680675"><span class="hs-identifier hs-var">ignore_flags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap -&gt; [UnitInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680694"><span class="hs-identifier hs-var">pkg_map3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681680698"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680698"><span class="hs-identifier hs-var">pkg_map4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680699"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680699"><span class="hs-identifier hs-var">ignored</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; RevIndex -&gt; UnitInfoMap -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="GHC.Unit.State.html#removeUnits"><span class="hs-identifier hs-var">removeUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnusableUnits -&gt; [UnitId]
forall k a. Map k a -&gt; [k]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#keys/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680697"><span class="hs-identifier hs-var">directly_ignored</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RevIndex
</span><a href="#local-6989586621681680676"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680694"><span class="hs-identifier hs-var">pkg_map3</span></a></span><span>
</span><span id="line-1443"></span><span>    </span><span id="local-6989586621681680701"><span class="annot"><span class="annottext">unusable_ignored :: UnusableUnits
</span><a href="#local-6989586621681680701"><span class="hs-identifier hs-var hs-var">unusable_ignored</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; UnusableUnitReason)
-&gt; (UnitInfoMap -&gt; UnitInfo -&gt; [UnitId])
-&gt; UnitInfoMap
-&gt; [UnitInfo]
-&gt; UnusableUnits
forall {k} {t} {b} {t} {srcpkgid} {srcpkgname} {modulename} {mod}.
Ord k =&gt;
(t -&gt; b)
-&gt; (t -&gt; GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; t)
-&gt; t
-&gt; [GenericUnitInfo srcpkgid srcpkgname k modulename mod]
-&gt; Map k (GenericUnitInfo srcpkgid srcpkgname k modulename mod, b)
</span><a href="#local-6989586621681680681"><span class="hs-identifier hs-var">mk_unusable</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; UnusableUnitReason
</span><a href="GHC.Unit.State.html#IgnoredDependencies"><span class="hs-identifier hs-var">IgnoredDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsNotAvailable"><span class="hs-identifier hs-var">depsNotAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680698"><span class="hs-identifier hs-var">pkg_map4</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680699"><span class="hs-identifier hs-var">ignored</span></a></span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span>    </span><span class="hs-comment">-- Knock out units whose dependencies don't agree with ABI</span><span>
</span><span id="line-1446"></span><span>    </span><span class="hs-comment">-- (i.e., got invalidated due to shadowing)</span><span>
</span><span id="line-1447"></span><span>    </span><span id="local-6989586621681680702"><span class="annot"><span class="annottext">directly_shadowed :: [UnitInfo]
</span><a href="#local-6989586621681680702"><span class="hs-identifier hs-var hs-var">directly_shadowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (UnitInfo -&gt; Bool) -&gt; UnitInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Bool) -&gt; (UnitInfo -&gt; [UnitId]) -&gt; UnitInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsAbiMismatch"><span class="hs-identifier hs-var">depsAbiMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680698"><span class="hs-identifier hs-var">pkg_map4</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1448"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap -&gt; [UnitInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680698"><span class="hs-identifier hs-var">pkg_map4</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681680672"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680672"><span class="hs-identifier hs-var">pkg_map5</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680703"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680703"><span class="hs-identifier hs-var">shadowed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; RevIndex -&gt; UnitInfoMap -&gt; (UnitInfoMap, [UnitInfo])
</span><a href="GHC.Unit.State.html#removeUnits"><span class="hs-identifier hs-var">removeUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitId) -&gt; [UnitInfo] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680702"><span class="hs-identifier hs-var">directly_shadowed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RevIndex
</span><a href="#local-6989586621681680676"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680698"><span class="hs-identifier hs-var">pkg_map4</span></a></span><span>
</span><span id="line-1450"></span><span>    </span><span id="local-6989586621681680704"><span class="annot"><span class="annottext">unusable_shadowed :: UnusableUnits
</span><a href="#local-6989586621681680704"><span class="hs-identifier hs-var hs-var">unusable_shadowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; UnusableUnitReason)
-&gt; (UnitInfoMap -&gt; UnitInfo -&gt; [UnitId])
-&gt; UnitInfoMap
-&gt; [UnitInfo]
-&gt; UnusableUnits
forall {k} {t} {b} {t} {srcpkgid} {srcpkgname} {modulename} {mod}.
Ord k =&gt;
(t -&gt; b)
-&gt; (t -&gt; GenericUnitInfo srcpkgid srcpkgname k modulename mod -&gt; t)
-&gt; t
-&gt; [GenericUnitInfo srcpkgid srcpkgname k modulename mod]
-&gt; Map k (GenericUnitInfo srcpkgid srcpkgname k modulename mod, b)
</span><a href="#local-6989586621681680681"><span class="hs-identifier hs-var">mk_unusable</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; UnusableUnitReason
</span><a href="GHC.Unit.State.html#ShadowedDependencies"><span class="hs-identifier hs-var">ShadowedDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitInfo -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#depsAbiMismatch"><span class="hs-identifier hs-var">depsAbiMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680672"><span class="hs-identifier hs-var">pkg_map5</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680703"><span class="hs-identifier hs-var">shadowed</span></a></span><span>
</span><span id="line-1451"></span><span>
</span><span id="line-1452"></span><span>    </span><span id="local-6989586621681680673"><span class="annot"><span class="annottext">unusable :: UnusableUnits
</span><a href="#local-6989586621681680673"><span class="hs-identifier hs-var hs-var">unusable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680697"><span class="hs-identifier hs-var">directly_ignored</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits -&gt; UnusableUnits -&gt; UnusableUnits
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`Map.union`</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680701"><span class="hs-identifier hs-var">unusable_ignored</span></a></span><span>
</span><span id="line-1453"></span><span>                                </span><span class="annot"><span class="annottext">UnusableUnits -&gt; UnusableUnits -&gt; UnusableUnits
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`Map.union`</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680690"><span class="hs-identifier hs-var">unusable_broken</span></a></span><span>
</span><span id="line-1454"></span><span>                                </span><span class="annot"><span class="annottext">UnusableUnits -&gt; UnusableUnits -&gt; UnusableUnits
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`Map.union`</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680696"><span class="hs-identifier hs-var">unusable_cyclic</span></a></span><span>
</span><span id="line-1455"></span><span>                                </span><span class="annot"><span class="annottext">UnusableUnits -&gt; UnusableUnits -&gt; UnusableUnits
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-operator hs-var">`Map.union`</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680704"><span class="hs-identifier hs-var">unusable_shadowed</span></a></span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1458"></span><span class="hs-comment">-- When all the command-line options are in, we can process our unit</span><span>
</span><span id="line-1459"></span><span class="hs-comment">-- settings and populate the unit state.</span><span>
</span><span id="line-1460"></span><span>
</span><span id="line-1461"></span><span class="annot"><a href="GHC.Unit.State.html#mkUnitState"><span class="hs-identifier hs-type">mkUnitState</span></a></span><span>
</span><span id="line-1462"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-1463"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span>
</span><span id="line-1464"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#UnitDatabase"><span class="hs-identifier hs-type">UnitDatabase</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1465"></span><span id="mkUnitState"><span class="annot"><span class="annottext">mkUnitState :: Logger -&gt; UnitConfig -&gt; IO (UnitState, [UnitDatabase UnitId])
</span><a href="GHC.Unit.State.html#mkUnitState"><span class="hs-identifier hs-var hs-var">mkUnitState</span></a></span></span><span> </span><span id="local-6989586621681680705"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680706"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1466"></span><span class="hs-comment">{-
   Plan.

   There are two main steps for making the package state:

    1. We want to build a single, unified package database based
       on all of the input databases, which upholds the invariant that
       there is only one package per any UnitId and there are no
       dangling dependencies.  We'll do this by merging, and
       then successively filtering out bad dependencies.

       a) Merge all the databases together.
          If an input database defines unit ID that is already in
          the unified database, that package SHADOWS the existing
          package in the current unified database.  Note that
          order is important: packages defined later in the list of
          command line arguments shadow those defined earlier.

       b) Remove all packages with missing dependencies, or
          mutually recursive dependencies.

       b) Remove packages selected by -ignore-package from input database

       c) Remove all packages which depended on packages that are now
          shadowed by an ABI-incompatible package

       d) report (with -v) any packages that were removed by steps 1-3

    2. We want to look at the flags controlling package visibility,
       and build a mapping of what module names are in scope and
       where they live.

       a) on the final, unified database, we apply -trust/-distrust
          flags directly, modifying the database so that the 'trusted'
          field has the correct value.

       b) we use the -package/-hide-package flags to compute a
          visibility map, stating what packages are &quot;exposed&quot; for
          the purposes of computing the module map.
          * if any flag refers to a package which was removed by 1-5, then
            we can give an error message explaining why
          * if -hide-all-packages was not specified, this step also
            hides packages which are superseded by later exposed packages
          * this step is done TWICE if -plugin-package/-hide-all-plugin-packages
            are used

       c) based on the visibility map, we pick wired packages and rewrite
          them to have the expected unitId.

       d) finally, using the visibility map and the package database,
          we build a mapping saying what every in scope module name points to.
-}</span><span>
</span><span id="line-1518"></span><span>
</span><span id="line-1519"></span><span>  </span><span class="hs-comment">-- if databases have not been provided, read the database flags</span><span>
</span><span id="line-1520"></span><span>  </span><span id="local-6989586621681680707"><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680707"><span class="hs-identifier hs-var">raw_dbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; Maybe [UnitDatabase UnitId]
</span><a href="GHC.Unit.State.html#unitConfigDBCache"><span class="hs-identifier hs-var">unitConfigDBCache</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1521"></span><span>               </span><span class="annot"><span class="annottext">Maybe [UnitDatabase UnitId]
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; UnitConfig -&gt; IO [UnitDatabase UnitId]
</span><a href="GHC.Unit.State.html#readUnitDatabases"><span class="hs-identifier hs-var">readUnitDatabases</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-1522"></span><span>               </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680708"><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680708"><span class="hs-identifier hs-var">dbs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UnitDatabase UnitId] -&gt; IO [UnitDatabase UnitId]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680708"><span class="hs-identifier hs-var">dbs</span></a></span><span>
</span><span id="line-1523"></span><span>
</span><span id="line-1524"></span><span>  </span><span class="hs-comment">-- distrust all units if the flag is set</span><span>
</span><span id="line-1525"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680709"><span class="annot"><span class="annottext">distrust_all :: UnitDatabase UnitId -&gt; UnitDatabase UnitId
</span><a href="#local-6989586621681680709"><span class="hs-identifier hs-var hs-var">distrust_all</span></a></span></span><span> </span><span id="local-6989586621681680710"><span class="annot"><span class="annottext">UnitDatabase UnitId
</span><a href="#local-6989586621681680710"><span class="hs-identifier hs-var">db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitDatabase UnitId
</span><a href="#local-6989586621681680710"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#unitDatabaseUnits"><span class="hs-identifier hs-var">unitDatabaseUnits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#distrustAllUnits"><span class="hs-identifier hs-type">distrustAllUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.State.html#unitDatabaseUnits"><span class="hs-identifier hs-var">unitDatabaseUnits</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681680710"><span class="hs-identifier hs-type">db</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1526"></span><span>      </span><span id="local-6989586621681680711"><span class="annot"><span class="annottext">dbs :: [UnitDatabase UnitId]
</span><a href="#local-6989586621681680711"><span class="hs-identifier hs-var hs-var">dbs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigDistrustAll"><span class="hs-identifier hs-var">unitConfigDistrustAll</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitDatabase UnitId -&gt; UnitDatabase UnitId)
-&gt; [UnitDatabase UnitId] -&gt; [UnitDatabase UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitDatabase UnitId -&gt; UnitDatabase UnitId
</span><a href="#local-6989586621681680709"><span class="hs-identifier hs-var">distrust_all</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680707"><span class="hs-identifier hs-var">raw_dbs</span></a></span><span>
</span><span id="line-1527"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680707"><span class="hs-identifier hs-var">raw_dbs</span></a></span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span>  </span><span class="hs-comment">-- This, and the other reverse's that you will see, are due to the fact that</span><span>
</span><span id="line-1531"></span><span>  </span><span class="hs-comment">-- packageFlags, pluginPackageFlags, etc. are all specified in *reverse* order</span><span>
</span><span id="line-1532"></span><span>  </span><span class="hs-comment">-- than they are on the command line.</span><span>
</span><span id="line-1533"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680712"><span class="annot"><span class="annottext">raw_other_flags :: [PackageFlag]
</span><a href="#local-6989586621681680712"><span class="hs-identifier hs-var hs-var">raw_other_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PackageFlag] -&gt; [PackageFlag]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; [PackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsExposed"><span class="hs-identifier hs-var">unitConfigFlagsExposed</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1534"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681680713"><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680713"><span class="hs-identifier hs-var">hpt_flags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680714"><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680714"><span class="hs-identifier hs-var">other_flags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PackageFlag -&gt; Bool)
-&gt; [PackageFlag] -&gt; ([PackageFlag], [PackageFlag])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#partition/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId -&gt; PackageFlag -&gt; Bool
</span><a href="GHC.Unit.State.html#selectHptFlag"><span class="hs-identifier hs-var">selectHptFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; Set UnitId
</span><a href="GHC.Unit.State.html#unitConfigHomeUnits"><span class="hs-identifier hs-var">unitConfigHomeUnits</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680712"><span class="hs-identifier hs-var">raw_other_flags</span></a></span><span>
</span><span id="line-1535"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1536"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package flags&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[PackageFlag] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680714"><span class="hs-identifier hs-var">other_flags</span></a></span><span>
</span><span id="line-1537"></span><span>
</span><span id="line-1538"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680716"><span class="annot"><span class="annottext">home_unit_deps :: Set UnitId
</span><a href="#local-6989586621681680716"><span class="hs-identifier hs-var hs-var">home_unit_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; [PackageFlag] -&gt; Set UnitId
</span><a href="GHC.Unit.State.html#selectHomeUnits"><span class="hs-identifier hs-var">selectHomeUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; Set UnitId
</span><a href="GHC.Unit.State.html#unitConfigHomeUnits"><span class="hs-identifier hs-var">unitConfigHomeUnits</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680713"><span class="hs-identifier hs-var">hpt_flags</span></a></span><span>
</span><span id="line-1539"></span><span>
</span><span id="line-1540"></span><span>  </span><span class="hs-comment">-- Merge databases together, without checking validity</span><span>
</span><span id="line-1541"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681680718"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680718"><span class="hs-identifier hs-var">pkg_map1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680719"><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680719"><span class="hs-identifier hs-var">prec_map</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; [UnitDatabase UnitId] -&gt; IO (UnitInfoMap, UnitPrecedenceMap)
</span><a href="GHC.Unit.State.html#mergeDatabases"><span class="hs-identifier hs-var">mergeDatabases</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680711"><span class="hs-identifier hs-var">dbs</span></a></span><span>
</span><span id="line-1542"></span><span>
</span><span id="line-1543"></span><span>  </span><span class="hs-comment">-- Now that we've merged everything together, prune out unusable</span><span>
</span><span id="line-1544"></span><span>  </span><span class="hs-comment">-- packages.</span><span>
</span><span id="line-1545"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680720"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680720"><span class="hs-identifier hs-var">pkg_map2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680721"><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680721"><span class="hs-identifier hs-var">unusable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680722"><span class="annot"><span class="annottext">[SCC UnitInfo]
</span><a href="#local-6989586621681680722"><span class="hs-identifier hs-var">sccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitConfig
-&gt; UnitInfoMap -&gt; (UnitInfoMap, UnusableUnits, [SCC UnitInfo])
</span><a href="GHC.Unit.State.html#validateDatabase"><span class="hs-identifier hs-var">validateDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680718"><span class="hs-identifier hs-var">pkg_map1</span></a></span><span>
</span><span id="line-1546"></span><span>
</span><span id="line-1547"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; [SCC UnitInfo] -&gt; IO ()
</span><a href="GHC.Unit.State.html#reportCycles"><span class="hs-identifier hs-var">reportCycles</span></a></span><span>   </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC UnitInfo]
</span><a href="#local-6989586621681680722"><span class="hs-identifier hs-var">sccs</span></a></span><span>
</span><span id="line-1548"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; UnusableUnits -&gt; IO ()
</span><a href="GHC.Unit.State.html#reportUnusable"><span class="hs-identifier hs-var">reportUnusable</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680721"><span class="hs-identifier hs-var">unusable</span></a></span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span>  </span><span class="hs-comment">-- Apply trust flags (these flags apply regardless of whether</span><span>
</span><span id="line-1551"></span><span>  </span><span class="hs-comment">-- or not packages are visible or not)</span><span>
</span><span id="line-1552"></span><span>  </span><span id="local-6989586621681680723"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680723"><span class="hs-identifier hs-var">pkgs1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeErr UnitErr [UnitInfo] -&gt; IO [UnitInfo]
forall a. MaybeErr UnitErr a -&gt; IO a
</span><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-var">mayThrowUnitErr</span></a></span><span>
</span><span id="line-1553"></span><span>            </span><span class="annot"><span class="annottext">(MaybeErr UnitErr [UnitInfo] -&gt; IO [UnitInfo])
-&gt; MaybeErr UnitErr [UnitInfo] -&gt; IO [UnitInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitInfo] -&gt; TrustFlag -&gt; MaybeErr UnitErr [UnitInfo])
-&gt; [UnitInfo] -&gt; [TrustFlag] -&gt; MaybeErr UnitErr [UnitInfo]
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#foldM/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitPrecedenceMap
-&gt; UnusableUnits
-&gt; [UnitInfo]
-&gt; TrustFlag
-&gt; MaybeErr UnitErr [UnitInfo]
</span><a href="GHC.Unit.State.html#applyTrustFlag"><span class="hs-identifier hs-var">applyTrustFlag</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680719"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680721"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1554"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap -&gt; [UnitInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680720"><span class="hs-identifier hs-var">pkg_map2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TrustFlag] -&gt; [TrustFlag]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; [TrustFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsTrusted"><span class="hs-identifier hs-var">unitConfigFlagsTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1555"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680724"><span class="annot"><span class="annottext">prelim_pkg_db :: UnitInfoMap
</span><a href="#local-6989586621681680724"><span class="hs-identifier hs-var hs-var">prelim_pkg_db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#mkUnitInfoMap"><span class="hs-identifier hs-var">mkUnitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680723"><span class="hs-identifier hs-var">pkgs1</span></a></span><span>
</span><span id="line-1556"></span><span>
</span><span id="line-1557"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1558"></span><span>  </span><span class="hs-comment">-- Calculate the initial set of units from package databases, prior to any package flags.</span><span>
</span><span id="line-1559"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1560"></span><span>  </span><span class="hs-comment">-- Conceptually, we select the latest versions of all valid (not unusable) *packages*</span><span>
</span><span id="line-1561"></span><span>  </span><span class="hs-comment">-- (not units). This is empty if we have -hide-all-packages.</span><span>
</span><span id="line-1562"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1563"></span><span>  </span><span class="hs-comment">-- Then we create an initial visibility map with default visibilities for all</span><span>
</span><span id="line-1564"></span><span>  </span><span class="hs-comment">-- exposed, definite units which belong to the latest valid packages.</span><span>
</span><span id="line-1565"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1566"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680725"><span class="annot"><span class="annottext">preferLater :: UnitInfo -&gt; UnitInfo -&gt; UnitInfo
</span><a href="#local-6989586621681680725"><span class="hs-identifier hs-var hs-var">preferLater</span></a></span></span><span> </span><span id="local-6989586621681680726"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680726"><span class="hs-keyword hs-var">unit</span></a></span></span><span> </span><span id="local-6989586621681680727"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680727"><span class="hs-identifier hs-var">unit'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1567"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap -&gt; UnitInfo -&gt; UnitInfo -&gt; Ordering
</span><a href="GHC.Unit.State.html#compareByPreference"><span class="hs-identifier hs-var">compareByPreference</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680719"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680726"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680727"><span class="hs-identifier hs-var">unit'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1568"></span><span>            </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680726"><span class="hs-keyword hs-var">unit</span></a></span><span>
</span><span id="line-1569"></span><span>            </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680727"><span class="hs-identifier hs-var">unit'</span></a></span><span>
</span><span id="line-1570"></span><span>      </span><span id="local-6989586621681680728"><span class="annot"><span class="annottext">addIfMorePreferable :: UniqDFM FastString UnitInfo
-&gt; UnitInfo -&gt; UniqDFM FastString UnitInfo
</span><a href="#local-6989586621681680728"><span class="hs-identifier hs-var hs-var">addIfMorePreferable</span></a></span></span><span> </span><span id="local-6989586621681680729"><span class="annot"><span class="annottext">UniqDFM FastString UnitInfo
</span><a href="#local-6989586621681680729"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681680730"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680730"><span class="hs-keyword hs-var">unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitInfo -&gt; UnitInfo)
-&gt; UniqDFM FastString UnitInfo
-&gt; FastString
-&gt; UnitInfo
-&gt; UniqDFM FastString UnitInfo
forall key elt.
Uniquable key =&gt;
(elt -&gt; elt -&gt; elt)
-&gt; UniqDFM key elt -&gt; key -&gt; elt -&gt; UniqDFM key elt
</span><a href="GHC.Types.Unique.DFM.html#addToUDFM_C"><span class="hs-identifier hs-var">addToUDFM_C</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitInfo -&gt; UnitInfo
</span><a href="#local-6989586621681680725"><span class="hs-identifier hs-var">preferLater</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDFM FastString UnitInfo
</span><a href="#local-6989586621681680729"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; FastString
</span><a href="GHC.Unit.State.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680730"><span class="hs-keyword hs-var">unit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680730"><span class="hs-keyword hs-var">unit</span></a></span><span>
</span><span id="line-1571"></span><span>      </span><span class="hs-comment">-- This is the set of maximally preferable packages. In fact, it is a set of</span><span>
</span><span id="line-1572"></span><span>      </span><span class="hs-comment">-- most preferable *units* keyed by package name, which act as stand-ins in</span><span>
</span><span id="line-1573"></span><span>      </span><span class="hs-comment">-- for &quot;a package in a database&quot;. We use units here because we don't have</span><span>
</span><span id="line-1574"></span><span>      </span><span class="hs-comment">-- &quot;a package in a database&quot; as a type currently.</span><span>
</span><span id="line-1575"></span><span>      </span><span id="local-6989586621681680732"><span class="annot"><span class="annottext">mostPreferablePackageReps :: UniqDFM FastString UnitInfo
</span><a href="#local-6989586621681680732"><span class="hs-identifier hs-var hs-var">mostPreferablePackageReps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigHideAll"><span class="hs-identifier hs-var">unitConfigHideAll</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-1576"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UniqDFM FastString UnitInfo
forall key elt. UniqDFM key elt
</span><a href="GHC.Types.Unique.DFM.html#emptyUDFM"><span class="hs-identifier hs-var">emptyUDFM</span></a></span><span>
</span><span id="line-1577"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(UniqDFM FastString UnitInfo
 -&gt; UnitInfo -&gt; UniqDFM FastString UnitInfo)
-&gt; UniqDFM FastString UnitInfo
-&gt; [UnitInfo]
-&gt; UniqDFM FastString UnitInfo
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDFM FastString UnitInfo
-&gt; UnitInfo -&gt; UniqDFM FastString UnitInfo
</span><a href="#local-6989586621681680728"><span class="hs-identifier hs-var">addIfMorePreferable</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDFM FastString UnitInfo
forall key elt. UniqDFM key elt
</span><a href="GHC.Types.Unique.DFM.html#emptyUDFM"><span class="hs-identifier hs-var">emptyUDFM</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680723"><span class="hs-identifier hs-var">pkgs1</span></a></span><span>
</span><span id="line-1578"></span><span>      </span><span class="hs-comment">-- When exposing units, we want to consider all of those in the most preferable</span><span>
</span><span id="line-1579"></span><span>      </span><span class="hs-comment">-- packages. We can implement that by looking for units that are equi-preferable</span><span>
</span><span id="line-1580"></span><span>      </span><span class="hs-comment">-- with the most preferable unit for package. Being equi-preferable means that</span><span>
</span><span id="line-1581"></span><span>      </span><span class="hs-comment">-- they must be in the same database, with the same version, and the same package name.</span><span>
</span><span id="line-1582"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1583"></span><span>      </span><span class="hs-comment">-- We must take care to consider all these units and not just the most</span><span>
</span><span id="line-1584"></span><span>      </span><span class="hs-comment">-- preferable one, otherwise we can end up with problems like #16228.</span><span>
</span><span id="line-1585"></span><span>      </span><span id="local-6989586621681680734"><span class="annot"><span class="annottext">mostPreferable :: UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680734"><span class="hs-identifier hs-var hs-var">mostPreferable</span></a></span></span><span> </span><span id="local-6989586621681680735"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680735"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1586"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqDFM FastString UnitInfo -&gt; FastString -&gt; Maybe UnitInfo
forall key elt.
Uniquable key =&gt;
UniqDFM key elt -&gt; key -&gt; Maybe elt
</span><a href="GHC.Types.Unique.DFM.html#lookupUDFM"><span class="hs-identifier hs-var">lookupUDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDFM FastString UnitInfo
</span><a href="#local-6989586621681680732"><span class="hs-identifier hs-var">mostPreferablePackageReps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; FastString
</span><a href="GHC.Unit.State.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680735"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1587"></span><span>          </span><span class="annot"><span class="annottext">Maybe UnitInfo
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1588"></span><span>          </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680737"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680737"><span class="hs-identifier hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap -&gt; UnitInfo -&gt; UnitInfo -&gt; Ordering
</span><a href="GHC.Unit.State.html#compareByPreference"><span class="hs-identifier hs-var">compareByPreference</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680719"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680735"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680737"><span class="hs-identifier hs-var">u'</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-1589"></span><span>      </span><span id="local-6989586621681680738"><span class="annot"><span class="annottext">vis_map1 :: VisibilityMap
</span><a href="#local-6989586621681680738"><span class="hs-identifier hs-var hs-var">vis_map1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VisibilityMap -&gt; UnitInfo -&gt; VisibilityMap)
-&gt; VisibilityMap -&gt; [UnitInfo] -&gt; VisibilityMap
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681680739"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680739"><span class="hs-identifier hs-var">vm</span></a></span></span><span> </span><span id="local-6989586621681680740"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680740"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1590"></span><span>                            </span><span class="hs-comment">-- Note: we NEVER expose indefinite packages by</span><span>
</span><span id="line-1591"></span><span>                            </span><span class="hs-comment">-- default, because it's almost assuredly not</span><span>
</span><span id="line-1592"></span><span>                            </span><span class="hs-comment">-- what you want (no mix-in linking has occurred).</span><span>
</span><span id="line-1593"></span><span>                            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Bool
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIsExposed/GHC.Unit.Database.html#unitIsExposed"><span class="hs-identifier hs-var">unitIsExposed</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680740"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; Bool
</span><a href="GHC.Unit.Types.html#unitIsDefinite"><span class="hs-identifier hs-var">unitIsDefinite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680740"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680734"><span class="hs-identifier hs-var">mostPreferable</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680740"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1594"></span><span>                               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitVisibility -&gt; VisibilityMap -&gt; VisibilityMap
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680740"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1595"></span><span>                                               </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1596"></span><span>                                                 </span><span class="annot"><span class="annottext">uv_expose_all :: Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-1597"></span><span>                                                 </span><span class="annot"><span class="annottext">uv_renamings :: [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1598"></span><span>                                                 </span><span class="annot"><span class="annottext">uv_package_name :: First FastString
</span><a href="GHC.Unit.State.html#uv_package_name"><span class="hs-identifier hs-var">uv_package_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FastString -&gt; First FastString
forall a. Maybe a -&gt; First a
</span><a href="../../base-4.18.3.0/src/Data.Monoid.html#First/Data.Monoid.html#First"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Maybe FastString
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; FastString
</span><a href="GHC.Unit.State.html#fsPackageName"><span class="hs-identifier hs-var">fsPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680740"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1599"></span><span>                                                 </span><span class="annot"><span class="annottext">uv_requirements :: Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName (Set InstantiatedModule)
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1600"></span><span>                                                 </span><span class="annot"><span class="annottext">uv_explicit :: Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PackageArg
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1601"></span><span>                                               </span><span class="hs-special">}</span><span>
</span><span id="line-1602"></span><span>                                               </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680739"><span class="hs-identifier hs-var">vm</span></a></span><span>
</span><span id="line-1603"></span><span>                               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680739"><span class="hs-identifier hs-var">vm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1604"></span><span>                         </span><span class="annot"><span class="annottext">VisibilityMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680723"><span class="hs-identifier hs-var">pkgs1</span></a></span><span>
</span><span id="line-1605"></span><span>
</span><span id="line-1606"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1607"></span><span>  </span><span class="hs-comment">-- Compute a visibility map according to the command-line flags (-package,</span><span>
</span><span id="line-1608"></span><span>  </span><span class="hs-comment">-- -hide-package).  This needs to know about the unusable packages, since if a</span><span>
</span><span id="line-1609"></span><span>  </span><span class="hs-comment">-- user tries to enable an unusable package, we should let them know.</span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1611"></span><span>  </span><span id="local-6989586621681680743"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680743"><span class="hs-identifier hs-var">vis_map2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeErr UnitErr VisibilityMap -&gt; IO VisibilityMap
forall a. MaybeErr UnitErr a -&gt; IO a
</span><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-var">mayThrowUnitErr</span></a></span><span>
</span><span id="line-1612"></span><span>                </span><span class="annot"><span class="annottext">(MaybeErr UnitErr VisibilityMap -&gt; IO VisibilityMap)
-&gt; MaybeErr UnitErr VisibilityMap -&gt; IO VisibilityMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(VisibilityMap -&gt; PackageFlag -&gt; MaybeErr UnitErr VisibilityMap)
-&gt; VisibilityMap -&gt; [PackageFlag] -&gt; MaybeErr UnitErr VisibilityMap
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#foldM/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitPrecedenceMap
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UnusableUnits
-&gt; Bool
-&gt; [UnitInfo]
-&gt; VisibilityMap
-&gt; PackageFlag
-&gt; MaybeErr UnitErr VisibilityMap
</span><a href="GHC.Unit.State.html#applyPackageFlag"><span class="hs-identifier hs-var">applyPackageFlag</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680719"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680724"><span class="hs-identifier hs-var">prelim_pkg_db</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680721"><span class="hs-identifier hs-var">unusable</span></a></span><span>
</span><span id="line-1613"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigHideAll"><span class="hs-identifier hs-var">unitConfigHideAll</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680723"><span class="hs-identifier hs-var">pkgs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1614"></span><span>                            </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680738"><span class="hs-identifier hs-var">vis_map1</span></a></span><span> </span><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680714"><span class="hs-identifier hs-var">other_flags</span></a></span><span>
</span><span id="line-1615"></span><span>
</span><span id="line-1616"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1617"></span><span>  </span><span class="hs-comment">-- Sort out which packages are wired in. This has to be done last, since</span><span>
</span><span id="line-1618"></span><span>  </span><span class="hs-comment">-- it modifies the unit ids of wired in packages, but when we process</span><span>
</span><span id="line-1619"></span><span>  </span><span class="hs-comment">-- package arguments we need to key against the old versions.</span><span>
</span><span id="line-1620"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1621"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681680744"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680744"><span class="hs-identifier hs-var">pkgs2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680745"><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680745"><span class="hs-identifier hs-var">wired_map</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; UnitPrecedenceMap
-&gt; [UnitInfo]
-&gt; VisibilityMap
-&gt; IO ([UnitInfo], Map UnitId UnitId)
</span><a href="GHC.Unit.State.html#findWiredInUnits"><span class="hs-identifier hs-var">findWiredInUnits</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680719"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680723"><span class="hs-identifier hs-var">pkgs1</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680743"><span class="hs-identifier hs-var">vis_map2</span></a></span><span>
</span><span id="line-1622"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680746"><span class="annot"><span class="annottext">pkg_db :: UnitInfoMap
</span><a href="#local-6989586621681680746"><span class="hs-identifier hs-var hs-var">pkg_db</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#mkUnitInfoMap"><span class="hs-identifier hs-var">mkUnitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680744"><span class="hs-identifier hs-var">pkgs2</span></a></span><span>
</span><span id="line-1623"></span><span>
</span><span id="line-1624"></span><span>  </span><span class="hs-comment">-- Update the visibility map, so we treat wired packages as visible.</span><span>
</span><span id="line-1625"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680747"><span class="annot"><span class="annottext">vis_map :: VisibilityMap
</span><a href="#local-6989586621681680747"><span class="hs-identifier hs-var hs-var">vis_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; VisibilityMap -&gt; VisibilityMap
</span><a href="GHC.Unit.State.html#updateVisibilityMap"><span class="hs-identifier hs-var">updateVisibilityMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680745"><span class="hs-identifier hs-var">wired_map</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680743"><span class="hs-identifier hs-var">vis_map2</span></a></span><span>
</span><span id="line-1626"></span><span>
</span><span id="line-1627"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680748"><span class="annot"><span class="annottext">hide_plugin_pkgs :: Bool
</span><a href="#local-6989586621681680748"><span class="hs-identifier hs-var hs-var">hide_plugin_pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigHideAllPlugins"><span class="hs-identifier hs-var">unitConfigHideAllPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-1628"></span><span>  </span><span id="local-6989586621681680749"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680749"><span class="hs-identifier hs-var">plugin_vis_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1629"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; [PackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsPlugins"><span class="hs-identifier hs-var">unitConfigFlagsPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1630"></span><span>        </span><span class="hs-comment">-- common case; try to share the old vis_map</span><span>
</span><span id="line-1631"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680748"><span class="hs-identifier hs-var">hide_plugin_pkgs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; IO VisibilityMap
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680747"><span class="hs-identifier hs-var">vis_map</span></a></span><span>
</span><span id="line-1632"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; IO VisibilityMap
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-1633"></span><span>        </span><span class="annot"><span class="annottext">[PackageFlag]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680750"><span class="annot"><span class="annottext">plugin_vis_map1 :: VisibilityMap
</span><a href="#local-6989586621681680750"><span class="hs-identifier hs-var hs-var">plugin_vis_map1</span></a></span></span><span>
</span><span id="line-1634"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680748"><span class="hs-identifier hs-var">hide_plugin_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-1635"></span><span>                        </span><span class="hs-comment">-- Use the vis_map PRIOR to wired in,</span><span>
</span><span id="line-1636"></span><span>                        </span><span class="hs-comment">-- because otherwise applyPackageFlag</span><span>
</span><span id="line-1637"></span><span>                        </span><span class="hs-comment">-- won't work.</span><span>
</span><span id="line-1638"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680743"><span class="hs-identifier hs-var">vis_map2</span></a></span><span>
</span><span id="line-1639"></span><span>                </span><span id="local-6989586621681680751"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680751"><span class="hs-identifier hs-var">plugin_vis_map2</span></a></span></span><span>
</span><span id="line-1640"></span><span>                    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeErr UnitErr VisibilityMap -&gt; IO VisibilityMap
forall a. MaybeErr UnitErr a -&gt; IO a
</span><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-var">mayThrowUnitErr</span></a></span><span>
</span><span id="line-1641"></span><span>                        </span><span class="annot"><span class="annottext">(MaybeErr UnitErr VisibilityMap -&gt; IO VisibilityMap)
-&gt; MaybeErr UnitErr VisibilityMap -&gt; IO VisibilityMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(VisibilityMap -&gt; PackageFlag -&gt; MaybeErr UnitErr VisibilityMap)
-&gt; VisibilityMap -&gt; [PackageFlag] -&gt; MaybeErr UnitErr VisibilityMap
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#foldM/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitPrecedenceMap
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UnusableUnits
-&gt; Bool
-&gt; [UnitInfo]
-&gt; VisibilityMap
-&gt; PackageFlag
-&gt; MaybeErr UnitErr VisibilityMap
</span><a href="GHC.Unit.State.html#applyPackageFlag"><span class="hs-identifier hs-var">applyPackageFlag</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPrecedenceMap
</span><a href="#local-6989586621681680719"><span class="hs-identifier hs-var">prec_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680724"><span class="hs-identifier hs-var">prelim_pkg_db</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680721"><span class="hs-identifier hs-var">unusable</span></a></span><span>
</span><span id="line-1642"></span><span>                                </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680748"><span class="hs-identifier hs-var">hide_plugin_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680723"><span class="hs-identifier hs-var">pkgs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1643"></span><span>                             </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680750"><span class="hs-identifier hs-var">plugin_vis_map1</span></a></span><span>
</span><span id="line-1644"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PackageFlag] -&gt; [PackageFlag]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; [PackageFlag]
</span><a href="GHC.Unit.State.html#unitConfigFlagsPlugins"><span class="hs-identifier hs-var">unitConfigFlagsPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>                </span><span class="hs-comment">-- Updating based on wired in packages is mostly</span><span>
</span><span id="line-1646"></span><span>                </span><span class="hs-comment">-- good hygiene, because it won't matter: no wired in</span><span>
</span><span id="line-1647"></span><span>                </span><span class="hs-comment">-- package has a compiler plugin.</span><span>
</span><span id="line-1648"></span><span>                </span><span class="hs-comment">-- TODO: If a wired in package had a compiler plugin,</span><span>
</span><span id="line-1649"></span><span>                </span><span class="hs-comment">-- and you tried to pick different wired in packages</span><span>
</span><span id="line-1650"></span><span>                </span><span class="hs-comment">-- with the plugin flags and the normal flags... what</span><span>
</span><span id="line-1651"></span><span>                </span><span class="hs-comment">-- would happen?  I don't know!  But this doesn't seem</span><span>
</span><span id="line-1652"></span><span>                </span><span class="hs-comment">-- likely to actually happen.</span><span>
</span><span id="line-1653"></span><span>                </span><span class="annot"><span class="annottext">VisibilityMap -&gt; IO VisibilityMap
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; VisibilityMap -&gt; VisibilityMap
</span><a href="GHC.Unit.State.html#updateVisibilityMap"><span class="hs-identifier hs-var">updateVisibilityMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680745"><span class="hs-identifier hs-var">wired_map</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680751"><span class="hs-identifier hs-var">plugin_vis_map2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span>
</span><span id="line-1655"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680752"><span class="annot"><span class="annottext">pkgname_map :: UniqFM PackageName UnitId
</span><a href="#local-6989586621681680752"><span class="hs-identifier hs-var hs-var">pkgname_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PackageName, UnitId)] -&gt; UniqFM PackageName UnitId
forall key elt. Uniquable key =&gt; [(key, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#listToUFM"><span class="hs-identifier hs-var">listToUFM</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; PackageName
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; srcpkgname
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitPackageName/GHC.Unit.Database.html#unitPackageName"><span class="hs-identifier hs-var">unitPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680753"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstanceOf/GHC.Unit.Database.html#unitInstanceOf"><span class="hs-identifier hs-var">unitInstanceOf</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680753"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1656"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680753"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680753"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680744"><span class="hs-identifier hs-var">pkgs2</span></a></span><span>
</span><span id="line-1657"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-1658"></span><span>  </span><span class="hs-comment">-- The explicitUnits accurately reflects the set of units we have turned</span><span>
</span><span id="line-1659"></span><span>  </span><span class="hs-comment">-- on; as such, it also is the only way one can come up with requirements.</span><span>
</span><span id="line-1660"></span><span>  </span><span class="hs-comment">-- The requirement context is directly based off of this: we simply</span><span>
</span><span id="line-1661"></span><span>  </span><span class="hs-comment">-- look for nested unit IDs that are directly fed holes: the requirements</span><span>
</span><span id="line-1662"></span><span>  </span><span class="hs-comment">-- of those units are precisely the ones we need to track</span><span>
</span><span id="line-1663"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680754"><span class="annot"><span class="annottext">explicit_pkgs :: [(GenUnit UnitId, Maybe PackageArg)]
</span><a href="#local-6989586621681680754"><span class="hs-identifier hs-var hs-var">explicit_pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680755"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681680756"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680755"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680755"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680756"><span class="annot"><span class="annottext">UnitVisibility
</span><a href="#local-6989586621681680756"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; [(GenUnit UnitId, UnitVisibility)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680747"><span class="hs-identifier hs-var">vis_map</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1664"></span><span>      </span><span id="local-6989586621681680757"><span class="annot"><span class="annottext">req_ctx :: Map ModuleName [InstantiatedModule]
</span><a href="#local-6989586621681680757"><span class="hs-identifier hs-var hs-var">req_ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set InstantiatedModule -&gt; [InstantiatedModule])
-&gt; Map ModuleName (Set InstantiatedModule)
-&gt; Map ModuleName [InstantiatedModule]
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#map/Data.Map.Internal.html#map"><span class="hs-identifier hs-var">Map.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set InstantiatedModule -&gt; [InstantiatedModule]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1665"></span><span>              </span><span class="annot"><span class="annottext">(Map ModuleName (Set InstantiatedModule)
 -&gt; Map ModuleName [InstantiatedModule])
-&gt; Map ModuleName (Set InstantiatedModule)
-&gt; Map ModuleName [InstantiatedModule]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Set InstantiatedModule
 -&gt; Set InstantiatedModule -&gt; Set InstantiatedModule)
-&gt; [Map ModuleName (Set InstantiatedModule)]
-&gt; Map ModuleName (Set InstantiatedModule)
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
(a -&gt; a -&gt; a) -&gt; f (Map k a) -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#unionsWith/Data.Map.Internal.html#unionsWith"><span class="hs-identifier hs-var">Map.unionsWith</span></a></span><span> </span><span class="annot"><span class="annottext">Set InstantiatedModule
-&gt; Set InstantiatedModule -&gt; Set InstantiatedModule
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#union/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitVisibility -&gt; Map ModuleName (Set InstantiatedModule))
-&gt; [UnitVisibility] -&gt; [Map ModuleName (Set InstantiatedModule)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; Map ModuleName (Set InstantiatedModule)
</span><a href="GHC.Unit.State.html#uv_requirements"><span class="hs-identifier hs-var">uv_requirements</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VisibilityMap -&gt; [UnitVisibility]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680747"><span class="hs-identifier hs-var">vis_map</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1669"></span><span>  </span><span class="hs-comment">-- Here we build up a set of the packages mentioned in -package</span><span>
</span><span id="line-1670"></span><span>  </span><span class="hs-comment">-- flags on the command line; these are called the &quot;preload&quot;</span><span>
</span><span id="line-1671"></span><span>  </span><span class="hs-comment">-- packages.  we link these packages in eagerly.  The preload set</span><span>
</span><span id="line-1672"></span><span>  </span><span class="hs-comment">-- should contain at least rts &amp; base, which is why we pretend that</span><span>
</span><span id="line-1673"></span><span>  </span><span class="hs-comment">-- the command line contains -package rts &amp; -package base.</span><span>
</span><span id="line-1674"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1675"></span><span>  </span><span class="hs-comment">-- NB: preload IS important even for type-checking, because we</span><span>
</span><span id="line-1676"></span><span>  </span><span class="hs-comment">-- need the correct include path to be set.</span><span>
</span><span id="line-1677"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1678"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680758"><span class="annot"><span class="annottext">preload1 :: [GenUnit UnitId]
</span><a href="#local-6989586621681680758"><span class="hs-identifier hs-var hs-var">preload1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; [GenUnit UnitId]
forall k a. Map k a -&gt; [k]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#keys/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitVisibility -&gt; Bool) -&gt; VisibilityMap -&gt; VisibilityMap
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#filter/Data.Map.Internal.html#filter"><span class="hs-identifier hs-var">Map.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe PackageArg -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe PackageArg -&gt; Bool)
-&gt; (UnitVisibility -&gt; Maybe PackageArg) -&gt; UnitVisibility -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitVisibility -&gt; Maybe PackageArg
</span><a href="GHC.Unit.State.html#uv_explicit"><span class="hs-identifier hs-var">uv_explicit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680747"><span class="hs-identifier hs-var">vis_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1679"></span><span>
</span><span id="line-1680"></span><span>      </span><span class="hs-comment">-- add default preload units if they can be found in the db</span><span>
</span><span id="line-1681"></span><span>      </span><span id="local-6989586621681680760"><span class="annot"><span class="annottext">basicLinkedUnits :: [GenUnit UnitId]
</span><a href="#local-6989586621681680760"><span class="hs-identifier hs-var hs-var">basicLinkedUnits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; GenUnit UnitId) -&gt; [UnitId] -&gt; [GenUnit UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(Definite UnitId -&gt; GenUnit UnitId)
-&gt; (UnitId -&gt; Definite UnitId) -&gt; UnitId -&gt; GenUnit UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1682"></span><span>                         </span><span class="annot"><span class="annottext">([UnitId] -&gt; [GenUnit UnitId]) -&gt; [UnitId] -&gt; [GenUnit UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Bool) -&gt; [UnitId] -&gt; [UnitId]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; UnitInfoMap -&gt; Bool) -&gt; UnitInfoMap -&gt; UnitId -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitInfoMap -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#member/Data.Map.Internal.html#member"><span class="hs-identifier hs-var">Map.member</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680746"><span class="hs-identifier hs-var">pkg_db</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1683"></span><span>                         </span><span class="annot"><span class="annottext">([UnitId] -&gt; [UnitId]) -&gt; [UnitId] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#unitConfigAutoLink"><span class="hs-identifier hs-var">unitConfigAutoLink</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-1684"></span><span>      </span><span id="local-6989586621681680761"><span class="annot"><span class="annottext">preload3 :: [GenUnit UnitId]
</span><a href="#local-6989586621681680761"><span class="hs-identifier hs-var hs-var">preload3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId] -&gt; [GenUnit UnitId]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#ordNub"><span class="hs-identifier hs-var">ordNub</span></a></span><span> </span><span class="annot"><span class="annottext">([GenUnit UnitId] -&gt; [GenUnit UnitId])
-&gt; [GenUnit UnitId] -&gt; [GenUnit UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681680760"><span class="hs-identifier hs-var">basicLinkedUnits</span></a></span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId] -&gt; [GenUnit UnitId] -&gt; [GenUnit UnitId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681680758"><span class="hs-identifier hs-var">preload1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1685"></span><span>
</span><span id="line-1686"></span><span>  </span><span class="hs-comment">-- Close the preload packages with their dependencies</span><span>
</span><span id="line-1687"></span><span>  </span><span id="local-6989586621681680763"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680763"><span class="hs-identifier hs-var">dep_preload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeErr UnitErr [UnitId] -&gt; IO [UnitId]
forall a. MaybeErr UnitErr a -&gt; IO a
</span><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-var">mayThrowUnitErr</span></a></span><span>
</span><span id="line-1688"></span><span>                    </span><span class="annot"><span class="annottext">(MaybeErr UnitErr [UnitId] -&gt; IO [UnitId])
-&gt; MaybeErr UnitErr [UnitId] -&gt; IO [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; [(UnitId, Maybe UnitId)] -&gt; MaybeErr UnitErr [UnitId]
</span><a href="GHC.Unit.State.html#closeUnitDeps"><span class="hs-identifier hs-var">closeUnitDeps</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680746"><span class="hs-identifier hs-var">pkg_db</span></a></span><span>
</span><span id="line-1689"></span><span>                    </span><span class="annot"><span class="annottext">([(UnitId, Maybe UnitId)] -&gt; MaybeErr UnitErr [UnitId])
-&gt; [(UnitId, Maybe UnitId)] -&gt; MaybeErr UnitErr [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; [Maybe UnitId] -&gt; [(UnitId, Maybe UnitId)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; UnitId) -&gt; [GenUnit UnitId] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681680761"><span class="hs-identifier hs-var">preload3</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId -&gt; [Maybe UnitId]
forall a. a -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#repeat/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UnitId
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1690"></span><span>
</span><span id="line-1691"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680765"><span class="annot"><span class="annottext">mod_map1 :: ModuleNameProvidersMap
</span><a href="#local-6989586621681680765"><span class="hs-identifier hs-var hs-var">mod_map1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; UnitConfig
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; VisibilityMap
-&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#mkModuleNameProvidersMap"><span class="hs-identifier hs-var">mkModuleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680746"><span class="hs-identifier hs-var">pkg_db</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680747"><span class="hs-identifier hs-var">vis_map</span></a></span><span>
</span><span id="line-1692"></span><span>      </span><span id="local-6989586621681680767"><span class="annot"><span class="annottext">mod_map2 :: ModuleNameProvidersMap
</span><a href="#local-6989586621681680767"><span class="hs-identifier hs-var hs-var">mod_map2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnusableUnits -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#mkUnusableModuleNameProvidersMap"><span class="hs-identifier hs-var">mkUnusableModuleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680721"><span class="hs-identifier hs-var">unusable</span></a></span><span>
</span><span id="line-1693"></span><span>      </span><span id="local-6989586621681680769"><span class="annot"><span class="annottext">mod_map :: ModuleNameProvidersMap
</span><a href="#local-6989586621681680769"><span class="hs-identifier hs-var hs-var">mod_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
-&gt; ModuleNameProvidersMap -&gt; ModuleNameProvidersMap
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">Map.union</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680765"><span class="hs-identifier hs-var">mod_map1</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680767"><span class="hs-identifier hs-var">mod_map2</span></a></span><span>
</span><span id="line-1694"></span><span>
</span><span id="line-1695"></span><span>  </span><span class="hs-comment">-- Force the result to avoid leaking input parameters</span><span>
</span><span id="line-1696"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681680770"><span class="annot"><span class="annottext">state :: UnitState
</span><a href="#local-6989586621681680770"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-1697"></span><span>         </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">preloadUnits :: [UnitId]
</span><a href="GHC.Unit.State.html#preloadUnits"><span class="hs-identifier hs-var">preloadUnits</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680763"><span class="hs-identifier hs-var">dep_preload</span></a></span><span>
</span><span id="line-1698"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">explicitUnits :: [(GenUnit UnitId, Maybe PackageArg)]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var">explicitUnits</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenUnit UnitId, Maybe PackageArg)]
</span><a href="#local-6989586621681680754"><span class="hs-identifier hs-var">explicit_pkgs</span></a></span><span>
</span><span id="line-1699"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">homeUnitDepends :: [UnitId]
</span><a href="GHC.Unit.State.html#homeUnitDepends"><span class="hs-identifier hs-var">homeUnitDepends</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680716"><span class="hs-identifier hs-var">home_unit_deps</span></a></span><span>
</span><span id="line-1700"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitInfoMap :: UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680746"><span class="hs-identifier hs-var">pkg_db</span></a></span><span>
</span><span id="line-1701"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">preloadClosure :: PreloadUnitClosure
</span><a href="GHC.Unit.State.html#preloadClosure"><span class="hs-identifier hs-var">preloadClosure</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span>
</span><span id="line-1702"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">moduleNameProvidersMap :: ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680769"><span class="hs-identifier hs-var">mod_map</span></a></span><span>
</span><span id="line-1703"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pluginModuleNameProvidersMap :: ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#pluginModuleNameProvidersMap"><span class="hs-identifier hs-var">pluginModuleNameProvidersMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; UnitConfig
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; VisibilityMap
-&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#mkModuleNameProvidersMap"><span class="hs-identifier hs-var">mkModuleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680705"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680746"><span class="hs-identifier hs-var">pkg_db</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680749"><span class="hs-identifier hs-var">plugin_vis_map</span></a></span><span>
</span><span id="line-1704"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">packageNameMap :: UniqFM PackageName UnitId
</span><a href="GHC.Unit.State.html#packageNameMap"><span class="hs-identifier hs-var">packageNameMap</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM PackageName UnitId
</span><a href="#local-6989586621681680752"><span class="hs-identifier hs-var">pkgname_map</span></a></span><span>
</span><span id="line-1705"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wireMap :: Map UnitId UnitId
</span><a href="GHC.Unit.State.html#wireMap"><span class="hs-identifier hs-var">wireMap</span></a></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680745"><span class="hs-identifier hs-var">wired_map</span></a></span><span>
</span><span id="line-1706"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unwireMap :: Map UnitId UnitId
</span><a href="GHC.Unit.State.html#unwireMap"><span class="hs-identifier hs-var">unwireMap</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(UnitId, UnitId)] -&gt; Map UnitId UnitId
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680771"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680772"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680772"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680772"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681680771"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680771"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId -&gt; [(UnitId, UnitId)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitId
</span><a href="#local-6989586621681680745"><span class="hs-identifier hs-var">wired_map</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1707"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">requirementContext :: Map ModuleName [InstantiatedModule]
</span><a href="GHC.Unit.State.html#requirementContext"><span class="hs-identifier hs-var">requirementContext</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleName [InstantiatedModule]
</span><a href="#local-6989586621681680757"><span class="hs-identifier hs-var">req_ctx</span></a></span><span>
</span><span id="line-1708"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">allowVirtualUnits :: Bool
</span><a href="GHC.Unit.State.html#allowVirtualUnits"><span class="hs-identifier hs-var">allowVirtualUnits</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigAllowVirtual"><span class="hs-identifier hs-var">unitConfigAllowVirtual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680706"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-1709"></span><span>         </span><span class="hs-special">}</span><span>
</span><span id="line-1710"></span><span>  </span><span class="annot"><span class="annottext">(UnitState, [UnitDatabase UnitId])
-&gt; IO (UnitState, [UnitDatabase UnitId])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680770"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnitDatabase UnitId]
</span><a href="#local-6989586621681680707"><span class="hs-identifier hs-var">raw_dbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1711"></span><span>
</span><span id="line-1712"></span><span class="annot"><a href="GHC.Unit.State.html#selectHptFlag"><span class="hs-identifier hs-type">selectHptFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1713"></span><span id="selectHptFlag"><span class="annot"><span class="annottext">selectHptFlag :: Set UnitId -&gt; PackageFlag -&gt; Bool
</span><a href="GHC.Unit.State.html#selectHptFlag"><span class="hs-identifier hs-var hs-var">selectHptFlag</span></a></span></span><span> </span><span id="local-6989586621681680773"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680773"><span class="hs-identifier hs-var">home_units</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#ExposePackage"><span class="hs-identifier hs-type">ExposePackage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span id="local-6989586621681680774"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680774"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModRenaming
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680774"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#member/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680773"><span class="hs-identifier hs-var">home_units</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1714"></span><span class="annot"><a href="GHC.Unit.State.html#selectHptFlag"><span class="hs-identifier hs-var">selectHptFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1715"></span><span>
</span><span id="line-1716"></span><span class="annot"><a href="GHC.Unit.State.html#selectHomeUnits"><span class="hs-identifier hs-type">selectHomeUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1717"></span><span id="selectHomeUnits"><span class="annot"><span class="annottext">selectHomeUnits :: Set UnitId -&gt; [PackageFlag] -&gt; Set UnitId
</span><a href="GHC.Unit.State.html#selectHomeUnits"><span class="hs-identifier hs-var hs-var">selectHomeUnits</span></a></span></span><span> </span><span id="local-6989586621681680776"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680776"><span class="hs-identifier hs-var">home_units</span></a></span></span><span> </span><span id="local-6989586621681680777"><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680777"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set UnitId -&gt; PackageFlag -&gt; Set UnitId)
-&gt; Set UnitId -&gt; [PackageFlag] -&gt; Set UnitId
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; PackageFlag -&gt; Set UnitId
</span><a href="#local-6989586621681680778"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
forall a. Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#empty/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">[PackageFlag]
</span><a href="#local-6989586621681680777"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-1718"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1719"></span><span>    </span><span class="annot"><a href="#local-6989586621681680778"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1720"></span><span>    </span><span id="local-6989586621681680778"><span class="annot"><span class="annottext">go :: Set UnitId -&gt; PackageFlag -&gt; Set UnitId
</span><a href="#local-6989586621681680778"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681680780"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680780"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#ExposePackage"><span class="hs-identifier hs-type">ExposePackage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span id="local-6989586621681680781"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680781"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModRenaming
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680781"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#member/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680776"><span class="hs-identifier hs-var">home_units</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#insert/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680781"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680780"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-1721"></span><span>    </span><span class="hs-comment">-- MP: This does not yet support thinning/renaming</span><span>
</span><span id="line-1722"></span><span>    </span><span class="annot"><a href="#local-6989586621681680778"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681680783"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680783"><span class="hs-identifier hs-var">cur</span></a></span></span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681680783"><span class="hs-identifier hs-var">cur</span></a></span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span>
</span><span id="line-1725"></span><span class="hs-comment">-- | Given a wired-in 'Unit', &quot;unwire&quot; it into the 'Unit'</span><span>
</span><span id="line-1726"></span><span class="hs-comment">-- that it was recorded as in the package database.</span><span>
</span><span id="line-1727"></span><span class="annot"><a href="GHC.Unit.State.html#unwireUnit"><span class="hs-identifier hs-type">unwireUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-1728"></span><span id="unwireUnit"><span class="annot"><span class="annottext">unwireUnit :: UnitState -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#unwireUnit"><span class="hs-identifier hs-var hs-var">unwireUnit</span></a></span></span><span> </span><span id="local-6989586621681680784"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680784"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681680785"><span class="annot"><span class="annottext">uid :: GenUnit UnitId
</span><a href="#local-6989586621681680785"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-type">Definite</span></a></span><span> </span><span id="local-6989586621681680786"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680786"><span class="hs-identifier hs-var">def_uid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1729"></span><span>    </span><span class="annot"><span class="annottext">GenUnit UnitId
-&gt; (UnitId -&gt; GenUnit UnitId) -&gt; Maybe UnitId -&gt; GenUnit UnitId
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680785"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(Definite UnitId -&gt; GenUnit UnitId)
-&gt; (UnitId -&gt; Definite UnitId) -&gt; UnitId -&gt; GenUnit UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Map UnitId UnitId -&gt; Maybe UnitId
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680786"><span class="hs-identifier hs-var">def_uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; Map UnitId UnitId
</span><a href="GHC.Unit.State.html#unwireMap"><span class="hs-identifier hs-var">unwireMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680784"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1730"></span><span class="annot"><a href="GHC.Unit.State.html#unwireUnit"><span class="hs-identifier hs-var">unwireUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681680788"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680788"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680788"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-1731"></span><span>
</span><span id="line-1732"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1733"></span><span class="annot"><span class="hs-comment">-- | Makes the mapping from ModuleName to package info</span></span><span>
</span><span id="line-1734"></span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- Slight irritation: we proceed by leafing through everything</span><span>
</span><span id="line-1736"></span><span class="hs-comment">-- in the installed package database, which makes handling indefinite</span><span>
</span><span id="line-1737"></span><span class="hs-comment">-- packages a bit bothersome.</span><span>
</span><span id="line-1738"></span><span>
</span><span id="line-1739"></span><span class="annot"><a href="GHC.Unit.State.html#mkModuleNameProvidersMap"><span class="hs-identifier hs-type">mkModuleNameProvidersMap</span></a></span><span>
</span><span id="line-1740"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-1741"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitConfig"><span class="hs-identifier hs-type">UnitConfig</span></a></span><span>
</span><span id="line-1742"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-1743"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span>
</span><span id="line-1744"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#VisibilityMap"><span class="hs-identifier hs-type">VisibilityMap</span></a></span><span>
</span><span id="line-1745"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleNameProvidersMap"><span class="hs-identifier hs-type">ModuleNameProvidersMap</span></a></span><span>
</span><span id="line-1746"></span><span id="mkModuleNameProvidersMap"><span class="annot"><span class="annottext">mkModuleNameProvidersMap :: Logger
-&gt; UnitConfig
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; VisibilityMap
-&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#mkModuleNameProvidersMap"><span class="hs-identifier hs-var hs-var">mkModuleNameProvidersMap</span></a></span></span><span> </span><span id="local-6989586621681680789"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680789"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681680790"><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680790"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621681680791"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680791"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680792"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680792"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681680793"><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680793"><span class="hs-identifier hs-var">vis_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1747"></span><span>    </span><span class="hs-comment">-- What should we fold on?  Both situations are awkward:</span><span>
</span><span id="line-1748"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1749"></span><span>    </span><span class="hs-comment">--    * Folding on the visibility map means that we won't create</span><span>
</span><span id="line-1750"></span><span>    </span><span class="hs-comment">--      entries for packages that aren't mentioned in vis_map</span><span>
</span><span id="line-1751"></span><span>    </span><span class="hs-comment">--      (e.g., hidden packages, causing #14717)</span><span>
</span><span id="line-1752"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1753"></span><span>    </span><span class="hs-comment">--    * Folding on pkg_map is awkward because if we have an</span><span>
</span><span id="line-1754"></span><span>    </span><span class="hs-comment">--      Backpack instantiation, we need to possibly add a</span><span>
</span><span id="line-1755"></span><span>    </span><span class="hs-comment">--      package from pkg_map multiple times to the actual</span><span>
</span><span id="line-1756"></span><span>    </span><span class="hs-comment">--      ModuleNameProvidersMap.  Also, we don't really want</span><span>
</span><span id="line-1757"></span><span>    </span><span class="hs-comment">--      definite package instantiations to show up in the</span><span>
</span><span id="line-1758"></span><span>    </span><span class="hs-comment">--      list of possibilities.</span><span>
</span><span id="line-1759"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1760"></span><span>    </span><span class="hs-comment">-- So what will we do instead?  We'll extend vis_map with</span><span>
</span><span id="line-1761"></span><span>    </span><span class="hs-comment">-- entries for every definite (for non-Backpack) and</span><span>
</span><span id="line-1762"></span><span>    </span><span class="hs-comment">-- indefinite (for Backpack) package, so that we get the</span><span>
</span><span id="line-1763"></span><span>    </span><span class="hs-comment">-- hidden entries we need.</span><span>
</span><span id="line-1764"></span><span>    </span><span class="annot"><span class="annottext">(ModuleNameProvidersMap
 -&gt; GenUnit UnitId -&gt; UnitVisibility -&gt; ModuleNameProvidersMap)
-&gt; ModuleNameProvidersMap
-&gt; VisibilityMap
-&gt; ModuleNameProvidersMap
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#foldlWithKey/Data.Map.Internal.html#foldlWithKey"><span class="hs-identifier hs-var">Map.foldlWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
-&gt; GenUnit UnitId -&gt; UnitVisibility -&gt; ModuleNameProvidersMap
</span><a href="#local-6989586621681680795"><span class="hs-identifier hs-var">extend_modmap</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
forall k a. Map k a
</span><a href="#local-6989586621681680796"><span class="hs-identifier hs-var">emptyMap</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680797"><span class="hs-identifier hs-var">vis_map_extended</span></a></span><span>
</span><span id="line-1765"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1766"></span><span>  </span><span id="local-6989586621681680797"><span class="annot"><span class="annottext">vis_map_extended :: VisibilityMap
</span><a href="#local-6989586621681680797"><span class="hs-identifier hs-var hs-var">vis_map_extended</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VisibilityMap -&gt; VisibilityMap -&gt; VisibilityMap
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#union/Data.Map.Internal.html#union"><span class="hs-identifier hs-var">Map.union</span></a></span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680793"><span class="hs-identifier hs-var">vis_map</span></a></span><span> </span><span class="hs-comment">{- preferred -}</span><span> </span><span class="annot"><span class="annottext">VisibilityMap
</span><a href="#local-6989586621681680798"><span class="hs-identifier hs-var">default_vis</span></a></span><span>
</span><span id="line-1767"></span><span>
</span><span id="line-1768"></span><span>  </span><span id="local-6989586621681680798"><span class="annot"><span class="annottext">default_vis :: VisibilityMap
</span><a href="#local-6989586621681680798"><span class="hs-identifier hs-var hs-var">default_vis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(GenUnit UnitId, UnitVisibility)] -&gt; VisibilityMap
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span>
</span><span id="line-1769"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680799"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitVisibility
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1770"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680799"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680799"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; [UnitInfo]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680791"><span class="hs-identifier hs-var">pkg_map</span></a></span><span>
</span><span id="line-1771"></span><span>                  </span><span class="hs-comment">-- Exclude specific instantiations of an indefinite</span><span>
</span><span id="line-1772"></span><span>                  </span><span class="hs-comment">-- package</span><span>
</span><span id="line-1773"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Bool
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIsIndefinite/GHC.Unit.Database.html#unitIsIndefinite"><span class="hs-identifier hs-var">unitIsIndefinite</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680799"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; [(ModuleName, Module)]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [(modulename, mod)]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitInstantiations/GHC.Unit.Database.html#unitInstantiations"><span class="hs-identifier hs-var">unitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680799"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1774"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-1775"></span><span>
</span><span id="line-1776"></span><span>  </span><span id="local-6989586621681680796"><span class="annot"><span class="annottext">emptyMap :: Map k a
</span><a href="#local-6989586621681680796"><span class="hs-identifier hs-var hs-var">emptyMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map k a
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-1777"></span><span>  </span><span id="local-6989586621681680802"><span class="annot"><span class="annottext">setOrigins :: f a -&gt; b -&gt; f b
</span><a href="#local-6989586621681680802"><span class="hs-identifier hs-var hs-var">setOrigins</span></a></span></span><span> </span><span id="local-6989586621681680803"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621681680803"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681680804"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681680804"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; f a -&gt; f b
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; a -&gt; b
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681680804"><span class="hs-identifier hs-var">os</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621681680803"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1778"></span><span>  </span><span id="local-6989586621681680795"><span class="annot"><span class="annottext">extend_modmap :: ModuleNameProvidersMap
-&gt; GenUnit UnitId -&gt; UnitVisibility -&gt; ModuleNameProvidersMap
</span><a href="#local-6989586621681680795"><span class="hs-identifier hs-var hs-var">extend_modmap</span></a></span></span><span> </span><span id="local-6989586621681680805"><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680805"><span class="hs-identifier hs-var">modmap</span></a></span></span><span> </span><span id="local-6989586621681680806"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680806"><span class="hs-identifier hs-var">uid</span></a></span></span><span>
</span><span id="line-1779"></span><span>    </span><span class="annot"><a href="GHC.Unit.State.html#UnitVisibility"><span class="hs-identifier hs-type">UnitVisibility</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">uv_expose_all :: UnitVisibility -&gt; Bool
</span><a href="GHC.Unit.State.html#uv_expose_all"><span class="hs-identifier hs-var">uv_expose_all</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681680807"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680807"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uv_renamings :: UnitVisibility -&gt; [(ModuleName, ModuleName)]
</span><a href="GHC.Unit.State.html#uv_renamings"><span class="hs-identifier hs-var">uv_renamings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681680808"><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681680808"><span class="hs-identifier hs-var">rns</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1780"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
-&gt; [(ModuleName, Map Module ModuleOrigin)]
-&gt; ModuleNameProvidersMap
forall a k1 k2.
(Monoid a, Ord k1, Ord k2) =&gt;
Map k1 (Map k2 a) -&gt; [(k1, Map k2 a)] -&gt; Map k1 (Map k2 a)
</span><a href="GHC.Unit.State.html#addListTo"><span class="hs-identifier hs-var">addListTo</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680805"><span class="hs-identifier hs-var">modmap</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680810"><span class="hs-identifier hs-var">theBindings</span></a></span><span>
</span><span id="line-1781"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1782"></span><span>    </span><span id="local-6989586621681680811"><span class="annot"><span class="annottext">pkg :: UnitInfo
</span><a href="#local-6989586621681680811"><span class="hs-identifier hs-var hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitInfo
</span><a href="#local-6989586621681680812"><span class="hs-identifier hs-var">unit_lookup</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680806"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-1783"></span><span>
</span><span id="line-1784"></span><span>    </span><span class="annot"><a href="#local-6989586621681680810"><span class="hs-identifier hs-type">theBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1785"></span><span>    </span><span id="local-6989586621681680810"><span class="annot"><span class="annottext">theBindings :: [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680810"><span class="hs-identifier hs-var hs-var">theBindings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; [(ModuleName, ModuleName)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680813"><span class="hs-identifier hs-var">newBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680807"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681680808"><span class="hs-identifier hs-var">rns</span></a></span><span>
</span><span id="line-1786"></span><span>
</span><span id="line-1787"></span><span>    </span><span class="annot"><a href="#local-6989586621681680813"><span class="hs-identifier hs-type">newBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1788"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1789"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1790"></span><span>    </span><span id="local-6989586621681680813"><span class="annot"><span class="annottext">newBindings :: Bool
-&gt; [(ModuleName, ModuleName)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680813"><span class="hs-identifier hs-var hs-var">newBindings</span></a></span></span><span> </span><span id="local-6989586621681680814"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680814"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681680815"><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681680815"><span class="hs-identifier hs-var">rns</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680816"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680814"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680817"><span class="hs-identifier hs-var">hiddens</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">((ModuleName, ModuleName) -&gt; (ModuleName, Map Module ModuleOrigin))
-&gt; [(ModuleName, ModuleName)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, ModuleName) -&gt; (ModuleName, Map Module ModuleOrigin)
</span><a href="#local-6989586621681680818"><span class="hs-identifier hs-var">rnBinding</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, ModuleName)]
</span><a href="#local-6989586621681680815"><span class="hs-identifier hs-var">rns</span></a></span><span>
</span><span id="line-1791"></span><span>
</span><span id="line-1792"></span><span>    </span><span class="annot"><a href="#local-6989586621681680818"><span class="hs-identifier hs-type">rnBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1793"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1794"></span><span>    </span><span id="local-6989586621681680818"><span class="annot"><span class="annottext">rnBinding :: (ModuleName, ModuleName) -&gt; (ModuleName, Map Module ModuleOrigin)
</span><a href="#local-6989586621681680818"><span class="hs-identifier hs-var hs-var">rnBinding</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680819"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680819"><span class="hs-identifier hs-var">orig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680820"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680820"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680820"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Module ModuleOrigin -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
forall {f :: * -&gt; *} {a} {b}. Functor f =&gt; f a -&gt; b -&gt; f b
</span><a href="#local-6989586621681680802"><span class="hs-identifier hs-var">setOrigins</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680821"><span class="hs-identifier hs-var">origEntry</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="GHC.Unit.State.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1795"></span><span>     </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681680821"><span class="annot"><span class="annottext">origEntry :: Map Module ModuleOrigin
</span><a href="#local-6989586621681680821"><span class="hs-identifier hs-var hs-var">origEntry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName (Map Module ModuleOrigin)
-&gt; ModuleName -&gt; Maybe (Map Module ModuleOrigin)
forall key elt. Uniquable key =&gt; UniqFM key elt -&gt; key -&gt; Maybe elt
</span><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName (Map Module ModuleOrigin)
</span><a href="#local-6989586621681680822"><span class="hs-identifier hs-var">esmap</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680819"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1796"></span><span>            </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680823"><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680823"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680823"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1797"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Map Module ModuleOrigin)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; Map Module ModuleOrigin
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span>
</span><span id="line-1798"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogFlags -&gt; SDocContext
</span><a href="GHC.Utils.Logger.html#log_default_user_context"><span class="hs-identifier hs-var">log_default_user_context</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Logger -&gt; LogFlags
</span><a href="GHC.Utils.Logger.html#logFlags"><span class="hs-identifier hs-var">logFlags</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681680789"><span class="hs-identifier hs-var">logger</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1799"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;package flag: could not find module name&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1800"></span><span>                            </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680819"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in package&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680827"><span class="hs-identifier hs-var">pk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1801"></span><span>
</span><span id="line-1802"></span><span>    </span><span class="annot"><a href="#local-6989586621681680816"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1803"></span><span>    </span><span id="local-6989586621681680816"><span class="annot"><span class="annottext">es :: Bool -&gt; [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680816"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span> </span><span id="local-6989586621681680828"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680828"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1804"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621681680829"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680829"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680830"><span class="annot"><span class="annottext">Maybe Module
</span><a href="#local-6989586621681680830"><span class="hs-identifier hs-var">exposedReexport</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Maybe Module)]
</span><a href="#local-6989586621681680831"><span class="hs-identifier hs-var">exposed_mods</span></a></span><span>
</span><span id="line-1805"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680832"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680832"><span class="hs-identifier hs-var">pk'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680833"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680833"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680834"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680834"><span class="hs-identifier hs-var">origin'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1806"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Module
</span><a href="#local-6989586621681680830"><span class="hs-identifier hs-var">exposedReexport</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1807"></span><span>           </span><span class="annot"><span class="annottext">Maybe Module
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680827"><span class="hs-identifier hs-var">pk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680829"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#fromExposedModules"><span class="hs-identifier hs-var">fromExposedModules</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680828"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1808"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span id="local-6989586621681680835"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680835"><span class="hs-identifier hs-var">pk'</span></a></span></span><span> </span><span id="local-6989586621681680836"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680836"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1809"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680835"><span class="hs-identifier hs-var">pk'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680836"><span class="hs-identifier hs-var">m'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; UnitInfo -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#fromReexportedModules"><span class="hs-identifier hs-var">fromReexportedModules</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681680828"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680811"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1810"></span><span>     </span><span class="annot"><span class="annottext">(ModuleName, Map Module ModuleOrigin)
-&gt; [(ModuleName, Map Module ModuleOrigin)]
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680829"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
-&gt; ModuleName -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
</span><a href="GHC.Unit.State.html#mkModMap"><span class="hs-identifier hs-var">mkModMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680832"><span class="hs-identifier hs-var">pk'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680833"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680834"><span class="hs-identifier hs-var">origin'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1811"></span><span>
</span><span id="line-1812"></span><span>    </span><span class="annot"><a href="#local-6989586621681680822"><span class="hs-identifier hs-type">esmap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1813"></span><span>    </span><span id="local-6989586621681680822"><span class="annot"><span class="annottext">esmap :: UniqFM ModuleName (Map Module ModuleOrigin)
</span><a href="#local-6989586621681680822"><span class="hs-identifier hs-var hs-var">esmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
-&gt; UniqFM ModuleName (Map Module ModuleOrigin)
forall key elt. Uniquable key =&gt; [(key, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#listToUFM"><span class="hs-identifier hs-var">listToUFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680816"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- parameter here doesn't matter, orig will</span><span>
</span><span id="line-1814"></span><span>                                 </span><span class="hs-comment">-- be overwritten</span><span>
</span><span id="line-1815"></span><span>
</span><span id="line-1816"></span><span>    </span><span id="local-6989586621681680817"><span class="annot"><span class="annottext">hiddens :: [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680817"><span class="hs-identifier hs-var hs-var">hiddens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680838"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
-&gt; ModuleName -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
</span><a href="GHC.Unit.State.html#mkModMap"><span class="hs-identifier hs-var">mkModMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680827"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680838"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="GHC.Unit.State.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680838"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680838"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681680839"><span class="hs-identifier hs-var">hidden_mods</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1817"></span><span>
</span><span id="line-1818"></span><span>    </span><span id="local-6989586621681680827"><span class="annot"><span class="annottext">pk :: GenUnit UnitId
</span><a href="#local-6989586621681680827"><span class="hs-identifier hs-var hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680811"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1819"></span><span>    </span><span id="local-6989586621681680812"><span class="annot"><span class="annottext">unit_lookup :: GenUnit UnitId -&gt; UnitInfo
</span><a href="#local-6989586621681680812"><span class="hs-identifier hs-var hs-var">unit_lookup</span></a></span></span><span> </span><span id="local-6989586621681680840"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680840"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; GenUnit UnitId
-&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit%27"><span class="hs-identifier hs-var">lookupUnit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitConfig -&gt; Bool
</span><a href="GHC.Unit.State.html#unitConfigAllowVirtual"><span class="hs-identifier hs-var">unitConfigAllowVirtual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitConfig
</span><a href="#local-6989586621681680790"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680791"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681680792"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680840"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-1820"></span><span>                        </span><span class="annot"><span class="annottext">Maybe UnitInfo -&gt; UnitInfo -&gt; UnitInfo
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; UnitInfo
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unit_lookup&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680840"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1821"></span><span>
</span><span id="line-1822"></span><span>    </span><span id="local-6989586621681680831"><span class="annot"><span class="annottext">exposed_mods :: [(ModuleName, Maybe Module)]
</span><a href="#local-6989586621681680831"><span class="hs-identifier hs-var hs-var">exposed_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [(ModuleName, Maybe Module)]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [(modulename, Maybe mod)]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitExposedModules/GHC.Unit.Database.html#unitExposedModules"><span class="hs-identifier hs-var">unitExposedModules</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680811"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1823"></span><span>    </span><span id="local-6989586621681680839"><span class="annot"><span class="annottext">hidden_mods :: [ModuleName]
</span><a href="#local-6989586621681680839"><span class="hs-identifier hs-var hs-var">hidden_mods</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [ModuleName]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [modulename]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitHiddenModules/GHC.Unit.Database.html#unitHiddenModules"><span class="hs-identifier hs-var">unitHiddenModules</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680811"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1824"></span><span>
</span><span id="line-1825"></span><span class="annot"><span class="hs-comment">-- | Make a 'ModuleNameProvidersMap' covering a set of unusable packages.</span></span><span>
</span><span id="line-1826"></span><span class="annot"><a href="GHC.Unit.State.html#mkUnusableModuleNameProvidersMap"><span class="hs-identifier hs-type">mkUnusableModuleNameProvidersMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnits"><span class="hs-identifier hs-type">UnusableUnits</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleNameProvidersMap"><span class="hs-identifier hs-type">ModuleNameProvidersMap</span></a></span><span>
</span><span id="line-1827"></span><span id="mkUnusableModuleNameProvidersMap"><span class="annot"><span class="annottext">mkUnusableModuleNameProvidersMap :: UnusableUnits -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#mkUnusableModuleNameProvidersMap"><span class="hs-identifier hs-var hs-var">mkUnusableModuleNameProvidersMap</span></a></span></span><span> </span><span id="local-6989586621681680843"><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680843"><span class="hs-identifier hs-var">unusables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1828"></span><span>    </span><span class="annot"><span class="annottext">(ModuleNameProvidersMap
 -&gt; (UnitInfo, UnusableUnitReason) -&gt; ModuleNameProvidersMap)
-&gt; ModuleNameProvidersMap
-&gt; UnusableUnits
-&gt; ModuleNameProvidersMap
forall a b k. (a -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#foldl%27/Data.Map.Internal.html#foldl%27"><span class="hs-identifier hs-var">Map.foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
-&gt; (UnitInfo, UnusableUnitReason) -&gt; ModuleNameProvidersMap
</span><a href="#local-6989586621681680844"><span class="hs-identifier hs-var">extend_modmap</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnits
</span><a href="#local-6989586621681680843"><span class="hs-identifier hs-var">unusables</span></a></span><span>
</span><span id="line-1829"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1830"></span><span>    </span><span id="local-6989586621681680844"><span class="annot"><span class="annottext">extend_modmap :: ModuleNameProvidersMap
-&gt; (UnitInfo, UnusableUnitReason) -&gt; ModuleNameProvidersMap
</span><a href="#local-6989586621681680844"><span class="hs-identifier hs-var hs-var">extend_modmap</span></a></span></span><span> </span><span id="local-6989586621681680849"><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680849"><span class="hs-identifier hs-var">modmap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680850"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680850"><span class="hs-identifier hs-var">unit_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680851"><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680851"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
-&gt; [(ModuleName, Map Module ModuleOrigin)]
-&gt; ModuleNameProvidersMap
forall a k1 k2.
(Monoid a, Ord k1, Ord k2) =&gt;
Map k1 (Map k2 a) -&gt; [(k1, Map k2 a)] -&gt; Map k1 (Map k2 a)
</span><a href="GHC.Unit.State.html#addListTo"><span class="hs-identifier hs-var">addListTo</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680849"><span class="hs-identifier hs-var">modmap</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680852"><span class="hs-identifier hs-var">bindings</span></a></span><span>
</span><span id="line-1831"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621681680852"><span class="hs-identifier hs-type">bindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1832"></span><span>            </span><span id="local-6989586621681680852"><span class="annot"><span class="annottext">bindings :: [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680852"><span class="hs-identifier hs-var hs-var">bindings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680853"><span class="hs-identifier hs-var">exposed</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680854"><span class="hs-identifier hs-var">hidden</span></a></span><span>
</span><span id="line-1833"></span><span>
</span><span id="line-1834"></span><span>            </span><span id="local-6989586621681680855"><span class="annot"><span class="annottext">origin_reexport :: ModuleOrigin
</span><a href="#local-6989586621681680855"><span class="hs-identifier hs-var hs-var">origin_reexport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">UnusableUnit -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModUnusable"><span class="hs-identifier hs-var">ModUnusable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnusableUnitReason -&gt; Bool -&gt; UnusableUnit
</span><a href="GHC.Unit.State.html#UnusableUnit"><span class="hs-identifier hs-var">UnusableUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680856"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680851"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-1835"></span><span>            </span><span id="local-6989586621681680857"><span class="annot"><span class="annottext">origin_normal :: ModuleOrigin
</span><a href="#local-6989586621681680857"><span class="hs-identifier hs-var hs-var">origin_normal</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">UnusableUnit -&gt; ModuleOrigin
</span><a href="GHC.Unit.State.html#ModUnusable"><span class="hs-identifier hs-var">ModUnusable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnusableUnitReason -&gt; Bool -&gt; UnusableUnit
</span><a href="GHC.Unit.State.html#UnusableUnit"><span class="hs-identifier hs-var">UnusableUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680856"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681680851"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1836"></span><span>            </span><span id="local-6989586621681680856"><span class="annot"><span class="annottext">unit :: GenUnit UnitId
</span><a href="#local-6989586621681680856"><span class="hs-keyword hs-var hs-var">unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680850"><span class="hs-identifier hs-var">unit_info</span></a></span><span>
</span><span id="line-1837"></span><span>
</span><span id="line-1838"></span><span>            </span><span id="local-6989586621681680853"><span class="annot"><span class="annottext">exposed :: [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680853"><span class="hs-identifier hs-var hs-var">exposed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ModuleName, Maybe Module)
 -&gt; (ModuleName, Map Module ModuleOrigin))
-&gt; [(ModuleName, Maybe Module)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, Maybe Module) -&gt; (ModuleName, Map Module ModuleOrigin)
</span><a href="#local-6989586621681680858"><span class="hs-identifier hs-var">get_exposed</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Maybe Module)]
</span><a href="#local-6989586621681680859"><span class="hs-identifier hs-var">exposed_mods</span></a></span><span>
</span><span id="line-1839"></span><span>            </span><span id="local-6989586621681680854"><span class="annot"><span class="annottext">hidden :: [(ModuleName, Map Module ModuleOrigin)]
</span><a href="#local-6989586621681680854"><span class="hs-identifier hs-var hs-var">hidden</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680860"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
-&gt; ModuleName -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
</span><a href="GHC.Unit.State.html#mkModMap"><span class="hs-identifier hs-var">mkModMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680856"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680860"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680857"><span class="hs-identifier hs-var">origin_normal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681680860"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680860"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681680861"><span class="hs-identifier hs-var">hidden_mods</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1840"></span><span>
</span><span id="line-1841"></span><span>            </span><span class="hs-comment">-- with re-exports, c:Foo can be reexported from two (or more)</span><span>
</span><span id="line-1842"></span><span>            </span><span class="hs-comment">-- unusable packages:</span><span>
</span><span id="line-1843"></span><span>            </span><span class="hs-comment">--  Foo -&gt; a:Foo (unusable reason A) -&gt; c:Foo</span><span>
</span><span id="line-1844"></span><span>            </span><span class="hs-comment">--      -&gt; b:Foo (unusable reason B) -&gt; c:Foo</span><span>
</span><span id="line-1845"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-1846"></span><span>            </span><span class="hs-comment">-- We must be careful to not record the following (#21097):</span><span>
</span><span id="line-1847"></span><span>            </span><span class="hs-comment">--  Foo -&gt; c:Foo (unusable reason A)</span><span>
</span><span id="line-1848"></span><span>            </span><span class="hs-comment">--      -&gt; c:Foo (unusable reason B)</span><span>
</span><span id="line-1849"></span><span>            </span><span class="hs-comment">-- But:</span><span>
</span><span id="line-1850"></span><span>            </span><span class="hs-comment">--  Foo -&gt; a:Foo (unusable reason A)</span><span>
</span><span id="line-1851"></span><span>            </span><span class="hs-comment">--      -&gt; b:Foo (unusable reason B)</span><span>
</span><span id="line-1852"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-1853"></span><span>            </span><span id="local-6989586621681680858"><span class="annot"><span class="annottext">get_exposed :: (ModuleName, Maybe Module) -&gt; (ModuleName, Map Module ModuleOrigin)
</span><a href="#local-6989586621681680858"><span class="hs-identifier hs-var hs-var">get_exposed</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680862"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680862"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680862"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
-&gt; ModuleName -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
</span><a href="GHC.Unit.State.html#mkModMap"><span class="hs-identifier hs-var">mkModMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680856"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680862"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680855"><span class="hs-identifier hs-var">origin_reexport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1854"></span><span>            </span><span class="annot"><a href="#local-6989586621681680858"><span class="hs-identifier hs-var">get_exposed</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680863"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680863"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680863"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
-&gt; ModuleName -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
</span><a href="GHC.Unit.State.html#mkModMap"><span class="hs-identifier hs-var">mkModMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680856"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680863"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680857"><span class="hs-identifier hs-var">origin_normal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1855"></span><span>              </span><span class="hs-comment">-- in the reexport case, we create a virtual module that doesn't</span><span>
</span><span id="line-1856"></span><span>              </span><span class="hs-comment">-- exist but we don't care as it's only used as a key in the map.</span><span>
</span><span id="line-1857"></span><span>
</span><span id="line-1858"></span><span>            </span><span id="local-6989586621681680859"><span class="annot"><span class="annottext">exposed_mods :: [(ModuleName, Maybe Module)]
</span><a href="#local-6989586621681680859"><span class="hs-identifier hs-var hs-var">exposed_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [(ModuleName, Maybe Module)]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [(modulename, Maybe mod)]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitExposedModules/GHC.Unit.Database.html#unitExposedModules"><span class="hs-identifier hs-var">unitExposedModules</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680850"><span class="hs-identifier hs-var">unit_info</span></a></span><span>
</span><span id="line-1859"></span><span>            </span><span id="local-6989586621681680861"><span class="annot"><span class="annottext">hidden_mods :: [ModuleName]
</span><a href="#local-6989586621681680861"><span class="hs-identifier hs-var hs-var">hidden_mods</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [ModuleName]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; [modulename]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitHiddenModules/GHC.Unit.Database.html#unitHiddenModules"><span class="hs-identifier hs-var">unitHiddenModules</span></a></span><span>  </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680850"><span class="hs-identifier hs-var">unit_info</span></a></span><span>
</span><span id="line-1860"></span><span>
</span><span id="line-1861"></span><span class="hs-comment">-- | Add a list of key/value pairs to a nested map.</span><span>
</span><span id="line-1862"></span><span class="hs-comment">--</span><span>
</span><span id="line-1863"></span><span class="hs-comment">-- The outer map is processed with 'Data.Map.Strict' to prevent memory leaks</span><span>
</span><span id="line-1864"></span><span class="hs-comment">-- when reloading modules in GHCi (see #4029). This ensures that each</span><span>
</span><span id="line-1865"></span><span class="hs-comment">-- value is forced before installing into the map.</span><span>
</span><span id="line-1866"></span><span id="local-6989586621681679307"><span id="local-6989586621681679308"><span id="local-6989586621681679309"><span class="annot"><a href="GHC.Unit.State.html#addListTo"><span class="hs-identifier hs-type">addListTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Monoid/GHC.Base.html#Monoid"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679307"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621681679308"><span class="hs-identifier hs-type">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621681679309"><span class="hs-identifier hs-type">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1867"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679308"><span class="hs-identifier hs-type">k1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679309"><span class="hs-identifier hs-type">k2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679307"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1868"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681679308"><span class="hs-identifier hs-type">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679309"><span class="hs-identifier hs-type">k2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679307"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1869"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679308"><span class="hs-identifier hs-type">k1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679309"><span class="hs-identifier hs-type">k2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679307"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1870"></span><span id="addListTo"><span class="annot"><span class="annottext">addListTo :: forall a k1 k2.
(Monoid a, Ord k1, Ord k2) =&gt;
Map k1 (Map k2 a) -&gt; [(k1, Map k2 a)] -&gt; Map k1 (Map k2 a)
</span><a href="GHC.Unit.State.html#addListTo"><span class="hs-identifier hs-var hs-var">addListTo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map k1 (Map k2 a) -&gt; (k1, Map k2 a) -&gt; Map k1 (Map k2 a))
-&gt; Map k1 (Map k2 a) -&gt; [(k1, Map k2 a)] -&gt; Map k1 (Map k2 a)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Map k1 (Map k2 a) -&gt; (k1, Map k2 a) -&gt; Map k1 (Map k2 a)
forall {k} {k} {a}.
(Ord k, Ord k, Monoid a) =&gt;
Map k (Map k a) -&gt; (k, Map k a) -&gt; Map k (Map k a)
</span><a href="#local-6989586621681680871"><span class="hs-identifier hs-var">merge</span></a></span><span>
</span><span id="line-1871"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681680871"><span class="annot"><span class="annottext">merge :: Map k (Map k a) -&gt; (k, Map k a) -&gt; Map k (Map k a)
</span><a href="#local-6989586621681680871"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621681680885"><span class="annot"><span class="annottext">Map k (Map k a)
</span><a href="#local-6989586621681680885"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680886"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681680886"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680887"><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621681680887"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map k a -&gt; Map k a -&gt; Map k a)
-&gt; k -&gt; Map k a -&gt; Map k (Map k a) -&gt; Map k (Map k a)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insertWith/Data.Map.Strict.Internal.html#insertWith"><span class="hs-identifier hs-var">MapStrict.insertWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#unionWith/Data.Map.Internal.html#unionWith"><span class="hs-identifier hs-var">Map.unionWith</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mappend/GHC.Base.html#mappend"><span class="hs-identifier hs-var">mappend</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621681680886"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621681680887"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (Map k a)
</span><a href="#local-6989586621681680885"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1872"></span><span>
</span><span id="line-1873"></span><span class="annot"><span class="hs-comment">-- | Create a singleton module mapping</span></span><span>
</span><span id="line-1874"></span><span class="annot"><a href="GHC.Unit.State.html#mkModMap"><span class="hs-identifier hs-type">mkModMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-1875"></span><span id="mkModMap"><span class="annot"><span class="annottext">mkModMap :: GenUnit UnitId
-&gt; ModuleName -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
</span><a href="GHC.Unit.State.html#mkModMap"><span class="hs-identifier hs-var hs-var">mkModMap</span></a></span></span><span> </span><span id="local-6989586621681680889"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680889"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span id="local-6989586621681680890"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680890"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleOrigin -&gt; Map Module ModuleOrigin
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#singleton/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; ModuleName -&gt; Module
forall unit. unit -&gt; ModuleName -&gt; GenModule unit
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680889"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680890"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1876"></span><span>
</span><span id="line-1877"></span><span>
</span><span id="line-1878"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1879"></span><span class="hs-comment">-- Package Utils</span><span>
</span><span id="line-1880"></span><span>
</span><span id="line-1881"></span><span class="hs-comment">-- | Takes a 'ModuleName', and if the module is in any package returns</span><span>
</span><span id="line-1882"></span><span class="hs-comment">-- list of modules which take that name.</span><span>
</span><span id="line-1883"></span><span class="annot"><a href="GHC.Unit.State.html#lookupModuleInAllUnits"><span class="hs-identifier hs-type">lookupModuleInAllUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-1884"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-1885"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1886"></span><span id="lookupModuleInAllUnits"><span class="annot"><span class="annottext">lookupModuleInAllUnits :: UnitState -&gt; ModuleName -&gt; [(Module, UnitInfo)]
</span><a href="GHC.Unit.State.html#lookupModuleInAllUnits"><span class="hs-identifier hs-var hs-var">lookupModuleInAllUnits</span></a></span></span><span> </span><span id="local-6989586621681680892"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680892"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680893"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680893"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-1887"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; ModuleName -&gt; PkgQual -&gt; LookupResult
</span><a href="GHC.Unit.State.html#lookupModuleWithSuggestions"><span class="hs-identifier hs-var">lookupModuleWithSuggestions</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680892"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680893"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1888"></span><span>      </span><span class="annot"><a href="GHC.Unit.State.html#LookupFound"><span class="hs-identifier hs-type">LookupFound</span></a></span><span> </span><span id="local-6989586621681680896"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680896"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681680897"><span class="annot"><span class="annottext">(UnitInfo, ModuleOrigin)
</span><a href="#local-6989586621681680897"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680896"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(UnitInfo, ModuleOrigin) -&gt; UnitInfo
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitInfo, ModuleOrigin)
</span><a href="#local-6989586621681680897"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1889"></span><span>      </span><span class="annot"><a href="GHC.Unit.State.html#LookupMultiple"><span class="hs-identifier hs-type">LookupMultiple</span></a></span><span> </span><span id="local-6989586621681680899"><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680899"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Module, ModuleOrigin) -&gt; (Module, UnitInfo))
-&gt; [(Module, ModuleOrigin)] -&gt; [(Module, UnitInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, ModuleOrigin) -&gt; (Module, UnitInfo)
</span><a href="#local-6989586621681680900"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680899"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-1890"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681680900"><span class="annot"><span class="annottext">f :: (Module, ModuleOrigin) -&gt; (Module, UnitInfo)
</span><a href="#local-6989586621681680900"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680901"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680901"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ModuleOrigin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680901"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe UnitInfo -&gt; UnitInfo
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupModule&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; GenUnit UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier hs-var">lookupUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680892"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1891"></span><span>                                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680901"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span>      </span><span class="annot"><span class="annottext">LookupResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1893"></span><span>
</span><span id="line-1894"></span><span class="annot"><span class="hs-comment">-- | The result of performing a lookup</span></span><span>
</span><span id="line-1895"></span><span class="hs-keyword">data</span><span> </span><span id="LookupResult"><span class="annot"><a href="GHC.Unit.State.html#LookupResult"><span class="hs-identifier hs-var">LookupResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1896"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Found the module uniquely, nothing else to do</span></span><span>
</span><span id="line-1897"></span><span>    </span><span id="LookupFound"><span class="annot"><a href="GHC.Unit.State.html#LookupFound"><span class="hs-identifier hs-var">LookupFound</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1898"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Multiple modules with the same name in scope</span></span><span>
</span><span id="line-1899"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LookupMultiple"><span class="annot"><a href="GHC.Unit.State.html#LookupMultiple"><span class="hs-identifier hs-var">LookupMultiple</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1900"></span><span>    </span><span class="hs-comment">-- | No modules found, but there were some hidden ones with</span><span>
</span><span id="line-1901"></span><span>    </span><span class="hs-comment">-- an exact name match.  First is due to package hidden, second</span><span>
</span><span id="line-1902"></span><span>    </span><span class="hs-comment">-- is due to module being hidden</span><span>
</span><span id="line-1903"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LookupHidden"><span class="annot"><a href="GHC.Unit.State.html#LookupHidden"><span class="hs-identifier hs-var">LookupHidden</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1904"></span><span>    </span><span class="hs-comment">-- | No modules found, but there were some unusable ones with</span><span>
</span><span id="line-1905"></span><span>    </span><span class="hs-comment">-- an exact name match</span><span>
</span><span id="line-1906"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LookupUnusable"><span class="annot"><a href="GHC.Unit.State.html#LookupUnusable"><span class="hs-identifier hs-var">LookupUnusable</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1907"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Nothing found, here are some suggested different names</span></span><span>
</span><span id="line-1908"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LookupNotFound"><span class="annot"><a href="GHC.Unit.State.html#LookupNotFound"><span class="hs-identifier hs-var">LookupNotFound</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.State.html#ModuleSuggestion"><span class="hs-identifier hs-type">ModuleSuggestion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- suggestions</span><span>
</span><span id="line-1909"></span><span>
</span><span id="line-1910"></span><span class="hs-keyword">data</span><span> </span><span id="ModuleSuggestion"><span class="annot"><a href="GHC.Unit.State.html#ModuleSuggestion"><span class="hs-identifier hs-var">ModuleSuggestion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SuggestVisible"><span class="annot"><a href="GHC.Unit.State.html#SuggestVisible"><span class="hs-identifier hs-var">SuggestVisible</span></a></span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-1911"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span id="SuggestHidden"><span class="annot"><a href="GHC.Unit.State.html#SuggestHidden"><span class="hs-identifier hs-var">SuggestHidden</span></a></span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-1912"></span><span>
</span><span id="line-1913"></span><span class="annot"><a href="GHC.Unit.State.html#lookupModuleWithSuggestions"><span class="hs-identifier hs-type">lookupModuleWithSuggestions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-1914"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-1915"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span>
</span><span id="line-1916"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span><span>
</span><span id="line-1917"></span><span id="lookupModuleWithSuggestions"><span class="annot"><span class="annottext">lookupModuleWithSuggestions :: UnitState -&gt; ModuleName -&gt; PkgQual -&gt; LookupResult
</span><a href="GHC.Unit.State.html#lookupModuleWithSuggestions"><span class="hs-identifier hs-var hs-var">lookupModuleWithSuggestions</span></a></span></span><span> </span><span id="local-6989586621681680908"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680908"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span>
</span><span id="line-1918"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState
-&gt; ModuleNameProvidersMap -&gt; ModuleName -&gt; PkgQual -&gt; LookupResult
</span><a href="GHC.Unit.State.html#lookupModuleWithSuggestions%27"><span class="hs-identifier hs-var">lookupModuleWithSuggestions'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680908"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680908"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1919"></span><span>
</span><span id="line-1920"></span><span class="hs-comment">-- | The package which the module **appears** to come from, this could be</span><span>
</span><span id="line-1921"></span><span class="hs-comment">-- the one which reexports the module from it's original package. This function</span><span>
</span><span id="line-1922"></span><span class="hs-comment">-- is currently only used for -Wunused-packages</span><span>
</span><span id="line-1923"></span><span class="annot"><a href="GHC.Unit.State.html#lookupModulePackage"><span class="hs-identifier hs-type">lookupModulePackage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1924"></span><span id="lookupModulePackage"><span class="annot"><span class="annottext">lookupModulePackage :: UnitState -&gt; ModuleName -&gt; PkgQual -&gt; Maybe [UnitInfo]
</span><a href="GHC.Unit.State.html#lookupModulePackage"><span class="hs-identifier hs-var hs-var">lookupModulePackage</span></a></span></span><span> </span><span id="local-6989586621681680910"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680910"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680911"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680911"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621681680912"><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621681680912"><span class="hs-identifier hs-var">mfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1925"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitState
-&gt; ModuleNameProvidersMap -&gt; ModuleName -&gt; PkgQual -&gt; LookupResult
</span><a href="GHC.Unit.State.html#lookupModuleWithSuggestions%27"><span class="hs-identifier hs-var">lookupModuleWithSuggestions'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680910"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680910"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680911"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621681680912"><span class="hs-identifier hs-var">mfs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1926"></span><span>      </span><span class="annot"><a href="GHC.Unit.State.html#LookupFound"><span class="hs-identifier hs-type">LookupFound</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680913"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680913"><span class="hs-identifier hs-var">orig_unit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680914"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680914"><span class="hs-identifier hs-var">origin</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1927"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680914"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1928"></span><span>          </span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621681680915"><span class="annot"><span class="annottext">Maybe Bool
fromOrigUnit :: ModuleOrigin -&gt; Maybe Bool
fromOrigUnit :: Maybe Bool
</span><a href="GHC.Unit.State.html#fromOrigUnit"><span class="hs-identifier hs-var hs-var">fromOrigUnit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680916"><span class="annot"><span class="annottext">[UnitInfo]
fromExposedReexport :: ModuleOrigin -&gt; [UnitInfo]
fromExposedReexport :: [UnitInfo]
</span><a href="GHC.Unit.State.html#fromExposedReexport"><span class="hs-identifier hs-var hs-var">fromExposedReexport</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1929"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681680915"><span class="hs-identifier hs-var">fromOrigUnit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1930"></span><span>              </span><span class="hs-comment">-- Just True means, the import is available from its original location</span><span>
</span><span id="line-1931"></span><span>              </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1932"></span><span>                </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Maybe [UnitInfo]
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680913"><span class="hs-identifier hs-var">orig_unit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1933"></span><span>              </span><span class="hs-comment">-- Otherwise, it must be available from a reexport</span><span>
</span><span id="line-1934"></span><span>              </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Maybe [UnitInfo]
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680916"><span class="hs-identifier hs-var">fromExposedReexport</span></a></span><span>
</span><span id="line-1935"></span><span>
</span><span id="line-1936"></span><span>          </span><span class="annot"><span class="annottext">ModuleOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [UnitInfo]
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1937"></span><span>
</span><span id="line-1938"></span><span>      </span><span class="annot"><span class="annottext">LookupResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [UnitInfo]
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1939"></span><span>
</span><span id="line-1940"></span><span class="annot"><a href="GHC.Unit.State.html#lookupPluginModuleWithSuggestions"><span class="hs-identifier hs-type">lookupPluginModuleWithSuggestions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-1941"></span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-1942"></span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span>
</span><span id="line-1943"></span><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span><span>
</span><span id="line-1944"></span><span id="lookupPluginModuleWithSuggestions"><span class="annot"><span class="annottext">lookupPluginModuleWithSuggestions :: UnitState -&gt; ModuleName -&gt; PkgQual -&gt; LookupResult
</span><a href="GHC.Unit.State.html#lookupPluginModuleWithSuggestions"><span class="hs-identifier hs-var hs-var">lookupPluginModuleWithSuggestions</span></a></span></span><span> </span><span id="local-6989586621681680917"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680917"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span>
</span><span id="line-1945"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState
-&gt; ModuleNameProvidersMap -&gt; ModuleName -&gt; PkgQual -&gt; LookupResult
</span><a href="GHC.Unit.State.html#lookupModuleWithSuggestions%27"><span class="hs-identifier hs-var">lookupModuleWithSuggestions'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680917"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#pluginModuleNameProvidersMap"><span class="hs-identifier hs-var">pluginModuleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680917"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1946"></span><span>
</span><span id="line-1947"></span><span class="annot"><a href="GHC.Unit.State.html#lookupModuleWithSuggestions%27"><span class="hs-identifier hs-type">lookupModuleWithSuggestions'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span>
</span><span id="line-1948"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleNameProvidersMap"><span class="hs-identifier hs-type">ModuleNameProvidersMap</span></a></span><span>
</span><span id="line-1949"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-1950"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span>
</span><span id="line-1951"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#LookupResult"><span class="hs-identifier hs-type">LookupResult</span></a></span><span>
</span><span id="line-1952"></span><span id="lookupModuleWithSuggestions%27"><span class="annot"><span class="annottext">lookupModuleWithSuggestions' :: UnitState
-&gt; ModuleNameProvidersMap -&gt; ModuleName -&gt; PkgQual -&gt; LookupResult
</span><a href="GHC.Unit.State.html#lookupModuleWithSuggestions%27"><span class="hs-identifier hs-var hs-var">lookupModuleWithSuggestions'</span></a></span></span><span> </span><span id="local-6989586621681680918"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680918"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span id="local-6989586621681680919"><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680919"><span class="hs-identifier hs-var">mod_map</span></a></span></span><span> </span><span id="local-6989586621681680920"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680920"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681680921"><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621681680921"><span class="hs-identifier hs-var">mb_pn</span></a></span></span><span>
</span><span id="line-1953"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; ModuleNameProvidersMap -&gt; Maybe (Map Module ModuleOrigin)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680920"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681680919"><span class="hs-identifier hs-var">mod_map</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1954"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Map Module ModuleOrigin)
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ModuleSuggestion] -&gt; LookupResult
</span><a href="GHC.Unit.State.html#LookupNotFound"><span class="hs-identifier hs-var">LookupNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleSuggestion]
</span><a href="#local-6989586621681680922"><span class="hs-identifier hs-var">suggestions</span></a></span><span>
</span><span id="line-1955"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680923"><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680923"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1956"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
  [(Module, ModuleOrigin)], [(Module, ModuleOrigin)])
 -&gt; (Module, ModuleOrigin)
 -&gt; ([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
     [(Module, ModuleOrigin)], [(Module, ModuleOrigin)]))
-&gt; ([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
    [(Module, ModuleOrigin)], [(Module, ModuleOrigin)])
-&gt; [(Module, ModuleOrigin)]
-&gt; ([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
    [(Module, ModuleOrigin)], [(Module, ModuleOrigin)])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
 [(Module, ModuleOrigin)], [(Module, ModuleOrigin)])
-&gt; (Module, ModuleOrigin)
-&gt; ([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
    [(Module, ModuleOrigin)], [(Module, ModuleOrigin)])
</span><a href="#local-6989586621681680924"><span class="hs-identifier hs-var">classify</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module ModuleOrigin -&gt; [(Module, ModuleOrigin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680923"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1957"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ModuleSuggestion] -&gt; LookupResult
</span><a href="GHC.Unit.State.html#LookupNotFound"><span class="hs-identifier hs-var">LookupNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleSuggestion]
</span><a href="#local-6989586621681680922"><span class="hs-identifier hs-var">suggestions</span></a></span><span>
</span><span id="line-1958"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621681680925"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680925"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680926"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680926"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Module -&gt; (UnitInfo, ModuleOrigin) -&gt; LookupResult
</span><a href="GHC.Unit.State.html#LookupFound"><span class="hs-identifier hs-var">LookupFound</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680925"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitInfo
</span><a href="#local-6989586621681680927"><span class="hs-identifier hs-var">mod_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680925"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680926"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1959"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680928"><span class="annot"><span class="annottext">exposed :: [(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680928"><span class="hs-identifier hs-var">exposed</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)] -&gt; LookupResult
</span><a href="GHC.Unit.State.html#LookupMultiple"><span class="hs-identifier hs-var">LookupMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680928"><span class="hs-identifier hs-var">exposed</span></a></span><span>
</span><span id="line-1960"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680929"><span class="annot"><span class="annottext">unusable :: [(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680929"><span class="hs-identifier hs-var">unusable</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)] -&gt; LookupResult
</span><a href="GHC.Unit.State.html#LookupUnusable"><span class="hs-identifier hs-var">LookupUnusable</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680929"><span class="hs-identifier hs-var">unusable</span></a></span><span>
</span><span id="line-1961"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681680930"><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680930"><span class="hs-identifier hs-var">hidden_pkg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680931"><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680931"><span class="hs-identifier hs-var">hidden_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1962"></span><span>              </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
-&gt; [(Module, ModuleOrigin)] -&gt; LookupResult
</span><a href="GHC.Unit.State.html#LookupHidden"><span class="hs-identifier hs-var">LookupHidden</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680930"><span class="hs-identifier hs-var">hidden_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680931"><span class="hs-identifier hs-var">hidden_mod</span></a></span><span>
</span><span id="line-1963"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1964"></span><span>    </span><span id="local-6989586621681680924"><span class="annot"><span class="annottext">classify :: ([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
 [(Module, ModuleOrigin)], [(Module, ModuleOrigin)])
-&gt; (Module, ModuleOrigin)
-&gt; ([(Module, ModuleOrigin)], [(Module, ModuleOrigin)],
    [(Module, ModuleOrigin)], [(Module, ModuleOrigin)])
</span><a href="#local-6989586621681680924"><span class="hs-identifier hs-var hs-var">classify</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680932"><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680932"><span class="hs-identifier hs-var">hidden_pkg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680933"><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680933"><span class="hs-identifier hs-var">hidden_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680934"><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680934"><span class="hs-identifier hs-var">unusable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680935"><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680935"><span class="hs-identifier hs-var">exposed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680936"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680936"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680937"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680937"><span class="hs-identifier hs-var">origin0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1965"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680938"><span class="annot"><span class="annottext">origin :: ModuleOrigin
</span><a href="#local-6989586621681680938"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgQual -&gt; UnitInfo -&gt; ModuleOrigin -&gt; ModuleOrigin
</span><a href="#local-6989586621681680939"><span class="hs-identifier hs-var">filterOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621681680921"><span class="hs-identifier hs-var">mb_pn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitInfo
</span><a href="#local-6989586621681680927"><span class="hs-identifier hs-var">mod_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680936"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680937"><span class="hs-identifier hs-var">origin0</span></a></span><span>
</span><span id="line-1966"></span><span>          </span><span id="local-6989586621681680940"><span class="annot"><span class="annottext">x :: (Module, ModuleOrigin)
</span><a href="#local-6989586621681680940"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680936"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680938"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1967"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680938"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1968"></span><span>          </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="GHC.Unit.State.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a></span><span>
</span><span id="line-1969"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680932"><span class="hs-identifier hs-var">hidden_pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
</span><a href="#local-6989586621681680940"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
-&gt; [(Module, ModuleOrigin)] -&gt; [(Module, ModuleOrigin)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680933"><span class="hs-identifier hs-var">hidden_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680934"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680935"><span class="hs-identifier hs-var">exposed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1970"></span><span>          </span><span class="annot"><a href="GHC.Unit.State.html#ModUnusable"><span class="hs-identifier hs-type">ModUnusable</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnit
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1971"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680932"><span class="hs-identifier hs-var">hidden_pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680933"><span class="hs-identifier hs-var">hidden_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
</span><a href="#local-6989586621681680940"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
-&gt; [(Module, ModuleOrigin)] -&gt; [(Module, ModuleOrigin)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680934"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680935"><span class="hs-identifier hs-var">exposed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1972"></span><span>          </span><span class="annot"><span class="annottext">ModuleOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#originEmpty"><span class="hs-identifier hs-var">originEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680938"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-1973"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680932"><span class="hs-identifier hs-var">hidden_pkg</span></a></span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680933"><span class="hs-identifier hs-var">hidden_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680934"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680935"><span class="hs-identifier hs-var">exposed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1974"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680938"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-1975"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680932"><span class="hs-identifier hs-var">hidden_pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680933"><span class="hs-identifier hs-var">hidden_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680934"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
</span><a href="#local-6989586621681680940"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
-&gt; [(Module, ModuleOrigin)] -&gt; [(Module, ModuleOrigin)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680935"><span class="hs-identifier hs-var">exposed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1976"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1977"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
</span><a href="#local-6989586621681680940"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">(Module, ModuleOrigin)
-&gt; [(Module, ModuleOrigin)] -&gt; [(Module, ModuleOrigin)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680932"><span class="hs-identifier hs-var">hidden_pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680933"><span class="hs-identifier hs-var">hidden_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680934"><span class="hs-identifier hs-var">unusable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Module, ModuleOrigin)]
</span><a href="#local-6989586621681680935"><span class="hs-identifier hs-var">exposed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1978"></span><span>
</span><span id="line-1979"></span><span>    </span><span id="local-6989586621681680941"><span class="annot"><span class="annottext">unit_lookup :: GenUnit UnitId -&gt; UnitInfo
</span><a href="#local-6989586621681680941"><span class="hs-identifier hs-var hs-var">unit_lookup</span></a></span></span><span> </span><span id="local-6989586621681680942"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680942"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; GenUnit UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier hs-var">lookupUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680918"><span class="hs-identifier hs-var">pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680942"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UnitInfo -&gt; UnitInfo -&gt; UnitInfo
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; UnitInfo
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lookupModuleWithSuggestions&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681680942"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680920"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1980"></span><span>    </span><span id="local-6989586621681680927"><span class="annot"><span class="annottext">mod_unit :: Module -&gt; UnitInfo
</span><a href="#local-6989586621681680927"><span class="hs-identifier hs-var hs-var">mod_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitInfo
</span><a href="#local-6989586621681680941"><span class="hs-identifier hs-var">unit_lookup</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; UnitInfo)
-&gt; (Module -&gt; GenUnit UnitId) -&gt; Module -&gt; UnitInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span>
</span><span id="line-1981"></span><span>
</span><span id="line-1982"></span><span>    </span><span class="hs-comment">-- Filters out origins which are not associated with the given package</span><span>
</span><span id="line-1983"></span><span>    </span><span class="hs-comment">-- qualifier.  No-op if there is no package qualifier.  Test if this</span><span>
</span><span id="line-1984"></span><span>    </span><span class="hs-comment">-- excluded all origins with 'originEmpty'.</span><span>
</span><span id="line-1985"></span><span>    </span><span class="annot"><a href="#local-6989586621681680939"><span class="hs-identifier hs-type">filterOrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span>
</span><span id="line-1986"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span>
</span><span id="line-1987"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-1988"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a></span><span>
</span><span id="line-1989"></span><span>    </span><span id="local-6989586621681680939"><span class="annot"><span class="annottext">filterOrigin :: PkgQual -&gt; UnitInfo -&gt; ModuleOrigin -&gt; ModuleOrigin
</span><a href="#local-6989586621681680939"><span class="hs-identifier hs-var hs-var">filterOrigin</span></a></span></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681680943"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680943"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680943"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-1990"></span><span>    </span><span class="annot"><a href="#local-6989586621681680939"><span class="hs-identifier hs-var">filterOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.PkgQual.html#ThisPkg"><span class="hs-identifier hs-type">ThisPkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681680945"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680945"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680945"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-1991"></span><span>    </span><span class="annot"><a href="#local-6989586621681680939"><span class="hs-identifier hs-var">filterOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.PkgQual.html#OtherPkg"><span class="hs-identifier hs-type">OtherPkg</span></a></span><span> </span><span id="local-6989586621681680947"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680947"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681680948"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680948"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span id="local-6989586621681680949"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680949"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1992"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681680950"><span class="annot"><span class="annottext">match_pkg :: UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680950"><span class="hs-identifier hs-var hs-var">match_pkg</span></a></span></span><span> </span><span id="local-6989586621681680951"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680951"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680947"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680951"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1993"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680949"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1994"></span><span>          </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="GHC.Unit.State.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a></span><span>
</span><span id="line-1995"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680950"><span class="hs-identifier hs-var">match_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680948"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="GHC.Unit.State.html#ModHidden"><span class="hs-identifier hs-var">ModHidden</span></a></span><span>
</span><span id="line-1996"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1997"></span><span>          </span><span class="annot"><a href="GHC.Unit.State.html#ModUnusable"><span class="hs-identifier hs-type">ModUnusable</span></a></span><span> </span><span class="annot"><span class="annottext">UnusableUnit
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1998"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680950"><span class="hs-identifier hs-var">match_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680948"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680949"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-1999"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-2000"></span><span>          </span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fromOrigUnit :: ModuleOrigin -&gt; Maybe Bool
</span><a href="GHC.Unit.State.html#fromOrigUnit"><span class="hs-identifier hs-var">fromOrigUnit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681680952"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681680952"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fromExposedReexport :: ModuleOrigin -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#fromExposedReexport"><span class="hs-identifier hs-var">fromExposedReexport</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681680953"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680953"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-2001"></span><span>                      </span><span class="annot"><span class="annottext">fromHiddenReexport :: ModuleOrigin -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#fromHiddenReexport"><span class="hs-identifier hs-var">fromHiddenReexport</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681680954"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680954"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2002"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModOrigin"><span class="hs-identifier hs-type">ModOrigin</span></a></span><span>
</span><span id="line-2003"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fromOrigUnit :: Maybe Bool
</span><a href="GHC.Unit.State.html#fromOrigUnit"><span class="hs-identifier hs-var">fromOrigUnit</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680950"><span class="hs-identifier hs-var">match_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680948"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621681680952"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2004"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fromExposedReexport :: [UnitInfo]
</span><a href="GHC.Unit.State.html#fromExposedReexport"><span class="hs-identifier hs-var">fromExposedReexport</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680950"><span class="hs-identifier hs-var">match_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680953"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-2005"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fromHiddenReexport :: [UnitInfo]
</span><a href="GHC.Unit.State.html#fromHiddenReexport"><span class="hs-identifier hs-var">fromHiddenReexport</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Bool
</span><a href="#local-6989586621681680950"><span class="hs-identifier hs-var">match_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681680954"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2006"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fromPackageFlag :: Bool
</span><a href="GHC.Unit.State.html#fromPackageFlag"><span class="hs-identifier hs-var">fromPackageFlag</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- always excluded</span><span>
</span><span id="line-2007"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-2008"></span><span>
</span><span id="line-2009"></span><span>    </span><span id="local-6989586621681680922"><span class="annot"><span class="annottext">suggestions :: [ModuleSuggestion]
</span><a href="#local-6989586621681680922"><span class="hs-identifier hs-var hs-var">suggestions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, ModuleSuggestion)] -&gt; [ModuleSuggestion]
forall a. String -&gt; [(String, a)] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#fuzzyLookup"><span class="hs-identifier hs-var">fuzzyLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680920"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, ModuleSuggestion)]
</span><a href="#local-6989586621681680957"><span class="hs-identifier hs-var">all_mods</span></a></span><span>
</span><span id="line-2010"></span><span>
</span><span id="line-2011"></span><span>    </span><span class="annot"><a href="#local-6989586621681680957"><span class="hs-identifier hs-type">all_mods</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleSuggestion"><span class="hs-identifier hs-type">ModuleSuggestion</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- All modules</span><span>
</span><span id="line-2012"></span><span>    </span><span id="local-6989586621681680957"><span class="annot"><span class="annottext">all_mods :: [(String, ModuleSuggestion)]
</span><a href="#local-6989586621681680957"><span class="hs-identifier hs-var hs-var">all_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, ModuleSuggestion)
 -&gt; (String, ModuleSuggestion) -&gt; Ordering)
-&gt; [(String, ModuleSuggestion)] -&gt; [(String, ModuleSuggestion)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#sortBy/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((String, ModuleSuggestion) -&gt; String)
-&gt; (String, ModuleSuggestion)
-&gt; (String, ModuleSuggestion)
-&gt; Ordering
forall a t. Ord a =&gt; (t -&gt; a) -&gt; t -&gt; t -&gt; Ordering
</span><a href="GHC.Unit.State.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">(String, ModuleSuggestion) -&gt; String
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(String, ModuleSuggestion)] -&gt; [(String, ModuleSuggestion)])
-&gt; [(String, ModuleSuggestion)] -&gt; [(String, ModuleSuggestion)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2013"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680958"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleSuggestion
</span><a href="#local-6989586621681680959"><span class="hs-identifier hs-var">suggestion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2014"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680958"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680958"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680960"><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680960"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap -&gt; [(ModuleName, Map Module ModuleOrigin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680918"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2015"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680959"><span class="annot"><span class="annottext">ModuleSuggestion
</span><a href="#local-6989586621681680959"><span class="hs-identifier hs-var">suggestion</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Module, ModuleOrigin) -&gt; ModuleSuggestion)
-&gt; [(Module, ModuleOrigin)] -&gt; [ModuleSuggestion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; (Module, ModuleOrigin) -&gt; ModuleSuggestion
</span><a href="#local-6989586621681680961"><span class="hs-identifier hs-var">getSuggestion</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680958"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module ModuleOrigin -&gt; [(Module, ModuleOrigin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module ModuleOrigin
</span><a href="#local-6989586621681680960"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2016"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2017"></span><span>    </span><span id="local-6989586621681680961"><span class="annot"><span class="annottext">getSuggestion :: ModuleName -&gt; (Module, ModuleOrigin) -&gt; ModuleSuggestion
</span><a href="#local-6989586621681680961"><span class="hs-identifier hs-var hs-var">getSuggestion</span></a></span></span><span> </span><span id="local-6989586621681680962"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680962"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680963"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680963"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680964"><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680964"><span class="hs-identifier hs-var">origin</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2018"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680964"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Module -&gt; ModuleOrigin -&gt; ModuleSuggestion
</span><a href="GHC.Unit.State.html#SuggestVisible"><span class="hs-identifier hs-var">SuggestVisible</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Module -&gt; ModuleOrigin -&gt; ModuleSuggestion
</span><a href="GHC.Unit.State.html#SuggestHidden"><span class="hs-identifier hs-var">SuggestHidden</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2019"></span><span>            </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681680962"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681680963"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin
</span><a href="#local-6989586621681680964"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-2020"></span><span>
</span><span id="line-2021"></span><span class="annot"><a href="GHC.Unit.State.html#listVisibleModuleNames"><span class="hs-identifier hs-type">listVisibleModuleNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2022"></span><span id="listVisibleModuleNames"><span class="annot"><span class="annottext">listVisibleModuleNames :: UnitState -&gt; [ModuleName]
</span><a href="GHC.Unit.State.html#listVisibleModuleNames"><span class="hs-identifier hs-var hs-var">listVisibleModuleNames</span></a></span></span><span> </span><span id="local-6989586621681680965"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680965"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2023"></span><span>    </span><span class="annot"><span class="annottext">((ModuleName, Map Module ModuleOrigin) -&gt; ModuleName)
-&gt; [(ModuleName, Map Module ModuleOrigin)] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, Map Module ModuleOrigin) -&gt; ModuleName
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ModuleName, Map Module ModuleOrigin) -&gt; Bool)
-&gt; [(ModuleName, Map Module ModuleOrigin)]
-&gt; [(ModuleName, Map Module ModuleOrigin)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, Map Module ModuleOrigin) -&gt; Bool
forall {a} {k}. (a, Map k ModuleOrigin) -&gt; Bool
</span><a href="#local-6989586621681680966"><span class="hs-identifier hs-var">visible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameProvidersMap -&gt; [(ModuleName, Map Module ModuleOrigin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; ModuleNameProvidersMap
</span><a href="GHC.Unit.State.html#moduleNameProvidersMap"><span class="hs-identifier hs-var">moduleNameProvidersMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681680965"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2024"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681680966"><span class="annot"><span class="annottext">visible :: (a, Map k ModuleOrigin) -&gt; Bool
</span><a href="#local-6989586621681680966"><span class="hs-identifier hs-var hs-var">visible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680968"><span class="annot"><span class="annottext">Map k ModuleOrigin
</span><a href="#local-6989586621681680968"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleOrigin -&gt; Bool) -&gt; [ModuleOrigin] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleOrigin -&gt; Bool
</span><a href="GHC.Unit.State.html#originVisible"><span class="hs-identifier hs-var">originVisible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k ModuleOrigin -&gt; [ModuleOrigin]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map k ModuleOrigin
</span><a href="#local-6989586621681680968"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2025"></span><span>
</span><span id="line-2026"></span><span class="hs-comment">-- | Takes a list of UnitIds (and their &quot;parent&quot; dependency, used for error</span><span>
</span><span id="line-2027"></span><span class="hs-comment">-- messages), and returns the list with dependencies included, in reverse</span><span>
</span><span id="line-2028"></span><span class="hs-comment">-- dependency order (a units appears before those it depends on).</span><span>
</span><span id="line-2029"></span><span class="annot"><a href="GHC.Unit.State.html#closeUnitDeps"><span class="hs-identifier hs-type">closeUnitDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-type">UnitErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2030"></span><span id="closeUnitDeps"><span class="annot"><span class="annottext">closeUnitDeps :: UnitInfoMap
-&gt; [(UnitId, Maybe UnitId)] -&gt; MaybeErr UnitErr [UnitId]
</span><a href="GHC.Unit.State.html#closeUnitDeps"><span class="hs-identifier hs-var hs-var">closeUnitDeps</span></a></span></span><span> </span><span id="local-6989586621681680969"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680969"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680970"><span class="annot"><span class="annottext">[(UnitId, Maybe UnitId)]
</span><a href="#local-6989586621681680970"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; [UnitId]
-&gt; [(UnitId, Maybe UnitId)]
-&gt; MaybeErr UnitErr [UnitId]
</span><a href="GHC.Unit.State.html#closeUnitDeps%27"><span class="hs-identifier hs-var">closeUnitDeps'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680969"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(UnitId, Maybe UnitId)]
</span><a href="#local-6989586621681680970"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-2031"></span><span>
</span><span id="line-2032"></span><span class="hs-comment">-- | Similar to closeUnitDeps but takes a list of already loaded units as an</span><span>
</span><span id="line-2033"></span><span class="hs-comment">-- additional argument.</span><span>
</span><span id="line-2034"></span><span class="annot"><a href="GHC.Unit.State.html#closeUnitDeps%27"><span class="hs-identifier hs-type">closeUnitDeps'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-type">UnitErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2035"></span><span id="closeUnitDeps%27"><span class="annot"><span class="annottext">closeUnitDeps' :: UnitInfoMap
-&gt; [UnitId]
-&gt; [(UnitId, Maybe UnitId)]
-&gt; MaybeErr UnitErr [UnitId]
</span><a href="GHC.Unit.State.html#closeUnitDeps%27"><span class="hs-identifier hs-var hs-var">closeUnitDeps'</span></a></span></span><span> </span><span id="local-6989586621681680971"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680971"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680972"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680972"><span class="hs-identifier hs-var">current_ids</span></a></span></span><span> </span><span id="local-6989586621681680973"><span class="annot"><span class="annottext">[(UnitId, Maybe UnitId)]
</span><a href="#local-6989586621681680973"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; (UnitId, Maybe UnitId) -&gt; MaybeErr UnitErr [UnitId])
-&gt; [UnitId]
-&gt; [(UnitId, Maybe UnitId)]
-&gt; MaybeErr UnitErr [UnitId]
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#foldM/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; [UnitId] -&gt; (UnitId, Maybe UnitId) -&gt; MaybeErr UnitErr [UnitId]
</span><a href="GHC.Unit.State.html#add_unit"><span class="hs-identifier hs-var">add_unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680971"><span class="hs-identifier hs-var">pkg_map</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680972"><span class="hs-identifier hs-var">current_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, Maybe UnitId)]
</span><a href="#local-6989586621681680973"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span class="hs-comment">-- | Add a UnitId and those it depends on (recursively) to the given list of</span><span>
</span><span id="line-2038"></span><span class="hs-comment">-- UnitIds if they are not already in it. Return a list in reverse dependency</span><span>
</span><span id="line-2039"></span><span class="hs-comment">-- order (a unit appears before those it depends on).</span><span>
</span><span id="line-2040"></span><span class="hs-comment">--</span><span>
</span><span id="line-2041"></span><span class="hs-comment">-- The UnitId is looked up in the given UnitInfoMap (to find its dependencies).</span><span>
</span><span id="line-2042"></span><span class="hs-comment">-- It it's not found, the optional parent unit is used to return a more precise</span><span>
</span><span id="line-2043"></span><span class="hs-comment">-- error message (&quot;dependency of &lt;PARENT&gt;&quot;).</span><span>
</span><span id="line-2044"></span><span class="annot"><a href="GHC.Unit.State.html#add_unit"><span class="hs-identifier hs-type">add_unit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span>
</span><span id="line-2045"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2046"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2047"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-type">UnitErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2048"></span><span id="add_unit"><span class="annot"><span class="annottext">add_unit :: UnitInfoMap
-&gt; [UnitId] -&gt; (UnitId, Maybe UnitId) -&gt; MaybeErr UnitErr [UnitId]
</span><a href="GHC.Unit.State.html#add_unit"><span class="hs-identifier hs-var hs-var">add_unit</span></a></span></span><span> </span><span id="local-6989586621681680975"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680975"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681680976"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680976"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681680977"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680977"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681680978"><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681680978"><span class="hs-identifier hs-var">mb_parent</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2049"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680977"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; [UnitId] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680976"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; MaybeErr UnitErr [UnitId]
forall a. a -&gt; MaybeErr UnitErr a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680976"><span class="hs-identifier hs-var">ps</span></a></span><span>     </span><span class="hs-comment">-- Check if we've already added this unit</span><span>
</span><span id="line-2050"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId%27"><span class="hs-identifier hs-var">lookupUnitId'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680975"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680977"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2051"></span><span>      </span><span class="annot"><span class="annottext">Maybe UnitInfo
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitErr -&gt; MaybeErr UnitErr [UnitId]
forall err val. err -&gt; MaybeErr err val
</span><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Maybe UnitId -&gt; UnitErr
</span><a href="GHC.Unit.State.html#CloseUnitErr"><span class="hs-identifier hs-var">CloseUnitErr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680977"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681680978"><span class="hs-identifier hs-var">mb_parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2052"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681680981"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680981"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2053"></span><span>         </span><span class="hs-comment">-- Add the unit's dependents also</span><span>
</span><span id="line-2054"></span><span>         </span><span id="local-6989586621681680982"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680982"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; UnitId -&gt; MaybeErr UnitErr [UnitId])
-&gt; [UnitId] -&gt; [UnitId] -&gt; MaybeErr UnitErr [UnitId]
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#foldM/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; UnitId -&gt; MaybeErr UnitErr [UnitId]
</span><a href="#local-6989586621681680983"><span class="hs-identifier hs-var">add_unit_key</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680976"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; [UnitId]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; [uid]
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitDepends/GHC.Unit.Database.html#unitDepends"><span class="hs-identifier hs-var">unitDepends</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681680981"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2055"></span><span>         </span><span class="annot"><span class="annottext">[UnitId] -&gt; MaybeErr UnitErr [UnitId]
forall a. a -&gt; MaybeErr UnitErr a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680977"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; [UnitId] -&gt; [UnitId]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680982"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2056"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-2057"></span><span>          </span><span id="local-6989586621681680983"><span class="annot"><span class="annottext">add_unit_key :: [UnitId] -&gt; UnitId -&gt; MaybeErr UnitErr [UnitId]
</span><a href="#local-6989586621681680983"><span class="hs-identifier hs-var hs-var">add_unit_key</span></a></span></span><span> </span><span id="local-6989586621681680984"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680984"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621681680985"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680985"><span class="hs-identifier hs-var">key</span></a></span></span><span>
</span><span id="line-2058"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; [UnitId] -&gt; (UnitId, Maybe UnitId) -&gt; MaybeErr UnitErr [UnitId]
</span><a href="GHC.Unit.State.html#add_unit"><span class="hs-identifier hs-var">add_unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681680975"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681680984"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680985"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Maybe UnitId
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681680977"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2059"></span><span>
</span><span id="line-2060"></span><span class="hs-keyword">data</span><span> </span><span id="UnitErr"><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-var">UnitErr</span></a></span></span><span>
</span><span id="line-2061"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CloseUnitErr"><span class="annot"><a href="GHC.Unit.State.html#CloseUnitErr"><span class="hs-identifier hs-var">CloseUnitErr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2062"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PackageFlagErr"><span class="annot"><a href="GHC.Unit.State.html#PackageFlagErr"><span class="hs-identifier hs-var">PackageFlagErr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Driver.Session.html#PackageFlag"><span class="hs-identifier hs-type">PackageFlag</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2063"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TrustFlagErr"><span class="annot"><a href="GHC.Unit.State.html#TrustFlagErr"><span class="hs-identifier hs-var">TrustFlagErr</span></a></span></span><span>   </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Driver.Session.html#TrustFlag"><span class="hs-identifier hs-type">TrustFlag</span></a></span><span>   </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Unit.State.html#UnusableUnitReason"><span class="hs-identifier hs-type">UnusableUnitReason</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2064"></span><span>
</span><span id="line-2065"></span><span id="local-6989586621681679283"><span class="annot"><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-type">mayThrowUnitErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-type">UnitErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679283"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681679283"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2066"></span><span id="mayThrowUnitErr"><span class="annot"><span class="annottext">mayThrowUnitErr :: forall a. MaybeErr UnitErr a -&gt; IO a
</span><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-var hs-var">mayThrowUnitErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2067"></span><span>    </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621681680989"><span class="annot"><span class="annottext">UnitErr
</span><a href="#local-6989586621681680989"><span class="hs-identifier hs-var">e</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span>
</span><span id="line-2068"></span><span>                    </span><span class="annot"><span class="annottext">(GhcException -&gt; IO a) -&gt; GhcException -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span>
</span><span id="line-2069"></span><span>                    </span><span class="annot"><span class="annottext">(String -&gt; GhcException) -&gt; String -&gt; GhcException
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#renderWithContext"><span class="hs-identifier hs-var">renderWithContext</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span>
</span><span id="line-2070"></span><span>                    </span><span class="annot"><span class="annottext">(SDoc -&gt; String) -&gt; SDoc -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-var">withPprStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="GHC.Utils.Outputable.html#defaultUserStyle"><span class="hs-identifier hs-var">defaultUserStyle</span></a></span><span>
</span><span id="line-2071"></span><span>                    </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitErr -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitErr
</span><a href="#local-6989586621681680989"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2072"></span><span>    </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621681680993"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681680993"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681680993"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-2073"></span><span>
</span><span id="line-2074"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitErr"><span class="hs-identifier hs-type">UnitErr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2075"></span><span>    </span><span id="local-6989586621681681009"><span class="annot"><span class="annottext">ppr :: UnitErr -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2076"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#CloseUnitErr"><span class="hs-identifier hs-type">CloseUnitErr</span></a></span><span> </span><span id="local-6989586621681681010"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681010"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681681011"><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681681011"><span class="hs-identifier hs-var">mb_parent</span></a></span></span><span>
</span><span id="line-2077"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unknown unit:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681010"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2078"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681681011"><span class="hs-identifier hs-var">mb_parent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2079"></span><span>                     </span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-2080"></span><span>                     </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681681013"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681013"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#space"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dependency of&quot;</span></span><span>
</span><span id="line-2081"></span><span>                                              </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall doc. IsLine doc =&gt; FastString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; FastString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681013"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2082"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#PackageFlagErr"><span class="hs-identifier hs-type">PackageFlagErr</span></a></span><span> </span><span id="local-6989586621681681016"><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681681016"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681681017"><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681681017"><span class="hs-identifier hs-var">reasons</span></a></span></span><span>
</span><span id="line-2083"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [(UnitInfo, UnusableUnitReason)] -&gt; SDoc
forall {a} {srcpkgid} {srcpkgname} {modulename} {mod}.
Outputable a =&gt;
SDoc
-&gt; [(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
     UnusableUnitReason)]
-&gt; SDoc
</span><a href="#local-6989586621681681018"><span class="hs-identifier hs-var">flag_err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackageFlag -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprFlag"><span class="hs-identifier hs-var">pprFlag</span></a></span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><a href="#local-6989586621681681016"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681681017"><span class="hs-identifier hs-var">reasons</span></a></span><span>
</span><span id="line-2084"></span><span>
</span><span id="line-2085"></span><span>        </span><span class="annot"><a href="GHC.Unit.State.html#TrustFlagErr"><span class="hs-identifier hs-type">TrustFlagErr</span></a></span><span> </span><span id="local-6989586621681681019"><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681681019"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681681020"><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681681020"><span class="hs-identifier hs-var">reasons</span></a></span></span><span>
</span><span id="line-2086"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [(UnitInfo, UnusableUnitReason)] -&gt; SDoc
forall {a} {srcpkgid} {srcpkgname} {modulename} {mod}.
Outputable a =&gt;
SDoc
-&gt; [(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
     UnusableUnitReason)]
-&gt; SDoc
</span><a href="#local-6989586621681681018"><span class="hs-identifier hs-var">flag_err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TrustFlag -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprTrustFlag"><span class="hs-identifier hs-var">pprTrustFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TrustFlag
</span><a href="#local-6989586621681681019"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(UnitInfo, UnusableUnitReason)]
</span><a href="#local-6989586621681681020"><span class="hs-identifier hs-var">reasons</span></a></span><span>
</span><span id="line-2087"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2088"></span><span>        </span><span id="local-6989586621681681018"><span class="annot"><span class="annottext">flag_err :: SDoc
-&gt; [(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
     UnusableUnitReason)]
-&gt; SDoc
</span><a href="#local-6989586621681681018"><span class="hs-identifier hs-var hs-var">flag_err</span></a></span></span><span> </span><span id="local-6989586621681681033"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681681033"><span class="hs-identifier hs-var">flag_doc</span></a></span></span><span> </span><span id="local-6989586621681681034"><span class="annot"><span class="annottext">[(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
  UnusableUnitReason)]
</span><a href="#local-6989586621681681034"><span class="hs-identifier hs-var">reasons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2089"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot satisfy &quot;</span></span><span>
</span><span id="line-2090"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681681033"><span class="hs-identifier hs-var">flag_doc</span></a></span><span>
</span><span id="line-2091"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
  UnusableUnitReason)]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
  UnusableUnitReason)]
</span><a href="#local-6989586621681681034"><span class="hs-identifier hs-var">reasons</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2092"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((GenericUnitInfo srcpkgid srcpkgname a modulename mod,
  UnusableUnitReason)
 -&gt; SDoc)
-&gt; [(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
     UnusableUnitReason)]
-&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
 UnusableUnitReason)
-&gt; SDoc
forall {a} {srcpkgid} {srcpkgname} {modulename} {mod}.
Outputable a =&gt;
(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
 UnusableUnitReason)
-&gt; SDoc
</span><a href="#local-6989586621681681036"><span class="hs-identifier hs-var">ppr_reason</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenericUnitInfo srcpkgid srcpkgname a modulename mod,
  UnusableUnitReason)]
</span><a href="#local-6989586621681681034"><span class="hs-identifier hs-var">reasons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-2093"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(use -v for more information)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2094"></span><span>
</span><span id="line-2095"></span><span>        </span><span id="local-6989586621681681036"><span class="annot"><span class="annottext">ppr_reason :: (GenericUnitInfo srcpkgid srcpkgname a modulename mod,
 UnusableUnitReason)
-&gt; SDoc
</span><a href="#local-6989586621681681036"><span class="hs-identifier hs-var hs-var">ppr_reason</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681681041"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod
</span><a href="#local-6989586621681681041"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681681042"><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681681042"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2096"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; UnusableUnitReason -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprReason"><span class="hs-identifier hs-var">pprReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod -&gt; a
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname a modulename mod
</span><a href="#local-6989586621681681041"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnusableUnitReason
</span><a href="#local-6989586621681681042"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-2097"></span><span>
</span><span id="line-2098"></span><span class="hs-comment">-- | Return this list of requirement interfaces that need to be merged</span><span>
</span><span id="line-2099"></span><span class="hs-comment">-- to form @mod_name@, or @[]@ if this is not a requirement.</span><span>
</span><span id="line-2100"></span><span class="annot"><a href="GHC.Unit.State.html#requirementMerges"><span class="hs-identifier hs-type">requirementMerges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedModule"><span class="hs-identifier hs-type">InstantiatedModule</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2101"></span><span id="requirementMerges"><span class="annot"><span class="annottext">requirementMerges :: UnitState -&gt; ModuleName -&gt; [InstantiatedModule]
</span><a href="GHC.Unit.State.html#requirementMerges"><span class="hs-identifier hs-var hs-var">requirementMerges</span></a></span></span><span> </span><span id="local-6989586621681681043"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681043"><span class="hs-identifier hs-var">pkgstate</span></a></span></span><span> </span><span id="local-6989586621681681044"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681044"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2102"></span><span>    </span><span class="annot"><span class="annottext">[InstantiatedModule]
-&gt; Maybe [InstantiatedModule] -&gt; [InstantiatedModule]
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
-&gt; Map ModuleName [InstantiatedModule]
-&gt; Maybe [InstantiatedModule]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681044"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; Map ModuleName [InstantiatedModule]
</span><a href="GHC.Unit.State.html#requirementContext"><span class="hs-identifier hs-var">requirementContext</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681043"><span class="hs-identifier hs-var">pkgstate</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2103"></span><span>
</span><span id="line-2104"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2105"></span><span>
</span><span id="line-2106"></span><span class="hs-comment">-- | Pretty-print a UnitId for the user.</span><span>
</span><span id="line-2107"></span><span class="hs-comment">--</span><span>
</span><span id="line-2108"></span><span class="hs-comment">-- Cabal packages may contain several components (programs, libraries, etc.).</span><span>
</span><span id="line-2109"></span><span class="hs-comment">-- As far as GHC is concerned, installed package components (&quot;units&quot;) are</span><span>
</span><span id="line-2110"></span><span class="hs-comment">-- identified by an opaque UnitId string provided by Cabal. As the string</span><span>
</span><span id="line-2111"></span><span class="hs-comment">-- contains a hash, we don't want to display it to users so GHC queries the</span><span>
</span><span id="line-2112"></span><span class="hs-comment">-- database to retrieve some infos about the original source package (name,</span><span>
</span><span id="line-2113"></span><span class="hs-comment">-- version, component name).</span><span>
</span><span id="line-2114"></span><span class="hs-comment">--</span><span>
</span><span id="line-2115"></span><span class="hs-comment">-- Instead we want to display: packagename-version[:componentname]</span><span>
</span><span id="line-2116"></span><span class="hs-comment">--</span><span>
</span><span id="line-2117"></span><span class="hs-comment">-- Component name is only displayed if it isn't the default library</span><span>
</span><span id="line-2118"></span><span class="hs-comment">--</span><span>
</span><span id="line-2119"></span><span class="hs-comment">-- To do this we need to query a unit database.</span><span>
</span><span id="line-2120"></span><span class="annot"><a href="GHC.Unit.State.html#pprUnitIdForUser"><span class="hs-identifier hs-type">pprUnitIdForUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2121"></span><span id="pprUnitIdForUser"><span class="annot"><span class="annottext">pprUnitIdForUser :: UnitState -&gt; UnitId -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnitIdForUser"><span class="hs-identifier hs-var hs-var">pprUnitIdForUser</span></a></span></span><span> </span><span id="local-6989586621681681046"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681046"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681681047"><span class="annot"><span class="annottext">uid :: UnitId
</span><a href="#local-6989586621681681047"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span id="local-6989586621681681048"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681681048"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2122"></span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; Maybe UnitPprInfo
</span><a href="GHC.Unit.State.html#lookupUnitPprInfo"><span class="hs-identifier hs-var">lookupUnitPprInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681046"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681047"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2123"></span><span>      </span><span class="annot"><span class="annottext">Maybe UnitPprInfo
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SDoc
forall doc. IsLine doc =&gt; FastString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681681048"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-comment">-- we didn't find the unit at all</span><span>
</span><span id="line-2124"></span><span>      </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681681050"><span class="annot"><span class="annottext">UnitPprInfo
</span><a href="#local-6989586621681681050"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitPprInfo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitPprInfo
</span><a href="#local-6989586621681681050"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2125"></span><span>
</span><span id="line-2126"></span><span class="annot"><a href="GHC.Unit.State.html#pprUnitInfoForUser"><span class="hs-identifier hs-type">pprUnitInfoForUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2127"></span><span id="pprUnitInfoForUser"><span class="annot"><span class="annottext">pprUnitInfoForUser :: UnitInfo -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnitInfoForUser"><span class="hs-identifier hs-var hs-var">pprUnitInfoForUser</span></a></span></span><span> </span><span id="local-6989586621681681051"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681681051"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitPprInfo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; FastString) -&gt; UnitInfo -&gt; UnitPprInfo
forall u. (u -&gt; FastString) -&gt; GenUnitInfo u -&gt; UnitPprInfo
</span><a href="GHC.Unit.Info.html#mkUnitPprInfo"><span class="hs-identifier hs-var">mkUnitPprInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; FastString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681681051"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2128"></span><span>
</span><span id="line-2129"></span><span class="annot"><a href="GHC.Unit.State.html#lookupUnitPprInfo"><span class="hs-identifier hs-type">lookupUnitPprInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Ppr.html#UnitPprInfo"><span class="hs-identifier hs-type">UnitPprInfo</span></a></span><span>
</span><span id="line-2130"></span><span id="lookupUnitPprInfo"><span class="annot"><span class="annottext">lookupUnitPprInfo :: UnitState -&gt; UnitId -&gt; Maybe UnitPprInfo
</span><a href="GHC.Unit.State.html#lookupUnitPprInfo"><span class="hs-identifier hs-var hs-var">lookupUnitPprInfo</span></a></span></span><span> </span><span id="local-6989586621681681053"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681053"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681681054"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681054"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitPprInfo) -&gt; Maybe UnitInfo -&gt; Maybe UnitPprInfo
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; FastString) -&gt; UnitInfo -&gt; UnitPprInfo
forall u. (u -&gt; FastString) -&gt; GenUnitInfo u -&gt; UnitPprInfo
</span><a href="GHC.Unit.Info.html#mkUnitPprInfo"><span class="hs-identifier hs-var">mkUnitPprInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; FastString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId"><span class="hs-identifier hs-var">lookupUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681053"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681054"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2133"></span><span class="hs-comment">-- Displaying packages</span><span>
</span><span id="line-2134"></span><span>
</span><span id="line-2135"></span><span class="annot"><span class="hs-comment">-- | Show (very verbose) package info</span></span><span>
</span><span id="line-2136"></span><span class="annot"><a href="GHC.Unit.State.html#pprUnits"><span class="hs-identifier hs-type">pprUnits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2137"></span><span id="pprUnits"><span class="annot"><span class="annottext">pprUnits :: UnitState -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnits"><span class="hs-identifier hs-var hs-var">pprUnits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; SDoc) -&gt; UnitState -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnitsWith"><span class="hs-identifier hs-var">pprUnitsWith</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; SDoc
</span><a href="GHC.Unit.Info.html#pprUnitInfo"><span class="hs-identifier hs-var">pprUnitInfo</span></a></span><span>
</span><span id="line-2138"></span><span>
</span><span id="line-2139"></span><span class="annot"><a href="GHC.Unit.State.html#pprUnitsWith"><span class="hs-identifier hs-type">pprUnitsWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2140"></span><span id="pprUnitsWith"><span class="annot"><span class="annottext">pprUnitsWith :: (UnitInfo -&gt; SDoc) -&gt; UnitState -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnitsWith"><span class="hs-identifier hs-var hs-var">pprUnitsWith</span></a></span></span><span> </span><span id="local-6989586621681681057"><span class="annot"><span class="annottext">UnitInfo -&gt; SDoc
</span><a href="#local-6989586621681681057"><span class="hs-identifier hs-var">pprIPI</span></a></span></span><span> </span><span id="local-6989586621681681058"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681058"><span class="hs-identifier hs-var">pkgstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2141"></span><span>    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#intersperse/Data.OldList.html#intersperse"><span class="hs-identifier hs-var">intersperse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;---&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitInfo -&gt; SDoc) -&gt; [UnitInfo] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; SDoc
</span><a href="#local-6989586621681681057"><span class="hs-identifier hs-var">pprIPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; [UnitInfo]
</span><a href="GHC.Unit.State.html#listUnitInfo"><span class="hs-identifier hs-var">listUnitInfo</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681058"><span class="hs-identifier hs-var">pkgstate</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2142"></span><span>
</span><span id="line-2143"></span><span class="hs-comment">-- | Show simplified unit info.</span><span>
</span><span id="line-2144"></span><span class="hs-comment">--</span><span>
</span><span id="line-2145"></span><span class="hs-comment">-- The idea is to only print package id, and any information that might</span><span>
</span><span id="line-2146"></span><span class="hs-comment">-- be different from the package databases (exposure, trust)</span><span>
</span><span id="line-2147"></span><span class="annot"><a href="GHC.Unit.State.html#pprUnitsSimple"><span class="hs-identifier hs-type">pprUnitsSimple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2148"></span><span id="pprUnitsSimple"><span class="annot"><span class="annottext">pprUnitsSimple :: UnitState -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnitsSimple"><span class="hs-identifier hs-var hs-var">pprUnitsSimple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; SDoc) -&gt; UnitState -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnitsWith"><span class="hs-identifier hs-var">pprUnitsWith</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; SDoc
forall {doc} {srcpkgid} {srcpkgname} {modulename} {mod}.
IsLine doc =&gt;
GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod -&gt; doc
</span><a href="#local-6989586621681681059"><span class="hs-identifier hs-var">pprIPI</span></a></span><span>
</span><span id="line-2149"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681681059"><span class="annot"><span class="annottext">pprIPI :: GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod -&gt; doc
</span><a href="#local-6989586621681681059"><span class="hs-identifier hs-var hs-var">pprIPI</span></a></span></span><span> </span><span id="local-6989586621681681073"><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681681073"><span class="hs-identifier hs-var">ipi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681681074"><span class="annot"><span class="annottext">i :: FastString
</span><a href="#local-6989586621681681074"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; FastString
</span><a href="GHC.Unit.Types.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681681073"><span class="hs-identifier hs-var">ipi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2150"></span><span>                           </span><span id="local-6989586621681681075"><span class="annot"><span class="annottext">e :: doc
</span><a href="#local-6989586621681681075"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod -&gt; Bool
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Bool
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIsExposed/GHC.Unit.Database.html#unitIsExposed"><span class="hs-identifier hs-var">unitIsExposed</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681681073"><span class="hs-identifier hs-var">ipi</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;E&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-2151"></span><span>                           </span><span id="local-6989586621681681076"><span class="annot"><span class="annottext">t :: doc
</span><a href="#local-6989586621681681076"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod -&gt; Bool
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Bool
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitIsTrusted/GHC.Unit.Database.html#unitIsTrusted"><span class="hs-identifier hs-var">unitIsTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo srcpkgid srcpkgname UnitId modulename mod
</span><a href="#local-6989586621681681073"><span class="hs-identifier hs-var">ipi</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;T&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-2152"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">doc
</span><a href="#local-6989586621681681075"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">doc -&gt; doc -&gt; doc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">doc
</span><a href="#local-6989586621681681076"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">doc -&gt; doc -&gt; doc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; doc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &quot;</span></span><span> </span><span class="annot"><span class="annottext">doc -&gt; doc -&gt; doc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; doc
forall doc. IsLine doc =&gt; FastString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681681074"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2153"></span><span>
</span><span id="line-2154"></span><span class="annot"><span class="hs-comment">-- | Show the mapping of modules to where they come from.</span></span><span>
</span><span id="line-2155"></span><span class="annot"><a href="GHC.Unit.State.html#pprModuleMap"><span class="hs-identifier hs-type">pprModuleMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ModuleNameProvidersMap"><span class="hs-identifier hs-type">ModuleNameProvidersMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2156"></span><span id="pprModuleMap"><span class="annot"><span class="annottext">pprModuleMap :: ModuleNameProvidersMap -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprModuleMap"><span class="hs-identifier hs-var hs-var">pprModuleMap</span></a></span></span><span> </span><span id="local-6989586621681681077"><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681681077"><span class="hs-identifier hs-var">mod_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2157"></span><span>  </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ModuleName, Map Module ModuleOrigin) -&gt; SDoc)
-&gt; [(ModuleName, Map Module ModuleOrigin)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, Map Module ModuleOrigin) -&gt; SDoc
forall {a}. Outputable a =&gt; (ModuleName, Map Module a) -&gt; SDoc
</span><a href="#local-6989586621681681078"><span class="hs-identifier hs-var">pprLine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameProvidersMap -&gt; [(ModuleName, Map Module ModuleOrigin)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameProvidersMap
</span><a href="#local-6989586621681681077"><span class="hs-identifier hs-var">mod_map</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2158"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2159"></span><span>      </span><span id="local-6989586621681681078"><span class="annot"><span class="annottext">pprLine :: (ModuleName, Map Module a) -&gt; SDoc
</span><a href="#local-6989586621681681078"><span class="hs-identifier hs-var hs-var">pprLine</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681681084"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681084"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681681085"><span class="annot"><span class="annottext">Map Module a
</span><a href="#local-6989586621681681085"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681084"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">50</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Module, a) -&gt; SDoc) -&gt; [(Module, a)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; (Module, a) -&gt; SDoc
forall a. Outputable a =&gt; ModuleName -&gt; (Module, a) -&gt; SDoc
</span><a href="#local-6989586621681681086"><span class="hs-identifier hs-var">pprEntry</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681084"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Module a -&gt; [(Module, a)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Module a
</span><a href="#local-6989586621681681085"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>      </span><span id="local-6989586621681679353"><span class="annot"><a href="#local-6989586621681681086"><span class="hs-identifier hs-type">pprEntry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681679353"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681679353"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-2161"></span><span>      </span><span id="local-6989586621681681086"><span class="annot"><span class="annottext">pprEntry :: forall a. Outputable a =&gt; ModuleName -&gt; (Module, a) -&gt; SDoc
</span><a href="#local-6989586621681681086"><span class="hs-identifier hs-var hs-var">pprEntry</span></a></span></span><span> </span><span id="local-6989586621681681099"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681099"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681681100"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681100"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681681101"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681681101"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681099"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681100"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681100"><span class="hs-identifier hs-var">m'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681681101"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2163"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681100"><span class="hs-identifier hs-var">m'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681681101"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2164"></span><span>
</span><span id="line-2165"></span><span class="annot"><a href="GHC.Unit.State.html#fsPackageName"><span class="hs-identifier hs-type">fsPackageName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-2166"></span><span id="fsPackageName"><span class="annot"><span class="annottext">fsPackageName :: UnitInfo -&gt; FastString
</span><a href="GHC.Unit.State.html#fsPackageName"><span class="hs-identifier hs-var hs-var">fsPackageName</span></a></span></span><span> </span><span id="local-6989586621681681102"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681681102"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681681103"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-2167"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-2168"></span><span>      </span><span class="annot"><a href="GHC.Unit.Info.html#PackageName"><span class="hs-identifier hs-type">PackageName</span></a></span><span> </span><span id="local-6989586621681681103"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681681103"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; PackageName
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; srcpkgname
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitPackageName/GHC.Unit.Database.html#unitPackageName"><span class="hs-identifier hs-var">unitPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681681102"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-2169"></span><span>
</span><span id="line-2170"></span><span>
</span><span id="line-2171"></span><span class="hs-comment">-- | Given a fully instantiated 'InstantiatedUnit', improve it into a</span><span>
</span><span id="line-2172"></span><span class="hs-comment">-- 'RealUnit' if we can find it in the package database.</span><span>
</span><span id="line-2173"></span><span class="annot"><a href="GHC.Unit.State.html#improveUnit"><span class="hs-identifier hs-type">improveUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-2174"></span><span id="improveUnit"><span class="annot"><span class="annottext">improveUnit :: UnitState -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#improveUnit"><span class="hs-identifier hs-var hs-var">improveUnit</span></a></span></span><span> </span><span id="local-6989586621681681106"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681106"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681681107"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681107"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#improveUnit%27"><span class="hs-identifier hs-var">improveUnit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681106"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PreloadUnitClosure
</span><a href="GHC.Unit.State.html#preloadClosure"><span class="hs-identifier hs-var">preloadClosure</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681106"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681107"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-2175"></span><span>
</span><span id="line-2176"></span><span class="hs-comment">-- | Given a fully instantiated 'InstantiatedUnit', improve it into a</span><span>
</span><span id="line-2177"></span><span class="hs-comment">-- 'RealUnit' if we can find it in the package database.</span><span>
</span><span id="line-2178"></span><span class="annot"><a href="GHC.Unit.State.html#improveUnit%27"><span class="hs-identifier hs-type">improveUnit'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-2179"></span><span id="improveUnit%27"><span class="annot"><span class="annottext">improveUnit' :: UnitInfoMap
-&gt; PreloadUnitClosure -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#improveUnit%27"><span class="hs-identifier hs-var hs-var">improveUnit'</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><span class="hs-identifier">_</span></span><span>       </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><span class="hs-identifier">_</span></span><span>       </span><span id="local-6989586621681681109"><span class="annot"><span class="annottext">uid :: GenUnit UnitId
</span><a href="#local-6989586621681681109"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Definite UnitId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681109"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-comment">-- short circuit</span><span>
</span><span id="line-2180"></span><span class="annot"><a href="GHC.Unit.State.html#improveUnit%27"><span class="hs-identifier hs-var">improveUnit'</span></a></span><span> </span><span id="local-6989586621681681110"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681681110"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681681111"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681111"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681681112"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681112"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2181"></span><span>    </span><span class="hs-comment">-- Do NOT lookup indefinite ones, they won't be useful!</span><span>
</span><span id="line-2182"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; GenUnit UnitId
-&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit%27"><span class="hs-identifier hs-var">lookupUnit'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681681110"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681111"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681112"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2183"></span><span>        </span><span class="annot"><span class="annottext">Maybe UnitInfo
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681112"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-2184"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681681113"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681681113"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2185"></span><span>            </span><span class="hs-comment">-- Do NOT improve if the indefinite unit id is not</span><span>
</span><span id="line-2186"></span><span>            </span><span class="hs-comment">-- part of the closure unique set.  See</span><span>
</span><span id="line-2187"></span><span>            </span><span class="hs-comment">-- Note [VirtUnit to RealUnit improvement]</span><span>
</span><span id="line-2188"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.7/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681681113"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; PreloadUnitClosure -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681111"><span class="hs-identifier hs-var">closure</span></a></span><span>
</span><span id="line-2189"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; GenUnit UnitId
</span><a href="GHC.Unit.Info.html#mkUnit"><span class="hs-identifier hs-var">mkUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681681113"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-2190"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681112"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-2191"></span><span>
</span><span id="line-2192"></span><span class="hs-comment">-- | Check the database to see if we already have an installed unit that</span><span>
</span><span id="line-2193"></span><span class="hs-comment">-- corresponds to the given 'InstantiatedUnit'.</span><span>
</span><span id="line-2194"></span><span class="hs-comment">--</span><span>
</span><span id="line-2195"></span><span class="hs-comment">-- Return a `UnitId` which either wraps the `InstantiatedUnit` unchanged or</span><span>
</span><span id="line-2196"></span><span class="hs-comment">-- references a matching installed unit.</span><span>
</span><span id="line-2197"></span><span class="hs-comment">--</span><span>
</span><span id="line-2198"></span><span class="hs-comment">-- See Note [VirtUnit to RealUnit improvement]</span><span>
</span><span id="line-2199"></span><span class="annot"><a href="GHC.Unit.State.html#instUnitToUnit"><span class="hs-identifier hs-type">instUnitToUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedUnit"><span class="hs-identifier hs-type">InstantiatedUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-2200"></span><span id="instUnitToUnit"><span class="annot"><span class="annottext">instUnitToUnit :: UnitState -&gt; GenInstantiatedUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#instUnitToUnit"><span class="hs-identifier hs-var hs-var">instUnitToUnit</span></a></span></span><span> </span><span id="local-6989586621681681115"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681115"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621681681116"><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681681116"><span class="hs-identifier hs-var">iuid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2201"></span><span>    </span><span class="hs-comment">-- NB: suppose that we want to compare the instantiated</span><span>
</span><span id="line-2202"></span><span>    </span><span class="hs-comment">-- unit p[H=impl:H] against p+abcd (where p+abcd</span><span>
</span><span id="line-2203"></span><span>    </span><span class="hs-comment">-- happens to be the existing, installed version of</span><span>
</span><span id="line-2204"></span><span>    </span><span class="hs-comment">-- p[H=impl:H].  If we *only* wrap in p[H=impl:H]</span><span>
</span><span id="line-2205"></span><span>    </span><span class="hs-comment">-- VirtUnit, they won't compare equal; only</span><span>
</span><span id="line-2206"></span><span>    </span><span class="hs-comment">-- after improvement will the equality hold.</span><span>
</span><span id="line-2207"></span><span>    </span><span class="annot"><span class="annottext">UnitState -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#improveUnit"><span class="hs-identifier hs-var">improveUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681115"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; GenUnit UnitId)
-&gt; GenUnit UnitId -&gt; GenUnit UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId -&gt; GenUnit UnitId
forall uid. GenInstantiatedUnit uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-var">VirtUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681681116"><span class="hs-identifier hs-var">iuid</span></a></span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span>
</span><span id="line-2210"></span><span class="hs-comment">-- | Substitution on module variables, mapping module names to module</span><span>
</span><span id="line-2211"></span><span class="hs-comment">-- identifiers.</span><span>
</span><span id="line-2212"></span><span class="hs-keyword">type</span><span> </span><span id="ShHoleSubst"><span class="annot"><a href="GHC.Unit.State.html#ShHoleSubst"><span class="hs-identifier hs-var">ShHoleSubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Env.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2213"></span><span>
</span><span id="line-2214"></span><span class="hs-comment">-- | Substitutes holes in a 'Module'.  NOT suitable for being called</span><span>
</span><span id="line-2215"></span><span class="hs-comment">-- directly on a 'nameModule', see Note [Representation of module/name variables].</span><span>
</span><span id="line-2216"></span><span class="hs-comment">-- @p[A=\&lt;A&gt;]:B@ maps to @p[A=q():A]:B@ with @A=q():A@;</span><span>
</span><span id="line-2217"></span><span class="hs-comment">-- similarly, @\&lt;A&gt;@ maps to @q():A@.</span><span>
</span><span id="line-2218"></span><span class="annot"><a href="GHC.Unit.State.html#renameHoleModule"><span class="hs-identifier hs-type">renameHoleModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2219"></span><span id="renameHoleModule"><span class="annot"><span class="annottext">renameHoleModule :: UnitState -&gt; UniqFM ModuleName Module -&gt; Module -&gt; Module
</span><a href="GHC.Unit.State.html#renameHoleModule"><span class="hs-identifier hs-var hs-var">renameHoleModule</span></a></span></span><span> </span><span id="local-6989586621681681118"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681118"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UniqFM ModuleName Module
-&gt; Module
-&gt; Module
</span><a href="GHC.Unit.State.html#renameHoleModule%27"><span class="hs-identifier hs-var">renameHoleModule'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681118"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PreloadUnitClosure
</span><a href="GHC.Unit.State.html#preloadClosure"><span class="hs-identifier hs-var">preloadClosure</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681118"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2220"></span><span>
</span><span id="line-2221"></span><span class="hs-comment">-- | Substitutes holes in a 'Unit', suitable for renaming when</span><span>
</span><span id="line-2222"></span><span class="hs-comment">-- an include occurs; see Note [Representation of module/name variables].</span><span>
</span><span id="line-2223"></span><span class="hs-comment">--</span><span>
</span><span id="line-2224"></span><span class="hs-comment">-- @p[A=\&lt;A&gt;]@ maps to @p[A=\&lt;B&gt;]@ with @A=\&lt;B&gt;@.</span><span>
</span><span id="line-2225"></span><span class="annot"><a href="GHC.Unit.State.html#renameHoleUnit"><span class="hs-identifier hs-type">renameHoleUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-2226"></span><span id="renameHoleUnit"><span class="annot"><span class="annottext">renameHoleUnit :: UnitState
-&gt; UniqFM ModuleName Module -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#renameHoleUnit"><span class="hs-identifier hs-var hs-var">renameHoleUnit</span></a></span></span><span> </span><span id="local-6989586621681681119"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681119"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UniqFM ModuleName Module
-&gt; GenUnit UnitId
-&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#renameHoleUnit%27"><span class="hs-identifier hs-var">renameHoleUnit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfoMap
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681119"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PreloadUnitClosure
</span><a href="GHC.Unit.State.html#preloadClosure"><span class="hs-identifier hs-var">preloadClosure</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681119"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span>
</span><span id="line-2228"></span><span class="hs-comment">-- | Like 'renameHoleModule', but requires only 'ClosureUnitInfoMap'</span><span>
</span><span id="line-2229"></span><span class="hs-comment">-- so it can be used by &quot;GHC.Unit.State&quot;.</span><span>
</span><span id="line-2230"></span><span class="annot"><a href="GHC.Unit.State.html#renameHoleModule%27"><span class="hs-identifier hs-type">renameHoleModule'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2231"></span><span id="renameHoleModule%27"><span class="annot"><span class="annottext">renameHoleModule' :: UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UniqFM ModuleName Module
-&gt; Module
-&gt; Module
</span><a href="GHC.Unit.State.html#renameHoleModule%27"><span class="hs-identifier hs-var hs-var">renameHoleModule'</span></a></span></span><span> </span><span id="local-6989586621681681120"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681681120"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681681121"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681121"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681681122"><span class="annot"><span class="annottext">UniqFM ModuleName Module
</span><a href="#local-6989586621681681122"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681681123"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681123"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-2232"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Bool
forall u. GenModule (GenUnit u) -&gt; Bool
</span><a href="GHC.Unit.Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681123"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2233"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681681124"><span class="annot"><span class="annottext">uid :: GenUnit UnitId
</span><a href="#local-6989586621681681124"><span class="hs-identifier hs-var hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UniqFM ModuleName Module
-&gt; GenUnit UnitId
-&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#renameHoleUnit%27"><span class="hs-identifier hs-var">renameHoleUnit'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681681120"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681121"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName Module
</span><a href="#local-6989586621681681122"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681123"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2234"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; ModuleName -&gt; Module
forall unit. unit -&gt; ModuleName -&gt; GenModule unit
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681124"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681123"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2235"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681681125"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681125"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName Module -&gt; ModuleName -&gt; Maybe Module
forall key elt. Uniquable key =&gt; UniqFM key elt -&gt; key -&gt; Maybe elt
</span><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName Module
</span><a href="#local-6989586621681681122"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681123"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681125"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-2236"></span><span>  </span><span class="hs-comment">-- NB m = &lt;Blah&gt;, that's what's in scope.</span><span>
</span><span id="line-2237"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681123"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2238"></span><span>
</span><span id="line-2239"></span><span class="hs-comment">-- | Like 'renameHoleUnit, but requires only 'ClosureUnitInfoMap'</span><span>
</span><span id="line-2240"></span><span class="hs-comment">-- so it can be used by &quot;GHC.Unit.State&quot;.</span><span>
</span><span id="line-2241"></span><span class="annot"><a href="GHC.Unit.State.html#renameHoleUnit%27"><span class="hs-identifier hs-type">renameHoleUnit'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitInfoMap"><span class="hs-identifier hs-type">UnitInfoMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#PreloadUnitClosure"><span class="hs-identifier hs-type">PreloadUnitClosure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-2242"></span><span id="renameHoleUnit%27"><span class="annot"><span class="annottext">renameHoleUnit' :: UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UniqFM ModuleName Module
-&gt; GenUnit UnitId
-&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#renameHoleUnit%27"><span class="hs-identifier hs-var hs-var">renameHoleUnit'</span></a></span></span><span> </span><span id="local-6989586621681681126"><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681681126"><span class="hs-identifier hs-var">pkg_map</span></a></span></span><span> </span><span id="local-6989586621681681127"><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681127"><span class="hs-identifier hs-var">closure</span></a></span></span><span> </span><span id="local-6989586621681681128"><span class="annot"><span class="annottext">UniqFM ModuleName Module
</span><a href="#local-6989586621681681128"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681681129"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681129"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2243"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681129"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2244"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span>
</span><span id="line-2245"></span><span>        </span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedUnit"><span class="hs-identifier hs-type">InstantiatedUnit</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">instUnitInstanceOf :: forall unit. GenInstantiatedUnit unit -&gt; unit
</span><a href="GHC.Unit.Types.html#instUnitInstanceOf"><span class="hs-identifier hs-var">instUnitInstanceOf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681681130"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681130"><span class="hs-identifier hs-var">cid</span></a></span></span><span>
</span><span id="line-2246"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">instUnitInsts :: forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var">instUnitInsts</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681681131"><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681681131"><span class="hs-identifier hs-var">insts</span></a></span></span><span>
</span><span id="line-2247"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">instUnitHoles :: forall unit. GenInstantiatedUnit unit -&gt; UniqDSet ModuleName
</span><a href="GHC.Unit.Types.html#instUnitHoles"><span class="hs-identifier hs-var">instUnitHoles</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681681133"><span class="annot"><span class="annottext">UniqDSet ModuleName
</span><a href="#local-6989586621681681133"><span class="hs-identifier hs-var">fh</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2248"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName ModuleName -&gt; Bool
forall key elt. UniqFM key elt -&gt; Bool
</span><a href="GHC.Types.Unique.FM.html#isNullUFM"><span class="hs-identifier hs-var">isNullUFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; Module -&gt; ModuleName)
-&gt; UniqFM ModuleName ModuleName
-&gt; UniqFM ModuleName Module
-&gt; UniqFM ModuleName ModuleName
forall elt1 elt2 elt3 key.
(elt1 -&gt; elt2 -&gt; elt3)
-&gt; UniqFM key elt1 -&gt; UniqFM key elt2 -&gt; UniqFM key elt3
</span><a href="GHC.Types.Unique.FM.html#intersectUFM_C"><span class="hs-identifier hs-var">intersectUFM_C</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Module -&gt; ModuleName
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDFM ModuleName ModuleName -&gt; UniqFM ModuleName ModuleName
forall key elt. UniqDFM key elt -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.DFM.html#udfmToUfm"><span class="hs-identifier hs-var">udfmToUfm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqDSet ModuleName -&gt; UniqDFM ModuleName ModuleName
forall a. UniqDSet a -&gt; UniqDFM a a
</span><a href="GHC.Types.Unique.DSet.html#getUniqDSet"><span class="hs-identifier hs-var">getUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet ModuleName
</span><a href="#local-6989586621681681133"><span class="hs-identifier hs-var">fh</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName Module
</span><a href="#local-6989586621681681128"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2249"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681129"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-2250"></span><span>                </span><span class="hs-comment">-- Functorially apply the substitution to the instantiation,</span><span>
</span><span id="line-2251"></span><span>                </span><span class="hs-comment">-- then check the 'ClosureUnitInfoMap' to see if there is</span><span>
</span><span id="line-2252"></span><span>                </span><span class="hs-comment">-- a compiled version of this 'InstantiatedUnit' we can improve to.</span><span>
</span><span id="line-2253"></span><span>                </span><span class="hs-comment">-- See Note [VirtUnit to RealUnit improvement]</span><span>
</span><span id="line-2254"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#improveUnit%27"><span class="hs-identifier hs-var">improveUnit'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681681126"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681127"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; GenUnit UnitId)
-&gt; GenUnit UnitId -&gt; GenUnit UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2255"></span><span>                        </span><span class="annot"><span class="annottext">UnitId -&gt; [(ModuleName, Module)] -&gt; GenUnit UnitId
forall u.
IsUnitId u =&gt;
u -&gt; [(ModuleName, GenModule (GenUnit u))] -&gt; GenUnit u
</span><a href="GHC.Unit.Types.html#mkVirtUnit"><span class="hs-identifier hs-var">mkVirtUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681681130"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-2256"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ModuleName, Module) -&gt; (ModuleName, Module))
-&gt; [(ModuleName, Module)] -&gt; [(ModuleName, Module)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681681139"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681139"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681681140"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681140"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681139"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
-&gt; PreloadUnitClosure
-&gt; UniqFM ModuleName Module
-&gt; Module
-&gt; Module
</span><a href="GHC.Unit.State.html#renameHoleModule%27"><span class="hs-identifier hs-var">renameHoleModule'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfoMap
</span><a href="#local-6989586621681681126"><span class="hs-identifier hs-var">pkg_map</span></a></span><span> </span><span class="annot"><span class="annottext">PreloadUnitClosure
</span><a href="#local-6989586621681681127"><span class="hs-identifier hs-var">closure</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName Module
</span><a href="#local-6989586621681681128"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681681140"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, Module)]
</span><a href="#local-6989586621681681131"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2257"></span><span>      </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681681129"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-2258"></span><span>
</span><span id="line-2259"></span><span class="hs-comment">-- | Injects an 'InstantiatedModule' to 'Module' (see also</span><span>
</span><span id="line-2260"></span><span class="hs-comment">-- 'instUnitToUnit'.</span><span>
</span><span id="line-2261"></span><span class="annot"><a href="GHC.Unit.State.html#instModuleToModule"><span class="hs-identifier hs-type">instModuleToModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedModule"><span class="hs-identifier hs-type">InstantiatedModule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2262"></span><span id="instModuleToModule"><span class="annot"><span class="annottext">instModuleToModule :: UnitState -&gt; InstantiatedModule -&gt; Module
</span><a href="GHC.Unit.State.html#instModuleToModule"><span class="hs-identifier hs-var hs-var">instModuleToModule</span></a></span></span><span> </span><span id="local-6989586621681681141"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681141"><span class="hs-identifier hs-var">pkgstate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span id="local-6989586621681681142"><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681681142"><span class="hs-identifier hs-var">iuid</span></a></span></span><span> </span><span id="local-6989586621681681143"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681143"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2263"></span><span>    </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; ModuleName -&gt; Module
forall unit. unit -&gt; ModuleName -&gt; GenModule unit
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; GenInstantiatedUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#instUnitToUnit"><span class="hs-identifier hs-var">instUnitToUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681141"><span class="hs-identifier hs-var">pkgstate</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit UnitId
</span><a href="#local-6989586621681681142"><span class="hs-identifier hs-var">iuid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681681143"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-2264"></span><span>
</span><span id="line-2265"></span><span class="annot"><span class="hs-comment">-- | Print unit-ids with UnitInfo found in the given UnitState</span></span><span>
</span><span id="line-2266"></span><span class="annot"><a href="GHC.Unit.State.html#pprWithUnitState"><span class="hs-identifier hs-type">pprWithUnitState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2267"></span><span id="pprWithUnitState"><span class="annot"><span class="annottext">pprWithUnitState :: UnitState -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprWithUnitState"><span class="hs-identifier hs-var hs-var">pprWithUnitState</span></a></span></span><span> </span><span id="local-6989586621681681144"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681144"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDocContext -&gt; SDocContext) -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#updSDocContext"><span class="hs-identifier hs-var">updSDocContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681681145"><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621681681145"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="#local-6989586621681681145"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2268"></span><span>   </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#sdocUnitIdForUser"><span class="hs-identifier hs-var">sdocUnitIdForUser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681681147"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681681147"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; SDoc
</span><a href="GHC.Unit.State.html#pprUnitIdForUser"><span class="hs-identifier hs-var">pprUnitIdForUser</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681681144"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; UnitId
</span><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-var">UnitId</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681681147"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2269"></span><span>   </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2270"></span><span>
</span><span id="line-2271"></span><span class="annot"><span class="hs-comment">-- | Add package dependencies on the wired-in packages we use</span></span><span>
</span><span id="line-2272"></span><span class="annot"><a href="GHC.Unit.State.html#implicitPackageDeps"><span class="hs-identifier hs-type">implicitPackageDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2273"></span><span id="implicitPackageDeps"><span class="annot"><span class="annottext">implicitPackageDeps :: DynFlags -&gt; [UnitId]
</span><a href="GHC.Unit.State.html#implicitPackageDeps"><span class="hs-identifier hs-var hs-var">implicitPackageDeps</span></a></span></span><span> </span><span id="local-6989586621681681148"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681681148"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-2274"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#thUnitId"><span class="hs-identifier hs-var">thUnitId</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">TemplateHaskellQuotes</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681681148"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2275"></span><span>   </span><span class="hs-comment">-- TODO: Should also include `base` and `ghc-prim` if we use those implicitly, but</span><span>
</span><span id="line-2276"></span><span>   </span><span class="hs-comment">-- it is possible to not depend on base (for example, see `ghc-prim`)</span><span>
</span><span id="line-2277"></span><span>
</span><span id="line-2278"></span></pre></body></html>