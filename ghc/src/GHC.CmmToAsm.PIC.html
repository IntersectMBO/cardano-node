<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
  This module handles generation of position independent code and
  dynamic-linking related issues for the native code generator.

  This depends on both the architecture and OS, so we define it here
  instead of in one of the architecture specific modules.

  Things outside this module which are related to this:

  + module CLabel
    - PIC base label (pretty printed as local label 1)
    - DynamicLinkerLabels - several kinds:
        CodeStub, SymbolPtr, GotSymbolPtr, GotSymbolOffset
    - labelDynamic predicate
  + module Cmm
    - The GlobalReg datatype has a PicBaseReg constructor
    - The CmmLit datatype has a CmmLabelDiffOff constructor
  + codeGen &amp; RTS
    - When tablesNextToCode, no absolute addresses are stored in info tables
      any more. Instead, offsets from the info label are used.
    - For Win32 only, SRTs might contain addresses of __imp_ symbol pointers
      because Win32 doesn't support external references in data sections.
      TODO: make sure this still works, it might be bitrotted
  + NCG
    - The cmmToCmm pass in AsmCodeGen calls cmmMakeDynamicReference for all
      labels.
    - nativeCodeGen calls pprImportedSymbol and pprGotDeclaration to output
      all the necessary stuff for imported symbols.
    - The NCG monad keeps track of a list of imported symbols.
    - MachCodeGen invokes initializePicBase to generate code to initialize
      the PIC base register when needed.
    - MachCodeGen calls cmmMakeDynamicReference whenever it uses a CLabel
      that wasn't in the original Cmm code (e.g. floating point literals).
-}</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.CmmToAsm.PIC</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#cmmMakeDynamicReference"><span class="hs-identifier">cmmMakeDynamicReference</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#CmmMakeDynamicReferenceM"><span class="hs-identifier">CmmMakeDynamicReferenceM</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#ReferenceKind"><span class="hs-identifier">ReferenceKind</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#needImportedSymbols"><span class="hs-identifier">needImportedSymbols</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#pprImportedSymbol"><span class="hs-identifier">pprImportedSymbol</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#pprGotDeclaration"><span class="hs-identifier">pprGotDeclaration</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#initializePicBase_ppc"><span class="hs-identifier">initializePicBase_ppc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#initializePicBase_x86"><span class="hs-identifier">initializePicBase_x86</span></a></span><span>
</span><span id="line-46"></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PPC.Instr.html"><span class="hs-identifier">GHC.CmmToAsm.PPC.Instr</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPC</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PPC.Regs.html"><span class="hs-identifier">GHC.CmmToAsm.PPC.Regs</span></a></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPC</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.X86.Instr.html"><span class="hs-identifier">GHC.CmmToAsm.X86.Instr</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">X86</span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html"><span class="hs-identifier">GHC.Platform.Reg</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html"><span class="hs-identifier">GHC.CmmToAsm.Monad</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html"><span class="hs-identifier">GHC.CmmToAsm.Config</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Types.html"><span class="hs-identifier">GHC.CmmToAsm.Types</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Dataflow.Collections.html"><span class="hs-identifier">GHC.Cmm.Dataflow.Collections</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.Utils.html#cmmLoadBWord"><span class="hs-identifier">cmmLoadBWord</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- It gets called by the cmmToCmm pass for every CmmLabel in the Cmm</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- code. It does The Right Thing(tm) to convert the CmmLabel into a</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- position-independent, dynamic-linking-aware reference to the thing</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- in question.</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- Note that this also has to be called from MachCodeGen in order to</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- access static data like floating point literals (labels that were</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- created after the cmmToCmm pass).</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- The function must run in a monad that can keep track of imported symbols</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- A function for recording an imported symbol must be passed in:</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- - addImportCmmOpt for the CmmOptM monad</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- - addImportNat for the NatM monad.</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">data</span><span> </span><span id="ReferenceKind"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#ReferenceKind"><span class="hs-identifier hs-var">ReferenceKind</span></a></span></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="DataReference"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="CallReference"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a></span></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="JumpReference"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#JumpReference"><span class="hs-identifier hs-var">JumpReference</span></a></span></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span id="local-6989586621681838027"><span id="local-6989586621681838029"><span class="annot"><span class="annottext">ReferenceKind -&gt; ReferenceKind -&gt; Bool
(ReferenceKind -&gt; ReferenceKind -&gt; Bool)
-&gt; (ReferenceKind -&gt; ReferenceKind -&gt; Bool) -&gt; Eq ReferenceKind
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ReferenceKind -&gt; ReferenceKind -&gt; Bool
== :: ReferenceKind -&gt; ReferenceKind -&gt; Bool
$c/= :: ReferenceKind -&gt; ReferenceKind -&gt; Bool
/= :: ReferenceKind -&gt; ReferenceKind -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#Monad/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681837786"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="CmmMakeDynamicReferenceM"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#CmmMakeDynamicReferenceM"><span class="hs-identifier hs-var">CmmMakeDynamicReferenceM</span></a></span></span><span> </span><span id="local-6989586621681837786"><span class="annot"><a href="#local-6989586621681837786"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span id="addImport"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#addImport"><span class="hs-identifier hs-type">addImport</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681837786"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#CmmMakeDynamicReferenceM"><span class="hs-identifier hs-type">CmmMakeDynamicReferenceM</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621681838040"><span class="annot"><span class="annottext">addImport :: CLabel -&gt; NatM ()
</span><a href="GHC.CmmToAsm.PIC.html#addImport"><span class="hs-identifier hs-var hs-var hs-var hs-var">addImport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; NatM ()
</span><a href="GHC.CmmToAsm.Monad.html#addImportNat"><span class="hs-identifier hs-var">addImportNat</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span id="local-6989586621681837789"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-type">cmmMakeDynamicReference</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#CmmMakeDynamicReferenceM"><span class="hs-identifier hs-type">CmmMakeDynamicReferenceM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681837789"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#ReferenceKind"><span class="hs-identifier hs-type">ReferenceKind</span></a></span><span>     </span><span class="hs-comment">-- whether this is the target of a jump</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>            </span><span class="hs-comment">-- the label</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681837789"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span id="cmmMakeDynamicReference"><span class="annot"><span class="annottext">cmmMakeDynamicReference :: forall (m :: * -&gt; *).
CmmMakeDynamicReferenceM m =&gt;
NCGConfig -&gt; ReferenceKind -&gt; CLabel -&gt; m CmmExpr
</span><a href="GHC.CmmToAsm.PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var hs-var">cmmMakeDynamicReference</span></a></span></span><span> </span><span id="local-6989586621681838056"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838056"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838057"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838057"><span class="hs-identifier hs-var">referenceKind</span></a></span></span><span> </span><span id="local-6989586621681838058"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(DynamicLinkerLabelInfo, CLabel)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; m CmmExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; m CmmExpr) -&gt; CmmExpr -&gt; m CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span>   </span><span class="hs-comment">-- already processed it, pass through</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681838062"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681838062"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838056"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-115"></span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NCGConfig
-&gt; Arch -&gt; OS -&gt; ReferenceKind -&gt; CLabel -&gt; LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span>
</span><span id="line-116"></span><span>                </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838056"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-117"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838062"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838062"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>                </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838057"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaStub"><span class="hs-identifier hs-var">AccessViaStub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681838068"><span class="annot"><span class="annottext">stub :: CLabel
</span><a href="#local-6989586621681838068"><span class="hs-identifier hs-var hs-var">stub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkDynamicLinkerLabel"><span class="hs-identifier hs-var">mkDynamicLinkerLabel</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#CodeStub"><span class="hs-identifier hs-var">CodeStub</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-123"></span><span>              </span><span class="annot"><span class="annottext">CLabel -&gt; m ()
forall (m :: * -&gt; *). CmmMakeDynamicReferenceM m =&gt; CLabel -&gt; m ()
</span><a href="GHC.CmmToAsm.PIC.html#addImport"><span class="hs-identifier hs-var">addImport</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838068"><span class="hs-identifier hs-var">stub</span></a></span><span>
</span><span id="line-124"></span><span>              </span><span class="annot"><span class="annottext">CmmExpr -&gt; m CmmExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; m CmmExpr) -&gt; CmmExpr -&gt; m CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838068"><span class="hs-identifier hs-var">stub</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-comment">-- GOT relative loads work differently on AArch64.  We don't do two</span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-comment">-- step loads. The got symbol is loaded directly, and not through an</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-comment">-- additional load. Thus we do not need the CmmLoad decoration we have</span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-comment">-- on other platforms.</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchAArch64/GHC.Platform.ArchOS.html#ArchAArch64"><span class="hs-identifier hs-var">ArchAArch64</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838062"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681838073"><span class="annot"><span class="annottext">symbolPtr :: CLabel
</span><a href="#local-6989586621681838073"><span class="hs-identifier hs-var hs-var">symbolPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkDynamicLinkerLabel"><span class="hs-identifier hs-var">mkDynamicLinkerLabel</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#SymbolPtr"><span class="hs-identifier hs-var">SymbolPtr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-132"></span><span>              </span><span class="annot"><span class="annottext">CLabel -&gt; m ()
forall (m :: * -&gt; *). CmmMakeDynamicReferenceM m =&gt; CLabel -&gt; m ()
</span><a href="GHC.CmmToAsm.PIC.html#addImport"><span class="hs-identifier hs-var">addImport</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838073"><span class="hs-identifier hs-var">symbolPtr</span></a></span><span>
</span><span id="line-133"></span><span>              </span><span class="annot"><span class="annottext">CmmExpr -&gt; m CmmExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; m CmmExpr) -&gt; CmmExpr -&gt; m CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; CmmExpr
</span><a href="GHC.CmmToAsm.PIC.html#cmmMakePicReference"><span class="hs-identifier hs-var">cmmMakePicReference</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838056"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838073"><span class="hs-identifier hs-var">symbolPtr</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681838076"><span class="annot"><span class="annottext">symbolPtr :: CLabel
</span><a href="#local-6989586621681838076"><span class="hs-identifier hs-var hs-var">symbolPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkDynamicLinkerLabel"><span class="hs-identifier hs-var">mkDynamicLinkerLabel</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#SymbolPtr"><span class="hs-identifier hs-var">SymbolPtr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-137"></span><span>              </span><span class="annot"><span class="annottext">CLabel -&gt; m ()
forall (m :: * -&gt; *). CmmMakeDynamicReferenceM m =&gt; CLabel -&gt; m ()
</span><a href="GHC.CmmToAsm.PIC.html#addImport"><span class="hs-identifier hs-var">addImport</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838076"><span class="hs-identifier hs-var">symbolPtr</span></a></span><span>
</span><span id="line-138"></span><span>              </span><span class="annot"><span class="annottext">CmmExpr -&gt; m CmmExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; m CmmExpr) -&gt; CmmExpr -&gt; m CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#cmmLoadBWord"><span class="hs-identifier hs-var">cmmLoadBWord</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838062"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; CmmExpr
</span><a href="GHC.CmmToAsm.PIC.html#cmmMakePicReference"><span class="hs-identifier hs-var">cmmMakePicReference</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838056"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838076"><span class="hs-identifier hs-var">symbolPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838057"><span class="hs-identifier hs-var">referenceKind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>                </span><span class="hs-comment">-- for data, we might have to make some calculations:</span><span>
</span><span id="line-142"></span><span>              </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; m CmmExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; m CmmExpr) -&gt; CmmExpr -&gt; m CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; CmmExpr
</span><a href="GHC.CmmToAsm.PIC.html#cmmMakePicReference"><span class="hs-identifier hs-var">cmmMakePicReference</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838056"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-143"></span><span>                </span><span class="hs-comment">-- all currently supported processors support</span><span>
</span><span id="line-144"></span><span>                </span><span class="hs-comment">-- PC-relative branch and call instructions,</span><span>
</span><span id="line-145"></span><span>                </span><span class="hs-comment">-- so just jump there if it's a call or a jump</span><span>
</span><span id="line-146"></span><span>              </span><span class="annot"><span class="annottext">ReferenceKind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; m CmmExpr
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmExpr -&gt; m CmmExpr) -&gt; CmmExpr -&gt; m CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838058"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- Create a position independent reference to a label.</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- (but do not bother with dynamic linking).</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- We calculate the label's address by adding some (platform-dependent)</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- offset to our base register; this offset is calculated by</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- the function picRelative in the platform-dependent part below.</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#cmmMakePicReference"><span class="hs-identifier hs-type">cmmMakePicReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a></span><span>
</span><span id="line-156"></span><span id="cmmMakePicReference"><span class="annot"><span class="annottext">cmmMakePicReference :: NCGConfig -&gt; CLabel -&gt; CmmExpr
</span><a href="GHC.CmmToAsm.PIC.html#cmmMakePicReference"><span class="hs-identifier hs-var hs-var">cmmMakePicReference</span></a></span></span><span> </span><span id="local-6989586621681838078"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838078"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838079"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- Windows doesn't need PIC,</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-comment">-- everything gets relocated at runtime</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSMinGW32/GHC.Platform.ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-comment">-- no pic base reg on AArch64, however indicate this symbol should go through</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-comment">-- the global offset table (GOT).</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchAArch64/GHC.Platform.ArchOS.html#ArchAArch64"><span class="hs-identifier hs-var">ArchAArch64</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSAIX/GHC.Platform.ArchOS.html#OSAIX"><span class="hs-identifier hs-var">OSAIX</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MachOp -&gt; [CmmExpr] -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; MachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Arch -&gt; OS -&gt; CLabel -&gt; CmmLit
</span><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var">picRelative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>                          </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-comment">-- both ABI versions default to medium code model</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-type">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MachOp -&gt; [CmmExpr] -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; MachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- code model medium</span><span>
</span><span id="line-178"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Arch -&gt; OS -&gt; CLabel -&gt; CmmLit
</span><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var">picRelative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>                          </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838078"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgExternalDynamicRefs"><span class="hs-identifier hs-var">ncgExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838078"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#absoluteLabel"><span class="hs-identifier hs-var">absoluteLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MachOp -&gt; [CmmExpr] -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; MachOp
</span><a href="GHC.Cmm.MachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalReg -&gt; CmmReg
</span><a href="GHC.Cmm.Reg.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalReg
</span><a href="GHC.Cmm.Reg.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Arch -&gt; OS -&gt; CLabel -&gt; CmmLit
</span><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var">picRelative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Width
</span><a href="GHC.Cmm.Type.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>                          </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CmmLit -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmLit -&gt; CmmExpr) -&gt; CmmLit -&gt; CmmExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838079"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621681838081"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681838081"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838078"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#absoluteLabel"><span class="hs-identifier hs-type">absoluteLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-201"></span><span id="absoluteLabel"><span class="annot"><span class="annottext">absoluteLabel :: CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#absoluteLabel"><span class="hs-identifier hs-var hs-var">absoluteLabel</span></a></span></span><span> </span><span id="local-6989586621681838097"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838097"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-202"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838097"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#GotSymbolPtr"><span class="hs-identifier hs-var">GotSymbolPtr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#GotSymbolOffset"><span class="hs-identifier hs-var">GotSymbolOffset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">Maybe (DynamicLinkerLabelInfo, CLabel)
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- Knowledge about how special dynamic linker labels like symbol</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- pointers, code stubs and GOT offsets look like is located in the</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- module CLabel.</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><span class="hs-comment">-- | Helper to check whether the data resides in a DLL or not, see @labelDynamic@</span></span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-type">ncgLabelDynamic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-215"></span><span id="ncgLabelDynamic"><span class="annot"><span class="annottext">ncgLabelDynamic :: NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var hs-var">ncgLabelDynamic</span></a></span></span><span> </span><span id="local-6989586621681838101"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838101"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Platform -&gt; Bool -&gt; CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#labelDynamic"><span class="hs-identifier hs-var">labelDynamic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Module
</span><a href="GHC.CmmToAsm.Config.html#ncgThisModule"><span class="hs-identifier hs-var">ncgThisModule</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838101"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838101"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgExternalDynamicRefs"><span class="hs-identifier hs-var">ncgExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838101"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- We have to decide which labels need to be accessed</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- indirectly or via a piece of stub code.</span><span>
</span><span id="line-222"></span><span class="hs-keyword">data</span><span> </span><span id="LabelAccessStyle"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#LabelAccessStyle"><span class="hs-identifier hs-var">LabelAccessStyle</span></a></span></span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="AccessViaStub"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#AccessViaStub"><span class="hs-identifier hs-var">AccessViaStub</span></a></span></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="AccessViaSymbolPtr"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span></span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="AccessDirectly"><span class="annot"><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-type">howToAccessLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#Arch/GHC.Platform.ArchOS.html#Arch"><span class="hs-identifier hs-type">Arch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OS/GHC.Platform.ArchOS.html#OS"><span class="hs-identifier hs-type">OS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#ReferenceKind"><span class="hs-identifier hs-type">ReferenceKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#LabelAccessStyle"><span class="hs-identifier hs-type">LabelAccessStyle</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Windows</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- In Windows speak, a &quot;module&quot; is a set of objects linked into the</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- same Portable Executable (PE) file. (both .exe and .dll files are PEs).</span><span>
</span><span id="line-232"></span><span class="hs-comment">--</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- If we're compiling a multi-module program then symbols from other modules</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- are accessed by a symbol pointer named __imp_SYMBOL. At runtime we have the</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- following.</span><span>
</span><span id="line-236"></span><span class="hs-comment">--</span><span>
</span><span id="line-237"></span><span class="hs-comment">--   (in the local module)</span><span>
</span><span id="line-238"></span><span class="hs-comment">--     __imp_SYMBOL: addr of SYMBOL</span><span>
</span><span id="line-239"></span><span class="hs-comment">--</span><span>
</span><span id="line-240"></span><span class="hs-comment">--   (in the other module)</span><span>
</span><span id="line-241"></span><span class="hs-comment">--     SYMBOL: the real function / data.</span><span>
</span><span id="line-242"></span><span class="hs-comment">--</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- To access the function at SYMBOL from our local module, we just need to</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- dereference the local __imp_SYMBOL.</span><span>
</span><span id="line-245"></span><span class="hs-comment">--</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- If not compiling with -dynamic we assume that all our code will be linked</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- into the same .exe file. In this case we always access symbols directly,</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- and never use __imp_SYMBOL.</span><span>
</span><span id="line-249"></span><span class="hs-comment">--</span><span>
</span><span id="line-250"></span><span id="howToAccessLabel"><span class="annot"><span class="annottext">howToAccessLabel :: NCGConfig
-&gt; Arch -&gt; OS -&gt; ReferenceKind -&gt; CLabel -&gt; LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var hs-var">howToAccessLabel</span></a></span></span><span> </span><span id="local-6989586621681838104"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838104"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838105"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838105"><span class="hs-identifier hs-var">_arch</span></a></span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSMinGW32/GHC.Platform.ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span id="local-6989586621681838106"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838106"><span class="hs-identifier hs-var">_kind</span></a></span></span><span> </span><span id="local-6989586621681838107"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838107"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>        </span><span class="hs-comment">-- Assume all symbols will be in the same PE, so just access them directly.</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgExternalDynamicRefs"><span class="hs-identifier hs-var">ncgExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838104"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-comment">-- If the target symbol is in another PE we need to access it via the</span><span>
</span><span id="line-257"></span><span>        </span><span class="hs-comment">--      appropriate __imp_SYMBOL pointer.</span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838104"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838107"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-comment">-- Target symbol is in the same PE as the caller, so just access it directly.</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- On AArch64, relocations for JUMP and CALL will be emitted with 26bits, this</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- is enough for ~64MB of range. Anything else will need to go through a veneer,</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- which is the job of the linker to build.  We might only want to lookup</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- Data References through the GOT.</span><span>
</span><span id="line-269"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838109"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838109"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchAArch64/GHC.Platform.ArchOS.html#ArchAArch64"><span class="hs-identifier hs-var">ArchAArch64</span></a></span><span> </span><span id="local-6989586621681838110"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838110"><span class="hs-identifier hs-var">_os</span></a></span></span><span> </span><span id="local-6989586621681838111"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838111"><span class="hs-identifier hs-var">_kind</span></a></span></span><span> </span><span id="local-6989586621681838112"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838112"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgExternalDynamicRefs"><span class="hs-identifier hs-var">ncgExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838109"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838109"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838112"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-comment">-- Mach-O (Darwin, Mac OS X)</span><span>
</span><span id="line-281"></span><span class="hs-comment">--</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- Indirect access is required in the following cases:</span><span>
</span><span id="line-283"></span><span class="hs-comment">--  * things imported from a dynamic library</span><span>
</span><span id="line-284"></span><span class="hs-comment">--  * (not on x86_64) data from a different module, if we're generating PIC code</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- It is always possible to access something indirectly,</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- even when it's not necessary.</span><span>
</span><span id="line-287"></span><span class="hs-comment">--</span><span>
</span><span id="line-288"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838113"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838113"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838114"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838114"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span id="local-6989586621681838116"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838116"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-comment">-- data access to a dynamic library goes via a symbol pointer</span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838113"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838116"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-comment">-- when generating PIC code, all cross-module data references must</span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-comment">-- must go via a symbol pointer, too, because the assembler</span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-comment">-- cannot generate code for a label difference where one</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-comment">-- label is undefined. Doesn't apply to x86_64 (why?).</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838114"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#isLocalCLabel"><span class="hs-identifier hs-var">isLocalCLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Module
</span><a href="GHC.CmmToAsm.Config.html#ncgThisModule"><span class="hs-identifier hs-var">ncgThisModule</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838113"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838116"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838113"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Bool
</span><a href="GHC.Cmm.CLabel.html#externallyVisibleCLabel"><span class="hs-identifier hs-var">externallyVisibleCLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838116"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838121"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838121"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838122"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838122"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#JumpReference"><span class="hs-identifier hs-var">JumpReference</span></a></span><span> </span><span id="local-6989586621681838123"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838123"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-comment">-- dyld code stubs don't work for tailcalls because the</span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-comment">-- stack alignment is only right for regular calls.</span><span>
</span><span id="line-309"></span><span>        </span><span class="hs-comment">-- Therefore, we have to go via a symbol pointer:</span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838122"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86/GHC.Platform.ArchOS.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838122"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838122"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchAArch64/GHC.Platform.ArchOS.html#ArchAArch64"><span class="hs-identifier hs-var">ArchAArch64</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838121"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838123"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838125"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838125"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838126"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838126"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span id="local-6989586621681838127"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838127"><span class="hs-identifier hs-var">_kind</span></a></span></span><span> </span><span id="local-6989586621681838128"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838128"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-comment">-- Code stubs are the usual method of choice for imported code;</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-comment">-- not needed on x86_64 because Apple's new linker, ld64, generates</span><span>
</span><span id="line-318"></span><span>        </span><span class="hs-comment">-- them automatically, neither on Aarch64 (arm64).</span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838126"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838126"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchAArch64/GHC.Platform.ArchOS.html#ArchAArch64"><span class="hs-identifier hs-var">ArchAArch64</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838125"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838128"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaStub"><span class="hs-identifier hs-var">AccessViaStub</span></a></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- AIX</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- quite simple (for now)</span><span>
</span><span id="line-331"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838129"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838129"><span class="hs-identifier hs-var">_config</span></a></span></span><span> </span><span id="local-6989586621681838130"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838130"><span class="hs-identifier hs-var">_arch</span></a></span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSAIX/GHC.Platform.ArchOS.html#OSAIX"><span class="hs-identifier hs-var">OSAIX</span></a></span><span> </span><span id="local-6989586621681838131"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838131"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681838132"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838132"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838131"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-334"></span><span>            </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-335"></span><span>            </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#JumpReference"><span class="hs-identifier hs-var">JumpReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-comment">-- ELF (Linux)</span><span>
</span><span id="line-338"></span><span class="hs-comment">--</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- ELF tries to pretend to the main application code that dynamic linking does</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- not exist. While this may sound convenient, it tends to mess things up in</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- very bad ways, so we have to be careful when we generate code for a non-PIE</span><span>
</span><span id="line-342"></span><span class="hs-comment">-- main program (-dynamic but no -fPIC).</span><span>
</span><span id="line-343"></span><span class="hs-comment">--</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- Indirect access is required for references to imported symbols</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- from position independent code. It is also required from the main program</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- when dynamic libraries containing Haskell code are used.</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838133"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838133"><span class="hs-identifier hs-var">_config</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-type">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681838134"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838134"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span id="local-6989586621681838135"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838135"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681838136"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838136"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838134"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-350"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838135"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-351"></span><span>          </span><span class="hs-comment">-- ELF PPC64 (powerpc64-linux), AIX, MacOS 9, BeOS/PPC</span><span>
</span><span id="line-352"></span><span>          </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-353"></span><span>          </span><span class="hs-comment">-- RTLD does not generate stubs for function descriptors</span><span>
</span><span id="line-354"></span><span>          </span><span class="hs-comment">-- in tail calls. Create a symbol pointer and generate</span><span>
</span><span id="line-355"></span><span>          </span><span class="hs-comment">-- the code to load the function descriptor at the call site.</span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#JumpReference"><span class="hs-identifier hs-var">JumpReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-357"></span><span>          </span><span class="hs-comment">-- regular calls are handled by the runtime linker</span><span>
</span><span id="line-358"></span><span>          </span><span class="annot"><span class="annottext">ReferenceKind
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838138"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838138"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838139"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838139"><span class="hs-identifier hs-var">_arch</span></a></span></span><span> </span><span id="local-6989586621681838140"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838140"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span id="local-6989586621681838141"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838141"><span class="hs-identifier hs-var">_kind</span></a></span></span><span> </span><span id="local-6989586621681838142"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838142"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-comment">-- no PIC -&gt; the dynamic linker does everything for us;</span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-comment">--           if we don't dynamically link to Haskell code,</span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-comment">--           it actually manages to do so without messing things up.</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838140"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838138"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-366"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgExternalDynamicRefs"><span class="hs-identifier hs-var">ncgExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838138"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838143"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838143"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838144"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838144"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span id="local-6989586621681838145"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838145"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a></span><span> </span><span id="local-6989586621681838146"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838146"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838145"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-comment">-- A dynamic label needs to be accessed via a symbol pointer.</span><span>
</span><span id="line-373"></span><span>          </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838143"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838146"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-374"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>            </span><span class="hs-comment">-- For PowerPC32 -fPIC, we have to access even static data</span><span>
</span><span id="line-377"></span><span>            </span><span class="hs-comment">-- via a symbol pointer (see below for an explanation why</span><span>
</span><span id="line-378"></span><span>            </span><span class="hs-comment">-- PowerPC32 Linux is especially broken).</span><span>
</span><span id="line-379"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838144"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC/GHC.Platform.ArchOS.html#ArchPPC"><span class="hs-identifier hs-var">ArchPPC</span></a></span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838143"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-381"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-384"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-comment">-- In most cases, we have to avoid symbol stubs on ELF, for the following reasons:</span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-comment">--   on i386, the position-independent symbol stubs in the Procedure Linkage Table</span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-comment">--   require the address of the GOT to be loaded into register %ebx on entry.</span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-comment">--   The linker will take any reference to the symbol stub as a hint that</span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-comment">--   the label in question is a code label. When linking executables, this</span><span>
</span><span id="line-392"></span><span>        </span><span class="hs-comment">--   will cause the linker to replace even data references to the label with</span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-comment">--   references to the symbol stub.</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-comment">-- This leaves calling a (foreign) function from non-PIC code</span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-comment">-- (AccessDirectly, because we get an implicit symbol stub)</span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-comment">-- and calling functions from PIC code on non-i386 platforms (via a symbol stub)</span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838148"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838148"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838149"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838149"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span id="local-6989586621681838150"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838150"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span class="annot"><span class="annottext">ReferenceKind
</span><a href="GHC.CmmToAsm.PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a></span><span> </span><span id="local-6989586621681838151"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838151"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838150"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838148"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838151"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-402"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838148"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838150"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838149"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86/GHC.Platform.ArchOS.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838148"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838151"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838148"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-409"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaStub"><span class="hs-identifier hs-var">AccessViaStub</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838152"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838152"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838153"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838153"><span class="hs-identifier hs-var">_arch</span></a></span></span><span> </span><span id="local-6989586621681838154"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838154"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span id="local-6989586621681838155"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838155"><span class="hs-identifier hs-var">_kind</span></a></span></span><span> </span><span id="local-6989586621681838156"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838156"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838154"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; CLabel -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#ncgLabelDynamic"><span class="hs-identifier hs-var">ncgLabelDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838152"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838156"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-414"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessViaSymbolPtr"><span class="hs-identifier hs-var">AccessViaSymbolPtr</span></a></span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-comment">-- all other platforms</span><span>
</span><span id="line-418"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#howToAccessLabel"><span class="hs-identifier hs-var">howToAccessLabel</span></a></span><span> </span><span id="local-6989586621681838157"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838157"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838158"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838158"><span class="hs-identifier hs-var">_arch</span></a></span></span><span> </span><span id="local-6989586621681838159"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838159"><span class="hs-identifier hs-var">_os</span></a></span></span><span> </span><span id="local-6989586621681838160"><span class="annot"><span class="annottext">ReferenceKind
</span><a href="#local-6989586621681838160"><span class="hs-identifier hs-var">_kind</span></a></span></span><span> </span><span id="local-6989586621681838161"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838161"><span class="hs-identifier hs-var">_lbl</span></a></span></span><span>
</span><span id="line-419"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838157"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LabelAccessStyle
</span><a href="GHC.CmmToAsm.PIC.html#AccessDirectly"><span class="hs-identifier hs-var">AccessDirectly</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; LabelAccessStyle
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;howToAccessLabel: PIC not defined for this platform&quot;</span></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="hs-comment">-- -------------------------------------------------------------------</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- | Says what we have to add to our 'PIC base register' in order to</span><span>
</span><span id="line-429"></span><span class="hs-comment">--      get the address of a label.</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-type">picRelative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#Width"><span class="hs-identifier hs-type">Width</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#Arch/GHC.Platform.ArchOS.html#Arch"><span class="hs-identifier hs-type">Arch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OS/GHC.Platform.ArchOS.html#OS"><span class="hs-identifier hs-type">OS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">-- Darwin, but not x86_64:</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- The PIC base register points to the PIC base label at the beginning</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- of the current CmmDecl. We just have to use a label difference to</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- get the offset.</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- We have already made sure that all labels that are not from the current</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- module are accessed indirectly ('as' can't calculate differences between</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- undefined labels).</span><span>
</span><span id="line-440"></span><span id="picRelative"><span class="annot"><span class="annottext">picRelative :: Width -&gt; Arch -&gt; OS -&gt; CLabel -&gt; CmmLit
</span><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var hs-var">picRelative</span></a></span></span><span> </span><span id="local-6989586621681838163"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621681838163"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span id="local-6989586621681838164"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838164"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span id="local-6989586621681838165"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838165"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838164"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CLabel -&gt; Int -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838165"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="GHC.Cmm.CLabel.html#mkPicBaseLabel"><span class="hs-identifier hs-var">mkPicBaseLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621681838163"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">-- On AIX we use an indirect local TOC anchored by 'gotLabel'.</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- This way we use up only one global TOC entry per compilation-unit</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- (this is quite similar to GCC's @-mminimal-toc@ compilation mode)</span><span>
</span><span id="line-447"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var">picRelative</span></a></span><span> </span><span id="local-6989586621681838168"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621681838168"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSAIX/GHC.Platform.ArchOS.html#OSAIX"><span class="hs-identifier hs-var">OSAIX</span></a></span><span> </span><span id="local-6989586621681838169"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838169"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CLabel -&gt; Int -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838169"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="GHC.CmmToAsm.PIC.html#gotLabel"><span class="hs-identifier hs-var">gotLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621681838168"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span class="hs-comment">-- PowerPC Linux:</span><span>
</span><span id="line-451"></span><span class="hs-comment">-- The PIC base register points to our fake GOT. Use a label difference</span><span>
</span><span id="line-452"></span><span class="hs-comment">-- to get the offset.</span><span>
</span><span id="line-453"></span><span class="hs-comment">-- We have made sure that *everything* is accessed indirectly, so this</span><span>
</span><span id="line-454"></span><span class="hs-comment">-- is only used for offsets from the GOT to symbol pointers inside the</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- GOT.</span><span>
</span><span id="line-456"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var">picRelative</span></a></span><span> </span><span id="local-6989586621681838171"><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621681838171"><span class="hs-identifier hs-var">width</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC/GHC.Platform.ArchOS.html#ArchPPC"><span class="hs-identifier hs-var">ArchPPC</span></a></span><span> </span><span id="local-6989586621681838172"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838172"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span id="local-6989586621681838173"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838173"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838172"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CLabel -&gt; Int -&gt; Width -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838173"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="GHC.CmmToAsm.PIC.html#gotLabel"><span class="hs-identifier hs-var">gotLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><a href="#local-6989586621681838171"><span class="hs-identifier hs-var">width</span></a></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">-- Most Linux versions:</span><span>
</span><span id="line-462"></span><span class="hs-comment">-- The PIC base register points to the GOT. Use foo@got for symbol</span><span>
</span><span id="line-463"></span><span class="hs-comment">-- pointers, and foo@gotoff for everything else.</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- Linux and Darwin on x86_64:</span><span>
</span><span id="line-465"></span><span class="hs-comment">-- The PIC base register is %rip, we use foo@gotpcrel for symbol pointers,</span><span>
</span><span id="line-466"></span><span class="hs-comment">-- and a GotSymbolOffset label for other things.</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- For reasons of tradition, the symbol offset label is written as a plain label.</span><span>
</span><span id="line-468"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var">picRelative</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681838174"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838174"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span id="local-6989586621681838175"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838175"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span id="local-6989586621681838176"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838176"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838175"><span class="hs-identifier hs-var">os</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838175"><span class="hs-identifier hs-var">os</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838174"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>   </span><span id="local-6989586621681838177"><span class="annot"><span class="annottext">result :: CmmLit
</span><a href="#local-6989586621681838177"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span>
</span><span id="line-471"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#SymbolPtr"><span class="hs-identifier hs-var">SymbolPtr</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681838178"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838178"><span class="hs-identifier hs-var">lbl'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838176"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-472"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; CmmLit) -&gt; CLabel -&gt; CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkDynamicLinkerLabel"><span class="hs-identifier hs-var">mkDynamicLinkerLabel</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#GotSymbolPtr"><span class="hs-identifier hs-var">GotSymbolPtr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838178"><span class="hs-identifier hs-var">lbl'</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-475"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a></span><span> </span><span class="annot"><span class="annottext">(CLabel -&gt; CmmLit) -&gt; CLabel -&gt; CmmLit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo -&gt; CLabel -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkDynamicLinkerLabel"><span class="hs-identifier hs-var">mkDynamicLinkerLabel</span></a></span><span> </span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#GotSymbolOffset"><span class="hs-identifier hs-var">GotSymbolOffset</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838176"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>          </span><span class="hs-keyword">in</span><span>    </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621681838177"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#picRelative"><span class="hs-identifier hs-var">picRelative</span></a></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-480"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CmmLit
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.CmmToAsm.PIC.picRelative undefined for this platform&quot;</span></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#needImportedSymbols"><span class="hs-identifier hs-type">needImportedSymbols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-487"></span><span id="needImportedSymbols"><span class="annot"><span class="annottext">needImportedSymbols :: NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.PIC.html#needImportedSymbols"><span class="hs-identifier hs-var hs-var">needImportedSymbols</span></a></span></span><span> </span><span id="local-6989586621681838179"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838179"><span class="hs-identifier hs-var">config</span></a></span></span><span>
</span><span id="line-488"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838180"><span class="hs-identifier hs-var">os</span></a></span><span>    </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span>
</span><span id="line-489"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838181"><span class="hs-identifier hs-var">arch</span></a></span><span>  </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838180"><span class="hs-identifier hs-var">os</span></a></span><span>    </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSAIX/GHC.Platform.ArchOS.html#OSAIX"><span class="hs-identifier hs-var">OSAIX</span></a></span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-comment">-- PowerPC Linux: -fPIC or -dynamic</span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838180"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838181"><span class="hs-identifier hs-var">arch</span></a></span><span>  </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC/GHC.Platform.ArchOS.html#ArchPPC"><span class="hs-identifier hs-var">ArchPPC</span></a></span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838179"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgExternalDynamicRefs"><span class="hs-identifier hs-var">ncgExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838179"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-comment">-- PowerPC 64 Linux: always</span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838180"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838181"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V1/GHC.Platform.ArchOS.html#ELF_V1"><span class="hs-identifier hs-var">ELF_V1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838181"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V2/GHC.Platform.ArchOS.html#ELF_V2"><span class="hs-identifier hs-var">ELF_V2</span></a></span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>        </span><span class="hs-comment">-- i386 (and others?): -dynamic but not -fPIC</span><span>
</span><span id="line-506"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838180"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-507"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838181"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V1/GHC.Platform.ArchOS.html#ELF_V1"><span class="hs-identifier hs-var">ELF_V1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838181"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V2/GHC.Platform.ArchOS.html#ELF_V2"><span class="hs-identifier hs-var">ELF_V2</span></a></span><span>
</span><span id="line-508"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgExternalDynamicRefs"><span class="hs-identifier hs-var">ncgExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838179"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-509"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838179"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-512"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-513"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-514"></span><span>      </span><span id="local-6989586621681838184"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681838184"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838179"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-515"></span><span>      </span><span id="local-6989586621681838181"><span class="annot"><span class="annottext">arch :: Arch
</span><a href="#local-6989586621681838181"><span class="hs-identifier hs-var hs-var">arch</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838184"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-516"></span><span>      </span><span id="local-6989586621681838180"><span class="annot"><span class="annottext">os :: OS
</span><a href="#local-6989586621681838180"><span class="hs-identifier hs-var hs-var">os</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838184"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="hs-comment">-- gotLabel</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- The label used to refer to our &quot;fake GOT&quot; from</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- position-independent code.</span><span>
</span><span id="line-521"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#gotLabel"><span class="hs-identifier hs-type">gotLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span>
</span><span id="line-522"></span><span id="gotLabel"><span class="annot"><span class="annottext">gotLabel :: CLabel
</span><a href="GHC.CmmToAsm.PIC.html#gotLabel"><span class="hs-identifier hs-var hs-var">gotLabel</span></a></span></span><span>
</span><span id="line-523"></span><span>        </span><span class="hs-comment">-- HACK: this label isn't really foreign</span><span>
</span><span id="line-524"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString
-&gt; Maybe Int -&gt; ForeignLabelSource -&gt; FunctionOrData -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkForeignLabel"><span class="hs-identifier hs-var">mkForeignLabel</span></a></span><span>
</span><span id="line-525"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.LCTOC1&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>                </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignLabelSource
</span><a href="GHC.Cmm.CLabel.html#ForeignLabelInThisPackage"><span class="hs-identifier hs-var">ForeignLabelInThisPackage</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-comment">-- Emit GOT declaration</span><span>
</span><span id="line-531"></span><span class="hs-comment">-- Output whatever needs to be output once per .s file.</span><span>
</span><span id="line-532"></span><span class="hs-comment">--</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- We don't need to declare any offset tables.</span><span>
</span><span id="line-534"></span><span class="hs-comment">-- However, for PIC on x86, we need a small helper function.</span><span>
</span><span id="line-535"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#pprGotDeclaration"><span class="hs-identifier hs-type">pprGotDeclaration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#HDoc"><span class="hs-identifier hs-type">HDoc</span></a></span><span>
</span><span id="line-536"></span><span id="pprGotDeclaration"><span class="annot"><span class="annottext">pprGotDeclaration :: NCGConfig -&gt; HDoc
</span><a href="GHC.CmmToAsm.PIC.html#pprGotDeclaration"><span class="hs-identifier hs-var hs-var">pprGotDeclaration</span></a></span></span><span> </span><span id="local-6989586621681838189"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838189"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838190"><span class="hs-identifier hs-var">arch</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838191"><span class="hs-identifier hs-var">os</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-537"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86/GHC.Platform.ArchOS.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838189"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-539"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-540"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section __TEXT,__textcoal_nt,coalesced,no_toc&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-541"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.weak_definition ___i686.get_pc_thunk.ax&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-542"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.private_extern ___i686.get_pc_thunk.ax&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-543"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;___i686.get_pc_thunk.ax:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-544"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tmovl (%esp), %eax&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-545"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tret&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span>   </span><span class="hs-comment">-- Emit XCOFF TOC section</span><span>
</span><span id="line-550"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSAIX/GHC.Platform.ArchOS.html#OSAIX"><span class="hs-identifier hs-var">OSAIX</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.toc&quot;</span></span><span>
</span><span id="line-552"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.tc ghc_toc_table[TC],.LCTOC1&quot;</span></span><span>
</span><span id="line-553"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.csect ghc_toc_table[RW]&quot;</span></span><span>
</span><span id="line-554"></span><span>                    </span><span class="hs-comment">-- See Note [.LCTOC1 in PPC PIC code]</span><span>
</span><span id="line-555"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.set .LCTOC1,$+0x8000&quot;</span></span><span>
</span><span id="line-556"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>   </span><span class="hs-comment">-- PPC 64 ELF v1 needs a Table Of Contents (TOC)</span><span>
</span><span id="line-560"></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-type">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V1/GHC.Platform.ArchOS.html#ELF_V1"><span class="hs-identifier hs-var">ELF_V1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Line HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; Line doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#line"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">(Line HDoc -&gt; HDoc) -&gt; Line HDoc -&gt; HDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section \&quot;.toc\&quot;,\&quot;aw\&quot;&quot;</span></span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>   </span><span class="hs-comment">-- In ELF v2 we also need to tell the assembler that we want ABI</span><span>
</span><span id="line-564"></span><span>   </span><span class="hs-comment">-- version 2. This would normally be done at the top of the file</span><span>
</span><span id="line-565"></span><span>   </span><span class="hs-comment">-- right after a file directive, but I could not figure out how</span><span>
</span><span id="line-566"></span><span>   </span><span class="hs-comment">-- to do that.</span><span>
</span><span id="line-567"></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-type">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V2/GHC.Platform.ArchOS.html#ELF_V2"><span class="hs-identifier hs-var">ELF_V2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.abiversion 2&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-569"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section \&quot;.toc\&quot;,\&quot;aw\&quot;&quot;</span></span><span>
</span><span id="line-570"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621681838196"><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838196"><span class="hs-identifier hs-var">arch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681838197"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838197"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838197"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838196"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V1/GHC.Platform.ArchOS.html#ELF_V1"><span class="hs-identifier hs-var">ELF_V1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838196"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V2/GHC.Platform.ArchOS.html#ELF_V2"><span class="hs-identifier hs-var">ELF_V2</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838189"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838197"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838196"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V1/GHC.Platform.ArchOS.html#ELF_V1"><span class="hs-identifier hs-var">ELF_V1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838196"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI -&gt; Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-var">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ELF_V2/GHC.Platform.ArchOS.html#ELF_V2"><span class="hs-identifier hs-var">ELF_V2</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-581"></span><span>                </span><span class="hs-comment">-- See Note [.LCTOC1 in PPC PIC code]</span><span>
</span><span id="line-582"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section \&quot;.got2\&quot;,\&quot;aw\&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-583"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.LCTOC1 = .+32768&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>   </span><span class="annot"><span class="annottext">(Arch, OS)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; HDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pprGotDeclaration: no match&quot;</span></span><span>
</span><span id="line-586"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-587"></span><span>   </span><span id="local-6989586621681838198"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681838198"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838189"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-588"></span><span>   </span><span id="local-6989586621681838190"><span class="annot"><span class="annottext">arch :: Arch
</span><a href="#local-6989586621681838190"><span class="hs-identifier hs-var hs-var">arch</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838198"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-589"></span><span>   </span><span id="local-6989586621681838191"><span class="annot"><span class="annottext">os :: OS
</span><a href="#local-6989586621681838191"><span class="hs-identifier hs-var hs-var">os</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838198"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- On Darwin, we have to generate our own stub code for lazy binding..</span><span>
</span><span id="line-594"></span><span class="hs-comment">-- For each processor architecture, there are two versions, one for PIC</span><span>
</span><span id="line-595"></span><span class="hs-comment">-- and one for non-PIC.</span><span>
</span><span id="line-596"></span><span class="hs-comment">--</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#pprImportedSymbol"><span class="hs-identifier hs-type">pprImportedSymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Config.html#NCGConfig"><span class="hs-identifier hs-type">NCGConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#HDoc"><span class="hs-identifier hs-type">HDoc</span></a></span><span>
</span><span id="line-599"></span><span id="pprImportedSymbol"><span class="annot"><span class="annottext">pprImportedSymbol :: NCGConfig -&gt; CLabel -&gt; HDoc
</span><a href="GHC.CmmToAsm.PIC.html#pprImportedSymbol"><span class="hs-identifier hs-var hs-var">pprImportedSymbol</span></a></span></span><span> </span><span id="local-6989586621681838199"><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838199"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621681838200"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838200"><span class="hs-identifier hs-var">importedLbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><a href="#local-6989586621681838201"><span class="hs-identifier hs-var">arch</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838202"><span class="hs-identifier hs-var">os</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-600"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86/GHC.Platform.ArchOS.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#CodeStub"><span class="hs-identifier hs-var">CodeStub</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681838203"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838200"><span class="hs-identifier hs-var">importedLbl</span></a></span><span>
</span><span id="line-602"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681838204"><span class="hs-identifier hs-var">pic</span></a></span><span>
</span><span id="line-603"></span><span>             </span><span class="hs-keyword">then</span><span>
</span><span id="line-604"></span><span>              </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-605"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.symbol_stub&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-606"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$stub:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.indirect_symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-608"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tjmp *L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-609"></span><span>                          </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$lazy_ptr&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-610"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-611"></span><span>                      </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$stub_binder:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-612"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tpushl $L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-613"></span><span>                          </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$lazy_ptr&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-614"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tjmp dyld_stub_binding_helper&quot;</span></span><span>
</span><span id="line-615"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-616"></span><span>             </span><span class="hs-keyword">else</span><span>
</span><span id="line-617"></span><span>              </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-618"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section __TEXT,__picsymbolstub2,&quot;</span></span><span>
</span><span id="line-619"></span><span>                      </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;symbol_stubs,pure_instructions,25&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-620"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$stub:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-621"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.indirect_symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-622"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tcall ___i686.get_pc_thunk.ax&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-623"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;1:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-624"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tmovl L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-625"></span><span>                          </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$lazy_ptr-1b(%eax),%edx&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-626"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tjmp *%edx&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-627"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-628"></span><span>                      </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$stub_binder:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-629"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tlea L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-630"></span><span>                          </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$lazy_ptr-1b(%eax),%eax&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-631"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tpushl %eax&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-632"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tjmp dyld_stub_binding_helper&quot;</span></span><span>
</span><span id="line-633"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-634"></span><span>           </span><span class="annot"><span class="annottext">HDoc -&gt; HDoc -&gt; HDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-635"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section __DATA, __la_sym_ptr&quot;</span></span><span>
</span><span id="line-636"></span><span>                    </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681838204"><span class="hs-identifier hs-var">pic</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; HLine
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int -&gt; HLine
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>                    </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,lazy_symbol_pointers&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-638"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$lazy_ptr:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-639"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.indirect_symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-640"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.long L&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838203"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-641"></span><span>                    </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$stub_binder&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#SymbolPtr"><span class="hs-identifier hs-var">SymbolPtr</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681838210"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838210"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838200"><span class="hs-identifier hs-var">importedLbl</span></a></span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-645"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.non_lazy_symbol_pointer&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-646"></span><span>                </span><span class="annot"><span class="annottext">Char -&gt; HLine
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'L'</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838210"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$non_lazy_ptr:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-647"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.indirect_symbol&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838210"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-648"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.long\t0&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-651"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchAArch64/GHC.Platform.ArchOS.html#ArchAArch64"><span class="hs-identifier hs-var">ArchAArch64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>   </span><span class="hs-comment">-- XCOFF / AIX</span><span>
</span><span id="line-659"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-660"></span><span>   </span><span class="hs-comment">-- Similar to PPC64 ELF v1, there's dedicated TOC register (r2). To</span><span>
</span><span id="line-661"></span><span>   </span><span class="hs-comment">-- workaround the limitation of a global TOC we use an indirect TOC</span><span>
</span><span id="line-662"></span><span>   </span><span class="hs-comment">-- with the label `ghc_toc_table`.</span><span>
</span><span id="line-663"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-664"></span><span>   </span><span class="hs-comment">-- See also GCC's `-mminimal-toc` compilation mode or</span><span>
</span><span id="line-665"></span><span>   </span><span class="hs-comment">-- http://www.ibm.com/developerworks/rational/library/overview-toc-aix/</span><span>
</span><span id="line-666"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-667"></span><span>   </span><span class="hs-comment">-- NB: No DSO-support yet</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSAIX/GHC.Platform.ArchOS.html#OSAIX"><span class="hs-identifier hs-var">OSAIX</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838200"><span class="hs-identifier hs-var">importedLbl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-670"></span><span>            </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#SymbolPtr"><span class="hs-identifier hs-var">SymbolPtr</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681838212"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838212"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-672"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LC..&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838212"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; HLine
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span class="hs-special">,</span><span>
</span><span id="line-673"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.long&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838212"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-674"></span><span>            </span><span class="annot"><span class="annottext">Maybe (DynamicLinkerLabelInfo, CLabel)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>   </span><span class="hs-comment">-- ELF / Linux</span><span>
</span><span id="line-677"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-678"></span><span>   </span><span class="hs-comment">-- In theory, we don't need to generate any stubs or symbol pointers</span><span>
</span><span id="line-679"></span><span>   </span><span class="hs-comment">-- by hand for Linux.</span><span>
</span><span id="line-680"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-681"></span><span>   </span><span class="hs-comment">-- Reality differs from this in two areas.</span><span>
</span><span id="line-682"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-683"></span><span>   </span><span class="hs-comment">-- 1) If we just use a dynamically imported symbol directly in a read-only</span><span>
</span><span id="line-684"></span><span>   </span><span class="hs-comment">--    section of the main executable (as GCC does), ld generates R_*_COPY</span><span>
</span><span id="line-685"></span><span>   </span><span class="hs-comment">--    relocations, which are fundamentally incompatible with reversed info</span><span>
</span><span id="line-686"></span><span>   </span><span class="hs-comment">--    tables. Therefore, we need a table of imported addresses in a writable</span><span>
</span><span id="line-687"></span><span>   </span><span class="hs-comment">--    section.</span><span>
</span><span id="line-688"></span><span>   </span><span class="hs-comment">--    The &quot;official&quot; GOT mechanism (label@got) isn't intended to be used</span><span>
</span><span id="line-689"></span><span>   </span><span class="hs-comment">--    in position dependent code, so we have to create our own &quot;fake GOT&quot;</span><span>
</span><span id="line-690"></span><span>   </span><span class="hs-comment">--    when not Opt_PIC &amp;&amp; WayDyn `elem` ways dflags.</span><span>
</span><span id="line-691"></span><span>   </span><span class="hs-comment">--</span><span>
</span><span id="line-692"></span><span>   </span><span class="hs-comment">-- 2) PowerPC Linux is just plain broken.</span><span>
</span><span id="line-693"></span><span>   </span><span class="hs-comment">--    While it's theoretically possible to use GOT offsets larger</span><span>
</span><span id="line-694"></span><span>   </span><span class="hs-comment">--    than 16 bit, the standard crt*.o files don't, which leads to</span><span>
</span><span id="line-695"></span><span>   </span><span class="hs-comment">--    linker errors as soon as the GOT size exceeds 16 bit.</span><span>
</span><span id="line-696"></span><span>   </span><span class="hs-comment">--    Also, the assembler doesn't support @gotoff labels.</span><span>
</span><span id="line-697"></span><span>   </span><span class="hs-comment">--    In order to be able to use a larger GOT, we have to circumvent the</span><span>
</span><span id="line-698"></span><span>   </span><span class="hs-comment">--    entire GOT mechanism and do it ourselves (this is also what GCC does).</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>   </span><span class="hs-comment">-- When needImportedSymbols is defined,</span><span>
</span><span id="line-702"></span><span>   </span><span class="hs-comment">-- the NCG will keep track of all DynamicLinkerLabels it uses</span><span>
</span><span id="line-703"></span><span>   </span><span class="hs-comment">-- and output each of them using pprImportedSymbol.</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC_64/GHC.Platform.ArchOS.html#ArchPPC_64"><span class="hs-identifier hs-type">ArchPPC_64</span></a></span><span> </span><span class="annot"><span class="annottext">PPC_64ABI
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838202"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838200"><span class="hs-identifier hs-var">importedLbl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-708"></span><span>            </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#SymbolPtr"><span class="hs-identifier hs-var">SymbolPtr</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681838213"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838213"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-710"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.LC_&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838213"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; HLine
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span class="hs-special">,</span><span>
</span><span id="line-711"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.quad&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838213"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-712"></span><span>            </span><span class="annot"><span class="annottext">Maybe (DynamicLinkerLabelInfo, CLabel)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>   </span><span class="annot"><span class="annottext">(Arch, OS)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838202"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-715"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; Maybe (DynamicLinkerLabelInfo, CLabel)
</span><a href="GHC.Cmm.CLabel.html#dynamicLinkerLabelInfo"><span class="hs-identifier hs-var">dynamicLinkerLabelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838200"><span class="hs-identifier hs-var">importedLbl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-716"></span><span>            </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynamicLinkerLabelInfo
</span><a href="GHC.Cmm.CLabel.html#SymbolPtr"><span class="hs-identifier hs-var">SymbolPtr</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681838214"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838214"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681838215"><span class="annot"><span class="annottext">symbolSize :: HLine
</span><a href="#local-6989586621681838215"><span class="hs-identifier hs-var hs-var">symbolSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Width
</span><a href="GHC.CmmToAsm.Config.html#ncgWordWidth"><span class="hs-identifier hs-var">ncgWordWidth</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838199"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-718"></span><span>                         </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W32"><span class="hs-identifier hs-var">W32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.long&quot;</span></span><span>
</span><span id="line-719"></span><span>                         </span><span class="annot"><span class="annottext">Width
</span><a href="GHC.Cmm.Type.html#W64"><span class="hs-identifier hs-var">W64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t.quad&quot;</span></span><span>
</span><span id="line-720"></span><span>                         </span><span class="annot"><span class="annottext">Width
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; HLine
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unknown wordRep in pprImportedSymbol&quot;</span></span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Line HDoc] -&gt; HDoc
forall doc. IsDoc doc =&gt; [Line doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#lines_"><span class="hs-identifier hs-var">lines_</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-723"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.section \&quot;.got2\&quot;, \&quot;aw\&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-724"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; HLine
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.LC_&quot;</span></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838214"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; HLine
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">':'</span></span><span class="hs-special">,</span><span>
</span><span id="line-725"></span><span>                      </span><span class="annot"><span class="annottext">HLine
</span><a href="#local-6989586621681838215"><span class="hs-identifier hs-var">symbolSize</span></a></span><span> </span><span class="annot"><span class="annottext">HLine -&gt; HLine -&gt; HLine
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var">ppr_lbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838214"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span>            </span><span class="hs-comment">-- PLT code stubs are generated automatically by the dynamic linker.</span><span>
</span><span id="line-728"></span><span>            </span><span class="annot"><span class="annottext">Maybe (DynamicLinkerLabelInfo, CLabel)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>   </span><span class="annot"><span class="annottext">(Arch, OS)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; HDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PIC.pprImportedSymbol: no match&quot;</span></span><span>
</span><span id="line-731"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-732"></span><span>   </span><span id="local-6989586621681838218"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681838218"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Platform
</span><a href="GHC.CmmToAsm.Config.html#ncgPlatform"><span class="hs-identifier hs-var">ncgPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838199"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-733"></span><span>   </span><span class="annot"><a href="#local-6989586621681838206"><span class="hs-identifier hs-type">ppr_lbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#HLine"><span class="hs-identifier hs-type">HLine</span></a></span><span>
</span><span id="line-734"></span><span>   </span><span id="local-6989586621681838206"><span class="annot"><span class="annottext">ppr_lbl :: CLabel -&gt; HLine
</span><a href="#local-6989586621681838206"><span class="hs-identifier hs-var hs-var">ppr_lbl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CLabel -&gt; HLine
forall doc. IsLine doc =&gt; Platform -&gt; CLabel -&gt; doc
</span><a href="GHC.Cmm.CLabel.html#pprAsmLabel"><span class="hs-identifier hs-var">pprAsmLabel</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838218"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-735"></span><span>   </span><span id="local-6989586621681838201"><span class="annot"><span class="annottext">arch :: Arch
</span><a href="#local-6989586621681838201"><span class="hs-identifier hs-var hs-var">arch</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span>  </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838218"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-736"></span><span>   </span><span id="local-6989586621681838202"><span class="annot"><span class="annottext">os :: OS
</span><a href="#local-6989586621681838202"><span class="hs-identifier hs-var hs-var">os</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>    </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681838218"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-737"></span><span>   </span><span id="local-6989586621681838204"><span class="annot"><span class="annottext">pic :: Bool
</span><a href="#local-6989586621681838204"><span class="hs-identifier hs-var hs-var">pic</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NCGConfig -&gt; Bool
</span><a href="GHC.CmmToAsm.Config.html#ncgPIC"><span class="hs-identifier hs-var">ncgPIC</span></a></span><span> </span><span class="annot"><span class="annottext">NCGConfig
</span><a href="#local-6989586621681838199"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-740"></span><span class="hs-comment">-- Generate code to calculate the address that should be put in the</span><span>
</span><span id="line-741"></span><span class="hs-comment">-- PIC base register.</span><span>
</span><span id="line-742"></span><span class="hs-comment">-- This is called by MachCodeGen for every CmmProc that accessed the</span><span>
</span><span id="line-743"></span><span class="hs-comment">-- PIC base register. It adds the appropriate instructions to the</span><span>
</span><span id="line-744"></span><span class="hs-comment">-- top of the CmmProc.</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="hs-comment">-- It is assumed that the first NatCmmDecl in the input list is a Proc</span><span>
</span><span id="line-747"></span><span class="hs-comment">-- and the rest are CmmDatas.</span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">-- Darwin is simple: just fetch the address of a local label.</span><span>
</span><span id="line-750"></span><span class="hs-comment">-- The FETCHPC pseudo-instruction is expanded to multiple instructions</span><span>
</span><span id="line-751"></span><span class="hs-comment">-- during pretty-printing so that we don't have to deal with the</span><span>
</span><span id="line-752"></span><span class="hs-comment">-- local label:</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="hs-comment">-- PowerPC version:</span><span>
</span><span id="line-755"></span><span class="hs-comment">--          bcl 20,31,1f.</span><span>
</span><span id="line-756"></span><span class="hs-comment">--      1:  mflr picReg</span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span class="hs-comment">-- i386 version:</span><span>
</span><span id="line-759"></span><span class="hs-comment">--          call 1f</span><span>
</span><span id="line-760"></span><span class="hs-comment">--      1:  popl %picReg</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">-- Get a pointer to our own fake GOT, which is defined on a per-module basis.</span><span>
</span><span id="line-765"></span><span class="hs-comment">-- This is exactly how GCC does it in linux.</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#initializePicBase_ppc"><span class="hs-identifier hs-type">initializePicBase_ppc</span></a></span><span>
</span><span id="line-768"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#Arch/GHC.Platform.ArchOS.html#Arch"><span class="hs-identifier hs-type">Arch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OS/GHC.Platform.ArchOS.html#OS"><span class="hs-identifier hs-type">OS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span>
</span><span id="line-769"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PPC.Instr.html#Instr"><span class="hs-identifier hs-type">PPC.Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-770"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span> </span><span class="annot"><a href="GHC.CmmToAsm.PPC.Instr.html#Instr"><span class="hs-identifier hs-type">PPC.Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span id="initializePicBase_ppc"><span class="annot"><span class="annottext">initializePicBase_ppc :: Arch
-&gt; OS
-&gt; Reg
-&gt; [NatCmmDecl RawCmmStatics Instr]
-&gt; NatM [NatCmmDecl RawCmmStatics Instr]
</span><a href="GHC.CmmToAsm.PIC.html#initializePicBase_ppc"><span class="hs-identifier hs-var hs-var">initializePicBase_ppc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchPPC/GHC.Platform.ArchOS.html#ArchPPC"><span class="hs-identifier hs-var">ArchPPC</span></a></span><span> </span><span id="local-6989586621681838220"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838220"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span id="local-6989586621681838221"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838221"><span class="hs-identifier hs-var">picReg</span></a></span></span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621681838223"><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838223"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621681838224"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838224"><span class="hs-identifier hs-var">lab</span></a></span></span><span> </span><span id="local-6989586621681838225"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621681838225"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621681838227"><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838227"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681838228"><span class="annot"><span class="annottext">[NatCmmDecl RawCmmStatics Instr]
</span><a href="#local-6989586621681838228"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838220"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-775"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-777"></span><span>            </span><span id="local-6989586621681838229"><span class="annot"><span class="annottext">gotOffset :: Imm
</span><a href="#local-6989586621681838229"><span class="hs-identifier hs-var hs-var">gotOffset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Imm -&gt; Imm -&gt; Imm
</span><a href="GHC.CmmToAsm.PPC.Regs.html#ImmConstantDiff"><span class="hs-identifier hs-var">PPC.ImmConstantDiff</span></a></span><span>
</span><span id="line-778"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Imm
</span><a href="GHC.CmmToAsm.PPC.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">PPC.ImmCLbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="GHC.CmmToAsm.PIC.html#gotLabel"><span class="hs-identifier hs-var">gotLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabel -&gt; Imm
</span><a href="GHC.CmmToAsm.PPC.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">PPC.ImmCLbl</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="GHC.Cmm.CLabel.html#mkPicBaseLabel"><span class="hs-identifier hs-var">mkPicBaseLabel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>
</span><span id="line-781"></span><span>            </span><span id="local-6989586621681838232"><span class="annot"><span class="annottext">blocks' :: [GenBasicBlock Instr]
</span><a href="#local-6989586621681838232"><span class="hs-identifier hs-var hs-var">blocks'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838227"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-782"></span><span>                       </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-783"></span><span>                       </span><span class="hs-special">(</span><span id="local-6989586621681838233"><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838233"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681838234"><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838234"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838235"><span class="hs-identifier hs-var">fetchPC</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838233"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
-&gt; [GenBasicBlock Instr] -&gt; [GenBasicBlock Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(GenBasicBlock Instr -&gt; GenBasicBlock Instr)
-&gt; [GenBasicBlock Instr] -&gt; [GenBasicBlock Instr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838236"><span class="hs-identifier hs-var">maybeFetchPC</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838234"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span>            </span><span id="local-6989586621681838236"><span class="annot"><span class="annottext">maybeFetchPC :: GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838236"><span class="hs-identifier hs-var hs-var">maybeFetchPC</span></a></span></span><span> </span><span id="local-6989586621681838237"><span class="annot"><span class="annottext">b :: GenBasicBlock Instr
</span><a href="#local-6989586621681838237"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621681838239"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838239"><span class="hs-identifier hs-var">bID</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KeyOf LabelMap
BlockId
</span><a href="#local-6989586621681838239"><span class="hs-identifier hs-var">bID</span></a></span><span> </span><span class="annot"><span class="annottext">KeyOf LabelMap -&gt; LabelMap RawCmmStatics -&gt; Bool
forall a. KeyOf LabelMap -&gt; LabelMap a -&gt; Bool
forall (map :: * -&gt; *) a. IsMap map =&gt; KeyOf map -&gt; map a -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Collections.html#mapMember"><span class="hs-operator hs-var">`mapMember`</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838223"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838235"><span class="hs-identifier hs-var">fetchPC</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838237"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-787"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838237"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span>            </span><span class="hs-comment">-- GCC does PIC prologs thusly:</span><span>
</span><span id="line-790"></span><span>            </span><span class="hs-comment">--     bcl 20,31,.L1</span><span>
</span><span id="line-791"></span><span>            </span><span class="hs-comment">-- .L1:</span><span>
</span><span id="line-792"></span><span>            </span><span class="hs-comment">--     mflr 30</span><span>
</span><span id="line-793"></span><span>            </span><span class="hs-comment">--     addis 30,30,.LCTOC1-.L1@ha</span><span>
</span><span id="line-794"></span><span>            </span><span class="hs-comment">--     addi 30,30,.LCTOC1-.L1@l</span><span>
</span><span id="line-795"></span><span>            </span><span class="hs-comment">-- TODO: below we use it over temporary register,</span><span>
</span><span id="line-796"></span><span>            </span><span class="hs-comment">-- it can and should be optimised by picking</span><span>
</span><span id="line-797"></span><span>            </span><span class="hs-comment">-- correct PIC reg.</span><span>
</span><span id="line-798"></span><span>            </span><span id="local-6989586621681838235"><span class="annot"><span class="annottext">fetchPC :: GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838235"><span class="hs-identifier hs-var hs-var">fetchPC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621681838241"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838241"><span class="hs-identifier hs-var">bID</span></a></span></span><span> </span><span id="local-6989586621681838242"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621681838242"><span class="hs-identifier hs-var">insns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-799"></span><span>              </span><span class="annot"><span class="annottext">BlockId -&gt; [Instr] -&gt; GenBasicBlock Instr
forall i. BlockId -&gt; [i] -&gt; GenBasicBlock i
</span><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838241"><span class="hs-identifier hs-var">bID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg -&gt; Instr
</span><a href="GHC.CmmToAsm.PPC.Instr.html#FETCHPC"><span class="hs-identifier hs-var">PPC.FETCHPC</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838221"><span class="hs-identifier hs-var">picReg</span></a></span><span>
</span><span id="line-800"></span><span>                              </span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; Reg -&gt; Imm -&gt; Instr
</span><a href="GHC.CmmToAsm.PPC.Instr.html#ADDIS"><span class="hs-identifier hs-var">PPC.ADDIS</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838221"><span class="hs-identifier hs-var">picReg</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838221"><span class="hs-identifier hs-var">picReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Imm
</span><a href="GHC.CmmToAsm.PPC.Regs.html#HA"><span class="hs-identifier hs-var">PPC.HA</span></a></span><span> </span><span class="annot"><span class="annottext">Imm
</span><a href="#local-6989586621681838229"><span class="hs-identifier hs-var">gotOffset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>                              </span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; Reg -&gt; RI -&gt; Instr
</span><a href="GHC.CmmToAsm.PPC.Instr.html#ADD"><span class="hs-identifier hs-var">PPC.ADD</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838221"><span class="hs-identifier hs-var">picReg</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838221"><span class="hs-identifier hs-var">picReg</span></a></span><span>
</span><span id="line-802"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; RI
</span><a href="GHC.CmmToAsm.PPC.Instr.html#RIImm"><span class="hs-identifier hs-var">PPC.RIImm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Imm -&gt; Imm
</span><a href="GHC.CmmToAsm.PPC.Regs.html#LO"><span class="hs-identifier hs-var">PPC.LO</span></a></span><span> </span><span class="annot"><span class="annottext">Imm
</span><a href="#local-6989586621681838229"><span class="hs-identifier hs-var">gotOffset</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>                              </span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Reg -&gt; Reg -&gt; Instr
</span><a href="GHC.CmmToAsm.PPC.Instr.html#MR"><span class="hs-identifier hs-var">PPC.MR</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="GHC.CmmToAsm.PPC.Regs.html#r30"><span class="hs-identifier hs-var">PPC.r30</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838221"><span class="hs-identifier hs-var">picReg</span></a></span><span>
</span><span id="line-804"></span><span>                              </span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621681838242"><span class="hs-identifier hs-var">insns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>        </span><span class="annot"><span class="annottext">[NatCmmDecl RawCmmStatics Instr]
-&gt; NatM [NatCmmDecl RawCmmStatics Instr]
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
-&gt; CLabel
-&gt; [GlobalReg]
-&gt; ListGraph Instr
-&gt; NatCmmDecl RawCmmStatics Instr
forall d h g. h -&gt; CLabel -&gt; [GlobalReg] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838223"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838224"><span class="hs-identifier hs-var">lab</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621681838225"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenBasicBlock Instr] -&gt; ListGraph Instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838232"><span class="hs-identifier hs-var">blocks'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NatCmmDecl RawCmmStatics Instr
-&gt; [NatCmmDecl RawCmmStatics Instr]
-&gt; [NatCmmDecl RawCmmStatics Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl RawCmmStatics Instr]
</span><a href="#local-6989586621681838228"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-809"></span><span class="hs-comment">-- Load TOC into register 2</span><span>
</span><span id="line-810"></span><span class="hs-comment">-- PowerPC 64-bit ELF ABI 2.0 requires the address of the callee</span><span>
</span><span id="line-811"></span><span class="hs-comment">-- in register 12.</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- We pass the label to FETCHTOC and create a .localentry too.</span><span>
</span><span id="line-813"></span><span class="hs-comment">-- TODO: Explain this better and refer to ABI spec!</span><span>
</span><span id="line-814"></span><span class="hs-comment">{-
We would like to do approximately this, but spill slot allocation
might be added before the first BasicBlock. That violates the ABI.

For now we will emit the prologue code in the pretty printer,
which is also what we do for ELF v1.
initializePicBase_ppc (ArchPPC_64 ELF_V2) OSLinux picReg
        (CmmProc info lab live (ListGraph (entry:blocks)) : statics)
        = do
           bID &lt;-getUniqueM
           return (CmmProc info lab live (ListGraph (b':entry:blocks))
                                         : statics)
        where   BasicBlock entryID _ = entry
                b' = BasicBlock bID [PPC.FETCHTOC picReg lab,
                                     PPC.BCC PPC.ALWAYS entryID]
-}</span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#initializePicBase_ppc"><span class="hs-identifier hs-var">initializePicBase_ppc</span></a></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Reg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl RawCmmStatics Instr]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-832"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM [NatCmmDecl RawCmmStatics Instr]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initializePicBase_ppc: not needed&quot;</span></span><span>
</span><span id="line-833"></span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="hs-comment">-- We cheat a bit here by defining a pseudo-instruction named FETCHGOT</span><span>
</span><span id="line-836"></span><span class="hs-comment">-- which pretty-prints as:</span><span>
</span><span id="line-837"></span><span class="hs-comment">--              call 1f</span><span>
</span><span id="line-838"></span><span class="hs-comment">-- 1:           popl %picReg</span><span>
</span><span id="line-839"></span><span class="hs-comment">--              addl __GLOBAL_OFFSET_TABLE__+.-1b, %picReg</span><span>
</span><span id="line-840"></span><span class="hs-comment">-- (See PprMach.hs)</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#initializePicBase_x86"><span class="hs-identifier hs-type">initializePicBase_x86</span></a></span><span>
</span><span id="line-843"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#Arch/GHC.Platform.ArchOS.html#Arch"><span class="hs-identifier hs-type">Arch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OS/GHC.Platform.ArchOS.html#OS"><span class="hs-identifier hs-type">OS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span>
</span><span id="line-844"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#Alignment"><span class="hs-identifier hs-type">Alignment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.X86.Instr.html#Instr"><span class="hs-identifier hs-type">X86.Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-845"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.Monad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.CmmToAsm.Types.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#Alignment"><span class="hs-identifier hs-type">Alignment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.html#RawCmmStatics"><span class="hs-identifier hs-type">RawCmmStatics</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.CmmToAsm.X86.Instr.html#Instr"><span class="hs-identifier hs-type">X86.Instr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span id="initializePicBase_x86"><span class="annot"><span class="annottext">initializePicBase_x86 :: Arch
-&gt; OS
-&gt; Reg
-&gt; [NatCmmDecl (Alignment, RawCmmStatics) Instr]
-&gt; NatM [NatCmmDecl (Alignment, RawCmmStatics) Instr]
</span><a href="GHC.CmmToAsm.PIC.html#initializePicBase_x86"><span class="hs-identifier hs-var hs-var">initializePicBase_x86</span></a></span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86/GHC.Platform.ArchOS.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span> </span><span id="local-6989586621681838251"><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838251"><span class="hs-identifier hs-var">os</span></a></span></span><span> </span><span id="local-6989586621681838252"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838252"><span class="hs-identifier hs-var">picReg</span></a></span></span><span>
</span><span id="line-848"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621681838253"><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838253"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621681838254"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838254"><span class="hs-identifier hs-var">lab</span></a></span></span><span> </span><span id="local-6989586621681838255"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621681838255"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span id="local-6989586621681838256"><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838256"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681838257"><span class="annot"><span class="annottext">[NatCmmDecl (Alignment, RawCmmStatics) Instr]
</span><a href="#local-6989586621681838257"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681838251"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-850"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl (Alignment, RawCmmStatics) Instr]
-&gt; NatM [NatCmmDecl (Alignment, RawCmmStatics) Instr]
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
-&gt; CLabel
-&gt; [GlobalReg]
-&gt; ListGraph Instr
-&gt; NatCmmDecl (Alignment, RawCmmStatics) Instr
forall d h g. h -&gt; CLabel -&gt; [GlobalReg] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838253"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838254"><span class="hs-identifier hs-var">lab</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621681838255"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenBasicBlock Instr] -&gt; ListGraph Instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838258"><span class="hs-identifier hs-var">blocks'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NatCmmDecl (Alignment, RawCmmStatics) Instr
-&gt; [NatCmmDecl (Alignment, RawCmmStatics) Instr]
-&gt; [NatCmmDecl (Alignment, RawCmmStatics) Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl (Alignment, RawCmmStatics) Instr]
</span><a href="#local-6989586621681838257"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681838258"><span class="annot"><span class="annottext">blocks' :: [GenBasicBlock Instr]
</span><a href="#local-6989586621681838258"><span class="hs-identifier hs-var hs-var">blocks'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838256"><span class="hs-identifier hs-var">blocks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-852"></span><span>                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-853"></span><span>                     </span><span class="hs-special">(</span><span id="local-6989586621681838259"><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838259"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681838260"><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838260"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838261"><span class="hs-identifier hs-var">fetchGOT</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838259"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
-&gt; [GenBasicBlock Instr] -&gt; [GenBasicBlock Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(GenBasicBlock Instr -&gt; GenBasicBlock Instr)
-&gt; [GenBasicBlock Instr] -&gt; [GenBasicBlock Instr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838262"><span class="hs-identifier hs-var">maybeFetchGOT</span></a></span><span> </span><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838260"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-854"></span><span>
</span><span id="line-855"></span><span>          </span><span class="hs-comment">-- we want to add a FETCHGOT instruction to the beginning of</span><span>
</span><span id="line-856"></span><span>          </span><span class="hs-comment">-- every block that is an entry point, which corresponds to</span><span>
</span><span id="line-857"></span><span>          </span><span class="hs-comment">-- the blocks that have entries in the info-table mapping.</span><span>
</span><span id="line-858"></span><span>          </span><span id="local-6989586621681838262"><span class="annot"><span class="annottext">maybeFetchGOT :: GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838262"><span class="hs-identifier hs-var hs-var">maybeFetchGOT</span></a></span></span><span> </span><span id="local-6989586621681838263"><span class="annot"><span class="annottext">b :: GenBasicBlock Instr
</span><a href="#local-6989586621681838263"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621681838264"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838264"><span class="hs-identifier hs-var">bID</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KeyOf LabelMap
BlockId
</span><a href="#local-6989586621681838264"><span class="hs-identifier hs-var">bID</span></a></span><span> </span><span class="annot"><span class="annottext">KeyOf LabelMap -&gt; LabelMap RawCmmStatics -&gt; Bool
forall a. KeyOf LabelMap -&gt; LabelMap a -&gt; Bool
forall (map :: * -&gt; *) a. IsMap map =&gt; KeyOf map -&gt; map a -&gt; Bool
</span><a href="GHC.Cmm.Dataflow.Collections.html#mapMember"><span class="hs-operator hs-var">`mapMember`</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838253"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838261"><span class="hs-identifier hs-var">fetchGOT</span></a></span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838263"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-860"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838263"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span>          </span><span id="local-6989586621681838261"><span class="annot"><span class="annottext">fetchGOT :: GenBasicBlock Instr -&gt; GenBasicBlock Instr
</span><a href="#local-6989586621681838261"><span class="hs-identifier hs-var hs-var">fetchGOT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621681838265"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838265"><span class="hs-identifier hs-var">bID</span></a></span></span><span> </span><span id="local-6989586621681838266"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621681838266"><span class="hs-identifier hs-var">insns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-863"></span><span>             </span><span class="annot"><span class="annottext">BlockId -&gt; [Instr] -&gt; GenBasicBlock Instr
forall i. BlockId -&gt; [i] -&gt; GenBasicBlock i
</span><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838265"><span class="hs-identifier hs-var">bID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg -&gt; Instr
</span><a href="GHC.CmmToAsm.X86.Instr.html#FETCHGOT"><span class="hs-identifier hs-var">X86.FETCHGOT</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838252"><span class="hs-identifier hs-var">picReg</span></a></span><span> </span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621681838266"><span class="hs-identifier hs-var">insns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#initializePicBase_x86"><span class="hs-identifier hs-var">initializePicBase_x86</span></a></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86/GHC.Platform.ArchOS.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span id="local-6989586621681838268"><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838268"><span class="hs-identifier hs-var">picReg</span></a></span></span><span>
</span><span id="line-866"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-type">CmmProc</span></a></span><span> </span><span id="local-6989586621681838269"><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838269"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621681838270"><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838270"><span class="hs-identifier hs-var">lab</span></a></span></span><span> </span><span id="local-6989586621681838271"><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621681838271"><span class="hs-identifier hs-var">live</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-type">ListGraph</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681838272"><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838272"><span class="hs-identifier hs-var">entry</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681838273"><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838273"><span class="hs-identifier hs-var">blocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681838274"><span class="annot"><span class="annottext">[NatCmmDecl (Alignment, RawCmmStatics) Instr]
</span><a href="#local-6989586621681838274"><span class="hs-identifier hs-var">statics</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl (Alignment, RawCmmStatics) Instr]
-&gt; NatM [NatCmmDecl (Alignment, RawCmmStatics) Instr]
forall a. a -&gt; NatM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
-&gt; CLabel
-&gt; [GlobalReg]
-&gt; ListGraph Instr
-&gt; NatCmmDecl (Alignment, RawCmmStatics) Instr
forall d h g. h -&gt; CLabel -&gt; [GlobalReg] -&gt; g -&gt; GenCmmDecl d h g
</span><a href="GHC.Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a></span><span> </span><span class="annot"><span class="annottext">LabelMap RawCmmStatics
</span><a href="#local-6989586621681838269"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681838270"><span class="hs-identifier hs-var">lab</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalReg]
</span><a href="#local-6989586621681838271"><span class="hs-identifier hs-var">live</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenBasicBlock Instr] -&gt; ListGraph Instr
forall i. [GenBasicBlock i] -&gt; ListGraph i
</span><a href="GHC.Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838275"><span class="hs-identifier hs-var">block'</span></a></span><span class="annot"><span class="annottext">GenBasicBlock Instr
-&gt; [GenBasicBlock Instr] -&gt; [GenBasicBlock Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[GenBasicBlock Instr]
</span><a href="#local-6989586621681838273"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NatCmmDecl (Alignment, RawCmmStatics) Instr
-&gt; [NatCmmDecl (Alignment, RawCmmStatics) Instr]
-&gt; [NatCmmDecl (Alignment, RawCmmStatics) Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl (Alignment, RawCmmStatics) Instr]
</span><a href="#local-6989586621681838274"><span class="hs-identifier hs-var">statics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-type">BasicBlock</span></a></span><span> </span><span id="local-6989586621681838276"><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838276"><span class="hs-identifier hs-var">bID</span></a></span></span><span> </span><span id="local-6989586621681838277"><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621681838277"><span class="hs-identifier hs-var">insns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenBasicBlock Instr
</span><a href="#local-6989586621681838272"><span class="hs-identifier hs-var">entry</span></a></span><span>
</span><span id="line-870"></span><span>          </span><span id="local-6989586621681838275"><span class="annot"><span class="annottext">block' :: GenBasicBlock Instr
</span><a href="#local-6989586621681838275"><span class="hs-identifier hs-var hs-var">block'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockId -&gt; [Instr] -&gt; GenBasicBlock Instr
forall i. BlockId -&gt; [i] -&gt; GenBasicBlock i
</span><a href="GHC.Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a></span><span> </span><span class="annot"><span class="annottext">BlockId
</span><a href="#local-6989586621681838276"><span class="hs-identifier hs-var">bID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reg -&gt; Instr
</span><a href="GHC.CmmToAsm.X86.Instr.html#FETCHPC"><span class="hs-identifier hs-var">X86.FETCHPC</span></a></span><span> </span><span class="annot"><span class="annottext">Reg
</span><a href="#local-6989586621681838268"><span class="hs-identifier hs-var">picReg</span></a></span><span> </span><span class="annot"><span class="annottext">Instr -&gt; [Instr] -&gt; [Instr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Instr]
</span><a href="#local-6989586621681838277"><span class="hs-identifier hs-var">insns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span class="annot"><a href="GHC.CmmToAsm.PIC.html#initializePicBase_x86"><span class="hs-identifier hs-var">initializePicBase_x86</span></a></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Reg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[NatCmmDecl (Alignment, RawCmmStatics) Instr]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-873"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NatM [NatCmmDecl (Alignment, RawCmmStatics) Instr]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initializePicBase_x86: not needed&quot;</span></span><span>
</span><span id="line-874"></span></pre></body></html>