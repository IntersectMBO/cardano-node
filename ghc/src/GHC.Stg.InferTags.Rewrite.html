<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">--</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- Copyright (c) 2019 Andreas Klebinger</span><span>
</span><span id="line-3"></span><span class="hs-comment">--</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns               #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE CPP                        #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE DataKinds                  #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances          #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE GADTs                      #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE GeneralisedNewtypeDeriving #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses      #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes                 #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TupleSections              #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies               #-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Stg.InferTags.Rewrite</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTopBinds"><span class="hs-identifier">rewriteTopBinds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html#PrimOp"><span class="hs-identifier">PrimOp</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#CbvMark"><span class="hs-identifier">CbvMark</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#isMarkedCbv"><span class="hs-identifier">isMarkedCbv</span></a></span><span>
</span><span id="line-25"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier">TopLevelFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier">isTopLevel</span></a></span><span>
</span><span id="line-26"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Levity"><span class="hs-identifier">Levity</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.html#AltCon"><span class="hs-identifier">AltCon</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html"><span class="hs-identifier">GHC.StgToCmm.Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#mkLFImported"><span class="hs-identifier">mkLFImported</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Utils.html"><span class="hs-identifier">GHC.Stg.Utils</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">StgSyn</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.State.Strict.html"><span class="hs-identifier">GHC.Utils.Monad.State.Strict</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html"><span class="hs-identifier">GHC.Stg.InferTags.Types</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">newtype</span><span> </span><span id="RM"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span></span><span> </span><span id="local-6989586621681854568"><span class="annot"><a href="#local-6989586621681854568"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RM"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unRM"><span class="annot"><span class="annottext">forall a.
RM a -&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a
</span><a href="GHC.Stg.InferTags.Rewrite.html#unRM"><span class="hs-identifier hs-var hs-var">unRM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Monad.State.Strict.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681854568"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681854912"><span id="local-6989586621681854916"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; RM a -&gt; RM b)
-&gt; (forall a b. a -&gt; RM b -&gt; RM a) -&gt; Functor RM
forall a b. a -&gt; RM b -&gt; RM a
forall a b. (a -&gt; b) -&gt; RM a -&gt; RM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; RM a -&gt; RM b
fmap :: forall a b. (a -&gt; b) -&gt; RM a -&gt; RM b
$c&lt;$ :: forall a b. a -&gt; RM b -&gt; RM a
&lt;$ :: forall a b. a -&gt; RM b -&gt; RM a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#Functor/GHC.Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681854923"><span id="local-6989586621681854927"><span id="local-6989586621681854931"><span class="annot"><span class="annottext">Applicative RM
Applicative RM =&gt;
(forall a b. RM a -&gt; (a -&gt; RM b) -&gt; RM b)
-&gt; (forall a b. RM a -&gt; RM b -&gt; RM b)
-&gt; (forall a. a -&gt; RM a)
-&gt; Monad RM
forall a. a -&gt; RM a
forall a b. RM a -&gt; RM b -&gt; RM b
forall a b. RM a -&gt; (a -&gt; RM b) -&gt; RM b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. RM a -&gt; (a -&gt; RM b) -&gt; RM b
&gt;&gt;= :: forall a b. RM a -&gt; (a -&gt; RM b) -&gt; RM b
$c&gt;&gt; :: forall a b. RM a -&gt; RM b -&gt; RM b
&gt;&gt; :: forall a b. RM a -&gt; RM b -&gt; RM b
$creturn :: forall a. a -&gt; RM a
return :: forall a. a -&gt; RM a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#Monad/GHC.Base.html#Monad"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681854938"><span id="local-6989586621681854943"><span id="local-6989586621681854947"><span id="local-6989586621681854951"><span id="local-6989586621681854955"><span class="annot"><span class="annottext">Functor RM
Functor RM =&gt;
(forall a. a -&gt; RM a)
-&gt; (forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; RM a -&gt; RM b -&gt; RM c)
-&gt; (forall a b. RM a -&gt; RM b -&gt; RM b)
-&gt; (forall a b. RM a -&gt; RM b -&gt; RM a)
-&gt; Applicative RM
forall a. a -&gt; RM a
forall a b. RM a -&gt; RM b -&gt; RM a
forall a b. RM a -&gt; RM b -&gt; RM b
forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
forall a b c. (a -&gt; b -&gt; c) -&gt; RM a -&gt; RM b -&gt; RM c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; RM a
pure :: forall a. a -&gt; RM a
$c&lt;*&gt; :: forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
&lt;*&gt; :: forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
$cliftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; RM a -&gt; RM b -&gt; RM c
liftA2 :: forall a b c. (a -&gt; b -&gt; c) -&gt; RM a -&gt; RM b -&gt; RM c
$c*&gt; :: forall a b. RM a -&gt; RM b -&gt; RM b
*&gt; :: forall a b. RM a -&gt; RM b -&gt; RM b
$c&lt;* :: forall a b. RM a -&gt; RM b -&gt; RM a
&lt;* :: forall a b. RM a -&gt; RM b -&gt; RM a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#Applicative/GHC.Base.html#Applicative"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">------------------------------------------------------------</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- Add cases around strict fields where required.</span><span>
</span><span id="line-61"></span><span class="hs-comment">------------------------------------------------------------</span><span>
</span><span id="line-62"></span><span class="hs-comment">{-
The work of this pass is simple:
* We traverse the STG AST looking for constructor allocations.
* For all allocations we check if there are strict fields in the constructor.
* For any strict field we check if the argument is known to be properly tagged.
* If it's not known to be properly tagged, we wrap the whole thing in a case,
  which will force the argument before allocation.
This is described in detail in Note [Strict Field Invariant].

The only slight complication is that we have to make sure not to invalidate free
variable analysis in the process.

Note [Partially applied workers]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Sometimes we will get a function f of the form
    -- Arity 1
    f :: Dict a -&gt; a -&gt; b -&gt; (c -&gt; d)
    f dict a b = case dict of
        C m1 m2 -&gt; m1 a b

Which will result in a W/W split along the lines of
    -- Arity 1
    f :: Dict a -&gt; a -&gt; b -&gt; (c -&gt; d)
    f dict a = case dict of
        C m1 m2 -&gt; $wf m1 a b

    -- Arity 4
    $wf :: (a -&gt; b -&gt; d -&gt; c) -&gt; a -&gt; b -&gt; c -&gt; d
    $wf m1 a b c = m1 a b c

It's notable that the worker is called *undersaturated* in the wrapper.
At runtime what happens is that the wrapper will allocate a PAP which
once fully applied will call the worker. And all is fine.

But what about a call by value function! Well the function returned by `f` would
be a unknown call, so we lose the ability to enforce the invariant that
cbv marked arguments from StictWorkerId's are actually properly tagged
as the annotations would be unavailable at the (unknown) call site.

The fix is easy. We eta-expand all calls to functions taking call-by-value
arguments during CorePrep just like we do with constructor allocations.

Note [Upholding free variable annotations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The code generator requires us to maintain exact information
about free variables about closures. Since we convert some
RHSs from constructor allocations to closures we have to provide
fvs of these closures. Not all constructor arguments will become
free variables. Only these which are not bound at the top level
have to be captured.
To facilitate this we keep track of a set of locally bound variables in
the current context which we then use to filter constructor arguments
when building the free variable list.
-}</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- Utilities</span><span>
</span><span id="line-119"></span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681854963"><span id="local-6989586621681854966"><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621681854972"><span class="annot"><span class="annottext">getUniqueSupplyM :: RM UniqSupply
</span><a href="#local-6989586621681854972"><span class="hs-identifier hs-var hs-var hs-var hs-var">getUniqueSupplyM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (UniqFM Id TagSig, UniqSupply, Module, IdSet) UniqSupply
-&gt; RM UniqSupply
forall a.
State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (UniqFM Id TagSig, UniqSupply, Module, IdSet) UniqSupply
 -&gt; RM UniqSupply)
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) UniqSupply
-&gt; RM UniqSupply
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681854974"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854974"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681854975"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854975"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681854976"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854976"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681854977"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854977"><span class="hs-identifier hs-var">lcls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
forall s. State s s
</span><a href="GHC.Utils.Monad.State.Strict.html#get"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681854979"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854979"><span class="hs-identifier hs-var">us1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681854980"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854980"><span class="hs-identifier hs-var">us2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; (UniqSupply, UniqSupply)
</span><a href="GHC.Types.Unique.Supply.html#splitUniqSupply"><span class="hs-identifier hs-var">splitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854975"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s. s -&gt; State s ()
</span><a href="GHC.Utils.Monad.State.Strict.html#put"><span class="hs-identifier hs-var">put</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854974"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854980"><span class="hs-identifier hs-var">us2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854976"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854977"><span class="hs-identifier hs-var">lcls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="annottext">UniqSupply
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) UniqSupply
forall a.
a -&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854979"><span class="hs-identifier hs-var">us1</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-type">getMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span id="getMap"><span class="annot"><span class="annottext">getMap :: RM (UniqFM Id TagSig)
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-var hs-var">getMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet) (UniqFM Id TagSig)
-&gt; RM (UniqFM Id TagSig)
forall a.
State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span><span> </span><span class="annot"><span class="annottext">(State
   (UniqFM Id TagSig, UniqSupply, Module, IdSet) (UniqFM Id TagSig)
 -&gt; RM (UniqFM Id TagSig))
-&gt; State
     (UniqFM Id TagSig, UniqSupply, Module, IdSet) (UniqFM Id TagSig)
-&gt; RM (UniqFM Id TagSig)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681854984"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854984"><span class="hs-identifier hs-var">fst</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IdSet
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854984"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((UniqFM Id TagSig, UniqSupply, Module, IdSet) -&gt; UniqFM Id TagSig)
-&gt; State
     (UniqFM Id TagSig, UniqSupply, Module, IdSet)
     (UniqFM Id TagSig, UniqSupply, Module, IdSet)
-&gt; State
     (UniqFM Id TagSig, UniqSupply, Module, IdSet) (UniqFM Id TagSig)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
forall s. State s s
</span><a href="GHC.Utils.Monad.State.Strict.html#get"><span class="hs-identifier hs-var">get</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-type">setMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.FM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span id="setMap"><span class="annot"><span class="annottext">setMap :: UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var hs-var">setMap</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681854987"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854987"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (UniqFM Id TagSig, UniqSupply, Module, IdSet) () -&gt; RM ()
forall a.
State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (UniqFM Id TagSig, UniqSupply, Module, IdSet) () -&gt; RM ())
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) () -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681854988"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854988"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681854989"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854989"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681854990"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854990"><span class="hs-identifier hs-var">lcls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
forall s. State s s
</span><a href="GHC.Utils.Monad.State.Strict.html#get"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">(UniqFM Id TagSig, UniqSupply, Module, IdSet)
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) ()
forall s. s -&gt; State s ()
</span><a href="GHC.Utils.Monad.State.Strict.html#put"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854987"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854988"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854989"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854990"><span class="hs-identifier hs-var">lcls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#getMod"><span class="hs-identifier hs-type">getMod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-137"></span><span id="getMod"><span class="annot"><span class="annottext">getMod :: RM Module
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMod"><span class="hs-identifier hs-var hs-var">getMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (UniqFM Id TagSig, UniqSupply, Module, IdSet) Module
-&gt; RM Module
forall a.
State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (UniqFM Id TagSig, UniqSupply, Module, IdSet) Module
 -&gt; RM Module)
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) Module
-&gt; RM Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681854992"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854992"><span class="hs-identifier hs-var">thrd</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IdSet
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854992"><span class="hs-identifier hs-var">thrd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((UniqFM Id TagSig, UniqSupply, Module, IdSet) -&gt; Module)
-&gt; State
     (UniqFM Id TagSig, UniqSupply, Module, IdSet)
     (UniqFM Id TagSig, UniqSupply, Module, IdSet)
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) Module
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
forall s. State s s
</span><a href="GHC.Utils.Monad.State.Strict.html#get"><span class="hs-identifier hs-var">get</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#getFVs"><span class="hs-identifier hs-type">getFVs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>
</span><span id="line-140"></span><span id="getFVs"><span class="annot"><span class="annottext">getFVs :: RM IdSet
</span><a href="GHC.Stg.InferTags.Rewrite.html#getFVs"><span class="hs-identifier hs-var hs-var">getFVs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (UniqFM Id TagSig, UniqSupply, Module, IdSet) IdSet
-&gt; RM IdSet
forall a.
State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (UniqFM Id TagSig, UniqSupply, Module, IdSet) IdSet
 -&gt; RM IdSet)
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) IdSet
-&gt; RM IdSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UniqSupply
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681854994"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854994"><span class="hs-identifier hs-var">lcls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854994"><span class="hs-identifier hs-var">lcls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((UniqFM Id TagSig, UniqSupply, Module, IdSet) -&gt; IdSet)
-&gt; State
     (UniqFM Id TagSig, UniqSupply, Module, IdSet)
     (UniqFM Id TagSig, UniqSupply, Module, IdSet)
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) IdSet
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
forall s. State s s
</span><a href="GHC.Utils.Monad.State.Strict.html#get"><span class="hs-identifier hs-var">get</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-type">setFVs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span id="setFVs"><span class="annot"><span class="annottext">setFVs :: IdSet -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-var hs-var">setFVs</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681854996"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854996"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (UniqFM Id TagSig, UniqSupply, Module, IdSet) () -&gt; RM ()
forall a.
State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-var">RM</span></a></span><span> </span><span class="annot"><span class="annottext">(State (UniqFM Id TagSig, UniqSupply, Module, IdSet) () -&gt; RM ())
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) () -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681854997"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854997"><span class="hs-identifier hs-var">tag_map</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681854998"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854998"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681854999"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854999"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681855000"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855000"><span class="hs-identifier hs-var">_lcls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
  (UniqFM Id TagSig, UniqSupply, Module, IdSet)
forall s. State s s
</span><a href="GHC.Utils.Monad.State.Strict.html#get"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">(UniqFM Id TagSig, UniqSupply, Module, IdSet)
-&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) ()
forall s. s -&gt; State s ()
</span><a href="GHC.Utils.Monad.State.Strict.html#put"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681854997"><span class="hs-identifier hs-var">tag_map</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681854998"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681854999"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681854996"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">-- Rewrite the RHS(s) while making the id and it's sig available</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- to determine if things are tagged/need to be captured as FV.</span><span>
</span><span id="line-149"></span><span id="local-6989586621681854628"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#withBind"><span class="hs-identifier hs-type">withBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854628"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854628"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-150"></span><span id="withBind"><span class="annot"><span class="annottext">withBind :: forall a.
TopLevelFlag -&gt; GenStgBinding 'InferTaggedBinders -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBind"><span class="hs-identifier hs-var hs-var">withBind</span></a></span></span><span> </span><span id="local-6989586621681855002"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855002"><span class="hs-identifier hs-var">top_flag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681855004"><span class="annot"><span class="annottext">BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855004"><span class="hs-identifier hs-var">bnd</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681855005"><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855005"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; (Id, TagSig) -&gt; RM a -&gt; RM a
forall a. TopLevelFlag -&gt; (Id, TagSig) -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBinder"><span class="hs-identifier hs-var">withBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855002"><span class="hs-identifier hs-var">top_flag</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig)
BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855004"><span class="hs-identifier hs-var">bnd</span></a></span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855005"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-151"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#withBind"><span class="hs-identifier hs-var">withBind</span></a></span><span> </span><span id="local-6989586621681855007"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855007"><span class="hs-identifier hs-var">top_flag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681855009"><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681855009"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681855010"><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855010"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855011"><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855011"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681855012"><span class="annot"><span class="annottext">[GenStgRhs 'InferTaggedBinders]
</span><a href="#local-6989586621681855012"><span class="hs-identifier hs-var">_rhss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
-&gt; ([(Id, TagSig)], [GenStgRhs 'InferTaggedBinders])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.3.0/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681855009"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgRhs"><span class="hs-identifier hs-type">GenStgRhs</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; [(Id, TagSig)] -&gt; RM a -&gt; RM a
forall a. TopLevelFlag -&gt; [(Id, TagSig)] -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBinders"><span class="hs-identifier hs-var">withBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855007"><span class="hs-identifier hs-var">top_flag</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855011"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855010"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#addTopBind"><span class="hs-identifier hs-type">addTopBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgBinding"><span class="hs-identifier hs-type">GenStgBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span id="addTopBind"><span class="annot"><span class="annottext">addTopBind :: GenStgBinding 'InferTaggedBinders -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#addTopBind"><span class="hs-identifier hs-var hs-var">addTopBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855016"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855016"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681855017"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681855017"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621681855018"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855018"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM (UniqFM Id TagSig)
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-var">getMap</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">-- pprTraceM &quot;AddBind&quot; (ppr id)</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqFM Id TagSig -&gt; RM ()) -&gt; UniqFM Id TagSig -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; Id -&gt; TagSig -&gt; UniqFM Id TagSig
forall key elt.
Uniquable key =&gt;
UniqFM key elt -&gt; key -&gt; elt -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855018"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855016"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681855017"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; RM ()
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#addTopBind"><span class="hs-identifier hs-var">addTopBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681855020"><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681855020"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855021"><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855021"><span class="hs-identifier hs-var">bnds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681855022"><span class="annot"><span class="annottext">[GenStgRhs 'InferTaggedBinders]
</span><a href="#local-6989586621681855022"><span class="hs-identifier hs-var">_rhss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
-&gt; ([(Id, TagSig)], [GenStgRhs 'InferTaggedBinders])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.3.0/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681855020"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681855023"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855023"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM (UniqFM Id TagSig)
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-var">getMap</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- pprTraceM &quot;AddBinds&quot; (ppr $ map fst bnds)</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqFM Id TagSig -&gt; RM ()) -&gt; UniqFM Id TagSig -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; [(Id, TagSig)] -&gt; UniqFM Id TagSig
forall key elt.
Uniquable key =&gt;
UniqFM key elt -&gt; [(key, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#addListToUFM"><span class="hs-identifier hs-var">addListToUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855023"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855021"><span class="hs-identifier hs-var">bnds</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span id="local-6989586621681854632"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#withBinder"><span class="hs-identifier hs-type">withBinder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854632"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854632"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-168"></span><span id="withBinder"><span class="annot"><span class="annottext">withBinder :: forall a. TopLevelFlag -&gt; (Id, TagSig) -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBinder"><span class="hs-identifier hs-var hs-var">withBinder</span></a></span></span><span> </span><span id="local-6989586621681855032"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855032"><span class="hs-identifier hs-var">top_flag</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855033"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855033"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681855034"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681855034"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681855035"><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855035"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621681855036"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855036"><span class="hs-identifier hs-var">oldMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM (UniqFM Id TagSig)
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-var">getMap</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqFM Id TagSig -&gt; RM ()) -&gt; UniqFM Id TagSig -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; Id -&gt; TagSig -&gt; UniqFM Id TagSig
forall key elt.
Uniquable key =&gt;
UniqFM key elt -&gt; key -&gt; elt -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855036"><span class="hs-identifier hs-var">oldMap</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855033"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681855034"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621681855037"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855037"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855032"><span class="hs-identifier hs-var">top_flag</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855035"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-173"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM a -&gt; RM a
forall a. Id -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withLcl"><span class="hs-identifier hs-var">withLcl</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855033"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855035"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855036"><span class="hs-identifier hs-var">oldMap</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; RM a
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855037"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span id="local-6989586621681854635"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#withBinders"><span class="hs-identifier hs-type">withBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854635"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854635"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-178"></span><span id="withBinders"><span class="annot"><span class="annottext">withBinders :: forall a. TopLevelFlag -&gt; [(Id, TagSig)] -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBinders"><span class="hs-identifier hs-var hs-var">withBinders</span></a></span></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#TopLevel"><span class="hs-identifier hs-var">TopLevel</span></a></span><span> </span><span id="local-6989586621681855055"><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855055"><span class="hs-identifier hs-var">sigs</span></a></span></span><span> </span><span id="local-6989586621681855056"><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855056"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621681855057"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855057"><span class="hs-identifier hs-var">oldMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM (UniqFM Id TagSig)
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-var">getMap</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqFM Id TagSig -&gt; RM ()) -&gt; UniqFM Id TagSig -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; [(Id, TagSig)] -&gt; UniqFM Id TagSig
forall key elt.
Uniquable key =&gt;
UniqFM key elt -&gt; [(key, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#addListToUFM"><span class="hs-identifier hs-var">addListToUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855057"><span class="hs-identifier hs-var">oldMap</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855055"><span class="hs-identifier hs-var">sigs</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621681855058"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855058"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855056"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855057"><span class="hs-identifier hs-var">oldMap</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; RM a
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855058"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-184"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#withBinders"><span class="hs-identifier hs-var">withBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span id="local-6989586621681855060"><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855060"><span class="hs-identifier hs-var">sigs</span></a></span></span><span> </span><span id="local-6989586621681855061"><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855061"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621681855062"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855062"><span class="hs-identifier hs-var">oldMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM (UniqFM Id TagSig)
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-var">getMap</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621681855063"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855063"><span class="hs-identifier hs-var">oldFvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM IdSet
</span><a href="GHC.Stg.InferTags.Rewrite.html#getFVs"><span class="hs-identifier hs-var">getFVs</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqFM Id TagSig -&gt; RM ()) -&gt; UniqFM Id TagSig -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; [(Id, TagSig)] -&gt; UniqFM Id TagSig
forall key elt.
Uniquable key =&gt;
UniqFM key elt -&gt; [(key, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#addListToUFM"><span class="hs-identifier hs-var">addListToUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855062"><span class="hs-identifier hs-var">oldMap</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855060"><span class="hs-identifier hs-var">sigs</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">IdSet -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-var">setFVs</span></a></span><span> </span><span class="annot"><span class="annottext">(IdSet -&gt; RM ()) -&gt; IdSet -&gt; RM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet -&gt; [Id] -&gt; IdSet
</span><a href="GHC.Types.Var.Set.html#extendVarSetList"><span class="hs-identifier hs-var">extendVarSetList</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855063"><span class="hs-identifier hs-var">oldFvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Id, TagSig) -&gt; Id) -&gt; [(Id, TagSig)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; Id
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
</span><a href="#local-6989586621681855060"><span class="hs-identifier hs-var">sigs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621681855066"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855066"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855061"><span class="hs-identifier hs-var">cont</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setMap"><span class="hs-identifier hs-var">setMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855062"><span class="hs-identifier hs-var">oldMap</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">IdSet -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-var">setFVs</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855063"><span class="hs-identifier hs-var">oldFvs</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; RM a
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855066"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | Compute the argument with the given set of ids treated as requiring capture</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- as free variables.</span><span>
</span><span id="line-196"></span><span id="local-6989586621681854648"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#withClosureLcls"><span class="hs-identifier hs-type">withClosureLcls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854648"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854648"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-197"></span><span id="withClosureLcls"><span class="annot"><span class="annottext">withClosureLcls :: forall a. DIdSet -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withClosureLcls"><span class="hs-identifier hs-var hs-var">withClosureLcls</span></a></span></span><span> </span><span id="local-6989586621681855073"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621681855073"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681855074"><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855074"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621681855075"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855075"><span class="hs-identifier hs-var">old_fvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM IdSet
</span><a href="GHC.Stg.InferTags.Rewrite.html#getFVs"><span class="hs-identifier hs-var">getFVs</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681855076"><span class="annot"><span class="annottext">fvs' :: IdSet
</span><a href="#local-6989586621681855076"><span class="hs-identifier hs-var hs-var">fvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; IdSet -&gt; IdSet) -&gt; IdSet -&gt; DIdSet -&gt; IdSet
forall a. (Id -&gt; a -&gt; a) -&gt; a -&gt; DIdSet -&gt; a
</span><a href="GHC.Types.Var.Set.html#nonDetStrictFoldDVarSet"><span class="hs-identifier hs-var">nonDetStrictFoldDVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(IdSet -&gt; Id -&gt; IdSet) -&gt; Id -&gt; IdSet -&gt; IdSet
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet -&gt; Id -&gt; IdSet
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855075"><span class="hs-identifier hs-var">old_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621681855073"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">IdSet -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-var">setFVs</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855076"><span class="hs-identifier hs-var">fvs'</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681855080"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855080"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855074"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">IdSet -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-var">setFVs</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855075"><span class="hs-identifier hs-var">old_fvs</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; RM a
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855080"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- | Compute the argument with the given id treated as requiring capture</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- as free variables in closures.</span><span>
</span><span id="line-207"></span><span id="local-6989586621681854641"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#withLcl"><span class="hs-identifier hs-type">withLcl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854641"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854641"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-208"></span><span id="withLcl"><span class="annot"><span class="annottext">withLcl :: forall a. Id -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withLcl"><span class="hs-identifier hs-var hs-var">withLcl</span></a></span></span><span> </span><span id="local-6989586621681855086"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855086"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681855087"><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855087"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621681855088"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855088"><span class="hs-identifier hs-var">old_fvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM IdSet
</span><a href="GHC.Stg.InferTags.Rewrite.html#getFVs"><span class="hs-identifier hs-var">getFVs</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681855089"><span class="annot"><span class="annottext">fvs' :: IdSet
</span><a href="#local-6989586621681855089"><span class="hs-identifier hs-var hs-var">fvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdSet -&gt; Id -&gt; IdSet
</span><a href="GHC.Types.Var.Set.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855088"><span class="hs-identifier hs-var">old_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855086"><span class="hs-identifier hs-var">fv</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">IdSet -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-var">setFVs</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855089"><span class="hs-identifier hs-var">fvs'</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681855090"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855090"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM a
</span><a href="#local-6989586621681855087"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">IdSet -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#setFVs"><span class="hs-identifier hs-var">setFVs</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855088"><span class="hs-identifier hs-var">old_fvs</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; RM a
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855090"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">{- Note [Tag inference for interactive contexts]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When compiling bytecode we call myCoreToStg to get STG code first.
myCoreToStg in turn calls out to stg2stg which runs the STG to STG
passes followed by free variables analysis and the tag inference pass including
it's rewriting phase at the end.
Running tag inference is important as it upholds Note [Strict Field Invariant].
While code executed by GHCi doesn't take advantage of the SFI it can call into
compiled code which does. So it must still make sure that the SFI is upheld.
See also #21083 and #22042.

However there one important difference in code generation for GHCi and regular
compilation. When compiling an entire module (not a GHCi expression), we call
`stg2stg` on the entire module which allows us to build up a map which is guaranteed
to have an entry for every binder in the current module.
For non-interactive compilation the tag inference rewrite pass takes advantage
of this by building up a map from binders to their tag signatures.

When compiling a GHCi expression on the other hand we invoke stg2stg separately
for each expression on the prompt. This means in GHCi for a sequence of:
    &gt; let x = True
    &gt; let y = StrictJust x
We first run stg2stg for `[x = True]`. And then again for [y = StrictJust x]`.

While computing the tag signature for `y` during tag inference inferConTag will check
if `x` is already tagged by looking up the tagsig of `x` in the binder-&gt;signature mapping.
However since this mapping isn't persistent between stg2stg
invocations the lookup will fail. This isn't a correctness issue since it's always
safe to assume a binding isn't tagged and that's what we do in such cases.

However for non-interactive mode we *don't* want to do this. Since in non-interactive mode
we have all binders of the module available for each invocation we can expect the binder-&gt;signature
mapping to be complete and all lookups to succeed. This means in non-interactive contexts a failed lookup
indicates a bug in the tag inference implementation.
For this reason we assert that we are running in interactive mode if a lookup fails.
-}</span><span>
</span><span id="line-252"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#isTagged"><span class="hs-identifier hs-type">isTagged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-253"></span><span id="isTagged"><span class="annot"><span class="annottext">isTagged :: Id -&gt; RM Bool
</span><a href="GHC.Stg.InferTags.Rewrite.html#isTagged"><span class="hs-identifier hs-var hs-var">isTagged</span></a></span></span><span> </span><span id="local-6989586621681855092"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855092"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621681855093"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681855093"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM Module
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMod"><span class="hs-identifier hs-var">getMod</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-comment">-- See Note [Tag inference for interactive contexts]</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855094"><span class="annot"><span class="annottext">lookupDefault :: Id -&gt; TagSig
</span><a href="#local-6989586621681855094"><span class="hs-identifier hs-var hs-var">lookupDefault</span></a></span></span><span> </span><span id="local-6989586621681855095"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855095"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TagSig -&gt; TagSig
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-var">isInteractiveModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681855093"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unknown Id:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681855093"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855095"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681855093"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855092"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-261"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Levity
</span><a href="GHC.Types.Basic.html#Unlifted"><span class="hs-identifier hs-var">Unlifted</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Maybe Levity
Type -&gt; Maybe Levity
</span><a href="GHC.Core.Type.html#typeLevity_maybe"><span class="hs-identifier hs-var">typeLevity_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855092"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>              </span><span class="hs-comment">-- NB: v might be the Id of a representation-polymorphic join point,</span><span>
</span><span id="line-263"></span><span>              </span><span class="hs-comment">-- so we shouldn't use isUnliftedType here. See T22212.</span><span>
</span><span id="line-264"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RM Bool
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-265"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Local binding</span><span>
</span><span id="line-266"></span><span>                </span><span class="hs-glyph">!</span><span id="local-6989586621681855109"><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855109"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM (UniqFM Id TagSig)
</span><a href="GHC.Stg.InferTags.Rewrite.html#getMap"><span class="hs-identifier hs-var">getMap</span></a></span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681855110"><span class="annot"><span class="annottext">sig :: TagSig
</span><a href="#local-6989586621681855110"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig -&gt; TagSig -&gt; Id -&gt; TagSig
forall key elt.
Uniquable key =&gt;
UniqFM key elt -&gt; elt -&gt; key -&gt; elt
</span><a href="GHC.Types.Unique.FM.html#lookupWithDefaultUFM"><span class="hs-identifier hs-var">lookupWithDefaultUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM Id TagSig
</span><a href="#local-6989586621681855109"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TagSig
</span><a href="#local-6989586621681855094"><span class="hs-identifier hs-var">lookupDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855092"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855092"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-268"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; RM Bool
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; RM Bool) -&gt; Bool -&gt; RM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681855110"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-269"></span><span>                    </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span> </span><span id="local-6989586621681855112"><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681855112"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-270"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="#local-6989586621681855112"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>                            </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagDunno"><span class="hs-identifier hs-var">TagDunno</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-272"></span><span>                            </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-273"></span><span>                            </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagTagged"><span class="hs-identifier hs-var">TagTagged</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-274"></span><span>                            </span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagTuple"><span class="hs-identifier hs-type">TagTuple</span></a></span><span> </span><span class="annot"><span class="annottext">[TagInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Consider unboxed tuples tagged.</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- Imported</span><span>
</span><span id="line-276"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RM Bool
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; RM Bool) -&gt; Bool -&gt; RM Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span>
</span><span id="line-277"></span><span>                </span><span class="hs-comment">-- Determine whether it is tagged from the LFInfo of the imported id.</span><span>
</span><span id="line-278"></span><span>                </span><span class="hs-comment">-- See Note [The LFInfo of Imported Ids]</span><span>
</span><span id="line-279"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; LambdaFormInfo
</span><a href="GHC.StgToCmm.Closure.html#mkLFImported"><span class="hs-identifier hs-var">mkLFImported</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855092"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-280"></span><span>                    </span><span class="hs-comment">-- Function, applied not entered.</span><span>
</span><span id="line-281"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LFReEntrant"><span class="hs-identifier hs-type">LFReEntrant</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-282"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-283"></span><span>                    </span><span class="hs-comment">-- Thunks need to be entered.</span><span>
</span><span id="line-284"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LFThunk"><span class="hs-identifier hs-type">LFThunk</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-285"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-286"></span><span>                    </span><span class="hs-comment">-- LFCon means we already know the tag, and it's tagged.</span><span>
</span><span id="line-287"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LFCon"><span class="hs-identifier hs-type">LFCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-288"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-289"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LFUnknown"><span class="hs-identifier hs-type">LFUnknown</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-290"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-291"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LFUnlifted"><span class="hs-identifier hs-type">LFUnlifted</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-292"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-293"></span><span>                    </span><span class="annot"><a href="GHC.StgToCmm.Types.html#LFLetNoEscape"><span class="hs-identifier hs-type">LFLetNoEscape</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-294"></span><span>                    </span><span class="hs-comment">-- Shouldn't be possible. I don't think we can export letNoEscapes</span><span>
</span><span id="line-295"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#isArgTagged"><span class="hs-identifier hs-type">isArgTagged</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-299"></span><span id="isArgTagged"><span class="annot"><span class="annottext">isArgTagged :: StgArg -&gt; RM Bool
</span><a href="GHC.Stg.InferTags.Rewrite.html#isArgTagged"><span class="hs-identifier hs-var hs-var">isArgTagged</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; RM Bool
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-300"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#isArgTagged"><span class="hs-identifier hs-var">isArgTagged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681855125"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855125"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM Bool
</span><a href="GHC.Stg.InferTags.Rewrite.html#isTagged"><span class="hs-identifier hs-var">isTagged</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855125"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#mkLocalArgId"><span class="hs-identifier hs-type">mkLocalArgId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-303"></span><span id="mkLocalArgId"><span class="annot"><span class="annottext">mkLocalArgId :: Id -&gt; RM Id
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkLocalArgId"><span class="hs-identifier hs-var hs-var">mkLocalArgId</span></a></span></span><span> </span><span id="local-6989586621681855127"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855127"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681855128"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681855128"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM Unique
forall (m :: * -&gt; *). MonadUnique m =&gt; m Unique
</span><a href="GHC.Types.Unique.Supply.html#getUniqueM"><span class="hs-identifier hs-var">getUniqueM</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">Id -&gt; RM Id
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; RM Id) -&gt; Id -&gt; RM Id
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Unique -&gt; Id
</span><a href="GHC.Types.Id.html#setIdUnique"><span class="hs-identifier hs-var">setIdUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id
</span><a href="GHC.Types.Id.html#localiseId"><span class="hs-identifier hs-var">localiseId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855127"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681855128"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- Actual rewrite pass</span><span>
</span><span id="line-309"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTopBinds"><span class="hs-identifier hs-type">rewriteTopBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgTopBinding"><span class="hs-identifier hs-type">GenStgTopBinding</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Stg.Syntax.html#InferTaggedBinders"><span class="hs-identifier hs-type">InferTaggedBinders</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgTopBinding"><span class="hs-identifier hs-type">TgStgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-313"></span><span id="rewriteTopBinds"><span class="annot"><span class="annottext">rewriteTopBinds :: Module
-&gt; UniqSupply
-&gt; [GenStgTopBinding 'InferTaggedBinders]
-&gt; [TgStgTopBinding]
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTopBinds"><span class="hs-identifier hs-var hs-var">rewriteTopBinds</span></a></span></span><span> </span><span id="local-6989586621681855132"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681855132"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681855133"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681855133"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621681855134"><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681855134"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855135"><span class="annot"><span class="annottext">doBinds :: RM [TgStgTopBinding]
</span><a href="#local-6989586621681855135"><span class="hs-identifier hs-var hs-var">doBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenStgTopBinding 'InferTaggedBinders -&gt; RM TgStgTopBinding)
-&gt; [GenStgTopBinding 'InferTaggedBinders] -&gt; RM [TgStgTopBinding]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgTopBinding 'InferTaggedBinders -&gt; RM TgStgTopBinding
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTop"><span class="hs-identifier hs-var">rewriteTop</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgTopBinding 'InferTaggedBinders]
</span><a href="#local-6989586621681855134"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">State
  (UniqFM Id TagSig, UniqSupply, Module, IdSet) [TgStgTopBinding]
-&gt; (UniqFM Id TagSig, UniqSupply, Module, IdSet)
-&gt; [TgStgTopBinding]
forall s a. State s a -&gt; s -&gt; a
</span><a href="GHC.Utils.Monad.State.Strict.html#evalState"><span class="hs-identifier hs-var">evalState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RM [TgStgTopBinding]
-&gt; State
     (UniqFM Id TagSig, UniqSupply, Module, IdSet) [TgStgTopBinding]
forall a.
RM a -&gt; State (UniqFM Id TagSig, UniqSupply, Module, IdSet) a
</span><a href="GHC.Stg.InferTags.Rewrite.html#unRM"><span class="hs-identifier hs-var">unRM</span></a></span><span> </span><span class="annot"><span class="annottext">RM [TgStgTopBinding]
</span><a href="#local-6989586621681855135"><span class="hs-identifier hs-var">doBinds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM Id TagSig
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681855133"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681855132"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IdSet
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTop"><span class="hs-identifier hs-type">rewriteTop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgTopBinding"><span class="hs-identifier hs-type">InferStgTopBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgTopBinding"><span class="hs-identifier hs-type">TgStgTopBinding</span></a></span><span>
</span><span id="line-319"></span><span id="rewriteTop"><span class="annot"><span class="annottext">rewriteTop :: GenStgTopBinding 'InferTaggedBinders -&gt; RM TgStgTopBinding
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTop"><span class="hs-identifier hs-var hs-var">rewriteTop</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621681855141"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855141"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681855142"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681855142"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TgStgTopBinding -&gt; RM TgStgTopBinding
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgTopBinding -&gt; RM TgStgTopBinding)
-&gt; TgStgTopBinding -&gt; RM TgStgTopBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; ByteString -&gt; TgStgTopBinding
forall (pass :: StgPass). Id -&gt; ByteString -&gt; GenStgTopBinding pass
</span><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-var">StgTopStringLit</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855141"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681855142"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteTop"><span class="hs-identifier hs-var">rewriteTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span id="local-6989586621681855144"><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855144"><span class="hs-identifier hs-var">bind</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-comment">-- Top level bindings can, and must remain in scope</span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders -&gt; RM ()
</span><a href="GHC.Stg.InferTags.Rewrite.html#addTopBind"><span class="hs-identifier hs-var">addTopBind</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855144"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen -&gt; TgStgTopBinding
forall (pass :: StgPass).
GenStgBinding pass -&gt; GenStgTopBinding pass
</span><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(GenStgBinding 'CodeGen -&gt; TgStgTopBinding)
-&gt; RM (GenStgBinding 'CodeGen) -&gt; RM TgStgTopBinding
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#%3C%24%21%3E/Control.Monad.html#%3C%24%21%3E"><span class="hs-operator hs-var">&lt;$!&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; GenStgBinding 'InferTaggedBinders -&gt; RM (GenStgBinding 'CodeGen)
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteBinds"><span class="hs-identifier hs-var">rewriteBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#TopLevel"><span class="hs-identifier hs-var">TopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855144"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- For top level binds, the wrapper is guaranteed to be `id`</span><span>
</span><span id="line-326"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteBinds"><span class="hs-identifier hs-type">rewriteBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgBinding"><span class="hs-identifier hs-type">InferStgBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgBinding"><span class="hs-identifier hs-type">TgStgBinding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span id="rewriteBinds"><span class="annot"><span class="annottext">rewriteBinds :: TopLevelFlag
-&gt; GenStgBinding 'InferTaggedBinders -&gt; RM (GenStgBinding 'CodeGen)
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteBinds"><span class="hs-identifier hs-var hs-var">rewriteBinds</span></a></span></span><span> </span><span id="local-6989586621681855149"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855149"><span class="hs-identifier hs-var">_top_flag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681855150"><span class="annot"><span class="annottext">BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855150"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681855151"><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><a href="#local-6989586621681855151"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681855152"><span class="annot"><span class="annottext">TgStgRhs
</span><a href="#local-6989586621681855152"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; GenStgRhs 'InferTaggedBinders -&gt; RM TgStgRhs
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteRhs"><span class="hs-identifier hs-var">rewriteRhs</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig)
BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855150"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'InferTaggedBinders
</span><a href="#local-6989586621681855151"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen -&gt; RM (GenStgBinding 'CodeGen)
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(GenStgBinding 'CodeGen -&gt; RM (GenStgBinding 'CodeGen))
-&gt; GenStgBinding 'CodeGen -&gt; RM (GenStgBinding 'CodeGen)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinderP 'CodeGen -&gt; TgStgRhs -&gt; GenStgBinding 'CodeGen
forall (pass :: StgPass).
BinderP pass -&gt; GenStgRhs pass -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; Id
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig)
BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855150"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TgStgRhs
</span><a href="#local-6989586621681855152"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteBinds"><span class="hs-identifier hs-var">rewriteBinds</span></a></span><span> </span><span id="local-6989586621681855154"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855154"><span class="hs-identifier hs-var">top_flag</span></a></span></span><span> </span><span id="local-6989586621681855155"><span class="annot"><span class="annottext">b :: GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855155"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681855156"><span class="annot"><span class="annottext">[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681855156"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-comment">-- Bring sigs of binds into scope for all rhss</span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; GenStgBinding 'InferTaggedBinders
-&gt; RM (GenStgBinding 'CodeGen)
-&gt; RM (GenStgBinding 'CodeGen)
forall a.
TopLevelFlag -&gt; GenStgBinding 'InferTaggedBinders -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBind"><span class="hs-identifier hs-var">withBind</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681855154"><span class="hs-identifier hs-var">top_flag</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855155"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(RM (GenStgBinding 'CodeGen) -&gt; RM (GenStgBinding 'CodeGen))
-&gt; RM (GenStgBinding 'CodeGen) -&gt; RM (GenStgBinding 'CodeGen)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681855157"><span class="annot"><span class="annottext">[TgStgRhs]
</span><a href="#local-6989586621681855157"><span class="hs-identifier hs-var">rhss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((Id, TagSig), GenStgRhs 'InferTaggedBinders) -&gt; RM TgStgRhs)
-&gt; [((Id, TagSig), GenStgRhs 'InferTaggedBinders)] -&gt; RM [TgStgRhs]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Id, TagSig) -&gt; GenStgRhs 'InferTaggedBinders -&gt; RM TgStgRhs)
-&gt; ((Id, TagSig), GenStgRhs 'InferTaggedBinders) -&gt; RM TgStgRhs
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#uncurry/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; GenStgRhs 'InferTaggedBinders -&gt; RM TgStgRhs
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteRhs"><span class="hs-identifier hs-var">rewriteRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681855156"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen -&gt; RM (GenStgBinding 'CodeGen)
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(GenStgBinding 'CodeGen -&gt; RM (GenStgBinding 'CodeGen))
-&gt; GenStgBinding 'CodeGen -&gt; RM (GenStgBinding 'CodeGen)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TgStgRhs] -&gt; GenStgBinding 'CodeGen
</span><a href="#local-6989586621681855159"><span class="hs-identifier hs-var">mkRec</span></a></span><span> </span><span class="annot"><span class="annottext">[TgStgRhs]
</span><a href="#local-6989586621681855157"><span class="hs-identifier hs-var">rhss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>            </span><span class="annot"><a href="#local-6989586621681855159"><span class="hs-identifier hs-type">mkRec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgRhs"><span class="hs-identifier hs-type">TgStgRhs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgBinding"><span class="hs-identifier hs-type">TgStgBinding</span></a></span><span>
</span><span id="line-337"></span><span>            </span><span id="local-6989586621681855159"><span class="annot"><span class="annottext">mkRec :: [TgStgRhs] -&gt; GenStgBinding 'CodeGen
</span><a href="#local-6989586621681855159"><span class="hs-identifier hs-var hs-var">mkRec</span></a></span></span><span> </span><span id="local-6989586621681855160"><span class="annot"><span class="annottext">[TgStgRhs]
</span><a href="#local-6989586621681855160"><span class="hs-identifier hs-var">rhss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(BinderP 'CodeGen, TgStgRhs)] -&gt; GenStgBinding 'CodeGen
forall (pass :: StgPass).
[(BinderP pass, GenStgRhs pass)] -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [TgStgRhs] -&gt; [(Id, TgStgRhs)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((Id, TagSig), GenStgRhs 'InferTaggedBinders) -&gt; Id)
-&gt; [((Id, TagSig), GenStgRhs 'InferTaggedBinders)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; Id
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Id, TagSig) -&gt; Id)
-&gt; (((Id, TagSig), GenStgRhs 'InferTaggedBinders) -&gt; (Id, TagSig))
-&gt; ((Id, TagSig), GenStgRhs 'InferTaggedBinders)
-&gt; Id
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Id, TagSig), GenStgRhs 'InferTaggedBinders) -&gt; (Id, TagSig)
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((Id, TagSig), GenStgRhs 'InferTaggedBinders)]
[(BinderP 'InferTaggedBinders, GenStgRhs 'InferTaggedBinders)]
</span><a href="#local-6989586621681855156"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TgStgRhs]
</span><a href="#local-6989586621681855160"><span class="hs-identifier hs-var">rhss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-comment">-- Rewrite a RHS</span><span>
</span><span id="line-340"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteRhs"><span class="hs-identifier hs-type">rewriteRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-type">TagSig</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgRhs"><span class="hs-identifier hs-type">InferStgRhs</span></a></span><span>
</span><span id="line-341"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgRhs"><span class="hs-identifier hs-type">TgStgRhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span id="rewriteRhs"><span class="annot"><span class="annottext">rewriteRhs :: (Id, TagSig) -&gt; GenStgRhs 'InferTaggedBinders -&gt; RM TgStgRhs
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteRhs"><span class="hs-identifier hs-var hs-var">rewriteRhs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855163"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855163"><span class="hs-identifier hs-var">_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681855164"><span class="annot"><span class="annottext">TagSig
</span><a href="#local-6989586621681855164"><span class="hs-identifier hs-var">_tagSig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621681855166"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681855166"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span id="local-6989586621681855167"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855167"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681855168"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681855168"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span id="local-6989586621681855169"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681855169"><span class="hs-identifier hs-var">ticks</span></a></span></span><span> </span><span id="local-6989586621681855170"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855170"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">rewriteRhs_</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">-- pprTraceM &quot;rewriteRhs&quot; (ppr _id)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- Look up the nodes representing the constructor arguments.</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621681855171"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681855171"><span class="hs-identifier hs-var">fieldInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; RM Bool) -&gt; [StgArg] -&gt; RM [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; RM Bool
</span><a href="GHC.Stg.InferTags.Rewrite.html#isArgTagged"><span class="hs-identifier hs-var">isArgTagged</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855170"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- Filter out non-strict fields.</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855172"><span class="annot"><span class="annottext">strictFields :: [(StgArg, Bool)]
</span><a href="#local-6989586621681855172"><span class="hs-identifier hs-var hs-var">strictFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>            </span><span class="annot"><span class="annottext">DataCon -&gt; [(StgArg, Bool)] -&gt; [(StgArg, Bool)]
forall a. Outputable a =&gt; DataCon -&gt; [a] -&gt; [a]
</span><a href="GHC.Stg.InferTags.Rewrite.html#getStrictConArgs"><span class="hs-identifier hs-var">getStrictConArgs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855167"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg] -&gt; [Bool] -&gt; [(StgArg, Bool)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855170"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681855171"><span class="hs-identifier hs-var">fieldInfos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- (nth-argument, tagInfo)</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- Filter out already tagged arguments.</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855174"><span class="annot"><span class="annottext">needsEval :: [StgArg]
</span><a href="#local-6989586621681855174"><span class="hs-identifier hs-var hs-var">needsEval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((StgArg, Bool) -&gt; StgArg) -&gt; [(StgArg, Bool)] -&gt; [StgArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(StgArg, Bool) -&gt; StgArg
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(StgArg, Bool)] -&gt; [StgArg])
-&gt; ([(StgArg, Bool)] -&gt; [(StgArg, Bool)])
-&gt; [(StgArg, Bool)]
-&gt; [StgArg]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-comment">--get the actual argument</span><span>
</span><span id="line-353"></span><span>                        </span><span class="annot"><span class="annottext">((StgArg, Bool) -&gt; Bool) -&gt; [(StgArg, Bool)] -&gt; [(StgArg, Bool)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((StgArg, Bool) -&gt; Bool) -&gt; (StgArg, Bool) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(StgArg, Bool) -&gt; Bool
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(StgArg, Bool)] -&gt; [StgArg]) -&gt; [(StgArg, Bool)] -&gt; [StgArg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- Keep untagged (False) elements.</span><span>
</span><span id="line-354"></span><span>                        </span><span class="annot"><span class="annottext">[(StgArg, Bool)]
</span><a href="#local-6989586621681855172"><span class="hs-identifier hs-var">strictFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855177"><span class="annot"><span class="annottext">evalArgs :: [Id]
</span><a href="#local-6989586621681855177"><span class="hs-identifier hs-var hs-var">evalArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855178"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681855178"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855178"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855174"><span class="hs-identifier hs-var">needsEval</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681855177"><span class="hs-identifier hs-var">evalArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TgStgRhs -&gt; RM TgStgRhs
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgRhs -&gt; RM TgStgRhs) -&gt; TgStgRhs -&gt; RM TgStgRhs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; TgStgRhs
forall (pass :: StgPass).
CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681855166"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855167"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681855168"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681855169"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855170"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>            </span><span class="hs-comment">--assert not (isTaggedSig tagSig)</span><span>
</span><span id="line-361"></span><span>            </span><span class="hs-comment">-- pprTraceM &quot;CreatingSeqs for &quot; $ ppr _id &lt;+&gt; ppr node_id</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>            </span><span class="hs-comment">-- At this point iff we have  possibly untagged arguments to strict fields</span><span>
</span><span id="line-364"></span><span>            </span><span class="hs-comment">-- we convert the RHS into a RhsClosure which will evaluate the arguments</span><span>
</span><span id="line-365"></span><span>            </span><span class="hs-comment">-- before allocating the constructor.</span><span>
</span><span id="line-366"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855182"><span class="annot"><span class="annottext">ty_stub :: a
</span><a href="#local-6989586621681855182"><span class="hs-identifier hs-var hs-var">ty_stub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkSeqs shouldn't use the type arg&quot;</span></span><span>
</span><span id="line-367"></span><span>            </span><span id="local-6989586621681855184"><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855184"><span class="hs-identifier hs-var">conExpr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; [Id] -&gt; ([StgArg] -&gt; TgStgExpr) -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkSeqs"><span class="hs-identifier hs-var">mkSeqs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855170"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681855177"><span class="hs-identifier hs-var">evalArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681855186"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855186"><span class="hs-identifier hs-var">taggedArgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConstructorNumber -&gt; [StgArg] -&gt; [Type] -&gt; TgStgExpr
forall (pass :: StgPass).
DataCon
-&gt; ConstructorNumber -&gt; [StgArg] -&gt; [Type] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855167"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681855168"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855186"><span class="hs-identifier hs-var">taggedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
forall {a}. a
</span><a href="#local-6989586621681855182"><span class="hs-identifier hs-var">ty_stub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>            </span><span id="local-6989586621681855188"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621681855188"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; RM DIdSet
</span><a href="GHC.Stg.InferTags.Rewrite.html#fvArgs"><span class="hs-identifier hs-var">fvArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855170"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-comment">-- lcls &lt;- getFVs</span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-comment">-- pprTraceM &quot;RhsClosureConversion&quot; (ppr (StgRhsClosure fvs ccs ReEntrant [] $! conExpr) $$ text &quot;lcls:&quot; &lt;&gt; ppr lcls)</span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-comment">-- We mark the closure updatable to retain sharing in the case that</span><span>
</span><span id="line-373"></span><span>            </span><span class="hs-comment">-- conExpr is an infinite recursive data type. See #23783.</span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="annottext">TgStgRhs -&gt; RM TgStgRhs
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgRhs -&gt; RM TgStgRhs) -&gt; TgStgRhs -&gt; RM TgStgRhs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'CodeGen]
-&gt; TgStgExpr
-&gt; TgStgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
XRhsClosure 'CodeGen
</span><a href="#local-6989586621681855188"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681855166"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#Updatable"><span class="hs-identifier hs-var">Updatable</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; TgStgRhs) -&gt; TgStgExpr -&gt; TgStgRhs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855184"><span class="hs-identifier hs-var">conExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteRhs"><span class="hs-identifier hs-var">rewriteRhs</span></a></span><span> </span><span id="local-6989586621681855192"><span class="annot"><span class="annottext">(Id, TagSig)
</span><a href="#local-6989586621681855192"><span class="hs-identifier hs-var">_binding</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621681855193"><span class="annot"><span class="annottext">XRhsClosure 'InferTaggedBinders
</span><a href="#local-6989586621681855193"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681855194"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681855194"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span id="local-6989586621681855195"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681855195"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681855196"><span class="annot"><span class="annottext">[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681855196"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681855197"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855197"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; [(Id, TagSig)] -&gt; RM TgStgRhs -&gt; RM TgStgRhs
forall a. TopLevelFlag -&gt; [(Id, TagSig)] -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBinders"><span class="hs-identifier hs-var">withBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681855196"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">(RM TgStgRhs -&gt; RM TgStgRhs) -&gt; RM TgStgRhs -&gt; RM TgStgRhs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><span class="annottext">DIdSet -&gt; RM TgStgRhs -&gt; RM TgStgRhs
forall a. DIdSet -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withClosureLcls"><span class="hs-identifier hs-var">withClosureLcls</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
XRhsClosure 'InferTaggedBinders
</span><a href="#local-6989586621681855193"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">(RM TgStgRhs -&gt; RM TgStgRhs) -&gt; RM TgStgRhs -&gt; RM TgStgRhs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-378"></span><span>            </span><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'CodeGen]
-&gt; TgStgExpr
-&gt; TgStgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'InferTaggedBinders
XRhsClosure 'CodeGen
</span><a href="#local-6989586621681855193"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681855194"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681855195"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Id, TagSig) -&gt; Id) -&gt; [(Id, TagSig)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; Id
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681855196"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; TgStgRhs) -&gt; RM TgStgExpr -&gt; RM TgStgRhs
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855197"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-379"></span><span>        </span><span class="hs-comment">-- return (closure)</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#fvArgs"><span class="hs-identifier hs-type">fvArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DVarSet"><span class="hs-identifier hs-type">DVarSet</span></a></span><span>
</span><span id="line-382"></span><span id="fvArgs"><span class="annot"><span class="annottext">fvArgs :: [StgArg] -&gt; RM DIdSet
</span><a href="GHC.Stg.InferTags.Rewrite.html#fvArgs"><span class="hs-identifier hs-var hs-var">fvArgs</span></a></span></span><span> </span><span id="local-6989586621681855200"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855200"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621681855201"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855201"><span class="hs-identifier hs-var">fv_lcls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RM IdSet
</span><a href="GHC.Stg.InferTags.Rewrite.html#getFVs"><span class="hs-identifier hs-var">getFVs</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-comment">-- pprTraceM &quot;fvArgs&quot; (text &quot;args:&quot; &lt;&gt; ppr args $$ text &quot;lcls:&quot; &lt;&gt; pprVarSet (fv_lcls) (braces . fsep . map ppr) )</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><span class="annottext">DIdSet -&gt; RM DIdSet
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DIdSet -&gt; RM DIdSet) -&gt; DIdSet -&gt; RM DIdSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#mkDVarSet"><span class="hs-identifier hs-var">mkDVarSet</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855203"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681855203"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855203"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855200"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855203"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621681855201"><span class="hs-identifier hs-var">fv_lcls</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteArgs"><span class="hs-identifier hs-type">rewriteArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-388"></span><span id="rewriteArgs"><span class="annot"><span class="annottext">rewriteArgs :: [StgArg] -&gt; RM [StgArg]
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteArgs"><span class="hs-identifier hs-var hs-var">rewriteArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; RM StgArg) -&gt; [StgArg] -&gt; RM [StgArg]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; RM StgArg
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteArg"><span class="hs-identifier hs-var">rewriteArg</span></a></span><span>
</span><span id="line-389"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteArg"><span class="hs-identifier hs-type">rewriteArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span>
</span><span id="line-390"></span><span id="rewriteArg"><span class="annot"><span class="annottext">rewriteArg :: StgArg -&gt; RM StgArg
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteArg"><span class="hs-identifier hs-var hs-var">rewriteArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681855207"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855207"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; StgArg) -&gt; RM Id -&gt; RM StgArg
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#%3C%24%21%3E/Control.Monad.html#%3C%24%21%3E"><span class="hs-operator hs-var">&lt;$!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM Id
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteId"><span class="hs-identifier hs-var">rewriteId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855207"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-391"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteArg"><span class="hs-identifier hs-var">rewriteArg</span></a></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681855209"><span class="annot"><span class="annottext">lit :: StgArg
</span><a href="#local-6989586621681855209"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-type">StgLitArg</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; RM StgArg
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681855209"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteId"><span class="hs-identifier hs-type">rewriteId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-394"></span><span id="rewriteId"><span class="annot"><span class="annottext">rewriteId :: Id -&gt; RM Id
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteId"><span class="hs-identifier hs-var hs-var">rewriteId</span></a></span></span><span> </span><span id="local-6989586621681855210"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855210"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621681855211"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681855211"><span class="hs-identifier hs-var">is_tagged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM Bool
</span><a href="GHC.Stg.InferTags.Rewrite.html#isTagged"><span class="hs-identifier hs-var">isTagged</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855210"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681855211"><span class="hs-identifier hs-var">is_tagged</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM Id
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; RM Id) -&gt; Id -&gt; RM Id
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TagSig -&gt; Id
</span><a href="GHC.Types.Id.html#setIdTagSig"><span class="hs-identifier hs-var">setIdTagSig</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855210"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TagInfo -&gt; TagSig
</span><a href="GHC.Stg.InferTags.TagSig.html#TagSig"><span class="hs-identifier hs-var">TagSig</span></a></span><span> </span><span class="annot"><span class="annottext">TagInfo
</span><a href="GHC.Stg.InferTags.TagSig.html#TagProper"><span class="hs-identifier hs-var">TagProper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM Id
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855210"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-type">rewriteExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgExpr"><span class="hs-identifier hs-type">InferStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-400"></span><span id="rewriteExpr"><span class="annot"><span class="annottext">rewriteExpr :: GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var hs-var">rewriteExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855214"><span class="annot"><span class="annottext">e :: GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855214"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteCase"><span class="hs-identifier hs-var">rewriteCase</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855214"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-401"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855217"><span class="annot"><span class="annottext">e :: GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855217"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLet"><span class="hs-identifier hs-var">rewriteLet</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855217"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-402"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855220"><span class="annot"><span class="annottext">e :: GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855220"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-type">StgLetNoEscape</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLetNoEscape"><span class="hs-identifier hs-var">rewriteLetNoEscape</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855220"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-403"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-type">StgTick</span></a></span><span> </span><span id="local-6989586621681855224"><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681855224"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681855225"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855225"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgTickish -&gt; TgStgExpr -&gt; TgStgExpr
forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681855224"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; TgStgExpr) -&gt; RM TgStgExpr -&gt; RM TgStgExpr
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#%3C%24%21%3E/Control.Monad.html#%3C%24%21%3E"><span class="hs-operator hs-var">&lt;$!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855225"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-404"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span id="local-6989586621681855226"><span class="annot"><span class="annottext">e :: GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855226"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteConApp"><span class="hs-identifier hs-var">rewriteConApp</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855226"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-405"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span id="local-6989586621681855228"><span class="annot"><span class="annottext">e :: GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855228"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteApp"><span class="hs-identifier hs-var">rewriteApp</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855228"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-406"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-type">StgLit</span></a></span><span> </span><span id="local-6989586621681855232"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681855232"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; TgStgExpr
forall (pass :: StgPass). Literal -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-var">StgLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681855232"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span id="local-6989586621681855234"><span class="annot"><span class="annottext">op :: StgOp
</span><a href="#local-6989586621681855234"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgPrimOp"><span class="hs-identifier hs-type">StgPrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="GHC.Builtin.PrimOps.html#DataToTagOp"><span class="hs-identifier hs-var">DataToTagOp</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681855237"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855237"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681855238"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681855238"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgOp -&gt; [StgArg] -&gt; Type -&gt; TgStgExpr
forall (pass :: StgPass).
StgOp -&gt; [StgArg] -&gt; Type -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a></span><span> </span><span class="annot"><span class="annottext">StgOp
</span><a href="#local-6989586621681855234"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([StgArg] -&gt; Type -&gt; TgStgExpr)
-&gt; RM [StgArg] -&gt; RM (Type -&gt; TgStgExpr)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#%3C%24%21%3E/Control.Monad.html#%3C%24%21%3E"><span class="hs-operator hs-var">&lt;$!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; RM [StgArg]
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteArgs"><span class="hs-identifier hs-var">rewriteArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855237"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">RM (Type -&gt; TgStgExpr) -&gt; RM Type -&gt; RM TgStgExpr
forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; RM Type
forall a. a -&gt; RM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681855238"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-409"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-type">StgOpApp</span></a></span><span> </span><span id="local-6989586621681855239"><span class="annot"><span class="annottext">StgOp
</span><a href="#local-6989586621681855239"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621681855240"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855240"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681855241"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681855241"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgOp -&gt; [StgArg] -&gt; Type -&gt; TgStgExpr
forall (pass :: StgPass).
StgOp -&gt; [StgArg] -&gt; Type -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a></span><span> </span><span class="annot"><span class="annottext">StgOp
</span><a href="#local-6989586621681855239"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855240"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681855241"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteCase"><span class="hs-identifier hs-type">rewriteCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgExpr"><span class="hs-identifier hs-type">InferStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-413"></span><span id="rewriteCase"><span class="annot"><span class="annottext">rewriteCase :: GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteCase"><span class="hs-identifier hs-var hs-var">rewriteCase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-type">StgCase</span></a></span><span> </span><span id="local-6989586621681855242"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855242"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621681855243"><span class="annot"><span class="annottext">BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855243"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681855244"><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681855244"><span class="hs-identifier hs-var">alt_type</span></a></span></span><span> </span><span id="local-6989586621681855245"><span class="annot"><span class="annottext">[GenStgAlt 'InferTaggedBinders]
</span><a href="#local-6989586621681855245"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; (Id, TagSig) -&gt; RM TgStgExpr -&gt; RM TgStgExpr
forall a. TopLevelFlag -&gt; (Id, TagSig) -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBinder"><span class="hs-identifier hs-var">withBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig)
BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855243"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">(RM TgStgExpr -&gt; RM TgStgExpr) -&gt; RM TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-415"></span><span>        </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; Id -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr)
-&gt; RM
     (TgStgExpr -&gt; Id -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr)
forall a. a -&gt; RM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TgStgExpr -&gt; Id -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr
TgStgExpr
-&gt; BinderP 'CodeGen -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr
forall (pass :: StgPass).
GenStgExpr pass
-&gt; BinderP pass -&gt; AltType -&gt; [GenStgAlt pass] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a></span><span> </span><span class="annot"><span class="annottext">RM
  (TgStgExpr -&gt; Id -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr)
-&gt; RM TgStgExpr
-&gt; RM (Id -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr)
forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-416"></span><span>            </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855242"><span class="hs-identifier hs-var">scrut</span></a></span><span> </span><span class="annot"><span class="annottext">RM (Id -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr)
-&gt; RM Id -&gt; RM (AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr)
forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><span class="annottext">Id -&gt; RM Id
forall a. a -&gt; RM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id, TagSig) -&gt; Id
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, TagSig)
BinderP 'InferTaggedBinders
</span><a href="#local-6989586621681855243"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RM (AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr)
-&gt; RM AltType -&gt; RM ([GenStgAlt 'CodeGen] -&gt; TgStgExpr)
forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-418"></span><span>            </span><span class="annot"><span class="annottext">AltType -&gt; RM AltType
forall a. a -&gt; RM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681855244"><span class="hs-identifier hs-var">alt_type</span></a></span><span> </span><span class="annot"><span class="annottext">RM ([GenStgAlt 'CodeGen] -&gt; TgStgExpr)
-&gt; RM [GenStgAlt 'CodeGen] -&gt; RM TgStgExpr
forall a b. RM (a -&gt; b) -&gt; RM a -&gt; RM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span>
</span><span id="line-419"></span><span>            </span><span class="annot"><span class="annottext">(GenStgAlt 'InferTaggedBinders -&gt; RM (GenStgAlt 'CodeGen))
-&gt; [GenStgAlt 'InferTaggedBinders] -&gt; RM [GenStgAlt 'CodeGen]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgAlt 'InferTaggedBinders -&gt; RM (GenStgAlt 'CodeGen)
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteAlt"><span class="hs-identifier hs-var">rewriteAlt</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgAlt 'InferTaggedBinders]
</span><a href="#local-6989586621681855245"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteCase"><span class="hs-identifier hs-var">rewriteCase</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RM TgStgExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Impossible: nodeCase&quot;</span></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteAlt"><span class="hs-identifier hs-type">rewriteAlt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgAlt"><span class="hs-identifier hs-type">InferStgAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgAlt"><span class="hs-identifier hs-type">TgStgAlt</span></a></span><span>
</span><span id="line-424"></span><span id="rewriteAlt"><span class="annot"><span class="annottext">rewriteAlt :: GenStgAlt 'InferTaggedBinders -&gt; RM (GenStgAlt 'CodeGen)
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteAlt"><span class="hs-identifier hs-var hs-var">rewriteAlt</span></a></span></span><span> </span><span id="local-6989586621681855249"><span class="annot"><span class="annottext">alt :: GenStgAlt 'InferTaggedBinders
</span><a href="#local-6989586621681855249"><span class="hs-identifier hs-var">alt</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">alt_con :: forall (pass :: StgPass). GenStgAlt pass -&gt; AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">AltCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: forall (pass :: StgPass). GenStgAlt pass -&gt; [BinderP pass]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681855253"><span class="annot"><span class="annottext">[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681855253"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_rhs :: forall (pass :: StgPass). GenStgAlt pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681855255"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855255"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-425"></span><span>    </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; [(Id, TagSig)]
-&gt; RM (GenStgAlt 'CodeGen)
-&gt; RM (GenStgAlt 'CodeGen)
forall a. TopLevelFlag -&gt; [(Id, TagSig)] -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBinders"><span class="hs-identifier hs-var">withBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, TagSig)]
[BinderP 'InferTaggedBinders]
</span><a href="#local-6989586621681855253"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(RM (GenStgAlt 'CodeGen) -&gt; RM (GenStgAlt 'CodeGen))
-&gt; RM (GenStgAlt 'CodeGen) -&gt; RM (GenStgAlt 'CodeGen)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621681855256"><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855256"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855255"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="annottext">GenStgAlt 'CodeGen -&gt; RM (GenStgAlt 'CodeGen)
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(GenStgAlt 'CodeGen -&gt; RM (GenStgAlt 'CodeGen))
-&gt; GenStgAlt 'CodeGen -&gt; RM (GenStgAlt 'CodeGen)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgAlt 'InferTaggedBinders
</span><a href="#local-6989586621681855249"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-type">map</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-type">fst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681855253"><span class="hs-identifier hs-type">bndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681855256"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLet"><span class="hs-identifier hs-type">rewriteLet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgExpr"><span class="hs-identifier hs-type">InferStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-430"></span><span id="rewriteLet"><span class="annot"><span class="annottext">rewriteLet :: GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLet"><span class="hs-identifier hs-var hs-var">rewriteLet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-type">StgLet</span></a></span><span> </span><span id="local-6989586621681855257"><span class="annot"><span class="annottext">XLet 'InferTaggedBinders
</span><a href="#local-6989586621681855257"><span class="hs-identifier hs-var">xt</span></a></span></span><span> </span><span id="local-6989586621681855258"><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855258"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621681855259"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855259"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681855260"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621681855260"><span class="hs-identifier hs-var">bind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; GenStgBinding 'InferTaggedBinders -&gt; RM (GenStgBinding 'CodeGen)
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteBinds"><span class="hs-identifier hs-var">rewriteBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855258"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; GenStgBinding 'InferTaggedBinders
-&gt; RM TgStgExpr
-&gt; RM TgStgExpr
forall a.
TopLevelFlag -&gt; GenStgBinding 'InferTaggedBinders -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBind"><span class="hs-identifier hs-var">withBind</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855258"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">(RM TgStgExpr -&gt; RM TgStgExpr) -&gt; RM TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-comment">-- pprTraceM &quot;withBindLet&quot; (ppr $ bindersOfX bind)</span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621681855261"><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855261"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855259"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-435"></span><span>        </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLet 'CodeGen -&gt; GenStgBinding 'CodeGen -&gt; TgStgExpr -&gt; TgStgExpr
forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet 'InferTaggedBinders
XLet 'CodeGen
</span><a href="#local-6989586621681855257"><span class="hs-identifier hs-var">xt</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621681855260"><span class="hs-identifier hs-var">bind'</span></a></span><span> </span><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855261"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLet"><span class="hs-identifier hs-var">rewriteLet</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RM TgStgExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Impossible&quot;</span></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLetNoEscape"><span class="hs-identifier hs-type">rewriteLetNoEscape</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgExpr"><span class="hs-identifier hs-type">InferStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-439"></span><span id="rewriteLetNoEscape"><span class="annot"><span class="annottext">rewriteLetNoEscape :: GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLetNoEscape"><span class="hs-identifier hs-var hs-var">rewriteLetNoEscape</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-type">StgLetNoEscape</span></a></span><span> </span><span id="local-6989586621681855262"><span class="annot"><span class="annottext">XLetNoEscape 'InferTaggedBinders
</span><a href="#local-6989586621681855262"><span class="hs-identifier hs-var">xt</span></a></span></span><span> </span><span id="local-6989586621681855263"><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855263"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621681855264"><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855264"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681855265"><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621681855265"><span class="hs-identifier hs-var">bind'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; GenStgBinding 'InferTaggedBinders -&gt; RM (GenStgBinding 'CodeGen)
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteBinds"><span class="hs-identifier hs-var">rewriteBinds</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855263"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; GenStgBinding 'InferTaggedBinders
-&gt; RM TgStgExpr
-&gt; RM TgStgExpr
forall a.
TopLevelFlag -&gt; GenStgBinding 'InferTaggedBinders -&gt; RM a -&gt; RM a
</span><a href="GHC.Stg.InferTags.Rewrite.html#withBind"><span class="hs-identifier hs-var">withBind</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="GHC.Types.Basic.html#NotTopLevel"><span class="hs-identifier hs-var">NotTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'InferTaggedBinders
</span><a href="#local-6989586621681855263"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">(RM TgStgExpr -&gt; RM TgStgExpr) -&gt; RM TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621681855266"><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855266"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteExpr"><span class="hs-identifier hs-var">rewriteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><a href="#local-6989586621681855264"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-443"></span><span>        </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLetNoEscape 'CodeGen
-&gt; GenStgBinding 'CodeGen -&gt; TgStgExpr -&gt; TgStgExpr
forall (pass :: StgPass).
XLetNoEscape pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-var">StgLetNoEscape</span></a></span><span> </span><span class="annot"><span class="annottext">XLetNoEscape 'InferTaggedBinders
XLetNoEscape 'CodeGen
</span><a href="#local-6989586621681855262"><span class="hs-identifier hs-var">xt</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'CodeGen
</span><a href="#local-6989586621681855265"><span class="hs-identifier hs-var">bind'</span></a></span><span> </span><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855266"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteLetNoEscape"><span class="hs-identifier hs-var">rewriteLetNoEscape</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RM TgStgExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Impossible&quot;</span></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteConApp"><span class="hs-identifier hs-type">rewriteConApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgExpr"><span class="hs-identifier hs-type">InferStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-447"></span><span id="rewriteConApp"><span class="annot"><span class="annottext">rewriteConApp :: GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteConApp"><span class="hs-identifier hs-var hs-var">rewriteConApp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621681855267"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855267"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681855268"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681855268"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span id="local-6989586621681855269"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855269"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681855270"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681855270"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-comment">-- We check if the strict field arguments are already known to be tagged.</span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-comment">-- If not we evaluate them first.</span><span>
</span><span id="line-450"></span><span>    </span><span id="local-6989586621681855271"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681855271"><span class="hs-identifier hs-var">fieldInfos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; RM Bool) -&gt; [StgArg] -&gt; RM [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; RM Bool
</span><a href="GHC.Stg.InferTags.Rewrite.html#isArgTagged"><span class="hs-identifier hs-var">isArgTagged</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855269"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855272"><span class="annot"><span class="annottext">strictIndices :: [(Bool, StgArg)]
</span><a href="#local-6989586621681855272"><span class="hs-identifier hs-var hs-var">strictIndices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [(Bool, StgArg)] -&gt; [(Bool, StgArg)]
forall a. Outputable a =&gt; DataCon -&gt; [a] -&gt; [a]
</span><a href="GHC.Stg.InferTags.Rewrite.html#getStrictConArgs"><span class="hs-identifier hs-var">getStrictConArgs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855267"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; [StgArg] -&gt; [(Bool, StgArg)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681855271"><span class="hs-identifier hs-var">fieldInfos</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855269"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855273"><span class="annot"><span class="annottext">needsEval :: [StgArg]
</span><a href="#local-6989586621681855273"><span class="hs-identifier hs-var hs-var">needsEval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Bool, StgArg) -&gt; StgArg) -&gt; [(Bool, StgArg)] -&gt; [StgArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool, StgArg) -&gt; StgArg
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(Bool, StgArg)] -&gt; [StgArg])
-&gt; ([(Bool, StgArg)] -&gt; [(Bool, StgArg)])
-&gt; [(Bool, StgArg)]
-&gt; [StgArg]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Bool, StgArg) -&gt; Bool) -&gt; [(Bool, StgArg)] -&gt; [(Bool, StgArg)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((Bool, StgArg) -&gt; Bool) -&gt; (Bool, StgArg) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool, StgArg) -&gt; Bool
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Bool, StgArg)] -&gt; [StgArg]) -&gt; [(Bool, StgArg)] -&gt; [StgArg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, StgArg)]
</span><a href="#local-6989586621681855272"><span class="hs-identifier hs-var">strictIndices</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855274"><span class="annot"><span class="annottext">evalArgs :: [Id]
</span><a href="#local-6989586621681855274"><span class="hs-identifier hs-var hs-var">evalArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855275"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681855275"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855275"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855273"><span class="hs-identifier hs-var">needsEval</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681855274"><span class="hs-identifier hs-var">evalArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-456"></span><span>            </span><span class="hs-comment">-- pprTraceM &quot;Creating conAppSeqs for &quot; $ ppr nodeId &lt;+&gt; parens ( ppr evalArgs ) -- &lt;+&gt; parens ( ppr fieldInfos )</span><span>
</span><span id="line-457"></span><span>            </span><span class="annot"><span class="annottext">[StgArg] -&gt; [Id] -&gt; ([StgArg] -&gt; TgStgExpr) -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkSeqs"><span class="hs-identifier hs-var">mkSeqs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855269"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681855274"><span class="hs-identifier hs-var">evalArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681855276"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855276"><span class="hs-identifier hs-var">taggedArgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConstructorNumber -&gt; [StgArg] -&gt; [Type] -&gt; TgStgExpr
forall (pass :: StgPass).
DataCon
-&gt; ConstructorNumber -&gt; [StgArg] -&gt; [Type] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855267"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681855268"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855276"><span class="hs-identifier hs-var">taggedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681855270"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConstructorNumber -&gt; [StgArg] -&gt; [Type] -&gt; TgStgExpr
forall (pass :: StgPass).
DataCon
-&gt; ConstructorNumber -&gt; [StgArg] -&gt; [Type] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855267"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681855268"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855269"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681855270"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteConApp"><span class="hs-identifier hs-var">rewriteConApp</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RM TgStgExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Impossible&quot;</span></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="hs-comment">-- Special case: Atomic binders, usually in a case context like `case f of ...`.</span><span>
</span><span id="line-463"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteApp"><span class="hs-identifier hs-type">rewriteApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Types.html#InferStgExpr"><span class="hs-identifier hs-type">InferStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-464"></span><span id="rewriteApp"><span class="annot"><span class="annottext">rewriteApp :: GenStgExpr 'InferTaggedBinders -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteApp"><span class="hs-identifier hs-var hs-var">rewriteApp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621681855277"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855277"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621681855278"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855278"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM Id
</span><a href="GHC.Stg.InferTags.Rewrite.html#rewriteId"><span class="hs-identifier hs-var">rewriteId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855277"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; [StgArg] -&gt; TgStgExpr
forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855278"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-467"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteApp"><span class="hs-identifier hs-var">rewriteApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621681855279"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855279"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681855280"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855280"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-comment">-- pprTrace &quot;rewriteAppOther&quot; (ppr f &lt;+&gt; ppr args) False</span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-comment">-- = undefined</span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681855281"><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855281"><span class="hs-identifier hs-var">marks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe [CbvMark]
</span><a href="GHC.Types.Id.html#idCbvMarks_maybe"><span class="hs-identifier hs-var">idCbvMarks_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855279"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681855283"><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855283"><span class="hs-identifier hs-var">relevant_marks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CbvMark -&gt; Bool) -&gt; [CbvMark] -&gt; [CbvMark]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#dropWhileEndLE"><span class="hs-identifier hs-var">dropWhileEndLE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (CbvMark -&gt; Bool) -&gt; CbvMark -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CbvMark -&gt; Bool
</span><a href="GHC.Types.Basic.html#isMarkedCbv"><span class="hs-identifier hs-var">isMarkedCbv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855281"><span class="hs-identifier hs-var">marks</span></a></span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(CbvMark -&gt; Bool) -&gt; [CbvMark] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">CbvMark -&gt; Bool
</span><a href="GHC.Types.Basic.html#isMarkedCbv"><span class="hs-identifier hs-var">isMarkedCbv</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855283"><span class="hs-identifier hs-var">relevant_marks</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; SDoc -&gt; ([CbvMark] -&gt; RM TgStgExpr) -&gt; [CbvMark] -&gt; RM TgStgExpr
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CbvMark] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855283"><span class="hs-identifier hs-var">relevant_marks</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855280"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855279"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855280"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855283"><span class="hs-identifier hs-var">relevant_marks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>      </span><span class="annot"><span class="annottext">[CbvMark] -&gt; RM TgStgExpr
</span><a href="#local-6989586621681855289"><span class="hs-identifier hs-var">unliftArg</span></a></span><span> </span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855283"><span class="hs-identifier hs-var">relevant_marks</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-477"></span><span>      </span><span class="hs-comment">-- If the function expects any argument to be call-by-value ensure the argument is already</span><span>
</span><span id="line-478"></span><span>      </span><span class="hs-comment">-- evaluated.</span><span>
</span><span id="line-479"></span><span>      </span><span id="local-6989586621681855289"><span class="annot"><span class="annottext">unliftArg :: [CbvMark] -&gt; RM TgStgExpr
</span><a href="#local-6989586621681855289"><span class="hs-identifier hs-var hs-var">unliftArg</span></a></span></span><span> </span><span id="local-6989586621681855290"><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855290"><span class="hs-identifier hs-var">relevant_marks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>        </span><span id="local-6989586621681855291"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681855291"><span class="hs-identifier hs-var">argTags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; RM Bool) -&gt; [StgArg] -&gt; RM [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; RM Bool
</span><a href="GHC.Stg.InferTags.Rewrite.html#isArgTagged"><span class="hs-identifier hs-var">isArgTagged</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855280"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855292"><span class="annot"><span class="annottext">argInfo :: [(StgArg, CbvMark, Bool)]
</span><a href="#local-6989586621681855292"><span class="hs-identifier hs-var hs-var">argInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; CbvMark -&gt; Bool -&gt; (StgArg, CbvMark, Bool))
-&gt; [StgArg] -&gt; [CbvMark] -&gt; [Bool] -&gt; [(StgArg, CbvMark, Bool)]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zipWith3/GHC.List.html#zipWith3"><span class="hs-identifier hs-var">zipWith3</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855280"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CbvMark]
</span><a href="#local-6989586621681855290"><span class="hs-identifier hs-var">relevant_marks</span></a></span><span class="annot"><span class="annottext">[CbvMark] -&gt; [CbvMark] -&gt; [CbvMark]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">CbvMark -&gt; [CbvMark]
forall a. a -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#repeat/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">CbvMark
</span><a href="GHC.Types.Basic.html#NotMarkedCbv"><span class="hs-identifier hs-var">NotMarkedCbv</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681855291"><span class="hs-identifier hs-var">argTags</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#CbvMark"><span class="hs-identifier hs-type">CbvMark</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span>            </span><span class="hs-comment">-- untagged cbv argument positions</span><span>
</span><span id="line-484"></span><span>            </span><span id="local-6989586621681855296"><span class="annot"><span class="annottext">cbvArgInfo :: [(StgArg, CbvMark, Bool)]
</span><a href="#local-6989586621681855296"><span class="hs-identifier hs-var hs-var">cbvArgInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((StgArg, CbvMark, Bool) -&gt; Bool)
-&gt; [(StgArg, CbvMark, Bool)] -&gt; [(StgArg, CbvMark, Bool)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681855297"><span class="annot"><span class="annottext">(StgArg, CbvMark, Bool)
</span><a href="#local-6989586621681855297"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(StgArg, CbvMark, Bool) -&gt; CbvMark
forall a b c. (a, b, c) -&gt; b
</span><a href="GHC.Utils.Misc.html#sndOf3"><span class="hs-identifier hs-var">sndOf3</span></a></span><span> </span><span class="annot"><span class="annottext">(StgArg, CbvMark, Bool)
</span><a href="#local-6989586621681855297"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CbvMark -&gt; CbvMark -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CbvMark
</span><a href="GHC.Types.Basic.html#MarkedCbv"><span class="hs-identifier hs-var">MarkedCbv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(StgArg, CbvMark, Bool) -&gt; Bool
forall a b c. (a, b, c) -&gt; c
</span><a href="GHC.Utils.Misc.html#thdOf3"><span class="hs-identifier hs-var">thdOf3</span></a></span><span> </span><span class="annot"><span class="annottext">(StgArg, CbvMark, Bool)
</span><a href="#local-6989586621681855297"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(StgArg, CbvMark, Bool)]
</span><a href="#local-6989586621681855292"><span class="hs-identifier hs-var">argInfo</span></a></span><span>
</span><span id="line-485"></span><span>            </span><span id="local-6989586621681855302"><span class="annot"><span class="annottext">cbvArgIds :: [Id]
</span><a href="#local-6989586621681855302"><span class="hs-identifier hs-var hs-var">cbvArgIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855303"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681855303"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855303"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((StgArg, CbvMark, Bool) -&gt; StgArg)
-&gt; [(StgArg, CbvMark, Bool)] -&gt; [StgArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(StgArg, CbvMark, Bool) -&gt; StgArg
forall a b c. (a, b, c) -&gt; a
</span><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a></span><span> </span><span class="annot"><span class="annottext">[(StgArg, CbvMark, Bool)]
</span><a href="#local-6989586621681855296"><span class="hs-identifier hs-var">cbvArgInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><span class="annottext">[StgArg] -&gt; [Id] -&gt; ([StgArg] -&gt; TgStgExpr) -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkSeqs"><span class="hs-identifier hs-var">mkSeqs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855280"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681855302"><span class="hs-identifier hs-var">cbvArgIds</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681855305"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855305"><span class="hs-identifier hs-var">cbv_args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [StgArg] -&gt; TgStgExpr
forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855279"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855305"><span class="hs-identifier hs-var">cbv_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteApp"><span class="hs-identifier hs-var">rewriteApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-type">StgApp</span></a></span><span> </span><span id="local-6989586621681855306"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855306"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681855307"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855307"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; [StgArg] -&gt; TgStgExpr
forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855306"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855307"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-489"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#rewriteApp"><span class="hs-identifier hs-var">rewriteApp</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'InferTaggedBinders
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; RM TgStgExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Impossible&quot;</span></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-comment">-- `mkSeq` x x' e generates `case x of x' -&gt; e`</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- We could also substitute x' for x in e but that's so rarely beneficial</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- that we don't bother.</span><span>
</span><span id="line-494"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#mkSeq"><span class="hs-identifier hs-type">mkSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-495"></span><span id="mkSeq"><span class="annot"><span class="annottext">mkSeq :: Id -&gt; Id -&gt; TgStgExpr -&gt; TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkSeq"><span class="hs-identifier hs-var hs-var">mkSeq</span></a></span></span><span> </span><span id="local-6989586621681855309"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855309"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681855310"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855310"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681855311"><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855311"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-comment">-- pprTrace &quot;mkSeq&quot; (ppr (id,bndr)) $</span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855312"><span class="annot"><span class="annottext">altTy :: AltType
</span><a href="#local-6989586621681855312"><span class="hs-identifier hs-var hs-var">altTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [GenStgAlt 'CodeGen] -&gt; AltType
forall (p :: StgPass). Id -&gt; [GenStgAlt p] -&gt; AltType
</span><a href="GHC.Stg.Utils.html#mkStgAltTypeFromStgAlts"><span class="hs-identifier hs-var">mkStgAltTypeFromStgAlts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855310"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgAlt 'CodeGen]
</span><a href="#local-6989586621681855314"><span class="hs-identifier hs-var">alt</span></a></span><span>
</span><span id="line-498"></span><span>        </span><span id="local-6989586621681855314"><span class="annot"><span class="annottext">alt :: [GenStgAlt 'CodeGen]
</span><a href="#local-6989586621681855314"><span class="hs-identifier hs-var hs-var">alt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">alt_con :: AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="GHC.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: [BinderP 'CodeGen]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_rhs :: TgStgExpr
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855311"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TgStgExpr
-&gt; BinderP 'CodeGen -&gt; AltType -&gt; [GenStgAlt 'CodeGen] -&gt; TgStgExpr
forall (pass :: StgPass).
GenStgExpr pass
-&gt; BinderP pass -&gt; AltType -&gt; [GenStgAlt pass] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [StgArg] -&gt; TgStgExpr
forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855309"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
BinderP 'CodeGen
</span><a href="#local-6989586621681855310"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681855312"><span class="hs-identifier hs-var">altTy</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgAlt 'CodeGen]
</span><a href="#local-6989586621681855314"><span class="hs-identifier hs-var">alt</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="hs-comment">-- `mkSeqs args vs mkExpr` will force all vs, and construct</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- an argument list args' where each v is replaced by it's evaluated</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- counterpart v'.</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- That is if we call `mkSeqs [StgVar x, StgLit l] [x] mkExpr` then</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- the result will be (case x of x' { _DEFAULT -&gt; &lt;mkExpr [StgVar x', StgLit l]&gt;}</span><span>
</span><span id="line-506"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#mkSeqs"><span class="hs-pragma hs-type">mkSeqs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- We inline to avoid allocating mkExpr</span><span>
</span><span id="line-507"></span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#mkSeqs"><span class="hs-identifier hs-type">mkSeqs</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ Original arguments</span></span><span>
</span><span id="line-508"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="hs-comment">-- ^ var args to be evaluated ahead of time</span></span><span>
</span><span id="line-509"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                    </span><span class="hs-comment">-- ^ Function that reconstructs the expressions when passed</span><span>
</span><span id="line-511"></span><span>                    </span><span class="hs-comment">-- the list of evaluated arguments.</span><span>
</span><span id="line-512"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#TgStgExpr"><span class="hs-identifier hs-type">TgStgExpr</span></a></span><span>
</span><span id="line-513"></span><span id="mkSeqs"><span class="annot"><span class="annottext">mkSeqs :: [StgArg] -&gt; [Id] -&gt; ([StgArg] -&gt; TgStgExpr) -&gt; RM TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkSeqs"><span class="hs-identifier hs-var hs-var">mkSeqs</span></a></span></span><span> </span><span id="local-6989586621681855316"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855316"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681855317"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681855317"><span class="hs-identifier hs-var">untaggedIds</span></a></span></span><span> </span><span id="local-6989586621681855318"><span class="annot"><span class="annottext">[StgArg] -&gt; TgStgExpr
</span><a href="#local-6989586621681855318"><span class="hs-identifier hs-var">mkExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621681855319"><span class="annot"><span class="annottext">[(Id, Id)]
</span><a href="#local-6989586621681855319"><span class="hs-identifier hs-var">argMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; RM (Id, Id)) -&gt; [Id] -&gt; RM [(Id, Id)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681855320"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855320"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855320"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; (Id, Id)) -&gt; RM Id -&gt; RM (Id, Id)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; RM Id
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkLocalArgId"><span class="hs-identifier hs-var">mkLocalArgId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855320"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681855317"><span class="hs-identifier hs-var">untaggedIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#RM"><span class="hs-identifier hs-type">RM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#InId"><span class="hs-identifier hs-type">InId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#OutId"><span class="hs-identifier hs-type">OutId</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-comment">-- mapM_ (pprTraceM &quot;Forcing strict args before allocation:&quot; . ppr) argMap</span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855323"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855323"><span class="hs-identifier hs-var">taggedArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-517"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgArg -&gt; StgArg) -&gt; [StgArg] -&gt; [StgArg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span>   </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681855324"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681855324"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681855324"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-518"></span><span>                        </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-type">StgVarArg</span></a></span><span> </span><span id="local-6989586621681855325"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855325"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; StgArg) -&gt; Id -&gt; StgArg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe Id -&gt; Id
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855325"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Id -&gt; Id) -&gt; Maybe Id -&gt; Id
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; [(Id, Id)] -&gt; Maybe Id
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.18.3.0/src/GHC.List.html#lookup/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855325"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, Id)]
</span><a href="#local-6989586621681855319"><span class="hs-identifier hs-var">argMap</span></a></span><span>
</span><span id="line-519"></span><span>                        </span><span id="local-6989586621681855328"><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681855328"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681855328"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>                    </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855316"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855329"><span class="annot"><span class="annottext">conBody :: TgStgExpr
</span><a href="#local-6989586621681855329"><span class="hs-identifier hs-var hs-var">conBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; TgStgExpr
</span><a href="#local-6989586621681855318"><span class="hs-identifier hs-var">mkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681855323"><span class="hs-identifier hs-var">taggedArgs</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681855330"><span class="annot"><span class="annottext">body :: TgStgExpr
</span><a href="#local-6989586621681855330"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, Id) -&gt; TgStgExpr -&gt; TgStgExpr)
-&gt; TgStgExpr -&gt; [(Id, Id)] -&gt; TgStgExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681855332"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855332"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681855333"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855333"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681855334"><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855334"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; TgStgExpr -&gt; TgStgExpr
</span><a href="GHC.Stg.InferTags.Rewrite.html#mkSeq"><span class="hs-identifier hs-var">mkSeq</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855332"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681855333"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855334"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855329"><span class="hs-identifier hs-var">conBody</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, Id)]
</span><a href="#local-6989586621681855319"><span class="hs-identifier hs-var">argMap</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><span class="annottext">TgStgExpr -&gt; RM TgStgExpr
forall a. a -&gt; RM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TgStgExpr -&gt; RM TgStgExpr) -&gt; TgStgExpr -&gt; RM TgStgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">TgStgExpr
</span><a href="#local-6989586621681855330"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span class="hs-comment">-- Out of all arguments passed at runtime only return these ending up in a</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- strict field</span><span>
</span><span id="line-528"></span><span id="local-6989586621681854696"><span class="annot"><a href="GHC.Stg.InferTags.Rewrite.html#getStrictConArgs"><span class="hs-identifier hs-type">getStrictConArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681854696"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681854696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681854696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-529"></span><span id="getStrictConArgs"><span class="annot"><span class="annottext">getStrictConArgs :: forall a. Outputable a =&gt; DataCon -&gt; [a] -&gt; [a]
</span><a href="GHC.Stg.InferTags.Rewrite.html#getStrictConArgs"><span class="hs-identifier hs-var hs-var">getStrictConArgs</span></a></span></span><span> </span><span id="local-6989586621681855361"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855361"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681855362"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681855362"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-comment">-- These are always lazy in their arguments.</span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855361"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855361"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-comment">-- For proper data cons we have to check.</span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-535"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [a] -&gt; [a]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681855362"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[StrictnessMark] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DataCon -&gt; [StrictnessMark]
DataCon -&gt; [StrictnessMark]
</span><a href="GHC.Types.RepType.html#dataConRuntimeRepStrictness"><span class="hs-identifier hs-var">dataConRuntimeRepStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855361"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Mismatched con arg and con rep strictness lengths:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-537"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Con&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855361"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is applied to&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681855362"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-538"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;But seems to have arity&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StrictnessMark] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[StrictnessMark]
</span><a href="#local-6989586621681855366"><span class="hs-identifier hs-var">repStrictness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a]) -&gt; [a] -&gt; [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-539"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855367"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681855367"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681855367"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">StrictnessMark
</span><a href="GHC.Core.DataCon.html#MarkedStrict"><span class="hs-identifier hs-var">MarkedStrict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>                    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [a] -&gt; [StrictnessMark] -&gt; [(a, StrictnessMark)]
forall a b. (() :: Constraint) =&gt; String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getStrictConArgs&quot;</span></span><span>
</span><span id="line-541"></span><span>                                </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681855362"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-542"></span><span>                                </span><span class="annot"><span class="annottext">[StrictnessMark]
</span><a href="#local-6989586621681855366"><span class="hs-identifier hs-var">repStrictness</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-543"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-544"></span><span>            </span><span id="local-6989586621681855366"><span class="annot"><span class="annottext">repStrictness :: [StrictnessMark]
</span><a href="#local-6989586621681855366"><span class="hs-identifier hs-var hs-var">repStrictness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DataCon -&gt; [StrictnessMark]
DataCon -&gt; [StrictnessMark]
</span><a href="GHC.Types.RepType.html#dataConRuntimeRepStrictness"><span class="hs-identifier hs-var">dataConRuntimeRepStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681855361"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span></pre></body></html>