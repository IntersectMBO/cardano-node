<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveTraversable #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NondecreasingIndentation #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE GeneralisedNewtypeDeriving #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE ApplicativeDo #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- (c) The University of Glasgow, 2011</span><span>
</span><span id="line-23"></span><span class="hs-comment">--</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- This module implements multi-module compilation, and is used</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- by --make and GHCi.</span><span>
</span><span id="line-26"></span><span class="hs-comment">--</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-28"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.Make</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#depanal"><span class="hs-identifier">depanal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier">depanalE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier">depanalPartial</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#checkHomeUnitsClosed"><span class="hs-identifier">checkHomeUnitsClosed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#load"><span class="hs-identifier">load</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#loadWithCache"><span class="hs-identifier">loadWithCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier">load'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier">LoadHowMuch</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier">ModIfaceCache</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#noIfaceCache"><span class="hs-identifier">noIfaceCache</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#newIfaceCache"><span class="hs-identifier">newIfaceCache</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#instantiationNodes"><span class="hs-identifier">instantiationNodes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier">downsweep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier">topSortModuleGraph</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_home_srcimps"><span class="hs-identifier">ms_home_srcimps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_home_imps"><span class="hs-identifier">ms_home_imps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier">summariseModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#SummariseResult"><span class="hs-identifier">SummariseResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#summariseFile"><span class="hs-identifier">summariseFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.Types.SourceFile.html#hscSourceToIsBoot"><span class="hs-identifier">hscSourceToIsBoot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#findExtraSigImports"><span class="hs-identifier">findExtraSigImports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#implicitRequirementsShallow"><span class="hs-identifier">implicitRequirementsShallow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#noModError"><span class="hs-identifier">noModError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier">cyclicModuleErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#SummaryNode"><span class="hs-identifier">SummaryNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier">IsBootInterface</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier">mkNodeKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKey"><span class="hs-identifier">ModNodeKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier">ModNodeKeyWithUid</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier">ModNodeMap</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#emptyModNodeMap"><span class="hs-identifier">emptyModNodeMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapElems"><span class="hs-identifier">modNodeMapElems</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapLookup"><span class="hs-identifier">modNodeMapLookup</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapInsert"><span class="hs-identifier">modNodeMapInsert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapSingleton"><span class="hs-identifier">modNodeMapSingleton</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapUnionWith"><span class="hs-identifier">modNodeMapUnionWith</span></a></span><span>
</span><span id="line-52"></span><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html"><span class="hs-identifier">GHC.Tc.Utils.Backpack</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier">initIfaceCheck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier">concatMapM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Linker.Loader.html"><span class="hs-identifier">GHC.Linker.Loader</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Linker</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html"><span class="hs-identifier">GHC.Linker.Types</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Finder.html"><span class="hs-identifier">GHC.Driver.Config.Finder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier">initFinderOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Parser.html"><span class="hs-identifier">GHC.Driver.Config.Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Config.Parser.html#initParserOpts"><span class="hs-identifier">initParserOpts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html"><span class="hs-identifier">GHC.Driver.Phases</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html"><span class="hs-identifier">GHC.Driver.Pipeline</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html"><span class="hs-identifier">GHC.Driver.Backend</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html"><span class="hs-identifier">GHC.Driver.Monad</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.html"><span class="hs-identifier">GHC.Driver.Errors</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html"><span class="hs-identifier">GHC.Driver.Errors.Types</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html"><span class="hs-identifier">GHC.Driver.Main</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Header.html"><span class="hs-identifier">GHC.Parser.Header</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Errors.html#cannotFindModule"><span class="hs-identifier">cannotFindModule</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier">typecheckIface</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html"><span class="hs-identifier">GHC.Iface.Recomp</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompileRequired"><span class="hs-identifier">RecompileRequired</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#CompileReason"><span class="hs-identifier">CompileReason</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier">listToBag</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html"><span class="hs-identifier">GHC.Data.Graph.Directed</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier">expectJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html"><span class="hs-identifier">GHC.Data.StringBuffer</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.LanguageExtensions.html#/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#throwIO/GHC.IO.html#throwIO"><span class="hs-identifier">throwIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.Exception.html#SomeAsyncException/GHC.IO.Exception.html#SomeAsyncException"><span class="hs-identifier">SomeAsyncException</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Fingerprint.html"><span class="hs-identifier">GHC.Utils.Fingerprint</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Target.html"><span class="hs-identifier">GHC.Types.Target</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceError.html"><span class="hs-identifier">GHC.Types.SourceError</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html"><span class="hs-identifier">GHC.Types.PkgQual</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html"><span class="hs-identifier">GHC.Unit.Finder</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html"><span class="hs-identifier">GHC.Unit.Module.ModSummary</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html"><span class="hs-identifier">GHC.Unit.Module.Graph</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModDetails.html"><span class="hs-identifier">GHC.Unit.Module.ModDetails</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#/Data.Either.html"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#rights/Data.Either.html#rights"><span class="hs-identifier">rights</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#partitionEithers/Data.Either.html#partitionEithers"><span class="hs-identifier">partitionEithers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#lefts/Data.Either.html#lefts"><span class="hs-identifier">lefts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.html#/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.html#/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Concurrent.html#/Control.Concurrent.html"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Concurrent.QSem.html#newQSem/Control.Concurrent.QSem.html#newQSem"><span class="hs-identifier">newQSem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Concurrent.QSem.html#waitQSem/Control.Concurrent.QSem.html#waitQSem"><span class="hs-identifier">waitQSem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Concurrent.QSem.html#signalQSem/Control.Concurrent.QSem.html#signalQSem"><span class="hs-identifier">signalQSem</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#ThreadId/GHC.Conc.Sync.html#ThreadId"><span class="hs-identifier">ThreadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#killThread/GHC.Conc.Sync.html#killThread"><span class="hs-identifier">killThread</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#forkIOWithUnmask/GHC.Conc.Sync.html#forkIOWithUnmask"><span class="hs-identifier">forkIOWithUnmask</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.html#/GHC.Conc.html"><span class="hs-identifier">GHC.Conc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Concurrent.MVar.html#/Control.Concurrent.MVar.html"><span class="hs-identifier">Control.Concurrent.MVar</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#/Control.Monad.Trans.Except.html"><span class="hs-identifier">Control.Monad.Trans.Except</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#ExceptT/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier">ExceptT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier">runExceptT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#throwE/Control.Monad.Trans.Except.html#throwE"><span class="hs-identifier">throwE</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#/Control.Monad.Catch.html"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MC</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.IORef.html#/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../time-1.12.2/src/Data.Time.html#/Data.Time.html"><span class="hs-identifier">Data.Time</span></a></span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Bifunctor.html#/Data.Bifunctor.html"><span class="hs-identifier">Data.Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Bifunctor.html#first/Data.Bifunctor.html#first"><span class="hs-identifier">first</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.8.5/src/System.Directory.html#/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/System.FilePath.html#/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/System.IO.html#/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/System.IO.html#fixIO/System.IO.html#fixIO"><span class="hs-identifier">fixIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.html#/GHC.Conc.html"><span class="hs-identifier">GHC.Conc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#getNumProcessors/GHC.Conc.Sync.html#getNumProcessors"><span class="hs-identifier">getNumProcessors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#getNumCapabilities/GHC.Conc.Sync.html#getNumCapabilities"><span class="hs-identifier">getNumCapabilities</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#setNumCapabilities/GHC.Conc.Sync.html#setNumCapabilities"><span class="hs-identifier">setNumCapabilities</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#/Control.Monad.IO.Class.html"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#/Control.Monad.Trans.Reader.html"><span class="hs-identifier">Control.Monad.Trans.Reader</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.LogQueue.html"><span class="hs-identifier">GHC.Driver.Pipeline.LogQueue</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Strict.html#/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html"><span class="hs-identifier">GHC.Types.TypeEnv</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#/Control.Monad.Trans.State.Lazy.html"><span class="hs-identifier">Control.Monad.Trans.State.Lazy</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#/Control.Monad.Trans.Class.html"><span class="hs-identifier">Control.Monad.Trans.Class</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html"><span class="hs-identifier">GHC.Driver.Env.KnotVars</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../stm-2.5.1.0/src/Control.Concurrent.STM.html#/Control.Concurrent.STM.html"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#/Control.Monad.Trans.Maybe.html"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html"><span class="hs-identifier">GHC.Runtime.Loader</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html"><span class="hs-identifier">GHC.Rename.Names</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DFM.html"><span class="hs-identifier">GHC.Types.Unique.DFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.DFM.html#udfmRestrictKeysSet"><span class="hs-identifier">udfmRestrictKeysSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html"><span class="hs-identifier">GHC.Types.Unique.Map</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.IntSet.html#/Data.IntSet.html"><span class="hs-identifier">Data.IntSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- Loading the program</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Perform a dependency analysis starting from the current targets</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- and update the session with the new module graph.</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- Dependency analysis entails parsing the @import@ directives and may</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- therefore require running certain preprocessors.</span><span>
</span><span id="line-165"></span><span class="hs-comment">--</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- Note that each 'ModSummary' in the module graph caches its 'DynFlags'.</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- These 'DynFlags' are determined by the /current/ session 'DynFlags' and the</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- @OPTIONS@ and @LANGUAGE@ pragmas of the parsed module.  Thus if you want</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- changes to the 'DynFlags' to take effect you need to call this function</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- again.</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- In case of errors, just throw them.</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span id="local-6989586621682085718"><span class="annot"><a href="GHC.Driver.Make.html#depanal"><span class="hs-identifier hs-type">depanal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-174"></span><span>           </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ excluded modules</span></span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ allow duplicate roots</span></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span></span><span>
</span><span id="line-177"></span><span id="depanal"><span class="annot"><span class="annottext">depanal :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m ModuleGraph
</span><a href="GHC.Driver.Make.html#depanal"><span class="hs-identifier hs-var hs-var">depanal</span></a></span></span><span> </span><span id="local-6989586621682087002"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087002"><span class="hs-identifier hs-var">excluded_mods</span></a></span></span><span> </span><span id="local-6989586621682087003"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087003"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682087004"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087004"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087005"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087005"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-var">depanalE</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087002"><span class="hs-identifier hs-var">excluded_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087003"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DriverMessages -&gt; Bool
forall e. Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-var">isEmptyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087004"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; m ModuleGraph
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087005"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; m ModuleGraph
forall (io :: * -&gt; *) a. MonadIO io =&gt; Messages GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage)
-&gt; DriverMessages -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; Messages a -&gt; Messages b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087004"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | Perform dependency analysis like in 'depanal'.</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- In case of errors, the errors and an empty module graph are returned.</span><span>
</span><span id="line-185"></span><span id="local-6989586621682085730"><span class="annot"><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-type">depanalE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085730"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>     </span><span class="hs-comment">-- New for #17459</span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>      </span><span class="annot"><span class="hs-comment">-- ^ excluded modules</span></span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ allow duplicate roots</span></span><span>
</span><span id="line-188"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085730"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-189"></span><span id="depanalE"><span class="annot"><span class="annottext">depanalE :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-var hs-var">depanalE</span></a></span></span><span> </span><span id="local-6989586621682087040"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087040"><span class="hs-identifier hs-var">excluded_mods</span></a></span></span><span> </span><span id="local-6989586621682087041"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087041"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621682087042"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087042"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682087044"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087044"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087045"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087045"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier hs-var">depanalPartial</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087040"><span class="hs-identifier hs-var">excluded_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087041"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DriverMessages -&gt; Bool
forall e. Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-var">isEmptyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087044"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>        </span><span id="local-6989586621682087046"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087046"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087047"><span class="annot"><span class="annottext">one_unit_messages :: IO DriverMessages -&gt; UnitId -&gt; HomeUnitEnv -&gt; IO DriverMessages
</span><a href="#local-6989586621682087047"><span class="hs-identifier hs-var hs-var">one_unit_messages</span></a></span></span><span> </span><span id="local-6989586621682087048"><span class="annot"><span class="annottext">IO DriverMessages
</span><a href="#local-6989586621682087048"><span class="hs-identifier hs-var">get_mod_errs</span></a></span></span><span> </span><span id="local-6989586621682087049"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087049"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682087050"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087050"><span class="hs-identifier hs-var">hue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>              </span><span id="local-6989586621682087051"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087051"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO DriverMessages
</span><a href="#local-6989586621682087048"><span class="hs-identifier hs-var">get_mod_errs</span></a></span><span>
</span><span id="line-197"></span><span>              </span><span id="local-6989586621682087052"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087052"><span class="hs-identifier hs-var">unknown_module_err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags -&gt; ModuleGraph -&gt; IO DriverMessages
</span><a href="GHC.Driver.Make.html#warnUnknownModules"><span class="hs-identifier hs-var">warnUnknownModules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitId -&gt; HscEnv -&gt; HscEnv
UnitId -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-var">hscSetActiveUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087049"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087046"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087050"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087045"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087056"><span class="annot"><span class="annottext">unused_home_mod_err :: DriverMessages
</span><a href="#local-6989586621682087056"><span class="hs-identifier hs-var hs-var">unused_home_mod_err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Target] -&gt; ModuleGraph -&gt; DriverMessages
</span><a href="GHC.Driver.Make.html#warnMissingHomeModules"><span class="hs-identifier hs-var">warnMissingHomeModules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087050"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; [Target]
</span><a href="GHC.Driver.Env.Types.html#hsc_targets"><span class="hs-identifier hs-var">hsc_targets</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087046"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087045"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-200"></span><span>                  </span><span id="local-6989586621682087059"><span class="annot"><span class="annottext">unused_pkg_err :: DriverMessages
</span><a href="#local-6989586621682087059"><span class="hs-identifier hs-var hs-var">unused_pkg_err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; DynFlags -&gt; ModuleGraph -&gt; DriverMessages
</span><a href="GHC.Driver.Make.html#warnUnusedPackages"><span class="hs-identifier hs-var">warnUnusedPackages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#homeUnitEnv_units"><span class="hs-identifier hs-var">homeUnitEnv_units</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087050"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087050"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087045"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>              </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087051"><span class="hs-identifier hs-var">errs</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages -&gt; DriverMessages -&gt; DriverMessages
forall e. Messages e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-var">`unionMessages`</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087056"><span class="hs-identifier hs-var">unused_home_mod_err</span></a></span><span>
</span><span id="line-204"></span><span>                          </span><span class="annot"><span class="annottext">DriverMessages -&gt; DriverMessages -&gt; DriverMessages
forall e. Messages e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-var">`unionMessages`</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087059"><span class="hs-identifier hs-var">unused_pkg_err</span></a></span><span>
</span><span id="line-205"></span><span>                          </span><span class="annot"><span class="annottext">DriverMessages -&gt; DriverMessages -&gt; DriverMessages
forall e. Messages e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionMessages"><span class="hs-operator hs-var">`unionMessages`</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087052"><span class="hs-identifier hs-var">unknown_module_err</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>        </span><span id="local-6989586621682087063"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087063"><span class="hs-identifier hs-var">all_errs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO DriverMessages -&gt; m DriverMessages
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO DriverMessages -&gt; m DriverMessages)
-&gt; IO DriverMessages -&gt; m DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(IO DriverMessages -&gt; UnitId -&gt; HomeUnitEnv -&gt; IO DriverMessages)
-&gt; IO DriverMessages
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; IO DriverMessages
forall b a. (b -&gt; UnitId -&gt; a -&gt; b) -&gt; b -&gt; UnitEnvGraph a -&gt; b
</span><a href="GHC.Unit.Env.html#unitEnv_foldWithKey"><span class="hs-identifier hs-var">unitEnv_foldWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">IO DriverMessages -&gt; UnitId -&gt; HomeUnitEnv -&gt; IO DriverMessages
</span><a href="#local-6989586621682087047"><span class="hs-identifier hs-var">one_unit_messages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DriverMessages -&gt; IO DriverMessages
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087046"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; Messages GhcMessage -&gt; m ()
</span><a href="GHC.Driver.Monad.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage)
-&gt; DriverMessages -&gt; Messages GhcMessage
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087063"><span class="hs-identifier hs-var">all_errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087046"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682087045"><span class="hs-identifier hs-type">mod_graph</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DriverMessages
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087045"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-comment">-- We don't have a complete module dependency graph,</span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-comment">-- The graph may be disconnected and is unusable.</span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087042"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#emptyMG"><span class="hs-identifier hs-type">emptyMG</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087044"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="GHC.Unit.Module.Graph.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | Perform dependency analysis like 'depanal' but return a partial module</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- graph even in the face of problems with some modules.</span><span>
</span><span id="line-220"></span><span class="hs-comment">--</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- Modules which have parse errors in the module header, failing</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- preprocessors or other issues preventing them from being summarised will</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- simply be absent from the returned module graph.</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Unlike 'depanal' this function will not update 'hsc_mod_graph' with the</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- new module graph.</span><span>
</span><span id="line-227"></span><span id="local-6989586621682087073"><span class="annot"><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier hs-type">depanalPartial</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087073"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ excluded modules</span></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ allow duplicate roots</span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682087073"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ possibly empty 'Bag' of errors and a module graph.</span></span><span>
</span><span id="line-233"></span><span id="depanalPartial"><span class="annot"><span class="annottext">depanalPartial :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier hs-var hs-var">depanalPartial</span></a></span></span><span> </span><span id="local-6989586621682087099"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087099"><span class="hs-identifier hs-var">excluded_mods</span></a></span></span><span> </span><span id="local-6989586621682087100"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087100"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621682087101"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087101"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-236"></span><span>         </span><span id="local-6989586621682087102"><span class="annot"><span class="annottext">targets :: [Target]
</span><a href="#local-6989586621682087102"><span class="hs-identifier hs-var hs-var">targets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Target]
</span><a href="GHC.Driver.Env.Types.html#hsc_targets"><span class="hs-identifier hs-var">hsc_targets</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087101"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-237"></span><span>         </span><span id="local-6989586621682087103"><span class="annot"><span class="annottext">old_graph :: ModuleGraph
</span><a href="#local-6989586621682087103"><span class="hs-identifier hs-var hs-var">old_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph
</span><a href="GHC.Driver.Env.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087101"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-238"></span><span>         </span><span id="local-6989586621682087104"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682087104"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087101"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; ((DriverMessages, ModuleGraph) -&gt; ())
-&gt; m (DriverMessages, ModuleGraph)
-&gt; m (DriverMessages, ModuleGraph)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682087104"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Chasing dependencies&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; (DriverMessages, ModuleGraph) -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (DriverMessages, ModuleGraph)
 -&gt; m (DriverMessages, ModuleGraph))
-&gt; m (DriverMessages, ModuleGraph)
-&gt; m (DriverMessages, ModuleGraph)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682087104"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-242"></span><span>              </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Chasing modules from: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>              </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Target -&gt; SDoc) -&gt; [Target] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Target -&gt; SDoc
</span><a href="GHC.Types.Target.html#pprTarget"><span class="hs-identifier hs-var">pprTarget</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621682087102"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-comment">-- Home package modules may have been moved or deleted, and new</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-comment">-- source files may have appeared in the home package that shadow</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-comment">-- external package modules, so we have to discard the existing</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-comment">-- cached finder data.</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache -&gt; UnitEnv -&gt; IO ()
</span><a href="GHC.Unit.Finder.html#flushFinderCaches"><span class="hs-identifier hs-var">flushFinderCaches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087101"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087101"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682087117"><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682087117"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087118"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087118"><span class="hs-identifier hs-var">graph_nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ([DriverMessages], [ModuleGraphNode])
-&gt; m ([DriverMessages], [ModuleGraphNode])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ([DriverMessages], [ModuleGraphNode])
 -&gt; m ([DriverMessages], [ModuleGraphNode]))
-&gt; IO ([DriverMessages], [ModuleGraphNode])
-&gt; m ([DriverMessages], [ModuleGraphNode])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [ModSummary]
-&gt; [ModuleName]
-&gt; Bool
-&gt; IO ([DriverMessages], [ModuleGraphNode])
</span><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier hs-var">downsweep</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087101"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087103"><span class="hs-identifier hs-var">old_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>      </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087099"><span class="hs-identifier hs-var">excluded_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087100"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-255"></span><span>      </span><span id="local-6989586621682087120"><span class="annot"><span class="annottext">mod_graph :: ModuleGraph
</span><a href="#local-6989586621682087120"><span class="hs-identifier hs-var hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; ModuleGraph
</span><a href="GHC.Unit.Module.Graph.html#mkModuleGraph"><span class="hs-identifier hs-var">mkModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087118"><span class="hs-identifier hs-var">graph_nodes</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DriverMessages] -&gt; DriverMessages
forall (f :: * -&gt; *) e. Foldable f =&gt; f (Messages e) -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionManyMessages"><span class="hs-identifier hs-var">unionManyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682087117"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087120"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- | Collect the instantiations of dependencies to create 'InstantiationNode' work graph nodes.</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- These are used to represent the type checking that is done after</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- all the free holes (sigs in current package) relevant to that instantiation</span><span>
</span><span id="line-261"></span><span class="hs-comment">-- are compiled. This is necessary to catch some instantiation errors.</span><span>
</span><span id="line-262"></span><span class="hs-comment">--</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- In the future, perhaps more of the work of instantiation could be moved here,</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- instead of shoved in with the module compilation nodes. That could simplify</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- backpack, and maybe hs-boot too.</span><span>
</span><span id="line-266"></span><span class="annot"><a href="GHC.Driver.Make.html#instantiationNodes"><span class="hs-identifier hs-type">instantiationNodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span id="instantiationNodes"><span class="annot"><span class="annottext">instantiationNodes :: UnitId -&gt; UnitState -&gt; [ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#instantiationNodes"><span class="hs-identifier hs-var hs-var">instantiationNodes</span></a></span></span><span> </span><span id="local-6989586621682087124"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087124"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682087125"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682087125"><span class="hs-identifier hs-var">unit_state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; InstantiatedUnit -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#InstantiationNode"><span class="hs-identifier hs-var">InstantiationNode</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087124"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">(InstantiatedUnit -&gt; ModuleGraphNode)
-&gt; [InstantiatedUnit] -&gt; [ModuleGraphNode]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[InstantiatedUnit]
</span><a href="#local-6989586621682087126"><span class="hs-identifier hs-var">iuids_to_check</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><a href="#local-6989586621682087126"><span class="hs-identifier hs-type">iuids_to_check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedUnit"><span class="hs-identifier hs-type">InstantiatedUnit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621682087126"><span class="annot"><span class="annottext">iuids_to_check :: [InstantiatedUnit]
</span><a href="#local-6989586621682087126"><span class="hs-identifier hs-var hs-var">iuids_to_check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">[InstantiatedUnit] -&gt; [InstantiatedUnit]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#nubSort"><span class="hs-identifier hs-var">nubSort</span></a></span><span> </span><span class="annot"><span class="annottext">([InstantiatedUnit] -&gt; [InstantiatedUnit])
-&gt; [InstantiatedUnit] -&gt; [InstantiatedUnit]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((GenUnit UnitId, Maybe PackageArg) -&gt; [InstantiatedUnit])
-&gt; [(GenUnit UnitId, Maybe PackageArg)] -&gt; [InstantiatedUnit]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; [InstantiatedUnit]
forall {unit}. GenUnit unit -&gt; [GenInstantiatedUnit unit]
</span><a href="#local-6989586621682087129"><span class="hs-identifier hs-var">goUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; [InstantiatedUnit])
-&gt; ((GenUnit UnitId, Maybe PackageArg) -&gt; GenUnit UnitId)
-&gt; (GenUnit UnitId, Maybe PackageArg)
-&gt; [InstantiatedUnit]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId, Maybe PackageArg) -&gt; GenUnit UnitId
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; [(GenUnit UnitId, Maybe PackageArg)]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var">explicitUnits</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682087125"><span class="hs-identifier hs-var">unit_state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-273"></span><span>      </span><span id="local-6989586621682087129"><span class="annot"><span class="annottext">goUnitId :: GenUnit unit -&gt; [GenInstantiatedUnit unit]
</span><a href="#local-6989586621682087129"><span class="hs-identifier hs-var hs-var">goUnitId</span></a></span></span><span> </span><span id="local-6989586621682087133"><span class="annot"><span class="annottext">GenUnit unit
</span><a href="#local-6989586621682087133"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit unit
</span><a href="#local-6989586621682087134"><span class="hs-identifier hs-var">recur</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span> </span><span id="local-6989586621682087136"><span class="annot"><span class="annottext">GenInstantiatedUnit unit
</span><a href="#local-6989586621682087136"><span class="hs-identifier hs-var">indef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenUnit unit
</span><a href="#local-6989586621682087133"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087137"><span class="annot"><span class="annottext">(ModuleName, GenModule (GenUnit unit))
</span><a href="#local-6989586621682087137"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit unit -&gt; GenInstantiations unit
forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var">instUnitInsts</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit unit
</span><a href="#local-6989586621682087136"><span class="hs-identifier hs-var">indef</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087134"><span class="annot"><span class="annottext">GenInstantiatedUnit unit
</span><a href="#local-6989586621682087134"><span class="hs-identifier hs-var">recur</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit unit
</span><a href="#local-6989586621682087136"><span class="hs-identifier hs-var">indef</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit unit
-&gt; [GenInstantiatedUnit unit] -&gt; [GenInstantiatedUnit unit]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([GenInstantiatedUnit unit] -&gt; [GenInstantiatedUnit unit])
-&gt; [GenInstantiatedUnit unit] -&gt; [GenInstantiatedUnit unit]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit unit -&gt; [GenInstantiatedUnit unit]
</span><a href="#local-6989586621682087129"><span class="hs-identifier hs-var">goUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit unit -&gt; [GenInstantiatedUnit unit])
-&gt; GenUnit unit -&gt; [GenInstantiatedUnit unit]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule (GenUnit unit) -&gt; GenUnit unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule (GenUnit unit) -&gt; GenUnit unit)
-&gt; GenModule (GenUnit unit) -&gt; GenUnit unit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, GenModule (GenUnit unit)) -&gt; GenModule (GenUnit unit)
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, GenModule (GenUnit unit))
</span><a href="#local-6989586621682087137"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-comment">-- The linking plan for each module. If we need to do linking for a home unit</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- then this function returns a graph node which depends on all the modules in the home unit.</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- At the moment nothing can depend on these LinkNodes.</span><span>
</span><span id="line-284"></span><span class="annot"><a href="GHC.Driver.Make.html#linkNodes"><span class="hs-identifier hs-type">linkNodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitEnv"><span class="hs-identifier hs-type">HomeUnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessage"><span class="hs-identifier hs-type">DriverMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span id="linkNodes"><span class="annot"><span class="annottext">linkNodes :: [ModuleGraphNode]
-&gt; UnitId
-&gt; HomeUnitEnv
-&gt; Maybe (Either DriverMessages ModuleGraphNode)
</span><a href="GHC.Driver.Make.html#linkNodes"><span class="hs-identifier hs-var hs-var">linkNodes</span></a></span></span><span> </span><span id="local-6989586621682087142"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087142"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span id="local-6989586621682087143"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087143"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682087144"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087144"><span class="hs-identifier hs-var">hue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087145"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087144"><span class="hs-identifier hs-var">hue</span></a></span><span>
</span><span id="line-287"></span><span>      </span><span id="local-6989586621682087146"><span class="annot"><span class="annottext">ofile :: Maybe FilePath
</span><a href="#local-6989586621682087146"><span class="hs-identifier hs-var hs-var">ofile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe FilePath
</span><a href="GHC.Driver.Session.html#outputFile_"><span class="hs-identifier hs-var">outputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><a href="#local-6989586621682087148"><span class="hs-identifier hs-type">unit_nodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span>      </span><span id="local-6989586621682087148"><span class="annot"><span class="annottext">unit_nodes :: [NodeKey]
</span><a href="#local-6989586621682087148"><span class="hs-identifier hs-var hs-var">unit_nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; NodeKey) -&gt; [ModuleGraphNode] -&gt; [NodeKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; Bool) -&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087143"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Bool)
-&gt; (ModuleGraphNode -&gt; UnitId) -&gt; ModuleGraphNode -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodeUnitId"><span class="hs-identifier hs-var">moduleGraphNodeUnitId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087142"><span class="hs-identifier hs-var">summaries</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-comment">-- Issue a warning for the confusing case where the user</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-comment">-- said '-o foo' but we're not going to do any linking.</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- We attempt linking if either (a) one of the modules is</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-comment">-- called Main, or (b) the user said -no-hs-main, indicating</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-comment">-- that main() is going to come from somewhere else.</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span>      </span><span id="local-6989586621682087150"><span class="annot"><span class="annottext">no_hs_main :: Bool
</span><a href="#local-6989586621682087150"><span class="hs-identifier hs-var hs-var">no_hs_main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_NoHsMain"><span class="hs-identifier hs-var">Opt_NoHsMain</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>      </span><span id="local-6989586621682087153"><span class="annot"><span class="annottext">main_sum :: Bool
</span><a href="#local-6989586621682087153"><span class="hs-identifier hs-var hs-var">main_sum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Bool) -&gt; [NodeKey] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; NodeKey -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; UnitId -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-var">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; ModuleNameWithIsBoot
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName
</span><a href="GHC.Driver.Session.html#mainModuleNameIs"><span class="hs-identifier hs-var">mainModuleNameIs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087143"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087148"><span class="hs-identifier hs-var">unit_nodes</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>      </span><span id="local-6989586621682087160"><span class="annot"><span class="annottext">do_linking :: Bool
</span><a href="#local-6989586621682087160"><span class="hs-identifier hs-var hs-var">do_linking</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087153"><span class="hs-identifier hs-var">main_sum</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087150"><span class="hs-identifier hs-var">no_hs_main</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkDynLib"><span class="hs-identifier hs-var">LinkDynLib</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkStaticLib"><span class="hs-identifier hs-var">LinkStaticLib</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkBinary"><span class="hs-identifier hs-var">LinkBinary</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621682087146"><span class="hs-identifier hs-var">ofile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087160"><span class="hs-identifier hs-var">do_linking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="annottext">Either DriverMessages ModuleGraphNode
-&gt; Maybe (Either DriverMessages ModuleGraphNode)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DriverMessages -&gt; Either DriverMessages ModuleGraphNode
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessages -&gt; Either DriverMessages ModuleGraphNode)
-&gt; DriverMessages -&gt; Either DriverMessages ModuleGraphNode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverRedirectedNoMain"><span class="hs-identifier hs-var">DriverRedirectedNoMain</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; DriverMessage) -&gt; ModuleName -&gt; DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName
</span><a href="GHC.Driver.Session.html#mainModuleNameIs"><span class="hs-identifier hs-var">mainModuleNameIs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-comment">-- This should be an error, not a warning (#10895).</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087145"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#NoLink"><span class="hs-identifier hs-var">NoLink</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087160"><span class="hs-identifier hs-var">do_linking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either DriverMessages ModuleGraphNode
-&gt; Maybe (Either DriverMessages ModuleGraphNode)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; Either DriverMessages ModuleGraphNode
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; UnitId -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#LinkNode"><span class="hs-identifier hs-var">LinkNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087148"><span class="hs-identifier hs-var">unit_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087143"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either DriverMessages ModuleGraphNode)
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">-- Note [Missing home modules]</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- Sometimes we don't want GHC to process modules that weren't specified as</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- explicit targets. For example, cabal may want to enable this warning</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- when building a library, so that GHC warns the user about modules listed</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- neither in `exposed-modules` nor in `other-modules`.</span><span>
</span><span id="line-315"></span><span class="hs-comment">--</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- Here &quot;home module&quot; means a module that doesn't come from another package.</span><span>
</span><span id="line-317"></span><span class="hs-comment">--</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- For example, if GHC is invoked with modules &quot;A&quot; and &quot;B&quot; as targets,</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- but &quot;A&quot; imports some other module &quot;C&quot;, then GHC will issue a warning</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- about module &quot;C&quot; not being listed in the command line.</span><span>
</span><span id="line-321"></span><span class="hs-comment">--</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- The warning in enabled by `-Wmissing-home-modules`. See #13129</span><span>
</span><span id="line-323"></span><span class="annot"><a href="GHC.Driver.Make.html#warnMissingHomeModules"><span class="hs-identifier hs-type">warnMissingHomeModules</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Target.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span>
</span><span id="line-324"></span><span id="warnMissingHomeModules"><span class="annot"><span class="annottext">warnMissingHomeModules :: DynFlags -&gt; [Target] -&gt; ModuleGraph -&gt; DriverMessages
</span><a href="GHC.Driver.Make.html#warnMissingHomeModules"><span class="hs-identifier hs-var hs-var">warnMissingHomeModules</span></a></span></span><span> </span><span id="local-6989586621682087176"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087176"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682087177"><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621682087177"><span class="hs-identifier hs-var">targets</span></a></span></span><span> </span><span id="local-6989586621682087178"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087178"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087180"><span class="hs-identifier hs-var">missing</span></a></span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DriverMessages
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087181"><span class="hs-identifier hs-var">warn</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621682087182"><span class="annot"><span class="annottext">diag_opts :: DiagOpts
</span><a href="#local-6989586621682087182"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087176"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-comment">-- We need to be careful to handle the case where (possibly</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-comment">-- path-qualified) filenames (aka 'TargetFile') rather than module</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-comment">-- names are being passed on the GHC command-line.</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-comment">-- For instance, `ghc --make src-exe/Main.hs` and</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-comment">-- `ghc --make -isrc-exe Main` are supposed to be equivalent.</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-comment">-- Note also that we can't always infer the associated module name</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- directly from the filename argument.  See #13727.</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621682087184"><span class="annot"><span class="annottext">is_known_module :: ModSummary -&gt; Bool
</span><a href="#local-6989586621682087184"><span class="hs-identifier hs-var hs-var">is_known_module</span></a></span></span><span> </span><span id="local-6989586621682087185"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087185"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; Map ModuleName UnitId -&gt; Maybe UnitId
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087185"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map ModuleName UnitId
</span><a href="#local-6989586621682087189"><span class="hs-identifier hs-var">mod_targets</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UnitId -&gt; Maybe UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Maybe UnitId
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087185"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; (FilePath -&gt; Bool) -&gt; Maybe FilePath -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="#local-6989586621682087192"><span class="hs-identifier hs-var">is_file_target</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087185"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621682087192"><span class="annot"><span class="annottext">is_file_target :: FilePath -&gt; Bool
</span><a href="#local-6989586621682087192"><span class="hs-identifier hs-var hs-var">is_file_target</span></a></span></span><span> </span><span id="local-6989586621682087195"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087195"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Set FilePath -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#member/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="#local-6989586621682087197"><span class="hs-identifier hs-var">withoutExt</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087195"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set FilePath
</span><a href="#local-6989586621682087198"><span class="hs-identifier hs-var">file_targets</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621682087198"><span class="annot"><span class="annottext">file_targets :: Set FilePath
</span><a href="#local-6989586621682087198"><span class="hs-identifier hs-var hs-var">file_targets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; Set FilePath
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Target -&gt; Maybe FilePath) -&gt; [Target] -&gt; [FilePath]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Target -&gt; Maybe FilePath
</span><a href="#local-6989586621682087201"><span class="hs-identifier hs-var">file_target</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621682087177"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621682087201"><span class="annot"><span class="annottext">file_target :: Target -&gt; Maybe FilePath
</span><a href="#local-6989586621682087201"><span class="hs-identifier hs-var hs-var">file_target</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Target.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682087203"><span class="annot"><span class="annottext">TargetId
targetId :: TargetId
targetId :: Target -&gt; TargetId
</span><a href="#local-6989586621682087203"><span class="hs-identifier hs-var hs-var">targetId</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TargetId
</span><a href="#local-6989586621682087203"><span class="hs-identifier hs-var">targetId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>        </span><span class="annot"><a href="GHC.Types.Target.html#TargetModule"><span class="hs-identifier hs-type">TargetModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><a href="GHC.Types.Target.html#TargetFile"><span class="hs-identifier hs-type">TargetFile</span></a></span><span> </span><span id="local-6989586621682087207"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087207"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-352"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="#local-6989586621682087197"><span class="hs-identifier hs-var">withoutExt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath -&gt; FilePath
</span><a href="GHC.Driver.Session.html#augmentByWorkingDirectory"><span class="hs-identifier hs-var">augmentByWorkingDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087176"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087207"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621682087189"><span class="annot"><span class="annottext">mod_targets :: Map ModuleName UnitId
</span><a href="#local-6989586621682087189"><span class="hs-identifier hs-var hs-var">mod_targets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, UnitId)] -&gt; Map ModuleName UnitId
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Target -&gt; (ModuleName, UnitId)
</span><a href="#local-6989586621682087210"><span class="hs-identifier hs-var">mod_target</span></a></span><span> </span><span class="annot"><span class="annottext">(Target -&gt; (ModuleName, UnitId))
-&gt; [Target] -&gt; [(ModuleName, UnitId)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621682087177"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621682087210"><span class="annot"><span class="annottext">mod_target :: Target -&gt; (ModuleName, UnitId)
</span><a href="#local-6989586621682087210"><span class="hs-identifier hs-var hs-var">mod_target</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Target.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682087211"><span class="annot"><span class="annottext">UnitId
targetUnitId :: UnitId
targetUnitId :: Target -&gt; UnitId
</span><a href="#local-6989586621682087211"><span class="hs-identifier hs-var hs-var">targetUnitId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087213"><span class="annot"><span class="annottext">TargetId
targetId :: Target -&gt; TargetId
targetId :: TargetId
</span><a href="GHC.Types.Target.html#targetId"><span class="hs-identifier hs-var hs-var">targetId</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TargetId
</span><a href="#local-6989586621682087213"><span class="hs-identifier hs-var">targetId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><a href="GHC.Types.Target.html#TargetModule"><span class="hs-identifier hs-type">TargetModule</span></a></span><span> </span><span id="local-6989586621682087214"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087214"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087214"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087211"><span class="hs-identifier hs-var">targetUnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><a href="GHC.Types.Target.html#TargetFile"><span class="hs-identifier hs-type">TargetFile</span></a></span><span> </span><span id="local-6989586621682087215"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087215"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; ModuleName
</span><a href="Language.Haskell.Syntax.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="#local-6989586621682087197"><span class="hs-identifier hs-var">withoutExt</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087215"><span class="hs-identifier hs-var">file</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087211"><span class="hs-identifier hs-var">targetUnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621682087197"><span class="annot"><span class="annottext">withoutExt :: FilePath -&gt; FilePath
</span><a href="#local-6989586621682087197"><span class="hs-identifier hs-var hs-var">withoutExt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath, FilePath) -&gt; FilePath
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((FilePath, FilePath) -&gt; FilePath)
-&gt; (FilePath -&gt; (FilePath, FilePath)) -&gt; FilePath -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; (FilePath, FilePath)
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#splitExtension/System.FilePath.Posix.html#splitExtension"><span class="hs-identifier hs-var">splitExtension</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621682087180"><span class="annot"><span class="annottext">missing :: [ModuleName]
</span><a href="#local-6989586621682087180"><span class="hs-identifier hs-var hs-var">missing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName)
-&gt; (ModSummary -&gt; Module) -&gt; ModSummary -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; [ModuleName]) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; [ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (ModSummary -&gt; Bool) -&gt; ModSummary -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621682087184"><span class="hs-identifier hs-var">is_known_module</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; [ModSummary]) -&gt; [ModSummary] -&gt; [ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; [ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087218"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087218"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087218"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087176"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087178"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621682087181"><span class="annot"><span class="annottext">warn :: DriverMessages
</span><a href="#local-6989586621682087181"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682087182"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-369"></span><span>                         </span><span class="annot"><span class="annottext">(DriverMessage -&gt; MsgEnvelope DriverMessage)
-&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; [ModuleName] -&gt; BuildingCabalPackage -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverMissingHomeModules"><span class="hs-identifier hs-var">DriverMissingHomeModules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087176"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087180"><span class="hs-identifier hs-var">missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; BuildingCabalPackage
</span><a href="GHC.Driver.Errors.Types.html#checkBuildingCabalPackage"><span class="hs-identifier hs-var">checkBuildingCabalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087176"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- Check that any modules we want to reexport or hide are actually in the package.</span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Driver.Make.html#warnUnknownModules"><span class="hs-identifier hs-type">warnUnknownModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span>
</span><span id="line-373"></span><span id="warnUnknownModules"><span class="annot"><span class="annottext">warnUnknownModules :: HscEnv -&gt; DynFlags -&gt; ModuleGraph -&gt; IO DriverMessages
</span><a href="GHC.Driver.Make.html#warnUnknownModules"><span class="hs-identifier hs-var hs-var">warnUnknownModules</span></a></span></span><span> </span><span id="local-6989586621682087223"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087223"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682087224"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682087225"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087225"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-374"></span><span>  </span><span id="local-6989586621682087226"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087226"><span class="hs-identifier hs-var">reexported_warns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; IO Bool) -&gt; [ModuleName] -&gt; IO [ModuleName]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><a href="../../base-4.18.2.1/src/Control.Monad.html#filterM/Control.Monad.html#filterM"><span class="hs-identifier hs-var">filterM</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IO Bool
</span><a href="#local-6989586621682087228"><span class="hs-identifier hs-var">check_reexport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ModuleName -&gt; [ModuleName]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set ModuleName
</span><a href="#local-6989586621682087230"><span class="hs-identifier hs-var">reexported_mods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Set ModuleName -&gt; [ModuleName] -&gt; DriverMessages
</span><a href="#local-6989586621682087231"><span class="hs-identifier hs-var">final_msgs</span></a></span><span> </span><span class="annot"><span class="annottext">Set ModuleName
</span><a href="#local-6989586621682087232"><span class="hs-identifier hs-var">hidden_warns</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087226"><span class="hs-identifier hs-var">reexported_warns</span></a></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621682087233"><span class="annot"><span class="annottext">diag_opts :: DiagOpts
</span><a href="#local-6989586621682087233"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621682087234"><span class="annot"><span class="annottext">unit_mods :: Set ModuleName
</span><a href="#local-6989586621682087234"><span class="hs-identifier hs-var hs-var">unit_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Set ModuleName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span>
</span><span id="line-380"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; [ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087236"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087236"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087236"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087225"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>    </span><span id="local-6989586621682087230"><span class="annot"><span class="annottext">reexported_mods :: Set ModuleName
</span><a href="#local-6989586621682087230"><span class="hs-identifier hs-var hs-var">reexported_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Set ModuleName
</span><a href="GHC.Driver.Session.html#reexportedModules"><span class="hs-identifier hs-var">reexportedModules</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621682087238"><span class="annot"><span class="annottext">hidden_mods :: Set ModuleName
</span><a href="#local-6989586621682087238"><span class="hs-identifier hs-var hs-var">hidden_mods</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Set ModuleName
</span><a href="GHC.Driver.Session.html#hiddenModules"><span class="hs-identifier hs-var">hiddenModules</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>    </span><span id="local-6989586621682087232"><span class="annot"><span class="annottext">hidden_warns :: Set ModuleName
</span><a href="#local-6989586621682087232"><span class="hs-identifier hs-var hs-var">hidden_warns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ModuleName
</span><a href="#local-6989586621682087238"><span class="hs-identifier hs-var">hidden_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Set ModuleName -&gt; Set ModuleName -&gt; Set ModuleName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#difference/Data.Set.Internal.html#difference"><span class="hs-operator hs-var">`Set.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">Set ModuleName
</span><a href="#local-6989586621682087234"><span class="hs-identifier hs-var">unit_mods</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621682087241"><span class="annot"><span class="annottext">lookupModule :: ModuleName -&gt; IO FindResult
</span><a href="#local-6989586621682087241"><span class="hs-identifier hs-var hs-var">lookupModule</span></a></span></span><span> </span><span id="local-6989586621682087242"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087242"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; PkgQual -&gt; IO FindResult
</span><a href="GHC.Unit.Finder.html#findImportedModule"><span class="hs-identifier hs-var">findImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087223"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087242"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621682087228"><span class="annot"><span class="annottext">check_reexport :: ModuleName -&gt; IO Bool
</span><a href="#local-6989586621682087228"><span class="hs-identifier hs-var hs-var">check_reexport</span></a></span></span><span> </span><span id="local-6989586621682087245"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087245"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>      </span><span id="local-6989586621682087246"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682087246"><span class="hs-identifier hs-var">fr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IO FindResult
</span><a href="#local-6989586621682087241"><span class="hs-identifier hs-var">lookupModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087245"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-392"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682087246"><span class="hs-identifier hs-var">fr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682087248"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682087248"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682087248"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>        </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621682087250"><span class="annot"><span class="annottext">warn :: DriverMessage -&gt; DriverMessages
</span><a href="#local-6989586621682087250"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span id="local-6989586621682087251"><span class="annot"><span class="annottext">DriverMessage
</span><a href="#local-6989586621682087251"><span class="hs-identifier hs-var">diagnostic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682087233"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-398"></span><span>                         </span><span class="annot"><span class="annottext">(DriverMessage -&gt; MsgEnvelope DriverMessage)
-&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessage
</span><a href="#local-6989586621682087251"><span class="hs-identifier hs-var">diagnostic</span></a></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621682087231"><span class="annot"><span class="annottext">final_msgs :: Set ModuleName -&gt; [ModuleName] -&gt; DriverMessages
</span><a href="#local-6989586621682087231"><span class="hs-identifier hs-var hs-var">final_msgs</span></a></span></span><span> </span><span id="local-6989586621682087252"><span class="annot"><span class="annottext">Set ModuleName
</span><a href="#local-6989586621682087252"><span class="hs-identifier hs-var">hidden_warns</span></a></span></span><span> </span><span id="local-6989586621682087253"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087253"><span class="hs-identifier hs-var">reexported_warns</span></a></span></span><span>
</span><span id="line-401"></span><span>          </span><span class="hs-glyph">=</span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><span class="annottext">[DriverMessages] -&gt; DriverMessages
forall (f :: * -&gt; *) e. Foldable f =&gt; f (Messages e) -&gt; Messages e
</span><a href="GHC.Types.Error.html#unionManyMessages"><span class="hs-identifier hs-var">unionManyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">([DriverMessages] -&gt; DriverMessages)
-&gt; [DriverMessages] -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-403"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DriverMessage -&gt; DriverMessages
</span><a href="#local-6989586621682087250"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; [ModuleName] -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverUnknownHiddenModules"><span class="hs-identifier hs-var">DriverUnknownHiddenModules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ModuleName -&gt; [ModuleName]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set ModuleName
</span><a href="#local-6989586621682087252"><span class="hs-identifier hs-var">hidden_warns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set ModuleName -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#null/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set ModuleName
</span><a href="#local-6989586621682087252"><span class="hs-identifier hs-var">hidden_warns</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-404"></span><span>          </span><span class="annot"><span class="annottext">[DriverMessages] -&gt; [DriverMessages] -&gt; [DriverMessages]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DriverMessage -&gt; DriverMessages
</span><a href="#local-6989586621682087250"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; [ModuleName] -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverUnknownReexportedModules"><span class="hs-identifier hs-var">DriverUnknownReexportedModules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087224"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087253"><span class="hs-identifier hs-var">reexported_warns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087253"><span class="hs-identifier hs-var">reexported_warns</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="annot"><span class="hs-comment">-- | Describes which modules of the module graph need to be loaded.</span></span><span>
</span><span id="line-407"></span><span class="hs-keyword">data</span><span> </span><span id="LoadHowMuch"><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier hs-var">LoadHowMuch</span></a></span></span><span>
</span><span id="line-408"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="LoadAllTargets"><span class="annot"><a href="GHC.Driver.Make.html#LoadAllTargets"><span class="hs-identifier hs-var">LoadAllTargets</span></a></span></span><span>
</span><span id="line-409"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Load all targets and its dependencies.</span></span><span>
</span><span id="line-410"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="LoadUpTo"><span class="annot"><a href="GHC.Driver.Make.html#LoadUpTo"><span class="hs-identifier hs-var">LoadUpTo</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#HomeUnitModule"><span class="hs-identifier hs-type">HomeUnitModule</span></a></span><span>
</span><span id="line-411"></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ Load only the given module and its dependencies.</span></span><span>
</span><span id="line-412"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="LoadDependenciesOf"><span class="annot"><a href="GHC.Driver.Make.html#LoadDependenciesOf"><span class="hs-identifier hs-var">LoadDependenciesOf</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#HomeUnitModule"><span class="hs-identifier hs-type">HomeUnitModule</span></a></span><span>
</span><span id="line-413"></span><span>     </span><span class="hs-comment">-- ^ Load only the dependencies of the given module, but not the module</span><span>
</span><span id="line-414"></span><span>     </span><span class="hs-comment">-- itself.</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-comment">{-
Note [Caching HomeModInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~~

API clients who call `load` like to cache the HomeModInfo in memory between
calls to this function. In the old days, this cache was a simple MVar which stored
a HomePackageTable. This was insufficient, as the interface files for boot modules
were not recorded in the cache. In the less old days, the cache was returned at the
end of load, and supplied at the start of load, however, this was not sufficient
because it didn't account for the possibility of exceptions such as SIGINT (#20780).

So now, in the current day, we have this ModIfaceCache abstraction which
can incrementally be updated during the process of upsweep. This allows us
to store interface files for boot modules in an exception-safe way.

When the final version of an interface file is completed then it is placed into
the cache. The contents of the cache is retrieved, and the cache cleared, by iface_clearCache.

Note that because we only store the ModIface and Linkable in the ModIfaceCache,
hydration and rehydration is totally irrelevant, and we just store the CachedIface as
soon as it is completed.

-}</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="hs-comment">-- Abstract interface to a cache of HomeModInfo</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- See Note [Caching HomeModInfo]</span><span>
</span><span id="line-443"></span><span class="hs-keyword">data</span><span> </span><span id="ModIfaceCache"><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-var">ModIfaceCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ModIfaceCache"><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-var">ModIfaceCache</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="iface_clearCache"><span class="annot"><span class="annottext">ModIfaceCache -&gt; IO [CachedIface]
</span><a href="GHC.Driver.Make.html#iface_clearCache"><span class="hs-identifier hs-var hs-var">iface_clearCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-type">CachedIface</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-444"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span id="iface_addToCache"><span class="annot"><span class="annottext">ModIfaceCache -&gt; CachedIface -&gt; IO ()
</span><a href="GHC.Driver.Make.html#iface_addToCache"><span class="hs-identifier hs-var hs-var">iface_addToCache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-type">CachedIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span class="annot"><a href="GHC.Driver.Make.html#addHmiToCache"><span class="hs-identifier hs-type">addHmiToCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span id="addHmiToCache"><span class="annot"><span class="annottext">addHmiToCache :: ModIfaceCache -&gt; HomeModInfo -&gt; IO ()
</span><a href="GHC.Driver.Make.html#addHmiToCache"><span class="hs-identifier hs-var hs-var">addHmiToCache</span></a></span></span><span> </span><span id="local-6989586621682087264"><span class="annot"><span class="annottext">ModIfaceCache
</span><a href="#local-6989586621682087264"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span> </span><span id="local-6989586621682087266"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087266"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682087267"><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682087267"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIfaceCache -&gt; CachedIface -&gt; IO ()
</span><a href="GHC.Driver.Make.html#iface_addToCache"><span class="hs-identifier hs-var">iface_addToCache</span></a></span><span> </span><span class="annot"><span class="annottext">ModIfaceCache
</span><a href="#local-6989586621682087264"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; HomeModLinkable -&gt; CachedIface
</span><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-var">CachedIface</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087266"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682087267"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="hs-keyword">data</span><span> </span><span id="CachedIface"><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-var">CachedIface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CachedIface"><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-var">CachedIface</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="cached_modiface"><span class="annot"><span class="annottext">CachedIface -&gt; ModIface
</span><a href="GHC.Driver.Make.html#cached_modiface"><span class="hs-identifier hs-var hs-var">cached_modiface</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-450"></span><span>                               </span><span class="hs-special">,</span><span> </span><span id="cached_linkable"><span class="annot"><span class="annottext">CachedIface -&gt; HomeModLinkable
</span><a href="GHC.Driver.Make.html#cached_linkable"><span class="hs-identifier hs-var hs-var">cached_linkable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModLinkable"><span class="hs-identifier hs-type">HomeModLinkable</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-type">CachedIface</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-453"></span><span>  </span><span id="local-6989586621682087280"><span class="annot"><span class="annottext">ppr :: CachedIface -&gt; SDoc
</span><a href="#local-6989586621682087280"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-type">CachedIface</span></a></span><span> </span><span id="local-6989586621682087282"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087282"><span class="hs-identifier hs-var">mi</span></a></span></span><span> </span><span id="local-6989586621682087283"><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682087283"><span class="hs-identifier hs-var">ln</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;CachedIface&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; ModNodeKeyWithUid
</span><a href="GHC.Driver.Make.html#miKey"><span class="hs-identifier hs-var">miKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087282"><span class="hs-identifier hs-var">mi</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682087283"><span class="hs-identifier hs-var">ln</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="annot"><a href="GHC.Driver.Make.html#noIfaceCache"><span class="hs-identifier hs-type">noIfaceCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span>
</span><span id="line-456"></span><span id="noIfaceCache"><span class="annot"><span class="annottext">noIfaceCache :: Maybe ModIfaceCache
</span><a href="GHC.Driver.Make.html#noIfaceCache"><span class="hs-identifier hs-var hs-var">noIfaceCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="annot"><a href="GHC.Driver.Make.html#newIfaceCache"><span class="hs-identifier hs-type">newIfaceCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span>
</span><span id="line-459"></span><span id="newIfaceCache"><span class="annot"><span class="annottext">newIfaceCache :: IO ModIfaceCache
</span><a href="GHC.Driver.Make.html#newIfaceCache"><span class="hs-identifier hs-var hs-var">newIfaceCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>  </span><span id="local-6989586621682087286"><span class="annot"><span class="annottext">IORef [CachedIface]
</span><a href="#local-6989586621682087286"><span class="hs-identifier hs-var">ioref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CachedIface] -&gt; IO (IORef [CachedIface])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-462"></span><span>    </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span>
</span><span id="line-463"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">iface_clearCache :: IO [CachedIface]
</span><a href="GHC.Driver.Make.html#iface_clearCache"><span class="hs-identifier hs-var">iface_clearCache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [CachedIface]
-&gt; ([CachedIface] -&gt; ([CachedIface], [CachedIface]))
-&gt; IO [CachedIface]
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#atomicModifyIORef%27/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [CachedIface]
</span><a href="#local-6989586621682087286"><span class="hs-identifier hs-var">ioref</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087289"><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087289"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087289"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iface_addToCache :: CachedIface -&gt; IO ()
</span><a href="GHC.Driver.Make.html#iface_addToCache"><span class="hs-identifier hs-var">iface_addToCache</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682087290"><span class="annot"><span class="annottext">CachedIface
</span><a href="#local-6989586621682087290"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [CachedIface]
-&gt; ([CachedIface] -&gt; ([CachedIface], ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#atomicModifyIORef%27/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [CachedIface]
</span><a href="#local-6989586621682087286"><span class="hs-identifier hs-var">ioref</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087291"><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087291"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CachedIface
</span><a href="#local-6989586621682087290"><span class="hs-identifier hs-var">hmi</span></a></span><span class="annot"><span class="annottext">CachedIface -&gt; [CachedIface] -&gt; [CachedIface]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087291"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-comment">-- | Try to load the program.  See 'LoadHowMuch' for the different modes.</span><span>
</span><span id="line-471"></span><span class="hs-comment">--</span><span>
</span><span id="line-472"></span><span class="hs-comment">-- This function implements the core of GHC's @--make@ mode.  It preprocesses,</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- compiles and loads the specified modules, avoiding re-compilation wherever</span><span>
</span><span id="line-474"></span><span class="hs-comment">-- possible.  Depending on the backend (see 'DynFlags.backend' field) compiling</span><span>
</span><span id="line-475"></span><span class="hs-comment">-- and loading may result in files being created on disk.</span><span>
</span><span id="line-476"></span><span class="hs-comment">--</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- Calls the 'defaultWarnErrLogger' after each compiling each module, whether</span><span>
</span><span id="line-478"></span><span class="hs-comment">-- successful or not.</span><span>
</span><span id="line-479"></span><span class="hs-comment">--</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- If errors are encountered during dependency analysis, the module `depanalE`</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- returns together with the errors an empty ModuleGraph.</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- After processing this empty ModuleGraph, the errors of depanalE are thrown.</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- All other errors are reported using the 'defaultWarnErrLogger'.</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span id="local-6989586621682085846"><span class="annot"><a href="GHC.Driver.Make.html#load"><span class="hs-identifier hs-type">load</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085846"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier hs-type">LoadHowMuch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085846"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span></span><span>
</span><span id="line-486"></span><span id="load"><span class="annot"><span class="annottext">load :: forall (f :: * -&gt; *). GhcMonad f =&gt; LoadHowMuch -&gt; f SuccessFlag
</span><a href="GHC.Driver.Make.html#load"><span class="hs-identifier hs-var hs-var">load</span></a></span></span><span> </span><span id="local-6989586621682087295"><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621682087295"><span class="hs-identifier hs-var">how_much</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache -&gt; LoadHowMuch -&gt; f SuccessFlag
forall (m :: * -&gt; *).
GhcMonad m =&gt;
Maybe ModIfaceCache -&gt; LoadHowMuch -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadWithCache"><span class="hs-identifier hs-var">loadWithCache</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="GHC.Driver.Make.html#noIfaceCache"><span class="hs-identifier hs-var">noIfaceCache</span></a></span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621682087295"><span class="hs-identifier hs-var">how_much</span></a></span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="annot"><a href="GHC.Driver.Make.html#mkBatchMsg"><span class="hs-identifier hs-type">mkBatchMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-489"></span><span id="mkBatchMsg"><span class="annot"><span class="annottext">mkBatchMsg :: HscEnv -&gt; Messager
</span><a href="GHC.Driver.Make.html#mkBatchMsg"><span class="hs-identifier hs-var hs-var">mkBatchMsg</span></a></span></span><span> </span><span id="local-6989586621682087297"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087297"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Int
forall a. Set a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Set UnitId
</span><a href="GHC.Driver.Env.html#hsc_all_home_unit_ids"><span class="hs-identifier hs-var">hsc_all_home_unit_ids</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087297"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-comment">-- This also displays what unit each module is from.</span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="GHC.Driver.Main.html#batchMultiMsg"><span class="hs-identifier hs-var">batchMultiMsg</span></a></span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier hs-var">batchMsg</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span id="local-6989586621682085850"><span class="annot"><a href="GHC.Driver.Make.html#loadWithCache"><span class="hs-identifier hs-type">loadWithCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085850"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier hs-type">LoadHowMuch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085850"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span></span><span>
</span><span id="line-497"></span><span id="loadWithCache"><span class="annot"><span class="annottext">loadWithCache :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
Maybe ModIfaceCache -&gt; LoadHowMuch -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadWithCache"><span class="hs-identifier hs-var hs-var">loadWithCache</span></a></span></span><span> </span><span id="local-6989586621682087320"><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087320"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span id="local-6989586621682087321"><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621682087321"><span class="hs-identifier hs-var">how_much</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682087322"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087322"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087323"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087323"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (DriverMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-var">depanalE</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>                        </span><span class="hs-comment">-- #17459</span><span>
</span><span id="line-499"></span><span>    </span><span id="local-6989586621682087324"><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621682087324"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Messager
</span><a href="GHC.Driver.Make.html#mkBatchMsg"><span class="hs-identifier hs-var">mkBatchMsg</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; Messager) -&gt; m HscEnv -&gt; m Messager
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span id="local-6989586621682087325"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087325"><span class="hs-identifier hs-var">success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
-&gt; LoadHowMuch -&gt; Maybe Messager -&gt; ModuleGraph -&gt; m SuccessFlag
forall (m :: * -&gt; *).
GhcMonad m =&gt;
Maybe ModIfaceCache
-&gt; LoadHowMuch -&gt; Maybe Messager -&gt; ModuleGraph -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier hs-var">load'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087320"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621682087321"><span class="hs-identifier hs-var">how_much</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messager -&gt; Maybe Messager
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621682087324"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087323"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DriverMessages -&gt; Bool
forall e. Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#isEmptyMessages"><span class="hs-identifier hs-var">isEmptyMessages</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087322"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-502"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; m SuccessFlag
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087325"><span class="hs-identifier hs-var">success</span></a></span><span>
</span><span id="line-503"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; m SuccessFlag
forall (io :: * -&gt; *) a. MonadIO io =&gt; Messages GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage)
-&gt; DriverMessages -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; Messages a -&gt; Messages b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087322"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-comment">-- Note [Unused packages]</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- Cabal passes `--package-id` flag for each direct dependency. But GHC</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- loads them lazily, so when compilation is done, we have a list of all</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- actually loaded packages. All the packages, specified on command line,</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- but never loaded, are probably unused dependencies.</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="annot"><a href="GHC.Driver.Make.html#warnUnusedPackages"><span class="hs-identifier hs-type">warnUnusedPackages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span>
</span><span id="line-513"></span><span id="warnUnusedPackages"><span class="annot"><span class="annottext">warnUnusedPackages :: UnitState -&gt; DynFlags -&gt; ModuleGraph -&gt; DriverMessages
</span><a href="GHC.Driver.Make.html#warnUnusedPackages"><span class="hs-identifier hs-var hs-var">warnUnusedPackages</span></a></span></span><span> </span><span id="local-6989586621682087326"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682087326"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621682087327"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087327"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682087328"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087328"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087329"><span class="annot"><span class="annottext">diag_opts :: DiagOpts
</span><a href="#local-6989586621682087329"><span class="hs-identifier hs-var hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087327"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-comment">-- Only need non-source imports here because SOURCE imports are always HPT</span><span>
</span><span id="line-517"></span><span>        </span><span id="local-6989586621682087330"><span class="annot"><span class="annottext">loadedPackages :: [UnitInfo]
</span><a href="#local-6989586621682087330"><span class="hs-identifier hs-var hs-var">loadedPackages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[UnitInfo]] -&gt; [UnitInfo]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[UnitInfo]] -&gt; [UnitInfo]) -&gt; [[UnitInfo]] -&gt; [UnitInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-518"></span><span>          </span><span class="annot"><span class="annottext">((PkgQual, GenLocated SrcSpan ModuleName) -&gt; Maybe [UnitInfo])
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)] -&gt; [[UnitInfo]]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682087332"><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682087332"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087333"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682087333"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; ModuleName -&gt; PkgQual -&gt; Maybe [UnitInfo]
</span><a href="GHC.Unit.State.html#lookupModulePackage"><span class="hs-identifier hs-var">lookupModulePackage</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682087326"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682087333"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682087332"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>            </span><span class="annot"><span class="annottext">([(PkgQual, GenLocated SrcSpan ModuleName)] -&gt; [[UnitInfo]])
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)] -&gt; [[UnitInfo]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)])
-&gt; [ModSummary] -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_imps"><span class="hs-identifier hs-var">ms_imps</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-520"></span><span>              </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; [ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087337"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087337"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId_"><span class="hs-identifier hs-var">homeUnitId_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087327"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087337"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087328"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>        </span><span id="local-6989586621682087338"><span class="annot"><span class="annottext">used_args :: Set UnitId
</span><a href="#local-6989586621682087338"><span class="hs-identifier hs-var hs-var">used_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId) -&gt; [UnitId] -&gt; Set UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; UnitId) -&gt; [UnitInfo] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.6/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621682087330"><span class="hs-identifier hs-var">loadedPackages</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>        </span><span id="local-6989586621682087340"><span class="annot"><span class="annottext">resolve :: (GenUnit UnitId, Maybe PackageArg)
-&gt; Maybe (UnitId, PackageName, Version, PackageArg)
</span><a href="#local-6989586621682087340"><span class="hs-identifier hs-var hs-var">resolve</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682087341"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621682087341"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682087342"><span class="annot"><span class="annottext">Maybe PackageArg
</span><a href="#local-6989586621682087342"><span class="hs-identifier hs-var">mflag</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-525"></span><span>                  </span><span class="hs-comment">-- The units which we depend on via the command line explicitly</span><span>
</span><span id="line-526"></span><span>                  </span><span id="local-6989586621682087343"><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621682087343"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PackageArg
</span><a href="#local-6989586621682087342"><span class="hs-identifier hs-var">mflag</span></a></span><span>
</span><span id="line-527"></span><span>                  </span><span class="hs-comment">-- Which we can find the UnitInfo for (should be all of them)</span><span>
</span><span id="line-528"></span><span>                  </span><span id="local-6989586621682087344"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621682087344"><span class="hs-identifier hs-var">ui</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; GenUnit UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier hs-var">lookupUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682087326"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621682087341"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-529"></span><span>                  </span><span class="hs-comment">-- Which are not explicitly used</span><span>
</span><span id="line-530"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../base-4.18.2.1/src/Control.Monad.html#guard/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#notMember/Data.Set.Internal.html#notMember"><span class="hs-identifier hs-var">Set.notMember</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.6/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621682087344"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682087338"><span class="hs-identifier hs-var">used_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>                  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; uid
</span><a href="../../ghc-boot-9.6.6/src/GHC.Unit.Database.html#unitId/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var">unitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621682087344"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; PackageName
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod
-&gt; srcpkgname
</span><a href="../../ghc-boot-9.6.6/src/GHC.Unit.Database.html#unitPackageName/GHC.Unit.Database.html#unitPackageName"><span class="hs-identifier hs-var">unitPackageName</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621682087344"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Version
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; Version
</span><a href="../../ghc-boot-9.6.6/src/GHC.Unit.Database.html#unitPackageVersion/GHC.Unit.Database.html#unitPackageVersion"><span class="hs-identifier hs-var">unitPackageVersion</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621682087344"><span class="hs-identifier hs-var">ui</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621682087343"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>        </span><span id="local-6989586621682087349"><span class="annot"><span class="annottext">unusedArgs :: [(UnitId, PackageName, Version, PackageArg)]
</span><a href="#local-6989586621682087349"><span class="hs-identifier hs-var hs-var">unusedArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GenUnit UnitId, Maybe PackageArg)
 -&gt; Maybe (UnitId, PackageName, Version, PackageArg))
-&gt; [(GenUnit UnitId, Maybe PackageArg)]
-&gt; [(UnitId, PackageName, Version, PackageArg)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId, Maybe PackageArg)
-&gt; Maybe (UnitId, PackageName, Version, PackageArg)
</span><a href="#local-6989586621682087340"><span class="hs-identifier hs-var">resolve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; [(GenUnit UnitId, Maybe PackageArg)]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var">explicitUnits</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682087326"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>        </span><span id="local-6989586621682087350"><span class="annot"><span class="annottext">warn :: DriverMessages
</span><a href="#local-6989586621682087350"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682087329"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(UnitId, PackageName, Version, PackageArg)] -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverUnusedPackages"><span class="hs-identifier hs-var">DriverUnusedPackages</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PackageName, Version, PackageArg)]
</span><a href="#local-6989586621682087349"><span class="hs-identifier hs-var">unusedArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PackageName, Version, PackageArg)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PackageName, Version, PackageArg)]
</span><a href="#local-6989586621682087349"><span class="hs-identifier hs-var">unusedArgs</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DriverMessages
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-539"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682087350"><span class="hs-identifier hs-var">warn</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-comment">-- | A ModuleGraphNode which also has a hs-boot file, and the list of nodes on any</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- path from module to its boot file.</span><span>
</span><span id="line-543"></span><span class="hs-keyword">data</span><span> </span><span id="ModuleGraphNodeWithBootFile"><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-var">ModuleGraphNodeWithBootFile</span></a></span></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ModuleGraphNodeWithBootFile"><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-var">ModuleGraphNodeWithBootFile</span></a></span></span><span>
</span><span id="line-545"></span><span>     </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span>
</span><span id="line-546"></span><span>       </span><span class="annot"><span class="hs-comment">-- ^ The module itself (not the hs-boot module)</span></span><span>
</span><span id="line-547"></span><span>     </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-548"></span><span>       </span><span class="hs-comment">-- ^ The modules in between the module and its hs-boot file,</span><span>
</span><span id="line-549"></span><span>       </span><span class="hs-comment">-- not including the hs-boot file itself.</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621682087360"><span class="annot"><span class="annottext">ppr :: ModuleGraphNodeWithBootFile -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span> </span><span id="local-6989586621682087361"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087361"><span class="hs-identifier hs-var">mgn</span></a></span></span><span> </span><span id="local-6989586621682087362"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087362"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;ModeGraphNodeWithBootFile: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087361"><span class="hs-identifier hs-var">mgn</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087362"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="hs-comment">-- | A 'BuildPlan' is the result of attempting to linearise a single strongly-connected</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- component of the module graph.</span><span>
</span><span id="line-557"></span><span class="hs-keyword">data</span><span> </span><span id="BuildPlan"><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-var">BuildPlan</span></a></span></span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A simple, single module all alone (which *might* have an hs-boot file, if it isn't part of a cycle)</span></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SingleModule"><span class="annot"><a href="GHC.Driver.Make.html#SingleModule"><span class="hs-identifier hs-var">SingleModule</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span>
</span><span id="line-560"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A resolved cycle, linearised by hs-boot files</span></span><span>
</span><span id="line-561"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ResolvedCycle"><span class="annot"><a href="GHC.Driver.Make.html#ResolvedCycle"><span class="hs-identifier hs-var">ResolvedCycle</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><span class="hs-comment">-- | An actual cycle, which wasn't resolved by hs-boot files</span></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnresolvedCycle"><span class="annot"><a href="GHC.Driver.Make.html#UnresolvedCycle"><span class="hs-identifier hs-var">UnresolvedCycle</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-566"></span><span>  </span><span id="local-6989586621682087383"><span class="annot"><span class="annottext">ppr :: BuildPlan -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#SingleModule"><span class="hs-identifier hs-type">SingleModule</span></a></span><span> </span><span id="local-6989586621682087384"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087384"><span class="hs-identifier hs-var">mgn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;SingleModule&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087384"><span class="hs-identifier hs-var">mgn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ResolvedCycle"><span class="hs-identifier hs-type">ResolvedCycle</span></a></span><span> </span><span id="local-6989586621682087387"><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087387"><span class="hs-identifier hs-var">mgn</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;ResolvedCycle:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087387"><span class="hs-identifier hs-var">mgn</span></a></span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#UnresolvedCycle"><span class="hs-identifier hs-type">UnresolvedCycle</span></a></span><span> </span><span id="local-6989586621682087388"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087388"><span class="hs-identifier hs-var">mgn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;UnresolvedCycle:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087388"><span class="hs-identifier hs-var">mgn</span></a></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="hs-comment">-- Just used for an assertion</span><span>
</span><span id="line-572"></span><span class="annot"><a href="GHC.Driver.Make.html#countMods"><span class="hs-identifier hs-type">countMods</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-573"></span><span id="countMods"><span class="annot"><span class="annottext">countMods :: BuildPlan -&gt; Int
</span><a href="GHC.Driver.Make.html#countMods"><span class="hs-identifier hs-var hs-var">countMods</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#SingleModule"><span class="hs-identifier hs-type">SingleModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.Driver.Make.html#countMods"><span class="hs-identifier hs-var">countMods</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ResolvedCycle"><span class="hs-identifier hs-type">ResolvedCycle</span></a></span><span> </span><span id="local-6989586621682087390"><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087390"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087390"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-575"></span><span class="annot"><a href="GHC.Driver.Make.html#countMods"><span class="hs-identifier hs-var">countMods</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#UnresolvedCycle"><span class="hs-identifier hs-type">UnresolvedCycle</span></a></span><span> </span><span id="local-6989586621682087391"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087391"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087391"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="hs-comment">-- See Note [Upsweep] for a high-level description.</span><span>
</span><span id="line-578"></span><span class="annot"><a href="GHC.Driver.Make.html#createBuildPlan"><span class="hs-identifier hs-type">createBuildPlan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#HomeUnitModule"><span class="hs-identifier hs-type">HomeUnitModule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-579"></span><span id="createBuildPlan"><span class="annot"><span class="annottext">createBuildPlan :: ModuleGraph -&gt; Maybe HomeUnitModule -&gt; [BuildPlan]
</span><a href="GHC.Driver.Make.html#createBuildPlan"><span class="hs-identifier hs-var hs-var">createBuildPlan</span></a></span></span><span> </span><span id="local-6989586621682087393"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087393"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span id="local-6989586621682087394"><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087394"><span class="hs-identifier hs-var">maybe_top_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Step 1: Compute SCCs without .hi-boot files, to find the cycles</span><span>
</span><span id="line-581"></span><span>        </span><span id="local-6989586621682087395"><span class="annot"><span class="annottext">cycle_mod_graph :: [SCC ModuleGraphNode]
</span><a href="#local-6989586621682087395"><span class="hs-identifier hs-var hs-var">cycle_mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ModuleGraph -&gt; Maybe HomeUnitModule -&gt; [SCC ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var">topSortModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087393"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087394"><span class="hs-identifier hs-var">maybe_top_mod</span></a></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>        </span><span class="hs-comment">-- Step 2: Reanalyse loops, with relevant boot modules, to solve the cycles.</span><span>
</span><span id="line-584"></span><span>        </span><span class="annot"><a href="#local-6989586621682087396"><span class="hs-identifier hs-type">build_plan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-585"></span><span>        </span><span id="local-6989586621682087396"><span class="annot"><span class="annottext">build_plan :: [BuildPlan]
</span><a href="#local-6989586621682087396"><span class="hs-identifier hs-var hs-var">build_plan</span></a></span></span><span>
</span><span id="line-586"></span><span>          </span><span class="hs-comment">-- Fast path, if there are no boot modules just do a normal toposort</span><span>
</span><span id="line-587"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleEnv (ModuleGraphNode, [ModuleGraphNode]) -&gt; Bool
forall a. ModuleEnv a -&gt; Bool
</span><a href="GHC.Unit.Module.Env.html#isEmptyModuleEnv"><span class="hs-identifier hs-var">isEmptyModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleEnv (ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087398"><span class="hs-identifier hs-var">boot_modules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087399"><span class="hs-identifier hs-var">collapseAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">([SCC ModuleGraphNode] -&gt; [BuildPlan])
-&gt; [SCC ModuleGraphNode] -&gt; [BuildPlan]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ModuleGraph -&gt; Maybe HomeUnitModule -&gt; [SCC ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var">topSortModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087393"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087394"><span class="hs-identifier hs-var">maybe_top_mod</span></a></span><span>
</span><span id="line-588"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087400"><span class="hs-identifier hs-var">toBuildPlan</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087395"><span class="hs-identifier hs-var">cycle_mod_graph</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span>        </span><span class="annot"><a href="#local-6989586621682087400"><span class="hs-identifier hs-type">toBuildPlan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-591"></span><span>        </span><span id="local-6989586621682087400"><span class="annot"><span class="annottext">toBuildPlan :: [SCC ModuleGraphNode] -&gt; [ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087400"><span class="hs-identifier hs-var hs-var">toBuildPlan</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682087401"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087401"><span class="hs-identifier hs-var">mgn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087399"><span class="hs-identifier hs-var">collapseAcyclic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [SCC ModuleGraphNode]
</span><a href="#local-6989586621682087402"><span class="hs-identifier hs-var">topSortWithBoot</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087401"><span class="hs-identifier hs-var">mgn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>        </span><span class="annot"><a href="#local-6989586621682087400"><span class="hs-identifier hs-var">toBuildPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#AcyclicSCC/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621682087404"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087404"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682087405"><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087405"><span class="hs-identifier hs-var">sccs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682087406"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087406"><span class="hs-identifier hs-var">mgn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087400"><span class="hs-identifier hs-var">toBuildPlan</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087405"><span class="hs-identifier hs-var">sccs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087404"><span class="hs-identifier hs-var">node</span></a></span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087406"><span class="hs-identifier hs-var">mgn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-comment">-- Interesting case</span><span>
</span><span id="line-594"></span><span>        </span><span class="annot"><a href="#local-6989586621682087400"><span class="hs-identifier hs-var">toBuildPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#CyclicSCC/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621682087408"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087408"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682087409"><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087409"><span class="hs-identifier hs-var">sccs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682087410"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087410"><span class="hs-identifier hs-var">mgn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-595"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087411"><span class="annot"><span class="annottext">acyclic :: [BuildPlan]
</span><a href="#local-6989586621682087411"><span class="hs-identifier hs-var hs-var">acyclic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087399"><span class="hs-identifier hs-var">collapseAcyclic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [SCC ModuleGraphNode]
</span><a href="#local-6989586621682087402"><span class="hs-identifier hs-var">topSortWithBoot</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087410"><span class="hs-identifier hs-var">mgn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>              </span><span class="hs-comment">-- Now perform another toposort but just with these nodes and relevant hs-boot files.</span><span>
</span><span id="line-597"></span><span>              </span><span class="hs-comment">-- The result should be acyclic, if it's not, then there's an unresolved cycle in the graph.</span><span>
</span><span id="line-598"></span><span>              </span><span id="local-6989586621682087412"><span class="annot"><span class="annottext">mresolved_cycle :: Either
  [ModuleGraphNode]
  [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087412"><span class="hs-identifier hs-var hs-var">mresolved_cycle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087413"><span class="hs-identifier hs-var">collapseSCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [SCC ModuleGraphNode]
</span><a href="#local-6989586621682087402"><span class="hs-identifier hs-var">topSortWithBoot</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087408"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087411"><span class="hs-identifier hs-var">acyclic</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan] -&gt; [BuildPlan] -&gt; [BuildPlan]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">([ModuleGraphNode] -&gt; BuildPlan)
-&gt; ([Either ModuleGraphNode ModuleGraphNodeWithBootFile]
    -&gt; BuildPlan)
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; BuildPlan
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../base-4.18.2.1/src/Data.Either.html#either/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; BuildPlan
</span><a href="GHC.Driver.Make.html#UnresolvedCycle"><span class="hs-identifier hs-var">UnresolvedCycle</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile] -&gt; BuildPlan
</span><a href="GHC.Driver.Make.html#ResolvedCycle"><span class="hs-identifier hs-var">ResolvedCycle</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  [ModuleGraphNode]
  [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087412"><span class="hs-identifier hs-var">mresolved_cycle</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[BuildPlan] -&gt; [BuildPlan] -&gt; [BuildPlan]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087400"><span class="hs-identifier hs-var">toBuildPlan</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087409"><span class="hs-identifier hs-var">sccs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682087415"><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682087415"><span class="hs-identifier hs-var">mg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087416"><span class="annot"><span class="annottext">NodeKey -&gt; Maybe SummaryNode
</span><a href="#local-6989586621682087416"><span class="hs-identifier hs-var">lookup_node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; [ModuleGraphNode]
-&gt; (Graph SummaryNode, NodeKey -&gt; Maybe SummaryNode)
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodes"><span class="hs-identifier hs-var">moduleGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModuleGraphNode]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries%27"><span class="hs-identifier hs-var">mgModSummaries'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087393"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>        </span><span id="local-6989586621682087419"><span class="annot"><span class="annottext">trans_deps_map :: Map NodeKey (Set NodeKey)
</span><a href="#local-6989586621682087419"><span class="hs-identifier hs-var hs-var">trans_deps_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode
-&gt; (SummaryNode -&gt; NodeKey) -&gt; Map NodeKey (Set NodeKey)
forall key node.
Ord key =&gt;
Graph node -&gt; (node -&gt; key) -&gt; Map key (Set key)
</span><a href="GHC.Data.Graph.Directed.html#allReachable"><span class="hs-identifier hs-var">allReachable</span></a></span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682087415"><span class="hs-identifier hs-var">mg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; NodeKey)
-&gt; (SummaryNode -&gt; ModuleGraphNode) -&gt; SummaryNode -&gt; NodeKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SummaryNode -&gt; ModuleGraphNode
forall key payload. Node key payload -&gt; payload
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var">node_payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-comment">-- Compute the intermediate modules between a file and its hs-boot file.</span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-comment">-- See Step 2a in Note [Upsweep]</span><span>
</span><span id="line-605"></span><span>        </span><span id="local-6989586621682087422"><span class="annot"><span class="annottext">boot_path :: ModuleName -&gt; UnitId -&gt; [ModuleGraphNode]
</span><a href="#local-6989586621682087422"><span class="hs-identifier hs-var hs-var">boot_path</span></a></span></span><span> </span><span id="local-6989586621682087423"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087423"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621682087424"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087424"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-606"></span><span>          </span><span class="annot"><span class="annottext">(NodeKey -&gt; ModuleGraphNode) -&gt; [NodeKey] -&gt; [ModuleGraphNode]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SummaryNode -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#summaryNodeSummary"><span class="hs-identifier hs-var">summaryNodeSummary</span></a></span><span> </span><span class="annot"><span class="annottext">(SummaryNode -&gt; ModuleGraphNode)
-&gt; (NodeKey -&gt; SummaryNode) -&gt; NodeKey -&gt; ModuleGraphNode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe SummaryNode -&gt; SummaryNode
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;toNode&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe SummaryNode -&gt; SummaryNode)
-&gt; (NodeKey -&gt; Maybe SummaryNode) -&gt; NodeKey -&gt; SummaryNode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe SummaryNode
</span><a href="#local-6989586621682087416"><span class="hs-identifier hs-var">lookup_node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([NodeKey] -&gt; [ModuleGraphNode]) -&gt; [NodeKey] -&gt; [ModuleGraphNode]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey -&gt; [NodeKey]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set NodeKey -&gt; [NodeKey]) -&gt; Set NodeKey -&gt; [NodeKey]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-607"></span><span>          </span><span class="hs-comment">-- Don't include the boot module itself</span><span>
</span><span id="line-608"></span><span>          </span><span class="annot"><span class="annottext">NodeKey -&gt; Set NodeKey -&gt; Set NodeKey
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#delete/Data.Set.Internal.html#delete"><span class="hs-identifier hs-var">Set.delete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsBootInterface -&gt; ModNodeKeyWithUid
</span><a href="#local-6989586621682087427"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">(Set NodeKey -&gt; Set NodeKey) -&gt; Set NodeKey -&gt; Set NodeKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-609"></span><span>          </span><span class="hs-comment">-- Keep intermediate dependencies: as per Step 2a in Note [Upsweep], these are</span><span>
</span><span id="line-610"></span><span>          </span><span class="hs-comment">-- the transitive dependencies of the non-boot file which transitively depend</span><span>
</span><span id="line-611"></span><span>          </span><span class="hs-comment">-- on the boot file.</span><span>
</span><span id="line-612"></span><span>          </span><span class="annot"><span class="annottext">(NodeKey -&gt; Bool) -&gt; Set NodeKey -&gt; Set NodeKey
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#filter/Data.Set.Internal.html#filter"><span class="hs-identifier hs-var">Set.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087430"><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087430"><span class="hs-identifier hs-var">nk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#nodeKeyUnitId"><span class="hs-identifier hs-var">nodeKeyUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087430"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087424"><span class="hs-identifier hs-var">uid</span></a></span><span>  </span><span class="hs-comment">-- Cheap test</span><span>
</span><span id="line-613"></span><span>                              </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsBootInterface -&gt; ModNodeKeyWithUid
</span><a href="#local-6989586621682087427"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Set NodeKey -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#member/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe (Set NodeKey) -&gt; Set NodeKey
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dep_on_boot&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; Map NodeKey (Set NodeKey) -&gt; Maybe (Set NodeKey)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087430"><span class="hs-identifier hs-var">nk</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey (Set NodeKey)
</span><a href="#local-6989586621682087419"><span class="hs-identifier hs-var">trans_deps_map</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set NodeKey -&gt; Set NodeKey) -&gt; Set NodeKey -&gt; Set NodeKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-614"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe (Set NodeKey) -&gt; Set NodeKey
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;not_boot_dep&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; Map NodeKey (Set NodeKey) -&gt; Maybe (Set NodeKey)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsBootInterface -&gt; ModNodeKeyWithUid
</span><a href="#local-6989586621682087427"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map NodeKey (Set NodeKey)
</span><a href="#local-6989586621682087419"><span class="hs-identifier hs-var">trans_deps_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-616"></span><span>            </span><span id="local-6989586621682087427"><span class="annot"><span class="annottext">key :: IsBootInterface -&gt; ModNodeKeyWithUid
</span><a href="#local-6989586621682087427"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span id="local-6989586621682087432"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682087432"><span class="hs-identifier hs-var">ib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; UnitId -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-var">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; ModuleNameWithIsBoot
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087423"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682087432"><span class="hs-identifier hs-var">ib</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087424"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>        </span><span class="hs-comment">-- An environment mapping a module to its hs-boot file and all nodes on the path between the two, if one exists</span><span>
</span><span id="line-620"></span><span>        </span><span id="local-6989586621682087398"><span class="annot"><span class="annottext">boot_modules :: ModuleEnv (ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087398"><span class="hs-identifier hs-var hs-var">boot_modules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Module, (ModuleGraphNode, [ModuleGraphNode]))]
-&gt; ModuleEnv (ModuleGraphNode, [ModuleGraphNode])
forall a. [(Module, a)] -&gt; ModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#mkModuleEnv"><span class="hs-identifier hs-var">mkModuleEnv</span></a></span><span>
</span><span id="line-621"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087434"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087435"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UnitId -&gt; [ModuleGraphNode]
</span><a href="#local-6989586621682087422"><span class="hs-identifier hs-var">boot_path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087434"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087434"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682087435"><span class="annot"><span class="annottext">m :: ModuleGraphNode
</span><a href="#local-6989586621682087435"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682087434"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087434"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModuleGraphNode]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries%27"><span class="hs-identifier hs-var">mgModSummaries'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087393"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Unit.Module.ModSummary.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087434"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>        </span><span class="annot"><a href="#local-6989586621682087438"><span class="hs-identifier hs-type">select_boot_modules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-624"></span><span>        </span><span id="local-6989586621682087438"><span class="annot"><span class="annottext">select_boot_modules :: [ModuleGraphNode] -&gt; [ModuleGraphNode]
</span><a href="#local-6989586621682087438"><span class="hs-identifier hs-var hs-var">select_boot_modules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; Maybe ModuleGraphNode)
-&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ModuleGraphNode, [ModuleGraphNode]) -&gt; ModuleGraphNode)
-&gt; Maybe (ModuleGraphNode, [ModuleGraphNode])
-&gt; Maybe ModuleGraphNode
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleGraphNode, [ModuleGraphNode]) -&gt; ModuleGraphNode
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ModuleGraphNode, [ModuleGraphNode])
 -&gt; Maybe ModuleGraphNode)
-&gt; (ModuleGraphNode -&gt; Maybe (ModuleGraphNode, [ModuleGraphNode]))
-&gt; ModuleGraphNode
-&gt; Maybe ModuleGraphNode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; Maybe (ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087439"><span class="hs-identifier hs-var">get_boot_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>        </span><span class="annot"><a href="#local-6989586621682087439"><span class="hs-identifier hs-type">get_boot_module</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>        </span><span id="local-6989586621682087439"><span class="annot"><span class="annottext">get_boot_module :: ModuleGraphNode -&gt; Maybe (ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087439"><span class="hs-identifier hs-var hs-var">get_boot_module</span></a></span></span><span> </span><span id="local-6989586621682087440"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087440"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087440"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682087441"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087441"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087441"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleEnv (ModuleGraphNode, [ModuleGraphNode])
-&gt; Module -&gt; Maybe (ModuleGraphNode, [ModuleGraphNode])
forall a. ModuleEnv a -&gt; Module -&gt; Maybe a
</span><a href="GHC.Unit.Module.Env.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleEnv (ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087398"><span class="hs-identifier hs-var">boot_modules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087441"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ModuleGraphNode, [ModuleGraphNode])
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span>        </span><span class="hs-comment">-- Any cycles should be resolved now</span><span>
</span><span id="line-630"></span><span>        </span><span class="annot"><a href="#local-6989586621682087413"><span class="hs-identifier hs-type">collapseSCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-631"></span><span>        </span><span class="hs-comment">-- Must be at least two nodes, as we were in a cycle</span><span>
</span><span id="line-632"></span><span>        </span><span id="local-6989586621682087413"><span class="annot"><span class="annottext">collapseSCC :: [SCC ModuleGraphNode]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087413"><span class="hs-identifier hs-var hs-var">collapseSCC</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#AcyclicSCC/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621682087445"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087445"><span class="hs-identifier hs-var">node1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#AcyclicSCC/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621682087446"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087446"><span class="hs-identifier hs-var">node2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModuleGraphNode
-&gt; Either ModuleGraphNode ModuleGraphNodeWithBootFile
</span><a href="#local-6989586621682087447"><span class="hs-identifier hs-var">toNodeWithBoot</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087445"><span class="hs-identifier hs-var">node1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
-&gt; Either ModuleGraphNode ModuleGraphNodeWithBootFile
</span><a href="#local-6989586621682087447"><span class="hs-identifier hs-var">toNodeWithBoot</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087446"><span class="hs-identifier hs-var">node2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-633"></span><span>        </span><span class="annot"><a href="#local-6989586621682087413"><span class="hs-identifier hs-var">collapseSCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#AcyclicSCC/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621682087448"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087448"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682087449"><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087449"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([ModuleGraphNode]
 -&gt; Either
      [ModuleGraphNode]
      [Either ModuleGraphNode ModuleGraphNodeWithBootFile])
-&gt; ([Either ModuleGraphNode ModuleGraphNodeWithBootFile]
    -&gt; Either
         [ModuleGraphNode]
         [Either ModuleGraphNode ModuleGraphNodeWithBootFile])
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../base-4.18.2.1/src/Data.Either.html#either/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">([ModuleGraphNode]
 -&gt; Either
      [ModuleGraphNode]
      [Either ModuleGraphNode ModuleGraphNodeWithBootFile])
-&gt; ([ModuleGraphNode] -&gt; [ModuleGraphNode])
-&gt; [ModuleGraphNode]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087448"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">([Either ModuleGraphNode ModuleGraphNodeWithBootFile]
 -&gt; Either
      [ModuleGraphNode]
      [Either ModuleGraphNode ModuleGraphNodeWithBootFile])
-&gt; ([Either ModuleGraphNode ModuleGraphNodeWithBootFile]
    -&gt; [Either ModuleGraphNode ModuleGraphNodeWithBootFile])
-&gt; [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode
-&gt; Either ModuleGraphNode ModuleGraphNodeWithBootFile
</span><a href="#local-6989586621682087447"><span class="hs-identifier hs-var">toNodeWithBoot</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087448"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">Either ModuleGraphNode ModuleGraphNodeWithBootFile
-&gt; [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087413"><span class="hs-identifier hs-var">collapseSCC</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087449"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>        </span><span class="hs-comment">-- Cyclic</span><span>
</span><span id="line-635"></span><span>        </span><span class="annot"><a href="#local-6989586621682087413"><span class="hs-identifier hs-var">collapseSCC</span></a></span><span> </span><span id="local-6989586621682087450"><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087450"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
-&gt; Either
     [ModuleGraphNode]
     [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. [SCC a] -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Graph.html#flattenSCCs/Data.Graph.html#flattenSCCs"><span class="hs-identifier hs-var">flattenSCCs</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087450"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span>        </span><span class="annot"><a href="#local-6989586621682087447"><span class="hs-identifier hs-type">toNodeWithBoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span>
</span><span id="line-638"></span><span>        </span><span id="local-6989586621682087447"><span class="annot"><span class="annottext">toNodeWithBoot :: ModuleGraphNode
-&gt; Either ModuleGraphNode ModuleGraphNodeWithBootFile
</span><a href="#local-6989586621682087447"><span class="hs-identifier hs-var hs-var">toNodeWithBoot</span></a></span></span><span> </span><span id="local-6989586621682087452"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087452"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-639"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; Maybe (ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087439"><span class="hs-identifier hs-var">get_boot_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087452"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-640"></span><span>            </span><span class="hs-comment">-- The node doesn't have a boot file</span><span>
</span><span id="line-641"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ModuleGraphNode, [ModuleGraphNode])
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
-&gt; Either ModuleGraphNode ModuleGraphNodeWithBootFile
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087452"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-642"></span><span>            </span><span class="hs-comment">-- The node does have a boot file</span><span>
</span><span id="line-643"></span><span>            </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087453"><span class="annot"><span class="annottext">(ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087453"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNodeWithBootFile
-&gt; Either ModuleGraphNode ModuleGraphNodeWithBootFile
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; [NodeKey] -&gt; ModuleGraphNodeWithBootFile
</span><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-var">ModuleGraphNodeWithBootFile</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087452"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; NodeKey) -&gt; [ModuleGraphNode] -&gt; [NodeKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleGraphNode, [ModuleGraphNode]) -&gt; [ModuleGraphNode]
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleGraphNode, [ModuleGraphNode])
</span><a href="#local-6989586621682087453"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-comment">-- The toposort and accumulation of acyclic modules is solely to pick-up</span><span>
</span><span id="line-646"></span><span>        </span><span class="hs-comment">-- hs-boot files which are **not** part of cycles.</span><span>
</span><span id="line-647"></span><span>        </span><span class="annot"><a href="#local-6989586621682087399"><span class="hs-identifier hs-type">collapseAcyclic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-648"></span><span>        </span><span id="local-6989586621682087399"><span class="annot"><span class="annottext">collapseAcyclic :: [SCC ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087399"><span class="hs-identifier hs-var hs-var">collapseAcyclic</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#AcyclicSCC/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621682087454"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087454"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682087455"><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087455"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; BuildPlan
</span><a href="GHC.Driver.Make.html#SingleModule"><span class="hs-identifier hs-var">SingleModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087454"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">BuildPlan -&gt; [BuildPlan] -&gt; [BuildPlan]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087399"><span class="hs-identifier hs-var">collapseAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087455"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-649"></span><span>        </span><span class="annot"><a href="#local-6989586621682087399"><span class="hs-identifier hs-var">collapseAcyclic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#CyclicSCC/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621682087456"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087456"><span class="hs-identifier hs-var">cy_nodes</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682087457"><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087457"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; BuildPlan
</span><a href="GHC.Driver.Make.html#UnresolvedCycle"><span class="hs-identifier hs-var">UnresolvedCycle</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087456"><span class="hs-identifier hs-var">cy_nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuildPlan -&gt; [BuildPlan] -&gt; [BuildPlan]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [BuildPlan]
</span><a href="#local-6989586621682087399"><span class="hs-identifier hs-var">collapseAcyclic</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087457"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-650"></span><span>        </span><span class="annot"><a href="#local-6989586621682087399"><span class="hs-identifier hs-var">collapseAcyclic</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>        </span><span id="local-6989586621682087402"><span class="annot"><span class="annottext">topSortWithBoot :: [ModuleGraphNode] -&gt; [SCC ModuleGraphNode]
</span><a href="#local-6989586621682087402"><span class="hs-identifier hs-var hs-var">topSortWithBoot</span></a></span></span><span> </span><span id="local-6989586621682087458"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087458"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; [ModuleGraphNode]
-&gt; Maybe HomeUnitModule
-&gt; [SCC ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#topSortModules"><span class="hs-identifier hs-var">topSortModules</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [ModuleGraphNode]
</span><a href="#local-6989586621682087438"><span class="hs-identifier hs-var">select_boot_modules</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087458"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087458"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [BuildPlan] -&gt; [BuildPlan]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#sum/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BuildPlan -&gt; Int) -&gt; [BuildPlan] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">BuildPlan -&gt; Int
</span><a href="GHC.Driver.Make.html#countMods"><span class="hs-identifier hs-var">countMods</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087396"><span class="hs-identifier hs-var">build_plan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModuleGraphNode]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries%27"><span class="hs-identifier hs-var">mgModSummaries'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087393"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Build plan missing nodes:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;PLAN:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#sum/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BuildPlan -&gt; Int) -&gt; [BuildPlan] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">BuildPlan -&gt; Int
</span><a href="GHC.Driver.Make.html#countMods"><span class="hs-identifier hs-var">countMods</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087396"><span class="hs-identifier hs-var">build_plan</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;GRAPH:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModuleGraphNode]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries%27"><span class="hs-identifier hs-var">mgModSummaries'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087393"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>              </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087396"><span class="hs-identifier hs-var">build_plan</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span class="hs-comment">-- | Generalized version of 'load' which also supports a custom</span><span>
</span><span id="line-662"></span><span class="hs-comment">-- 'Messager' (for reporting progress) and 'ModuleGraph' (generally</span><span>
</span><span id="line-663"></span><span class="hs-comment">-- produced by calling 'depanal'.</span><span>
</span><span id="line-664"></span><span id="local-6989586621682085855"><span class="annot"><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier hs-type">load'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085855"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier hs-type">LoadHowMuch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085855"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span></span><span>
</span><span id="line-665"></span><span id="load%27"><span class="annot"><span class="annottext">load' :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
Maybe ModIfaceCache
-&gt; LoadHowMuch -&gt; Maybe Messager -&gt; ModuleGraph -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier hs-var hs-var">load'</span></a></span></span><span> </span><span id="local-6989586621682087531"><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087531"><span class="hs-identifier hs-var">mhmi_cache</span></a></span></span><span> </span><span id="local-6989586621682087532"><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621682087532"><span class="hs-identifier hs-var">how_much</span></a></span></span><span> </span><span id="local-6989586621682087533"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087533"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621682087534"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087534"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-comment">-- In normal usage plugins are initialised already by ghc/Main.hs this is protective</span><span>
</span><span id="line-667"></span><span>    </span><span class="hs-comment">-- for any client who might interact with GHC via load'.</span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; m ()
</span><a href="GHC.Runtime.Loader.html#initializeSessionPlugins"><span class="hs-identifier hs-var">initializeSessionPlugins</span></a></span><span>
</span><span id="line-669"></span><span>    </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; HscEnv) -&gt; m ()) -&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682087537"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087537"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087537"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682087534"><span class="hs-identifier hs-type">mod_graph</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; m ()
</span><a href="GHC.Driver.Make.html#guessOutputFile"><span class="hs-identifier hs-var">guessOutputFile</span></a></span><span>
</span><span id="line-671"></span><span>    </span><span id="local-6989586621682087539"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087539"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087540"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682087540"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087539"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-674"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087541"><span class="annot"><span class="annottext">interp :: Interp
</span><a href="#local-6989586621682087541"><span class="hs-identifier hs-var hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Interp
</span><a href="GHC.Driver.Env.html#hscInterp"><span class="hs-identifier hs-var">hscInterp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087539"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>    </span><span class="hs-comment">-- The &quot;bad&quot; boot modules are the ones for which we have</span><span>
</span><span id="line-677"></span><span>    </span><span class="hs-comment">-- B.hs-boot in the module graph, but no B.hs</span><span>
</span><span id="line-678"></span><span>    </span><span class="hs-comment">-- The downsweep should have ensured this does not happen</span><span>
</span><span id="line-679"></span><span>    </span><span class="hs-comment">-- (see msDeps)</span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087543"><span class="annot"><span class="annottext">all_home_mods :: Set HomeUnitModule
</span><a href="#local-6989586621682087543"><span class="hs-identifier hs-var hs-var">all_home_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-681"></span><span>          </span><span class="annot"><span class="annottext">[HomeUnitModule] -&gt; Set HomeUnitModule
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; ModuleName -&gt; HomeUnitModule
forall unit. unit -&gt; ModuleName -&gt; GenModule unit
</span><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-var">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087545"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087545"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682087545"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087545"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087534"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Unit.Module.ModSummary.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087545"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-683"></span><span>    </span><span class="hs-comment">-- TODO: Figure out what the correct form of this assert is. It's violated</span><span>
</span><span id="line-684"></span><span>    </span><span class="hs-comment">-- when you have HsBootMerge nodes in the graph: then you'll have hs-boot</span><span>
</span><span id="line-685"></span><span>    </span><span class="hs-comment">-- files without corresponding hs files.</span><span>
</span><span id="line-686"></span><span>    </span><span class="hs-comment">--  bad_boot_mods = [s        | s &lt;- mod_graph, isBootSummary s,</span><span>
</span><span id="line-687"></span><span>    </span><span class="hs-comment">--                              not (ms_mod_name s `elem` all_home_mods)]</span><span>
</span><span id="line-688"></span><span>    </span><span class="hs-comment">-- assert (null bad_boot_mods ) return ()</span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span>    </span><span class="hs-comment">-- check that the module given in HowMuch actually exists, otherwise</span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-comment">-- topSortModuleGraph will bomb later.</span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087546"><span class="annot"><span class="annottext">checkHowMuch :: LoadHowMuch -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621682087546"><span class="hs-identifier hs-var hs-var">checkHowMuch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#LoadUpTo"><span class="hs-identifier hs-type">LoadUpTo</span></a></span><span> </span><span id="local-6989586621682087547"><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087547"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitModule -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621682087548"><span class="hs-identifier hs-var">checkMod</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087547"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-693"></span><span>        </span><span class="annot"><a href="#local-6989586621682087546"><span class="hs-identifier hs-var">checkHowMuch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#LoadDependenciesOf"><span class="hs-identifier hs-type">LoadDependenciesOf</span></a></span><span> </span><span id="local-6989586621682087549"><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087549"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitModule -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621682087548"><span class="hs-identifier hs-var">checkMod</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087549"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-694"></span><span>        </span><span class="annot"><a href="#local-6989586621682087546"><span class="hs-identifier hs-var">checkHowMuch</span></a></span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SuccessFlag -&gt; m SuccessFlag
forall a. a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#id/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span>        </span><span id="local-6989586621682087548"><span class="annot"><span class="annottext">checkMod :: HomeUnitModule -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621682087548"><span class="hs-identifier hs-var hs-var">checkMod</span></a></span></span><span> </span><span id="local-6989586621682087551"><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087551"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682087552"><span class="annot"><span class="annottext">m SuccessFlag
</span><a href="#local-6989586621682087552"><span class="hs-identifier hs-var">and_then</span></a></span></span><span>
</span><span id="line-697"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087551"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitModule -&gt; Set HomeUnitModule -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#member/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set HomeUnitModule
</span><a href="#local-6989586621682087543"><span class="hs-identifier hs-var">all_home_mods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SuccessFlag
</span><a href="#local-6989586621682087552"><span class="hs-identifier hs-var">and_then</span></a></span><span>
</span><span id="line-698"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-699"></span><span>                    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682087540"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-700"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;no such module:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitModule -&gt; UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087551"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitModule -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087551"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>                    </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>    </span><span class="annot"><span class="annottext">LoadHowMuch -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621682087546"><span class="hs-identifier hs-var">checkHowMuch</span></a></span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621682087532"><span class="hs-identifier hs-var">how_much</span></a></span><span> </span><span class="annot"><span class="annottext">(m SuccessFlag -&gt; m SuccessFlag) -&gt; m SuccessFlag -&gt; m SuccessFlag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span>    </span><span class="hs-comment">-- mg2_with_srcimps drops the hi-boot nodes, returning a</span><span>
</span><span id="line-706"></span><span>    </span><span class="hs-comment">-- graph with cycles. It is just used for warning about unecessary source imports.</span><span>
</span><span id="line-707"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682087557"><span class="hs-identifier hs-type">mg2_with_srcimps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-708"></span><span>        </span><span id="local-6989586621682087557"><span class="annot"><span class="annottext">mg2_with_srcimps :: [SCC ModuleGraphNode]
</span><a href="#local-6989586621682087557"><span class="hs-identifier hs-var hs-var">mg2_with_srcimps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ModuleGraph -&gt; Maybe HomeUnitModule -&gt; [SCC ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var">topSortModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087534"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span>    </span><span class="hs-comment">-- If we can determine that any of the {-# SOURCE #-} imports</span><span>
</span><span id="line-711"></span><span>    </span><span class="hs-comment">-- are definitely unnecessary, then emit a warning.</span><span>
</span><span id="line-712"></span><span>    </span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; [SCC ModSummary] -&gt; m ()
</span><a href="GHC.Driver.Make.html#warnUnnecessarySourceImports"><span class="hs-identifier hs-var">warnUnnecessarySourceImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [SCC ModSummary]
</span><a href="GHC.Unit.Module.Graph.html#filterToposortToModules"><span class="hs-identifier hs-var">filterToposortToModules</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087557"><span class="hs-identifier hs-var">mg2_with_srcimps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087560"><span class="annot"><span class="annottext">maybe_top_mod :: Maybe HomeUnitModule
</span><a href="#local-6989586621682087560"><span class="hs-identifier hs-var hs-var">maybe_top_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621682087532"><span class="hs-identifier hs-var">how_much</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-715"></span><span>                          </span><span class="annot"><a href="GHC.Driver.Make.html#LoadUpTo"><span class="hs-identifier hs-type">LoadUpTo</span></a></span><span> </span><span id="local-6989586621682087561"><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087561"><span class="hs-identifier hs-var">m</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomeUnitModule -&gt; Maybe HomeUnitModule
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087561"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-716"></span><span>                          </span><span class="annot"><a href="GHC.Driver.Make.html#LoadDependenciesOf"><span class="hs-identifier hs-type">LoadDependenciesOf</span></a></span><span> </span><span id="local-6989586621682087562"><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087562"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomeUnitModule -&gt; Maybe HomeUnitModule
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitModule
</span><a href="#local-6989586621682087562"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-717"></span><span>                          </span><span class="annot"><span class="annottext">LoadHowMuch
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span>        </span><span id="local-6989586621682087563"><span class="annot"><span class="annottext">build_plan :: [BuildPlan]
</span><a href="#local-6989586621682087563"><span class="hs-identifier hs-var hs-var">build_plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; Maybe HomeUnitModule -&gt; [BuildPlan]
</span><a href="GHC.Driver.Make.html#createBuildPlan"><span class="hs-identifier hs-var">createBuildPlan</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087534"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087560"><span class="hs-identifier hs-var">maybe_top_mod</span></a></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span>    </span><span id="local-6989586621682087564"><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087564"><span class="hs-identifier hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [CachedIface] -&gt; m [CachedIface]
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [CachedIface] -&gt; m [CachedIface])
-&gt; IO [CachedIface] -&gt; m [CachedIface]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO [CachedIface]
-&gt; (ModIfaceCache -&gt; IO [CachedIface])
-&gt; Maybe ModIfaceCache
-&gt; IO [CachedIface]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CachedIface] -&gt; IO [CachedIface]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModIfaceCache -&gt; IO [CachedIface]
</span><a href="GHC.Driver.Make.html#iface_clearCache"><span class="hs-identifier hs-var">iface_clearCache</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087531"><span class="hs-identifier hs-var">mhmi_cache</span></a></span><span>
</span><span id="line-723"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-724"></span><span>        </span><span class="hs-comment">-- prune the HPT so everything is not retained when doing an</span><span>
</span><span id="line-725"></span><span>        </span><span class="hs-comment">-- upsweep.</span><span>
</span><span id="line-726"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621682087565"><span class="annot"><span class="annottext">pruned_cache :: [HomeModInfo]
</span><a href="#local-6989586621682087565"><span class="hs-identifier hs-var hs-var">pruned_cache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CachedIface] -&gt; [ModSummary] -&gt; [HomeModInfo]
</span><a href="GHC.Driver.Make.html#pruneCache"><span class="hs-identifier hs-var">pruneCache</span></a></span><span> </span><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087564"><span class="hs-identifier hs-var">cache</span></a></span><span>
</span><span id="line-727"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; [ModSummary]
forall a. [SCC a] -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Graph.html#flattenSCCs/Data.Graph.html#flattenSCCs"><span class="hs-identifier hs-var">flattenSCCs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModuleGraphNode] -&gt; [SCC ModSummary]
</span><a href="GHC.Unit.Module.Graph.html#filterToposortToModules"><span class="hs-identifier hs-var">filterToposortToModules</span></a></span><span>  </span><span class="annot"><span class="annottext">[SCC ModuleGraphNode]
</span><a href="#local-6989586621682087557"><span class="hs-identifier hs-var">mg2_with_srcimps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-comment">-- before we unload anything, make sure we don't leave an old</span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-comment">-- interactive context around pointing to dead bindings.  Also,</span><span>
</span><span id="line-732"></span><span>    </span><span class="hs-comment">-- write an empty HPT to allow the old HPT to be GC'd.</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087567"><span class="annot"><span class="annottext">pruneHomeUnitEnv :: HomeUnitEnv -&gt; HomeUnitEnv
</span><a href="#local-6989586621682087567"><span class="hs-identifier hs-var hs-var">pruneHomeUnitEnv</span></a></span></span><span> </span><span id="local-6989586621682087568"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087568"><span class="hs-identifier hs-var">hme</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087568"><span class="hs-identifier hs-var">hme</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#homeUnitEnv_hpt"><span class="hs-identifier hs-var">homeUnitEnv_hpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#emptyHomePackageTable"><span class="hs-identifier hs-type">emptyHomePackageTable</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-735"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; m ()) -&gt; HscEnv -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#discardIC"><span class="hs-identifier hs-var">discardIC</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; HscEnv -&gt; HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHUG"><span class="hs-identifier hs-var">hscUpdateHUG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HomeUnitEnv -&gt; HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv
forall v. (v -&gt; v) -&gt; UnitEnvGraph v -&gt; UnitEnvGraph v
</span><a href="GHC.Unit.Env.html#unitEnv_map"><span class="hs-identifier hs-var">unitEnv_map</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; HomeUnitEnv
</span><a href="#local-6989586621682087567"><span class="hs-identifier hs-var">pruneHomeUnitEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087539"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-736"></span><span>    </span><span id="local-6989586621682087574"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087574"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span>    </span><span class="hs-comment">-- Unload everything</span><span>
</span><span id="line-739"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; HscEnv -&gt; IO ()
</span><a href="GHC.Driver.Make.html#unload"><span class="hs-identifier hs-var">unload</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682087541"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087574"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682087540"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Ready for upsweep&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>                                    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BuildPlan] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087563"><span class="hs-identifier hs-var">build_plan</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span>    </span><span id="local-6989586621682087577"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087577"><span class="hs-identifier hs-var">n_jobs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe Int
</span><a href="GHC.Driver.Session.html#parMakeCount"><span class="hs-identifier hs-var">parMakeCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087574"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-745"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; m Int
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#getNumProcessors/GHC.Conc.Sync.html#getNumProcessors"><span class="hs-identifier hs-var">getNumProcessors</span></a></span><span>
</span><span id="line-746"></span><span>                    </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087580"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087580"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087580"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682087581"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087581"><span class="hs-identifier hs-var">upsweep_ok</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087582"><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087582"><span class="hs-identifier hs-var">new_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (SuccessFlag, [HomeModInfo]) -&gt; m (SuccessFlag, [HomeModInfo])
forall (m :: * -&gt; *) a. GhcMonad m =&gt; m a -&gt; m a
</span><a href="GHC.Driver.Make.html#withDeferredDiagnostics"><span class="hs-identifier hs-var">withDeferredDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">(m (SuccessFlag, [HomeModInfo]) -&gt; m (SuccessFlag, [HomeModInfo]))
-&gt; m (SuccessFlag, [HomeModInfo]) -&gt; m (SuccessFlag, [HomeModInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>      </span><span id="local-6989586621682087584"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087584"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-750"></span><span>      </span><span class="annot"><span class="annottext">IO (SuccessFlag, [HomeModInfo]) -&gt; m (SuccessFlag, [HomeModInfo])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (SuccessFlag, [HomeModInfo]) -&gt; m (SuccessFlag, [HomeModInfo]))
-&gt; IO (SuccessFlag, [HomeModInfo])
-&gt; m (SuccessFlag, [HomeModInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; HscEnv
-&gt; Maybe ModIfaceCache
-&gt; Maybe Messager
-&gt; Map ModNodeKeyWithUid HomeModInfo
-&gt; [BuildPlan]
-&gt; IO (SuccessFlag, [HomeModInfo])
</span><a href="GHC.Driver.Make.html#upsweep"><span class="hs-identifier hs-var">upsweep</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087577"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087584"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087531"><span class="hs-identifier hs-var">mhmi_cache</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087533"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HomeModInfo] -&gt; Map ModNodeKeyWithUid HomeModInfo
</span><a href="GHC.Driver.Make.html#toCache"><span class="hs-identifier hs-var">toCache</span></a></span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087565"><span class="hs-identifier hs-var">pruned_cache</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087563"><span class="hs-identifier hs-var">build_plan</span></a></span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HomeModInfo] -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#addDepsToHscEnv"><span class="hs-identifier hs-var">addDepsToHscEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087582"><span class="hs-identifier hs-var">new_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087581"><span class="hs-identifier hs-var">upsweep_ok</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-753"></span><span>      </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *). GhcMonad m =&gt; SuccessFlag -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-var">loadFinish</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087581"><span class="hs-identifier hs-var">upsweep_ok</span></a></span><span>
</span><span id="line-754"></span><span>      </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-755"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682087540"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Upsweep completely successful.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>          </span><span class="annot"><span class="annottext">SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *). GhcMonad m =&gt; SuccessFlag -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-var">loadFinish</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087581"><span class="hs-identifier hs-var">upsweep_ok</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span class="annot"><span class="hs-comment">-- | Finish up after a load.</span></span><span>
</span><span id="line-761"></span><span id="local-6989586621682085920"><span class="annot"><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-type">loadFinish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085920"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085920"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span></span><span>
</span><span id="line-762"></span><span class="hs-comment">-- Empty the interactive context and set the module context to the topmost</span><span>
</span><span id="line-763"></span><span class="hs-comment">-- newly loaded module, or the Prelude if none were loaded.</span><span>
</span><span id="line-764"></span><span id="loadFinish"><span class="annot"><span class="annottext">loadFinish :: forall (m :: * -&gt; *). GhcMonad m =&gt; SuccessFlag -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-var hs-var">loadFinish</span></a></span></span><span> </span><span id="local-6989586621682087594"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087594"><span class="hs-identifier hs-var">all_ok</span></a></span></span><span>
</span><span id="line-765"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#discardIC"><span class="hs-identifier hs-var">discardIC</span></a></span><span>
</span><span id="line-766"></span><span>       </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087594"><span class="hs-identifier hs-var">all_ok</span></a></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span class="hs-comment">-- | If there is no -o option, guess the name of target executable</span><span>
</span><span id="line-770"></span><span class="hs-comment">-- by using top-level source file name as a base.</span><span>
</span><span id="line-771"></span><span id="local-6989586621682087595"><span class="annot"><a href="GHC.Driver.Make.html#guessOutputFile"><span class="hs-identifier hs-type">guessOutputFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087595"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682087595"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-772"></span><span id="guessOutputFile"><span class="annot"><span class="annottext">guessOutputFile :: forall (m :: * -&gt; *). GhcMonad m =&gt; m ()
</span><a href="GHC.Driver.Make.html#guessOutputFile"><span class="hs-identifier hs-var hs-var">guessOutputFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; HscEnv) -&gt; m ()) -&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682087607"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087607"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-comment">-- Force mod_graph to avoid leaking env</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682087608"><span class="annot"><span class="annottext">mod_graph :: ModuleGraph
</span><a href="#local-6989586621682087608"><span class="hs-identifier hs-var hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph
</span><a href="GHC.Driver.Env.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087607"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-775"></span><span>        </span><span id="local-6989586621682087609"><span class="annot"><span class="annottext">new_home_graph :: UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087609"><span class="hs-identifier hs-var hs-var">new_home_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-776"></span><span>          </span><span class="annot"><span class="annottext">((HomeUnitEnv -&gt; HomeUnitEnv)
 -&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; (HomeUnitEnv -&gt; HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeUnitEnv -&gt; HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv
forall v. (v -&gt; v) -&gt; UnitEnvGraph v -&gt; UnitEnvGraph v
</span><a href="GHC.Unit.Env.html#unitEnv_map"><span class="hs-identifier hs-var">unitEnv_map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087607"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((HomeUnitEnv -&gt; HomeUnitEnv) -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; (HomeUnitEnv -&gt; HomeUnitEnv) -&gt; UnitEnvGraph HomeUnitEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682087611"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087611"><span class="hs-identifier hs-var">hue</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-777"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087612"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682087612"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087611"><span class="hs-identifier hs-var">hue</span></a></span><span>
</span><span id="line-778"></span><span>                </span><span id="local-6989586621682087613"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682087613"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087612"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-779"></span><span>                </span><span class="annot"><a href="#local-6989586621682087615"><span class="hs-identifier hs-type">mainModuleSrcPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-780"></span><span>                </span><span id="local-6989586621682087615"><span class="annot"><span class="annottext">mainModuleSrcPath :: Maybe FilePath
</span><a href="#local-6989586621682087615"><span class="hs-identifier hs-var hs-var">mainModuleSrcPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-781"></span><span>                  </span><span id="local-6989586621682087616"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087616"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; Module -&gt; Maybe ModSummary
</span><a href="GHC.Unit.Module.Graph.html#mgLookupModule"><span class="hs-identifier hs-var">mgLookupModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087608"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; Module
</span><a href="GHC.Driver.Env.html#mainModIs"><span class="hs-identifier hs-var">mainModIs</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087611"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>                  </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087616"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>                </span><span id="local-6989586621682087620"><span class="annot"><span class="annottext">name :: Maybe FilePath
</span><a href="#local-6989586621682087620"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; Maybe FilePath -&gt; Maybe FilePath
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#dropExtension/System.FilePath.Posix.html#dropExtension"><span class="hs-identifier hs-var">dropExtension</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621682087615"><span class="hs-identifier hs-var">mainModuleSrcPath</span></a></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span>                </span><span class="hs-comment">-- MP: This exception is quite sensitive to being forced, if you</span><span>
</span><span id="line-786"></span><span>                </span><span class="hs-comment">-- force it here then the error message is different because it gets</span><span>
</span><span id="line-787"></span><span>                </span><span class="hs-comment">-- caught by a different error handler than the test (T9930fail) expects.</span><span>
</span><span id="line-788"></span><span>                </span><span class="hs-comment">-- Putting an exception into DynFlags is probably not a great design but</span><span>
</span><span id="line-789"></span><span>                </span><span class="hs-comment">-- I'll write this comment rather than more eagerly force the exception.</span><span>
</span><span id="line-790"></span><span>                </span><span id="local-6989586621682087622"><span class="annot"><span class="annottext">name_exe :: Maybe FilePath
</span><a href="#local-6989586621682087622"><span class="hs-identifier hs-var hs-var">name_exe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-791"></span><span>                  </span><span class="hs-comment">-- we must add the .exe extension unconditionally here, otherwise</span><span>
</span><span id="line-792"></span><span>                  </span><span class="hs-comment">-- when name has an extension of its own, the .exe extension will</span><span>
</span><span id="line-793"></span><span>                 </span><span class="hs-comment">-- not be added by GHC.Driver.Pipeline.exeFileName.  See #2248</span><span>
</span><span id="line-794"></span><span>                 </span><span class="hs-glyph">!</span><span id="local-6989586621682087623"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087623"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; ArchOS
</span><a href="GHC.Platform.html#platformArchOS"><span class="hs-identifier hs-var">platformArchOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682087613"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-795"></span><span>                             </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchOS/GHC.Platform.ArchOS.html#ArchOS"><span class="hs-identifier hs-type">ArchOS</span></a></span><span> </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSMinGW32/GHC.Platform.ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; Maybe FilePath -&gt; Maybe FilePath
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;exe&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621682087620"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-796"></span><span>                             </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchOS/GHC.Platform.ArchOS.html#ArchOS"><span class="hs-identifier hs-type">ArchOS</span></a></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchWasm32/GHC.Platform.ArchOS.html#ArchWasm32"><span class="hs-identifier hs-var">ArchWasm32</span></a></span><span> </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; Maybe FilePath -&gt; Maybe FilePath
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;wasm&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621682087620"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-797"></span><span>                             </span><span class="annot"><span class="annottext">ArchOS
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621682087620"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-798"></span><span>                 </span><span id="local-6989586621682087629"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087629"><span class="hs-identifier hs-var">mainModuleSrcPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621682087615"><span class="hs-identifier hs-var">mainModuleSrcPath</span></a></span><span>
</span><span id="line-799"></span><span>                 </span><span class="hs-comment">-- #9930: don't clobber input files (unless they ask for it)</span><span>
</span><span id="line-800"></span><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087623"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087629"><span class="hs-identifier hs-var">mainModuleSrcPath'</span></a></span><span>
</span><span id="line-801"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; Maybe FilePath
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; Maybe FilePath)
-&gt; (FilePath -&gt; GhcException) -&gt; FilePath -&gt; Maybe FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#UsageError"><span class="hs-identifier hs-var">UsageError</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Maybe FilePath) -&gt; FilePath -&gt; Maybe FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-802"></span><span>                        </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;default output name would overwrite the input file; &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-803"></span><span>                        </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;must specify -o explicitly&quot;</span></span><span>
</span><span id="line-804"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682087623"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-805"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-806"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe FilePath
</span><a href="GHC.Driver.Session.html#outputFile_"><span class="hs-identifier hs-var">outputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682087612"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-807"></span><span>                </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087611"><span class="hs-identifier hs-var">hue</span></a></span><span>
</span><span id="line-808"></span><span>                </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682087611"><span class="hs-identifier hs-var">hue</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682087612"><span class="hs-identifier hs-type">dflags</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#outputFile_"><span class="hs-identifier hs-var">outputFile_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682087622"><span class="hs-identifier hs-type">name_exe</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087607"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087607"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#ue_home_unit_graph"><span class="hs-identifier hs-var">ue_home_unit_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682087609"><span class="hs-identifier hs-type">new_home_graph</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-812"></span><span class="hs-comment">--</span><span>
</span><span id="line-813"></span><span class="hs-comment">-- | Prune the HomePackageTable</span><span>
</span><span id="line-814"></span><span class="hs-comment">--</span><span>
</span><span id="line-815"></span><span class="hs-comment">-- Before doing an upsweep, we can throw away:</span><span>
</span><span id="line-816"></span><span class="hs-comment">--</span><span>
</span><span id="line-817"></span><span class="hs-comment">--   - all ModDetails, all linked code</span><span>
</span><span id="line-818"></span><span class="hs-comment">--   - all unlinked code that is out of date with respect to</span><span>
</span><span id="line-819"></span><span class="hs-comment">--     the source file</span><span>
</span><span id="line-820"></span><span class="hs-comment">--</span><span>
</span><span id="line-821"></span><span class="hs-comment">-- This is VERY IMPORTANT otherwise we'll end up requiring 2x the</span><span>
</span><span id="line-822"></span><span class="hs-comment">-- space at the end of the upsweep, because the topmost ModDetails of the</span><span>
</span><span id="line-823"></span><span class="hs-comment">-- old HPT holds on to the entire type environment from the previous</span><span>
</span><span id="line-824"></span><span class="hs-comment">-- compilation.</span><span>
</span><span id="line-825"></span><span class="hs-comment">-- Note [GHC Heap Invariants]</span><span>
</span><span id="line-826"></span><span class="annot"><a href="GHC.Driver.Make.html#pruneCache"><span class="hs-identifier hs-type">pruneCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-type">CachedIface</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-827"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-828"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-829"></span><span id="pruneCache"><span class="annot"><span class="annottext">pruneCache :: [CachedIface] -&gt; [ModSummary] -&gt; [HomeModInfo]
</span><a href="GHC.Driver.Make.html#pruneCache"><span class="hs-identifier hs-var hs-var">pruneCache</span></a></span></span><span> </span><span id="local-6989586621682087633"><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087633"><span class="hs-identifier hs-var">hpt</span></a></span></span><span> </span><span id="local-6989586621682087634"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682087634"><span class="hs-identifier hs-var">summ</span></a></span></span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CachedIface -&gt; HomeModInfo) -&gt; [CachedIface] -&gt; [HomeModInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="annot"><span class="annottext">CachedIface -&gt; HomeModInfo
</span><a href="#local-6989586621682087636"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">[CachedIface]
</span><a href="#local-6989586621682087633"><span class="hs-identifier hs-var">hpt</span></a></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682087636"><span class="annot"><span class="annottext">prune :: CachedIface -&gt; HomeModInfo
</span><a href="#local-6989586621682087636"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#CachedIface"><span class="hs-identifier hs-type">CachedIface</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cached_modiface :: CachedIface -&gt; ModIface
</span><a href="GHC.Driver.Make.html#cached_modiface"><span class="hs-identifier hs-var">cached_modiface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682087637"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087637"><span class="hs-identifier hs-var">iface</span></a></span></span><span>
</span><span id="line-832"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cached_linkable :: CachedIface -&gt; HomeModLinkable
</span><a href="GHC.Driver.Make.html#cached_linkable"><span class="hs-identifier hs-var">cached_linkable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682087638"><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682087638"><span class="hs-identifier hs-var">linkable</span></a></span></span><span>
</span><span id="line-833"></span><span>                           </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HomeModLinkable -&gt; HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087637"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="GHC.Unit.Module.ModDetails.html#emptyModDetails"><span class="hs-identifier hs-var">emptyModDetails</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682087640"><span class="hs-identifier hs-var">linkable'</span></a></span><span>
</span><span id="line-834"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-835"></span><span>           </span><span id="local-6989586621682087641"><span class="annot"><span class="annottext">modl :: ModNodeKeyWithUid
</span><a href="#local-6989586621682087641"><span class="hs-identifier hs-var hs-var">modl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModNodeKeyWithUid
</span><a href="GHC.Driver.Make.html#miKey"><span class="hs-identifier hs-var">miKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087637"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-836"></span><span>           </span><span id="local-6989586621682087640"><span class="annot"><span class="annottext">linkable' :: HomeModLinkable
</span><a href="#local-6989586621682087640"><span class="hs-identifier hs-var hs-var">linkable'</span></a></span></span><span>
</span><span id="line-837"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087642"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087642"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
-&gt; Map ModNodeKeyWithUid ModSummary -&gt; Maybe ModSummary
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682087641"><span class="hs-identifier hs-var">modl</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModNodeKeyWithUid ModSummary
</span><a href="#local-6989586621682087643"><span class="hs-identifier hs-var">ms_map</span></a></span><span>
</span><span id="line-838"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Fingerprint
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModIface.html#mi_src_hash"><span class="hs-identifier hs-var">mi_src_hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087637"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Fingerprint -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hs_hash"><span class="hs-identifier hs-var">ms_hs_hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087642"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-839"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span>
</span><span id="line-840"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-841"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682087638"><span class="hs-identifier hs-var">linkable</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>        </span><span class="hs-comment">-- Using UFM Module is safe for determinism because the map is just used for a transient lookup. The cache should be unique and a key clash is an error.</span><span>
</span><span id="line-844"></span><span>        </span><span id="local-6989586621682087643"><span class="annot"><span class="annottext">ms_map :: Map ModNodeKeyWithUid ModSummary
</span><a href="#local-6989586621682087643"><span class="hs-identifier hs-var hs-var">ms_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; ModSummary -&gt; ModSummary)
-&gt; [(ModNodeKeyWithUid, ModSummary)]
-&gt; Map ModNodeKeyWithUid ModSummary
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#fromListWith/Data.Map.Strict.Internal.html#fromListWith"><span class="hs-identifier hs-var">M.fromListWith</span></a></span><span>
</span><span id="line-845"></span><span>                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087648"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087648"><span class="hs-identifier hs-var">ms1</span></a></span></span><span> </span><span id="local-6989586621682087649"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087649"><span class="hs-identifier hs-var">ms2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; ModSummary -&gt; ModSummary
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;prune_cache&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087648"><span class="hs-identifier hs-var">ms1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087649"><span class="hs-identifier hs-var">ms2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>                               </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087649"><span class="hs-identifier hs-var">ms2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087651"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087651"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682087651"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087651"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682087634"><span class="hs-identifier hs-var">summ</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-850"></span><span class="hs-comment">--</span><span>
</span><span id="line-851"></span><span class="annot"><span class="hs-comment">-- | Unloading</span></span><span>
</span><span id="line-852"></span><span class="annot"><a href="GHC.Driver.Make.html#unload"><span class="hs-identifier hs-type">unload</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span id="unload"><span class="annot"><span class="annottext">unload :: Interp -&gt; HscEnv -&gt; IO ()
</span><a href="GHC.Driver.Make.html#unload"><span class="hs-identifier hs-var hs-var">unload</span></a></span></span><span> </span><span id="local-6989586621682087652"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682087652"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621682087653"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087653"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087653"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-855"></span><span>        </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkInMemory"><span class="hs-identifier hs-var">LinkInMemory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; HscEnv -&gt; [Linkable] -&gt; IO ()
</span><a href="GHC.Linker.Loader.html#unload"><span class="hs-identifier hs-var">Linker.unload</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621682087652"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087653"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-856"></span><span>        </span><span id="local-6989586621682087656"><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621682087656"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span class="hs-comment">{- Parallel Upsweep

The parallel upsweep attempts to concurrently compile the modules in the
compilation graph using multiple Haskell threads.

The Algorithm

* The list of `MakeAction`s are created by `interpretBuildPlan`. A `MakeAction` is
a pair of an `IO a` action and a `MVar a`, where to place the result.
  The list is sorted topologically, so can be executed in order without fear of
  blocking.
* runPipelines takes this list and eventually passes it to runLoop which executes
  each action and places the result into the right MVar.
* The amount of parallelism is controlled by a semaphore. This is just used around the
  module compilation step, so that only the right number of modules are compiled at
  the same time which reduces overall memory usage and allocations.
* Each proper node has a LogQueue, which dictates where to send it's output.
* The LogQueue is placed into the LogQueueQueue when the action starts and a worker
  thread processes the LogQueueQueue printing logs for each module in a stable order.
* The result variable for an action producing `a` is of type `Maybe a`, therefore
  it is still filled on a failure. If a module fails to compile, the
  failure is propagated through the whole module graph and any modules which didn't
  depend on the failure can still be compiled. This behaviour also makes the code
  quite a bit cleaner.
-}</span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span class="hs-comment">{-

Note [--make mode]
~~~~~~~~~~~~~~~~~
There are two main parts to `--make` mode.

1. `downsweep`: Starts from the top of the module graph and computes dependencies.
2. `upsweep`: Starts from the bottom of the module graph and compiles modules.

The result of the downsweep is a 'ModuleGraph', which is then passed to 'upsweep' which
computers how to build this ModuleGraph.

Note [Upsweep]
~~~~~~~~~~~~~~
Upsweep takes a 'ModuleGraph' as input, computes a build plan and then executes
the plan in order to compile the project.

The first step is computing the build plan from a 'ModuleGraph'.

The output of this step is a `[BuildPlan]`, which is a topologically sorted plan for
how to build all the modules.

```
data BuildPlan = SingleModule ModuleGraphNode  -- A simple, single module all alone but *might* have an hs-boot file which isn't part of a cycle
               | ResolvedCycle [Either ModuleGraphNode ModuleGraphNodeWithBoot]   -- A resolved cycle, linearised by hs-boot files
               | UnresolvedCycle [ModuleGraphNode] -- An actual cycle, which wasn't resolved by hs-boot files
```

The plan is computed in two steps:

Step 1:  Topologically sort the module graph without hs-boot files. This returns a [SCC ModuleGraphNode] which contains
         cycles.
Step 2:  For each cycle, topologically sort the modules in the cycle *with* the relevant hs-boot files. This should
         result in an acyclic build plan if the hs-boot files are sufficient to resolve the cycle.
Step 2a: For each module in the cycle, if the module has a boot file then compute the
         modules on the path between it and the hs-boot file.
         These are the intermediate modules which:
            (1) are (transitive) dependencies of the non-boot module, and
            (2) have the boot module as a (transitive) dependency.
         In particular, all such intermediate modules must appear in the same unit as
         the module under consideration, as module cycles cannot cross unit boundaries.
         This information is stored in ModuleGraphNodeWithBoot.

The `[BuildPlan]` is then interpreted by the `interpretBuildPlan` function.

* SingleModule nodes are compiled normally by either the upsweep_inst or upsweep_mod functions.
* ResolvedCycles need to compiled &quot;together&quot; so that modules outside the cycle are presented
  with a consistent knot-tied version of modules at the end.
    - When the ModuleGraphNodeWithBoot nodes are compiled then suitable rehydration
      is performed both before and after the module in question is compiled.
      See Note [Hydrating Modules] for more information.
* UnresolvedCycles are indicative of a proper cycle, unresolved by hs-boot files
  and are reported as an error to the user.

The main trickiness of `interpretBuildPlan` is deciding which version of a dependency
is visible from each module. For modules which are not in a cycle, there is just
one version of a module, so that is always used. For modules in a cycle, there are two versions of
'HomeModInfo'.

1. Internal to loop: The version created whilst compiling the loop by upsweep_mod.
2. External to loop: The knot-tied version created by typecheckLoop.

Whilst compiling a module inside the loop, we need to use the (1). For a module which
is outside of the loop which depends on something from in the loop, the (2) version
is used.

As the plan is interpreted, which version of a HomeModInfo is visible is updated
by updating a map held in a state monad. So after a loop has finished being compiled,
the visible module is the one created by typecheckLoop and the internal version is not
used again.

This plan also ensures the most important invariant to do with module loops:

&gt; If you depend on anything within a module loop, before you can use the dependency,
  the whole loop has to finish compiling.

The end result of `interpretBuildPlan` is a `[MakeAction]`, which are pairs
of `IO a` actions and a `MVar (Maybe a)`, somewhere to put the result of running
the action. This list is topologically sorted, so can be run in order to compute
the whole graph.

As well as this `interpretBuildPlan` also outputs an `IO [Maybe (Maybe HomeModInfo)]` which
can be queried at the end to get the result of all modules at the end, with their proper
visibility. For example, if any module in a loop fails then all modules in that loop will
report as failed because the visible node at the end will be the result of checking
these modules together.

-}</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span class="annot"><span class="hs-comment">-- | Simple wrapper around MVar which allows a functor instance.</span></span><span>
</span><span id="line-976"></span><span class="hs-keyword">data</span><span> </span><span id="ResultVar"><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-var">ResultVar</span></a></span></span><span> </span><span id="local-6989586621682085945"><span class="annot"><a href="#local-6989586621682085945"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682087657"><span class="annot"><a href="#local-6989586621682087657"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span id="ResultVar"><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-var">ResultVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682087657"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085945"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.MVar.html#MVar/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087657"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-977"></span><span>
</span><span id="line-978"></span><span id="local-6989586621682087660"><span id="local-6989586621682087662"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#Functor/GHC.Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-type">ResultVar</span></a></span></span></span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span id="local-6989586621682085941"><span class="annot"><a href="GHC.Driver.Make.html#mkResultVar"><span class="hs-identifier hs-type">mkResultVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.MVar.html#MVar/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085941"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-type">ResultVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085941"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-981"></span><span id="mkResultVar"><span class="annot"><span class="annottext">mkResultVar :: forall a. MVar (Maybe a) -&gt; ResultVar a
</span><a href="GHC.Driver.Make.html#mkResultVar"><span class="hs-identifier hs-var hs-var">mkResultVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; MVar (Maybe a) -&gt; ResultVar a
forall b a. (a -&gt; b) -&gt; MVar (Maybe a) -&gt; ResultVar b
</span><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-var">ResultVar</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#id/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span class="annot"><span class="hs-comment">-- | Block until the result is ready.</span></span><span>
</span><span id="line-984"></span><span id="local-6989586621682085946"><span class="annot"><a href="GHC.Driver.Make.html#waitResult"><span class="hs-identifier hs-type">waitResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-type">ResultVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085946"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#MaybeT/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682085946"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-985"></span><span id="waitResult"><span class="annot"><span class="annottext">waitResult :: forall a. ResultVar a -&gt; MaybeT IO a
</span><a href="GHC.Driver.Make.html#waitResult"><span class="hs-identifier hs-var hs-var">waitResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-type">ResultVar</span></a></span><span> </span><span id="local-6989586621682087668"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621682087668"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682087669"><span class="annot"><span class="annottext">MVar (Maybe a)
</span><a href="#local-6989586621682087669"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; MaybeT IO a
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#MaybeT/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; Maybe a -&gt; Maybe a
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621682087668"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; Maybe a) -&gt; IO (Maybe a) -&gt; IO (Maybe a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe a) -&gt; IO (Maybe a)
forall a. MVar a -&gt; IO a
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#readMVar/GHC.MVar.html#readMVar"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe a)
</span><a href="#local-6989586621682087669"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span class="hs-keyword">data</span><span> </span><span id="BuildResult"><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-var">BuildResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BuildResult"><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-var">BuildResult</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_resultOrigin"><span class="annot"><span class="annottext">BuildResult -&gt; ResultOrigin
</span><a href="GHC.Driver.Make.html#_resultOrigin"><span class="hs-identifier hs-var hs-var">_resultOrigin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultOrigin"><span class="hs-identifier hs-type">ResultOrigin</span></a></span><span>
</span><span id="line-988"></span><span>                               </span><span class="hs-special">,</span><span> </span><span id="resultVar"><span class="annot"><span class="annottext">BuildResult -&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#resultVar"><span class="hs-identifier hs-var hs-var">resultVar</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-type">ResultVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleNameSet"><span class="hs-identifier hs-type">ModuleNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>                               </span><span class="hs-special">}</span><span>
</span><span id="line-990"></span><span>
</span><span id="line-991"></span><span class="hs-comment">-- The origin of this result var, useful for debugging</span><span>
</span><span id="line-992"></span><span class="hs-keyword">data</span><span> </span><span id="ResultOrigin"><span class="annot"><a href="GHC.Driver.Make.html#ResultOrigin"><span class="hs-identifier hs-var">ResultOrigin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NoLoop"><span class="annot"><a href="GHC.Driver.Make.html#NoLoop"><span class="hs-identifier hs-var">NoLoop</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Loop"><span class="annot"><a href="GHC.Driver.Make.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultLoopOrigin"><span class="hs-identifier hs-type">ResultLoopOrigin</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682087678"><span id="local-6989586621682087683"><span id="local-6989586621682087687"><span class="annot"><span class="annottext">Int -&gt; ResultOrigin -&gt; FilePath -&gt; FilePath
[ResultOrigin] -&gt; FilePath -&gt; FilePath
ResultOrigin -&gt; FilePath
(Int -&gt; ResultOrigin -&gt; FilePath -&gt; FilePath)
-&gt; (ResultOrigin -&gt; FilePath)
-&gt; ([ResultOrigin] -&gt; FilePath -&gt; FilePath)
-&gt; Show ResultOrigin
forall a.
(Int -&gt; a -&gt; FilePath -&gt; FilePath)
-&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; FilePath -&gt; FilePath) -&gt; Show a
$cshowsPrec :: Int -&gt; ResultOrigin -&gt; FilePath -&gt; FilePath
showsPrec :: Int -&gt; ResultOrigin -&gt; FilePath -&gt; FilePath
$cshow :: ResultOrigin -&gt; FilePath
show :: ResultOrigin -&gt; FilePath
$cshowList :: [ResultOrigin] -&gt; FilePath -&gt; FilePath
showList :: [ResultOrigin] -&gt; FilePath -&gt; FilePath
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#Show/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span class="hs-keyword">data</span><span> </span><span id="ResultLoopOrigin"><span class="annot"><a href="GHC.Driver.Make.html#ResultLoopOrigin"><span class="hs-identifier hs-var">ResultLoopOrigin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Initialise"><span class="annot"><a href="GHC.Driver.Make.html#Initialise"><span class="hs-identifier hs-var">Initialise</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Rehydrated"><span class="annot"><a href="GHC.Driver.Make.html#Rehydrated"><span class="hs-identifier hs-var">Rehydrated</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Finalised"><span class="annot"><a href="GHC.Driver.Make.html#Finalised"><span class="hs-identifier hs-var">Finalised</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682087694"><span id="local-6989586621682087696"><span id="local-6989586621682087699"><span class="annot"><span class="annottext">Int -&gt; ResultLoopOrigin -&gt; FilePath -&gt; FilePath
[ResultLoopOrigin] -&gt; FilePath -&gt; FilePath
ResultLoopOrigin -&gt; FilePath
(Int -&gt; ResultLoopOrigin -&gt; FilePath -&gt; FilePath)
-&gt; (ResultLoopOrigin -&gt; FilePath)
-&gt; ([ResultLoopOrigin] -&gt; FilePath -&gt; FilePath)
-&gt; Show ResultLoopOrigin
forall a.
(Int -&gt; a -&gt; FilePath -&gt; FilePath)
-&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; FilePath -&gt; FilePath) -&gt; Show a
$cshowsPrec :: Int -&gt; ResultLoopOrigin -&gt; FilePath -&gt; FilePath
showsPrec :: Int -&gt; ResultLoopOrigin -&gt; FilePath -&gt; FilePath
$cshow :: ResultLoopOrigin -&gt; FilePath
show :: ResultLoopOrigin -&gt; FilePath
$cshowList :: [ResultLoopOrigin] -&gt; FilePath -&gt; FilePath
showList :: [ResultLoopOrigin] -&gt; FilePath -&gt; FilePath
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#Show/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span class="annot"><a href="GHC.Driver.Make.html#mkBuildResult"><span class="hs-identifier hs-type">mkBuildResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultOrigin"><span class="hs-identifier hs-type">ResultOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultVar"><span class="hs-identifier hs-type">ResultVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleNameSet"><span class="hs-identifier hs-type">ModuleNameSet</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-type">BuildResult</span></a></span><span>
</span><span id="line-997"></span><span id="mkBuildResult"><span class="annot"><span class="annottext">mkBuildResult :: ResultOrigin
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet) -&gt; BuildResult
</span><a href="GHC.Driver.Make.html#mkBuildResult"><span class="hs-identifier hs-var hs-var">mkBuildResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResultOrigin
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet) -&gt; BuildResult
</span><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-var">BuildResult</span></a></span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="hs-keyword">data</span><span> </span><span id="BuildLoopState"><span class="annot"><a href="GHC.Driver.Make.html#BuildLoopState"><span class="hs-identifier hs-var">BuildLoopState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BuildLoopState"><span class="annot"><a href="GHC.Driver.Make.html#BuildLoopState"><span class="hs-identifier hs-var">BuildLoopState</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="buildDep"><span class="annot"><span class="annottext">BuildLoopState -&gt; Map NodeKey BuildResult
</span><a href="GHC.Driver.Make.html#buildDep"><span class="hs-identifier hs-var hs-var">buildDep</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-type">BuildResult</span></a></span><span>
</span><span id="line-1001"></span><span>                                          </span><span class="hs-comment">-- The current way to build a specific TNodeKey, without cycles this just points to</span><span>
</span><span id="line-1002"></span><span>                                          </span><span class="hs-comment">-- the appropriate result of compiling a module  but with</span><span>
</span><span id="line-1003"></span><span>                                          </span><span class="hs-comment">-- cycles there can be additional indirection and can point to the result of typechecking a loop</span><span>
</span><span id="line-1004"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span id="nNODE"><span class="annot"><span class="annottext">BuildLoopState -&gt; Int
</span><a href="GHC.Driver.Make.html#nNODE"><span class="hs-identifier hs-var hs-var">nNODE</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1005"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span id="hug_var"><span class="annot"><span class="annottext">BuildLoopState -&gt; MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="GHC.Driver.Make.html#hug_var"><span class="hs-identifier hs-var hs-var">hug_var</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.MVar.html#MVar/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span>
</span><span id="line-1006"></span><span>                                     </span><span class="hs-comment">-- A global variable which is incrementally updated with the result</span><span>
</span><span id="line-1007"></span><span>                                     </span><span class="hs-comment">-- of compiling modules.</span><span>
</span><span id="line-1008"></span><span>                                     </span><span class="hs-special">}</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span class="annot"><a href="GHC.Driver.Make.html#nodeId"><span class="hs-identifier hs-type">nodeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1011"></span><span id="nodeId"><span class="annot"><span class="annottext">nodeId :: BuildM Int
</span><a href="GHC.Driver.Make.html#nodeId"><span class="hs-identifier hs-var hs-var">nodeId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1012"></span><span>  </span><span id="local-6989586621682087708"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087708"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BuildLoopState -&gt; Int) -&gt; BuildM Int
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#gets/Control.Monad.Trans.State.Lazy.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">BuildLoopState -&gt; Int
</span><a href="GHC.Driver.Make.html#nNODE"><span class="hs-identifier hs-var">nNODE</span></a></span><span>
</span><span id="line-1013"></span><span>  </span><span class="annot"><span class="annottext">(BuildLoopState -&gt; BuildLoopState) -&gt; StateT BuildLoopState IO ()
forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; s) -&gt; StateT s m ()
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#modify/Control.Monad.Trans.State.Lazy.html#modify"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087711"><span class="annot"><span class="annottext">BuildLoopState
</span><a href="#local-6989586621682087711"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildLoopState
</span><a href="#local-6989586621682087711"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#nNODE"><span class="hs-identifier hs-var">nNODE</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682087708"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-type">+</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087708"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1015"></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="annot"><a href="GHC.Driver.Make.html#setModulePipeline"><span class="hs-identifier hs-type">setModulePipeline</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-type">BuildResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1018"></span><span id="setModulePipeline"><span class="annot"><span class="annottext">setModulePipeline :: NodeKey -&gt; BuildResult -&gt; StateT BuildLoopState IO ()
</span><a href="GHC.Driver.Make.html#setModulePipeline"><span class="hs-identifier hs-var hs-var">setModulePipeline</span></a></span></span><span> </span><span id="local-6989586621682087714"><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087714"><span class="hs-identifier hs-var">mgn</span></a></span></span><span> </span><span id="local-6989586621682087715"><span class="annot"><span class="annottext">BuildResult
</span><a href="#local-6989586621682087715"><span class="hs-identifier hs-var">build_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1019"></span><span>  </span><span class="annot"><span class="annottext">(BuildLoopState -&gt; BuildLoopState) -&gt; StateT BuildLoopState IO ()
forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; s) -&gt; StateT s m ()
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#modify/Control.Monad.Trans.State.Lazy.html#modify"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087716"><span class="annot"><span class="annottext">BuildLoopState
</span><a href="#local-6989586621682087716"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuildLoopState
</span><a href="#local-6989586621682087716"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#buildDep"><span class="hs-identifier hs-var">buildDep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insert/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-type">M.insert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087714"><span class="hs-identifier hs-type">mgn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087715"><span class="hs-identifier hs-type">build_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#buildDep"><span class="hs-identifier hs-var">buildDep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087716"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span class="hs-keyword">type</span><span> </span><span id="BuildMap"><span class="annot"><a href="GHC.Driver.Make.html#BuildMap"><span class="hs-identifier hs-var">BuildMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-type">BuildResult</span></a></span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span class="annot"><a href="GHC.Driver.Make.html#getBuildMap"><span class="hs-identifier hs-type">getBuildMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildMap"><span class="hs-identifier hs-type">BuildMap</span></a></span><span>
</span><span id="line-1024"></span><span id="getBuildMap"><span class="annot"><span class="annottext">getBuildMap :: BuildM (Map NodeKey BuildResult)
</span><a href="GHC.Driver.Make.html#getBuildMap"><span class="hs-identifier hs-var hs-var">getBuildMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BuildLoopState -&gt; Map NodeKey BuildResult)
-&gt; BuildM (Map NodeKey BuildResult)
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#gets/Control.Monad.Trans.State.Lazy.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">BuildLoopState -&gt; Map NodeKey BuildResult
</span><a href="GHC.Driver.Make.html#buildDep"><span class="hs-identifier hs-var">buildDep</span></a></span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span class="annot"><a href="GHC.Driver.Make.html#getDependencies"><span class="hs-identifier hs-type">getDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildMap"><span class="hs-identifier hs-type">BuildMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-type">BuildResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1027"></span><span id="getDependencies"><span class="annot"><span class="annottext">getDependencies :: [NodeKey] -&gt; Map NodeKey BuildResult -&gt; [BuildResult]
</span><a href="GHC.Driver.Make.html#getDependencies"><span class="hs-identifier hs-var hs-var">getDependencies</span></a></span></span><span> </span><span id="local-6989586621682087721"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087721"><span class="hs-identifier hs-var">direct_deps</span></a></span></span><span> </span><span id="local-6989586621682087722"><span class="annot"><span class="annottext">Map NodeKey BuildResult
</span><a href="#local-6989586621682087722"><span class="hs-identifier hs-var">build_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1028"></span><span>  </span><span class="annot"><span class="annottext">(NodeKey -&gt; BuildResult) -&gt; [NodeKey] -&gt; [BuildResult]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe BuildResult -&gt; BuildResult
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dep_map&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe BuildResult -&gt; BuildResult)
-&gt; (NodeKey -&gt; Maybe BuildResult) -&gt; NodeKey -&gt; BuildResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Map NodeKey BuildResult -&gt; Maybe BuildResult)
-&gt; Map NodeKey BuildResult -&gt; NodeKey -&gt; Maybe BuildResult
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Map NodeKey BuildResult -&gt; Maybe BuildResult
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey BuildResult
</span><a href="#local-6989586621682087722"><span class="hs-identifier hs-var">build_map</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087721"><span class="hs-identifier hs-var">direct_deps</span></a></span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span class="hs-keyword">type</span><span> </span><span id="BuildM"><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-var">BuildM</span></a></span></span><span> </span><span id="local-6989586621682087723"><span class="annot"><a href="#local-6989586621682087723"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#StateT/Control.Monad.Trans.State.Lazy.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildLoopState"><span class="hs-identifier hs-type">BuildLoopState</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682087723"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span class="hs-comment">-- | Abstraction over the operations of a semaphore which allows usage with the</span><span>
</span><span id="line-1034"></span><span class="hs-comment">--  -j1 case</span><span>
</span><span id="line-1035"></span><span class="hs-keyword">data</span><span> </span><span id="AbstractSem"><span class="annot"><a href="GHC.Driver.Make.html#AbstractSem"><span class="hs-identifier hs-var">AbstractSem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AbstractSem"><span class="annot"><a href="GHC.Driver.Make.html#AbstractSem"><span class="hs-identifier hs-var">AbstractSem</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="acquireSem"><span class="annot"><span class="annottext">AbstractSem -&gt; IO ()
</span><a href="GHC.Driver.Make.html#acquireSem"><span class="hs-identifier hs-var hs-var">acquireSem</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1036"></span><span>                               </span><span class="hs-special">,</span><span> </span><span id="releaseSem"><span class="annot"><span class="annottext">AbstractSem -&gt; IO ()
</span><a href="GHC.Driver.Make.html#releaseSem"><span class="hs-identifier hs-var hs-var">releaseSem</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span id="local-6989586621682085967"><span class="annot"><a href="GHC.Driver.Make.html#withAbstractSem"><span class="hs-identifier hs-type">withAbstractSem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#AbstractSem"><span class="hs-identifier hs-type">AbstractSem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682085967"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682085967"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1039"></span><span id="withAbstractSem"><span class="annot"><span class="annottext">withAbstractSem :: forall b. AbstractSem -&gt; IO b -&gt; IO b
</span><a href="GHC.Driver.Make.html#withAbstractSem"><span class="hs-identifier hs-var hs-var">withAbstractSem</span></a></span></span><span> </span><span id="local-6989586621682087731"><span class="annot"><span class="annottext">AbstractSem
</span><a href="#local-6989586621682087731"><span class="hs-identifier hs-var">sem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a c b.
(HasCallStack, MonadMask m) =&gt;
m a -&gt; m c -&gt; m b -&gt; m b
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#bracket_/Control.Monad.Catch.html#bracket_"><span class="hs-identifier hs-var">MC.bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractSem -&gt; IO ()
</span><a href="GHC.Driver.Make.html#acquireSem"><span class="hs-identifier hs-var">acquireSem</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractSem
</span><a href="#local-6989586621682087731"><span class="hs-identifier hs-var">sem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractSem -&gt; IO ()
</span><a href="GHC.Driver.Make.html#releaseSem"><span class="hs-identifier hs-var">releaseSem</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractSem
</span><a href="#local-6989586621682087731"><span class="hs-identifier hs-var">sem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span class="annot"><span class="hs-comment">-- | Environment used when compiling a module</span></span><span>
</span><span id="line-1042"></span><span class="hs-keyword">data</span><span> </span><span id="MakeEnv"><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-var">MakeEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MakeEnv"><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-var">MakeEnv</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="hsc_env"><span class="annot"><span class="annottext">MakeEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-comment">-- The basic HscEnv which will be augmented for each module</span><span>
</span><span id="line-1043"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="compile_sem"><span class="annot"><span class="annottext">MakeEnv -&gt; AbstractSem
</span><a href="GHC.Driver.Make.html#compile_sem"><span class="hs-identifier hs-var hs-var">compile_sem</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Driver.Make.html#AbstractSem"><span class="hs-identifier hs-type">AbstractSem</span></a></span><span>
</span><span id="line-1044"></span><span>                       </span><span class="hs-comment">-- Modify the environment for module k, with the supplied logger modification function.</span><span>
</span><span id="line-1045"></span><span>                       </span><span class="hs-comment">-- For -j1, this wrapper doesn't do anything</span><span>
</span><span id="line-1046"></span><span>                       </span><span class="hs-comment">-- For -jn, the wrapper initialised a log queue and then modifies the logger to pipe its output</span><span>
</span><span id="line-1047"></span><span>                       </span><span class="hs-comment">--          into the log queue.</span><span>
</span><span id="line-1048"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="withLogger"><span class="annot"><span class="annottext">MakeEnv -&gt; forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Make.html#withLogger"><span class="hs-identifier hs-var hs-var">withLogger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682085973"><span class="annot"><a href="#local-6989586621682085973"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682085973"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682085973"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1049"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="env_messager"><span class="annot"><span class="annottext">MakeEnv -&gt; Maybe Messager
</span><a href="GHC.Driver.Make.html#env_messager"><span class="hs-identifier hs-var hs-var">env_messager</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>                       </span><span class="hs-special">}</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span class="hs-keyword">type</span><span> </span><span id="RunMakeM"><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-var">RunMakeM</span></a></span></span><span> </span><span id="local-6989586621682087738"><span class="annot"><a href="#local-6989586621682087738"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#MaybeT/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682087738"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span class="hs-comment">-- | Given the build plan, creates a graph which indicates where each NodeKey should</span><span>
</span><span id="line-1055"></span><span class="hs-comment">-- get its direct dependencies from. This might not be the corresponding build action</span><span>
</span><span id="line-1056"></span><span class="hs-comment">-- if the module participates in a loop. This step also labels each node with a number for the output.</span><span>
</span><span id="line-1057"></span><span class="hs-comment">-- See Note [Upsweep] for a high-level description.</span><span>
</span><span id="line-1058"></span><span class="annot"><a href="GHC.Driver.Make.html#interpretBuildPlan"><span class="hs-identifier hs-type">interpretBuildPlan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span>
</span><span id="line-1059"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span>
</span><span id="line-1060"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1061"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1062"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Is there an unresolved cycle</span><span>
</span><span id="line-1063"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Actions we need to run in order to build everything</span><span>
</span><span id="line-1064"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- An action to query to get all the built modules at the end.</span><span>
</span><span id="line-1065"></span><span id="interpretBuildPlan"><span class="annot"><span class="annottext">interpretBuildPlan :: UnitEnvGraph HomeUnitEnv
-&gt; Maybe ModIfaceCache
-&gt; Map ModNodeKeyWithUid HomeModInfo
-&gt; [BuildPlan]
-&gt; IO
     (Maybe [ModuleGraphNode], [MakeAction],
      IO [Maybe (Maybe HomeModInfo)])
</span><a href="GHC.Driver.Make.html#interpretBuildPlan"><span class="hs-identifier hs-var hs-var">interpretBuildPlan</span></a></span></span><span> </span><span id="local-6989586621682087740"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087740"><span class="hs-identifier hs-var">hug</span></a></span></span><span> </span><span id="local-6989586621682087741"><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087741"><span class="hs-identifier hs-var">mhmi_cache</span></a></span></span><span> </span><span id="local-6989586621682087742"><span class="annot"><span class="annottext">Map ModNodeKeyWithUid HomeModInfo
</span><a href="#local-6989586621682087742"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span id="local-6989586621682087743"><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087743"><span class="hs-identifier hs-var">plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1066"></span><span>  </span><span id="local-6989586621682087744"><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087744"><span class="hs-identifier hs-var">hug_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; IO (MVar (UnitEnvGraph HomeUnitEnv))
forall a. a -&gt; IO (MVar a)
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#newMVar/GHC.MVar.html#newMVar"><span class="hs-identifier hs-var">newMVar</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087740"><span class="hs-identifier hs-var">hug</span></a></span><span>
</span><span id="line-1067"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682087746"><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087746"><span class="hs-identifier hs-var">mcycle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087747"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087747"><span class="hs-identifier hs-var">plans</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087748"><span class="annot"><span class="annottext">BuildLoopState
</span><a href="#local-6989586621682087748"><span class="hs-identifier hs-var">build_map</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT BuildLoopState IO (Maybe [ModuleGraphNode], [MakeAction])
-&gt; BuildLoopState
-&gt; IO ((Maybe [ModuleGraphNode], [MakeAction]), BuildLoopState)
forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#runStateT/Control.Monad.Trans.State.Lazy.html#runStateT"><span class="hs-identifier hs-var">runStateT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[BuildPlan]
-&gt; StateT BuildLoopState IO (Maybe [ModuleGraphNode], [MakeAction])
</span><a href="#local-6989586621682087750"><span class="hs-identifier hs-var">buildLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087743"><span class="hs-identifier hs-var">plan</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NodeKey BuildResult
-&gt; Int -&gt; MVar (UnitEnvGraph HomeUnitEnv) -&gt; BuildLoopState
</span><a href="GHC.Driver.Make.html#BuildLoopState"><span class="hs-identifier hs-var">BuildLoopState</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey BuildResult
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087744"><span class="hs-identifier hs-var">hug_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087752"><span class="annot"><span class="annottext">wait :: IO [Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087752"><span class="hs-identifier hs-var hs-var">wait</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map NodeKey BuildResult -&gt; IO [Maybe (Maybe HomeModInfo)]
forall {k}. Map k BuildResult -&gt; IO [Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087753"><span class="hs-identifier hs-var">collect_results</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildLoopState -&gt; Map NodeKey BuildResult
</span><a href="GHC.Driver.Make.html#buildDep"><span class="hs-identifier hs-var">buildDep</span></a></span><span> </span><span class="annot"><span class="annottext">BuildLoopState
</span><a href="#local-6989586621682087748"><span class="hs-identifier hs-var">build_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span>  </span><span class="annot"><span class="annottext">(Maybe [ModuleGraphNode], [MakeAction],
 IO [Maybe (Maybe HomeModInfo)])
-&gt; IO
     (Maybe [ModuleGraphNode], [MakeAction],
      IO [Maybe (Maybe HomeModInfo)])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087746"><span class="hs-identifier hs-var">mcycle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087747"><span class="hs-identifier hs-var">plans</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IO [Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087752"><span class="hs-identifier hs-var">wait</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1072"></span><span>    </span><span id="local-6989586621682087753"><span class="annot"><span class="annottext">collect_results :: Map k BuildResult -&gt; IO [Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087753"><span class="hs-identifier hs-var hs-var">collect_results</span></a></span></span><span> </span><span id="local-6989586621682087757"><span class="annot"><span class="annottext">Map k BuildResult
</span><a href="#local-6989586621682087757"><span class="hs-identifier hs-var">build_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1073"></span><span>      </span><span class="annot"><span class="annottext">[IO (Maybe (Maybe HomeModInfo))] -&gt; IO [Maybe (Maybe HomeModInfo)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#sequence/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BuildResult -&gt; IO (Maybe (Maybe HomeModInfo)))
-&gt; [BuildResult] -&gt; [IO (Maybe (Maybe HomeModInfo))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087759"><span class="annot"><span class="annottext">BuildResult
</span><a href="#local-6989586621682087759"><span class="hs-identifier hs-var">br</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResultVar (Maybe HomeModInfo) -&gt; IO (Maybe (Maybe HomeModInfo))
forall {a}. ResultVar a -&gt; IO (Maybe a)
</span><a href="#local-6989586621682087760"><span class="hs-identifier hs-var">collect_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe HomeModInfo, ModuleNameSet) -&gt; Maybe HomeModInfo
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe HomeModInfo, ModuleNameSet) -&gt; Maybe HomeModInfo)
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
-&gt; ResultVar (Maybe HomeModInfo)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BuildResult -&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#resultVar"><span class="hs-identifier hs-var">resultVar</span></a></span><span> </span><span class="annot"><span class="annottext">BuildResult
</span><a href="#local-6989586621682087759"><span class="hs-identifier hs-var">br</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k BuildResult -&gt; [BuildResult]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map k BuildResult
</span><a href="#local-6989586621682087757"><span class="hs-identifier hs-var">build_map</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1074"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1075"></span><span>        </span><span id="local-6989586621682087760"><span class="annot"><span class="annottext">collect_result :: ResultVar a -&gt; IO (Maybe a)
</span><a href="#local-6989586621682087760"><span class="hs-identifier hs-var hs-var">collect_result</span></a></span></span><span> </span><span id="local-6989586621682087762"><span class="annot"><span class="annottext">ResultVar a
</span><a href="#local-6989586621682087762"><span class="hs-identifier hs-var">res_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT IO a -&gt; IO (Maybe a)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#runMaybeT/Control.Monad.Trans.Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultVar a -&gt; MaybeT IO a
forall a. ResultVar a -&gt; MaybeT IO a
</span><a href="GHC.Driver.Make.html#waitResult"><span class="hs-identifier hs-var">waitResult</span></a></span><span> </span><span class="annot"><span class="annottext">ResultVar a
</span><a href="#local-6989586621682087762"><span class="hs-identifier hs-var">res_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1076"></span><span>
</span><span id="line-1077"></span><span>    </span><span id="local-6989586621682087764"><span class="annot"><span class="annottext">n_mods :: Int
</span><a href="#local-6989586621682087764"><span class="hs-identifier hs-var hs-var">n_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#sum/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BuildPlan -&gt; Int) -&gt; [BuildPlan] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">BuildPlan -&gt; Int
</span><a href="GHC.Driver.Make.html#countMods"><span class="hs-identifier hs-var">countMods</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087743"><span class="hs-identifier hs-var">plan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span>    </span><span class="annot"><a href="#local-6989586621682087750"><span class="hs-identifier hs-type">buildLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1080"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>    </span><span class="hs-comment">-- Build the abstract pipeline which we can execute</span><span>
</span><span id="line-1082"></span><span>    </span><span class="hs-comment">-- Building finished</span><span>
</span><span id="line-1083"></span><span>    </span><span id="local-6989586621682087750"><span class="annot"><span class="annottext">buildLoop :: [BuildPlan]
-&gt; StateT BuildLoopState IO (Maybe [ModuleGraphNode], [MakeAction])
</span><a href="#local-6989586621682087750"><span class="hs-identifier hs-var hs-var">buildLoop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe [ModuleGraphNode], [MakeAction])
-&gt; StateT BuildLoopState IO (Maybe [ModuleGraphNode], [MakeAction])
forall a. a -&gt; StateT BuildLoopState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>    </span><span class="annot"><a href="#local-6989586621682087750"><span class="hs-identifier hs-var">buildLoop</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682087765"><span class="annot"><span class="annottext">BuildPlan
</span><a href="#local-6989586621682087765"><span class="hs-identifier hs-var">plan</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682087766"><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087766"><span class="hs-identifier hs-var">plans</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1085"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BuildPlan
</span><a href="#local-6989586621682087765"><span class="hs-identifier hs-var">plan</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1086"></span><span>        </span><span class="hs-comment">-- If there was no cycle, then typecheckLoop is not necessary</span><span>
</span><span id="line-1087"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#SingleModule"><span class="hs-identifier hs-type">SingleModule</span></a></span><span> </span><span id="local-6989586621682087767"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087767"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1088"></span><span>          </span><span id="local-6989586621682087768"><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087768"><span class="hs-identifier hs-var">one_plan</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe [NodeKey]
-&gt; ResultOrigin -&gt; ModuleGraphNode -&gt; BuildM MakeAction
</span><a href="#local-6989586621682087769"><span class="hs-identifier hs-var">buildSingleModule</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [NodeKey]
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">ResultOrigin
</span><a href="GHC.Driver.Make.html#NoLoop"><span class="hs-identifier hs-var">NoLoop</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087767"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1089"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682087770"><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087770"><span class="hs-identifier hs-var">cycle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087771"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087771"><span class="hs-identifier hs-var">all_plans</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
-&gt; StateT BuildLoopState IO (Maybe [ModuleGraphNode], [MakeAction])
</span><a href="#local-6989586621682087750"><span class="hs-identifier hs-var">buildLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087766"><span class="hs-identifier hs-var">plans</span></a></span><span>
</span><span id="line-1090"></span><span>          </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087770"><span class="hs-identifier hs-var">cycle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087768"><span class="hs-identifier hs-var">one_plan</span></a></span><span> </span><span class="annot"><span class="annottext">MakeAction -&gt; [MakeAction] -&gt; [MakeAction]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087771"><span class="hs-identifier hs-var">all_plans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>
</span><span id="line-1092"></span><span>        </span><span class="hs-comment">-- For a resolved cycle, depend on everything in the loop, then update</span><span>
</span><span id="line-1093"></span><span>        </span><span class="hs-comment">-- the cache to point to this node rather than directly to the module build</span><span>
</span><span id="line-1094"></span><span>        </span><span class="hs-comment">-- nodes</span><span>
</span><span id="line-1095"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#ResolvedCycle"><span class="hs-identifier hs-type">ResolvedCycle</span></a></span><span> </span><span id="local-6989586621682087772"><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087772"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1096"></span><span>          </span><span id="local-6989586621682087773"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087773"><span class="hs-identifier hs-var">pipes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; BuildM [MakeAction]
</span><a href="#local-6989586621682087774"><span class="hs-identifier hs-var">buildModuleLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087772"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1097"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682087775"><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087775"><span class="hs-identifier hs-var">cycle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087776"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087776"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
-&gt; StateT BuildLoopState IO (Maybe [ModuleGraphNode], [MakeAction])
</span><a href="#local-6989586621682087750"><span class="hs-identifier hs-var">buildLoop</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087766"><span class="hs-identifier hs-var">plans</span></a></span><span>
</span><span id="line-1098"></span><span>          </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087775"><span class="hs-identifier hs-var">cycle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087773"><span class="hs-identifier hs-var">pipes</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction] -&gt; [MakeAction] -&gt; [MakeAction]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087776"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>
</span><span id="line-1100"></span><span>        </span><span class="hs-comment">-- Can't continue past this point as the cycle is unresolved.</span><span>
</span><span id="line-1101"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#UnresolvedCycle"><span class="hs-identifier hs-type">UnresolvedCycle</span></a></span><span> </span><span id="local-6989586621682087777"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087777"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe [ModuleGraphNode], [MakeAction])
-&gt; StateT BuildLoopState IO (Maybe [ModuleGraphNode], [MakeAction])
forall a. a -&gt; StateT BuildLoopState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; Maybe [ModuleGraphNode]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087777"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>
</span><span id="line-1103"></span><span>    </span><span class="annot"><a href="#local-6989586621682087769"><span class="hs-identifier hs-type">buildSingleModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Modules we need to rehydrate before compiling this module</span><span>
</span><span id="line-1104"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultOrigin"><span class="hs-identifier hs-type">ResultOrigin</span></a></span><span>
</span><span id="line-1105"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span>          </span><span class="hs-comment">-- The node we are compiling</span><span>
</span><span id="line-1106"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span>
</span><span id="line-1107"></span><span>    </span><span id="local-6989586621682087769"><span class="annot"><span class="annottext">buildSingleModule :: Maybe [NodeKey]
-&gt; ResultOrigin -&gt; ModuleGraphNode -&gt; BuildM MakeAction
</span><a href="#local-6989586621682087769"><span class="hs-identifier hs-var hs-var">buildSingleModule</span></a></span></span><span> </span><span id="local-6989586621682087778"><span class="annot"><span class="annottext">Maybe [NodeKey]
</span><a href="#local-6989586621682087778"><span class="hs-identifier hs-var">rehydrate_nodes</span></a></span></span><span> </span><span id="local-6989586621682087779"><span class="annot"><span class="annottext">ResultOrigin
</span><a href="#local-6989586621682087779"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621682087780"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1108"></span><span>      </span><span id="local-6989586621682087781"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087781"><span class="hs-identifier hs-var">mod_idx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BuildM Int
</span><a href="GHC.Driver.Make.html#nodeId"><span class="hs-identifier hs-var">nodeId</span></a></span><span>
</span><span id="line-1109"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621682087782"><span class="annot"><span class="annottext">Map NodeKey BuildResult
</span><a href="#local-6989586621682087782"><span class="hs-identifier hs-var">build_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BuildM (Map NodeKey BuildResult)
</span><a href="GHC.Driver.Make.html#getBuildMap"><span class="hs-identifier hs-var">getBuildMap</span></a></span><span>
</span><span id="line-1110"></span><span>      </span><span id="local-6989586621682087783"><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087783"><span class="hs-identifier hs-var">hug_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BuildLoopState -&gt; MVar (UnitEnvGraph HomeUnitEnv))
-&gt; StateT BuildLoopState IO (MVar (UnitEnvGraph HomeUnitEnv))
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#gets/Control.Monad.Trans.State.Lazy.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">BuildLoopState -&gt; MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="GHC.Driver.Make.html#hug_var"><span class="hs-identifier hs-var">hug_var</span></a></span><span>
</span><span id="line-1111"></span><span>      </span><span class="hs-comment">-- 1. Get the direct dependencies of this module</span><span>
</span><span id="line-1112"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087784"><span class="annot"><span class="annottext">direct_deps :: [NodeKey]
</span><a href="#local-6989586621682087784"><span class="hs-identifier hs-var hs-var">direct_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleGraphNode -&gt; [NodeKey]
</span><a href="GHC.Unit.Module.Graph.html#nodeDependencies"><span class="hs-identifier hs-var">nodeDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1113"></span><span>          </span><span class="hs-comment">-- It's really important to force build_deps, or the whole buildMap is retained,</span><span>
</span><span id="line-1114"></span><span>          </span><span class="hs-comment">-- which would retain all the result variables, preventing us from collecting them</span><span>
</span><span id="line-1115"></span><span>          </span><span class="hs-comment">-- after they are no longer used.</span><span>
</span><span id="line-1116"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621682087786"><span class="annot"><span class="annottext">build_deps :: [BuildResult]
</span><a href="#local-6989586621682087786"><span class="hs-identifier hs-var hs-var">build_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; Map NodeKey BuildResult -&gt; [BuildResult]
</span><a href="GHC.Driver.Make.html#getDependencies"><span class="hs-identifier hs-var">getDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087784"><span class="hs-identifier hs-var">direct_deps</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey BuildResult
</span><a href="#local-6989586621682087782"><span class="hs-identifier hs-var">build_map</span></a></span><span>
</span><span id="line-1117"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682087787"><span class="annot"><span class="annottext">build_action :: RunMakeM (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087787"><span class="hs-identifier hs-var hs-var">build_action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1118"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1119"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#InstantiationNode"><span class="hs-identifier hs-type">InstantiationNode</span></a></span><span> </span><span id="local-6989586621682087788"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087788"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682087789"><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682087789"><span class="hs-identifier hs-var">iu</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1120"></span><span>                </span><span class="annot"><span class="annottext">UnitId
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall a. UnitId -&gt; RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withCurrentUnit"><span class="hs-identifier hs-var">withCurrentUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodeUnitId"><span class="hs-identifier hs-var">moduleGraphNodeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RunMakeM (Maybe HomeModInfo, ModuleNameSet)
 -&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet))
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1121"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621682087791"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087791"><span class="hs-identifier hs-var">hug</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087792"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087792"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
-&gt; [BuildResult]
-&gt; ReaderT
     MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps_hug"><span class="hs-identifier hs-var">wait_deps_hug</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087783"><span class="hs-identifier hs-var">hug_var</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682087786"><span class="hs-identifier hs-var">build_deps</span></a></span><span>
</span><span id="line-1122"></span><span>                  </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; UnitId
-&gt; InstantiatedUnit
-&gt; RunMakeM ()
</span><a href="GHC.Driver.Make.html#executeInstantiationNode"><span class="hs-identifier hs-var">executeInstantiationNode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087781"><span class="hs-identifier hs-var">mod_idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087764"><span class="hs-identifier hs-var">n_mods</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087791"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087788"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682087789"><span class="hs-identifier hs-var">iu</span></a></span><span>
</span><span id="line-1123"></span><span>                  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe HomeModInfo
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087792"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1124"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span id="local-6989586621682087795"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087795"><span class="hs-identifier hs-var">_build_deps</span></a></span></span><span> </span><span id="local-6989586621682087796"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087796"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1125"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682087797"><span class="annot"><span class="annottext">old_hmi :: Maybe HomeModInfo
</span><a href="#local-6989586621682087797"><span class="hs-identifier hs-var hs-var">old_hmi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid
-&gt; Map ModNodeKeyWithUid HomeModInfo -&gt; Maybe HomeModInfo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087796"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map ModNodeKeyWithUid HomeModInfo
</span><a href="#local-6989586621682087742"><span class="hs-identifier hs-var">old_hpt</span></a></span><span>
</span><span id="line-1126"></span><span>                    </span><span id="local-6989586621682087798"><span class="annot"><span class="annottext">rehydrate_mods :: Maybe [ModuleName]
</span><a href="#local-6989586621682087798"><span class="hs-identifier hs-var hs-var">rehydrate_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Maybe ModuleName) -&gt; [NodeKey] -&gt; [ModuleName]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe ModuleName
</span><a href="GHC.Unit.Module.Graph.html#nodeKeyModName"><span class="hs-identifier hs-var">nodeKeyModName</span></a></span><span> </span><span class="annot"><span class="annottext">([NodeKey] -&gt; [ModuleName])
-&gt; Maybe [NodeKey] -&gt; Maybe [ModuleName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [NodeKey]
</span><a href="#local-6989586621682087778"><span class="hs-identifier hs-var">rehydrate_nodes</span></a></span><span>
</span><span id="line-1127"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">UnitId
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall a. UnitId -&gt; RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withCurrentUnit"><span class="hs-identifier hs-var">withCurrentUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodeUnitId"><span class="hs-identifier hs-var">moduleGraphNodeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RunMakeM (Maybe HomeModInfo, ModuleNameSet)
 -&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet))
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1128"></span><span>                     </span><span class="hs-special">(</span><span id="local-6989586621682087800"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087800"><span class="hs-identifier hs-var">hug</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087801"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087801"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
-&gt; [BuildResult]
-&gt; ReaderT
     MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps_hug"><span class="hs-identifier hs-var">wait_deps_hug</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087783"><span class="hs-identifier hs-var">hug_var</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682087786"><span class="hs-identifier hs-var">build_deps</span></a></span><span>
</span><span id="line-1129"></span><span>                     </span><span id="local-6989586621682087802"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087802"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; Maybe HomeModInfo
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; Maybe [ModuleName]
-&gt; ModSummary
-&gt; RunMakeM HomeModInfo
</span><a href="GHC.Driver.Make.html#executeCompileNode"><span class="hs-identifier hs-var">executeCompileNode</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087781"><span class="hs-identifier hs-var">mod_idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087764"><span class="hs-identifier hs-var">n_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682087797"><span class="hs-identifier hs-var">old_hmi</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087800"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [ModuleName]
</span><a href="#local-6989586621682087798"><span class="hs-identifier hs-var">rehydrate_mods</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087796"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1130"></span><span>                     </span><span class="hs-comment">-- Write the HMI to an external cache (if one exists)</span><span>
</span><span id="line-1131"></span><span>                     </span><span class="hs-comment">-- See Note [Caching HomeModInfo]</span><span>
</span><span id="line-1132"></span><span>                     </span><span class="annot"><span class="annottext">IO (Maybe ()) -&gt; ReaderT MakeEnv (MaybeT IO) (Maybe ())
forall a. IO a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe ()) -&gt; ReaderT MakeEnv (MaybeT IO) (Maybe ()))
-&gt; IO (Maybe ()) -&gt; ReaderT MakeEnv (MaybeT IO) (Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache -&gt; (ModIfaceCache -&gt; IO ()) -&gt; IO (Maybe ())
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#forM/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087741"><span class="hs-identifier hs-var">mhmi_cache</span></a></span><span> </span><span class="annot"><span class="annottext">((ModIfaceCache -&gt; IO ()) -&gt; IO (Maybe ()))
-&gt; (ModIfaceCache -&gt; IO ()) -&gt; IO (Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682087805"><span class="annot"><span class="annottext">ModIfaceCache
</span><a href="#local-6989586621682087805"><span class="hs-identifier hs-var">hmi_cache</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIfaceCache -&gt; HomeModInfo -&gt; IO ()
</span><a href="GHC.Driver.Make.html#addHmiToCache"><span class="hs-identifier hs-var">addHmiToCache</span></a></span><span> </span><span class="annot"><span class="annottext">ModIfaceCache
</span><a href="#local-6989586621682087805"><span class="hs-identifier hs-var">hmi_cache</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087802"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-1133"></span><span>                     </span><span class="hs-comment">-- This global MVar is incrementally modified in order to avoid having to</span><span>
</span><span id="line-1134"></span><span>                     </span><span class="hs-comment">-- recreate the HPT before compiling each module which leads to a quadratic amount of work.</span><span>
</span><span id="line-1135"></span><span>                     </span><span class="annot"><span class="annottext">IO () -&gt; RunMakeM ()
forall a. IO a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; RunMakeM ()) -&gt; IO () -&gt; RunMakeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
-&gt; (UnitEnvGraph HomeUnitEnv -&gt; IO (UnitEnvGraph HomeUnitEnv))
-&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Control.Concurrent.MVar.html#modifyMVar_/Control.Concurrent.MVar.html#modifyMVar_"><span class="hs-identifier hs-var">modifyMVar_</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087783"><span class="hs-identifier hs-var">hug_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; IO (UnitEnvGraph HomeUnitEnv)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv -&gt; IO (UnitEnvGraph HomeUnitEnv))
-&gt; (UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; IO (UnitEnvGraph HomeUnitEnv)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Unit.Env.html#addHomeModInfoToHug"><span class="hs-identifier hs-var">addHomeModInfoToHug</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087802"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1136"></span><span>                     </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe HomeModInfo
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087802"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; ModuleName -&gt; ModuleNameSet -&gt; ModuleNameSet
</span><a href="GHC.Driver.Make.html#addToModuleNameSet"><span class="hs-identifier hs-var">addToModuleNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodeUnitId"><span class="hs-identifier hs-var">moduleGraphNodeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087796"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087801"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>              </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#LinkNode"><span class="hs-identifier hs-type">LinkNode</span></a></span><span> </span><span id="local-6989586621682087809"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087809"><span class="hs-identifier hs-var">_nks</span></a></span></span><span> </span><span id="local-6989586621682087810"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087810"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1138"></span><span>                  </span><span class="annot"><span class="annottext">UnitId
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall a. UnitId -&gt; RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withCurrentUnit"><span class="hs-identifier hs-var">withCurrentUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodeUnitId"><span class="hs-identifier hs-var">moduleGraphNodeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RunMakeM (Maybe HomeModInfo, ModuleNameSet)
 -&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet))
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1139"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621682087811"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087811"><span class="hs-identifier hs-var">hug</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087812"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087812"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
-&gt; [BuildResult]
-&gt; ReaderT
     MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps_hug"><span class="hs-identifier hs-var">wait_deps_hug</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087783"><span class="hs-identifier hs-var">hug_var</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682087786"><span class="hs-identifier hs-var">build_deps</span></a></span><span>
</span><span id="line-1140"></span><span>                    </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
-&gt; (Int, Int) -&gt; UnitId -&gt; [NodeKey] -&gt; RunMakeM ()
</span><a href="GHC.Driver.Make.html#executeLinkNode"><span class="hs-identifier hs-var">executeLinkNode</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087811"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087781"><span class="hs-identifier hs-var">mod_idx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087764"><span class="hs-identifier hs-var">n_mods</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087810"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087784"><span class="hs-identifier hs-var">direct_deps</span></a></span><span>
</span><span id="line-1141"></span><span>                    </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe HomeModInfo
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087812"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>      </span><span id="local-6989586621682087814"><span class="annot"><span class="annottext">MVar (Maybe (Maybe HomeModInfo, ModuleNameSet))
</span><a href="#local-6989586621682087814"><span class="hs-identifier hs-var">res_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar (Maybe (Maybe HomeModInfo, ModuleNameSet)))
-&gt; StateT
     BuildLoopState IO (MVar (Maybe (Maybe HomeModInfo, ModuleNameSet)))
forall a. IO a -&gt; StateT BuildLoopState IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO (MVar (Maybe (Maybe HomeModInfo, ModuleNameSet)))
forall a. IO (MVar a)
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#newEmptyMVar/GHC.MVar.html#newEmptyMVar"><span class="hs-identifier hs-var">newEmptyMVar</span></a></span><span>
</span><span id="line-1145"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087816"><span class="annot"><span class="annottext">result_var :: ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087816"><span class="hs-identifier hs-var hs-var">result_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MVar (Maybe (Maybe HomeModInfo, ModuleNameSet))
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
forall a. MVar (Maybe a) -&gt; ResultVar a
</span><a href="GHC.Driver.Make.html#mkResultVar"><span class="hs-identifier hs-var">mkResultVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe (Maybe HomeModInfo, ModuleNameSet))
</span><a href="#local-6989586621682087814"><span class="hs-identifier hs-var">res_var</span></a></span><span>
</span><span id="line-1146"></span><span>      </span><span class="annot"><span class="annottext">NodeKey -&gt; BuildResult -&gt; StateT BuildLoopState IO ()
</span><a href="GHC.Driver.Make.html#setModulePipeline"><span class="hs-identifier hs-var">setModulePipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087780"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultOrigin
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet) -&gt; BuildResult
</span><a href="GHC.Driver.Make.html#mkBuildResult"><span class="hs-identifier hs-var">mkBuildResult</span></a></span><span> </span><span class="annot"><span class="annottext">ResultOrigin
</span><a href="#local-6989586621682087779"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087816"><span class="hs-identifier hs-var">result_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span>      </span><span class="annot"><span class="annottext">MakeAction -&gt; BuildM MakeAction
forall a. a -&gt; StateT BuildLoopState IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(MakeAction -&gt; BuildM MakeAction)
-&gt; MakeAction -&gt; BuildM MakeAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RunMakeM (Maybe HomeModInfo, ModuleNameSet)
-&gt; MVar (Maybe (Maybe HomeModInfo, ModuleNameSet)) -&gt; MakeAction
forall a. RunMakeM a -&gt; MVar (Maybe a) -&gt; MakeAction
</span><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-var">MakeAction</span></a></span><span> </span><span class="annot"><span class="annottext">RunMakeM (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087787"><span class="hs-identifier hs-var">build_action</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe (Maybe HomeModInfo, ModuleNameSet))
</span><a href="#local-6989586621682087814"><span class="hs-identifier hs-var">res_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span>    </span><span class="annot"><a href="#local-6989586621682087819"><span class="hs-identifier hs-type">buildOneLoopyModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1151"></span><span>    </span><span id="local-6989586621682087819"><span class="annot"><span class="annottext">buildOneLoopyModule :: ModuleGraphNodeWithBootFile -&gt; BuildM [MakeAction]
</span><a href="#local-6989586621682087819"><span class="hs-identifier hs-var hs-var">buildOneLoopyModule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span> </span><span id="local-6989586621682087820"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087820"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621682087821"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087821"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1152"></span><span>      </span><span id="local-6989586621682087822"><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087822"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe [NodeKey]
-&gt; ResultOrigin -&gt; ModuleGraphNode -&gt; BuildM MakeAction
</span><a href="#local-6989586621682087769"><span class="hs-identifier hs-var">buildSingleModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; Maybe [NodeKey]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087821"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultLoopOrigin -&gt; ResultOrigin
</span><a href="GHC.Driver.Make.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="GHC.Driver.Make.html#Initialise"><span class="hs-identifier hs-var">Initialise</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087820"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-1153"></span><span>      </span><span class="hs-comment">-- Rehydration (1) from Note [Hydrating Modules], &quot;Loops with multiple boot files&quot;</span><span>
</span><span id="line-1154"></span><span>      </span><span id="local-6989586621682087823"><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087823"><span class="hs-identifier hs-var">rehydrate_action</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin -&gt; [GenWithIsBoot NodeKey] -&gt; BuildM MakeAction
</span><a href="#local-6989586621682087824"><span class="hs-identifier hs-var">rehydrateAction</span></a></span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="GHC.Driver.Make.html#Rehydrated"><span class="hs-identifier hs-var">Rehydrated</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; IsBootInterface -&gt; GenWithIsBoot NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087820"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey
-&gt; [GenWithIsBoot NodeKey] -&gt; [GenWithIsBoot NodeKey]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NodeKey -&gt; GenWithIsBoot NodeKey)
-&gt; [NodeKey] -&gt; [GenWithIsBoot NodeKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087825"><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087825"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; IsBootInterface -&gt; GenWithIsBoot NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087825"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682087821"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>      </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087822"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087823"><span class="hs-identifier hs-var">rehydrate_action</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span>    </span><span class="annot"><a href="#local-6989586621682087774"><span class="hs-identifier hs-type">buildModuleLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1159"></span><span>    </span><span id="local-6989586621682087774"><span class="annot"><span class="annottext">buildModuleLoop :: [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; BuildM [MakeAction]
</span><a href="#local-6989586621682087774"><span class="hs-identifier hs-var hs-var">buildModuleLoop</span></a></span></span><span> </span><span id="local-6989586621682087826"><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087826"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1160"></span><span>      </span><span id="local-6989586621682087827"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087827"><span class="hs-identifier hs-var">build_modules</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Either ModuleGraphNode ModuleGraphNodeWithBootFile
 -&gt; BuildM [MakeAction])
-&gt; [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; BuildM [MakeAction]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; BuildM [MakeAction])
-&gt; (ModuleGraphNodeWithBootFile -&gt; BuildM [MakeAction])
-&gt; Either ModuleGraphNode ModuleGraphNodeWithBootFile
-&gt; BuildM [MakeAction]
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../base-4.18.2.1/src/Data.Either.html#either/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MakeAction -&gt; [MakeAction])
-&gt; BuildM MakeAction -&gt; BuildM [MakeAction]
forall a b.
(a -&gt; b)
-&gt; StateT BuildLoopState IO a -&gt; StateT BuildLoopState IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MakeAction -&gt; [MakeAction] -&gt; [MakeAction]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BuildM MakeAction -&gt; BuildM [MakeAction])
-&gt; (ModuleGraphNode -&gt; BuildM MakeAction)
-&gt; ModuleGraphNode
-&gt; BuildM [MakeAction]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [NodeKey]
-&gt; ResultOrigin -&gt; ModuleGraphNode -&gt; BuildM MakeAction
</span><a href="#local-6989586621682087769"><span class="hs-identifier hs-var">buildSingleModule</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [NodeKey]
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultLoopOrigin -&gt; ResultOrigin
</span><a href="GHC.Driver.Make.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="GHC.Driver.Make.html#Initialise"><span class="hs-identifier hs-var">Initialise</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNodeWithBootFile -&gt; BuildM [MakeAction]
</span><a href="#local-6989586621682087819"><span class="hs-identifier hs-var">buildOneLoopyModule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087826"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1161"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087828"><span class="annot"><span class="annottext">extract :: Either ModuleGraphNode ModuleGraphNodeWithBootFile
-&gt; GenWithIsBoot NodeKey
</span><a href="#local-6989586621682087828"><span class="hs-identifier hs-var hs-var">extract</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682087829"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087829"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; IsBootInterface -&gt; GenWithIsBoot NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087829"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-1162"></span><span>          </span><span class="annot"><a href="#local-6989586621682087828"><span class="hs-identifier hs-var">extract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModuleGraphNodeWithBootFile"><span class="hs-identifier hs-type">ModuleGraphNodeWithBootFile</span></a></span><span> </span><span id="local-6989586621682087830"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087830"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; IsBootInterface -&gt; GenWithIsBoot NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682087830"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span>
</span><span id="line-1163"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087831"><span class="annot"><span class="annottext">loop_mods :: [GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087831"><span class="hs-identifier hs-var hs-var">loop_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either ModuleGraphNode ModuleGraphNodeWithBootFile
 -&gt; GenWithIsBoot NodeKey)
-&gt; [Either ModuleGraphNode ModuleGraphNodeWithBootFile]
-&gt; [GenWithIsBoot NodeKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Either ModuleGraphNode ModuleGraphNodeWithBootFile
-&gt; GenWithIsBoot NodeKey
</span><a href="#local-6989586621682087828"><span class="hs-identifier hs-var">extract</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ModuleGraphNode ModuleGraphNodeWithBootFile]
</span><a href="#local-6989586621682087826"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1164"></span><span>      </span><span class="hs-comment">-- Rehydration (2) from Note [Hydrating Modules], &quot;Loops with multiple boot files&quot;</span><span>
</span><span id="line-1165"></span><span>      </span><span class="hs-comment">-- Fixes the space leak described in that note.</span><span>
</span><span id="line-1166"></span><span>      </span><span id="local-6989586621682087832"><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087832"><span class="hs-identifier hs-var">rehydrate_action</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin -&gt; [GenWithIsBoot NodeKey] -&gt; BuildM MakeAction
</span><a href="#local-6989586621682087824"><span class="hs-identifier hs-var">rehydrateAction</span></a></span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="GHC.Driver.Make.html#Finalised"><span class="hs-identifier hs-var">Finalised</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087831"><span class="hs-identifier hs-var">loop_mods</span></a></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>      </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087827"><span class="hs-identifier hs-var">build_modules</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction] -&gt; [MakeAction] -&gt; [MakeAction]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MakeAction
</span><a href="#local-6989586621682087832"><span class="hs-identifier hs-var">rehydrate_action</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span>    </span><span class="hs-comment">-- An action which rehydrates the given keys</span><span>
</span><span id="line-1171"></span><span>    </span><span class="annot"><a href="#local-6989586621682087824"><span class="hs-identifier hs-type">rehydrateAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ResultLoopOrigin"><span class="hs-identifier hs-type">ResultLoopOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#GenWithIsBoot"><span class="hs-identifier hs-type">GenWithIsBoot</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildM"><span class="hs-identifier hs-type">BuildM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span>
</span><span id="line-1172"></span><span>    </span><span id="local-6989586621682087824"><span class="annot"><span class="annottext">rehydrateAction :: ResultLoopOrigin -&gt; [GenWithIsBoot NodeKey] -&gt; BuildM MakeAction
</span><a href="#local-6989586621682087824"><span class="hs-identifier hs-var hs-var">rehydrateAction</span></a></span></span><span> </span><span id="local-6989586621682087833"><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="#local-6989586621682087833"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621682087834"><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087834"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1173"></span><span>      </span><span id="local-6989586621682087835"><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087835"><span class="hs-identifier hs-var">hug_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(BuildLoopState -&gt; MVar (UnitEnvGraph HomeUnitEnv))
-&gt; StateT BuildLoopState IO (MVar (UnitEnvGraph HomeUnitEnv))
forall (m :: * -&gt; *) s a. Monad m =&gt; (s -&gt; a) -&gt; StateT s m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.State.Lazy.html#gets/Control.Monad.Trans.State.Lazy.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">BuildLoopState -&gt; MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="GHC.Driver.Make.html#hug_var"><span class="hs-identifier hs-var">hug_var</span></a></span><span>
</span><span id="line-1174"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621682087836"><span class="annot"><span class="annottext">Map NodeKey BuildResult
</span><a href="#local-6989586621682087836"><span class="hs-identifier hs-var">build_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BuildM (Map NodeKey BuildResult)
</span><a href="GHC.Driver.Make.html#getBuildMap"><span class="hs-identifier hs-var">getBuildMap</span></a></span><span>
</span><span id="line-1175"></span><span>      </span><span id="local-6989586621682087837"><span class="annot"><span class="annottext">MVar (Maybe ([HomeModInfo], ModuleNameSet))
</span><a href="#local-6989586621682087837"><span class="hs-identifier hs-var">res_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar (Maybe ([HomeModInfo], ModuleNameSet)))
-&gt; StateT
     BuildLoopState IO (MVar (Maybe ([HomeModInfo], ModuleNameSet)))
forall a. IO a -&gt; StateT BuildLoopState IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO (MVar (Maybe ([HomeModInfo], ModuleNameSet)))
forall a. IO (MVar a)
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#newEmptyMVar/GHC.MVar.html#newEmptyMVar"><span class="hs-identifier hs-var">newEmptyMVar</span></a></span><span>
</span><span id="line-1176"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682087838"><span class="hs-identifier hs-type">loop_unit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1177"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621682087838"><span class="annot"><span class="annottext">loop_unit :: UnitId
</span><a href="#local-6989586621682087838"><span class="hs-identifier hs-var hs-var">loop_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; UnitId
</span><a href="GHC.Unit.Module.Graph.html#nodeKeyUnitId"><span class="hs-identifier hs-var">nodeKeyUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; NodeKey
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey] -&gt; GenWithIsBoot NodeKey
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087834"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1178"></span><span>          </span><span class="hs-glyph">!</span><span id="local-6989586621682087841"><span class="annot"><span class="annottext">build_deps :: [BuildResult]
</span><a href="#local-6989586621682087841"><span class="hs-identifier hs-var hs-var">build_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; Map NodeKey BuildResult -&gt; [BuildResult]
</span><a href="GHC.Driver.Make.html#getDependencies"><span class="hs-identifier hs-var">getDependencies</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenWithIsBoot NodeKey -&gt; NodeKey)
-&gt; [GenWithIsBoot NodeKey] -&gt; [NodeKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; NodeKey
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087834"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map NodeKey BuildResult
</span><a href="#local-6989586621682087836"><span class="hs-identifier hs-var">build_map</span></a></span><span>
</span><span id="line-1179"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087842"><span class="annot"><span class="annottext">loop_action :: RunMakeM ([HomeModInfo], ModuleNameSet)
</span><a href="#local-6989586621682087842"><span class="hs-identifier hs-var hs-var">loop_action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId
-&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
-&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
forall a. UnitId -&gt; RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withCurrentUnit"><span class="hs-identifier hs-var">withCurrentUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087838"><span class="hs-identifier hs-var">loop_unit</span></a></span><span> </span><span class="annot"><span class="annottext">(RunMakeM ([HomeModInfo], ModuleNameSet)
 -&gt; RunMakeM ([HomeModInfo], ModuleNameSet))
-&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
-&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1180"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682087843"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087843"><span class="hs-identifier hs-var">hug</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087844"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087844"><span class="hs-identifier hs-var">tdeps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
-&gt; [BuildResult]
-&gt; ReaderT
     MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps_hug"><span class="hs-identifier hs-var">wait_deps_hug</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087835"><span class="hs-identifier hs-var">hug_var</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682087841"><span class="hs-identifier hs-var">build_deps</span></a></span><span>
</span><span id="line-1181"></span><span>            </span><span id="local-6989586621682087845"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087845"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MakeEnv -&gt; HscEnv) -&gt; ReaderT MakeEnv (MaybeT IO) HscEnv
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1182"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087847"><span class="annot"><span class="annottext">new_hsc :: HscEnv
</span><a href="#local-6989586621682087847"><span class="hs-identifier hs-var hs-var">new_hsc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#setHUG"><span class="hs-identifier hs-var">setHUG</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087843"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087845"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1183"></span><span>                </span><span class="annot"><a href="#local-6989586621682087849"><span class="hs-identifier hs-type">mns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1184"></span><span>                </span><span id="local-6989586621682087849"><span class="annot"><span class="annottext">mns :: [ModuleName]
</span><a href="#local-6989586621682087849"><span class="hs-identifier hs-var hs-var">mns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenWithIsBoot NodeKey -&gt; Maybe ModuleName)
-&gt; [GenWithIsBoot NodeKey] -&gt; [ModuleName]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe ModuleName
</span><a href="GHC.Unit.Module.Graph.html#nodeKeyModName"><span class="hs-identifier hs-var">nodeKeyModName</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Maybe ModuleName)
-&gt; (GenWithIsBoot NodeKey -&gt; NodeKey)
-&gt; GenWithIsBoot NodeKey
-&gt; Maybe ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; NodeKey
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087834"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1185"></span><span>
</span><span id="line-1186"></span><span>            </span><span id="local-6989586621682087850"><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087850"><span class="hs-identifier hs-var">hmis'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [HomeModInfo] -&gt; ReaderT MakeEnv (MaybeT IO) [HomeModInfo]
forall a. IO a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [HomeModInfo] -&gt; ReaderT MakeEnv (MaybeT IO) [HomeModInfo])
-&gt; IO [HomeModInfo] -&gt; ReaderT MakeEnv (MaybeT IO) [HomeModInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [ModuleName] -&gt; IO [HomeModInfo]
</span><a href="GHC.Driver.Make.html#rehydrateAfter"><span class="hs-identifier hs-var">rehydrateAfter</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087847"><span class="hs-identifier hs-var">new_hsc</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087849"><span class="hs-identifier hs-var">mns</span></a></span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span>            </span><span class="annot"><span class="annottext">[HomeModInfo] -&gt; [GenWithIsBoot NodeKey] -&gt; RunMakeM ()
forall {m :: * -&gt; *}.
Applicative m =&gt;
[HomeModInfo] -&gt; [GenWithIsBoot NodeKey] -&gt; m ()
</span><a href="#local-6989586621682087852"><span class="hs-identifier hs-var">checkRehydrationInvariant</span></a></span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087850"><span class="hs-identifier hs-var">hmis'</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087834"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1189"></span><span>
</span><span id="line-1190"></span><span>            </span><span class="hs-comment">-- Add hydrated interfaces to global variable</span><span>
</span><span id="line-1191"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; RunMakeM ()
forall a. IO a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; RunMakeM ()) -&gt; IO () -&gt; RunMakeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
-&gt; (UnitEnvGraph HomeUnitEnv -&gt; IO (UnitEnvGraph HomeUnitEnv))
-&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Control.Concurrent.MVar.html#modifyMVar_/Control.Concurrent.MVar.html#modifyMVar_"><span class="hs-identifier hs-var">modifyMVar_</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682087835"><span class="hs-identifier hs-var">hug_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087853"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087853"><span class="hs-identifier hs-var">hug</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; IO (UnitEnvGraph HomeUnitEnv)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv -&gt; IO (UnitEnvGraph HomeUnitEnv))
-&gt; UnitEnvGraph HomeUnitEnv -&gt; IO (UnitEnvGraph HomeUnitEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo
 -&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; [HomeModInfo]
-&gt; UnitEnvGraph HomeUnitEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Unit.Env.html#addHomeModInfoToHug"><span class="hs-identifier hs-var">addHomeModInfoToHug</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682087853"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087850"><span class="hs-identifier hs-var">hmis'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>            </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087850"><span class="hs-identifier hs-var">hmis'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682087844"><span class="hs-identifier hs-var">tdeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087855"><span class="annot"><span class="annottext">fanout :: Int -&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087855"><span class="hs-identifier hs-var hs-var">fanout</span></a></span></span><span> </span><span id="local-6989586621682087856"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087856"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([HomeModInfo] -&gt; Maybe HomeModInfo)
-&gt; ([HomeModInfo], ModuleNameSet)
-&gt; (Maybe HomeModInfo, ModuleNameSet)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../base-4.18.2.1/src/Data.Bifunctor.html#first/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe HomeModInfo
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; Maybe HomeModInfo)
-&gt; ([HomeModInfo] -&gt; HomeModInfo)
-&gt; [HomeModInfo]
-&gt; Maybe HomeModInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HomeModInfo] -&gt; Int -&gt; HomeModInfo
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.List.html#%21%21/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087856"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([HomeModInfo], ModuleNameSet)
 -&gt; (Maybe HomeModInfo, ModuleNameSet))
-&gt; ResultVar ([HomeModInfo], ModuleNameSet)
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe ([HomeModInfo], ModuleNameSet))
-&gt; ResultVar ([HomeModInfo], ModuleNameSet)
forall a. MVar (Maybe a) -&gt; ResultVar a
</span><a href="GHC.Driver.Make.html#mkResultVar"><span class="hs-identifier hs-var">mkResultVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe ([HomeModInfo], ModuleNameSet))
</span><a href="#local-6989586621682087837"><span class="hs-identifier hs-var">res_var</span></a></span><span>
</span><span id="line-1195"></span><span>      </span><span class="hs-comment">-- From outside the module loop, anyone must wait for the loop to finish and then</span><span>
</span><span id="line-1196"></span><span>      </span><span class="hs-comment">-- use the result of the rehydrated iface. This makes sure that things not in the</span><span>
</span><span id="line-1197"></span><span>      </span><span class="hs-comment">-- module loop will see the updated interfaces for all the identifiers in the loop.</span><span>
</span><span id="line-1198"></span><span>          </span><span class="annot"><a href="#local-6989586621682087858"><span class="hs-identifier hs-type">boot_key</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span>
</span><span id="line-1199"></span><span>          </span><span id="local-6989586621682087858"><span class="annot"><span class="annottext">boot_key :: NodeKey -&gt; NodeKey
</span><a href="#local-6989586621682087858"><span class="hs-identifier hs-var hs-var">boot_key</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-type">NodeKey_Module</span></a></span><span> </span><span id="local-6989586621682087859"><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682087859"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid
</span><a href="#local-6989586621682087859"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#mnkModuleName"><span class="hs-identifier hs-var">mnkModuleName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#mnkModuleName"><span class="hs-identifier hs-var">mnkModuleName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087859"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-type">IsBoot</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>          </span><span class="annot"><a href="#local-6989586621682087858"><span class="hs-identifier hs-var">boot_key</span></a></span><span> </span><span id="local-6989586621682087862"><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087862"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; NodeKey
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;boot_key&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682087862"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span>          </span><span id="local-6989586621682087864"><span class="annot"><span class="annottext">update_module_pipeline :: (GenWithIsBoot NodeKey, Int) -&gt; StateT BuildLoopState IO ()
</span><a href="#local-6989586621682087864"><span class="hs-identifier hs-var hs-var">update_module_pipeline</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682087865"><span class="annot"><span class="annottext">GenWithIsBoot NodeKey
</span><a href="#local-6989586621682087865"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087866"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087866"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1203"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; IsBootInterface
forall mod. GenWithIsBoot mod -&gt; IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey
</span><a href="#local-6989586621682087865"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1204"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; BuildResult -&gt; StateT BuildLoopState IO ()
</span><a href="GHC.Driver.Make.html#setModulePipeline"><span class="hs-identifier hs-var">setModulePipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; NodeKey
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey
</span><a href="#local-6989586621682087865"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultOrigin
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet) -&gt; BuildResult
</span><a href="GHC.Driver.Make.html#mkBuildResult"><span class="hs-identifier hs-var">mkBuildResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultLoopOrigin -&gt; ResultOrigin
</span><a href="GHC.Driver.Make.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="#local-6989586621682087833"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087855"><span class="hs-identifier hs-var">fanout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087866"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1206"></span><span>                </span><span class="annot"><span class="annottext">NodeKey -&gt; BuildResult -&gt; StateT BuildLoopState IO ()
</span><a href="GHC.Driver.Make.html#setModulePipeline"><span class="hs-identifier hs-var">setModulePipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; NodeKey
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey
</span><a href="#local-6989586621682087865"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultOrigin
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet) -&gt; BuildResult
</span><a href="GHC.Driver.Make.html#mkBuildResult"><span class="hs-identifier hs-var">mkBuildResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultLoopOrigin -&gt; ResultOrigin
</span><a href="GHC.Driver.Make.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="#local-6989586621682087833"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087855"><span class="hs-identifier hs-var">fanout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087866"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>                </span><span class="hs-comment">-- SPECIAL: Anything outside the loop needs to see A rather than A.hs-boot</span><span>
</span><span id="line-1208"></span><span>                </span><span class="annot"><span class="annottext">NodeKey -&gt; BuildResult -&gt; StateT BuildLoopState IO ()
</span><a href="GHC.Driver.Make.html#setModulePipeline"><span class="hs-identifier hs-var">setModulePipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; NodeKey
</span><a href="#local-6989586621682087858"><span class="hs-identifier hs-var">boot_key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; NodeKey
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey
</span><a href="#local-6989586621682087865"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultOrigin
-&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet) -&gt; BuildResult
</span><a href="GHC.Driver.Make.html#mkBuildResult"><span class="hs-identifier hs-var">mkBuildResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResultLoopOrigin -&gt; ResultOrigin
</span><a href="GHC.Driver.Make.html#Loop"><span class="hs-identifier hs-var">Loop</span></a></span><span> </span><span class="annot"><span class="annottext">ResultLoopOrigin
</span><a href="#local-6989586621682087833"><span class="hs-identifier hs-var">origin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="#local-6989586621682087855"><span class="hs-identifier hs-var">fanout</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087866"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087867"><span class="annot"><span class="annottext">deps_i :: [(GenWithIsBoot NodeKey, Int)]
</span><a href="#local-6989586621682087867"><span class="hs-identifier hs-var hs-var">deps_i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey] -&gt; [Int] -&gt; [(GenWithIsBoot NodeKey, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087834"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1211"></span><span>      </span><span class="annot"><span class="annottext">((GenWithIsBoot NodeKey, Int) -&gt; StateT BuildLoopState IO ())
-&gt; [(GenWithIsBoot NodeKey, Int)] -&gt; StateT BuildLoopState IO [()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(GenWithIsBoot NodeKey, Int) -&gt; StateT BuildLoopState IO ()
</span><a href="#local-6989586621682087864"><span class="hs-identifier hs-var">update_module_pipeline</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenWithIsBoot NodeKey, Int)]
</span><a href="#local-6989586621682087867"><span class="hs-identifier hs-var">deps_i</span></a></span><span>
</span><span id="line-1212"></span><span>
</span><span id="line-1213"></span><span>      </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">RunMakeM ([HomeModInfo], ModuleNameSet)
-&gt; MVar (Maybe ([HomeModInfo], ModuleNameSet)) -&gt; MakeAction
forall a. RunMakeM a -&gt; MVar (Maybe a) -&gt; MakeAction
</span><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-var">MakeAction</span></a></span><span> </span><span class="annot"><span class="annottext">RunMakeM ([HomeModInfo], ModuleNameSet)
</span><a href="#local-6989586621682087842"><span class="hs-identifier hs-var">loop_action</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe ([HomeModInfo], ModuleNameSet))
</span><a href="#local-6989586621682087837"><span class="hs-identifier hs-var">res_var</span></a></span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span>      </span><span class="hs-comment">-- Checks that the interfaces returned from hydration match-up with the names of the</span><span>
</span><span id="line-1216"></span><span>      </span><span class="hs-comment">-- modules which were fed into the function.</span><span>
</span><span id="line-1217"></span><span>    </span><span id="local-6989586621682087852"><span class="annot"><span class="annottext">checkRehydrationInvariant :: [HomeModInfo] -&gt; [GenWithIsBoot NodeKey] -&gt; m ()
</span><a href="#local-6989586621682087852"><span class="hs-identifier hs-var hs-var">checkRehydrationInvariant</span></a></span></span><span> </span><span id="local-6989586621682087882"><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087882"><span class="hs-identifier hs-var">hmis</span></a></span></span><span> </span><span id="local-6989586621682087883"><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087883"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1218"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087884"><span class="annot"><span class="annottext">hmi_names :: [ModuleName]
</span><a href="#local-6989586621682087884"><span class="hs-identifier hs-var hs-var">hmi_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; ModuleName) -&gt; [HomeModInfo] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName)
-&gt; (HomeModInfo -&gt; Module) -&gt; HomeModInfo -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; Module)
-&gt; (HomeModInfo -&gt; ModIface) -&gt; HomeModInfo -&gt; Module
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087882"><span class="hs-identifier hs-var">hmis</span></a></span><span>
</span><span id="line-1219"></span><span>            </span><span id="local-6989586621682087887"><span class="annot"><span class="annottext">start :: [ModuleName]
</span><a href="#local-6989586621682087887"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenWithIsBoot NodeKey -&gt; Maybe ModuleName)
-&gt; [GenWithIsBoot NodeKey] -&gt; [ModuleName]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe ModuleName
</span><a href="GHC.Unit.Module.Graph.html#nodeKeyModName"><span class="hs-identifier hs-var">nodeKeyModName</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Maybe ModuleName)
-&gt; (GenWithIsBoot NodeKey -&gt; NodeKey)
-&gt; GenWithIsBoot NodeKey
-&gt; Maybe ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot NodeKey -&gt; NodeKey
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot NodeKey]
</span><a href="#local-6989586621682087883"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1220"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, Applicative m) =&gt;
Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-var">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087884"><span class="hs-identifier hs-var">hmi_names</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; [ModuleName] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087887"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; m ()) -&gt; SDoc -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087884"><span class="hs-identifier hs-var">hmi_names</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682087887"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span id="local-6989586621682085992"><span class="annot"><a href="GHC.Driver.Make.html#withCurrentUnit"><span class="hs-identifier hs-type">withCurrentUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085992"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085992"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1224"></span><span id="withCurrentUnit"><span class="annot"><span class="annottext">withCurrentUnit :: forall a. UnitId -&gt; RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withCurrentUnit"><span class="hs-identifier hs-var hs-var">withCurrentUnit</span></a></span></span><span> </span><span id="local-6989586621682087890"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087890"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1225"></span><span>  </span><span class="annot"><span class="annottext">(MakeEnv -&gt; MakeEnv) -&gt; RunMakeM a -&gt; RunMakeM a
forall r (m :: * -&gt; *) a.
(r -&gt; r) -&gt; ReaderT r m a -&gt; ReaderT r m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#local/Control.Monad.Trans.Reader.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087892"><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682087892"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682087892"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-type">hscSetActiveUnitId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087890"><span class="hs-identifier hs-type">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682087892"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span class="annot"><a href="GHC.Driver.Make.html#upsweep"><span class="hs-identifier hs-type">upsweep</span></a></span><span>
</span><span id="line-1228"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The number of workers we wish to run in parallel</span></span><span>
</span><span id="line-1229"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The base HscEnv, which is augmented for each module</span></span><span>
</span><span id="line-1230"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModIfaceCache"><span class="hs-identifier hs-type">ModIfaceCache</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ A cache to incrementally write final interface files to</span></span><span>
</span><span id="line-1231"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1232"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1233"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildPlan"><span class="hs-identifier hs-type">BuildPlan</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1234"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span id="upsweep"><span class="annot"><span class="annottext">upsweep :: Int
-&gt; HscEnv
-&gt; Maybe ModIfaceCache
-&gt; Maybe Messager
-&gt; Map ModNodeKeyWithUid HomeModInfo
-&gt; [BuildPlan]
-&gt; IO (SuccessFlag, [HomeModInfo])
</span><a href="GHC.Driver.Make.html#upsweep"><span class="hs-identifier hs-var hs-var">upsweep</span></a></span></span><span> </span><span id="local-6989586621682087893"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087893"><span class="hs-identifier hs-var">n_jobs</span></a></span></span><span> </span><span id="local-6989586621682087894"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087894"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682087895"><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087895"><span class="hs-identifier hs-var">hmi_cache</span></a></span></span><span> </span><span id="local-6989586621682087896"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087896"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621682087897"><span class="annot"><span class="annottext">Map ModNodeKeyWithUid HomeModInfo
</span><a href="#local-6989586621682087897"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span id="local-6989586621682087898"><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087898"><span class="hs-identifier hs-var">build_plan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1236"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682087899"><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087899"><span class="hs-identifier hs-var">cycle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087900"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087900"><span class="hs-identifier hs-var">pipelines</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087901"><span class="annot"><span class="annottext">IO [Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087901"><span class="hs-identifier hs-var">collect_result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
-&gt; Maybe ModIfaceCache
-&gt; Map ModNodeKeyWithUid HomeModInfo
-&gt; [BuildPlan]
-&gt; IO
     (Maybe [ModuleGraphNode], [MakeAction],
      IO [Maybe (Maybe HomeModInfo)])
</span><a href="GHC.Driver.Make.html#interpretBuildPlan"><span class="hs-identifier hs-var">interpretBuildPlan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087894"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ModIfaceCache
</span><a href="#local-6989586621682087895"><span class="hs-identifier hs-var">hmi_cache</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModNodeKeyWithUid HomeModInfo
</span><a href="#local-6989586621682087897"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildPlan]
</span><a href="#local-6989586621682087898"><span class="hs-identifier hs-var">build_plan</span></a></span><span>
</span><span id="line-1237"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; HscEnv -&gt; Maybe Messager -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runPipelines"><span class="hs-identifier hs-var">runPipelines</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087893"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087894"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087896"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682087900"><span class="hs-identifier hs-var">pipelines</span></a></span><span>
</span><span id="line-1238"></span><span>    </span><span id="local-6989586621682087903"><span class="annot"><span class="annottext">[Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087903"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087901"><span class="hs-identifier hs-var">collect_result</span></a></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087904"><span class="annot"><span class="annottext">completed :: [HomeModInfo]
</span><a href="#local-6989586621682087904"><span class="hs-identifier hs-var hs-var">completed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087905"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087905"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087905"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087903"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span>    </span><span class="hs-comment">-- Handle any cycle in the original compilation graph and return the result</span><span>
</span><span id="line-1243"></span><span>    </span><span class="hs-comment">-- of the upsweep.</span><span>
</span><span id="line-1244"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="#local-6989586621682087899"><span class="hs-identifier hs-var">cycle</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1245"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087906"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087906"><span class="hs-identifier hs-var">mss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1246"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087907"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682087907"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087894"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1247"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682087907"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; SDoc
</span><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier hs-var">cyclicModuleErr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087906"><span class="hs-identifier hs-var">mss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1248"></span><span>          </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1249"></span><span>        </span><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1250"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087909"><span class="annot"><span class="annottext">success_flag :: SuccessFlag
</span><a href="#local-6989586621682087909"><span class="hs-identifier hs-var hs-var">success_flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SuccessFlag
</span><a href="GHC.Types.Basic.html#successIf"><span class="hs-identifier hs-var">successIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe (Maybe HomeModInfo) -&gt; Bool)
-&gt; [Maybe (Maybe HomeModInfo)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Maybe HomeModInfo) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (Maybe HomeModInfo)]
</span><a href="#local-6989586621682087903"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>          </span><span class="annot"><span class="annottext">(SuccessFlag, [HomeModInfo]) -&gt; IO (SuccessFlag, [HomeModInfo])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682087909"><span class="hs-identifier hs-var">success_flag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087904"><span class="hs-identifier hs-var">completed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span class="annot"><a href="GHC.Driver.Make.html#toCache"><span class="hs-identifier hs-type">toCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1254"></span><span id="toCache"><span class="annot"><span class="annottext">toCache :: [HomeModInfo] -&gt; Map ModNodeKeyWithUid HomeModInfo
</span><a href="GHC.Driver.Make.html#toCache"><span class="hs-identifier hs-var hs-var">toCache</span></a></span></span><span> </span><span id="local-6989586621682087912"><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087912"><span class="hs-identifier hs-var">hmis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModNodeKeyWithUid, HomeModInfo)]
-&gt; Map ModNodeKeyWithUid HomeModInfo
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#fromList/Data.Map.Strict.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; ModNodeKeyWithUid
</span><a href="GHC.Driver.Make.html#miKey"><span class="hs-identifier hs-var">miKey</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; ModNodeKeyWithUid) -&gt; ModIface -&gt; ModNodeKeyWithUid
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087914"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087914"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682087914"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087914"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682087912"><span class="hs-identifier hs-var">hmis</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>
</span><span id="line-1256"></span><span class="annot"><a href="GHC.Driver.Make.html#miKey"><span class="hs-identifier hs-type">miKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-type">ModNodeKeyWithUid</span></a></span><span>
</span><span id="line-1257"></span><span id="miKey"><span class="annot"><span class="annottext">miKey :: ModIface -&gt; ModNodeKeyWithUid
</span><a href="GHC.Driver.Make.html#miKey"><span class="hs-identifier hs-var hs-var">miKey</span></a></span></span><span> </span><span id="local-6989586621682087915"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087915"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; UnitId -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-var">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; ModuleNameWithIsBoot
</span><a href="GHC.Unit.Module.ModIface.html#mi_mnwib"><span class="hs-identifier hs-var">mi_mnwib</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087915"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; UnitId) -&gt; GenUnit UnitId -&gt; UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682087915"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>
</span><span id="line-1259"></span><span class="annot"><a href="GHC.Driver.Make.html#upsweep_inst"><span class="hs-identifier hs-type">upsweep_inst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1260"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1261"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- index of module</span><span>
</span><span id="line-1262"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- total number of modules</span><span>
</span><span id="line-1263"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-1264"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedUnit"><span class="hs-identifier hs-type">InstantiatedUnit</span></a></span><span>
</span><span id="line-1265"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span id="upsweep_inst"><span class="annot"><span class="annottext">upsweep_inst :: HscEnv
-&gt; Maybe Messager
-&gt; Int
-&gt; Int
-&gt; UnitId
-&gt; InstantiatedUnit
-&gt; IO ()
</span><a href="GHC.Driver.Make.html#upsweep_inst"><span class="hs-identifier hs-var hs-var">upsweep_inst</span></a></span></span><span> </span><span id="local-6989586621682087919"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087919"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682087920"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087920"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621682087921"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087921"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621682087922"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087922"><span class="hs-identifier hs-var">nmods</span></a></span></span><span> </span><span id="local-6989586621682087923"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087923"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682087924"><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682087924"><span class="hs-identifier hs-var">iuid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1267"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087920"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1268"></span><span>            </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087925"><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621682087925"><span class="hs-identifier hs-var">hscMessage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621682087925"><span class="hs-identifier hs-var">hscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087919"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087921"><span class="hs-identifier hs-var">mod_index</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087922"><span class="hs-identifier hs-var">nmods</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompileReason -&gt; RecompileRequired
</span><a href="GHC.Iface.Recomp.html#NeedsRecompile"><span class="hs-identifier hs-var">NeedsRecompile</span></a></span><span> </span><span class="annot"><span class="annottext">CompileReason
</span><a href="GHC.Iface.Recomp.html#MustCompile"><span class="hs-identifier hs-var">MustCompile</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; InstantiatedUnit -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#InstantiationNode"><span class="hs-identifier hs-var">InstantiationNode</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087923"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682087924"><span class="hs-identifier hs-var">iuid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span>            </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1270"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc () -&gt; IO ()
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087919"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; IO ()) -&gt; Hsc () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Messages GhcMessage, Maybe ()) -&gt; Hsc ()
forall a. IO (Messages GhcMessage, Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages GhcMessage, Maybe ()) -&gt; Hsc ())
-&gt; IO (Messages GhcMessage, Maybe ()) -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Messages TcRnMessage, Maybe ())
-&gt; IO (Messages GhcMessage, Maybe ())
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Messages TcRnMessage, a) -&gt; m (Messages GhcMessage, a)
</span><a href="GHC.Driver.Errors.Types.html#hoistTcRnMessage"><span class="hs-identifier hs-var">hoistTcRnMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages TcRnMessage, Maybe ())
 -&gt; IO (Messages GhcMessage, Maybe ()))
-&gt; IO (Messages TcRnMessage, Maybe ())
-&gt; IO (Messages GhcMessage, Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; GenUnit UnitId -&gt; IO (Messages TcRnMessage, Maybe ())
</span><a href="GHC.Tc.Utils.Backpack.html#tcRnCheckUnit"><span class="hs-identifier hs-var">tcRnCheckUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087919"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; IO (Messages TcRnMessage, Maybe ()))
-&gt; GenUnit UnitId -&gt; IO (Messages TcRnMessage, Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit -&gt; GenUnit UnitId
forall uid. GenInstantiatedUnit uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-var">VirtUnit</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682087924"><span class="hs-identifier hs-var">iuid</span></a></span><span>
</span><span id="line-1271"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span class="hs-comment">-- | Compile a single module.  Always produce a Linkable for it if</span><span>
</span><span id="line-1274"></span><span class="hs-comment">-- successful.  If no compilation happened, return the old Linkable.</span><span>
</span><span id="line-1275"></span><span class="annot"><a href="GHC.Driver.Make.html#upsweep_mod"><span class="hs-identifier hs-type">upsweep_mod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1276"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1277"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1278"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1279"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- index of module</span><span>
</span><span id="line-1280"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- total number of modules</span><span>
</span><span id="line-1281"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1282"></span><span id="upsweep_mod"><span class="annot"><span class="annottext">upsweep_mod :: HscEnv
-&gt; Maybe Messager
-&gt; Maybe HomeModInfo
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Make.html#upsweep_mod"><span class="hs-identifier hs-var hs-var">upsweep_mod</span></a></span></span><span> </span><span id="local-6989586621682087933"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087933"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682087934"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087934"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621682087935"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682087935"><span class="hs-identifier hs-var">old_hmi</span></a></span></span><span> </span><span id="local-6989586621682087936"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087936"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span id="local-6989586621682087937"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087937"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621682087938"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087938"><span class="hs-identifier hs-var">nmods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1283"></span><span>  </span><span id="local-6989586621682087939"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087939"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; Maybe ModIface
-&gt; HomeModLinkable
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Pipeline.html#compileOne%27"><span class="hs-identifier hs-var">compileOne'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682087934"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087933"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087936"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1284"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087937"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682087938"><span class="hs-identifier hs-var">nmods</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; ModIface) -&gt; Maybe HomeModInfo -&gt; Maybe ModIface
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682087935"><span class="hs-identifier hs-var">old_hmi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModLinkable
-&gt; (HomeModInfo -&gt; HomeModLinkable)
-&gt; Maybe HomeModInfo
-&gt; HomeModLinkable
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#hm_linkable"><span class="hs-identifier hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682087935"><span class="hs-identifier hs-var">old_hmi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span>  </span><span class="hs-comment">-- MP: This is a bit janky, because before you add the entries you have to extend the HPT with the module</span><span>
</span><span id="line-1287"></span><span>  </span><span class="hs-comment">-- you just compiled. Another option, would be delay adding anything until after upsweep has finished, but I</span><span>
</span><span id="line-1288"></span><span>  </span><span class="hs-comment">-- am unsure if this is sound (wrt running TH splices for example).</span><span>
</span><span id="line-1289"></span><span>  </span><span class="hs-comment">-- This function only does anything if the linkable produced is a BCO, which only happens with the</span><span>
</span><span id="line-1290"></span><span>  </span><span class="hs-comment">-- bytecode backend, no need to guard against the backend type additionally.</span><span>
</span><span id="line-1291"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Linkable -&gt; IO ()
</span><a href="GHC.Driver.Make.html#addSptEntries"><span class="hs-identifier hs-var">addSptEntries</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHPT"><span class="hs-identifier hs-var">hscUpdateHPT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682087944"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682087944"><span class="hs-identifier hs-var">hpt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomeModInfo -&gt; HomePackageTable
</span><a href="GHC.Unit.Home.ModInfo.html#addToHpt"><span class="hs-identifier hs-var">addToHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682087944"><span class="hs-identifier hs-var">hpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682087936"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087939"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087933"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1292"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Unit.Home.ModInfo.html#homeModInfoByteCode"><span class="hs-identifier hs-var">homeModInfoByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087939"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span>
</span><span id="line-1294"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682087939"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-1295"></span><span>
</span><span id="line-1296"></span><span class="hs-comment">-- | Add the entries from a BCO linkable to the SPT table, see</span><span>
</span><span id="line-1297"></span><span class="hs-comment">-- See Note [Grand plan for static forms] in GHC.Iface.Tidy.StaticPtrTable.</span><span>
</span><span id="line-1298"></span><span class="annot"><a href="GHC.Driver.Make.html#addSptEntries"><span class="hs-identifier hs-type">addSptEntries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span id="addSptEntries"><span class="annot"><span class="annottext">addSptEntries :: HscEnv -&gt; Maybe Linkable -&gt; IO ()
</span><a href="GHC.Driver.Make.html#addSptEntries"><span class="hs-identifier hs-var hs-var">addSptEntries</span></a></span></span><span> </span><span id="local-6989586621682087947"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087947"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682087948"><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621682087948"><span class="hs-identifier hs-var">mlinkable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1300"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; [SptEntry] -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-var">hscAddSptEntries</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682087947"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1301"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SptEntry
</span><a href="#local-6989586621682087950"><span class="hs-identifier hs-var">spt</span></a></span><span>
</span><span id="line-1302"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087951"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682087951"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621682087948"><span class="hs-identifier hs-var">mlinkable</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1303"></span><span>     </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087952"><span class="annot"><span class="annottext">Unlinked
</span><a href="#local-6989586621682087952"><span class="hs-identifier hs-var">unlinked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; [Unlinked]
</span><a href="GHC.Linker.Types.html#linkableUnlinked"><span class="hs-identifier hs-var">linkableUnlinked</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682087951"><span class="hs-identifier hs-var">linkable</span></a></span><span>
</span><span id="line-1304"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.Types.html#BCOs"><span class="hs-identifier hs-type">BCOs</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682087955"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621682087955"><span class="hs-identifier hs-var">spts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unlinked -&gt; [Unlinked]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Unlinked
</span><a href="#local-6989586621682087952"><span class="hs-identifier hs-var">unlinked</span></a></span><span>
</span><span id="line-1305"></span><span>     </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087950"><span class="annot"><span class="annottext">SptEntry
</span><a href="#local-6989586621682087950"><span class="hs-identifier hs-var">spt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621682087955"><span class="hs-identifier hs-var">spts</span></a></span><span>
</span><span id="line-1306"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1307"></span><span>
</span><span id="line-1308"></span><span class="hs-comment">{- Note [-fno-code mode]
~~~~~~~~~~~~~~~~~~~~~~~~
GHC offers the flag -fno-code for the purpose of parsing and typechecking a
program without generating object files. This is intended to be used by tooling
and IDEs to provide quick feedback on any parser or type errors as cheaply as
possible.

When GHC is invoked with -fno-code no object files or linked output will be
generated. As many errors and warnings as possible will be generated, as if
-fno-code had not been passed. The session DynFlags will have
backend == NoBackend.

-fwrite-interface
~~~~~~~~~~~~~~~~
Whether interface files are generated in -fno-code mode is controlled by the
-fwrite-interface flag. The -fwrite-interface flag is a no-op if -fno-code is
not also passed. Recompilation avoidance requires interface files, so passing
-fno-code without -fwrite-interface should be avoided. If -fno-code were
re-implemented today, -fwrite-interface would be discarded and it would be
considered always on; this behaviour is as it is for backwards compatibility.

================================================================
IN SUMMARY: ALWAYS PASS -fno-code AND -fwrite-interface TOGETHER
================================================================

Template Haskell
~~~~~~~~~~~~~~~~
A module using template haskell may invoke an imported function from inside a
splice. This will cause the type-checker to attempt to execute that code, which
would fail if no object files had been generated. See #8025. To rectify this,
during the downsweep we patch the DynFlags in the ModSummary of any home module
that is imported by a module that uses template haskell, to generate object
code.

The flavour of the generated code depends on whether `-fprefer-byte-code` is enabled
or not in the module which needs the code generation. If the module requires byte-code then
dependencies will generate byte-code, otherwise they will generate object files.
In the case where some modules require byte-code and some object files, both are
generated by enabling `-fbyte-code-and-object-code`, the test &quot;fat015&quot; tests these
configurations.

The object files (and interface files if -fwrite-interface is disabled) produced
for template haskell are written to temporary files.

Note that since template haskell can run arbitrary IO actions, -fno-code mode
is no more secure than running without it.

Potential TODOS:
~~~~~
* Remove -fwrite-interface and have interface files always written in -fno-code
  mode
* Both .o and .dyn_o files are generated for template haskell, but we only need
  .dyn_o. Fix it.
* In make mode, a message like
  Compiling A (A.hs, /tmp/ghc_123.o)
  is shown if downsweep enabled object code generation for A. Perhaps we should
  show &quot;nothing&quot; or &quot;temporary object file&quot; instead. Note that one
  can currently use -keep-tmp-files and inspect the generated file with the
  current behaviour.
* Offer a -no-codedir command line option, and write what were temporary
  object files there. This would speed up recompilation.
* Use existing object files (if they are up to date) instead of always
  generating temporary ones.
-}</span><span>
</span><span id="line-1372"></span><span>
</span><span id="line-1373"></span><span class="hs-comment">-- Note [When source is considered modified]</span><span>
</span><span id="line-1374"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1375"></span><span class="hs-comment">-- A number of functions in GHC.Driver accept a SourceModified argument, which</span><span>
</span><span id="line-1376"></span><span class="hs-comment">-- is part of how GHC determines whether recompilation may be avoided (see the</span><span>
</span><span id="line-1377"></span><span class="hs-comment">-- definition of the SourceModified data type for details).</span><span>
</span><span id="line-1378"></span><span class="hs-comment">--</span><span>
</span><span id="line-1379"></span><span class="hs-comment">-- Determining whether or not a source file is considered modified depends not</span><span>
</span><span id="line-1380"></span><span class="hs-comment">-- only on the source file itself, but also on the output files which compiling</span><span>
</span><span id="line-1381"></span><span class="hs-comment">-- that module would produce. This is done because GHC supports a number of</span><span>
</span><span id="line-1382"></span><span class="hs-comment">-- flags which control which output files should be produced, e.g. -fno-code</span><span>
</span><span id="line-1383"></span><span class="hs-comment">-- -fwrite-interface and -fwrite-ide-file; we must check not only whether the</span><span>
</span><span id="line-1384"></span><span class="hs-comment">-- source file has been modified since the last compile, but also whether the</span><span>
</span><span id="line-1385"></span><span class="hs-comment">-- source file has been modified since the last compile which produced all of</span><span>
</span><span id="line-1386"></span><span class="hs-comment">-- the output files which have been requested.</span><span>
</span><span id="line-1387"></span><span class="hs-comment">--</span><span>
</span><span id="line-1388"></span><span class="hs-comment">-- Specifically, a source file is considered unmodified if it is up-to-date</span><span>
</span><span id="line-1389"></span><span class="hs-comment">-- relative to all of the output files which have been requested. Whether or</span><span>
</span><span id="line-1390"></span><span class="hs-comment">-- not an output file is up-to-date depends on what kind of file it is:</span><span>
</span><span id="line-1391"></span><span class="hs-comment">--</span><span>
</span><span id="line-1392"></span><span class="annot"><span class="hs-comment">-- * iface (.hi) files are considered up-to-date if (and only if) their</span></span><span>
</span><span id="line-1393"></span><span class="hs-comment">--   mi_src_hash field matches the hash of the source file,</span><span>
</span><span id="line-1394"></span><span class="hs-comment">--</span><span>
</span><span id="line-1395"></span><span class="annot"><span class="hs-comment">-- * all other output files (.o, .dyn_o, .hie, etc) are considered up-to-date</span></span><span>
</span><span id="line-1396"></span><span class="hs-comment">--   if (and only if) their modification times on the filesystem are greater</span><span>
</span><span id="line-1397"></span><span class="hs-comment">--   than or equal to the modification time of the corresponding .hi file.</span><span>
</span><span id="line-1398"></span><span class="hs-comment">--</span><span>
</span><span id="line-1399"></span><span class="hs-comment">-- Why do we use '&gt;=' rather than '&gt;' for output files other than the .hi file?</span><span>
</span><span id="line-1400"></span><span class="hs-comment">-- If the filesystem has poor resolution for timestamps (e.g. FAT32 has a</span><span>
</span><span id="line-1401"></span><span class="hs-comment">-- resolution of 2 seconds), we may often find that the .hi and .o files have</span><span>
</span><span id="line-1402"></span><span class="hs-comment">-- the same modification time. Using &gt;= is slightly unsafe, but it matches</span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- make's behaviour.</span><span>
</span><span id="line-1404"></span><span class="hs-comment">--</span><span>
</span><span id="line-1405"></span><span class="hs-comment">-- This strategy allows us to do the minimum work necessary in order to ensure</span><span>
</span><span id="line-1406"></span><span class="hs-comment">-- that all the files the user cares about are up-to-date; e.g. we should not</span><span>
</span><span id="line-1407"></span><span class="hs-comment">-- worry about .o files if the user has indicated that they are not interested</span><span>
</span><span id="line-1408"></span><span class="hs-comment">-- in them via -fno-code. See also #9243.</span><span>
</span><span id="line-1409"></span><span class="hs-comment">--</span><span>
</span><span id="line-1410"></span><span class="hs-comment">-- Note that recompilation avoidance is dependent on .hi files being produced,</span><span>
</span><span id="line-1411"></span><span class="hs-comment">-- which does not happen if -fno-write-interface -fno-code is passed. That is,</span><span>
</span><span id="line-1412"></span><span class="hs-comment">-- passing -fno-write-interface -fno-code means that you cannot benefit from</span><span>
</span><span id="line-1413"></span><span class="hs-comment">-- recompilation avoidance. See also Note [-fno-code mode].</span><span>
</span><span id="line-1414"></span><span class="hs-comment">--</span><span>
</span><span id="line-1415"></span><span class="hs-comment">-- The correctness of this strategy depends on an assumption that whenever we</span><span>
</span><span id="line-1416"></span><span class="hs-comment">-- are producing multiple output files, the .hi file is always written first.</span><span>
</span><span id="line-1417"></span><span class="hs-comment">-- If this assumption is violated, we risk recompiling unnecessarily by</span><span>
</span><span id="line-1418"></span><span class="hs-comment">-- incorrectly regarding non-.hi files as outdated.</span><span>
</span><span id="line-1419"></span><span class="hs-comment">--</span><span>
</span><span id="line-1420"></span><span>
</span><span id="line-1421"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-1422"></span><span class="hs-comment">--</span><span>
</span><span id="line-1423"></span><span class="annot"><span class="hs-comment">-- | Topological sort of the module graph</span></span><span>
</span><span id="line-1424"></span><span class="annot"><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-type">topSortModuleGraph</span></a></span><span>
</span><span id="line-1425"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1426"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Drop hi-boot nodes? (see below)</span></span><span>
</span><span id="line-1427"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span>
</span><span id="line-1428"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#HomeUnitModule"><span class="hs-identifier hs-type">HomeUnitModule</span></a></span><span>
</span><span id="line-1429"></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ Root module name.  If @Nothing@, use the full graph.</span></span><span>
</span><span id="line-1430"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1431"></span><span class="hs-comment">-- ^ Calculate SCCs of the module graph, possibly dropping the hi-boot nodes</span><span>
</span><span id="line-1432"></span><span class="hs-comment">-- The resulting list of strongly-connected-components is in topologically</span><span>
</span><span id="line-1433"></span><span class="hs-comment">-- sorted order, starting with the module(s) at the bottom of the</span><span>
</span><span id="line-1434"></span><span class="hs-comment">-- dependency graph (ie compile them first) and ending with the ones at</span><span>
</span><span id="line-1435"></span><span class="hs-comment">-- the top.</span><span>
</span><span id="line-1436"></span><span class="hs-comment">--</span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- Drop hi-boot nodes (first boolean arg)?</span><span>
</span><span id="line-1438"></span><span class="hs-comment">--</span><span>
</span><span id="line-1439"></span><span class="hs-comment">-- - @False@:   treat the hi-boot summaries as nodes of the graph,</span><span>
</span><span id="line-1440"></span><span class="hs-comment">--              so the graph must be acyclic</span><span>
</span><span id="line-1441"></span><span class="hs-comment">--</span><span>
</span><span id="line-1442"></span><span class="hs-comment">-- - @True@:    eliminate the hi-boot nodes, and instead pretend</span><span>
</span><span id="line-1443"></span><span class="hs-comment">--              the a source-import of Foo is an import of Foo</span><span>
</span><span id="line-1444"></span><span class="hs-comment">--              The resulting graph has no hi-boot nodes, but can be cyclic</span><span>
</span><span id="line-1445"></span><span id="topSortModuleGraph"><span class="annot"><span class="annottext">topSortModuleGraph :: Bool
-&gt; ModuleGraph -&gt; Maybe HomeUnitModule -&gt; [SCC ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var hs-var">topSortModuleGraph</span></a></span></span><span> </span><span id="local-6989586621682087956"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087956"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span></span><span> </span><span id="local-6989586621682087957"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087957"><span class="hs-identifier hs-var">module_graph</span></a></span></span><span> </span><span id="local-6989586621682087958"><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087958"><span class="hs-identifier hs-var">mb_root_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1446"></span><span>    </span><span class="hs-comment">-- stronglyConnCompG flips the original order, so if we reverse</span><span>
</span><span id="line-1447"></span><span>    </span><span class="hs-comment">-- the summaries we get a stable topological sort.</span><span>
</span><span id="line-1448"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; [ModuleGraphNode]
-&gt; Maybe HomeUnitModule
-&gt; [SCC ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#topSortModules"><span class="hs-identifier hs-var">topSortModules</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087956"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([ModuleGraphNode] -&gt; [ModuleGraphNode])
-&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModuleGraphNode]
</span><a href="GHC.Unit.Module.Graph.html#mgModSummaries%27"><span class="hs-identifier hs-var">mgModSummaries'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621682087957"><span class="hs-identifier hs-var">module_graph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087958"><span class="hs-identifier hs-var">mb_root_mod</span></a></span><span>
</span><span id="line-1449"></span><span>
</span><span id="line-1450"></span><span class="annot"><a href="GHC.Driver.Make.html#topSortModules"><span class="hs-identifier hs-type">topSortModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#HomeUnitModule"><span class="hs-identifier hs-type">HomeUnitModule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1451"></span><span id="topSortModules"><span class="annot"><span class="annottext">topSortModules :: Bool
-&gt; [ModuleGraphNode]
-&gt; Maybe HomeUnitModule
-&gt; [SCC ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#topSortModules"><span class="hs-identifier hs-var hs-var">topSortModules</span></a></span></span><span> </span><span id="local-6989586621682087960"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087960"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span></span><span> </span><span id="local-6989586621682087961"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087961"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span id="local-6989586621682087962"><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087962"><span class="hs-identifier hs-var">mb_root_mod</span></a></span></span><span>
</span><span id="line-1452"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SCC SummaryNode -&gt; SCC ModuleGraphNode)
-&gt; [SCC SummaryNode] -&gt; [SCC ModuleGraphNode]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SummaryNode -&gt; ModuleGraphNode)
-&gt; SCC SummaryNode -&gt; SCC ModuleGraphNode
forall a b. (a -&gt; b) -&gt; SCC a -&gt; SCC b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">SummaryNode -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#summaryNodeSummary"><span class="hs-identifier hs-var">summaryNodeSummary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SCC SummaryNode] -&gt; [SCC ModuleGraphNode])
-&gt; [SCC SummaryNode] -&gt; [SCC ModuleGraphNode]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode -&gt; [SCC SummaryNode]
forall node. Graph node -&gt; [SCC node]
</span><a href="GHC.Data.Graph.Directed.html#stronglyConnCompG"><span class="hs-identifier hs-var">stronglyConnCompG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682087964"><span class="hs-identifier hs-var">initial_graph</span></a></span><span>
</span><span id="line-1453"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1454"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682087965"><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682087965"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087966"><span class="annot"><span class="annottext">NodeKey -&gt; Maybe SummaryNode
</span><a href="#local-6989586621682087966"><span class="hs-identifier hs-var">lookup_node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1455"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; [ModuleGraphNode]
-&gt; (Graph SummaryNode, NodeKey -&gt; Maybe SummaryNode)
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodes"><span class="hs-identifier hs-var">moduleGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682087960"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682087961"><span class="hs-identifier hs-var">summaries</span></a></span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span>    </span><span id="local-6989586621682087964"><span class="annot"><span class="annottext">initial_graph :: Graph SummaryNode
</span><a href="#local-6989586621682087964"><span class="hs-identifier hs-var hs-var">initial_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="#local-6989586621682087962"><span class="hs-identifier hs-var">mb_root_mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1458"></span><span>        </span><span class="annot"><span class="annottext">Maybe HomeUnitModule
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682087965"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-1459"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span id="local-6989586621682087967"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087967"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682087968"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087968"><span class="hs-identifier hs-var">root_mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1460"></span><span>            </span><span class="hs-comment">-- restrict the graph to just those modules reachable from</span><span>
</span><span id="line-1461"></span><span>            </span><span class="hs-comment">-- the specified module.  We do this by building a graph with</span><span>
</span><span id="line-1462"></span><span>            </span><span class="hs-comment">-- the full set of nodes, and determining the reachable set from</span><span>
</span><span id="line-1463"></span><span>            </span><span class="hs-comment">-- the specified node.</span><span>
</span><span id="line-1464"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682087969"><span class="annot"><span class="annottext">root :: SummaryNode
</span><a href="#local-6989586621682087969"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682087970"><span class="annot"><span class="annottext">SummaryNode
</span><a href="#local-6989586621682087970"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe SummaryNode
</span><a href="#local-6989586621682087966"><span class="hs-identifier hs-var">lookup_node</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Maybe SummaryNode) -&gt; NodeKey -&gt; Maybe SummaryNode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="annot"><span class="annottext">(ModNodeKeyWithUid -&gt; NodeKey) -&gt; ModNodeKeyWithUid -&gt; NodeKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; UnitId -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#ModNodeKeyWithUid"><span class="hs-identifier hs-var">ModNodeKeyWithUid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; ModuleNameWithIsBoot
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682087968"><span class="hs-identifier hs-var">root_mod</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682087967"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-1465"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682087965"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode -&gt; SummaryNode -&gt; Bool
forall node. Graph node -&gt; node -&gt; Bool
</span><a href="GHC.Data.Graph.Directed.html#hasVertexG"><span class="hs-operator hs-var">`hasVertexG`</span></a></span><span> </span><span class="annot"><span class="annottext">SummaryNode
</span><a href="#local-6989586621682087970"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1466"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SummaryNode
</span><a href="#local-6989586621682087970"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1467"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1468"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; SummaryNode
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;module does not exist&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1469"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[SummaryNode] -&gt; Graph SummaryNode
forall key payload.
Uniquable key =&gt;
[Node key payload] -&gt; Graph (Node key payload)
</span><a href="GHC.Data.Graph.Directed.html#graphFromEdgedVerticesUniq"><span class="hs-identifier hs-var">graphFromEdgedVerticesUniq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SummaryNode -&gt; [SummaryNode] -&gt; [SummaryNode]
forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">SummaryNode
</span><a href="#local-6989586621682087969"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph SummaryNode -&gt; SummaryNode -&gt; [SummaryNode]
forall node. Graph node -&gt; node -&gt; [node]
</span><a href="GHC.Data.Graph.Directed.html#reachableG"><span class="hs-identifier hs-var">reachableG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682087965"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">SummaryNode
</span><a href="#local-6989586621682087969"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1470"></span><span>
</span><span id="line-1471"></span><span class="hs-keyword">newtype</span><span> </span><span id="ModNodeMap"><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-var">ModNodeMap</span></a></span></span><span> </span><span id="local-6989586621682086048"><span class="annot"><a href="#local-6989586621682086048"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ModNodeMap"><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-var">ModNodeMap</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unModNodeMap"><span class="annot"><span class="annottext">forall a. ModNodeMap a -&gt; Map ModuleNameWithIsBoot a
</span><a href="GHC.Driver.Make.html#unModNodeMap"><span class="hs-identifier hs-var hs-var">unModNodeMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKey"><span class="hs-identifier hs-type">ModNodeKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086048"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1472"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682087978"><span id="local-6989586621682087983"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; ModNodeMap a -&gt; ModNodeMap b)
-&gt; (forall a b. a -&gt; ModNodeMap b -&gt; ModNodeMap a)
-&gt; Functor ModNodeMap
forall a b. a -&gt; ModNodeMap b -&gt; ModNodeMap a
forall a b. (a -&gt; b) -&gt; ModNodeMap a -&gt; ModNodeMap b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; ModNodeMap a -&gt; ModNodeMap b
fmap :: forall a b. (a -&gt; b) -&gt; ModNodeMap a -&gt; ModNodeMap b
$c&lt;$ :: forall a b. a -&gt; ModNodeMap b -&gt; ModNodeMap a
&lt;$ :: forall a b. a -&gt; ModNodeMap b -&gt; ModNodeMap a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#Functor/GHC.Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682087993"><span id="local-6989586621682088001"><span id="local-6989586621682088007"><span id="local-6989586621682088012"><span class="annot"><span class="annottext">Functor ModNodeMap
Foldable ModNodeMap
(Functor ModNodeMap, Foldable ModNodeMap) =&gt;
(forall (f :: * -&gt; *) a b.
 Applicative f =&gt;
 (a -&gt; f b) -&gt; ModNodeMap a -&gt; f (ModNodeMap b))
-&gt; (forall (f :: * -&gt; *) a.
    Applicative f =&gt;
    ModNodeMap (f a) -&gt; f (ModNodeMap a))
-&gt; (forall (m :: * -&gt; *) a b.
    Monad m =&gt;
    (a -&gt; m b) -&gt; ModNodeMap a -&gt; m (ModNodeMap b))
-&gt; (forall (m :: * -&gt; *) a.
    Monad m =&gt;
    ModNodeMap (m a) -&gt; m (ModNodeMap a))
-&gt; Traversable ModNodeMap
forall (t :: * -&gt; *).
(Functor t, Foldable t) =&gt;
(forall (f :: * -&gt; *) a b.
 Applicative f =&gt;
 (a -&gt; f b) -&gt; t a -&gt; f (t b))
-&gt; (forall (f :: * -&gt; *) a. Applicative f =&gt; t (f a) -&gt; f (t a))
-&gt; (forall (m :: * -&gt; *) a b.
    Monad m =&gt;
    (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; (forall (m :: * -&gt; *) a. Monad m =&gt; t (m a) -&gt; m (t a))
-&gt; Traversable t
forall (m :: * -&gt; *) a.
Monad m =&gt;
ModNodeMap (m a) -&gt; m (ModNodeMap a)
forall (f :: * -&gt; *) a.
Applicative f =&gt;
ModNodeMap (f a) -&gt; f (ModNodeMap a)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; ModNodeMap a -&gt; m (ModNodeMap b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; ModNodeMap a -&gt; f (ModNodeMap b)
$ctraverse :: forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; ModNodeMap a -&gt; f (ModNodeMap b)
traverse :: forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; ModNodeMap a -&gt; f (ModNodeMap b)
$csequenceA :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
ModNodeMap (f a) -&gt; f (ModNodeMap a)
sequenceA :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
ModNodeMap (f a) -&gt; f (ModNodeMap a)
$cmapM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; ModNodeMap a -&gt; m (ModNodeMap b)
mapM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; ModNodeMap a -&gt; m (ModNodeMap b)
$csequence :: forall (m :: * -&gt; *) a.
Monad m =&gt;
ModNodeMap (m a) -&gt; m (ModNodeMap a)
sequence :: forall (m :: * -&gt; *) a.
Monad m =&gt;
ModNodeMap (m a) -&gt; m (ModNodeMap a)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#Traversable/Data.Traversable.html#Traversable"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Traversable</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088020"><span id="local-6989586621682088029"><span id="local-6989586621682088037"><span id="local-6989586621682088043"><span id="local-6989586621682088047"><span id="local-6989586621682088051"><span id="local-6989586621682088055"><span id="local-6989586621682088059"><span id="local-6989586621682088063"><span id="local-6989586621682088067"><span id="local-6989586621682088071"><span id="local-6989586621682088075"><span id="local-6989586621682088081"><span id="local-6989586621682088089"><span id="local-6989586621682088097"><span id="local-6989586621682088105"><span id="local-6989586621682088113"><span class="annot"><span class="annottext">(forall m. Monoid m =&gt; ModNodeMap m -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ModNodeMap a -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ModNodeMap a -&gt; m)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; a)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; a)
-&gt; (forall a. ModNodeMap a -&gt; [a])
-&gt; (forall a. ModNodeMap a -&gt; Bool)
-&gt; (forall a. ModNodeMap a -&gt; Int)
-&gt; (forall a. Eq a =&gt; a -&gt; ModNodeMap a -&gt; Bool)
-&gt; (forall a. Ord a =&gt; ModNodeMap a -&gt; a)
-&gt; (forall a. Ord a =&gt; ModNodeMap a -&gt; a)
-&gt; (forall a. Num a =&gt; ModNodeMap a -&gt; a)
-&gt; (forall a. Num a =&gt; ModNodeMap a -&gt; a)
-&gt; Foldable ModNodeMap
forall a. Eq a =&gt; a -&gt; ModNodeMap a -&gt; Bool
forall a. Num a =&gt; ModNodeMap a -&gt; a
forall a. Ord a =&gt; ModNodeMap a -&gt; a
forall m. Monoid m =&gt; ModNodeMap m -&gt; m
forall a. ModNodeMap a -&gt; Bool
forall a. ModNodeMap a -&gt; Int
forall a. ModNodeMap a -&gt; [a]
forall a. (a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; a
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ModNodeMap a -&gt; m
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
forall (t :: * -&gt; *).
(forall m. Monoid m =&gt; t m -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; t a -&gt; a)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; t a -&gt; a)
-&gt; (forall a. t a -&gt; [a])
-&gt; (forall a. t a -&gt; Bool)
-&gt; (forall a. t a -&gt; Int)
-&gt; (forall a. Eq a =&gt; a -&gt; t a -&gt; Bool)
-&gt; (forall a. Ord a =&gt; t a -&gt; a)
-&gt; (forall a. Ord a =&gt; t a -&gt; a)
-&gt; (forall a. Num a =&gt; t a -&gt; a)
-&gt; (forall a. Num a =&gt; t a -&gt; a)
-&gt; Foldable t
$cfold :: forall m. Monoid m =&gt; ModNodeMap m -&gt; m
fold :: forall m. Monoid m =&gt; ModNodeMap m -&gt; m
$cfoldMap :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ModNodeMap a -&gt; m
foldMap :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ModNodeMap a -&gt; m
$cfoldMap' :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ModNodeMap a -&gt; m
foldMap' :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ModNodeMap a -&gt; m
$cfoldr :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
foldr :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
$cfoldr' :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
foldr' :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
$cfoldl :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
foldl :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
$cfoldl' :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
foldl' :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; ModNodeMap a -&gt; b
$cfoldr1 :: forall a. (a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; a
foldr1 :: forall a. (a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; a
$cfoldl1 :: forall a. (a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; a
foldl1 :: forall a. (a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; a
$ctoList :: forall a. ModNodeMap a -&gt; [a]
toList :: forall a. ModNodeMap a -&gt; [a]
$cnull :: forall a. ModNodeMap a -&gt; Bool
null :: forall a. ModNodeMap a -&gt; Bool
$clength :: forall a. ModNodeMap a -&gt; Int
length :: forall a. ModNodeMap a -&gt; Int
$celem :: forall a. Eq a =&gt; a -&gt; ModNodeMap a -&gt; Bool
elem :: forall a. Eq a =&gt; a -&gt; ModNodeMap a -&gt; Bool
$cmaximum :: forall a. Ord a =&gt; ModNodeMap a -&gt; a
maximum :: forall a. Ord a =&gt; ModNodeMap a -&gt; a
$cminimum :: forall a. Ord a =&gt; ModNodeMap a -&gt; a
minimum :: forall a. Ord a =&gt; ModNodeMap a -&gt; a
$csum :: forall a. Num a =&gt; ModNodeMap a -&gt; a
sum :: forall a. Num a =&gt; ModNodeMap a -&gt; a
$cproduct :: forall a. Num a =&gt; ModNodeMap a -&gt; a
product :: forall a. Num a =&gt; ModNodeMap a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#Foldable/Data.Foldable.html#Foldable"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Foldable</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>
</span><span id="line-1474"></span><span id="local-6989586621682086107"><span class="annot"><a href="GHC.Driver.Make.html#emptyModNodeMap"><span class="hs-identifier hs-type">emptyModNodeMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086107"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1475"></span><span id="emptyModNodeMap"><span class="annot"><span class="annottext">emptyModNodeMap :: forall a. ModNodeMap a
</span><a href="GHC.Driver.Make.html#emptyModNodeMap"><span class="hs-identifier hs-var hs-var">emptyModNodeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
forall a. Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
</span><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-var">ModNodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-1476"></span><span>
</span><span id="line-1477"></span><span id="local-6989586621682086109"><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapInsert"><span class="hs-identifier hs-type">modNodeMapInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKey"><span class="hs-identifier hs-type">ModNodeKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682086109"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086109"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086109"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1478"></span><span id="modNodeMapInsert"><span class="annot"><span class="annottext">modNodeMapInsert :: forall a. ModuleNameWithIsBoot -&gt; a -&gt; ModNodeMap a -&gt; ModNodeMap a
</span><a href="GHC.Driver.Make.html#modNodeMapInsert"><span class="hs-identifier hs-var hs-var">modNodeMapInsert</span></a></span></span><span> </span><span id="local-6989586621682088120"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682088120"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682088121"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682088121"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span id="local-6989586621682088122"><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088122"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
forall a. Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
</span><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-var">ModNodeMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
-&gt; a -&gt; Map ModuleNameWithIsBoot a -&gt; Map ModuleNameWithIsBoot a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682088120"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682088121"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088122"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1479"></span><span>
</span><span id="line-1480"></span><span id="local-6989586621682088124"><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapElems"><span class="hs-identifier hs-type">modNodeMapElems</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088124"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682088124"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1481"></span><span id="modNodeMapElems"><span class="annot"><span class="annottext">modNodeMapElems :: forall a. ModNodeMap a -&gt; [a]
</span><a href="GHC.Driver.Make.html#modNodeMapElems"><span class="hs-identifier hs-var hs-var">modNodeMapElems</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span id="local-6989586621682088125"><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088125"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a -&gt; [a]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088125"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1482"></span><span>
</span><span id="line-1483"></span><span id="local-6989586621682086112"><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapLookup"><span class="hs-identifier hs-type">modNodeMapLookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKey"><span class="hs-identifier hs-type">ModNodeKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086112"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086112"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1484"></span><span id="modNodeMapLookup"><span class="annot"><span class="annottext">modNodeMapLookup :: forall a. ModuleNameWithIsBoot -&gt; ModNodeMap a -&gt; Maybe a
</span><a href="GHC.Driver.Make.html#modNodeMapLookup"><span class="hs-identifier hs-var hs-var">modNodeMapLookup</span></a></span></span><span> </span><span id="local-6989586621682088127"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682088127"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span id="local-6989586621682088128"><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088128"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; Map ModuleNameWithIsBoot a -&gt; Maybe a
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682088127"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088128"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1485"></span><span>
</span><span id="line-1486"></span><span id="local-6989586621682086114"><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapSingleton"><span class="hs-identifier hs-type">modNodeMapSingleton</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModNodeKey"><span class="hs-identifier hs-type">ModNodeKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682086114"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086114"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1487"></span><span id="modNodeMapSingleton"><span class="annot"><span class="annottext">modNodeMapSingleton :: forall a. ModuleNameWithIsBoot -&gt; a -&gt; ModNodeMap a
</span><a href="GHC.Driver.Make.html#modNodeMapSingleton"><span class="hs-identifier hs-var hs-var">modNodeMapSingleton</span></a></span></span><span> </span><span id="local-6989586621682088129"><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682088129"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682088130"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682088130"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
forall a. Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
</span><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-var">ModNodeMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleNameWithIsBoot -&gt; a -&gt; Map ModuleNameWithIsBoot a
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#singleton/Data.Map.Strict.Internal.html#singleton"><span class="hs-identifier hs-var">M.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameWithIsBoot
</span><a href="#local-6989586621682088129"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682088130"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1488"></span><span>
</span><span id="line-1489"></span><span id="local-6989586621682086118"><span class="annot"><a href="GHC.Driver.Make.html#modNodeMapUnionWith"><span class="hs-identifier hs-type">modNodeMapUnionWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682086118"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682086118"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682086118"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086118"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086118"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086118"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1490"></span><span id="modNodeMapUnionWith"><span class="annot"><span class="annottext">modNodeMapUnionWith :: forall a.
(a -&gt; a -&gt; a) -&gt; ModNodeMap a -&gt; ModNodeMap a -&gt; ModNodeMap a
</span><a href="GHC.Driver.Make.html#modNodeMapUnionWith"><span class="hs-identifier hs-var hs-var">modNodeMapUnionWith</span></a></span></span><span> </span><span id="local-6989586621682088133"><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621682088133"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span id="local-6989586621682088134"><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088134"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-type">ModNodeMap</span></a></span><span> </span><span id="local-6989586621682088135"><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088135"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
forall a. Map ModuleNameWithIsBoot a -&gt; ModNodeMap a
</span><a href="GHC.Driver.Make.html#ModNodeMap"><span class="hs-identifier hs-var">ModNodeMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a)
-&gt; Map ModuleNameWithIsBoot a
-&gt; Map ModuleNameWithIsBoot a
-&gt; Map ModuleNameWithIsBoot a
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#unionWith/Data.Map.Strict.Internal.html#unionWith"><span class="hs-identifier hs-var">M.unionWith</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621682088133"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088134"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Map ModuleNameWithIsBoot a
</span><a href="#local-6989586621682088135"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1491"></span><span>
</span><span id="line-1492"></span><span class="hs-comment">-- | If there are {-# SOURCE #-} imports between strongly connected</span><span>
</span><span id="line-1493"></span><span class="hs-comment">-- components in the topological sort, then those imports can</span><span>
</span><span id="line-1494"></span><span class="hs-comment">-- definitely be replaced by ordinary non-SOURCE imports: if SOURCE</span><span>
</span><span id="line-1495"></span><span class="hs-comment">-- were necessary, then the edge would be part of a cycle.</span><span>
</span><span id="line-1496"></span><span id="local-6989586621682085915"><span class="annot"><a href="GHC.Driver.Make.html#warnUnnecessarySourceImports"><span class="hs-identifier hs-type">warnUnnecessarySourceImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085915"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Graph.html#SCC/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085915"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1497"></span><span id="warnUnnecessarySourceImports"><span class="annot"><span class="annottext">warnUnnecessarySourceImports :: forall (m :: * -&gt; *). GhcMonad m =&gt; [SCC ModSummary] -&gt; m ()
</span><a href="GHC.Driver.Make.html#warnUnnecessarySourceImports"><span class="hs-identifier hs-var hs-var">warnUnnecessarySourceImports</span></a></span></span><span> </span><span id="local-6989586621682088153"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621682088153"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1498"></span><span>  </span><span id="local-6989586621682088154"><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682088154"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DiagOpts) -&gt; m DynFlags -&gt; m DiagOpts
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1499"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; DiagOpts -&gt; Bool
</span><a href="GHC.Utils.Error.html#diag_wopt"><span class="hs-identifier hs-var">diag_wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnusedImports"><span class="hs-identifier hs-var">Opt_WarnUnusedImports</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682088154"><span class="hs-identifier hs-var">diag_opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1500"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088161"><span class="annot"><span class="annottext">check :: [ModSummary] -&gt; [MsgEnvelope GhcMessage]
</span><a href="#local-6989586621682088161"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621682088162"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088162"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1501"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088163"><span class="annot"><span class="annottext">mods_in_this_cycle :: [ModuleName]
</span><a href="#local-6989586621682088163"><span class="hs-identifier hs-var hs-var">mods_in_this_cycle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088162"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1502"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; MsgEnvelope GhcMessage
</span><a href="#local-6989586621682088164"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682088165"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682088166"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088166"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088162"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088165"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682088165"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_home_srcimps"><span class="hs-identifier hs-var">ms_home_srcimps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088166"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1503"></span><span>                      </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682088165"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModuleName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#notElem/Data.Foldable.html#notElem"><span class="hs-operator hs-var">`notElem`</span></a></span><span>  </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088163"><span class="hs-identifier hs-var">mods_in_this_cycle</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1504"></span><span>
</span><span id="line-1505"></span><span>        </span><span class="annot"><a href="#local-6989586621682088164"><span class="hs-identifier hs-type">warn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#MsgEnvelope"><span class="hs-identifier hs-type">MsgEnvelope</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span>
</span><span id="line-1506"></span><span>        </span><span id="local-6989586621682088164"><span class="annot"><span class="annottext">warn :: GenLocated SrcSpan ModuleName -&gt; MsgEnvelope GhcMessage
</span><a href="#local-6989586621682088164"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682088169"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088169"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682088170"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088170"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage)
-&gt; MsgEnvelope DriverMessage -&gt; MsgEnvelope GhcMessage
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts -&gt; SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; DiagOpts -&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainMsgEnvelope"><span class="hs-identifier hs-var">mkPlainMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682088154"><span class="hs-identifier hs-var">diag_opts</span></a></span><span>
</span><span id="line-1507"></span><span>                                                  </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088169"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverUnnecessarySourceImports"><span class="hs-identifier hs-var">DriverUnnecessarySourceImports</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088170"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1508"></span><span>    </span><span class="annot"><span class="annottext">Messages GhcMessage -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; Messages GhcMessage -&gt; m ()
</span><a href="GHC.Driver.Monad.html#logDiagnostics"><span class="hs-identifier hs-var">logDiagnostics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag (MsgEnvelope GhcMessage) -&gt; Messages GhcMessage
forall e. Bag (MsgEnvelope e) -&gt; Messages e
</span><a href="GHC.Types.Error.html#mkMessages"><span class="hs-identifier hs-var">mkMessages</span></a></span><span> </span><span class="annot"><span class="annottext">(Bag (MsgEnvelope GhcMessage) -&gt; Messages GhcMessage)
-&gt; Bag (MsgEnvelope GhcMessage) -&gt; Messages GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[MsgEnvelope GhcMessage] -&gt; Bag (MsgEnvelope GhcMessage)
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SCC ModSummary -&gt; [MsgEnvelope GhcMessage])
-&gt; [SCC ModSummary] -&gt; [MsgEnvelope GhcMessage]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModSummary] -&gt; [MsgEnvelope GhcMessage]
</span><a href="#local-6989586621682088161"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; [MsgEnvelope GhcMessage])
-&gt; (SCC ModSummary -&gt; [ModSummary])
-&gt; SCC ModSummary
-&gt; [MsgEnvelope GhcMessage]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SCC ModSummary -&gt; [ModSummary]
forall vertex. SCC vertex -&gt; [vertex]
</span><a href="../../containers-0.6.7/src/Data.Graph.html#flattenSCC/Data.Graph.html#flattenSCC"><span class="hs-identifier hs-var">flattenSCC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621682088153"><span class="hs-identifier hs-var">sccs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1509"></span><span>
</span><span id="line-1510"></span><span>
</span><span id="line-1511"></span><span class="hs-comment">-- This caches the answer to the question, if we are in this unit, what does</span><span>
</span><span id="line-1512"></span><span class="hs-comment">-- an import of this module mean.</span><span>
</span><span id="line-1513"></span><span class="hs-keyword">type</span><span> </span><span id="DownsweepCache"><span class="annot"><a href="GHC.Driver.Make.html#DownsweepCache"><span class="hs-identifier hs-var">DownsweepCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1514"></span><span>
</span><span id="line-1515"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1516"></span><span class="hs-comment">--</span><span>
</span><span id="line-1517"></span><span class="hs-comment">-- | Downsweep (dependency analysis)</span><span>
</span><span id="line-1518"></span><span class="hs-comment">--</span><span>
</span><span id="line-1519"></span><span class="hs-comment">-- Chase downwards from the specified root set, returning summaries</span><span>
</span><span id="line-1520"></span><span class="hs-comment">-- for all home modules encountered.  Only follow source-import</span><span>
</span><span id="line-1521"></span><span class="hs-comment">-- links.</span><span>
</span><span id="line-1522"></span><span class="hs-comment">--</span><span>
</span><span id="line-1523"></span><span class="hs-comment">-- We pass in the previous collection of summaries, which is used as a</span><span>
</span><span id="line-1524"></span><span class="hs-comment">-- cache to avoid recalculating a module summary if the source is</span><span>
</span><span id="line-1525"></span><span class="hs-comment">-- unchanged.</span><span>
</span><span id="line-1526"></span><span class="hs-comment">--</span><span>
</span><span id="line-1527"></span><span class="hs-comment">-- The returned list of [ModSummary] nodes has one node for each home-package</span><span>
</span><span id="line-1528"></span><span class="hs-comment">-- module, plus one for any hs-boot files.  The imports of these nodes</span><span>
</span><span id="line-1529"></span><span class="hs-comment">-- are all there, including the imports of non-home-package modules.</span><span>
</span><span id="line-1530"></span><span class="annot"><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier hs-type">downsweep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1531"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1532"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Old summaries</span></span><span>
</span><span id="line-1533"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Ignore dependencies on these; treat</span><span>
</span><span id="line-1534"></span><span>                                </span><span class="hs-comment">-- them as if they were package modules</span><span>
</span><span id="line-1535"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>               </span><span class="hs-comment">-- True &lt;=&gt; allow multiple targets to have</span><span>
</span><span id="line-1536"></span><span>                                </span><span class="hs-comment">--          the same module name; this is</span><span>
</span><span id="line-1537"></span><span>                                </span><span class="hs-comment">--          very useful for ghc -M</span><span>
</span><span id="line-1538"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1539"></span><span>                </span><span class="hs-comment">-- The non-error elements of the returned list all have distinct</span><span>
</span><span id="line-1540"></span><span>                </span><span class="hs-comment">-- (Modules, IsBoot) identifiers, unless the Bool is true in</span><span>
</span><span id="line-1541"></span><span>                </span><span class="hs-comment">-- which case there can be repeats</span><span>
</span><span id="line-1542"></span><span id="downsweep"><span class="annot"><span class="annottext">downsweep :: HscEnv
-&gt; [ModSummary]
-&gt; [ModuleName]
-&gt; Bool
-&gt; IO ([DriverMessages], [ModuleGraphNode])
</span><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier hs-var hs-var">downsweep</span></a></span></span><span> </span><span id="local-6989586621682088174"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682088175"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088175"><span class="hs-identifier hs-var">old_summaries</span></a></span></span><span> </span><span id="local-6989586621682088176"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088176"><span class="hs-identifier hs-var">excl_mods</span></a></span></span><span> </span><span id="local-6989586621682088177"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088177"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span>
</span><span id="line-1543"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1544"></span><span>       </span><span id="local-6989586621682088178"><span class="annot"><span class="annottext">[Either (UnitId, DriverMessages) ModSummary]
</span><a href="#local-6989586621682088178"><span class="hs-identifier hs-var">rootSummaries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Target -&gt; IO (Either (UnitId, DriverMessages) ModSummary))
-&gt; [Target] -&gt; IO [Either (UnitId, DriverMessages) ModSummary]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Target -&gt; IO (Either (UnitId, DriverMessages) ModSummary)
</span><a href="#local-6989586621682088179"><span class="hs-identifier hs-var">getRootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621682088180"><span class="hs-identifier hs-var">roots</span></a></span><span>
</span><span id="line-1545"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088181"><span class="annot"><span class="annottext">[(UnitId, DriverMessages)]
</span><a href="#local-6989586621682088181"><span class="hs-identifier hs-var">root_errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088182"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088182"><span class="hs-identifier hs-var">rootSummariesOk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (UnitId, DriverMessages) ModSummary]
-&gt; ([(UnitId, DriverMessages)], [ModSummary])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/Data.Either.html#partitionEithers/Data.Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (UnitId, DriverMessages) ModSummary]
</span><a href="#local-6989586621682088178"><span class="hs-identifier hs-var">rootSummaries</span></a></span><span> </span><span class="hs-comment">-- #17549</span><span>
</span><span id="line-1546"></span><span>           </span><span id="local-6989586621682088183"><span class="annot"><span class="annottext">root_map :: DownsweepCache
</span><a href="#local-6989586621682088183"><span class="hs-identifier hs-var hs-var">root_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; DownsweepCache
</span><a href="GHC.Driver.Make.html#mkRootMap"><span class="hs-identifier hs-var">mkRootMap</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088182"><span class="hs-identifier hs-var">rootSummariesOk</span></a></span><span>
</span><span id="line-1547"></span><span>       </span><span class="annot"><span class="annottext">DownsweepCache -&gt; IO ()
</span><a href="#local-6989586621682088185"><span class="hs-identifier hs-var">checkDuplicates</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088183"><span class="hs-identifier hs-var">root_map</span></a></span><span>
</span><span id="line-1548"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682088186"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088186"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088187"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088187"><span class="hs-identifier hs-var">map0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
-&gt; (Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO (Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088188"><span class="hs-identifier hs-var">loopSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088182"><span class="hs-identifier hs-var">rootSummariesOk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088183"><span class="hs-identifier hs-var">root_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1549"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088189"><span class="annot"><span class="annottext">closure_errs :: [DriverMessages]
</span><a href="#local-6989586621682088189"><span class="hs-identifier hs-var hs-var">closure_errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; [DriverMessages]
</span><a href="GHC.Driver.Make.html#checkHomeUnitsClosed"><span class="hs-identifier hs-var">checkHomeUnitsClosed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088190"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621682088190"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1551"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088191"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621682088191"><span class="hs-identifier hs-var hs-var">tmpfs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span>    </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088193"><span class="annot"><span class="annottext">downsweep_errs :: [DriverMessages]
</span><a href="#local-6989586621682088193"><span class="hs-identifier hs-var hs-var">downsweep_errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either DriverMessages ModSummary] -&gt; [DriverMessages]
forall a b. [Either a b] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Either.html#lefts/Data.Either.html#lefts"><span class="hs-identifier hs-var">lefts</span></a></span><span> </span><span class="annot"><span class="annottext">([Either DriverMessages ModSummary] -&gt; [DriverMessages])
-&gt; [Either DriverMessages ModSummary] -&gt; [DriverMessages]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[[Either DriverMessages ModSummary]]
-&gt; [Either DriverMessages ModSummary]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[Either DriverMessages ModSummary]]
 -&gt; [Either DriverMessages ModSummary])
-&gt; [[Either DriverMessages ModSummary]]
-&gt; [Either DriverMessages ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache -&gt; [[Either DriverMessages ModSummary]]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088187"><span class="hs-identifier hs-var">map0</span></a></span><span>
</span><span id="line-1554"></span><span>           </span><span id="local-6989586621682088194"><span class="annot"><span class="annottext">downsweep_nodes :: [ModuleGraphNode]
</span><a href="#local-6989586621682088194"><span class="hs-identifier hs-var hs-var">downsweep_nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode -&gt; [ModuleGraphNode]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088186"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1555"></span><span>
</span><span id="line-1556"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621682088195"><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088195"><span class="hs-identifier hs-var">other_errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088196"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088196"><span class="hs-identifier hs-var">unit_nodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either DriverMessages ModuleGraphNode]
-&gt; ([DriverMessages], [ModuleGraphNode])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/Data.Either.html#partitionEithers/Data.Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">([Either DriverMessages ModuleGraphNode]
 -&gt; ([DriverMessages], [ModuleGraphNode]))
-&gt; [Either DriverMessages ModuleGraphNode]
-&gt; ([DriverMessages], [ModuleGraphNode])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([Either DriverMessages ModuleGraphNode]
 -&gt; UnitId
 -&gt; HomeUnitEnv
 -&gt; [Either DriverMessages ModuleGraphNode])
-&gt; [Either DriverMessages ModuleGraphNode]
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; [Either DriverMessages ModuleGraphNode]
forall b a. (b -&gt; UnitId -&gt; a -&gt; b) -&gt; b -&gt; UnitEnvGraph a -&gt; b
</span><a href="GHC.Unit.Env.html#unitEnv_foldWithKey"><span class="hs-identifier hs-var">unitEnv_foldWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682088197"><span class="annot"><span class="annottext">[Either DriverMessages ModuleGraphNode]
</span><a href="#local-6989586621682088197"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span id="local-6989586621682088198"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088198"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682088199"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682088199"><span class="hs-identifier hs-var">hue</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Either DriverMessages ModuleGraphNode]
</span><a href="#local-6989586621682088197"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">[Either DriverMessages ModuleGraphNode]
-&gt; [Either DriverMessages ModuleGraphNode]
-&gt; [Either DriverMessages ModuleGraphNode]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
-&gt; UnitId -&gt; HomeUnitEnv -&gt; [Either DriverMessages ModuleGraphNode]
</span><a href="#local-6989586621682088200"><span class="hs-identifier hs-var">unitModuleNodes</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088194"><span class="hs-identifier hs-var">downsweep_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088198"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682088199"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Driver.Env.html#hsc_HUG"><span class="hs-identifier hs-var">hsc_HUG</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1557"></span><span>           </span><span id="local-6989586621682088201"><span class="annot"><span class="annottext">all_nodes :: [ModuleGraphNode]
</span><a href="#local-6989586621682088201"><span class="hs-identifier hs-var hs-var">all_nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088194"><span class="hs-identifier hs-var">downsweep_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088196"><span class="hs-identifier hs-var">unit_nodes</span></a></span><span>
</span><span id="line-1558"></span><span>           </span><span id="local-6989586621682088202"><span class="annot"><span class="annottext">all_errs :: [DriverMessages]
</span><a href="#local-6989586621682088202"><span class="hs-identifier hs-var hs-var">all_errs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088203"><span class="hs-identifier hs-var">all_root_errs</span></a></span><span> </span><span class="annot"><span class="annottext">[DriverMessages] -&gt; [DriverMessages] -&gt; [DriverMessages]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>  </span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088193"><span class="hs-identifier hs-var">downsweep_errs</span></a></span><span> </span><span class="annot"><span class="annottext">[DriverMessages] -&gt; [DriverMessages] -&gt; [DriverMessages]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088195"><span class="hs-identifier hs-var">other_errs</span></a></span><span>
</span><span id="line-1559"></span><span>           </span><span id="local-6989586621682088203"><span class="annot"><span class="annottext">all_root_errs :: [DriverMessages]
</span><a href="#local-6989586621682088203"><span class="hs-identifier hs-var hs-var">all_root_errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088189"><span class="hs-identifier hs-var">closure_errs</span></a></span><span> </span><span class="annot"><span class="annottext">[DriverMessages] -&gt; [DriverMessages] -&gt; [DriverMessages]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, DriverMessages) -&gt; DriverMessages)
-&gt; [(UnitId, DriverMessages)] -&gt; [DriverMessages]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, DriverMessages) -&gt; DriverMessages
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, DriverMessages)]
</span><a href="#local-6989586621682088181"><span class="hs-identifier hs-var">root_errs</span></a></span><span>
</span><span id="line-1560"></span><span>
</span><span id="line-1561"></span><span>       </span><span class="hs-comment">-- if we have been passed -fno-code, we enable code generation</span><span>
</span><span id="line-1562"></span><span>       </span><span class="hs-comment">-- for dependencies of modules that have -XTemplateHaskell,</span><span>
</span><span id="line-1563"></span><span>       </span><span class="hs-comment">-- otherwise those modules will fail to compile.</span><span>
</span><span id="line-1564"></span><span>       </span><span class="hs-comment">-- See Note [-fno-code mode] #8025</span><span>
</span><span id="line-1565"></span><span>       </span><span id="local-6989586621682088204"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088204"><span class="hs-identifier hs-var">th_enabled_nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; UnitEnv -&gt; [ModuleGraphNode] -&gt; IO [ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#enableCodeGenForTH"><span class="hs-identifier hs-var">enableCodeGenForTH</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088206"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088191"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088190"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088201"><span class="hs-identifier hs-var">all_nodes</span></a></span><span>
</span><span id="line-1566"></span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[DriverMessages] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088203"><span class="hs-identifier hs-var">all_root_errs</span></a></span><span>
</span><span id="line-1567"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">([DriverMessages], [ModuleGraphNode])
-&gt; IO ([DriverMessages], [ModuleGraphNode])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088202"><span class="hs-identifier hs-var">all_errs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088204"><span class="hs-identifier hs-var">th_enabled_nodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([DriverMessages], [ModuleGraphNode])
-&gt; IO ([DriverMessages], [ModuleGraphNode])
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(([DriverMessages], [ModuleGraphNode])
 -&gt; IO ([DriverMessages], [ModuleGraphNode]))
-&gt; ([DriverMessages], [ModuleGraphNode])
-&gt; IO ([DriverMessages], [ModuleGraphNode])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DriverMessages]
</span><a href="#local-6989586621682088203"><span class="hs-identifier hs-var">all_root_errs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1569"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-1570"></span><span>        </span><span class="hs-comment">-- Dependencies arising on a unit (backpack and module linking deps)</span><span>
</span><span id="line-1571"></span><span>        </span><span class="annot"><a href="#local-6989586621682088200"><span class="hs-identifier hs-type">unitModuleNodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitEnv"><span class="hs-identifier hs-type">HomeUnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessage"><span class="hs-identifier hs-type">DriverMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1572"></span><span>        </span><span id="local-6989586621682088200"><span class="annot"><span class="annottext">unitModuleNodes :: [ModuleGraphNode]
-&gt; UnitId -&gt; HomeUnitEnv -&gt; [Either DriverMessages ModuleGraphNode]
</span><a href="#local-6989586621682088200"><span class="hs-identifier hs-var hs-var">unitModuleNodes</span></a></span></span><span> </span><span id="local-6989586621682088207"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088207"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span id="local-6989586621682088208"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088208"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682088209"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682088209"><span class="hs-identifier hs-var">hue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1573"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088210"><span class="annot"><span class="annottext">instantiation_nodes :: [ModuleGraphNode]
</span><a href="#local-6989586621682088210"><span class="hs-identifier hs-var hs-var">instantiation_nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitState -&gt; [ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#instantiationNodes"><span class="hs-identifier hs-var">instantiationNodes</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088208"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#homeUnitEnv_units"><span class="hs-identifier hs-var">homeUnitEnv_units</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682088209"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1574"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; Either DriverMessages ModuleGraphNode)
-&gt; [ModuleGraphNode] -&gt; [Either DriverMessages ModuleGraphNode]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; Either DriverMessages ModuleGraphNode
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088210"><span class="hs-identifier hs-var">instantiation_nodes</span></a></span><span>
</span><span id="line-1575"></span><span>              </span><span class="annot"><span class="annottext">[Either DriverMessages ModuleGraphNode]
-&gt; [Either DriverMessages ModuleGraphNode]
-&gt; [Either DriverMessages ModuleGraphNode]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either DriverMessages ModuleGraphNode)
-&gt; [Either DriverMessages ModuleGraphNode]
forall a. Maybe a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybeToList/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode]
-&gt; UnitId
-&gt; HomeUnitEnv
-&gt; Maybe (Either DriverMessages ModuleGraphNode)
</span><a href="GHC.Driver.Make.html#linkNodes"><span class="hs-identifier hs-var">linkNodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088210"><span class="hs-identifier hs-var">instantiation_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [ModuleGraphNode] -&gt; [ModuleGraphNode]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088207"><span class="hs-identifier hs-var">summaries</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088208"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682088209"><span class="hs-identifier hs-var">hue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span>        </span><span id="local-6989586621682088212"><span class="annot"><span class="annottext">calcDeps :: ModSummary
-&gt; [(UnitId, PkgQual,
     GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088212"><span class="hs-identifier hs-var hs-var">calcDeps</span></a></span></span><span> </span><span id="local-6989586621682088213"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088213"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1578"></span><span>          </span><span class="hs-comment">-- Add a dependency on the HsBoot file if it exists</span><span>
</span><span id="line-1579"></span><span>          </span><span class="hs-comment">-- This gets passed to the loopImports function which just ignores it if it</span><span>
</span><span id="line-1580"></span><span>          </span><span class="hs-comment">-- can't be found.</span><span>
</span><span id="line-1581"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088213"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
-&gt; IsBootInterface -&gt; GenWithIsBoot (GenLocated SrcSpan ModuleName)
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; GenLocated SrcSpan ModuleName
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; GenLocated SrcSpan ModuleName)
-&gt; ModuleName -&gt; GenLocated SrcSpan ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088213"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Unit.Module.ModSummary.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088213"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; [(UnitId, PkgQual,
     GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; [(UnitId, PkgQual,
     GenWithIsBoot (GenLocated SrcSpan ModuleName))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1582"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088213"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682088215"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682088216"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088215"><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682088215"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088216"><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682088216"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary
-&gt; [(PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="GHC.Unit.Module.ModSummary.html#msDeps"><span class="hs-identifier hs-var">msDeps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088213"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1583"></span><span>
</span><span id="line-1584"></span><span>        </span><span id="local-6989586621682088206"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682088206"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1585"></span><span>        </span><span id="local-6989586621682088180"><span class="annot"><span class="annottext">roots :: [Target]
</span><a href="#local-6989586621682088180"><span class="hs-identifier hs-var hs-var">roots</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Target]
</span><a href="GHC.Driver.Env.Types.html#hsc_targets"><span class="hs-identifier hs-var">hsc_targets</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1586"></span><span>
</span><span id="line-1587"></span><span>        </span><span class="hs-comment">-- A cache from file paths to the already summarised modules. The same file</span><span>
</span><span id="line-1588"></span><span>        </span><span class="hs-comment">-- can be used in multiple units so the map is also keyed by which unit the</span><span>
</span><span id="line-1589"></span><span>        </span><span class="hs-comment">-- file was used in.</span><span>
</span><span id="line-1590"></span><span>        </span><span class="hs-comment">-- Reuse these if we can because the most expensive part of downsweep is</span><span>
</span><span id="line-1591"></span><span>        </span><span class="hs-comment">-- reading the headers.</span><span>
</span><span id="line-1592"></span><span>        </span><span class="annot"><a href="#local-6989586621682088218"><span class="hs-identifier hs-type">old_summary_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1593"></span><span>        </span><span id="local-6989586621682088218"><span class="annot"><span class="annottext">old_summary_map :: Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088218"><span class="hs-identifier hs-var hs-var">old_summary_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((UnitId, FilePath), ModSummary)]
-&gt; Map (UnitId, FilePath) ModSummary
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#fromList/Data.Map.Strict.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088219"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; FilePath
</span><a href="GHC.Unit.Module.ModSummary.html#msHsFilePath"><span class="hs-identifier hs-var">msHsFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088219"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088219"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682088219"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088219"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088175"><span class="hs-identifier hs-var">old_summaries</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1594"></span><span>
</span><span id="line-1595"></span><span>        </span><span class="annot"><a href="#local-6989586621682088179"><span class="hs-identifier hs-type">getRootSummary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Target.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span>        </span><span id="local-6989586621682088179"><span class="annot"><span class="annottext">getRootSummary :: Target -&gt; IO (Either (UnitId, DriverMessages) ModSummary)
</span><a href="#local-6989586621682088179"><span class="hs-identifier hs-var hs-var">getRootSummary</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Target.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">targetId :: Target -&gt; TargetId
</span><a href="GHC.Types.Target.html#targetId"><span class="hs-identifier hs-var">targetId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Target.html#TargetFile"><span class="hs-identifier hs-type">TargetFile</span></a></span><span> </span><span id="local-6989586621682088221"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088221"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621682088222"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621682088222"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span>
</span><span id="line-1597"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">targetContents :: Target -&gt; Maybe (InputFileBuffer, UTCTime)
</span><a href="GHC.Types.Target.html#targetContents"><span class="hs-identifier hs-var">targetContents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088224"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088224"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span>
</span><span id="line-1598"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">targetUnitId :: Target -&gt; UnitId
</span><a href="GHC.Types.Target.html#targetUnitId"><span class="hs-identifier hs-var">targetUnitId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088225"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088225"><span class="hs-identifier hs-var">uid</span></a></span></span><span>
</span><span id="line-1599"></span><span>                              </span><span class="hs-special">}</span><span>
</span><span id="line-1600"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088226"><span class="annot"><span class="annottext">offset_file :: FilePath
</span><a href="#local-6989586621682088226"><span class="hs-identifier hs-var hs-var">offset_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath -&gt; FilePath
</span><a href="GHC.Driver.Session.html#augmentByWorkingDirectory"><span class="hs-identifier hs-var">augmentByWorkingDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088227"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088221"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-1601"></span><span>                </span><span id="local-6989586621682088228"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088228"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; IO Bool
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; IO Bool) -&gt; IO Bool -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#doesFileExist/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088226"><span class="hs-identifier hs-var">offset_file</span></a></span><span>
</span><span id="line-1602"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088228"><span class="hs-identifier hs-var">exists</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088224"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-1603"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(DriverMessages -&gt; (UnitId, DriverMessages))
-&gt; Either DriverMessages ModSummary
-&gt; Either (UnitId, DriverMessages) ModSummary
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../base-4.18.2.1/src/Data.Bifunctor.html#first/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088225"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either DriverMessages ModSummary
 -&gt; Either (UnitId, DriverMessages) ModSummary)
-&gt; IO (Either DriverMessages ModSummary)
-&gt; IO (Either (UnitId, DriverMessages) ModSummary)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-1604"></span><span>                        </span><span class="annot"><span class="annottext">HscEnv
-&gt; HomeUnit
-&gt; Map (UnitId, FilePath) ModSummary
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="GHC.Driver.Make.html#summariseFile"><span class="hs-identifier hs-var">summariseFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088230"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088218"><span class="hs-identifier hs-var">old_summary_map</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088226"><span class="hs-identifier hs-var">offset_file</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621682088222"><span class="hs-identifier hs-var">mb_phase</span></a></span><span>
</span><span id="line-1605"></span><span>                                       </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088224"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-1606"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either (UnitId, DriverMessages) ModSummary
-&gt; IO (Either (UnitId, DriverMessages) ModSummary)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (UnitId, DriverMessages) ModSummary
 -&gt; IO (Either (UnitId, DriverMessages) ModSummary))
-&gt; Either (UnitId, DriverMessages) ModSummary
-&gt; IO (Either (UnitId, DriverMessages) ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, DriverMessages)
-&gt; Either (UnitId, DriverMessages) ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, DriverMessages)
 -&gt; Either (UnitId, DriverMessages) ModSummary)
-&gt; (UnitId, DriverMessages)
-&gt; Either (UnitId, DriverMessages) ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088225"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DriverMessages -&gt; (UnitId, DriverMessages))
-&gt; DriverMessages -&gt; (UnitId, DriverMessages)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span>
</span><span id="line-1607"></span><span>                                </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverFileNotFound"><span class="hs-identifier hs-var">DriverFileNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088226"><span class="hs-identifier hs-var">offset_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1608"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-1609"></span><span>              </span><span id="local-6989586621682088227"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682088227"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#homeUnitEnv_dflags"><span class="hs-identifier hs-var">homeUnitEnv_dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitId -&gt; UnitEnv -&gt; HomeUnitEnv
UnitId -&gt; UnitEnv -&gt; HomeUnitEnv
</span><a href="GHC.Unit.Env.html#ue_findHomeUnitEnv"><span class="hs-identifier hs-var">ue_findHomeUnitEnv</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088225"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1610"></span><span>              </span><span id="local-6989586621682088230"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621682088230"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitEnv -&gt; HomeUnit
</span><a href="GHC.Unit.Env.html#ue_unitHomeUnit"><span class="hs-identifier hs-var">ue_unitHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088225"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1611"></span><span>        </span><span class="annot"><a href="#local-6989586621682088179"><span class="hs-identifier hs-var">getRootSummary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Target.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">targetId :: Target -&gt; TargetId
</span><a href="GHC.Types.Target.html#targetId"><span class="hs-identifier hs-var">targetId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Target.html#TargetModule"><span class="hs-identifier hs-type">TargetModule</span></a></span><span> </span><span id="local-6989586621682088234"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088234"><span class="hs-identifier hs-var">modl</span></a></span></span><span>
</span><span id="line-1612"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">targetContents :: Target -&gt; Maybe (InputFileBuffer, UTCTime)
</span><a href="GHC.Types.Target.html#targetContents"><span class="hs-identifier hs-var">targetContents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088235"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088235"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span>
</span><span id="line-1613"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">targetUnitId :: Target -&gt; UnitId
</span><a href="GHC.Types.Target.html#targetUnitId"><span class="hs-identifier hs-var">targetUnitId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088236"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088236"><span class="hs-identifier hs-var">uid</span></a></span></span><span>
</span><span id="line-1614"></span><span>                              </span><span class="hs-special">}</span><span>
</span><span id="line-1615"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682088237"><span class="annot"><span class="annottext">SummariseResult
</span><a href="#local-6989586621682088237"><span class="hs-identifier hs-var">maybe_summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; HomeUnit
-&gt; Map (UnitId, FilePath) ModSummary
-&gt; IsBootInterface
-&gt; GenLocated SrcSpan ModuleName
-&gt; PkgQual
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; [ModuleName]
-&gt; IO SummariseResult
</span><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-var">summariseModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088238"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088218"><span class="hs-identifier hs-var">old_summary_map</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-1616"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; ModuleName -&gt; GenLocated SrcSpan ModuleName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088239"><span class="hs-identifier hs-var">rootLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088234"><span class="hs-identifier hs-var">modl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; PkgQual
</span><a href="GHC.Types.PkgQual.html#ThisPkg"><span class="hs-identifier hs-var">ThisPkg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; UnitId
forall u. GenHomeUnit u -&gt; UnitId
</span><a href="GHC.Unit.Home.html#homeUnitId"><span class="hs-identifier hs-var">homeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088238"><span class="hs-identifier hs-var">home_unit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1617"></span><span>                                           </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088235"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088176"><span class="hs-identifier hs-var">excl_mods</span></a></span><span>
</span><span id="line-1618"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SummariseResult
</span><a href="#local-6989586621682088237"><span class="hs-identifier hs-var">maybe_summary</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1619"></span><span>                   </span><span class="annot"><a href="GHC.Driver.Make.html#FoundHome"><span class="hs-identifier hs-type">FoundHome</span></a></span><span> </span><span id="local-6989586621682088243"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088243"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (UnitId, DriverMessages) ModSummary
-&gt; IO (Either (UnitId, DriverMessages) ModSummary)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Either (UnitId, DriverMessages) ModSummary
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088243"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1620"></span><span>                   </span><span class="annot"><a href="GHC.Driver.Make.html#FoundHomeWithError"><span class="hs-identifier hs-type">FoundHomeWithError</span></a></span><span> </span><span id="local-6989586621682088245"><span class="annot"><span class="annottext">(UnitId, DriverMessages)
</span><a href="#local-6989586621682088245"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (UnitId, DriverMessages) ModSummary
-&gt; IO (Either (UnitId, DriverMessages) ModSummary)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId, DriverMessages)
-&gt; Either (UnitId, DriverMessages) ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, DriverMessages)
</span><a href="#local-6989586621682088245"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1621"></span><span>                   </span><span class="annot"><span class="annottext">SummariseResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (UnitId, DriverMessages) ModSummary
-&gt; IO (Either (UnitId, DriverMessages) ModSummary)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (UnitId, DriverMessages) ModSummary
 -&gt; IO (Either (UnitId, DriverMessages) ModSummary))
-&gt; Either (UnitId, DriverMessages) ModSummary
-&gt; IO (Either (UnitId, DriverMessages) ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, DriverMessages)
-&gt; Either (UnitId, DriverMessages) ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, DriverMessages)
 -&gt; Either (UnitId, DriverMessages) ModSummary)
-&gt; (UnitId, DriverMessages)
-&gt; Either (UnitId, DriverMessages) ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088236"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; DriverMessages
</span><a href="GHC.Driver.Make.html#moduleNotFoundErr"><span class="hs-identifier hs-var">moduleNotFoundErr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088234"><span class="hs-identifier hs-var">modl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-1623"></span><span>              </span><span id="local-6989586621682088238"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621682088238"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitEnv -&gt; HomeUnit
</span><a href="GHC.Unit.Env.html#ue_unitHomeUnit"><span class="hs-identifier hs-var">ue_unitHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088236"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1624"></span><span>        </span><span id="local-6989586621682088239"><span class="annot"><span class="annottext">rootLoc :: SrcSpan
</span><a href="#local-6989586621682088239"><span class="hs-identifier hs-var hs-var">rootLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#mkGeneralSrcSpan"><span class="hs-identifier hs-var">mkGeneralSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&lt;command line&gt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span>        </span><span class="hs-comment">-- In a root module, the filename is allowed to diverge from the module</span><span>
</span><span id="line-1627"></span><span>        </span><span class="hs-comment">-- name, so we have to check that there aren't multiple root files</span><span>
</span><span id="line-1628"></span><span>        </span><span class="hs-comment">-- defining the same module (otherwise the duplicates will be silently</span><span>
</span><span id="line-1629"></span><span>        </span><span class="hs-comment">-- ignored, leading to confusing behaviour).</span><span>
</span><span id="line-1630"></span><span>        </span><span class="annot"><a href="#local-6989586621682088185"><span class="hs-identifier hs-type">checkDuplicates</span></a></span><span>
</span><span id="line-1631"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#DownsweepCache"><span class="hs-identifier hs-type">DownsweepCache</span></a></span><span>
</span><span id="line-1632"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1633"></span><span>        </span><span id="local-6989586621682088185"><span class="annot"><span class="annottext">checkDuplicates :: DownsweepCache -&gt; IO ()
</span><a href="#local-6989586621682088185"><span class="hs-identifier hs-var hs-var">checkDuplicates</span></a></span></span><span> </span><span id="local-6989586621682088249"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088249"><span class="hs-identifier hs-var">root_map</span></a></span></span><span>
</span><span id="line-1634"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088177"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1635"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[[ModSummary]] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[[ModSummary]]
</span><a href="#local-6989586621682088250"><span class="hs-identifier hs-var">dup_roots</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1636"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-var">multiRootsErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[ModSummary]] -&gt; [ModSummary]
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[[ModSummary]]
</span><a href="#local-6989586621682088250"><span class="hs-identifier hs-var">dup_roots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-1638"></span><span>             </span><span class="annot"><a href="#local-6989586621682088250"><span class="hs-identifier hs-type">dup_roots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Each at least of length 2</span><span>
</span><span id="line-1639"></span><span>             </span><span id="local-6989586621682088250"><span class="annot"><span class="annottext">dup_roots :: [[ModSummary]]
</span><a href="#local-6989586621682088250"><span class="hs-identifier hs-var hs-var">dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; Bool) -&gt; [[ModSummary]] -&gt; [[ModSummary]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">([[ModSummary]] -&gt; [[ModSummary]])
-&gt; [[ModSummary]] -&gt; [[ModSummary]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([Either DriverMessages ModSummary] -&gt; [ModSummary])
-&gt; [[Either DriverMessages ModSummary]] -&gt; [[ModSummary]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">[Either DriverMessages ModSummary] -&gt; [ModSummary]
forall a b. [Either a b] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Either.html#rights/Data.Either.html#rights"><span class="hs-identifier hs-var">rights</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DownsweepCache -&gt; [[Either DriverMessages ModSummary]]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#elems/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">M.elems</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088249"><span class="hs-identifier hs-var">root_map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1640"></span><span>
</span><span id="line-1641"></span><span>        </span><span class="hs-comment">-- This loops over all the mod summaries in the dependency graph, accumulates the actual dependencies for each module/unit</span><span>
</span><span id="line-1642"></span><span>        </span><span class="annot"><a href="#local-6989586621682088188"><span class="hs-identifier hs-type">loopSummaries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1643"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1644"></span><span>                    </span><span class="annot"><a href="GHC.Driver.Make.html#DownsweepCache"><span class="hs-identifier hs-type">DownsweepCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#DownsweepCache"><span class="hs-identifier hs-type">DownsweepCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1646"></span><span>        </span><span id="local-6989586621682088188"><span class="annot"><span class="annottext">loopSummaries :: [ModSummary]
-&gt; (Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO (Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088188"><span class="hs-identifier hs-var hs-var">loopSummaries</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682088254"><span class="annot"><span class="annottext">(Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088254"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO (Map NodeKey ModuleGraphNode, DownsweepCache)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088254"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-1647"></span><span>        </span><span class="annot"><a href="#local-6989586621682088188"><span class="hs-identifier hs-var">loopSummaries</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088255"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088255"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682088256"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088256"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088257"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088257"><span class="hs-identifier hs-var">done</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088258"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088258"><span class="hs-identifier hs-var">summarised</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Map NodeKey ModuleGraphNode -&gt; Maybe ModuleGraphNode
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682088259"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088257"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-1649"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
-&gt; (Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO (Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088188"><span class="hs-identifier hs-var">loopSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088256"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088257"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088258"><span class="hs-identifier hs-var">summarised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1650"></span><span>          </span><span class="hs-comment">-- Didn't work out what the imports mean yet, now do that.</span><span>
</span><span id="line-1651"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1652"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621682088260"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088260"><span class="hs-identifier hs-var">final_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088261"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088261"><span class="hs-identifier hs-var">done'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088262"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088262"><span class="hs-identifier hs-var">summarised'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary
-&gt; [(UnitId, PkgQual,
     GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088212"><span class="hs-identifier hs-var">calcDeps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088255"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088257"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088258"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1653"></span><span>             </span><span class="hs-comment">-- This has the effect of finding a .hs file if we are looking at the .hs-boot file.</span><span>
</span><span id="line-1654"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088264"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088264"><span class="hs-identifier hs-var">done''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088265"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088265"><span class="hs-identifier hs-var">summarised''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe
  (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
-&gt; [(UnitId, PkgQual,
     GenWithIsBoot (GenLocated SrcSpan ModuleName))]
forall a. Maybe a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybeToList/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
</span><a href="#local-6989586621682088266"><span class="hs-identifier hs-var">hs_file_for_boot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088261"><span class="hs-identifier hs-var">done'</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088262"><span class="hs-identifier hs-var">summarised'</span></a></span><span>
</span><span id="line-1655"></span><span>             </span><span class="annot"><span class="annottext">[ModSummary]
-&gt; (Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO (Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088188"><span class="hs-identifier hs-var">loopSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088256"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey
-&gt; ModuleGraphNode
-&gt; Map NodeKey ModuleGraphNode
-&gt; Map NodeKey ModuleGraphNode
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insert/Data.Map.Strict.Internal.html#insert"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682088259"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; ModSummary -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-var">ModuleNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088260"><span class="hs-identifier hs-var">final_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088255"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088264"><span class="hs-identifier hs-var">done''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088265"><span class="hs-identifier hs-var">summarised''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1656"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1657"></span><span>            </span><span id="local-6989586621682088259"><span class="annot"><span class="annottext">k :: NodeKey
</span><a href="#local-6989586621682088259"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088255"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span>
</span><span id="line-1659"></span><span>            </span><span id="local-6989586621682088266"><span class="annot"><span class="annottext">hs_file_for_boot :: Maybe
  (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
</span><a href="#local-6989586621682088266"><span class="hs-identifier hs-var hs-var">hs_file_for_boot</span></a></span></span><span>
</span><span id="line-1660"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088255"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
-&gt; Maybe
     (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
 -&gt; Maybe
      (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName)))
-&gt; (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
-&gt; Maybe
     (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088255"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
-&gt; IsBootInterface -&gt; GenWithIsBoot (GenLocated SrcSpan ModuleName)
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; GenLocated SrcSpan ModuleName
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; GenLocated SrcSpan ModuleName)
-&gt; ModuleName -&gt; GenLocated SrcSpan ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088255"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1661"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1662"></span><span>
</span><span id="line-1663"></span><span>
</span><span id="line-1664"></span><span>        </span><span class="hs-comment">-- This loops over each import in each summary. It is mutually recursive with loopSummaries if we discover</span><span>
</span><span id="line-1665"></span><span>        </span><span class="hs-comment">-- a new module by doing this.</span><span>
</span><span id="line-1666"></span><span>        </span><span class="annot"><a href="#local-6989586621682088263"><span class="hs-identifier hs-type">loopImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#GenWithIsBoot"><span class="hs-identifier hs-type">GenWithIsBoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1667"></span><span>                        </span><span class="hs-comment">-- Work list: process these modules</span><span>
</span><span id="line-1668"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span>
</span><span id="line-1669"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#DownsweepCache"><span class="hs-identifier hs-type">DownsweepCache</span></a></span><span>
</span><span id="line-1670"></span><span>                        </span><span class="hs-comment">-- Visited set; the range is a list because</span><span>
</span><span id="line-1671"></span><span>                        </span><span class="hs-comment">-- the roots can have the same module names</span><span>
</span><span id="line-1672"></span><span>                        </span><span class="hs-comment">-- if allow_dup_roots is True</span><span>
</span><span id="line-1673"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-1674"></span><span>                  </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#DownsweepCache"><span class="hs-identifier hs-type">DownsweepCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span>                        </span><span class="hs-comment">-- The result is the completed NodeMap</span><span>
</span><span id="line-1676"></span><span>        </span><span id="local-6989586621682088263"><span class="annot"><span class="annottext">loopImports :: [(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var hs-var">loopImports</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682088268"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088268"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span id="local-6989586621682088269"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088269"><span class="hs-identifier hs-var">summarised</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088268"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088269"><span class="hs-identifier hs-var">summarised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1677"></span><span>        </span><span class="annot"><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682088270"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088270"><span class="hs-identifier hs-var">home_uid</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682088271"><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682088271"><span class="hs-identifier hs-var">mb_pkg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088272"><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682088272"><span class="hs-identifier hs-var">gwib</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682088273"><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682088274"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span id="local-6989586621682088275"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span></span><span>
</span><span id="line-1678"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682088276"><span class="annot"><span class="annottext">[Either DriverMessages ModSummary]
</span><a href="#local-6989586621682088276"><span class="hs-identifier hs-var">summs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UnitId, PkgQual, ModuleNameWithIsBoot)
-&gt; DownsweepCache -&gt; Maybe [Either DriverMessages ModSummary]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, PkgQual, ModuleNameWithIsBoot)
</span><a href="#local-6989586621682088277"><span class="hs-identifier hs-var">cache_key</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1679"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either DriverMessages ModSummary]
</span><a href="#local-6989586621682088276"><span class="hs-identifier hs-var">summs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1680"></span><span>              </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682088278"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088278"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1681"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088279"><span class="annot"><span class="annottext">nk :: NodeKey
</span><a href="#local-6989586621682088279"><span class="hs-identifier hs-var hs-var">nk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088278"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1682"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682088280"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088280"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088281"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088281"><span class="hs-identifier hs-var">summarised'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088282"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088282"><span class="hs-identifier hs-var">done'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1683"></span><span>                </span><span class="annot"><span class="annottext">([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682088279"><span class="hs-identifier hs-var">nk</span></a></span><span class="annot"><span class="annottext">NodeKey -&gt; [NodeKey] -&gt; [NodeKey]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088280"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088281"><span class="hs-identifier hs-var">summarised'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088282"><span class="hs-identifier hs-var">done'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span>              </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682088283"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682088283"><span class="hs-identifier hs-var">_err</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1685"></span><span>                </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1686"></span><span>              </span><span id="local-6989586621682088284"><span class="annot"><span class="annottext">[Either DriverMessages ModSummary]
</span><a href="#local-6989586621682088284"><span class="hs-identifier hs-var">_errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-1687"></span><span>                </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1688"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1689"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1690"></span><span>               </span><span id="local-6989586621682088285"><span class="annot"><span class="annottext">SummariseResult
</span><a href="#local-6989586621682088285"><span class="hs-identifier hs-var">mb_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; HomeUnit
-&gt; Map (UnitId, FilePath) ModSummary
-&gt; IsBootInterface
-&gt; GenLocated SrcSpan ModuleName
-&gt; PkgQual
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; [ModuleName]
-&gt; IO SummariseResult
</span><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-var">summariseModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088286"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088218"><span class="hs-identifier hs-var">old_summary_map</span></a></span><span>
</span><span id="line-1691"></span><span>                                       </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682088287"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682088288"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682088271"><span class="hs-identifier hs-var">mb_pkg</span></a></span><span>
</span><span id="line-1692"></span><span>                                       </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088176"><span class="hs-identifier hs-var">excl_mods</span></a></span><span>
</span><span id="line-1693"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SummariseResult
</span><a href="#local-6989586621682088285"><span class="hs-identifier hs-var">mb_s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1694"></span><span>                   </span><span class="annot"><span class="annottext">SummariseResult
</span><a href="GHC.Driver.Make.html#NotThere"><span class="hs-identifier hs-var">NotThere</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1695"></span><span>                   </span><span class="annot"><a href="GHC.Driver.Make.html#External"><span class="hs-identifier hs-type">External</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1696"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621682088291"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088291"><span class="hs-identifier hs-var">other_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088292"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088292"><span class="hs-identifier hs-var">done'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088293"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088293"><span class="hs-identifier hs-var">summarised'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1697"></span><span>                    </span><span class="annot"><span class="annottext">([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088291"><span class="hs-identifier hs-var">other_deps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088292"><span class="hs-identifier hs-var">done'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088293"><span class="hs-identifier hs-var">summarised'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1698"></span><span>                   </span><span class="annot"><a href="GHC.Driver.Make.html#FoundInstantiation"><span class="hs-identifier hs-type">FoundInstantiation</span></a></span><span> </span><span id="local-6989586621682088295"><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088295"><span class="hs-identifier hs-var">iud</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1699"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621682088296"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088296"><span class="hs-identifier hs-var">other_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088297"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088297"><span class="hs-identifier hs-var">done'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088298"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088298"><span class="hs-identifier hs-var">summarised'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span>
</span><span id="line-1700"></span><span>                    </span><span class="annot"><span class="annottext">([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstantiatedUnit -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Unit"><span class="hs-identifier hs-var">NodeKey_Unit</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088295"><span class="hs-identifier hs-var">iud</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; [NodeKey] -&gt; [NodeKey]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088296"><span class="hs-identifier hs-var">other_deps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088297"><span class="hs-identifier hs-var">done'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088298"><span class="hs-identifier hs-var">summarised'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1701"></span><span>                   </span><span class="annot"><a href="GHC.Driver.Make.html#FoundHomeWithError"><span class="hs-identifier hs-type">FoundHomeWithError</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088300"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088300"><span class="hs-identifier hs-var">_uid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088301"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682088301"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId, PkgQual, ModuleNameWithIsBoot)
-&gt; [Either DriverMessages ModSummary]
-&gt; DownsweepCache
-&gt; DownsweepCache
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, PkgQual, ModuleNameWithIsBoot)
</span><a href="#local-6989586621682088277"><span class="hs-identifier hs-var">cache_key</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DriverMessages -&gt; Either DriverMessages ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682088301"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1702"></span><span>                   </span><span class="annot"><a href="GHC.Driver.Make.html#FoundHome"><span class="hs-identifier hs-type">FoundHome</span></a></span><span> </span><span id="local-6989586621682088302"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088302"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1703"></span><span>                     </span><span class="hs-special">(</span><span id="local-6989586621682088303"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088303"><span class="hs-identifier hs-var">done'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088304"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088304"><span class="hs-identifier hs-var">summarised'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1704"></span><span>                       </span><span class="annot"><span class="annottext">[ModSummary]
-&gt; (Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO (Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088188"><span class="hs-identifier hs-var">loopSummaries</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088302"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088274"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(UnitId, PkgQual, ModuleNameWithIsBoot)
-&gt; [Either DriverMessages ModSummary]
-&gt; DownsweepCache
-&gt; DownsweepCache
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#insert/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, PkgQual, ModuleNameWithIsBoot)
</span><a href="#local-6989586621682088277"><span class="hs-identifier hs-var">cache_key</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; Either DriverMessages ModSummary
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088302"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088275"><span class="hs-identifier hs-var">summarised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1705"></span><span>                     </span><span class="hs-special">(</span><span id="local-6989586621682088305"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088305"><span class="hs-identifier hs-var">other_deps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088306"><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088306"><span class="hs-identifier hs-var">final_done</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088307"><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088307"><span class="hs-identifier hs-var">final_summarised</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
-&gt; Map NodeKey ModuleGraphNode
-&gt; DownsweepCache
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
</span><a href="#local-6989586621682088263"><span class="hs-identifier hs-var">loopImports</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, PkgQual, GenWithIsBoot (GenLocated SrcSpan ModuleName))]
</span><a href="#local-6989586621682088273"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088303"><span class="hs-identifier hs-var">done'</span></a></span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088304"><span class="hs-identifier hs-var">summarised'</span></a></span><span>
</span><span id="line-1706"></span><span>
</span><span id="line-1707"></span><span>                     </span><span class="hs-comment">-- MP: This assumes that we can only instantiate non home units, which is probably fair enough for now.</span><span>
</span><span id="line-1708"></span><span>                     </span><span class="annot"><span class="annottext">([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
-&gt; IO ([NodeKey], Map NodeKey ModuleGraphNode, DownsweepCache)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModNodeKeyWithUid -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#NodeKey_Module"><span class="hs-identifier hs-var">NodeKey_Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModNodeKeyWithUid
</span><a href="GHC.Unit.Module.Graph.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088302"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; [NodeKey] -&gt; [NodeKey]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088305"><span class="hs-identifier hs-var">other_deps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map NodeKey ModuleGraphNode
</span><a href="#local-6989586621682088306"><span class="hs-identifier hs-var">final_done</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DownsweepCache
</span><a href="#local-6989586621682088307"><span class="hs-identifier hs-var">final_summarised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1709"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1710"></span><span>            </span><span id="local-6989586621682088277"><span class="annot"><span class="annottext">cache_key :: (UnitId, PkgQual, ModuleNameWithIsBoot)
</span><a href="#local-6989586621682088277"><span class="hs-identifier hs-var hs-var">cache_key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088270"><span class="hs-identifier hs-var">home_uid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682088271"><span class="hs-identifier hs-var">mb_pkg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName -&gt; ModuleName)
-&gt; GenWithIsBoot (GenLocated SrcSpan ModuleName)
-&gt; ModuleNameWithIsBoot
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682088272"><span class="hs-identifier hs-var">gwib</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1711"></span><span>            </span><span id="local-6989586621682088286"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621682088286"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitEnv -&gt; HomeUnit
</span><a href="GHC.Unit.Env.html#ue_unitHomeUnit"><span class="hs-identifier hs-var">ue_unitHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088270"><span class="hs-identifier hs-var">home_uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088174"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1712"></span><span>            </span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682088308"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088308"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682088309"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088309"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: forall mod. GenWithIsBoot mod -&gt; IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088287"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682088287"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682088272"><span class="hs-identifier hs-var">gwib</span></a></span><span>
</span><span id="line-1713"></span><span>            </span><span id="local-6989586621682088288"><span class="annot"><span class="annottext">wanted_mod :: GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682088288"><span class="hs-identifier hs-var hs-var">wanted_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; ModuleName -&gt; GenLocated SrcSpan ModuleName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088308"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088309"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1714"></span><span>
</span><span id="line-1715"></span><span class="hs-comment">-- | This function checks then important property that if both p and q are home units</span><span>
</span><span id="line-1716"></span><span class="hs-comment">-- then any dependency of p, which transitively depends on q is also a home unit.</span><span>
</span><span id="line-1717"></span><span class="hs-comment">--</span><span>
</span><span id="line-1718"></span><span class="hs-comment">-- See Note [Multiple Home Units], section 'Closure Property'.</span><span>
</span><span id="line-1719"></span><span class="annot"><a href="GHC.Driver.Make.html#checkHomeUnitsClosed"><span class="hs-identifier hs-type">checkHomeUnitsClosed</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1720"></span><span id="checkHomeUnitsClosed"><span class="annot"><span class="annottext">checkHomeUnitsClosed :: UnitEnv -&gt; [DriverMessages]
</span><a href="GHC.Driver.Make.html#checkHomeUnitsClosed"><span class="hs-identifier hs-var hs-var">checkHomeUnitsClosed</span></a></span></span><span> </span><span id="local-6989586621682088310"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088310"><span class="hs-identifier hs-var">ue</span></a></span></span><span>
</span><span id="line-1721"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#null/Data.Set.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088311"><span class="hs-identifier hs-var">bad_unit_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1722"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088312"><span class="hs-identifier hs-var">rootLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; MsgEnvelope DriverMessage)
-&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverHomePackagesNotClosed"><span class="hs-identifier hs-var">DriverHomePackagesNotClosed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088311"><span class="hs-identifier hs-var">bad_unit_ids</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1723"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1724"></span><span>    </span><span id="local-6989586621682088314"><span class="annot"><span class="annottext">home_id_set :: Set UnitId
</span><a href="#local-6989586621682088314"><span class="hs-identifier hs-var hs-var">home_id_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; Set UnitId
forall v. UnitEnvGraph v -&gt; Set UnitId
</span><a href="GHC.Unit.Env.html#unitEnv_keys"><span class="hs-identifier hs-var">unitEnv_keys</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv -&gt; Set UnitId)
-&gt; UnitEnvGraph HomeUnitEnv -&gt; Set UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Unit.Env.html#ue_home_unit_graph"><span class="hs-identifier hs-var">ue_home_unit_graph</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088310"><span class="hs-identifier hs-var">ue</span></a></span><span>
</span><span id="line-1725"></span><span>    </span><span id="local-6989586621682088311"><span class="annot"><span class="annottext">bad_unit_ids :: Set UnitId
</span><a href="#local-6989586621682088311"><span class="hs-identifier hs-var hs-var">bad_unit_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088316"><span class="hs-identifier hs-var">upwards_closure</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#%5C%5C/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088314"><span class="hs-identifier hs-var">home_id_set</span></a></span><span>
</span><span id="line-1726"></span><span>    </span><span id="local-6989586621682088312"><span class="annot"><span class="annottext">rootLoc :: SrcSpan
</span><a href="#local-6989586621682088312"><span class="hs-identifier hs-var hs-var">rootLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#mkGeneralSrcSpan"><span class="hs-identifier hs-var">mkGeneralSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&lt;command line&gt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1727"></span><span>
</span><span id="line-1728"></span><span>    </span><span class="annot"><a href="#local-6989586621682088318"><span class="hs-identifier hs-type">graph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1729"></span><span>    </span><span id="local-6989586621682088318"><span class="annot"><span class="annottext">graph :: Graph (Node UnitId UnitId)
</span><a href="#local-6989586621682088318"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Node UnitId UnitId] -&gt; Graph (Node UnitId UnitId)
forall key payload.
Uniquable key =&gt;
[Node key payload] -&gt; Graph (Node key payload)
</span><a href="GHC.Data.Graph.Directed.html#graphFromEdgedVerticesUniq"><span class="hs-identifier hs-var">graphFromEdgedVerticesUniq</span></a></span><span> </span><span class="annot"><span class="annottext">[Node UnitId UnitId]
</span><a href="#local-6989586621682088319"><span class="hs-identifier hs-var">graphNodes</span></a></span><span>
</span><span id="line-1730"></span><span>
</span><span id="line-1731"></span><span>    </span><span class="hs-comment">-- downwards closure of graph</span><span>
</span><span id="line-1732"></span><span>    </span><span id="local-6989586621682088322"><span class="annot"><span class="annottext">downwards_closure :: Graph (Node UnitId UnitId)
</span><a href="#local-6989586621682088322"><span class="hs-identifier hs-var hs-var">downwards_closure</span></a></span></span><span>
</span><span id="line-1733"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Node UnitId UnitId] -&gt; Graph (Node UnitId UnitId)
forall key payload.
Uniquable key =&gt;
[Node key payload] -&gt; Graph (Node key payload)
</span><a href="GHC.Data.Graph.Directed.html#graphFromEdgedVerticesUniq"><span class="hs-identifier hs-var">graphFromEdgedVerticesUniq</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; [UnitId] -&gt; Node UnitId UnitId
forall key payload. payload -&gt; key -&gt; [key] -&gt; Node key payload
</span><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088324"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088324"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088325"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1734"></span><span>                                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088324"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088324"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088325"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088325"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map UnitId (Set UnitId) -&gt; [(UnitId, Set UnitId)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph (Node UnitId UnitId)
-&gt; (Node UnitId UnitId -&gt; UnitId) -&gt; Map UnitId (Set UnitId)
forall key node.
Ord key =&gt;
Graph node -&gt; (node -&gt; key) -&gt; Map key (Set key)
</span><a href="GHC.Data.Graph.Directed.html#allReachable"><span class="hs-identifier hs-var">allReachable</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node UnitId UnitId)
</span><a href="#local-6989586621682088318"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">Node UnitId UnitId -&gt; UnitId
forall key payload. Node key payload -&gt; key
</span><a href="GHC.Data.Graph.Directed.html#node_key"><span class="hs-identifier hs-var">node_key</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1735"></span><span>
</span><span id="line-1736"></span><span>    </span><span id="local-6989586621682088328"><span class="annot"><span class="annottext">inverse_closure :: Graph (Node UnitId UnitId)
</span><a href="#local-6989586621682088328"><span class="hs-identifier hs-var hs-var">inverse_closure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Graph (Node UnitId UnitId) -&gt; Graph (Node UnitId UnitId)
forall node. Graph node -&gt; Graph node
</span><a href="GHC.Data.Graph.Directed.html#transposeG"><span class="hs-identifier hs-var">transposeG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node UnitId UnitId)
</span><a href="#local-6989586621682088322"><span class="hs-identifier hs-var">downwards_closure</span></a></span><span>
</span><span id="line-1737"></span><span>
</span><span id="line-1738"></span><span>    </span><span id="local-6989586621682088316"><span class="annot"><span class="annottext">upwards_closure :: Set UnitId
</span><a href="#local-6989586621682088316"><span class="hs-identifier hs-var hs-var">upwards_closure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId) -&gt; [UnitId] -&gt; Set UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Node UnitId UnitId -&gt; UnitId) -&gt; [Node UnitId UnitId] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Node UnitId UnitId -&gt; UnitId
forall key payload. Node key payload -&gt; key
</span><a href="GHC.Data.Graph.Directed.html#node_key"><span class="hs-identifier hs-var">node_key</span></a></span><span> </span><span class="annot"><span class="annottext">([Node UnitId UnitId] -&gt; [UnitId])
-&gt; [Node UnitId UnitId] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node UnitId UnitId)
-&gt; [Node UnitId UnitId] -&gt; [Node UnitId UnitId]
forall node. Graph node -&gt; [node] -&gt; [node]
</span><a href="GHC.Data.Graph.Directed.html#reachablesG"><span class="hs-identifier hs-var">reachablesG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node UnitId UnitId)
</span><a href="#local-6989586621682088328"><span class="hs-identifier hs-var">inverse_closure</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; [UnitId] -&gt; Node UnitId UnitId
forall key payload. payload -&gt; key -&gt; [key] -&gt; Node key payload
</span><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088331"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088331"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682088331"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088331"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088314"><span class="hs-identifier hs-var">home_id_set</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span>    </span><span class="annot"><a href="#local-6989586621682088332"><span class="hs-identifier hs-type">all_unit_direct_deps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html#UniqMap"><span class="hs-identifier hs-type">UniqMap</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1741"></span><span>    </span><span id="local-6989586621682088332"><span class="annot"><span class="annottext">all_unit_direct_deps :: UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088332"><span class="hs-identifier hs-var hs-var">all_unit_direct_deps</span></a></span></span><span>
</span><span id="line-1742"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqMap UnitId (Set UnitId)
 -&gt; UnitId -&gt; HomeUnitEnv -&gt; UniqMap UnitId (Set UnitId))
-&gt; UniqMap UnitId (Set UnitId)
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; UniqMap UnitId (Set UnitId)
forall b a. (b -&gt; UnitId -&gt; a -&gt; b) -&gt; b -&gt; UnitEnvGraph a -&gt; b
</span><a href="GHC.Unit.Env.html#unitEnv_foldWithKey"><span class="hs-identifier hs-var">unitEnv_foldWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId)
-&gt; UnitId -&gt; HomeUnitEnv -&gt; UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088333"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId)
forall k a. UniqMap k a
</span><a href="GHC.Types.Unique.Map.html#emptyUniqMap"><span class="hs-identifier hs-var">emptyUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv -&gt; UniqMap UnitId (Set UnitId))
-&gt; UnitEnvGraph HomeUnitEnv -&gt; UniqMap UnitId (Set UnitId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Unit.Env.html#ue_home_unit_graph"><span class="hs-identifier hs-var">ue_home_unit_graph</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088310"><span class="hs-identifier hs-var">ue</span></a></span><span>
</span><span id="line-1743"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1744"></span><span>        </span><span id="local-6989586621682088333"><span class="annot"><span class="annottext">go :: UniqMap UnitId (Set UnitId)
-&gt; UnitId -&gt; HomeUnitEnv -&gt; UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088333"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682088341"><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088341"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span id="local-6989586621682088342"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088342"><span class="hs-identifier hs-var">this</span></a></span></span><span> </span><span id="local-6989586621682088343"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682088343"><span class="hs-identifier hs-var">this_uis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1745"></span><span>           </span><span class="annot"><span class="annottext">(Set UnitId -&gt; Set UnitId -&gt; Set UnitId)
-&gt; UniqMap UnitId (Set UnitId)
-&gt; UniqMap UnitId (Set UnitId)
-&gt; UniqMap UnitId (Set UnitId)
forall a k.
(a -&gt; a -&gt; a) -&gt; UniqMap k a -&gt; UniqMap k a -&gt; UniqMap k a
</span><a href="GHC.Types.Unique.Map.html#plusUniqMap_C"><span class="hs-identifier hs-var">plusUniqMap_C</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#union/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span>
</span><span id="line-1746"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set UnitId -&gt; Set UnitId -&gt; Set UnitId)
-&gt; UniqMap UnitId (Set UnitId)
-&gt; UnitId
-&gt; Set UnitId
-&gt; UniqMap UnitId (Set UnitId)
forall k a.
Uniquable k =&gt;
(a -&gt; a -&gt; a) -&gt; UniqMap k a -&gt; k -&gt; a -&gt; UniqMap k a
</span><a href="GHC.Types.Unique.Map.html#addToUniqMap_C"><span class="hs-identifier hs-var">addToUniqMap_C</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#union/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088347"><span class="hs-identifier hs-var">external_depends</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088342"><span class="hs-identifier hs-var">this</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId) -&gt; [UnitId] -&gt; Set UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682088348"><span class="hs-identifier hs-var">this_deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1747"></span><span>             </span><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088341"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1748"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-1749"></span><span>             </span><span id="local-6989586621682088347"><span class="annot"><span class="annottext">external_depends :: UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088347"><span class="hs-identifier hs-var hs-var">external_depends</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Set UnitId)
-&gt; UniqMap UnitId UnitInfo -&gt; UniqMap UnitId (Set UnitId)
forall a b k. (a -&gt; b) -&gt; UniqMap k a -&gt; UniqMap k b
</span><a href="GHC.Types.Unique.Map.html#mapUniqMap"><span class="hs-identifier hs-var">mapUniqMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId)
-&gt; (UnitInfo -&gt; [UnitId]) -&gt; UnitInfo -&gt; Set UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; [UnitId]
forall srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo srcpkgid srcpkgname uid modulename mod -&gt; [uid]
</span><a href="../../ghc-boot-9.6.6/src/GHC.Unit.Database.html#unitDepends/GHC.Unit.Database.html#unitDepends"><span class="hs-identifier hs-var">unitDepends</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1750"></span><span>                              </span><span class="annot"><span class="annottext">(UniqMap UnitId UnitInfo -&gt; UniqMap UnitId (Set UnitId))
-&gt; UniqMap UnitId UnitInfo -&gt; UniqMap UnitId (Set UnitId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(UnitId, UnitInfo)] -&gt; UniqMap UnitId UnitInfo
forall k a. Uniquable k =&gt; [(k, a)] -&gt; UniqMap k a
</span><a href="GHC.Types.Unique.Map.html#listToUniqMap"><span class="hs-identifier hs-var">listToUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">([(UnitId, UnitInfo)] -&gt; UniqMap UnitId UnitInfo)
-&gt; [(UnitId, UnitInfo)] -&gt; UniqMap UnitId UnitInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map UnitId UnitInfo -&gt; [(UnitId, UnitInfo)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#toList/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span>
</span><span id="line-1751"></span><span>                              </span><span class="annot"><span class="annottext">(Map UnitId UnitInfo -&gt; [(UnitId, UnitInfo)])
-&gt; Map UnitId UnitInfo -&gt; [(UnitId, UnitInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; Map UnitId UnitInfo
</span><a href="GHC.Unit.State.html#unitInfoMap"><span class="hs-identifier hs-var">unitInfoMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682088353"><span class="hs-identifier hs-var">this_units</span></a></span><span>
</span><span id="line-1752"></span><span>             </span><span id="local-6989586621682088353"><span class="annot"><span class="annottext">this_units :: UnitState
</span><a href="#local-6989586621682088353"><span class="hs-identifier hs-var hs-var">this_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; UnitState
</span><a href="GHC.Unit.Env.html#homeUnitEnv_units"><span class="hs-identifier hs-var">homeUnitEnv_units</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682088343"><span class="hs-identifier hs-var">this_uis</span></a></span><span>
</span><span id="line-1753"></span><span>             </span><span id="local-6989586621682088348"><span class="annot"><span class="annottext">this_deps :: [UnitId]
</span><a href="#local-6989586621682088348"><span class="hs-identifier hs-var hs-var">this_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621682088354"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088354"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621682088354"><span class="hs-keyword hs-var">unit</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; [(GenUnit UnitId, Maybe PackageArg)]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var">explicitUnits</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621682088353"><span class="hs-identifier hs-var">this_units</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1754"></span><span>
</span><span id="line-1755"></span><span>    </span><span class="annot"><a href="#local-6989586621682088319"><span class="hs-identifier hs-type">graphNodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1756"></span><span>    </span><span id="local-6989586621682088319"><span class="annot"><span class="annottext">graphNodes :: [Node UnitId UnitId]
</span><a href="#local-6989586621682088319"><span class="hs-identifier hs-var hs-var">graphNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; [Node UnitId UnitId]
</span><a href="#local-6989586621682088355"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
forall a. Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#empty/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088314"><span class="hs-identifier hs-var">home_id_set</span></a></span><span>
</span><span id="line-1757"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1758"></span><span>        </span><span id="local-6989586621682088355"><span class="annot"><span class="annottext">go :: Set UnitId -&gt; Set UnitId -&gt; [Node UnitId UnitId]
</span><a href="#local-6989586621682088355"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682088371"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088371"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span id="local-6989586621682088372"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088372"><span class="hs-identifier hs-var">todo</span></a></span></span><span>
</span><span id="line-1759"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Maybe (UnitId, Set UnitId)
forall a. Set a -&gt; Maybe (a, Set a)
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#minView/Data.Set.Internal.html#minView"><span class="hs-identifier hs-var">Set.minView</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088372"><span class="hs-identifier hs-var">todo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1760"></span><span>              </span><span class="annot"><span class="annottext">Maybe (UnitId, Set UnitId)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1761"></span><span>              </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088374"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088374"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088375"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088375"><span class="hs-identifier hs-var">todo'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1762"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#member/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088374"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088371"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; [Node UnitId UnitId]
</span><a href="#local-6989586621682088355"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088371"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088375"><span class="hs-identifier hs-var">todo'</span></a></span><span>
</span><span id="line-1763"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId) -&gt; UnitId -&gt; Maybe (Set UnitId)
forall k a. Uniquable k =&gt; UniqMap k a -&gt; k -&gt; Maybe a
</span><a href="GHC.Types.Unique.Map.html#lookupUniqMap"><span class="hs-identifier hs-var">lookupUniqMap</span></a></span><span> </span><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088332"><span class="hs-identifier hs-var">all_unit_direct_deps</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088374"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1764"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Set UnitId)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; [Node UnitId UnitId]
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;uid not found&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId, UniqMap UnitId (Set UnitId)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088374"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqMap UnitId (Set UnitId)
</span><a href="#local-6989586621682088332"><span class="hs-identifier hs-var">all_unit_direct_deps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1765"></span><span>                    </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682088377"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088377"><span class="hs-identifier hs-var">depends</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1766"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088378"><span class="annot"><span class="annottext">todo'' :: Set UnitId
</span><a href="#local-6989586621682088378"><span class="hs-identifier hs-var hs-var">todo''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088377"><span class="hs-identifier hs-var">depends</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#%5C%5C/Data.Set.Internal.html#%5C%5C"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088371"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#union/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`Set.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088375"><span class="hs-identifier hs-var">todo'</span></a></span><span>
</span><span id="line-1767"></span><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; [UnitId] -&gt; Node UnitId UnitId
forall key payload. payload -&gt; key -&gt; [key] -&gt; Node key payload
</span><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088374"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088374"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set UnitId -&gt; [UnitId]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088377"><span class="hs-identifier hs-var">depends</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Node UnitId UnitId -&gt; [Node UnitId UnitId] -&gt; [Node UnitId UnitId]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; [Node UnitId UnitId]
</span><a href="#local-6989586621682088355"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#insert/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088374"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088371"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621682088378"><span class="hs-identifier hs-var">todo''</span></a></span><span>
</span><span id="line-1768"></span><span>
</span><span id="line-1769"></span><span class="hs-comment">-- | Update the every ModSummary that is depended on</span><span>
</span><span id="line-1770"></span><span class="hs-comment">-- by a module that needs template haskell. We enable codegen to</span><span>
</span><span id="line-1771"></span><span class="hs-comment">-- the specified target, disable optimization and change the .hi</span><span>
</span><span id="line-1772"></span><span class="hs-comment">-- and .o file locations to be temporary files.</span><span>
</span><span id="line-1773"></span><span class="hs-comment">-- See Note [-fno-code mode]</span><span>
</span><span id="line-1774"></span><span class="annot"><a href="GHC.Driver.Make.html#enableCodeGenForTH"><span class="hs-identifier hs-type">enableCodeGenForTH</span></a></span><span>
</span><span id="line-1775"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-1776"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-1777"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-1778"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1779"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1780"></span><span id="enableCodeGenForTH"><span class="annot"><span class="annottext">enableCodeGenForTH :: Logger
-&gt; TmpFs -&gt; UnitEnv -&gt; [ModuleGraphNode] -&gt; IO [ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#enableCodeGenForTH"><span class="hs-identifier hs-var hs-var">enableCodeGenForTH</span></a></span></span><span> </span><span id="local-6989586621682088380"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088380"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682088381"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088381"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682088382"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088382"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1781"></span><span>  </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs
-&gt; TempFileLifetime
-&gt; TempFileLifetime
-&gt; UnitEnv
-&gt; [ModuleGraphNode]
-&gt; IO [ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#enableCodeGenWhen"><span class="hs-identifier hs-var">enableCodeGenWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088380"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088381"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088382"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-1782"></span><span>
</span><span id="line-1783"></span><span>
</span><span id="line-1784"></span><span class="hs-keyword">data</span><span> </span><span id="CodeGenEnable"><span class="annot"><a href="GHC.Driver.Make.html#CodeGenEnable"><span class="hs-identifier hs-var">CodeGenEnable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EnableByteCode"><span class="annot"><a href="GHC.Driver.Make.html#EnableByteCode"><span class="hs-identifier hs-var">EnableByteCode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="EnableObject"><span class="annot"><a href="GHC.Driver.Make.html#EnableObject"><span class="hs-identifier hs-var">EnableObject</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="EnableByteCodeAndObject"><span class="annot"><a href="GHC.Driver.Make.html#EnableByteCodeAndObject"><span class="hs-identifier hs-var">EnableByteCodeAndObject</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088390"><span id="local-6989586621682088392"><span class="annot"><span class="annottext">CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
(CodeGenEnable -&gt; CodeGenEnable -&gt; Bool)
-&gt; (CodeGenEnable -&gt; CodeGenEnable -&gt; Bool) -&gt; Eq CodeGenEnable
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
== :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
$c/= :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
/= :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088397"><span id="local-6989586621682088399"><span id="local-6989586621682088403"><span class="annot"><span class="annottext">Int -&gt; CodeGenEnable -&gt; FilePath -&gt; FilePath
[CodeGenEnable] -&gt; FilePath -&gt; FilePath
CodeGenEnable -&gt; FilePath
(Int -&gt; CodeGenEnable -&gt; FilePath -&gt; FilePath)
-&gt; (CodeGenEnable -&gt; FilePath)
-&gt; ([CodeGenEnable] -&gt; FilePath -&gt; FilePath)
-&gt; Show CodeGenEnable
forall a.
(Int -&gt; a -&gt; FilePath -&gt; FilePath)
-&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; FilePath -&gt; FilePath) -&gt; Show a
$cshowsPrec :: Int -&gt; CodeGenEnable -&gt; FilePath -&gt; FilePath
showsPrec :: Int -&gt; CodeGenEnable -&gt; FilePath -&gt; FilePath
$cshow :: CodeGenEnable -&gt; FilePath
show :: CodeGenEnable -&gt; FilePath
$cshowList :: [CodeGenEnable] -&gt; FilePath -&gt; FilePath
showList :: [CodeGenEnable] -&gt; FilePath -&gt; FilePath
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#Show/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088408"><span id="local-6989586621682088410"><span id="local-6989586621682088412"><span id="local-6989586621682088416"><span id="local-6989586621682088419"><span id="local-6989586621682088422"><span id="local-6989586621682088425"><span class="annot"><span class="annottext">Eq CodeGenEnable
Eq CodeGenEnable =&gt;
(CodeGenEnable -&gt; CodeGenEnable -&gt; Ordering)
-&gt; (CodeGenEnable -&gt; CodeGenEnable -&gt; Bool)
-&gt; (CodeGenEnable -&gt; CodeGenEnable -&gt; Bool)
-&gt; (CodeGenEnable -&gt; CodeGenEnable -&gt; Bool)
-&gt; (CodeGenEnable -&gt; CodeGenEnable -&gt; Bool)
-&gt; (CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable)
-&gt; (CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable)
-&gt; Ord CodeGenEnable
CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
CodeGenEnable -&gt; CodeGenEnable -&gt; Ordering
CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: CodeGenEnable -&gt; CodeGenEnable -&gt; Ordering
compare :: CodeGenEnable -&gt; CodeGenEnable -&gt; Ordering
$c&lt; :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
&lt; :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
$c&lt;= :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
&lt;= :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
$c&gt; :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
&gt; :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
$c&gt;= :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
&gt;= :: CodeGenEnable -&gt; CodeGenEnable -&gt; Bool
$cmax :: CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable
max :: CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable
$cmin :: CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable
min :: CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-1785"></span><span>
</span><span id="line-1786"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#CodeGenEnable"><span class="hs-identifier hs-type">CodeGenEnable</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1787"></span><span>  </span><span id="local-6989586621682088432"><span class="annot"><span class="annottext">ppr :: CodeGenEnable -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; SDoc)
-&gt; (CodeGenEnable -&gt; FilePath) -&gt; CodeGenEnable -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CodeGenEnable -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span>
</span><span id="line-1788"></span><span>
</span><span id="line-1789"></span><span class="hs-comment">-- | Helper used to implement 'enableCodeGenForTH'.</span><span>
</span><span id="line-1790"></span><span class="hs-comment">-- In particular, this enables</span><span>
</span><span id="line-1791"></span><span class="hs-comment">-- unoptimized code generation for all modules that meet some</span><span>
</span><span id="line-1792"></span><span class="hs-comment">-- condition (first parameter), or are dependencies of those</span><span>
</span><span id="line-1793"></span><span class="hs-comment">-- modules. The second parameter is a condition to check before</span><span>
</span><span id="line-1794"></span><span class="hs-comment">-- marking modules for code generation.</span><span>
</span><span id="line-1795"></span><span class="annot"><a href="GHC.Driver.Make.html#enableCodeGenWhen"><span class="hs-identifier hs-type">enableCodeGenWhen</span></a></span><span>
</span><span id="line-1796"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-1797"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-1798"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span>
</span><span id="line-1799"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span>
</span><span id="line-1800"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-1801"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1802"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1803"></span><span id="enableCodeGenWhen"><span class="annot"><span class="annottext">enableCodeGenWhen :: Logger
-&gt; TmpFs
-&gt; TempFileLifetime
-&gt; TempFileLifetime
-&gt; UnitEnv
-&gt; [ModuleGraphNode]
-&gt; IO [ModuleGraphNode]
</span><a href="GHC.Driver.Make.html#enableCodeGenWhen"><span class="hs-identifier hs-var hs-var">enableCodeGenWhen</span></a></span></span><span> </span><span id="local-6989586621682088434"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088434"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682088435"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088435"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682088436"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621682088436"><span class="hs-identifier hs-var">staticLife</span></a></span></span><span> </span><span id="local-6989586621682088437"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621682088437"><span class="hs-identifier hs-var">dynLife</span></a></span></span><span> </span><span id="local-6989586621682088438"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088438"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682088439"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088439"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1804"></span><span>  </span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; IO ModuleGraphNode)
-&gt; [ModuleGraphNode] -&gt; IO [ModuleGraphNode]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; IO ModuleGraphNode
</span><a href="#local-6989586621682088440"><span class="hs-identifier hs-var">enable_code_gen</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088439"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-1805"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1806"></span><span>    </span><span id="local-6989586621682088441"><span class="annot"><span class="annottext">defaultBackendOf :: ModSummary -&gt; Backend
</span><a href="#local-6989586621682088441"><span class="hs-identifier hs-var hs-var">defaultBackendOf</span></a></span></span><span> </span><span id="local-6989586621682088442"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088442"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Backend
</span><a href="GHC.Driver.Backend.html#platformDefaultBackend"><span class="hs-identifier hs-var">platformDefaultBackend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Platform) -&gt; DynFlags -&gt; Platform
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitId -&gt; UnitEnv -&gt; DynFlags
UnitId -&gt; UnitEnv -&gt; DynFlags
</span><a href="GHC.Unit.Env.html#ue_unitFlags"><span class="hs-identifier hs-var">ue_unitFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088442"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088438"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1807"></span><span>    </span><span class="annot"><a href="#local-6989586621682088440"><span class="hs-identifier hs-type">enable_code_gen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span>
</span><span id="line-1808"></span><span>    </span><span id="local-6989586621682088440"><span class="annot"><span class="annottext">enable_code_gen :: ModuleGraphNode -&gt; IO ModuleGraphNode
</span><a href="#local-6989586621682088440"><span class="hs-identifier hs-var hs-var">enable_code_gen</span></a></span></span><span> </span><span id="local-6989586621682088445"><span class="annot"><span class="annottext">n :: ModuleGraphNode
</span><a href="#local-6989586621682088445"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span id="local-6989586621682088446"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088446"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682088447"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1809"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1810"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_location :: ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088448"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088448"><span class="hs-identifier hs-var">ms_location</span></a></span></span><span>
</span><span id="line-1811"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hsc_src :: ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>
</span><span id="line-1812"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088450"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1813"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1814"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682088451"><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088451"><span class="hs-identifier hs-var">enable_spec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088445"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Map NodeKey CodeGenEnable -&gt; Maybe CodeGenEnable
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-operator hs-var">`Map.lookup`</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey CodeGenEnable
</span><a href="#local-6989586621682088452"><span class="hs-identifier hs-var">needs_codegen_map</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1815"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621682088453"><span class="hs-identifier hs-var">nocode_enable</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1816"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088454"><span class="annot"><span class="annottext">new_temp_file :: FilePath -&gt; FilePath -&gt; IO (FilePath, FilePath)
</span><a href="#local-6989586621682088454"><span class="hs-identifier hs-var hs-var">new_temp_file</span></a></span></span><span> </span><span id="local-6989586621682088455"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088455"><span class="hs-identifier hs-var">suf</span></a></span></span><span> </span><span id="local-6989586621682088456"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088456"><span class="hs-identifier hs-var">dynsuf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1817"></span><span>                     </span><span id="local-6989586621682088457"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088457"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; FilePath -&gt; IO FilePath
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088434"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088435"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621682088436"><span class="hs-identifier hs-var">staticLife</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088455"><span class="hs-identifier hs-var">suf</span></a></span><span>
</span><span id="line-1818"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088460"><span class="annot"><span class="annottext">dyn_tn :: FilePath
</span><a href="#local-6989586621682088460"><span class="hs-identifier hs-var hs-var">dyn_tn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088457"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#-%3C.%3E/System.FilePath.Posix.html#-%3C.%3E"><span class="hs-operator hs-var">-&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088456"><span class="hs-identifier hs-var">dynsuf</span></a></span><span>
</span><span id="line-1819"></span><span>                     </span><span class="annot"><span class="annottext">TmpFs -&gt; TempFileLifetime -&gt; [FilePath] -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088435"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621682088437"><span class="hs-identifier hs-var">dynLife</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088460"><span class="hs-identifier hs-var">dyn_tn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1820"></span><span>                     </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088457"><span class="hs-identifier hs-var">tn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088460"><span class="hs-identifier hs-var">dyn_tn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1821"></span><span>                 </span><span class="hs-comment">-- We don't want to create .o or .hi files unless we have been asked</span><span>
</span><span id="line-1822"></span><span>                 </span><span class="hs-comment">-- to by the user. But we need them, so we patch their locations in</span><span>
</span><span id="line-1823"></span><span>                 </span><span class="hs-comment">-- the ModSummary with temporary files.</span><span>
</span><span id="line-1824"></span><span>                 </span><span class="hs-comment">--</span><span>
</span><span id="line-1825"></span><span>               </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682088463"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088463"><span class="hs-identifier hs-var">hi_file</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088464"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088464"><span class="hs-identifier hs-var">dyn_hi_file</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088465"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088465"><span class="hs-identifier hs-var">o_file</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088466"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088466"><span class="hs-identifier hs-var">dyn_o_file</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1826"></span><span>                 </span><span class="hs-comment">-- If ``-fwrite-interface` is specified, then the .o and .hi files</span><span>
</span><span id="line-1827"></span><span>                 </span><span class="hs-comment">-- are written into `-odir` and `-hidir` respectively.  #16670</span><span>
</span><span id="line-1828"></span><span>                 </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteInterface"><span class="hs-identifier hs-var">Opt_WriteInterface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1829"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">((FilePath, FilePath), (FilePath, FilePath))
-&gt; IO ((FilePath, FilePath), (FilePath, FilePath))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088448"><span class="hs-identifier hs-var">ms_location</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_hi_file"><span class="hs-identifier hs-var">ml_dyn_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088448"><span class="hs-identifier hs-var">ms_location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1830"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088448"><span class="hs-identifier hs-var">ms_location</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088448"><span class="hs-identifier hs-var">ms_location</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1831"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((FilePath, FilePath)
 -&gt; (FilePath, FilePath)
 -&gt; ((FilePath, FilePath), (FilePath, FilePath)))
-&gt; IO (FilePath, FilePath)
-&gt; IO
     ((FilePath, FilePath)
      -&gt; ((FilePath, FilePath), (FilePath, FilePath)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO (FilePath, FilePath)
</span><a href="#local-6989586621682088454"><span class="hs-identifier hs-var">new_temp_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#hiSuf_"><span class="hs-identifier hs-var">hiSuf_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#dynHiSuf_"><span class="hs-identifier hs-var">dynHiSuf_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1832"></span><span>                            </span><span class="annot"><span class="annottext">IO
  ((FilePath, FilePath)
   -&gt; ((FilePath, FilePath), (FilePath, FilePath)))
-&gt; IO (FilePath, FilePath)
-&gt; IO ((FilePath, FilePath), (FilePath, FilePath))
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO (FilePath, FilePath)
</span><a href="#local-6989586621682088454"><span class="hs-identifier hs-var">new_temp_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#objectSuf_"><span class="hs-identifier hs-var">objectSuf_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#dynObjectSuf_"><span class="hs-identifier hs-var">dynObjectSuf_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1833"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088476"><span class="annot"><span class="annottext">new_dflags :: DynFlags
</span><a href="#local-6989586621682088476"><span class="hs-identifier hs-var hs-var">new_dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088451"><span class="hs-identifier hs-var">enable_spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1834"></span><span>                                  </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCode"><span class="hs-identifier hs-var">EnableByteCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html#interpreterBackend"><span class="hs-identifier hs-type">interpreterBackend</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1835"></span><span>                                  </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableObject"><span class="hs-identifier hs-var">EnableObject</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088441"><span class="hs-identifier hs-type">defaultBackendOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088447"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1836"></span><span>                                  </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCodeAndObject"><span class="hs-identifier hs-var">EnableByteCodeAndObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#gopt_set"><span class="hs-identifier hs-var">gopt_set</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ByteCodeAndObjectCode"><span class="hs-identifier hs-var">Opt_ByteCodeAndObjectCode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088441"><span class="hs-identifier hs-type">defaultBackendOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088447"><span class="hs-identifier hs-type">ms</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1837"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088481"><span class="annot"><span class="annottext">ms' :: ModSummary
</span><a href="#local-6989586621682088481"><span class="hs-identifier hs-var hs-var">ms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1838"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1839"></span><span>                         </span><span class="annot"><a href="#local-6989586621682088448"><span class="hs-identifier hs-type">ms_location</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088463"><span class="hs-identifier hs-type">hi_file</span></a></span><span>
</span><span id="line-1840"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088465"><span class="hs-identifier hs-type">o_file</span></a></span><span>
</span><span id="line-1841"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_dyn_hi_file"><span class="hs-identifier hs-var">ml_dyn_hi_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088464"><span class="hs-identifier hs-type">dyn_hi_file</span></a></span><span>
</span><span id="line-1842"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088466"><span class="hs-identifier hs-type">dyn_o_file</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1843"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#updOptLevel"><span class="hs-identifier hs-type">updOptLevel</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088476"><span class="hs-identifier hs-type">new_dflags</span></a></span><span>
</span><span id="line-1844"></span><span>                     </span><span class="hs-special">}</span><span>
</span><span id="line-1845"></span><span>               </span><span class="hs-comment">-- Recursive call to catch the other cases</span><span>
</span><span id="line-1846"></span><span>               </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; IO ModuleGraphNode
</span><a href="#local-6989586621682088440"><span class="hs-identifier hs-var">enable_code_gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; ModSummary -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-var">ModuleNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088446"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088481"><span class="hs-identifier hs-var">ms'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1847"></span><span>
</span><span id="line-1848"></span><span>         </span><span class="hs-comment">-- If -fprefer-byte-code then satisfy dependency by enabling bytecode (if normal object not enough)</span><span>
</span><span id="line-1849"></span><span>         </span><span class="hs-comment">-- we only get to this case if the default backend is already generating object files, but we need dynamic</span><span>
</span><span id="line-1850"></span><span>         </span><span class="hs-comment">-- objects</span><span>
</span><span id="line-1851"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable -&gt; ModSummary -&gt; Bool
</span><a href="#local-6989586621682088483"><span class="hs-identifier hs-var">bytecode_and_enable</span></a></span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088451"><span class="hs-identifier hs-var">enable_spec</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1852"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088484"><span class="annot"><span class="annottext">ms' :: ModSummary
</span><a href="#local-6989586621682088484"><span class="hs-identifier hs-var hs-var">ms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1853"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#gopt_set"><span class="hs-identifier hs-type">gopt_set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088447"><span class="hs-identifier hs-type">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_ByteCodeAndObjectCode"><span class="hs-identifier hs-type">Opt_ByteCodeAndObjectCode</span></a></span><span>
</span><span id="line-1854"></span><span>                     </span><span class="hs-special">}</span><span>
</span><span id="line-1855"></span><span>               </span><span class="hs-comment">-- Recursive call to catch the other cases</span><span>
</span><span id="line-1856"></span><span>               </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; IO ModuleGraphNode
</span><a href="#local-6989586621682088440"><span class="hs-identifier hs-var">enable_code_gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; ModSummary -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-var">ModuleNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088446"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088484"><span class="hs-identifier hs-var">ms'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1857"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable -&gt; ModSummary -&gt; Bool
</span><a href="#local-6989586621682088485"><span class="hs-identifier hs-var">dynamic_too_enable</span></a></span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088451"><span class="hs-identifier hs-var">enable_spec</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1858"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088486"><span class="annot"><span class="annottext">ms' :: ModSummary
</span><a href="#local-6989586621682088486"><span class="hs-identifier hs-var hs-var">ms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1859"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#gopt_set"><span class="hs-identifier hs-type">gopt_set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088447"><span class="hs-identifier hs-type">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_BuildDynamicToo"><span class="hs-identifier hs-type">Opt_BuildDynamicToo</span></a></span><span>
</span><span id="line-1860"></span><span>                     </span><span class="hs-special">}</span><span>
</span><span id="line-1861"></span><span>               </span><span class="hs-comment">-- Recursive call to catch the other cases</span><span>
</span><span id="line-1862"></span><span>               </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; IO ModuleGraphNode
</span><a href="#local-6989586621682088440"><span class="hs-identifier hs-var">enable_code_gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; ModSummary -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-var">ModuleNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088446"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088486"><span class="hs-identifier hs-var">ms'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1863"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621682088488"><span class="hs-identifier hs-var">ext_interp_enable</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1864"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088489"><span class="annot"><span class="annottext">ms' :: ModSummary
</span><a href="#local-6989586621682088489"><span class="hs-identifier hs-var hs-var">ms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088447"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1865"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#gopt_set"><span class="hs-identifier hs-type">gopt_set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682088447"><span class="hs-identifier hs-type">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#Opt_ExternalInterpreter"><span class="hs-identifier hs-type">Opt_ExternalInterpreter</span></a></span><span>
</span><span id="line-1866"></span><span>                     </span><span class="hs-special">}</span><span>
</span><span id="line-1867"></span><span>               </span><span class="hs-comment">-- Recursive call to catch the other cases</span><span>
</span><span id="line-1868"></span><span>               </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; IO ModuleGraphNode
</span><a href="#local-6989586621682088440"><span class="hs-identifier hs-var">enable_code_gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; ModSummary -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-var">ModuleNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088446"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088489"><span class="hs-identifier hs-var">ms'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1869"></span><span>
</span><span id="line-1870"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; IO ModuleGraphNode
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088445"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1871"></span><span>
</span><span id="line-1872"></span><span>    </span><span class="annot"><a href="#local-6989586621682088440"><span class="hs-identifier hs-var">enable_code_gen</span></a></span><span> </span><span id="local-6989586621682088491"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088491"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; IO ModuleGraphNode
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088491"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1873"></span><span>
</span><span id="line-1874"></span><span>    </span><span id="local-6989586621682088453"><span class="annot"><span class="annottext">nocode_enable :: ModSummary -&gt; Bool
</span><a href="#local-6989586621682088453"><span class="hs-identifier hs-var hs-var">nocode_enable</span></a></span></span><span> </span><span id="local-6989586621682088492"><span class="annot"><span class="annottext">ms :: ModSummary
</span><a href="#local-6989586621682088492"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682088493"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088493"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1875"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCode"><span class="hs-identifier hs-var">backendGeneratesCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088493"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1876"></span><span>      </span><span class="hs-comment">-- Don't enable codegen for TH on indefinite packages; we</span><span>
</span><span id="line-1877"></span><span>      </span><span class="hs-comment">-- can't compile anything anyway! See #16219.</span><span>
</span><span id="line-1878"></span><span>      </span><span class="annot"><span class="annottext">HomeUnit -&gt; Bool
forall u. GenHomeUnit u -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeUnitDefinite"><span class="hs-identifier hs-var">isHomeUnitDefinite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitEnv -&gt; HomeUnit
</span><a href="GHC.Unit.Env.html#ue_unitHomeUnit"><span class="hs-identifier hs-var">ue_unitHomeUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088492"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682088438"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1879"></span><span>
</span><span id="line-1880"></span><span>    </span><span id="local-6989586621682088483"><span class="annot"><span class="annottext">bytecode_and_enable :: CodeGenEnable -&gt; ModSummary -&gt; Bool
</span><a href="#local-6989586621682088483"><span class="hs-identifier hs-var hs-var">bytecode_and_enable</span></a></span></span><span> </span><span id="local-6989586621682088496"><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088496"><span class="hs-identifier hs-var">enable_spec</span></a></span></span><span> </span><span id="local-6989586621682088497"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088497"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1881"></span><span>      </span><span class="hs-comment">-- In the situation where we **would** need to enable dynamic-too</span><span>
</span><span id="line-1882"></span><span>      </span><span class="hs-comment">-- IF we had decided we needed objects</span><span>
</span><span id="line-1883"></span><span>      </span><span class="annot"><span class="annottext">CodeGenEnable -&gt; ModSummary -&gt; Bool
</span><a href="#local-6989586621682088485"><span class="hs-identifier hs-var">dynamic_too_enable</span></a></span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableObject"><span class="hs-identifier hs-var">EnableObject</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088497"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1884"></span><span>        </span><span class="hs-comment">-- but we prefer to use bytecode rather than objects</span><span>
</span><span id="line-1885"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088498"><span class="hs-identifier hs-var">prefer_bytecode</span></a></span><span>
</span><span id="line-1886"></span><span>        </span><span class="hs-comment">-- and we haven't already turned it on</span><span>
</span><span id="line-1887"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088499"><span class="hs-identifier hs-var">generate_both</span></a></span><span>
</span><span id="line-1888"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1889"></span><span>        </span><span id="local-6989586621682088500"><span class="annot"><span class="annottext">lcl_dflags :: DynFlags
</span><a href="#local-6989586621682088500"><span class="hs-identifier hs-var hs-var">lcl_dflags</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088497"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1890"></span><span>        </span><span id="local-6989586621682088498"><span class="annot"><span class="annottext">prefer_bytecode :: Bool
</span><a href="#local-6989586621682088498"><span class="hs-identifier hs-var hs-var">prefer_bytecode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088496"><span class="hs-identifier hs-var">enable_spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1891"></span><span>                            </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCodeAndObject"><span class="hs-identifier hs-var">EnableByteCodeAndObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1892"></span><span>                            </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCode"><span class="hs-identifier hs-var">EnableByteCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1893"></span><span>                            </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableObject"><span class="hs-identifier hs-var">EnableObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1894"></span><span>
</span><span id="line-1895"></span><span>        </span><span id="local-6989586621682088499"><span class="annot"><span class="annottext">generate_both :: Bool
</span><a href="#local-6989586621682088499"><span class="hs-identifier hs-var hs-var">generate_both</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ByteCodeAndObjectCode"><span class="hs-identifier hs-var">Opt_ByteCodeAndObjectCode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088500"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span>    </span><span class="hs-comment">-- #8180 - when using TemplateHaskell, switch on -dynamic-too so</span><span>
</span><span id="line-1898"></span><span>    </span><span class="hs-comment">-- the linker can correctly load the object files.  This isn't necessary</span><span>
</span><span id="line-1899"></span><span>    </span><span class="hs-comment">-- when using -fexternal-interpreter.</span><span>
</span><span id="line-1900"></span><span>    </span><span id="local-6989586621682088485"><span class="annot"><span class="annottext">dynamic_too_enable :: CodeGenEnable -&gt; ModSummary -&gt; Bool
</span><a href="#local-6989586621682088485"><span class="hs-identifier hs-var hs-var">dynamic_too_enable</span></a></span></span><span> </span><span id="local-6989586621682088501"><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088501"><span class="hs-identifier hs-var">enable_spec</span></a></span></span><span> </span><span id="local-6989586621682088502"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088502"><span class="hs-identifier hs-var">ms</span></a></span></span><span>
</span><span id="line-1901"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Platform.Ways.html#hostIsDynamic"><span class="hs-identifier hs-var">hostIsDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088504"><span class="hs-identifier hs-var">internalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1902"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088505"><span class="hs-identifier hs-var">isDynWay</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088506"><span class="hs-identifier hs-var">isProfWay</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088507"><span class="hs-identifier hs-var">dyn_too_enabled</span></a></span><span>
</span><span id="line-1903"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088508"><span class="hs-identifier hs-var">enable_object</span></a></span><span>
</span><span id="line-1904"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1905"></span><span>       </span><span id="local-6989586621682088509"><span class="annot"><span class="annottext">lcl_dflags :: DynFlags
</span><a href="#local-6989586621682088509"><span class="hs-identifier hs-var hs-var">lcl_dflags</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088502"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1906"></span><span>       </span><span id="local-6989586621682088504"><span class="annot"><span class="annottext">internalInterpreter :: Bool
</span><a href="#local-6989586621682088504"><span class="hs-identifier hs-var hs-var">internalInterpreter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ExternalInterpreter"><span class="hs-identifier hs-var">Opt_ExternalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088509"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1907"></span><span>       </span><span id="local-6989586621682088507"><span class="annot"><span class="annottext">dyn_too_enabled :: Bool
</span><a href="#local-6989586621682088507"><span class="hs-identifier hs-var hs-var">dyn_too_enabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_BuildDynamicToo"><span class="hs-identifier hs-var">Opt_BuildDynamicToo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088509"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span>
</span><span id="line-1908"></span><span>       </span><span id="local-6989586621682088505"><span class="annot"><span class="annottext">isDynWay :: Bool
</span><a href="#local-6989586621682088505"><span class="hs-identifier hs-var hs-var">isDynWay</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-identifier hs-var">hasWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Ways
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088509"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span>
</span><span id="line-1909"></span><span>       </span><span id="local-6989586621682088506"><span class="annot"><span class="annottext">isProfWay :: Bool
</span><a href="#local-6989586621682088506"><span class="hs-identifier hs-var hs-var">isProfWay</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-identifier hs-var">hasWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Ways
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088509"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayProf"><span class="hs-identifier hs-var">WayProf</span></a></span><span>
</span><span id="line-1910"></span><span>       </span><span id="local-6989586621682088508"><span class="annot"><span class="annottext">enable_object :: Bool
</span><a href="#local-6989586621682088508"><span class="hs-identifier hs-var hs-var">enable_object</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="#local-6989586621682088501"><span class="hs-identifier hs-var">enable_spec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1911"></span><span>                            </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCode"><span class="hs-identifier hs-var">EnableByteCode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1912"></span><span>                            </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCodeAndObject"><span class="hs-identifier hs-var">EnableByteCodeAndObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1913"></span><span>                            </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableObject"><span class="hs-identifier hs-var">EnableObject</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1914"></span><span>
</span><span id="line-1915"></span><span>    </span><span class="hs-comment">-- #16331 - when no &quot;internal interpreter&quot; is available but we</span><span>
</span><span id="line-1916"></span><span>    </span><span class="hs-comment">-- need to process some TemplateHaskell or QuasiQuotes, we automatically</span><span>
</span><span id="line-1917"></span><span>    </span><span class="hs-comment">-- turn on -fexternal-interpreter.</span><span>
</span><span id="line-1918"></span><span>    </span><span id="local-6989586621682088488"><span class="annot"><span class="annottext">ext_interp_enable :: ModSummary -&gt; Bool
</span><a href="#local-6989586621682088488"><span class="hs-identifier hs-var hs-var">ext_interp_enable</span></a></span></span><span> </span><span id="local-6989586621682088514"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088514"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#ghciSupported"><span class="hs-identifier hs-var">ghciSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088516"><span class="hs-identifier hs-var">internalInterpreter</span></a></span><span>
</span><span id="line-1919"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1920"></span><span>       </span><span id="local-6989586621682088517"><span class="annot"><span class="annottext">lcl_dflags :: DynFlags
</span><a href="#local-6989586621682088517"><span class="hs-identifier hs-var hs-var">lcl_dflags</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088514"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1921"></span><span>       </span><span id="local-6989586621682088516"><span class="annot"><span class="annottext">internalInterpreter :: Bool
</span><a href="#local-6989586621682088516"><span class="hs-identifier hs-var hs-var">internalInterpreter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ExternalInterpreter"><span class="hs-identifier hs-var">Opt_ExternalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088517"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1922"></span><span>
</span><span id="line-1923"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682088518"><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682088518"><span class="hs-identifier hs-var">mg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088519"><span class="annot"><span class="annottext">NodeKey -&gt; Maybe SummaryNode
</span><a href="#local-6989586621682088519"><span class="hs-identifier hs-var">lookup_node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; [ModuleGraphNode]
-&gt; (Graph SummaryNode, NodeKey -&gt; Maybe SummaryNode)
</span><a href="GHC.Unit.Module.Graph.html#moduleGraphNodes"><span class="hs-identifier hs-var">moduleGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088439"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-1924"></span><span>
</span><span id="line-1925"></span><span>    </span><span id="local-6989586621682088520"><span class="annot"><span class="annottext">mk_needed_set :: [NodeKey] -&gt; Set NodeKey
</span><a href="#local-6989586621682088520"><span class="hs-identifier hs-var hs-var">mk_needed_set</span></a></span></span><span> </span><span id="local-6989586621682088521"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088521"><span class="hs-identifier hs-var">roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; Set NodeKey
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#fromList/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([NodeKey] -&gt; Set NodeKey) -&gt; [NodeKey] -&gt; Set NodeKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(SummaryNode -&gt; NodeKey) -&gt; [SummaryNode] -&gt; [NodeKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleGraphNode -&gt; NodeKey)
-&gt; (SummaryNode -&gt; ModuleGraphNode) -&gt; SummaryNode -&gt; NodeKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SummaryNode -&gt; ModuleGraphNode
forall key payload. Node key payload -&gt; payload
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var">node_payload</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SummaryNode] -&gt; [NodeKey]) -&gt; [SummaryNode] -&gt; [NodeKey]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode -&gt; [SummaryNode] -&gt; [SummaryNode]
forall node. Graph node -&gt; [node] -&gt; [node]
</span><a href="GHC.Data.Graph.Directed.html#reachablesG"><span class="hs-identifier hs-var">reachablesG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph SummaryNode
</span><a href="#local-6989586621682088518"><span class="hs-identifier hs-var">mg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NodeKey -&gt; SummaryNode) -&gt; [NodeKey] -&gt; [SummaryNode]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe SummaryNode -&gt; SummaryNode
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;needs_th&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe SummaryNode -&gt; SummaryNode)
-&gt; (NodeKey -&gt; Maybe SummaryNode) -&gt; NodeKey -&gt; SummaryNode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe SummaryNode
</span><a href="#local-6989586621682088519"><span class="hs-identifier hs-var">lookup_node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088521"><span class="hs-identifier hs-var">roots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1926"></span><span>
</span><span id="line-1927"></span><span>    </span><span class="annot"><a href="#local-6989586621682088522"><span class="hs-identifier hs-type">needs_obj_set</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682088523"><span class="hs-identifier hs-type">needs_bc_set</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Set.Internal.html#Set/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span>
</span><span id="line-1928"></span><span>    </span><span id="local-6989586621682088522"><span class="annot"><span class="annottext">needs_obj_set :: Set NodeKey
</span><a href="#local-6989586621682088522"><span class="hs-identifier hs-var hs-var">needs_obj_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; Set NodeKey
</span><a href="#local-6989586621682088520"><span class="hs-identifier hs-var">mk_needed_set</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088524"><span class="hs-identifier hs-var">need_obj_set</span></a></span><span>
</span><span id="line-1929"></span><span>
</span><span id="line-1930"></span><span>    </span><span id="local-6989586621682088523"><span class="annot"><span class="annottext">needs_bc_set :: Set NodeKey
</span><a href="#local-6989586621682088523"><span class="hs-identifier hs-var hs-var">needs_bc_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; Set NodeKey
</span><a href="#local-6989586621682088520"><span class="hs-identifier hs-var">mk_needed_set</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088525"><span class="hs-identifier hs-var">need_bc_set</span></a></span><span>
</span><span id="line-1931"></span><span>
</span><span id="line-1932"></span><span>    </span><span class="hs-comment">-- A map which tells us how to enable code generation for a NodeKey</span><span>
</span><span id="line-1933"></span><span>    </span><span class="annot"><a href="#local-6989586621682088452"><span class="hs-identifier hs-type">needs_codegen_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#CodeGenEnable"><span class="hs-identifier hs-type">CodeGenEnable</span></a></span><span>
</span><span id="line-1934"></span><span>    </span><span id="local-6989586621682088452"><span class="annot"><span class="annottext">needs_codegen_map :: Map NodeKey CodeGenEnable
</span><a href="#local-6989586621682088452"><span class="hs-identifier hs-var hs-var">needs_codegen_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1935"></span><span>      </span><span class="hs-comment">-- Another option here would be to just produce object code, rather than both object and</span><span>
</span><span id="line-1936"></span><span>      </span><span class="hs-comment">-- byte code</span><span>
</span><span id="line-1937"></span><span>      </span><span class="annot"><span class="annottext">(CodeGenEnable -&gt; CodeGenEnable -&gt; CodeGenEnable)
-&gt; Map NodeKey CodeGenEnable
-&gt; Map NodeKey CodeGenEnable
-&gt; Map NodeKey CodeGenEnable
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#unionWith/Data.Map.Internal.html#unionWith"><span class="hs-identifier hs-var">Map.unionWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CodeGenEnable
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCodeAndObject"><span class="hs-identifier hs-var">EnableByteCodeAndObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1938"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(NodeKey, CodeGenEnable)] -&gt; Map NodeKey CodeGenEnable
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(NodeKey, CodeGenEnable)] -&gt; Map NodeKey CodeGenEnable)
-&gt; [(NodeKey, CodeGenEnable)] -&gt; Map NodeKey CodeGenEnable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682088527"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableObject"><span class="hs-identifier hs-var">EnableObject</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682088527"><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682088527"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set NodeKey -&gt; [NodeKey]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682088522"><span class="hs-identifier hs-var">needs_obj_set</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1939"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(NodeKey, CodeGenEnable)] -&gt; Map NodeKey CodeGenEnable
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromList/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(NodeKey, CodeGenEnable)] -&gt; Map NodeKey CodeGenEnable)
-&gt; [(NodeKey, CodeGenEnable)] -&gt; Map NodeKey CodeGenEnable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682088528"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CodeGenEnable
</span><a href="GHC.Driver.Make.html#EnableByteCode"><span class="hs-identifier hs-var">EnableByteCode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682088528"><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621682088528"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set NodeKey -&gt; [NodeKey]
forall a. Set a -&gt; [a]
</span><a href="../../containers-0.6.7/src/Data.Set.Internal.html#toList/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set NodeKey
</span><a href="#local-6989586621682088523"><span class="hs-identifier hs-var">needs_bc_set</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1940"></span><span>
</span><span id="line-1941"></span><span>    </span><span class="hs-comment">-- The direct dependencies of modules which require object code</span><span>
</span><span id="line-1942"></span><span>    </span><span id="local-6989586621682088524"><span class="annot"><span class="annottext">need_obj_set :: [NodeKey]
</span><a href="#local-6989586621682088524"><span class="hs-identifier hs-var hs-var">need_obj_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1943"></span><span>      </span><span class="annot"><span class="annottext">[[NodeKey]] -&gt; [NodeKey]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-1944"></span><span>        </span><span class="hs-comment">-- Note we don't need object code for a module if it uses TemplateHaskell itself. Only</span><span>
</span><span id="line-1945"></span><span>        </span><span class="hs-comment">-- it's dependencies.</span><span>
</span><span id="line-1946"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088529"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1947"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span id="local-6989586621682088529"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088529"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682088530"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088530"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088439"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-1948"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="GHC.Unit.Module.Graph.html#isTemplateHaskellOrQQNonBoot"><span class="hs-identifier hs-var">isTemplateHaskellOrQQNonBoot</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088530"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1949"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_UseBytecodeRatherThanObjects"><span class="hs-identifier hs-var">Opt_UseBytecodeRatherThanObjects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088530"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1950"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1951"></span><span>
</span><span id="line-1952"></span><span>    </span><span class="hs-comment">-- The direct dependencies of modules which require byte code</span><span>
</span><span id="line-1953"></span><span>    </span><span id="local-6989586621682088525"><span class="annot"><span class="annottext">need_bc_set :: [NodeKey]
</span><a href="#local-6989586621682088525"><span class="hs-identifier hs-var hs-var">need_bc_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1954"></span><span>      </span><span class="annot"><span class="annottext">[[NodeKey]] -&gt; [NodeKey]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-1955"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088533"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-1956"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span id="local-6989586621682088533"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088533"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682088534"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088534"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088439"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-1957"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="GHC.Unit.Module.Graph.html#isTemplateHaskellOrQQNonBoot"><span class="hs-identifier hs-var">isTemplateHaskellOrQQNonBoot</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088534"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1958"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_UseBytecodeRatherThanObjects"><span class="hs-identifier hs-var">Opt_UseBytecodeRatherThanObjects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088534"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1959"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1960"></span><span>
</span><span id="line-1961"></span><span class="annot"><span class="hs-comment">-- | Populate the Downsweep cache with the root modules.</span></span><span>
</span><span id="line-1962"></span><span class="annot"><a href="GHC.Driver.Make.html#mkRootMap"><span class="hs-identifier hs-type">mkRootMap</span></a></span><span>
</span><span id="line-1963"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1964"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#DownsweepCache"><span class="hs-identifier hs-type">DownsweepCache</span></a></span><span>
</span><span id="line-1965"></span><span id="mkRootMap"><span class="annot"><span class="annottext">mkRootMap :: [ModSummary] -&gt; DownsweepCache
</span><a href="GHC.Driver.Make.html#mkRootMap"><span class="hs-identifier hs-var hs-var">mkRootMap</span></a></span></span><span> </span><span id="local-6989586621682088535"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088535"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Either DriverMessages ModSummary]
 -&gt; [Either DriverMessages ModSummary]
 -&gt; [Either DriverMessages ModSummary])
-&gt; [((UnitId, PkgQual, ModuleNameWithIsBoot),
     [Either DriverMessages ModSummary])]
-&gt; DownsweepCache
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#fromListWith/Data.Map.Internal.html#fromListWith"><span class="hs-identifier hs-var">Map.fromListWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Either DriverMessages ModSummary]
 -&gt; [Either DriverMessages ModSummary]
 -&gt; [Either DriverMessages ModSummary])
-&gt; [Either DriverMessages ModSummary]
-&gt; [Either DriverMessages ModSummary]
-&gt; [Either DriverMessages ModSummary]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">[Either DriverMessages ModSummary]
-&gt; [Either DriverMessages ModSummary]
-&gt; [Either DriverMessages ModSummary]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1966"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UnitId
</span><a href="GHC.Unit.Module.ModSummary.html#ms_unitid"><span class="hs-identifier hs-var">ms_unitid</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088537"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleNameWithIsBoot
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mnwib"><span class="hs-identifier hs-var">ms_mnwib</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088537"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; Either DriverMessages ModSummary
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088537"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682088537"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088537"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088535"><span class="hs-identifier hs-var">summaries</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1967"></span><span>
</span><span id="line-1968"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1969"></span><span class="hs-comment">-- Summarising modules</span><span>
</span><span id="line-1970"></span><span>
</span><span id="line-1971"></span><span class="hs-comment">-- We have two types of summarisation:</span><span>
</span><span id="line-1972"></span><span class="hs-comment">--</span><span>
</span><span id="line-1973"></span><span class="hs-comment">--    * Summarise a file.  This is used for the root module(s) passed to</span><span>
</span><span id="line-1974"></span><span class="hs-comment">--      cmLoadModules.  The file is read, and used to determine the root</span><span>
</span><span id="line-1975"></span><span class="hs-comment">--      module name.  The module name may differ from the filename.</span><span>
</span><span id="line-1976"></span><span class="hs-comment">--</span><span>
</span><span id="line-1977"></span><span class="hs-comment">--    * Summarise a module.  We are given a module name, and must provide</span><span>
</span><span id="line-1978"></span><span class="hs-comment">--      a summary.  The finder is used to locate the file in which the module</span><span>
</span><span id="line-1979"></span><span class="hs-comment">--      resides.</span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span class="annot"><a href="GHC.Driver.Make.html#summariseFile"><span class="hs-identifier hs-type">summariseFile</span></a></span><span>
</span><span id="line-1982"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1983"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span>
</span><span id="line-1984"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>    </span><span class="hs-comment">-- old summaries</span><span>
</span><span id="line-1985"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>                     </span><span class="hs-comment">-- source file name</span><span>
</span><span id="line-1986"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>                  </span><span class="hs-comment">-- start phase</span><span>
</span><span id="line-1987"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span class="hs-special">,</span><span class="annot"><a href="../../time-1.12.2/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1988"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1989"></span><span>
</span><span id="line-1990"></span><span id="summariseFile"><span class="annot"><span class="annottext">summariseFile :: HscEnv
-&gt; HomeUnit
-&gt; Map (UnitId, FilePath) ModSummary
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="GHC.Driver.Make.html#summariseFile"><span class="hs-identifier hs-var hs-var">summariseFile</span></a></span></span><span> </span><span id="local-6989586621682088540"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088540"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span> </span><span id="local-6989586621682088541"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088541"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span id="local-6989586621682088542"><span class="annot"><span class="annottext">Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088542"><span class="hs-identifier hs-var">old_summaries</span></a></span></span><span> </span><span id="local-6989586621682088543"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088543"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621682088544"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621682088544"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span> </span><span id="local-6989586621682088545"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088545"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span>
</span><span id="line-1991"></span><span>        </span><span class="hs-comment">-- we can use a cached summary if one is available and the</span><span>
</span><span id="line-1992"></span><span>        </span><span class="hs-comment">-- source file hasn't changed,</span><span>
</span><span id="line-1993"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682088546"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088546"><span class="hs-identifier hs-var">old_summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UnitId, FilePath)
-&gt; Map (UnitId, FilePath) ModSummary -&gt; Maybe ModSummary
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; UnitId
forall u. GenHomeUnit u -&gt; UnitId
</span><a href="GHC.Unit.Home.html#homeUnitId"><span class="hs-identifier hs-var">homeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088541"><span class="hs-identifier hs-var">home_unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088543"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088542"><span class="hs-identifier hs-var">old_summaries</span></a></span><span>
</span><span id="line-1994"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1995"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088547"><span class="annot"><span class="annottext">location :: ModLocation
</span><a href="#local-6989586621682088547"><span class="hs-identifier hs-var hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; ModLocation) -&gt; ModSummary -&gt; ModLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088546"><span class="hs-identifier hs-var">old_summary</span></a></span><span>
</span><span id="line-1996"></span><span>
</span><span id="line-1997"></span><span>        </span><span id="local-6989586621682088548"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088548"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Fingerprint
</span><a href="#local-6989586621682088549"><span class="hs-identifier hs-var">get_src_hash</span></a></span><span>
</span><span id="line-1998"></span><span>                </span><span class="hs-comment">-- The file exists; we checked in getRootSummary above.</span><span>
</span><span id="line-1999"></span><span>                </span><span class="hs-comment">-- If it gets removed subsequently, then this</span><span>
</span><span id="line-2000"></span><span>                </span><span class="hs-comment">-- getFileHash may fail, but that's the right</span><span>
</span><span id="line-2001"></span><span>                </span><span class="hs-comment">-- behaviour.</span><span>
</span><span id="line-2002"></span><span>
</span><span id="line-2003"></span><span>                </span><span class="hs-comment">-- return the cached summary if the source didn't change</span><span>
</span><span id="line-2004"></span><span>        </span><span class="annot"><span class="annottext">HscEnv
-&gt; (Fingerprint -&gt; IO (Either DriverMessages ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
forall e.
HscEnv
-&gt; (Fingerprint -&gt; IO (Either e ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; Fingerprint
-&gt; IO (Either e ModSummary)
</span><a href="GHC.Driver.Make.html#checkSummaryHash"><span class="hs-identifier hs-var">checkSummaryHash</span></a></span><span>
</span><span id="line-2005"></span><span>            </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Fingerprint -&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088552"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088543"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2006"></span><span>            </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088546"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088547"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088548"><span class="hs-identifier hs-var">src_hash</span></a></span><span>
</span><span id="line-2007"></span><span>
</span><span id="line-2008"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2009"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682088553"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088553"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Fingerprint
</span><a href="#local-6989586621682088549"><span class="hs-identifier hs-var">get_src_hash</span></a></span><span>
</span><span id="line-2010"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; Fingerprint -&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088552"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088543"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088553"><span class="hs-identifier hs-var">src_hash</span></a></span><span>
</span><span id="line-2011"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2012"></span><span>    </span><span class="hs-comment">-- change the main active unit so all operations happen relative to the given unit</span><span>
</span><span id="line-2013"></span><span>    </span><span id="local-6989586621682088551"><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="#local-6989586621682088551"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; HomeUnit -&gt; HscEnv -&gt; HscEnv
HomeUnit -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveHomeUnit"><span class="hs-identifier hs-var">hscSetActiveHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088541"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088540"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span>
</span><span id="line-2014"></span><span>    </span><span class="hs-comment">-- src_fn does not necessarily exist on the filesystem, so we need to</span><span>
</span><span id="line-2015"></span><span>    </span><span class="hs-comment">-- check what kind of target we are dealing with</span><span>
</span><span id="line-2016"></span><span>    </span><span id="local-6989586621682088549"><span class="annot"><span class="annottext">get_src_hash :: IO Fingerprint
</span><a href="#local-6989586621682088549"><span class="hs-identifier hs-var hs-var">get_src_hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088545"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2017"></span><span>                      </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088555"><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621682088555"><span class="hs-identifier hs-var">buf</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; IO Fingerprint
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Fingerprint -&gt; IO Fingerprint) -&gt; Fingerprint -&gt; IO Fingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer -&gt; Fingerprint
</span><a href="GHC.Data.StringBuffer.html#fingerprintStringBuffer"><span class="hs-identifier hs-var">fingerprintStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621682088555"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-2018"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Fingerprint -&gt; IO Fingerprint
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Fingerprint -&gt; IO Fingerprint)
-&gt; IO Fingerprint -&gt; IO Fingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Fingerprint
</span><a href="../../base-4.18.2.1/src/GHC.Fingerprint.html#getFileHash/GHC.Fingerprint.html#getFileHash"><span class="hs-identifier hs-var">getFileHash</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088543"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2019"></span><span>
</span><span id="line-2020"></span><span>    </span><span id="local-6989586621682088552"><span class="annot"><span class="annottext">new_summary :: FilePath -&gt; Fingerprint -&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088552"><span class="hs-identifier hs-var hs-var">new_summary</span></a></span></span><span> </span><span id="local-6989586621682088558"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088558"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621682088559"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088559"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT DriverMessages IO ModSummary
-&gt; IO (Either DriverMessages ModSummary)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT DriverMessages IO ModSummary
 -&gt; IO (Either DriverMessages ModSummary))
-&gt; ExceptT DriverMessages IO ModSummary
-&gt; IO (Either DriverMessages ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2021"></span><span>        </span><span id="local-6989586621682088560"><span class="annot"><span class="annottext">preimps :: PreprocessedImports
</span><a href="#local-6989586621682088560"><span class="hs-identifier hs-var">preimps</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682088562"><span id="local-6989586621682088563"><span id="local-6989586621682088564"><span id="local-6989586621682088565"><span id="local-6989586621682088566"><span id="local-6989586621682088567"><span id="local-6989586621682088568"><span id="local-6989586621682088569"><span class="annot"><span class="annottext">Bool
FilePath
[(PkgQual, GenLocated SrcSpan ModuleName)]
ModuleName
InputFileBuffer
SrcSpan
DynFlags
pi_local_dflags :: DynFlags
pi_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_ghc_prim_import :: Bool
pi_hspp_fn :: FilePath
pi_hspp_buf :: InputFileBuffer
pi_mod_name_loc :: SrcSpan
pi_mod_name :: ModuleName
pi_local_dflags :: PreprocessedImports -&gt; DynFlags
pi_srcimps :: PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_ghc_prim_import :: PreprocessedImports -&gt; Bool
pi_hspp_fn :: PreprocessedImports -&gt; FilePath
pi_hspp_buf :: PreprocessedImports -&gt; InputFileBuffer
pi_mod_name_loc :: PreprocessedImports -&gt; SrcSpan
pi_mod_name :: PreprocessedImports -&gt; ModuleName
</span><a href="#local-6989586621682088562"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-2022"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; ExceptT DriverMessages IO PreprocessedImports
</span><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-var">getPreprocessedImports</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088558"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621682088544"><span class="hs-identifier hs-var">mb_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088545"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-2023"></span><span>
</span><span id="line-2024"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088579"><span class="annot"><span class="annottext">fopts :: FinderOpts
</span><a href="#local-6989586621682088579"><span class="hs-identifier hs-var hs-var">fopts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FinderOpts
</span><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier hs-var">initFinderOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2025"></span><span>
</span><span id="line-2026"></span><span>        </span><span class="hs-comment">-- Make a ModLocation for this file</span><span>
</span><span id="line-2027"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088580"><span class="annot"><span class="annottext">location :: ModLocation
</span><a href="#local-6989586621682088580"><span class="hs-identifier hs-var hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FinderOpts -&gt; ModuleName -&gt; FilePath -&gt; ModLocation
</span><a href="GHC.Unit.Finder.html#mkHomeModLocation"><span class="hs-identifier hs-var">mkHomeModLocation</span></a></span><span> </span><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621682088579"><span class="hs-identifier hs-var">fopts</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088569"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088558"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2028"></span><span>
</span><span id="line-2029"></span><span>        </span><span class="hs-comment">-- Tell the Finder cache where it is, so that subsequent calls</span><span>
</span><span id="line-2030"></span><span>        </span><span class="hs-comment">-- to findModule will find it, even if it's not on any search path</span><span>
</span><span id="line-2031"></span><span>        </span><span id="local-6989586621682088582"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088582"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Module -&gt; ExceptT DriverMessages IO Module
forall a. IO a -&gt; ExceptT DriverMessages IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Module -&gt; ExceptT DriverMessages IO Module)
-&gt; IO Module -&gt; ExceptT DriverMessages IO Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2032"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088583"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621682088583"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2033"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088585"><span class="annot"><span class="annottext">fc :: FinderCache
</span><a href="#local-6989586621682088585"><span class="hs-identifier hs-var hs-var">fc</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2034"></span><span>          </span><span class="annot"><span class="annottext">FinderCache -&gt; HomeUnit -&gt; ModuleName -&gt; ModLocation -&gt; IO Module
</span><a href="GHC.Unit.Finder.html#addHomeModuleToFinder"><span class="hs-identifier hs-var">addHomeModuleToFinder</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682088585"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088583"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088569"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088580"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2035"></span><span>
</span><span id="line-2036"></span><span>        </span><span class="annot"><span class="annottext">IO ModSummary -&gt; ExceptT DriverMessages IO ModSummary
forall a. IO a -&gt; ExceptT DriverMessages IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModSummary -&gt; ExceptT DriverMessages IO ModSummary)
-&gt; IO ModSummary -&gt; ExceptT DriverMessages IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; MakeNewModSummary -&gt; IO ModSummary
</span><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-var">makeNewModSummary</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088551"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(MakeNewModSummary -&gt; IO ModSummary)
-&gt; MakeNewModSummary -&gt; IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span>
</span><span id="line-2037"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nms_src_fn :: FilePath
</span><a href="GHC.Driver.Make.html#nms_src_fn"><span class="hs-identifier hs-var">nms_src_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088558"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2038"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_src_hash :: Fingerprint
</span><a href="GHC.Driver.Make.html#nms_src_hash"><span class="hs-identifier hs-var">nms_src_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088559"><span class="hs-identifier hs-var">src_hash</span></a></span><span>
</span><span id="line-2039"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_is_boot :: IsBootInterface
</span><a href="GHC.Driver.Make.html#nms_is_boot"><span class="hs-identifier hs-var">nms_is_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-2040"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_hsc_src :: HscSource
</span><a href="GHC.Driver.Make.html#nms_hsc_src"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2041"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHaskellSigFilename"><span class="hs-identifier hs-var">isHaskellSigFilename</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088558"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2042"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-2043"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>
</span><span id="line-2044"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_location :: ModLocation
</span><a href="GHC.Driver.Make.html#nms_location"><span class="hs-identifier hs-var">nms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088580"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2045"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_mod :: Module
</span><a href="GHC.Driver.Make.html#nms_mod"><span class="hs-identifier hs-var">nms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088582"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2046"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_preimps :: PreprocessedImports
</span><a href="GHC.Driver.Make.html#nms_preimps"><span class="hs-identifier hs-var">nms_preimps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreprocessedImports
</span><a href="#local-6989586621682088560"><span class="hs-identifier hs-var">preimps</span></a></span><span>
</span><span id="line-2047"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2048"></span><span>
</span><span id="line-2049"></span><span id="local-6989586621682086196"><span class="annot"><a href="GHC.Driver.Make.html#checkSummaryHash"><span class="hs-identifier hs-type">checkSummaryHash</span></a></span><span>
</span><span id="line-2050"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2051"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Fingerprint.Type.html#Fingerprint/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086196"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2052"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Fingerprint.Type.html#Fingerprint/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span>
</span><span id="line-2053"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086196"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2054"></span><span id="checkSummaryHash"><span class="annot"><span class="annottext">checkSummaryHash :: forall e.
HscEnv
-&gt; (Fingerprint -&gt; IO (Either e ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; Fingerprint
-&gt; IO (Either e ModSummary)
</span><a href="GHC.Driver.Make.html#checkSummaryHash"><span class="hs-identifier hs-var hs-var">checkSummaryHash</span></a></span></span><span>
</span><span id="line-2055"></span><span>  </span><span id="local-6989586621682088604"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088604"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682088605"><span class="annot"><span class="annottext">Fingerprint -&gt; IO (Either e ModSummary)
</span><a href="#local-6989586621682088605"><span class="hs-identifier hs-var">new_summary</span></a></span></span><span>
</span><span id="line-2056"></span><span>  </span><span id="local-6989586621682088606"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088606"><span class="hs-identifier hs-var">old_summary</span></a></span></span><span>
</span><span id="line-2057"></span><span>  </span><span id="local-6989586621682088607"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088607"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682088608"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088608"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span>
</span><span id="line-2058"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Fingerprint
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hs_hash"><span class="hs-identifier hs-var">ms_hs_hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088606"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Fingerprint -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088608"><span class="hs-identifier hs-var">src_hash</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2059"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ForceRecomp"><span class="hs-identifier hs-var">Opt_ForceRecomp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088604"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2060"></span><span>           </span><span class="hs-comment">-- update the object-file timestamp</span><span>
</span><span id="line-2061"></span><span>           </span><span id="local-6989586621682088610"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088610"><span class="hs-identifier hs-var">obj_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088607"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2062"></span><span>
</span><span id="line-2063"></span><span>           </span><span class="hs-comment">-- We have to repopulate the Finder's cache for file targets</span><span>
</span><span id="line-2064"></span><span>           </span><span class="hs-comment">-- because the file might not even be on the regular search path</span><span>
</span><span id="line-2065"></span><span>           </span><span class="hs-comment">-- and it was likely flushed in depanal. This is not technically</span><span>
</span><span id="line-2066"></span><span>           </span><span class="hs-comment">-- needed when we're called from sumariseModule but it shouldn't</span><span>
</span><span id="line-2067"></span><span>           </span><span class="hs-comment">-- hurt.</span><span>
</span><span id="line-2068"></span><span>           </span><span class="hs-comment">-- Also, only add to finder cache for non-boot modules as the finder cache</span><span>
</span><span id="line-2069"></span><span>           </span><span class="hs-comment">-- makes sure to add a boot suffix for boot files.</span><span>
</span><span id="line-2070"></span><span>           </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2071"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088612"><span class="annot"><span class="annottext">fc :: FinderCache
</span><a href="#local-6989586621682088612"><span class="hs-identifier hs-var hs-var">fc</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088604"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2072"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088606"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2073"></span><span>                </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FinderCache -&gt; Module -&gt; ModLocation -&gt; IO ()
</span><a href="GHC.Unit.Finder.html#addModuleToFinder"><span class="hs-identifier hs-var">addModuleToFinder</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682088612"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088606"><span class="hs-identifier hs-var">old_summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088607"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2074"></span><span>                </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2075"></span><span>
</span><span id="line-2076"></span><span>           </span><span id="local-6989586621682088614"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088614"><span class="hs-identifier hs-var">hi_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088607"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2077"></span><span>           </span><span id="local-6989586621682088615"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088615"><span class="hs-identifier hs-var">hie_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088607"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2078"></span><span>
</span><span id="line-2079"></span><span>           </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Either e ModSummary
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span>
</span><span id="line-2080"></span><span>             </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088606"><span class="hs-identifier hs-var">old_summary</span></a></span><span>
</span><span id="line-2081"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_obj_date"><span class="hs-identifier hs-var">ms_obj_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088610"><span class="hs-identifier hs-type">obj_timestamp</span></a></span><span>
</span><span id="line-2082"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088614"><span class="hs-identifier hs-type">hi_timestamp</span></a></span><span>
</span><span id="line-2083"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ms_hie_date"><span class="hs-identifier hs-var">ms_hie_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088615"><span class="hs-identifier hs-type">hie_timestamp</span></a></span><span>
</span><span id="line-2084"></span><span>                     </span><span class="hs-special">}</span><span>
</span><span id="line-2085"></span><span>             </span><span class="hs-special">)</span><span>
</span><span id="line-2086"></span><span>
</span><span id="line-2087"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2088"></span><span>           </span><span class="hs-comment">-- source changed: re-summarise.</span><span>
</span><span id="line-2089"></span><span>           </span><span class="annot"><span class="annottext">Fingerprint -&gt; IO (Either e ModSummary)
</span><a href="#local-6989586621682088605"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088608"><span class="hs-identifier hs-var">src_hash</span></a></span><span>
</span><span id="line-2090"></span><span>
</span><span id="line-2091"></span><span class="hs-keyword">data</span><span> </span><span id="SummariseResult"><span class="annot"><a href="GHC.Driver.Make.html#SummariseResult"><span class="hs-identifier hs-var">SummariseResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2092"></span><span>        </span><span id="FoundInstantiation"><span class="annot"><a href="GHC.Driver.Make.html#FoundInstantiation"><span class="hs-identifier hs-var">FoundInstantiation</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedUnit"><span class="hs-identifier hs-type">InstantiatedUnit</span></a></span><span>
</span><span id="line-2093"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="FoundHomeWithError"><span class="annot"><a href="GHC.Driver.Make.html#FoundHomeWithError"><span class="hs-identifier hs-var">FoundHomeWithError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2094"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="FoundHome"><span class="annot"><a href="GHC.Driver.Make.html#FoundHome"><span class="hs-identifier hs-var">FoundHome</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2095"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="External"><span class="annot"><a href="GHC.Driver.Make.html#External"><span class="hs-identifier hs-var">External</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-2096"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="NotThere"><span class="annot"><a href="GHC.Driver.Make.html#NotThere"><span class="hs-identifier hs-var">NotThere</span></a></span></span><span>
</span><span id="line-2097"></span><span>
</span><span id="line-2098"></span><span class="hs-comment">-- Summarise a module, and pick up source and timestamp.</span><span>
</span><span id="line-2099"></span><span class="annot"><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-type">summariseModule</span></a></span><span>
</span><span id="line-2100"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2101"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html#HomeUnit"><span class="hs-identifier hs-type">HomeUnit</span></a></span><span>
</span><span id="line-2102"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2103"></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ Map of old summaries</span></span><span>
</span><span id="line-2104"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; a {-# SOURCE #-} import</span><span>
</span><span id="line-2105"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-comment">-- Imported module to be summarised</span><span>
</span><span id="line-2106"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span>
</span><span id="line-2107"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../time-1.12.2/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2108"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Modules to exclude</span><span>
</span><span id="line-2109"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummariseResult"><span class="hs-identifier hs-type">SummariseResult</span></a></span><span>
</span><span id="line-2110"></span><span>
</span><span id="line-2111"></span><span>
</span><span id="line-2112"></span><span id="summariseModule"><span class="annot"><span class="annottext">summariseModule :: HscEnv
-&gt; HomeUnit
-&gt; Map (UnitId, FilePath) ModSummary
-&gt; IsBootInterface
-&gt; GenLocated SrcSpan ModuleName
-&gt; PkgQual
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; [ModuleName]
-&gt; IO SummariseResult
</span><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-var hs-var">summariseModule</span></a></span></span><span> </span><span id="local-6989586621682088620"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088620"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span> </span><span id="local-6989586621682088621"><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088621"><span class="hs-identifier hs-var">home_unit</span></a></span></span><span> </span><span id="local-6989586621682088622"><span class="annot"><span class="annottext">Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088622"><span class="hs-identifier hs-var">old_summary_map</span></a></span></span><span> </span><span id="local-6989586621682088623"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682088623"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682088624"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088624"><span class="hs-identifier hs-var">wanted_mod</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682088625"><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682088625"><span class="hs-identifier hs-var">mb_pkg</span></a></span></span><span>
</span><span id="line-2113"></span><span>                </span><span id="local-6989586621682088626"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088626"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span> </span><span id="local-6989586621682088627"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088627"><span class="hs-identifier hs-var">excl_mods</span></a></span></span><span>
</span><span id="line-2114"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088624"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModuleName] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088627"><span class="hs-identifier hs-var">excl_mods</span></a></span><span>
</span><span id="line-2115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SummariseResult -&gt; IO SummariseResult
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SummariseResult
</span><a href="GHC.Driver.Make.html#NotThere"><span class="hs-identifier hs-var">NotThere</span></a></span><span>
</span><span id="line-2116"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO SummariseResult
</span><a href="#local-6989586621682088629"><span class="hs-identifier hs-var">find_it</span></a></span><span>
</span><span id="line-2117"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2118"></span><span>    </span><span class="hs-comment">-- Temporarily change the currently active home unit so all operations</span><span>
</span><span id="line-2119"></span><span>    </span><span class="hs-comment">-- happen relative to it</span><span>
</span><span id="line-2120"></span><span>    </span><span id="local-6989586621682088630"><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="#local-6989586621682088630"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; HomeUnit -&gt; HscEnv -&gt; HscEnv
HomeUnit -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveHomeUnit"><span class="hs-identifier hs-var">hscSetActiveHomeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088621"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088620"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span>
</span><span id="line-2121"></span><span>    </span><span id="local-6989586621682088631"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682088631"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088630"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2122"></span><span>
</span><span id="line-2123"></span><span>    </span><span class="annot"><a href="#local-6989586621682088629"><span class="hs-identifier hs-type">find_it</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummariseResult"><span class="hs-identifier hs-type">SummariseResult</span></a></span><span>
</span><span id="line-2124"></span><span>
</span><span id="line-2125"></span><span>    </span><span id="local-6989586621682088629"><span class="annot"><span class="annottext">find_it :: IO SummariseResult
</span><a href="#local-6989586621682088629"><span class="hs-identifier hs-var hs-var">find_it</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2126"></span><span>        </span><span id="local-6989586621682088632"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682088632"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; PkgQual -&gt; IO FindResult
</span><a href="GHC.Unit.Finder.html#findImportedModule"><span class="hs-identifier hs-var">findImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088630"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088624"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="#local-6989586621682088625"><span class="hs-identifier hs-var">mb_pkg</span></a></span><span>
</span><span id="line-2127"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682088632"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2128"></span><span>             </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span id="local-6989586621682088633"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088633"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682088634"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088634"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-2129"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088633"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2130"></span><span>                        </span><span class="hs-comment">-- Home package</span><span>
</span><span id="line-2131"></span><span>                         </span><span class="annot"><span class="annottext">ModLocation -&gt; Module -&gt; IO SummariseResult
</span><a href="#local-6989586621682088635"><span class="hs-identifier hs-var">just_found</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088633"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088634"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2132"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span> </span><span id="local-6989586621682088636"><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088636"><span class="hs-identifier hs-var">iud</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088634"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2133"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnit -&gt; Module -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeModule"><span class="hs-identifier hs-var">isHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088621"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088634"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2134"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SummariseResult -&gt; IO SummariseResult
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(SummariseResult -&gt; IO SummariseResult)
-&gt; SummariseResult -&gt; IO SummariseResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit -&gt; SummariseResult
</span><a href="GHC.Driver.Make.html#FoundInstantiation"><span class="hs-identifier hs-var">FoundInstantiation</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088636"><span class="hs-identifier hs-var">iud</span></a></span><span>
</span><span id="line-2135"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SummariseResult -&gt; IO SummariseResult
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(SummariseResult -&gt; IO SummariseResult)
-&gt; SummariseResult -&gt; IO SummariseResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SummariseResult
</span><a href="GHC.Driver.Make.html#External"><span class="hs-identifier hs-var">External</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088634"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2136"></span><span>             </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SummariseResult -&gt; IO SummariseResult
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SummariseResult
</span><a href="GHC.Driver.Make.html#NotThere"><span class="hs-identifier hs-var">NotThere</span></a></span><span>
</span><span id="line-2137"></span><span>                        </span><span class="hs-comment">-- Not found</span><span>
</span><span id="line-2138"></span><span>                        </span><span class="hs-comment">-- (If it is TRULY not found at all, we'll</span><span>
</span><span id="line-2139"></span><span>                        </span><span class="hs-comment">-- error when we actually try to compile)</span><span>
</span><span id="line-2140"></span><span>
</span><span id="line-2141"></span><span>    </span><span id="local-6989586621682088635"><span class="annot"><span class="annottext">just_found :: ModLocation -&gt; Module -&gt; IO SummariseResult
</span><a href="#local-6989586621682088635"><span class="hs-identifier hs-var hs-var">just_found</span></a></span></span><span> </span><span id="local-6989586621682088638"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088638"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682088639"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088639"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2142"></span><span>                </span><span class="hs-comment">-- Adjust location to point to the hs-boot source file,</span><span>
</span><span id="line-2143"></span><span>                </span><span class="hs-comment">-- hi file, object file, when is_boot says so</span><span>
</span><span id="line-2144"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088640"><span class="annot"><span class="annottext">location' :: ModLocation
</span><a href="#local-6989586621682088640"><span class="hs-identifier hs-var hs-var">location'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682088623"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2145"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; ModLocation
</span><a href="GHC.Unit.Module.Location.html#addBootSuffixLocn"><span class="hs-identifier hs-var">addBootSuffixLocn</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088638"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2146"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088638"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2147"></span><span>            </span><span id="local-6989586621682088642"><span class="annot"><span class="annottext">src_fn :: FilePath
</span><a href="#local-6989586621682088642"><span class="hs-identifier hs-var hs-var">src_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;summarise2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088640"><span class="hs-identifier hs-var">location'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2148"></span><span>
</span><span id="line-2149"></span><span>                </span><span class="hs-comment">-- Check that it exists</span><span>
</span><span id="line-2150"></span><span>                </span><span class="hs-comment">-- It might have been deleted since the Finder last found it</span><span>
</span><span id="line-2151"></span><span>        </span><span id="local-6989586621682088643"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682088643"><span class="hs-identifier hs-var">maybe_h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe Fingerprint)
</span><a href="GHC.Utils.Misc.html#fileHashIfExists"><span class="hs-identifier hs-var">fileHashIfExists</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088642"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2152"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682088643"><span class="hs-identifier hs-var">maybe_h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2153"></span><span>          </span><span class="hs-comment">-- This situation can also happen if we have found the .hs file but the</span><span>
</span><span id="line-2154"></span><span>          </span><span class="hs-comment">-- .hs-boot file doesn't exist.</span><span>
</span><span id="line-2155"></span><span>          </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SummariseResult -&gt; IO SummariseResult
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SummariseResult
</span><a href="GHC.Driver.Make.html#NotThere"><span class="hs-identifier hs-var">NotThere</span></a></span><span>
</span><span id="line-2156"></span><span>          </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682088645"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088645"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2157"></span><span>            </span><span id="local-6989586621682088646"><span class="annot"><span class="annottext">Either DriverMessages ModSummary
</span><a href="#local-6989586621682088646"><span class="hs-identifier hs-var">fresult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModLocation
-&gt; Module
-&gt; FilePath
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088647"><span class="hs-identifier hs-var">new_summary_cache_check</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088640"><span class="hs-identifier hs-var">location'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088639"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088642"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088645"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-2158"></span><span>            </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either DriverMessages ModSummary
</span><a href="#local-6989586621682088646"><span class="hs-identifier hs-var">fresult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2159"></span><span>              </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682088648"><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682088648"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(UnitId, DriverMessages) -&gt; SummariseResult
</span><a href="GHC.Driver.Make.html#FoundHomeWithError"><span class="hs-identifier hs-var">FoundHomeWithError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088639"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DriverMessages
</span><a href="#local-6989586621682088648"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>              </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682088649"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088649"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SummariseResult
</span><a href="GHC.Driver.Make.html#FoundHome"><span class="hs-identifier hs-var">FoundHome</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088649"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2161"></span><span>
</span><span id="line-2162"></span><span>    </span><span id="local-6989586621682088647"><span class="annot"><span class="annottext">new_summary_cache_check :: ModLocation
-&gt; Module
-&gt; FilePath
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088647"><span class="hs-identifier hs-var hs-var">new_summary_cache_check</span></a></span></span><span> </span><span id="local-6989586621682088650"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088650"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682088651"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088651"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682088652"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088652"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621682088653"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088653"><span class="hs-identifier hs-var">h</span></a></span></span><span>
</span><span id="line-2163"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682088654"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088654"><span class="hs-identifier hs-var">old_summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UnitId, FilePath)
-&gt; Map (UnitId, FilePath) ModSummary -&gt; Maybe ModSummary
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088651"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088652"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (UnitId, FilePath) ModSummary
</span><a href="#local-6989586621682088622"><span class="hs-identifier hs-var">old_summary_map</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2164"></span><span>
</span><span id="line-2165"></span><span>         </span><span class="hs-comment">-- check the hash on the source file, and</span><span>
</span><span id="line-2166"></span><span>         </span><span class="hs-comment">-- return the cached summary if it hasn't changed.  If the</span><span>
</span><span id="line-2167"></span><span>         </span><span class="hs-comment">-- file has changed then need to resummarise.</span><span>
</span><span id="line-2168"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088626"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2169"></span><span>           </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088655"><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621682088655"><span class="hs-identifier hs-var">buf</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2170"></span><span>               </span><span class="annot"><span class="annottext">HscEnv
-&gt; (Fingerprint -&gt; IO (Either DriverMessages ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
forall e.
HscEnv
-&gt; (Fingerprint -&gt; IO (Either e ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; Fingerprint
-&gt; IO (Either e ModSummary)
</span><a href="GHC.Driver.Make.html#checkSummaryHash"><span class="hs-identifier hs-var">checkSummaryHash</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088630"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation
-&gt; Module
-&gt; FilePath
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088656"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088650"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088651"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088652"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088654"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088650"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputFileBuffer -&gt; Fingerprint
</span><a href="GHC.Data.StringBuffer.html#fingerprintStringBuffer"><span class="hs-identifier hs-var">fingerprintStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621682088655"><span class="hs-identifier hs-var">buf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2171"></span><span>           </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2172"></span><span>               </span><span class="annot"><span class="annottext">HscEnv
-&gt; (Fingerprint -&gt; IO (Either DriverMessages ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
forall e.
HscEnv
-&gt; (Fingerprint -&gt; IO (Either e ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; Fingerprint
-&gt; IO (Either e ModSummary)
</span><a href="GHC.Driver.Make.html#checkSummaryHash"><span class="hs-identifier hs-var">checkSummaryHash</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088630"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation
-&gt; Module
-&gt; FilePath
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088656"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088650"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088651"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088652"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088654"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088650"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088653"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-2173"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
-&gt; Module
-&gt; FilePath
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088656"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088650"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088651"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088652"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088653"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-2174"></span><span>
</span><span id="line-2175"></span><span>    </span><span class="annot"><a href="#local-6989586621682088656"><span class="hs-identifier hs-type">new_summary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-2176"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2177"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2178"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Fingerprint.Type.html#Fingerprint/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span>
</span><span id="line-2179"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2180"></span><span>    </span><span id="local-6989586621682088656"><span class="annot"><span class="annottext">new_summary :: ModLocation
-&gt; Module
-&gt; FilePath
-&gt; Fingerprint
-&gt; IO (Either DriverMessages ModSummary)
</span><a href="#local-6989586621682088656"><span class="hs-identifier hs-var hs-var">new_summary</span></a></span></span><span> </span><span id="local-6989586621682088657"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088657"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682088658"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088658"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682088659"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088659"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621682088660"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088660"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span>
</span><span id="line-2181"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT DriverMessages IO ModSummary
-&gt; IO (Either DriverMessages ModSummary)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#runExceptT/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT DriverMessages IO ModSummary
 -&gt; IO (Either DriverMessages ModSummary))
-&gt; ExceptT DriverMessages IO ModSummary
-&gt; IO (Either DriverMessages ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2182"></span><span>        </span><span id="local-6989586621682088661"><span class="annot"><span class="annottext">preimps :: PreprocessedImports
</span><a href="#local-6989586621682088661"><span class="hs-identifier hs-var">preimps</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621682088662"><span id="local-6989586621682088663"><span id="local-6989586621682088664"><span id="local-6989586621682088665"><span id="local-6989586621682088666"><span id="local-6989586621682088667"><span id="local-6989586621682088668"><span id="local-6989586621682088669"><span class="annot"><span class="annottext">Bool
FilePath
[(PkgQual, GenLocated SrcSpan ModuleName)]
ModuleName
InputFileBuffer
SrcSpan
DynFlags
pi_local_dflags :: PreprocessedImports -&gt; DynFlags
pi_srcimps :: PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_ghc_prim_import :: PreprocessedImports -&gt; Bool
pi_hspp_fn :: PreprocessedImports -&gt; FilePath
pi_hspp_buf :: PreprocessedImports -&gt; InputFileBuffer
pi_mod_name_loc :: PreprocessedImports -&gt; SrcSpan
pi_mod_name :: PreprocessedImports -&gt; ModuleName
pi_local_dflags :: DynFlags
pi_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_ghc_prim_import :: Bool
pi_hspp_fn :: FilePath
pi_hspp_buf :: InputFileBuffer
pi_mod_name_loc :: SrcSpan
pi_mod_name :: ModuleName
</span><a href="GHC.Driver.Make.html#pi_local_dflags"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-2183"></span><span>            </span><span class="hs-comment">-- Remember to set the active unit here, otherwise the wrong include paths are passed to CPP</span><span>
</span><span id="line-2184"></span><span>            </span><span class="hs-comment">-- See multiHomeUnits_cpp2 test</span><span>
</span><span id="line-2185"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; ExceptT DriverMessages IO PreprocessedImports
</span><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-var">getPreprocessedImports</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitId -&gt; HscEnv -&gt; HscEnv
UnitId -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-var">hscSetActiveUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088658"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088630"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088659"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088626"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-2186"></span><span>
</span><span id="line-2187"></span><span>        </span><span class="hs-comment">-- NB: Despite the fact that is_boot is a top-level parameter, we</span><span>
</span><span id="line-2188"></span><span>        </span><span class="hs-comment">-- don't actually know coming into this function what the HscSource</span><span>
</span><span id="line-2189"></span><span>        </span><span class="hs-comment">-- of the module in question is.  This is because we may be processing</span><span>
</span><span id="line-2190"></span><span>        </span><span class="hs-comment">-- this module because another module in the graph imported it: in this</span><span>
</span><span id="line-2191"></span><span>        </span><span class="hs-comment">-- case, we know if it's a boot or not because of the {-# SOURCE #-}</span><span>
</span><span id="line-2192"></span><span>        </span><span class="hs-comment">-- annotation, but we don't know if it's a signature or a regular</span><span>
</span><span id="line-2193"></span><span>        </span><span class="hs-comment">-- module until we actually look it up on the filesystem.</span><span>
</span><span id="line-2194"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088670"><span class="annot"><span class="annottext">hsc_src :: HscSource
</span><a href="#local-6989586621682088670"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span>
</span><span id="line-2195"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682088623"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span>
</span><span id="line-2196"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHaskellSigFilename"><span class="hs-identifier hs-var">isHaskellSigFilename</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088659"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-2197"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>
</span><span id="line-2198"></span><span>
</span><span id="line-2199"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT DriverMessages IO () -&gt; ExceptT DriverMessages IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088669"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088624"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT DriverMessages IO () -&gt; ExceptT DriverMessages IO ())
-&gt; ExceptT DriverMessages IO () -&gt; ExceptT DriverMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2200"></span><span>                </span><span class="annot"><span class="annottext">DriverMessages -&gt; ExceptT DriverMessages IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#throwE/Control.Monad.Trans.Except.html#throwE"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessages -&gt; ExceptT DriverMessages IO ())
-&gt; DriverMessages -&gt; ExceptT DriverMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088668"><span class="hs-identifier hs-var">pi_mod_name_loc</span></a></span><span>
</span><span id="line-2201"></span><span>                       </span><span class="annot"><span class="annottext">(DriverMessage -&gt; MsgEnvelope DriverMessage)
-&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverFileModuleNameMismatch"><span class="hs-identifier hs-var">DriverFileModuleNameMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088669"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088624"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span>
</span><span id="line-2202"></span><span>
</span><span id="line-2203"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088672"><span class="annot"><span class="annottext">instantiations :: GenInstantiations UnitId
</span><a href="#local-6989586621682088672"><span class="hs-identifier hs-var hs-var">instantiations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeUnit -&gt; GenInstantiations UnitId
forall u. GenHomeUnit u -&gt; GenInstantiations u
</span><a href="GHC.Unit.Home.html#homeUnitInstantiations"><span class="hs-identifier hs-var">homeUnitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682088621"><span class="hs-identifier hs-var">home_unit</span></a></span><span>
</span><span id="line-2204"></span><span>        </span><span class="annot"><span class="annottext">Bool
-&gt; ExceptT DriverMessages IO () -&gt; ExceptT DriverMessages IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682088670"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Module -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isNothing/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; GenInstantiations UnitId -&gt; Maybe Module
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.18.2.1/src/GHC.List.html#lookup/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088669"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiations UnitId
</span><a href="#local-6989586621682088672"><span class="hs-identifier hs-var">instantiations</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT DriverMessages IO () -&gt; ExceptT DriverMessages IO ())
-&gt; ExceptT DriverMessages IO () -&gt; ExceptT DriverMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2205"></span><span>            </span><span class="annot"><span class="annottext">DriverMessages -&gt; ExceptT DriverMessages IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#throwE/Control.Monad.Trans.Except.html#throwE"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessages -&gt; ExceptT DriverMessages IO ())
-&gt; DriverMessages -&gt; ExceptT DriverMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088668"><span class="hs-identifier hs-var">pi_mod_name_loc</span></a></span><span>
</span><span id="line-2206"></span><span>                   </span><span class="annot"><span class="annottext">(DriverMessage -&gt; MsgEnvelope DriverMessage)
-&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; BuildingCabalPackage
-&gt; GenInstantiations UnitId
-&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverUnexpectedSignature"><span class="hs-identifier hs-var">DriverUnexpectedSignature</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088669"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; BuildingCabalPackage
</span><a href="GHC.Driver.Errors.Types.html#checkBuildingCabalPackage"><span class="hs-identifier hs-var">checkBuildingCabalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088631"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenInstantiations UnitId
</span><a href="#local-6989586621682088672"><span class="hs-identifier hs-var">instantiations</span></a></span><span>
</span><span id="line-2207"></span><span>
</span><span id="line-2208"></span><span>        </span><span class="annot"><span class="annottext">IO ModSummary -&gt; ExceptT DriverMessages IO ModSummary
forall a. IO a -&gt; ExceptT DriverMessages IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModSummary -&gt; ExceptT DriverMessages IO ModSummary)
-&gt; IO ModSummary -&gt; ExceptT DriverMessages IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; MakeNewModSummary -&gt; IO ModSummary
</span><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-var">makeNewModSummary</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088630"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(MakeNewModSummary -&gt; IO ModSummary)
-&gt; MakeNewModSummary -&gt; IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span>
</span><span id="line-2209"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nms_src_fn :: FilePath
</span><a href="GHC.Driver.Make.html#nms_src_fn"><span class="hs-identifier hs-var">nms_src_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088659"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2210"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_src_hash :: Fingerprint
</span><a href="GHC.Driver.Make.html#nms_src_hash"><span class="hs-identifier hs-var">nms_src_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088660"><span class="hs-identifier hs-var">src_hash</span></a></span><span>
</span><span id="line-2211"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_is_boot :: IsBootInterface
</span><a href="GHC.Driver.Make.html#nms_is_boot"><span class="hs-identifier hs-var">nms_is_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621682088623"><span class="hs-identifier hs-var">is_boot</span></a></span><span>
</span><span id="line-2212"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_hsc_src :: HscSource
</span><a href="GHC.Driver.Make.html#nms_hsc_src"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682088670"><span class="hs-identifier hs-var">hsc_src</span></a></span><span>
</span><span id="line-2213"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_location :: ModLocation
</span><a href="GHC.Driver.Make.html#nms_location"><span class="hs-identifier hs-var">nms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088657"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2214"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_mod :: Module
</span><a href="GHC.Driver.Make.html#nms_mod"><span class="hs-identifier hs-var">nms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088658"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2215"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_preimps :: PreprocessedImports
</span><a href="GHC.Driver.Make.html#nms_preimps"><span class="hs-identifier hs-var">nms_preimps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreprocessedImports
</span><a href="#local-6989586621682088661"><span class="hs-identifier hs-var">preimps</span></a></span><span>
</span><span id="line-2216"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2217"></span><span>
</span><span id="line-2218"></span><span class="hs-comment">-- | Convenience named arguments for 'makeNewModSummary' only used to make</span><span>
</span><span id="line-2219"></span><span class="hs-comment">-- code more readable, not exported.</span><span>
</span><span id="line-2220"></span><span class="hs-keyword">data</span><span> </span><span id="MakeNewModSummary"><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-var">MakeNewModSummary</span></a></span></span><span>
</span><span id="line-2221"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MakeNewModSummary"><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-var">MakeNewModSummary</span></a></span></span><span>
</span><span id="line-2222"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="nms_src_fn"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; FilePath
</span><a href="GHC.Driver.Make.html#nms_src_fn"><span class="hs-identifier hs-var hs-var">nms_src_fn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2223"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_src_hash"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; Fingerprint
</span><a href="GHC.Driver.Make.html#nms_src_hash"><span class="hs-identifier hs-var hs-var">nms_src_hash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Fingerprint.Type.html#Fingerprint/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span>
</span><span id="line-2224"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_is_boot"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Make.html#nms_is_boot"><span class="hs-identifier hs-var hs-var">nms_is_boot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span>
</span><span id="line-2225"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_hsc_src"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; HscSource
</span><a href="GHC.Driver.Make.html#nms_hsc_src"><span class="hs-identifier hs-var hs-var">nms_hsc_src</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-2226"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_location"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Make.html#nms_location"><span class="hs-identifier hs-var hs-var">nms_location</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-2227"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_mod"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; Module
</span><a href="GHC.Driver.Make.html#nms_mod"><span class="hs-identifier hs-var hs-var">nms_mod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2228"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_preimps"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; PreprocessedImports
</span><a href="GHC.Driver.Make.html#nms_preimps"><span class="hs-identifier hs-var hs-var">nms_preimps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span>
</span><span id="line-2229"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-2230"></span><span>
</span><span id="line-2231"></span><span class="annot"><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-type">makeNewModSummary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2232"></span><span id="makeNewModSummary"><span class="annot"><span class="annottext">makeNewModSummary :: HscEnv -&gt; MakeNewModSummary -&gt; IO ModSummary
</span><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-var hs-var">makeNewModSummary</span></a></span></span><span> </span><span id="local-6989586621682088677"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088677"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span class="hs-special">{</span><span id="local-6989586621682088678"><span id="local-6989586621682088679"><span id="local-6989586621682088680"><span id="local-6989586621682088681"><span id="local-6989586621682088682"><span id="local-6989586621682088683"><span id="local-6989586621682088684"><span class="annot"><span class="annottext">FilePath
Fingerprint
IsBootInterface
Module
ModLocation
HscSource
PreprocessedImports
nms_src_fn :: MakeNewModSummary -&gt; FilePath
nms_src_hash :: MakeNewModSummary -&gt; Fingerprint
nms_is_boot :: MakeNewModSummary -&gt; IsBootInterface
nms_hsc_src :: MakeNewModSummary -&gt; HscSource
nms_location :: MakeNewModSummary -&gt; ModLocation
nms_mod :: MakeNewModSummary -&gt; Module
nms_preimps :: MakeNewModSummary -&gt; PreprocessedImports
nms_src_fn :: FilePath
nms_src_hash :: Fingerprint
nms_is_boot :: IsBootInterface
nms_hsc_src :: HscSource
nms_location :: ModLocation
nms_mod :: Module
nms_preimps :: PreprocessedImports
</span><a href="GHC.Driver.Make.html#nms_src_fn"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2233"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span class="hs-special">{</span><span id="local-6989586621682088685"><span id="local-6989586621682088686"><span id="local-6989586621682088687"><span id="local-6989586621682088688"><span id="local-6989586621682088689"><span id="local-6989586621682088690"><span id="local-6989586621682088691"><span id="local-6989586621682088692"><span class="annot"><span class="annottext">Bool
FilePath
[(PkgQual, GenLocated SrcSpan ModuleName)]
ModuleName
InputFileBuffer
SrcSpan
DynFlags
pi_local_dflags :: PreprocessedImports -&gt; DynFlags
pi_srcimps :: PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_ghc_prim_import :: PreprocessedImports -&gt; Bool
pi_hspp_fn :: PreprocessedImports -&gt; FilePath
pi_hspp_buf :: PreprocessedImports -&gt; InputFileBuffer
pi_mod_name_loc :: PreprocessedImports -&gt; SrcSpan
pi_mod_name :: PreprocessedImports -&gt; ModuleName
pi_local_dflags :: DynFlags
pi_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_ghc_prim_import :: Bool
pi_hspp_fn :: FilePath
pi_hspp_buf :: InputFileBuffer
pi_mod_name_loc :: SrcSpan
pi_mod_name :: ModuleName
</span><a href="GHC.Driver.Make.html#pi_local_dflags"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreprocessedImports
</span><a href="#local-6989586621682088684"><span class="hs-identifier hs-var">nms_preimps</span></a></span><span>
</span><span id="line-2234"></span><span>  </span><span id="local-6989586621682088693"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088693"><span class="hs-identifier hs-var">obj_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088682"><span class="hs-identifier hs-var">nms_location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2235"></span><span>  </span><span id="local-6989586621682088694"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088694"><span class="hs-identifier hs-var">dyn_obj_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088682"><span class="hs-identifier hs-var">nms_location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2236"></span><span>  </span><span id="local-6989586621682088695"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088695"><span class="hs-identifier hs-var">hi_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088682"><span class="hs-identifier hs-var">nms_location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2237"></span><span>  </span><span id="local-6989586621682088696"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088696"><span class="hs-identifier hs-var">hie_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088682"><span class="hs-identifier hs-var">nms_location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2238"></span><span>
</span><span id="line-2239"></span><span>  </span><span id="local-6989586621682088697"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088697"><span class="hs-identifier hs-var">extra_sig_imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscSource -&gt; ModuleName -&gt; IO [ModuleName]
</span><a href="GHC.Tc.Utils.Backpack.html#findExtraSigImports"><span class="hs-identifier hs-var">findExtraSigImports</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088677"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682088681"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088692"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span>
</span><span id="line-2240"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682088698"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088698"><span class="hs-identifier hs-var">implicit_sigs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088699"><span class="annot"><span class="annottext">[InstantiatedUnit]
</span><a href="#local-6989586621682088699"><span class="hs-identifier hs-var">_inst_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
-&gt; IO ([ModuleName], [InstantiatedUnit])
</span><a href="GHC.Tc.Utils.Backpack.html#implicitRequirementsShallow"><span class="hs-identifier hs-var">implicitRequirementsShallow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; UnitId -&gt; HscEnv -&gt; HscEnv
UnitId -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetActiveUnitId"><span class="hs-identifier hs-var">hscSetActiveUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088683"><span class="hs-identifier hs-var">nms_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088677"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088687"><span class="hs-identifier hs-var">pi_theimps</span></a></span><span>
</span><span id="line-2241"></span><span>
</span><span id="line-2242"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-2243"></span><span>        </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2244"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_mod :: Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088683"><span class="hs-identifier hs-var">nms_mod</span></a></span><span>
</span><span id="line-2245"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hsc_src :: HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682088681"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span>
</span><span id="line-2246"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_location :: ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682088682"><span class="hs-identifier hs-var">nms_location</span></a></span><span>
</span><span id="line-2247"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_file :: FilePath
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_file"><span class="hs-identifier hs-var">ms_hspp_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088689"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span><span>
</span><span id="line-2248"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088685"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span><span>
</span><span id="line-2249"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_buf :: Maybe InputFileBuffer
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_buf"><span class="hs-identifier hs-var">ms_hspp_buf</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InputFileBuffer -&gt; Maybe InputFileBuffer
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621682088690"><span class="hs-identifier hs-var">pi_hspp_buf</span></a></span><span>
</span><span id="line-2250"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_parsed_mod :: Maybe HsParsedModule
</span><a href="GHC.Unit.Module.ModSummary.html#ms_parsed_mod"><span class="hs-identifier hs-var">ms_parsed_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HsParsedModule
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2251"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_srcimps"><span class="hs-identifier hs-var">ms_srcimps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088686"><span class="hs-identifier hs-var">pi_srcimps</span></a></span><span>
</span><span id="line-2252"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_ghc_prim_import :: Bool
</span><a href="GHC.Unit.Module.ModSummary.html#ms_ghc_prim_import"><span class="hs-identifier hs-var">ms_ghc_prim_import</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088688"><span class="hs-identifier hs-var">pi_ghc_prim_import</span></a></span><span>
</span><span id="line-2253"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_textual_imps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_textual_imps"><span class="hs-identifier hs-var">ms_textual_imps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2254"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName
 -&gt; (PkgQual, GenLocated SrcSpan ModuleName))
-&gt; (ModuleName -&gt; GenLocated SrcSpan ModuleName)
-&gt; ModuleName
-&gt; (PkgQual, GenLocated SrcSpan ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; GenLocated SrcSpan ModuleName
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; (PkgQual, GenLocated SrcSpan ModuleName))
-&gt; [ModuleName] -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088697"><span class="hs-identifier hs-var">extra_sig_imports</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2255"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PkgQual
</span><a href="GHC.Types.PkgQual.html#NoPkgQual"><span class="hs-identifier hs-var">NoPkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName
 -&gt; (PkgQual, GenLocated SrcSpan ModuleName))
-&gt; (ModuleName -&gt; GenLocated SrcSpan ModuleName)
-&gt; ModuleName
-&gt; (PkgQual, GenLocated SrcSpan ModuleName)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; GenLocated SrcSpan ModuleName
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; (PkgQual, GenLocated SrcSpan ModuleName))
-&gt; [ModuleName] -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682088698"><span class="hs-identifier hs-var">implicit_sigs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2256"></span><span>            </span><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088687"><span class="hs-identifier hs-var">pi_theimps</span></a></span><span>
</span><span id="line-2257"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hs_hash :: Fingerprint
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hs_hash"><span class="hs-identifier hs-var">ms_hs_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682088679"><span class="hs-identifier hs-var">nms_src_hash</span></a></span><span>
</span><span id="line-2258"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_iface_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088695"><span class="hs-identifier hs-var">hi_timestamp</span></a></span><span>
</span><span id="line-2259"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hie_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hie_date"><span class="hs-identifier hs-var">ms_hie_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088696"><span class="hs-identifier hs-var">hie_timestamp</span></a></span><span>
</span><span id="line-2260"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_obj_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_obj_date"><span class="hs-identifier hs-var">ms_obj_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088693"><span class="hs-identifier hs-var">obj_timestamp</span></a></span><span>
</span><span id="line-2261"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_dyn_obj_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_dyn_obj_date"><span class="hs-identifier hs-var">ms_dyn_obj_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682088694"><span class="hs-identifier hs-var">dyn_obj_timestamp</span></a></span><span>
</span><span id="line-2262"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2263"></span><span>
</span><span id="line-2264"></span><span class="hs-keyword">data</span><span> </span><span id="PreprocessedImports"><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-var">PreprocessedImports</span></a></span></span><span>
</span><span id="line-2265"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="PreprocessedImports"><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-var">PreprocessedImports</span></a></span></span><span>
</span><span id="line-2266"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="pi_local_dflags"><span class="annot"><span class="annottext">PreprocessedImports -&gt; DynFlags
</span><a href="GHC.Driver.Make.html#pi_local_dflags"><span class="hs-identifier hs-var hs-var">pi_local_dflags</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-2267"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_srcimps"><span class="annot"><span class="annottext">PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#pi_srcimps"><span class="hs-identifier hs-var hs-var">pi_srcimps</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2268"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_theimps"><span class="annot"><span class="annottext">PreprocessedImports -&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#pi_theimps"><span class="hs-identifier hs-var hs-var">pi_theimps</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.PkgQual.html#PkgQual"><span class="hs-identifier hs-type">PkgQual</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2269"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_ghc_prim_import"><span class="annot"><span class="annottext">PreprocessedImports -&gt; Bool
</span><a href="GHC.Driver.Make.html#pi_ghc_prim_import"><span class="hs-identifier hs-var hs-var">pi_ghc_prim_import</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2270"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_hspp_fn"><span class="annot"><span class="annottext">PreprocessedImports -&gt; FilePath
</span><a href="GHC.Driver.Make.html#pi_hspp_fn"><span class="hs-identifier hs-var hs-var">pi_hspp_fn</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2271"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_hspp_buf"><span class="annot"><span class="annottext">PreprocessedImports -&gt; InputFileBuffer
</span><a href="GHC.Driver.Make.html#pi_hspp_buf"><span class="hs-identifier hs-var hs-var">pi_hspp_buf</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span>
</span><span id="line-2272"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_mod_name_loc"><span class="annot"><span class="annottext">PreprocessedImports -&gt; SrcSpan
</span><a href="GHC.Driver.Make.html#pi_mod_name_loc"><span class="hs-identifier hs-var hs-var">pi_mod_name_loc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-2273"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_mod_name"><span class="annot"><span class="annottext">PreprocessedImports -&gt; ModuleName
</span><a href="GHC.Driver.Make.html#pi_mod_name"><span class="hs-identifier hs-var hs-var">pi_mod_name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-2274"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-2275"></span><span>
</span><span id="line-2276"></span><span class="hs-comment">-- Preprocess the source file and get its imports</span><span>
</span><span id="line-2277"></span><span class="hs-comment">-- The pi_local_dflags contains the OPTIONS pragmas</span><span>
</span><span id="line-2278"></span><span class="annot"><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-type">getPreprocessedImports</span></a></span><span>
</span><span id="line-2279"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2280"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2281"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>
</span><span id="line-2282"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../time-1.12.2/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2283"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ optional source code buffer and modification time</span></span><span>
</span><span id="line-2284"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#ExceptT/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span>
</span><span id="line-2285"></span><span id="getPreprocessedImports"><span class="annot"><span class="annottext">getPreprocessedImports :: HscEnv
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; ExceptT DriverMessages IO PreprocessedImports
</span><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-var hs-var">getPreprocessedImports</span></a></span></span><span> </span><span id="local-6989586621682088707"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088707"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682088708"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088708"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621682088709"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621682088709"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span> </span><span id="local-6989586621682088710"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088710"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2286"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682088711"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088711"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088712"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088712"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2287"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either DriverMessages (DynFlags, FilePath))
-&gt; ExceptT DriverMessages IO (DynFlags, FilePath)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#ExceptT/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either DriverMessages (DynFlags, FilePath))
 -&gt; ExceptT DriverMessages IO (DynFlags, FilePath))
-&gt; IO (Either DriverMessages (DynFlags, FilePath))
-&gt; ExceptT DriverMessages IO (DynFlags, FilePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; FilePath
-&gt; Maybe InputFileBuffer
-&gt; Maybe Phase
-&gt; IO (Either DriverMessages (DynFlags, FilePath))
</span><a href="GHC.Driver.Pipeline.html#preprocess"><span class="hs-identifier hs-var">preprocess</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088707"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088708"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InputFileBuffer, UTCTime) -&gt; InputFileBuffer
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((InputFileBuffer, UTCTime) -&gt; InputFileBuffer)
-&gt; Maybe (InputFileBuffer, UTCTime) -&gt; Maybe InputFileBuffer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621682088710"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621682088709"><span class="hs-identifier hs-var">mb_phase</span></a></span><span>
</span><span id="line-2288"></span><span>  </span><span id="local-6989586621682088715"><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621682088715"><span class="hs-identifier hs-var">pi_hspp_buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO InputFileBuffer -&gt; ExceptT DriverMessages IO InputFileBuffer
forall a. IO a -&gt; ExceptT DriverMessages IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO InputFileBuffer -&gt; ExceptT DriverMessages IO InputFileBuffer)
-&gt; IO InputFileBuffer -&gt; ExceptT DriverMessages IO InputFileBuffer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO InputFileBuffer
</span><a href="GHC.Data.StringBuffer.html#hGetStringBuffer"><span class="hs-identifier hs-var">hGetStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088712"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span><span>
</span><span id="line-2289"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682088717"><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088717"><span class="hs-identifier hs-var">pi_srcimps'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088718"><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088718"><span class="hs-identifier hs-var">pi_theimps'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088719"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088719"><span class="hs-identifier hs-var">pi_ghc_prim_import</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682088720"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088720"><span class="hs-identifier hs-var">pi_mod_name_loc</span></a></span></span><span> </span><span id="local-6989586621682088721"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088721"><span class="hs-identifier hs-var">pi_mod_name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2290"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO
  (Either
     DriverMessages
     ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
      [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
      GenLocated SrcSpan ModuleName))
-&gt; ExceptT
     DriverMessages
     IO
     ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
      [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
      GenLocated SrcSpan ModuleName)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Except.html#ExceptT/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either
      DriverMessages
      ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
       [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
       GenLocated SrcSpan ModuleName))
 -&gt; ExceptT
      DriverMessages
      IO
      ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
       [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
       GenLocated SrcSpan ModuleName))
-&gt; IO
     (Either
        DriverMessages
        ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
         [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
         GenLocated SrcSpan ModuleName))
-&gt; ExceptT
     DriverMessages
     IO
     ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
      [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
      GenLocated SrcSpan ModuleName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2291"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088722"><span class="annot"><span class="annottext">imp_prelude :: Bool
</span><a href="#local-6989586621682088722"><span class="hs-identifier hs-var hs-var">imp_prelude</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ImplicitPrelude</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088711"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span><span>
</span><span id="line-2292"></span><span>              </span><span id="local-6989586621682088725"><span class="annot"><span class="annottext">popts :: ParserOpts
</span><a href="#local-6989586621682088725"><span class="hs-identifier hs-var hs-var">popts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ParserOpts
</span><a href="GHC.Driver.Config.Parser.html#initParserOpts"><span class="hs-identifier hs-var">initParserOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088711"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span><span>
</span><span id="line-2293"></span><span>          </span><span id="local-6989586621682088726"><span class="annot"><span class="annottext">Either
  (Messages PsMessage)
  ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
   [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
   GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682088726"><span class="hs-identifier hs-var">mimps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ParserOpts
-&gt; Bool
-&gt; InputFileBuffer
-&gt; FilePath
-&gt; FilePath
-&gt; IO
     (Either
        (Messages PsMessage)
        ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
         [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
         GenLocated SrcSpan ModuleName))
</span><a href="GHC.Parser.Header.html#getImports"><span class="hs-identifier hs-var">getImports</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOpts
</span><a href="#local-6989586621682088725"><span class="hs-identifier hs-var">popts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682088722"><span class="hs-identifier hs-var">imp_prelude</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621682088715"><span class="hs-identifier hs-var">pi_hspp_buf</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088712"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682088708"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2294"></span><span>          </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Messages PsMessage -&gt; DriverMessages)
-&gt; Either
     (Messages PsMessage)
     ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
      [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
      GenLocated SrcSpan ModuleName)
-&gt; Either
     DriverMessages
     ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
      [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
      GenLocated SrcSpan ModuleName)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../base-4.18.2.1/src/Data.Bifunctor.html#first/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag (MsgEnvelope DriverMessage) -&gt; DriverMessages
forall e. Bag (MsgEnvelope e) -&gt; Messages e
</span><a href="GHC.Types.Error.html#mkMessages"><span class="hs-identifier hs-var">mkMessages</span></a></span><span> </span><span class="annot"><span class="annottext">(Bag (MsgEnvelope DriverMessage) -&gt; DriverMessages)
-&gt; (Messages PsMessage -&gt; Bag (MsgEnvelope DriverMessage))
-&gt; Messages PsMessage
-&gt; DriverMessages
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope PsMessage -&gt; MsgEnvelope DriverMessage)
-&gt; Bag (MsgEnvelope PsMessage) -&gt; Bag (MsgEnvelope DriverMessage)
forall a b. (a -&gt; b) -&gt; Bag a -&gt; Bag b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope PsMessage -&gt; MsgEnvelope DriverMessage
</span><a href="GHC.Driver.Errors.html#mkDriverPsHeaderMessage"><span class="hs-identifier hs-var">mkDriverPsHeaderMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(Bag (MsgEnvelope PsMessage) -&gt; Bag (MsgEnvelope DriverMessage))
-&gt; (Messages PsMessage -&gt; Bag (MsgEnvelope PsMessage))
-&gt; Messages PsMessage
-&gt; Bag (MsgEnvelope DriverMessage)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Messages PsMessage -&gt; Bag (MsgEnvelope PsMessage)
forall e. Messages e -&gt; Bag (MsgEnvelope e)
</span><a href="GHC.Types.Error.html#getMessages"><span class="hs-identifier hs-var">getMessages</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either
  (Messages PsMessage)
  ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
   [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
   GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682088726"><span class="hs-identifier hs-var">mimps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2295"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088730"><span class="annot"><span class="annottext">rn_pkg_qual :: ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="#local-6989586621682088730"><span class="hs-identifier hs-var hs-var">rn_pkg_qual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier hs-var">renameRawPkgQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088707"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2296"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088732"><span class="annot"><span class="annottext">rn_imps :: [(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088732"><span class="hs-identifier hs-var hs-var">rn_imps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((RawPkgQual, GenLocated SrcSpan ModuleName)
 -&gt; (PkgQual, GenLocated SrcSpan ModuleName))
-&gt; [(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682088733"><span class="annot"><span class="annottext">RawPkgQual
</span><a href="#local-6989586621682088733"><span class="hs-identifier hs-var">pk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088734"><span class="annot"><span class="annottext">lmn :: GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682088734"><span class="hs-identifier hs-var">lmn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682088735"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088735"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="#local-6989586621682088730"><span class="hs-identifier hs-var">rn_pkg_qual</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088735"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">RawPkgQual
</span><a href="#local-6989586621682088733"><span class="hs-identifier hs-var">pk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682088734"><span class="hs-identifier hs-var">lmn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2297"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088736"><span class="annot"><span class="annottext">pi_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088736"><span class="hs-identifier hs-var hs-var">pi_srcimps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088732"><span class="hs-identifier hs-var">rn_imps</span></a></span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088717"><span class="hs-identifier hs-var">pi_srcimps'</span></a></span><span>
</span><span id="line-2298"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088737"><span class="annot"><span class="annottext">pi_theimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088737"><span class="hs-identifier hs-var hs-var">pi_theimps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088732"><span class="hs-identifier hs-var">rn_imps</span></a></span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682088718"><span class="hs-identifier hs-var">pi_theimps'</span></a></span><span>
</span><span id="line-2299"></span><span>  </span><span class="annot"><span class="annottext">PreprocessedImports
-&gt; ExceptT DriverMessages IO PreprocessedImports
forall a. a -&gt; ExceptT DriverMessages IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Bool
FilePath
[(PkgQual, GenLocated SrcSpan ModuleName)]
ModuleName
InputFileBuffer
SrcSpan
DynFlags
pi_local_dflags :: DynFlags
pi_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_ghc_prim_import :: Bool
pi_hspp_fn :: FilePath
pi_hspp_buf :: InputFileBuffer
pi_mod_name_loc :: SrcSpan
pi_mod_name :: ModuleName
pi_local_dflags :: DynFlags
pi_hspp_fn :: FilePath
pi_hspp_buf :: InputFileBuffer
pi_ghc_prim_import :: Bool
pi_mod_name_loc :: SrcSpan
pi_mod_name :: ModuleName
pi_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
pi_theimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#pi_local_dflags"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2300"></span><span>
</span><span id="line-2301"></span><span>
</span><span id="line-2302"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2303"></span><span class="hs-comment">--                      Error messages</span><span>
</span><span id="line-2304"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2305"></span><span>
</span><span id="line-2306"></span><span class="hs-comment">-- Defer and group warning, error and fatal messages so they will not get lost</span><span>
</span><span id="line-2307"></span><span class="hs-comment">-- in the regular output.</span><span>
</span><span id="line-2308"></span><span id="local-6989586621682085918"><span id="local-6989586621682085919"><span class="annot"><a href="GHC.Driver.Make.html#withDeferredDiagnostics"><span class="hs-identifier hs-type">withDeferredDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085918"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085918"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085919"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682085918"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682085919"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-2309"></span><span id="withDeferredDiagnostics"><span class="annot"><span class="annottext">withDeferredDiagnostics :: forall (m :: * -&gt; *) a. GhcMonad m =&gt; m a -&gt; m a
</span><a href="GHC.Driver.Make.html#withDeferredDiagnostics"><span class="hs-identifier hs-var hs-var">withDeferredDiagnostics</span></a></span></span><span> </span><span id="local-6989586621682088772"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682088772"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2310"></span><span>  </span><span id="local-6989586621682088773"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088773"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2311"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_DeferDiagnostics"><span class="hs-identifier hs-var">Opt_DeferDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088773"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2312"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682088772"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-2313"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2314"></span><span>    </span><span id="local-6989586621682088775"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088775"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef [IO ()]) -&gt; m (IORef [IO ()]))
-&gt; IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO (IORef [IO ()])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2315"></span><span>    </span><span id="local-6989586621682088776"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088776"><span class="hs-identifier hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef [IO ()]) -&gt; m (IORef [IO ()]))
-&gt; IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO (IORef [IO ()])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2316"></span><span>    </span><span id="local-6989586621682088777"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088777"><span class="hs-identifier hs-var">fatals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef [IO ()]) -&gt; m (IORef [IO ()]))
-&gt; IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO (IORef [IO ()])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2317"></span><span>    </span><span id="local-6989586621682088778"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088778"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-2318"></span><span>
</span><span id="line-2319"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088780"><span class="annot"><span class="annottext">deferDiagnostics :: LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="#local-6989586621682088780"><span class="hs-identifier hs-var hs-var">deferDiagnostics</span></a></span></span><span> </span><span id="local-6989586621682088781"><span class="annot"><span class="annottext">LogFlags
</span><a href="#local-6989586621682088781"><span class="hs-identifier hs-var">_dflags</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682088782"><span class="annot"><span class="annottext">MessageClass
</span><a href="#local-6989586621682088782"><span class="hs-identifier hs-var">msgClass</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682088783"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088783"><span class="hs-identifier hs-var">srcSpan</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682088784"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682088784"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2320"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088785"><span class="annot"><span class="annottext">action :: IO ()
</span><a href="#local-6989586621682088785"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#logMsg"><span class="hs-identifier hs-var">logMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088778"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">MessageClass
</span><a href="#local-6989586621682088782"><span class="hs-identifier hs-var">msgClass</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088783"><span class="hs-identifier hs-var">srcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682088784"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-2321"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MessageClass
</span><a href="#local-6989586621682088782"><span class="hs-identifier hs-var">msgClass</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2322"></span><span>            </span><span class="annot"><a href="GHC.Types.Error.html#MCDiagnostic"><span class="hs-identifier hs-type">MCDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Types.Error.html#SevWarning"><span class="hs-identifier hs-var">SevWarning</span></a></span><span> </span><span id="local-6989586621682088789"><span class="annot"><span class="annottext">DiagnosticReason
</span><a href="#local-6989586621682088789"><span class="hs-identifier hs-var">_reason</span></a></span></span><span> </span><span id="local-6989586621682088790"><span class="annot"><span class="annottext">Maybe DiagnosticCode
</span><a href="#local-6989586621682088790"><span class="hs-identifier hs-var">_code</span></a></span></span><span>
</span><span id="line-2323"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#atomicModifyIORef%27/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088775"><span class="hs-identifier hs-var">warnings</span></a></span><span> </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], ())) -&gt; IO ())
-&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621682088791"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088791"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682088785"><span class="hs-identifier hs-var">action</span></a></span><span class="annot"><span class="annottext">IO () -&gt; [IO ()] -&gt; [IO ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088791"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2324"></span><span>            </span><span class="annot"><a href="GHC.Types.Error.html#MCDiagnostic"><span class="hs-identifier hs-type">MCDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Types.Error.html#SevError"><span class="hs-identifier hs-var">SevError</span></a></span><span> </span><span id="local-6989586621682088793"><span class="annot"><span class="annottext">DiagnosticReason
</span><a href="#local-6989586621682088793"><span class="hs-identifier hs-var">_reason</span></a></span></span><span> </span><span id="local-6989586621682088794"><span class="annot"><span class="annottext">Maybe DiagnosticCode
</span><a href="#local-6989586621682088794"><span class="hs-identifier hs-var">_code</span></a></span></span><span>
</span><span id="line-2325"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#atomicModifyIORef%27/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088776"><span class="hs-identifier hs-var">errors</span></a></span><span>   </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], ())) -&gt; IO ())
-&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621682088795"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088795"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682088785"><span class="hs-identifier hs-var">action</span></a></span><span class="annot"><span class="annottext">IO () -&gt; [IO ()] -&gt; [IO ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088795"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2326"></span><span>            </span><span class="annot"><span class="annottext">MessageClass
</span><a href="GHC.Types.Error.html#MCFatal"><span class="hs-identifier hs-var">MCFatal</span></a></span><span>
</span><span id="line-2327"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#atomicModifyIORef%27/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088777"><span class="hs-identifier hs-var">fatals</span></a></span><span>   </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], ())) -&gt; IO ())
-&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621682088797"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088797"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682088785"><span class="hs-identifier hs-var">action</span></a></span><span class="annot"><span class="annottext">IO () -&gt; [IO ()] -&gt; [IO ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088797"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2328"></span><span>            </span><span class="annot"><span class="annottext">MessageClass
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682088785"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-2329"></span><span>
</span><span id="line-2330"></span><span>        </span><span id="local-6989586621682088798"><span class="annot"><span class="annottext">printDeferredDiagnostics :: m ()
</span><a href="#local-6989586621682088798"><span class="hs-identifier hs-var hs-var">printDeferredDiagnostics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2331"></span><span>          </span><span class="annot"><span class="annottext">[IORef [IO ()]] -&gt; (IORef [IO ()] -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#forM_/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088775"><span class="hs-identifier hs-var">warnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088776"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088777"><span class="hs-identifier hs-var">fatals</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((IORef [IO ()] -&gt; IO ()) -&gt; IO ())
-&gt; (IORef [IO ()] -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088800"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088800"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2332"></span><span>            </span><span class="hs-comment">-- This IORef can leak when the dflags leaks, so let us always</span><span>
</span><span id="line-2333"></span><span>            </span><span class="hs-comment">-- reset the content. The lazy variant is used here as we want to force</span><span>
</span><span id="line-2334"></span><span>            </span><span class="hs-comment">-- this error if the IORef is ever accessed again, rather than now.</span><span>
</span><span id="line-2335"></span><span>            </span><span class="hs-comment">-- See #20981 for an issue which discusses this general issue.</span><span>
</span><span id="line-2336"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088803"><span class="annot"><span class="annottext">landmine :: [a]
</span><a href="#local-6989586621682088803"><span class="hs-identifier hs-var hs-var">landmine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [a]
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;withDeferredDiagnostics: use after free&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2337"></span><span>            </span><span id="local-6989586621682088806"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088806"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], [IO ()])) -&gt; IO [IO ()]
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base-4.18.2.1/src/Data.IORef.html#atomicModifyIORef/Data.IORef.html#atomicModifyIORef"><span class="hs-identifier hs-var">atomicModifyIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621682088800"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], [IO ()])) -&gt; IO [IO ()])
-&gt; ([IO ()] -&gt; ([IO ()], [IO ()])) -&gt; IO [IO ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088808"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088808"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IO ()]
forall a. [a]
</span><a href="#local-6989586621682088803"><span class="hs-identifier hs-var">landmine</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088808"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2338"></span><span>            </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#sequence_/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="annot"><span class="annottext">([IO ()] -&gt; IO ()) -&gt; [IO ()] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; [IO ()]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621682088806"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-2339"></span><span>
</span><span id="line-2340"></span><span>    </span><span class="annot"><span class="annottext">m () -&gt; (() -&gt; m ()) -&gt; (() -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a c b.
(HasCallStack, MonadMask m) =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#bracket/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span>
</span><span id="line-2341"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
 -&gt; LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
-&gt; m ()
forall (m :: * -&gt; *).
GhcMonad m =&gt;
((LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
 -&gt; LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
-&gt; m ()
</span><a href="GHC.Driver.Monad.html#pushLogHookM"><span class="hs-identifier hs-var">pushLogHookM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
-&gt; (LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
-&gt; LogFlags
-&gt; MessageClass
-&gt; SrcSpan
-&gt; SDoc
-&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="#local-6989586621682088780"><span class="hs-identifier hs-var">deferDiagnostics</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2342"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; m ()
</span><a href="GHC.Driver.Monad.html#popLogHookM"><span class="hs-identifier hs-var">popLogHookM</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3E%3E/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621682088798"><span class="hs-identifier hs-var">printDeferredDiagnostics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2343"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621682088772"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2344"></span><span>
</span><span id="line-2345"></span><span class="annot"><a href="GHC.Driver.Make.html#noModError"><span class="hs-identifier hs-type">noModError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.Types.html#FindResult"><span class="hs-identifier hs-type">FindResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#MsgEnvelope"><span class="hs-identifier hs-type">MsgEnvelope</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span>
</span><span id="line-2346"></span><span class="hs-comment">-- ToDo: we don't have a proper line number for this error</span><span>
</span><span id="line-2347"></span><span id="noModError"><span class="annot"><span class="annottext">noModError :: HscEnv
-&gt; SrcSpan -&gt; ModuleName -&gt; FindResult -&gt; MsgEnvelope GhcMessage
</span><a href="GHC.Driver.Make.html#noModError"><span class="hs-identifier hs-var hs-var">noModError</span></a></span></span><span> </span><span id="local-6989586621682088813"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088813"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682088814"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088814"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682088815"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088815"><span class="hs-identifier hs-var">wanted_mod</span></a></span></span><span> </span><span id="local-6989586621682088816"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682088816"><span class="hs-identifier hs-var">err</span></a></span></span><span>
</span><span id="line-2348"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682088814"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcMessage -&gt; MsgEnvelope GhcMessage)
-&gt; GhcMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage) -&gt; DriverMessage -&gt; GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2349"></span><span>    </span><span class="annot"><span class="annottext">UnknownDiagnostic -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverUnknownMessage"><span class="hs-identifier hs-var">DriverUnknownMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(UnknownDiagnostic -&gt; DriverMessage)
-&gt; UnknownDiagnostic -&gt; DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticMessage -&gt; UnknownDiagnostic
forall a.
(DiagnosticOpts a ~ NoDiagnosticOpts, Diagnostic a, Typeable a) =&gt;
a -&gt; UnknownDiagnostic
</span><a href="GHC.Types.Error.html#UnknownDiagnostic"><span class="hs-identifier hs-var">UnknownDiagnostic</span></a></span><span> </span><span class="annot"><span class="annottext">(DiagnosticMessage -&gt; UnknownDiagnostic)
-&gt; DiagnosticMessage -&gt; UnknownDiagnostic
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint] -&gt; SDoc -&gt; DiagnosticMessage
</span><a href="GHC.Types.Error.html#mkPlainError"><span class="hs-identifier hs-var">mkPlainError</span></a></span><span> </span><span class="annot"><span class="annottext">[GhcHint]
</span><a href="GHC.Types.Error.html#noHints"><span class="hs-identifier hs-var">noHints</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; DiagnosticMessage) -&gt; SDoc -&gt; DiagnosticMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2350"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; FindResult -&gt; SDoc
</span><a href="GHC.Iface.Errors.html#cannotFindModule"><span class="hs-identifier hs-var">cannotFindModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088813"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088815"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621682088816"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2351"></span><span>
</span><span id="line-2352"></span><span class="hs-comment">{-
noHsFileErr :: SrcSpan -&gt; String -&gt; DriverMessages
noHsFileErr loc path
  = singleMessage $ mkPlainErrorMsgEnvelope loc (DriverFileNotFound path)
  -}</span><span>
</span><span id="line-2357"></span><span>
</span><span id="line-2358"></span><span class="annot"><a href="GHC.Driver.Make.html#moduleNotFoundErr"><span class="hs-identifier hs-type">moduleNotFoundErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#DriverMessages"><span class="hs-identifier hs-type">DriverMessages</span></a></span><span>
</span><span id="line-2359"></span><span id="moduleNotFoundErr"><span class="annot"><span class="annottext">moduleNotFoundErr :: ModuleName -&gt; DriverMessages
</span><a href="GHC.Driver.Make.html#moduleNotFoundErr"><span class="hs-identifier hs-var hs-var">moduleNotFoundErr</span></a></span></span><span> </span><span id="local-6989586621682088821"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088821"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DriverMessage -&gt; DriverMessages
forall e. MsgEnvelope e -&gt; Messages e
</span><a href="GHC.Types.Error.html#singleMessage"><span class="hs-identifier hs-var">singleMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; DriverMessages)
-&gt; MsgEnvelope DriverMessage -&gt; DriverMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverModuleNotFound"><span class="hs-identifier hs-var">DriverModuleNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088821"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2360"></span><span>
</span><span id="line-2361"></span><span class="annot"><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-type">multiRootsErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2362"></span><span id="multiRootsErr"><span class="annot"><span class="annottext">multiRootsErr :: [ModSummary] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-var hs-var">multiRootsErr</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;multiRootsErr&quot;</span></span><span>
</span><span id="line-2363"></span><span class="annot"><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-var">multiRootsErr</span></a></span><span> </span><span id="local-6989586621682088823"><span class="annot"><span class="annottext">summs :: [ModSummary]
</span><a href="#local-6989586621682088823"><span class="hs-identifier hs-var">summs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682088824"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">summ1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[ModSummary]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2364"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope GhcMessage -&gt; IO ()
forall (io :: * -&gt; *) a.
MonadIO io =&gt;
MsgEnvelope GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope GhcMessage -&gt; IO ())
-&gt; MsgEnvelope GhcMessage -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; GhcMessage)
-&gt; MsgEnvelope DriverMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; MsgEnvelope a -&gt; MsgEnvelope b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">DriverMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcDriverMessage"><span class="hs-identifier hs-var">GhcDriverMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgEnvelope DriverMessage -&gt; MsgEnvelope GhcMessage)
-&gt; MsgEnvelope DriverMessage -&gt; MsgEnvelope GhcMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2365"></span><span>    </span><span class="annot"><span class="annottext">SrcSpan -&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall e. Diagnostic e =&gt; SrcSpan -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkPlainErrorMsgEnvelope"><span class="hs-identifier hs-var">mkPlainErrorMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(DriverMessage -&gt; MsgEnvelope DriverMessage)
-&gt; DriverMessage -&gt; MsgEnvelope DriverMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; [FilePath] -&gt; DriverMessage
</span><a href="GHC.Driver.Errors.Types.html#DriverDuplicatedModuleDeclaration"><span class="hs-identifier hs-var">DriverDuplicatedModuleDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682088827"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621682088828"><span class="hs-identifier hs-var">files</span></a></span><span>
</span><span id="line-2366"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2367"></span><span>    </span><span id="local-6989586621682088827"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621682088827"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088824"><span class="hs-identifier hs-var">summ1</span></a></span><span>
</span><span id="line-2368"></span><span>    </span><span id="local-6989586621682088828"><span class="annot"><span class="annottext">files :: [FilePath]
</span><a href="#local-6989586621682088828"><span class="hs-identifier hs-var hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; FilePath) -&gt; [ModSummary] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;checkDup&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe FilePath -&gt; FilePath)
-&gt; (ModSummary -&gt; Maybe FilePath) -&gt; ModSummary -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">(ModLocation -&gt; Maybe FilePath)
-&gt; (ModSummary -&gt; ModLocation) -&gt; ModSummary -&gt; Maybe FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621682088823"><span class="hs-identifier hs-var">summs</span></a></span><span>
</span><span id="line-2369"></span><span>
</span><span id="line-2370"></span><span class="annot"><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier hs-type">cyclicModuleErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2371"></span><span class="hs-comment">-- From a strongly connected component we find</span><span>
</span><span id="line-2372"></span><span class="hs-comment">-- a single cycle to report</span><span>
</span><span id="line-2373"></span><span id="cyclicModuleErr"><span class="annot"><span class="annottext">cyclicModuleErr :: [ModuleGraphNode] -&gt; SDoc
</span><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier hs-var hs-var">cyclicModuleErr</span></a></span></span><span> </span><span id="local-6989586621682088829"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088829"><span class="hs-identifier hs-var">mss</span></a></span></span><span>
</span><span id="line-2374"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088829"><span class="hs-identifier hs-var">mss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2375"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Node NodeKey ModuleGraphNode] -&gt; Maybe [ModuleGraphNode]
forall payload key.
Ord key =&gt;
[Node key payload] -&gt; Maybe [payload]
</span><a href="GHC.Data.Graph.Directed.html#findCycle"><span class="hs-identifier hs-var">findCycle</span></a></span><span> </span><span class="annot"><span class="annottext">[Node NodeKey ModuleGraphNode]
</span><a href="#local-6989586621682088832"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2376"></span><span>       </span><span class="annot"><span class="annottext">Maybe [ModuleGraphNode]
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Unexpected non-cycle&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088829"><span class="hs-identifier hs-var">mss</span></a></span><span>
</span><span id="line-2377"></span><span>       </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682088833"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088833"><span class="hs-identifier hs-var">path0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-2378"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Module graph contains a cycle:&quot;</span></span><span>
</span><span id="line-2379"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; SDoc
</span><a href="#local-6989586621682088835"><span class="hs-identifier hs-var">show_path</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088833"><span class="hs-identifier hs-var">path0</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2380"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2381"></span><span>    </span><span class="annot"><a href="#local-6989586621682088832"><span class="hs-identifier hs-type">graph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2382"></span><span>    </span><span id="local-6989586621682088832"><span class="annot"><span class="annottext">graph :: [Node NodeKey ModuleGraphNode]
</span><a href="#local-6989586621682088832"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2383"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-type">DigraphNode</span></a></span><span>
</span><span id="line-2384"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">node_payload :: ModuleGraphNode
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var">node_payload</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088836"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2385"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node_key :: NodeKey
</span><a href="GHC.Data.Graph.Directed.html#node_key"><span class="hs-identifier hs-var">node_key</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; NodeKey
</span><a href="GHC.Unit.Module.Graph.html#mkNodeKey"><span class="hs-identifier hs-var">mkNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088836"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2386"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">node_dependencies :: [NodeKey]
</span><a href="GHC.Data.Graph.Directed.html#node_dependencies"><span class="hs-identifier hs-var">node_dependencies</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleGraphNode -&gt; [NodeKey]
</span><a href="GHC.Unit.Module.Graph.html#nodeDependencies"><span class="hs-identifier hs-var">nodeDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088836"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2387"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2388"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682088836"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088836"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088829"><span class="hs-identifier hs-var">mss</span></a></span><span>
</span><span id="line-2389"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-2390"></span><span>
</span><span id="line-2391"></span><span>    </span><span class="annot"><a href="#local-6989586621682088835"><span class="hs-identifier hs-type">show_path</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2392"></span><span>    </span><span id="local-6989586621682088835"><span class="annot"><span class="annottext">show_path :: [ModuleGraphNode] -&gt; SDoc
</span><a href="#local-6989586621682088835"><span class="hs-identifier hs-var hs-var">show_path</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;show_path&quot;</span></span><span>
</span><span id="line-2393"></span><span>    </span><span class="annot"><a href="#local-6989586621682088835"><span class="hs-identifier hs-var">show_path</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682088838"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088838"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621682088839"><span class="hs-identifier hs-var">ppr_node</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088838"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;imports itself&quot;</span></span><span>
</span><span id="line-2394"></span><span>    </span><span class="annot"><a href="#local-6989586621682088835"><span class="hs-identifier hs-var">show_path</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088840"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088840"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682088841"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088841"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682088842"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088842"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621682088839"><span class="hs-identifier hs-var">ppr_node</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088840"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2395"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;imports&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621682088839"><span class="hs-identifier hs-var">ppr_node</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088841"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2396"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [SDoc]
</span><a href="#local-6989586621682088843"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088842"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2397"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-2398"></span><span>         </span><span id="local-6989586621682088843"><span class="annot"><span class="annottext">go :: [ModuleGraphNode] -&gt; [SDoc]
</span><a href="#local-6989586621682088843"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;which imports&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621682088839"><span class="hs-identifier hs-var">ppr_node</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088840"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2399"></span><span>         </span><span class="annot"><a href="#local-6989586621682088843"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088844"><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088844"><span class="hs-identifier hs-var">m</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682088845"><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088845"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;which imports&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621682088839"><span class="hs-identifier hs-var">ppr_node</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><a href="#local-6989586621682088844"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode] -&gt; [SDoc]
</span><a href="#local-6989586621682088843"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleGraphNode]
</span><a href="#local-6989586621682088845"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2400"></span><span>
</span><span id="line-2401"></span><span>    </span><span class="annot"><a href="#local-6989586621682088839"><span class="hs-identifier hs-type">ppr_node</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleGraphNode"><span class="hs-identifier hs-type">ModuleGraphNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2402"></span><span>    </span><span id="local-6989586621682088839"><span class="annot"><span class="annottext">ppr_node :: ModuleGraphNode -&gt; SDoc
</span><a href="#local-6989586621682088839"><span class="hs-identifier hs-var hs-var">ppr_node</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#ModuleNode"><span class="hs-identifier hs-type">ModuleNode</span></a></span><span> </span><span id="local-6989586621682088846"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088846"><span class="hs-identifier hs-var">_deps</span></a></span></span><span> </span><span id="local-6989586621682088847"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088847"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
</span><a href="#local-6989586621682088848"><span class="hs-identifier hs-var">ppr_ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088847"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2403"></span><span>    </span><span class="annot"><a href="#local-6989586621682088839"><span class="hs-identifier hs-var">ppr_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#InstantiationNode"><span class="hs-identifier hs-type">InstantiationNode</span></a></span><span> </span><span id="local-6989586621682088849"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088849"><span class="hs-identifier hs-var">_uid</span></a></span></span><span> </span><span id="local-6989586621682088850"><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088850"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;instantiated unit&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088850"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-2404"></span><span>    </span><span class="annot"><a href="#local-6989586621682088839"><span class="hs-identifier hs-var">ppr_node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#LinkNode"><span class="hs-identifier hs-type">LinkNode</span></a></span><span> </span><span id="local-6989586621682088851"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088851"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; SDoc
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;LinkNode should not be in a cycle&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682088851"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2405"></span><span>
</span><span id="line-2406"></span><span>    </span><span class="annot"><a href="#local-6989586621682088848"><span class="hs-identifier hs-type">ppr_ms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2407"></span><span>    </span><span id="local-6989586621682088848"><span class="annot"><span class="annottext">ppr_ms :: ModSummary -&gt; SDoc
</span><a href="#local-6989586621682088848"><span class="hs-identifier hs-var hs-var">ppr_ms</span></a></span></span><span> </span><span id="local-6989586621682088852"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088852"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088852"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2408"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; FilePath
</span><a href="GHC.Unit.Module.ModSummary.html#msHsFilePath"><span class="hs-identifier hs-var">msHsFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088852"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2409"></span><span>
</span><span id="line-2410"></span><span>
</span><span id="line-2411"></span><span id="local-6989586621682086252"><span class="annot"><a href="GHC.Driver.Make.html#cleanCurrentModuleTempFilesMaybe"><span class="hs-identifier hs-type">cleanCurrentModuleTempFilesMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#MonadIO/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086252"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682086252"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2412"></span><span id="cleanCurrentModuleTempFilesMaybe"><span class="annot"><span class="annottext">cleanCurrentModuleTempFilesMaybe :: forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger -&gt; TmpFs -&gt; DynFlags -&gt; m ()
</span><a href="GHC.Driver.Make.html#cleanCurrentModuleTempFilesMaybe"><span class="hs-identifier hs-var hs-var">cleanCurrentModuleTempFilesMaybe</span></a></span></span><span> </span><span id="local-6989586621682088859"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088859"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682088860"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088860"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682088861"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088861"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2413"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepTmpFiles"><span class="hs-identifier hs-var">Opt_KeepTmpFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088861"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2414"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Logger -&gt; TmpFs -&gt; IO ()
Logger -&gt; TmpFs -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#keepCurrentModuleTempFiles"><span class="hs-identifier hs-var">keepCurrentModuleTempFiles</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088859"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088860"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-2415"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#cleanCurrentModuleTempFiles"><span class="hs-identifier hs-var">cleanCurrentModuleTempFiles</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088859"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682088860"><span class="hs-identifier hs-var">tmpfs</span></a></span><span>
</span><span id="line-2416"></span><span>
</span><span id="line-2417"></span><span>
</span><span id="line-2418"></span><span class="annot"><a href="GHC.Driver.Make.html#addDepsToHscEnv"><span class="hs-identifier hs-type">addDepsToHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2419"></span><span id="addDepsToHscEnv"><span class="annot"><span class="annottext">addDepsToHscEnv :: [HomeModInfo] -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#addDepsToHscEnv"><span class="hs-identifier hs-var hs-var">addDepsToHscEnv</span></a></span></span><span> </span><span id="local-6989586621682088865"><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682088865"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682088866"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088866"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2420"></span><span>  </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHUG"><span class="hs-identifier hs-var">hscUpdateHUG</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682088867"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088867"><span class="hs-identifier hs-var">hug</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo
 -&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; [HomeModInfo]
-&gt; UnitEnvGraph HomeUnitEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv
</span><a href="GHC.Unit.Env.html#addHomeModInfoToHug"><span class="hs-identifier hs-var">addHomeModInfoToHug</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088867"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682088865"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088866"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2421"></span><span>
</span><span id="line-2422"></span><span class="annot"><a href="GHC.Driver.Make.html#setHPT"><span class="hs-identifier hs-type">setHPT</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2423"></span><span id="setHPT"><span class="annot"><span class="annottext">setHPT :: HomePackageTable -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#setHPT"><span class="hs-identifier hs-var hs-var">setHPT</span></a></span></span><span> </span><span id="local-6989586621682088869"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682088869"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682088870"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088870"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2424"></span><span>  </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHPT"><span class="hs-identifier hs-var">hscUpdateHPT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomePackageTable -&gt; HomePackageTable -&gt; HomePackageTable
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; HomePackageTable -&gt; HomePackageTable)
-&gt; HomePackageTable -&gt; HomePackageTable -&gt; HomePackageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682088869"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088870"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2425"></span><span>
</span><span id="line-2426"></span><span class="annot"><a href="GHC.Driver.Make.html#setHUG"><span class="hs-identifier hs-type">setHUG</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2427"></span><span id="setHUG"><span class="annot"><span class="annottext">setHUG :: UnitEnvGraph HomeUnitEnv -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#setHUG"><span class="hs-identifier hs-var hs-var">setHUG</span></a></span></span><span> </span><span id="local-6989586621682088871"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088871"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682088872"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088872"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2428"></span><span>  </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHUG"><span class="hs-identifier hs-var">hscUpdateHUG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
-&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitEnvGraph HomeUnitEnv
 -&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; UnitEnvGraph HomeUnitEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088871"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088872"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2429"></span><span>
</span><span id="line-2430"></span><span class="annot"><span class="hs-comment">-- | Wrap an action to catch and handle exceptions.</span></span><span>
</span><span id="line-2431"></span><span id="local-6989586621682086254"><span class="annot"><a href="GHC.Driver.Make.html#wrapAction"><span class="hs-identifier hs-type">wrapAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682086254"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086254"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2432"></span><span id="wrapAction"><span class="annot"><span class="annottext">wrapAction :: forall a. HscEnv -&gt; IO a -&gt; IO (Maybe a)
</span><a href="GHC.Driver.Make.html#wrapAction"><span class="hs-identifier hs-var hs-var">wrapAction</span></a></span></span><span> </span><span id="local-6989586621682088896"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088896"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682088897"><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682088897"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2433"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088898"><span class="annot"><span class="annottext">lcl_logger :: Logger
</span><a href="#local-6989586621682088898"><span class="hs-identifier hs-var hs-var">lcl_logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088896"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2434"></span><span>      </span><span id="local-6989586621682088899"><span class="annot"><span class="annottext">lcl_dynflags :: DynFlags
</span><a href="#local-6989586621682088899"><span class="hs-identifier hs-var hs-var">lcl_dynflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088896"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2435"></span><span>      </span><span id="local-6989586621682088900"><span class="annot"><span class="annottext">print_config :: DiagnosticOpts GhcMessage
</span><a href="#local-6989586621682088900"><span class="hs-identifier hs-var hs-var">print_config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagnosticOpts GhcMessage
</span><a href="GHC.Driver.Config.Diagnostic.html#initPrintConfig"><span class="hs-identifier hs-var">initPrintConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088899"><span class="hs-identifier hs-var">lcl_dynflags</span></a></span><span>
</span><span id="line-2436"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088902"><span class="annot"><span class="annottext">logg :: SourceError -&gt; IO ()
</span><a href="#local-6989586621682088902"><span class="hs-identifier hs-var hs-var">logg</span></a></span></span><span> </span><span id="local-6989586621682088903"><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621682088903"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; DiagnosticOpts GhcMessage
-&gt; DiagOpts
-&gt; Messages GhcMessage
-&gt; IO ()
forall a.
Diagnostic a =&gt;
Logger -&gt; DiagnosticOpts a -&gt; DiagOpts -&gt; Messages a -&gt; IO ()
</span><a href="GHC.Driver.Errors.html#printMessages"><span class="hs-identifier hs-var">printMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088898"><span class="hs-identifier hs-var">lcl_logger</span></a></span><span> </span><span class="annot"><span class="annottext">DiagnosticOpts GhcMessage
</span><a href="#local-6989586621682088900"><span class="hs-identifier hs-var">print_config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088899"><span class="hs-identifier hs-var">lcl_dynflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceError -&gt; Messages GhcMessage
</span><a href="GHC.Types.SourceError.html#srcErrorMessages"><span class="hs-identifier hs-var">srcErrorMessages</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621682088903"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2437"></span><span>  </span><span class="hs-comment">-- MP: It is a bit strange how prettyPrintGhcErrors handles some errors but then we handle</span><span>
</span><span id="line-2438"></span><span>  </span><span class="hs-comment">-- SourceError and ThreadKilled differently directly below. TODO: Refactor to use `catches`</span><span>
</span><span id="line-2439"></span><span>  </span><span class="hs-comment">-- directly. MP should probably use safeTry here to not catch async exceptions but that will regress performance due to</span><span>
</span><span id="line-2440"></span><span>  </span><span class="hs-comment">-- internally using forkIO.</span><span>
</span><span id="line-2441"></span><span>  </span><span id="local-6989586621682088906"><span class="annot"><span class="annottext">Either SomeException a
</span><a href="#local-6989586621682088906"><span class="hs-identifier hs-var">mres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Either SomeException a)
forall (m :: * -&gt; *) e a.
(HasCallStack, MonadCatch m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#try/Control.Monad.Catch.html#try"><span class="hs-identifier hs-var">MC.try</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Either SomeException a))
-&gt; IO a -&gt; IO (Either SomeException a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; IO a -&gt; IO a
forall (m :: * -&gt; *) a. ExceptionMonad m =&gt; Logger -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#prettyPrintGhcErrors"><span class="hs-identifier hs-var">prettyPrintGhcErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088898"><span class="hs-identifier hs-var">lcl_logger</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO a
</span><a href="#local-6989586621682088897"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-2442"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException a
</span><a href="#local-6989586621682088906"><span class="hs-identifier hs-var">mres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2443"></span><span>    </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682088909"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682088909"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; IO (Maybe a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; IO (Maybe a)) -&gt; Maybe a -&gt; IO (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682088909"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-2444"></span><span>    </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682088910"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682088910"><span class="hs-identifier hs-var">exc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2445"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe SourceError
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="../../base-4.18.2.1/src/GHC.Exception.Type.html#fromException/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682088910"><span class="hs-identifier hs-var">exc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2446"></span><span>          </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088912"><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621682088912"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceError.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2447"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceError -&gt; IO ()
</span><a href="#local-6989586621682088902"><span class="hs-identifier hs-var">logg</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621682088912"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2448"></span><span>          </span><span class="annot"><span class="annottext">Maybe SourceError
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe SomeAsyncException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="../../base-4.18.2.1/src/GHC.Exception.Type.html#fromException/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682088910"><span class="hs-identifier hs-var">exc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2449"></span><span>                        </span><span class="hs-comment">-- ThreadKilled in particular needs to actually kill the thread.</span><span>
</span><span id="line-2450"></span><span>                        </span><span class="hs-comment">-- So rethrow that and the other async exceptions</span><span>
</span><span id="line-2451"></span><span>                        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088913"><span class="annot"><span class="annottext">SomeAsyncException
</span><a href="#local-6989586621682088913"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.Exception.html#SomeAsyncException/GHC.IO.Exception.html#SomeAsyncException"><span class="hs-identifier hs-type">SomeAsyncException</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeAsyncException -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../base-4.18.2.1/src/GHC.IO.html#throwIO/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">SomeAsyncException
</span><a href="#local-6989586621682088913"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2452"></span><span>                        </span><span class="annot"><span class="annottext">Maybe SomeAsyncException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088898"><span class="hs-identifier hs-var">lcl_logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621682088910"><span class="hs-identifier hs-var">exc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2453"></span><span>        </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2454"></span><span>
</span><span id="line-2455"></span><span id="local-6989586621682086272"><span class="annot"><a href="GHC.Driver.Make.html#withParLog"><span class="hs-identifier hs-type">withParLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#TVar/GHC.Conc.Sync.html#TVar"><span class="hs-identifier hs-type">TVar</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.LogQueue.html#LogQueueQueue"><span class="hs-identifier hs-type">LogQueueQueue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682086272"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682086272"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-2456"></span><span id="withParLog"><span class="annot"><span class="annottext">withParLog :: forall b.
TVar LogQueueQueue -&gt; Int -&gt; ((Logger -&gt; Logger) -&gt; IO b) -&gt; IO b
</span><a href="GHC.Driver.Make.html#withParLog"><span class="hs-identifier hs-var hs-var">withParLog</span></a></span></span><span> </span><span id="local-6989586621682088921"><span class="annot"><span class="annottext">TVar LogQueueQueue
</span><a href="#local-6989586621682088921"><span class="hs-identifier hs-var">lqq_var</span></a></span></span><span> </span><span id="local-6989586621682088922"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088922"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682088923"><span class="annot"><span class="annottext">(Logger -&gt; Logger) -&gt; IO b
</span><a href="#local-6989586621682088923"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2457"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088924"><span class="annot"><span class="annottext">init_log :: IO LogQueue
</span><a href="#local-6989586621682088924"><span class="hs-identifier hs-var hs-var">init_log</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2458"></span><span>        </span><span class="hs-comment">-- Make a new log queue</span><span>
</span><span id="line-2459"></span><span>        </span><span id="local-6989586621682088925"><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621682088925"><span class="hs-identifier hs-var">lq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO LogQueue
</span><a href="GHC.Driver.Pipeline.LogQueue.html#newLogQueue"><span class="hs-identifier hs-var">newLogQueue</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088922"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-2460"></span><span>        </span><span class="hs-comment">-- Add it into the LogQueueQueue</span><span>
</span><span id="line-2461"></span><span>        </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#atomically/GHC.Conc.Sync.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TVar LogQueueQueue -&gt; LogQueue -&gt; STM ()
</span><a href="GHC.Driver.Pipeline.LogQueue.html#initLogQueue"><span class="hs-identifier hs-var">initLogQueue</span></a></span><span> </span><span class="annot"><span class="annottext">TVar LogQueueQueue
</span><a href="#local-6989586621682088921"><span class="hs-identifier hs-var">lqq_var</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621682088925"><span class="hs-identifier hs-var">lq</span></a></span><span>
</span><span id="line-2462"></span><span>        </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621682088925"><span class="hs-identifier hs-var">lq</span></a></span><span>
</span><span id="line-2463"></span><span>      </span><span id="local-6989586621682088938"><span class="annot"><span class="annottext">finish_log :: LogQueue -&gt; m ()
</span><a href="#local-6989586621682088938"><span class="hs-identifier hs-var hs-var">finish_log</span></a></span></span><span> </span><span id="local-6989586621682088939"><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621682088939"><span class="hs-identifier hs-var">lq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogQueue -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.LogQueue.html#finishLogQueue"><span class="hs-identifier hs-var">finishLogQueue</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621682088939"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2464"></span><span>  </span><span class="annot"><span class="annottext">IO LogQueue -&gt; (LogQueue -&gt; IO ()) -&gt; (LogQueue -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a c b.
(HasCallStack, MonadMask m) =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#bracket/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span> </span><span class="annot"><span class="annottext">IO LogQueue
</span><a href="#local-6989586621682088924"><span class="hs-identifier hs-var">init_log</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue -&gt; IO ()
forall {m :: * -&gt; *}. MonadIO m =&gt; LogQueue -&gt; m ()
</span><a href="#local-6989586621682088938"><span class="hs-identifier hs-var">finish_log</span></a></span><span> </span><span class="annot"><span class="annottext">((LogQueue -&gt; IO b) -&gt; IO b) -&gt; (LogQueue -&gt; IO b) -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088941"><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621682088941"><span class="hs-identifier hs-var">lq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Logger -&gt; Logger) -&gt; IO b
</span><a href="#local-6989586621682088923"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
 -&gt; LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
-&gt; Logger -&gt; Logger
</span><a href="GHC.Utils.Logger.html#pushLogHook"><span class="hs-identifier hs-var">pushLogHook</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
-&gt; (LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ())
-&gt; LogFlags
-&gt; MessageClass
-&gt; SrcSpan
-&gt; SDoc
-&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogQueue -&gt; LogFlags -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.LogQueue.html#parLogAction"><span class="hs-identifier hs-var">parLogAction</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621682088941"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2465"></span><span>
</span><span id="line-2466"></span><span id="local-6989586621682086278"><span class="annot"><a href="GHC.Driver.Make.html#withLoggerHsc"><span class="hs-identifier hs-type">withLoggerHsc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682086278"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682086278"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2467"></span><span id="withLoggerHsc"><span class="annot"><span class="annottext">withLoggerHsc :: forall a. Int -&gt; MakeEnv -&gt; (HscEnv -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Make.html#withLoggerHsc"><span class="hs-identifier hs-var hs-var">withLoggerHsc</span></a></span></span><span> </span><span id="local-6989586621682088945"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088945"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621682088946"><span class="annot"><span class="annottext">forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
withLogger :: MakeEnv -&gt; forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
withLogger :: forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Make.html#withLogger"><span class="hs-identifier hs-var hs-var">withLogger</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682088947"><span class="annot"><span class="annottext">HscEnv
hsc_env :: MakeEnv -&gt; HscEnv
hsc_env :: HscEnv
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621682088948"><span class="annot"><span class="annottext">HscEnv -&gt; IO a
</span><a href="#local-6989586621682088948"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2468"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621682088946"><span class="hs-identifier hs-var">withLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088945"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a)
-&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088949"><span class="annot"><span class="annottext">Logger -&gt; Logger
</span><a href="#local-6989586621682088949"><span class="hs-identifier hs-var">modifyLogger</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2469"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088950"><span class="annot"><span class="annottext">lcl_logger :: Logger
</span><a href="#local-6989586621682088950"><span class="hs-identifier hs-var hs-var">lcl_logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; Logger
</span><a href="#local-6989586621682088949"><span class="hs-identifier hs-var">modifyLogger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088947"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2470"></span><span>        </span><span id="local-6989586621682088951"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621682088951"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088947"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088950"><span class="hs-identifier hs-type">lcl_logger</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2471"></span><span>    </span><span class="hs-comment">-- Run continuation with modified logger</span><span>
</span><span id="line-2472"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; IO a
</span><a href="#local-6989586621682088948"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088951"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span>
</span><span id="line-2473"></span><span>
</span><span id="line-2474"></span><span>
</span><span id="line-2475"></span><span class="annot"><a href="GHC.Driver.Make.html#executeInstantiationNode"><span class="hs-identifier hs-type">executeInstantiationNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2476"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2477"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span>
</span><span id="line-2478"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span>
</span><span id="line-2479"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#InstantiatedUnit"><span class="hs-identifier hs-type">InstantiatedUnit</span></a></span><span>
</span><span id="line-2480"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2481"></span><span id="executeInstantiationNode"><span class="annot"><span class="annottext">executeInstantiationNode :: Int
-&gt; Int
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; UnitId
-&gt; InstantiatedUnit
-&gt; RunMakeM ()
</span><a href="GHC.Driver.Make.html#executeInstantiationNode"><span class="hs-identifier hs-var hs-var">executeInstantiationNode</span></a></span></span><span> </span><span id="local-6989586621682088952"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088952"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682088953"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088953"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682088954"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088954"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621682088955"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088955"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682088956"><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088956"><span class="hs-identifier hs-var">iu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2482"></span><span>        </span><span id="local-6989586621682088957"><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682088957"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT MakeEnv (MaybeT IO) MakeEnv
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ask/Control.Monad.Trans.Reader.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-2483"></span><span>        </span><span class="hs-comment">-- Output of the logger is mediated by a central worker to</span><span>
</span><span id="line-2484"></span><span>        </span><span class="hs-comment">-- avoid output interleaving</span><span>
</span><span id="line-2485"></span><span>        </span><span id="local-6989586621682088959"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682088959"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MakeEnv -&gt; Maybe Messager)
-&gt; ReaderT MakeEnv (MaybeT IO) (Maybe Messager)
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv -&gt; Maybe Messager
</span><a href="GHC.Driver.Make.html#env_messager"><span class="hs-identifier hs-var">env_messager</span></a></span><span>
</span><span id="line-2486"></span><span>        </span><span class="annot"><span class="annottext">MaybeT IO () -&gt; RunMakeM ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT MakeEnv m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT IO () -&gt; RunMakeM ()) -&gt; MaybeT IO () -&gt; RunMakeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe ()) -&gt; MaybeT IO ()
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#MaybeT/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe ()) -&gt; MaybeT IO ()) -&gt; IO (Maybe ()) -&gt; MaybeT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; MakeEnv -&gt; (HscEnv -&gt; IO (Maybe ())) -&gt; IO (Maybe ())
forall a. Int -&gt; MakeEnv -&gt; (HscEnv -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Make.html#withLoggerHsc"><span class="hs-identifier hs-var">withLoggerHsc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088952"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682088957"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; IO (Maybe ())) -&gt; IO (Maybe ()))
-&gt; (HscEnv -&gt; IO (Maybe ())) -&gt; IO (Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088961"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088961"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2487"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088962"><span class="annot"><span class="annottext">lcl_hsc_env :: HscEnv
</span><a href="#local-6989586621682088962"><span class="hs-identifier hs-var hs-var">lcl_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#setHUG"><span class="hs-identifier hs-var">setHUG</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088954"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088961"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2488"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO () -&gt; IO (Maybe ())
forall a. HscEnv -&gt; IO a -&gt; IO (Maybe a)
</span><a href="GHC.Driver.Make.html#wrapAction"><span class="hs-identifier hs-var">wrapAction</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088962"><span class="hs-identifier hs-var">lcl_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO (Maybe ())) -&gt; IO () -&gt; IO (Maybe ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2489"></span><span>            </span><span id="local-6989586621682088963"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621682088963"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Maybe Messager
-&gt; Int
-&gt; Int
-&gt; UnitId
-&gt; InstantiatedUnit
-&gt; IO ()
</span><a href="GHC.Driver.Make.html#upsweep_inst"><span class="hs-identifier hs-var">upsweep_inst</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088962"><span class="hs-identifier hs-var">lcl_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682088959"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088952"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088953"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682088955"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">InstantiatedUnit
</span><a href="#local-6989586621682088956"><span class="hs-identifier hs-var">iu</span></a></span><span>
</span><span id="line-2490"></span><span>            </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger -&gt; TmpFs -&gt; DynFlags -&gt; m ()
</span><a href="GHC.Driver.Make.html#cleanCurrentModuleTempFilesMaybe"><span class="hs-identifier hs-var">cleanCurrentModuleTempFilesMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088961"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088961"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088961"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2491"></span><span>            </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621682088963"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-2492"></span><span>
</span><span id="line-2493"></span><span>
</span><span id="line-2494"></span><span class="annot"><a href="GHC.Driver.Make.html#executeCompileNode"><span class="hs-identifier hs-type">executeCompileNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2495"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2496"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-2497"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span>
</span><span id="line-2498"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- List of modules we need to rehydrate before compiling</span><span>
</span><span id="line-2499"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2500"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-2501"></span><span id="executeCompileNode"><span class="annot"><span class="annottext">executeCompileNode :: Int
-&gt; Int
-&gt; Maybe HomeModInfo
-&gt; UnitEnvGraph HomeUnitEnv
-&gt; Maybe [ModuleName]
-&gt; ModSummary
-&gt; RunMakeM HomeModInfo
</span><a href="GHC.Driver.Make.html#executeCompileNode"><span class="hs-identifier hs-var hs-var">executeCompileNode</span></a></span></span><span> </span><span id="local-6989586621682088964"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088964"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621682088965"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088965"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682088966"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682088966"><span class="hs-identifier hs-var">old_hmi</span></a></span></span><span> </span><span id="local-6989586621682088967"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088967"><span class="hs-identifier hs-var">hug</span></a></span></span><span> </span><span id="local-6989586621682088968"><span class="annot"><span class="annottext">Maybe [ModuleName]
</span><a href="#local-6989586621682088968"><span class="hs-identifier hs-var">mrehydrate_mods</span></a></span></span><span> </span><span id="local-6989586621682088969"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088969"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2502"></span><span>  </span><span id="local-6989586621682088970"><span class="annot"><span class="annottext">me :: MakeEnv
</span><a href="#local-6989586621682088970"><span class="hs-identifier hs-var">me</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621682088971"><span id="local-6989586621682088972"><span id="local-6989586621682088973"><span id="local-6989586621682088974"><span class="annot"><span class="annottext">Maybe Messager
HscEnv
AbstractSem
forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
hsc_env :: MakeEnv -&gt; HscEnv
compile_sem :: MakeEnv -&gt; AbstractSem
withLogger :: MakeEnv -&gt; forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
env_messager :: MakeEnv -&gt; Maybe Messager
hsc_env :: HscEnv
compile_sem :: AbstractSem
withLogger :: forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
env_messager :: Maybe Messager
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT MakeEnv (MaybeT IO) MakeEnv
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ask/Control.Monad.Trans.Reader.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-2503"></span><span>  </span><span class="hs-comment">-- Rehydrate any dependencies if this module had a boot file or is a signature file.</span><span>
</span><span id="line-2504"></span><span>  </span><span class="annot"><span class="annottext">MaybeT IO HomeModInfo -&gt; RunMakeM HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT MakeEnv m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT IO HomeModInfo -&gt; RunMakeM HomeModInfo)
-&gt; MaybeT IO HomeModInfo -&gt; RunMakeM HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Maybe HomeModInfo) -&gt; MaybeT IO HomeModInfo
forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#MaybeT/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbstractSem -&gt; IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo)
forall b. AbstractSem -&gt; IO b -&gt; IO b
</span><a href="GHC.Driver.Make.html#withAbstractSem"><span class="hs-identifier hs-var">withAbstractSem</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractSem
</span><a href="#local-6989586621682088972"><span class="hs-identifier hs-var">compile_sem</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo))
-&gt; IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; MakeEnv
-&gt; (HscEnv -&gt; IO (Maybe HomeModInfo))
-&gt; IO (Maybe HomeModInfo)
forall a. Int -&gt; MakeEnv -&gt; (HscEnv -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Make.html#withLoggerHsc"><span class="hs-identifier hs-var">withLoggerHsc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088964"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682088970"><span class="hs-identifier hs-var">me</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; IO (Maybe HomeModInfo)) -&gt; IO (Maybe HomeModInfo))
-&gt; (HscEnv -&gt; IO (Maybe HomeModInfo)) -&gt; IO (Maybe HomeModInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088975"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088975"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2505"></span><span>     </span><span id="local-6989586621682088976"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088976"><span class="hs-identifier hs-var">hydrated_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HscEnv -&gt; IO HscEnv
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HscEnv -&gt; IO HscEnv) -&gt; IO HscEnv -&gt; IO HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; Maybe [ModuleName] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#maybeRehydrateBefore"><span class="hs-identifier hs-var">maybeRehydrateBefore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#setHUG"><span class="hs-identifier hs-var">setHUG</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682088967"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088975"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088969"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [ModuleName]
</span><a href="#local-6989586621682088978"><span class="hs-identifier hs-var">fixed_mrehydrate_mods</span></a></span><span>
</span><span id="line-2506"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Use the cached DynFlags which includes OPTIONS_GHC pragmas</span><span>
</span><span id="line-2507"></span><span>         </span><span id="local-6989586621682088979"><span class="annot"><span class="annottext">lcl_dynflags :: DynFlags
</span><a href="#local-6989586621682088979"><span class="hs-identifier hs-var hs-var">lcl_dynflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088969"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2508"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088980"><span class="annot"><span class="annottext">lcl_hsc_env :: HscEnv
</span><a href="#local-6989586621682088980"><span class="hs-identifier hs-var hs-var">lcl_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2509"></span><span>             </span><span class="hs-comment">-- Localise the hsc_env to use the cached flags</span><span>
</span><span id="line-2510"></span><span>             </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DynFlags -&gt; HscEnv -&gt; HscEnv
DynFlags -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetFlags"><span class="hs-identifier hs-var">hscSetFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088979"><span class="hs-identifier hs-var">lcl_dynflags</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; HscEnv -&gt; HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2511"></span><span>             </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088976"><span class="hs-identifier hs-var">hydrated_hsc_env</span></a></span><span>
</span><span id="line-2512"></span><span>     </span><span class="hs-comment">-- Compile the module, locking with a semaphore to avoid too many modules</span><span>
</span><span id="line-2513"></span><span>     </span><span class="hs-comment">-- being compiled at the same time leading to high memory usage.</span><span>
</span><span id="line-2514"></span><span>     </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HomeModInfo -&gt; IO (Maybe HomeModInfo)
forall a. HscEnv -&gt; IO a -&gt; IO (Maybe a)
</span><a href="GHC.Driver.Make.html#wrapAction"><span class="hs-identifier hs-var">wrapAction</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088980"><span class="hs-identifier hs-var">lcl_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HomeModInfo -&gt; IO (Maybe HomeModInfo))
-&gt; IO HomeModInfo -&gt; IO (Maybe HomeModInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2515"></span><span>      </span><span id="local-6989586621682088982"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682088982"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Maybe Messager
-&gt; Maybe HomeModInfo
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Make.html#upsweep_mod"><span class="hs-identifier hs-var">upsweep_mod</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088980"><span class="hs-identifier hs-var">lcl_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682088974"><span class="hs-identifier hs-var">env_messager</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682088966"><span class="hs-identifier hs-var">old_hmi</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088969"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088964"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682088965"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2516"></span><span>      </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; DynFlags -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
Logger -&gt; TmpFs -&gt; DynFlags -&gt; m ()
</span><a href="GHC.Driver.Make.html#cleanCurrentModuleTempFilesMaybe"><span class="hs-identifier hs-var">cleanCurrentModuleTempFilesMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088975"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088975"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682088979"><span class="hs-identifier hs-var">lcl_dynflags</span></a></span><span>
</span><span id="line-2517"></span><span>      </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682088982"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2518"></span><span>
</span><span id="line-2519"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2520"></span><span>    </span><span id="local-6989586621682088978"><span class="annot"><span class="annottext">fixed_mrehydrate_mods :: Maybe [ModuleName]
</span><a href="#local-6989586621682088978"><span class="hs-identifier hs-var hs-var">fixed_mrehydrate_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2521"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682088969"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2522"></span><span>        </span><span class="hs-comment">-- MP: It is probably a bit of a misimplementation in backpack that</span><span>
</span><span id="line-2523"></span><span>        </span><span class="hs-comment">-- compiling a signature requires an knot_var for that unit.</span><span>
</span><span id="line-2524"></span><span>        </span><span class="hs-comment">-- If you remove this then a lot of backpack tests fail.</span><span>
</span><span id="line-2525"></span><span>        </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Maybe [ModuleName]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2526"></span><span>        </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [ModuleName]
</span><a href="#local-6989586621682088968"><span class="hs-identifier hs-var">mrehydrate_mods</span></a></span><span>
</span><span id="line-2527"></span><span>
</span><span id="line-2528"></span><span class="hs-comment">{- Rehydration, see Note [Rehydrating Modules] -}</span><span>
</span><span id="line-2529"></span><span>
</span><span id="line-2530"></span><span class="annot"><a href="GHC.Driver.Make.html#rehydrate"><span class="hs-identifier hs-type">rehydrate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The HPT in this HscEnv needs rehydrating.</span></span><span>
</span><span id="line-2531"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-comment">-- ^ These are the modules we want to rehydrate.</span></span><span>
</span><span id="line-2532"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2533"></span><span id="rehydrate"><span class="annot"><span class="annottext">rehydrate :: HscEnv -&gt; [HomeModInfo] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#rehydrate"><span class="hs-identifier hs-var hs-var">rehydrate</span></a></span></span><span> </span><span id="local-6989586621682088984"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088984"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682088985"><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682088985"><span class="hs-identifier hs-var">hmis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2534"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682088986"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-2535"></span><span>     </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Re-hydrating loop: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Module] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HomeModInfo -&gt; Module) -&gt; [HomeModInfo] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; Module)
-&gt; (HomeModInfo -&gt; ModIface) -&gt; HomeModInfo -&gt; Module
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682088985"><span class="hs-identifier hs-var">hmis</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2536"></span><span>  </span><span id="local-6989586621682088987"><span class="annot"><span class="annottext">[(ModuleName, HomeModInfo)]
</span><a href="#local-6989586621682088987"><span class="hs-identifier hs-var">new_mods</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([(ModuleName, HomeModInfo)] -&gt; IO [(ModuleName, HomeModInfo)])
-&gt; IO [(ModuleName, HomeModInfo)]
forall a. (a -&gt; IO a) -&gt; IO a
</span><a href="../../base-4.18.2.1/src/System.IO.html#fixIO/System.IO.html#fixIO"><span class="hs-identifier hs-var">fixIO</span></a></span><span> </span><span class="annot"><span class="annottext">(([(ModuleName, HomeModInfo)] -&gt; IO [(ModuleName, HomeModInfo)])
 -&gt; IO [(ModuleName, HomeModInfo)])
-&gt; ([(ModuleName, HomeModInfo)] -&gt; IO [(ModuleName, HomeModInfo)])
-&gt; IO [(ModuleName, HomeModInfo)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682088988"><span class="annot"><span class="annottext">[(ModuleName, HomeModInfo)]
</span><a href="#local-6989586621682088988"><span class="hs-identifier hs-var">new_mods</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2537"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088989"><span class="annot"><span class="annottext">new_hpt :: HomePackageTable
</span><a href="#local-6989586621682088989"><span class="hs-identifier hs-var hs-var">new_hpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; [(ModuleName, HomeModInfo)] -&gt; HomePackageTable
</span><a href="GHC.Unit.Home.ModInfo.html#addListToHpt"><span class="hs-identifier hs-var">addListToHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682088991"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, HomeModInfo)]
</span><a href="#local-6989586621682088988"><span class="hs-identifier hs-var">new_mods</span></a></span><span>
</span><span id="line-2538"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088992"><span class="annot"><span class="annottext">new_hsc_env :: HscEnv
</span><a href="#local-6989586621682088992"><span class="hs-identifier hs-var hs-var">new_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; HomePackageTable) -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscUpdateHPT_lazy"><span class="hs-identifier hs-var">hscUpdateHPT_lazy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomePackageTable -&gt; HomePackageTable -&gt; HomePackageTable
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682088989"><span class="hs-identifier hs-var">new_hpt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088984"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2539"></span><span>      </span><span id="local-6989586621682088994"><span class="annot"><span class="annottext">[ModDetails]
</span><a href="#local-6989586621682088994"><span class="hs-identifier hs-var">mds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; HscEnv -&gt; IfG [ModDetails] -&gt; IO [ModDetails]
forall a. SDoc -&gt; HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier hs-var">initIfaceCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall doc. IsLine doc =&gt; FilePath -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;rehydrate&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088992"><span class="hs-identifier hs-var">new_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(IfG [ModDetails] -&gt; IO [ModDetails])
-&gt; IfG [ModDetails] -&gt; IO [ModDetails]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2540"></span><span>                </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IOEnv (Env IfGblEnv ()) ModDetails)
-&gt; [HomeModInfo] -&gt; IfG [ModDetails]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IOEnv (Env IfGblEnv ()) ModDetails
</span><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier hs-var">typecheckIface</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; IOEnv (Env IfGblEnv ()) ModDetails)
-&gt; (HomeModInfo -&gt; ModIface)
-&gt; HomeModInfo
-&gt; IOEnv (Env IfGblEnv ()) ModDetails
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682088985"><span class="hs-identifier hs-var">hmis</span></a></span><span>
</span><span id="line-2541"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088995"><span class="annot"><span class="annottext">new_mods :: [(ModuleName, HomeModInfo)]
</span><a href="#local-6989586621682088995"><span class="hs-identifier hs-var hs-var">new_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682088996"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682088997"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682088999"><span class="hs-identifier hs-type">details</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2542"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682088997"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682088997"><span class="hs-identifier hs-var">hmi</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682088999"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621682088999"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo] -&gt; [ModDetails] -&gt; [(HomeModInfo, ModDetails)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682088985"><span class="hs-identifier hs-var">hmis</span></a></span><span> </span><span class="annot"><span class="annottext">[ModDetails]
</span><a href="#local-6989586621682088994"><span class="hs-identifier hs-var">mds</span></a></span><span>
</span><span id="line-2543"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682088996"><span class="annot"><span class="annottext">mn :: ModuleName
</span><a href="#local-6989586621682088996"><span class="hs-identifier hs-var hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682088997"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2544"></span><span>      </span><span class="annot"><span class="annottext">[(ModuleName, HomeModInfo)] -&gt; IO [(ModuleName, HomeModInfo)]
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, HomeModInfo)]
</span><a href="#local-6989586621682088995"><span class="hs-identifier hs-var">new_mods</span></a></span><span>
</span><span id="line-2545"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#setHPT"><span class="hs-identifier hs-var">setHPT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HomePackageTable -&gt; (ModuleName, HomeModInfo) -&gt; HomePackageTable)
-&gt; HomePackageTable
-&gt; [(ModuleName, HomeModInfo)]
-&gt; HomePackageTable
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682089001"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682089001"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682089002"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682089002"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682089003"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682089003"><span class="hs-identifier hs-var">hmi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomeModInfo -&gt; HomePackageTable
</span><a href="GHC.Unit.Home.ModInfo.html#addToHpt"><span class="hs-identifier hs-var">addToHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682089001"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682089002"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682089003"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682088991"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">[(ModuleName, HomeModInfo)]
</span><a href="#local-6989586621682088987"><span class="hs-identifier hs-var">new_mods</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088984"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2546"></span><span>
</span><span id="line-2547"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2548"></span><span>    </span><span id="local-6989586621682088986"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682088986"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088984"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2549"></span><span>    </span><span id="local-6989586621682089004"><span class="annot"><span class="annottext">to_delete :: [ModuleName]
</span><a href="#local-6989586621682089004"><span class="hs-identifier hs-var hs-var">to_delete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HomeModInfo -&gt; ModuleName) -&gt; [HomeModInfo] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName)
-&gt; (HomeModInfo -&gt; Module) -&gt; HomeModInfo -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Unit.Module.ModIface.html#mi_module"><span class="hs-identifier hs-var">mi_module</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; Module)
-&gt; (HomeModInfo -&gt; ModIface) -&gt; HomeModInfo -&gt; Module
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Unit.Home.ModInfo.html#hm_iface"><span class="hs-identifier hs-var">hm_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682088985"><span class="hs-identifier hs-var">hmis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2550"></span><span>    </span><span class="hs-comment">-- Filter out old modules before tying the knot, otherwise we can end</span><span>
</span><span id="line-2551"></span><span>    </span><span class="hs-comment">-- up with a thunk which keeps reference to the old HomeModInfo.</span><span>
</span><span id="line-2552"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621682088991"><span class="annot"><span class="annottext">old_hpt :: HomePackageTable
</span><a href="#local-6989586621682088991"><span class="hs-identifier hs-var hs-var">old_hpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; ModuleName -&gt; HomePackageTable)
-&gt; HomePackageTable -&gt; [ModuleName] -&gt; HomePackageTable
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomePackageTable
</span><a href="GHC.Unit.Home.ModInfo.html#delFromHpt"><span class="hs-identifier hs-var">delFromHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682088984"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682089004"><span class="hs-identifier hs-var">to_delete</span></a></span><span>
</span><span id="line-2553"></span><span>
</span><span id="line-2554"></span><span class="hs-comment">-- If needed, then rehydrate the necessary modules with a suitable KnotVars for the</span><span>
</span><span id="line-2555"></span><span class="hs-comment">-- module currently being compiled.</span><span>
</span><span id="line-2556"></span><span class="annot"><a href="GHC.Driver.Make.html#maybeRehydrateBefore"><span class="hs-identifier hs-type">maybeRehydrateBefore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2557"></span><span id="maybeRehydrateBefore"><span class="annot"><span class="annottext">maybeRehydrateBefore :: HscEnv -&gt; ModSummary -&gt; Maybe [ModuleName] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#maybeRehydrateBefore"><span class="hs-identifier hs-var hs-var">maybeRehydrateBefore</span></a></span></span><span> </span><span id="local-6989586621682089007"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089007"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe [ModuleName]
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089007"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2558"></span><span class="annot"><a href="GHC.Driver.Make.html#maybeRehydrateBefore"><span class="hs-identifier hs-var">maybeRehydrateBefore</span></a></span><span> </span><span id="local-6989586621682089008"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089008"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682089009"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682089009"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682089010"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682089010"><span class="hs-identifier hs-var">mns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2559"></span><span>  </span><span id="local-6989586621682089011"><span class="annot"><span class="annottext">ModuleEnv (IORef TypeEnv)
</span><a href="#local-6989586621682089011"><span class="hs-identifier hs-var">knot_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO (ModuleEnv (IORef TypeEnv))
</span><a href="#local-6989586621682089012"><span class="hs-identifier hs-var">initialise_knot_var</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089008"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2560"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089013"><span class="annot"><span class="annottext">hmis :: [HomeModInfo]
</span><a href="#local-6989586621682089013"><span class="hs-identifier hs-var hs-var">hmis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; HomeModInfo) -&gt; [ModuleName] -&gt; [HomeModInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;mr&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HomeModInfo -&gt; HomeModInfo)
-&gt; (ModuleName -&gt; Maybe HomeModInfo) -&gt; ModuleName -&gt; HomeModInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089008"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682089010"><span class="hs-identifier hs-var">mns</span></a></span><span>
</span><span id="line-2561"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; [HomeModInfo] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#rehydrate"><span class="hs-identifier hs-var">rehydrate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089008"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html#knotVarsFromModuleEnv"><span class="hs-identifier hs-type">knotVarsFromModuleEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089011"><span class="hs-identifier hs-type">knot_var</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682089013"><span class="hs-identifier hs-var">hmis</span></a></span><span>
</span><span id="line-2562"></span><span>
</span><span id="line-2563"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2564"></span><span>   </span><span id="local-6989586621682089012"><span class="annot"><span class="annottext">initialise_knot_var :: HscEnv -&gt; IO (ModuleEnv (IORef TypeEnv))
</span><a href="#local-6989586621682089012"><span class="hs-identifier hs-var hs-var">initialise_knot_var</span></a></span></span><span> </span><span id="local-6989586621682089017"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089017"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (ModuleEnv (IORef TypeEnv)) -&gt; IO (ModuleEnv (IORef TypeEnv))
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ModuleEnv (IORef TypeEnv)) -&gt; IO (ModuleEnv (IORef TypeEnv)))
-&gt; IO (ModuleEnv (IORef TypeEnv)) -&gt; IO (ModuleEnv (IORef TypeEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2565"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089018"><span class="annot"><span class="annottext">mod_name :: Module
</span><a href="#local-6989586621682089018"><span class="hs-identifier hs-var hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HomeUnit -&gt; Module -&gt; Module
</span><a href="GHC.Unit.Home.html#homeModuleInstantiation"><span class="hs-identifier hs-var">homeModuleInstantiation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit_maybe"><span class="hs-identifier hs-var">hsc_home_unit_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089017"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682089009"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2566"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Module, IORef TypeEnv)] -&gt; ModuleEnv (IORef TypeEnv)
forall a. [(Module, a)] -&gt; ModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#mkModuleEnv"><span class="hs-identifier hs-var">mkModuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([(Module, IORef TypeEnv)] -&gt; ModuleEnv (IORef TypeEnv))
-&gt; (IORef TypeEnv -&gt; [(Module, IORef TypeEnv)])
-&gt; IORef TypeEnv
-&gt; ModuleEnv (IORef TypeEnv)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Module, IORef TypeEnv)
-&gt; [(Module, IORef TypeEnv)] -&gt; [(Module, IORef TypeEnv)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Module, IORef TypeEnv) -&gt; [(Module, IORef TypeEnv)])
-&gt; (IORef TypeEnv -&gt; (Module, IORef TypeEnv))
-&gt; IORef TypeEnv
-&gt; [(Module, IORef TypeEnv)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682089018"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IORef TypeEnv -&gt; ModuleEnv (IORef TypeEnv))
-&gt; IO (IORef TypeEnv) -&gt; IO (ModuleEnv (IORef TypeEnv))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; IO (IORef TypeEnv)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="GHC.Types.TypeEnv.html#emptyTypeEnv"><span class="hs-identifier hs-var">emptyTypeEnv</span></a></span><span>
</span><span id="line-2567"></span><span>
</span><span id="line-2568"></span><span class="annot"><a href="GHC.Driver.Make.html#rehydrateAfter"><span class="hs-identifier hs-type">rehydrateAfter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2569"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2570"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2571"></span><span id="rehydrateAfter"><span class="annot"><span class="annottext">rehydrateAfter :: HscEnv -&gt; [ModuleName] -&gt; IO [HomeModInfo]
</span><a href="GHC.Driver.Make.html#rehydrateAfter"><span class="hs-identifier hs-var hs-var">rehydrateAfter</span></a></span></span><span> </span><span id="local-6989586621682089022"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089022"><span class="hs-identifier hs-var">new_hsc</span></a></span></span><span> </span><span id="local-6989586621682089023"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682089023"><span class="hs-identifier hs-var">mns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2572"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089024"><span class="annot"><span class="annottext">new_hpt :: HomePackageTable
</span><a href="#local-6989586621682089024"><span class="hs-identifier hs-var hs-var">new_hpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089022"><span class="hs-identifier hs-var">new_hsc</span></a></span><span>
</span><span id="line-2573"></span><span>      </span><span id="local-6989586621682089025"><span class="annot"><span class="annottext">hmis :: [HomeModInfo]
</span><a href="#local-6989586621682089025"><span class="hs-identifier hs-var hs-var">hmis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; HomeModInfo) -&gt; [ModuleName] -&gt; [HomeModInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;mrAfter&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HomeModInfo -&gt; HomeModInfo)
-&gt; (ModuleName -&gt; Maybe HomeModInfo) -&gt; ModuleName -&gt; HomeModInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621682089024"><span class="hs-identifier hs-var">new_hpt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682089023"><span class="hs-identifier hs-var">mns</span></a></span><span>
</span><span id="line-2574"></span><span>  </span><span id="local-6989586621682089026"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089026"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [HomeModInfo] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#rehydrate"><span class="hs-identifier hs-var">rehydrate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089022"><span class="hs-identifier hs-var">new_hsc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html#emptyKnotVars"><span class="hs-identifier hs-type">emptyKnotVars</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682089025"><span class="hs-identifier hs-var">hmis</span></a></span><span>
</span><span id="line-2575"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; HomeModInfo) -&gt; [ModuleName] -&gt; [HomeModInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682089028"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682089028"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;rehydrate&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HomeModInfo -&gt; HomeModInfo)
-&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Unit.Home.ModInfo.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089026"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682089028"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621682089023"><span class="hs-identifier hs-var">mns</span></a></span><span>
</span><span id="line-2576"></span><span>
</span><span id="line-2577"></span><span class="hs-comment">{-
Note [Hydrating Modules]
~~~~~~~~~~~~~~~~~~~~~~~~
There are at least 4 different representations of an interface file as described
by this diagram.

------------------------------
|       On-disk M.hi         |
------------------------------
    |             ^
    | Read file   | Write file
    V             |
-------------------------------
|      ByteString             |
-------------------------------
    |             ^
    | Binary.get  | Binary.put
    V             |
--------------------------------
|    ModIface (an acyclic AST) |
--------------------------------
    |           ^
    | hydrate   | mkIfaceTc
    V           |
---------------------------------
|  ModDetails (lots of cycles)  |
---------------------------------

The last step, converting a ModIface into a ModDetails is known as &quot;hydration&quot;.

Hydration happens in three different places

* When an interface file is initially loaded from disk, it has to be hydrated.
* When a module is finished compiling, we hydrate the ModIface in order to generate
  the version of ModDetails which exists in memory (see Note [ModDetails and --make mode])
* When dealing with boot files and module loops (see Note [Rehydrating Modules])

Note [Rehydrating Modules]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
If a module has a boot file then it is critical to rehydrate the modules on
the path between the two (see #20561).

Suppose we have (&quot;R&quot; for &quot;recursive&quot;):
```
R.hs-boot:   module R where
               data T
               g :: T -&gt; T

A.hs:        module A( f, T, g ) where
                import {-# SOURCE #-} R
                data S = MkS T
                f :: T -&gt; S = ...g...

R.hs:        module R where
                import A
                data T = T1 | T2 S
                g = ...f...
```

== Why we need to rehydrate A's ModIface before compiling R.hs

After compiling A.hs we'll have a TypeEnv in which the Id for `f` has a type
type uses the AbstractTyCon T; and a TyCon for `S` that also mentions that same
AbstractTyCon. (Abstract because it came from R.hs-boot; we know nothing about
it.)

When compiling R.hs, we build a TyCon for `T`.  But that TyCon mentions `S`, and
it currently has an AbstractTyCon for `T` inside it.  But we want to build a
fully cyclic structure, in which `S` refers to `T` and `T` refers to `S`.

Solution: **rehydration**.  *Before compiling `R.hs`*, rehydrate all the
ModIfaces below it that depend on R.hs-boot.  To rehydrate a ModIface, call
`typecheckIface` to convert it to a ModDetails.  It's just a de-serialisation
step, no type inference, just lookups.

Now `S` will be bound to a thunk that, when forced, will &quot;see&quot; the final binding
for `T`; see [Tying the knot](https://gitlab.haskell.org/ghc/ghc/-/wikis/commentary/compiler/tying-the-knot).
But note that this must be done *before* compiling R.hs.

== Why we need to rehydrate A's ModIface after compiling R.hs

When compiling R.hs, the knot-tying stuff above will ensure that `f`'s unfolding
mentions the `LocalId` for `g`.  But when we finish R, we carefully ensure that
all those `LocalIds` are turned into completed `GlobalIds`, replete with
unfoldings etc.   Alas, that will not apply to the occurrences of `g` in `f`'s
unfolding. And if we leave matters like that, they will stay that way, and *all*
subsequent modules that import A will see a crippled unfolding for `f`.

Solution: rehydrate both R and A's ModIface together, right after completing R.hs.

~~ Which modules to rehydrate

We only need rehydrate modules that are
* Below R.hs
* Above R.hs-boot

There might be many unrelated modules (in the home package) that don't need to be
rehydrated.

== Loops with multiple boot files

It is possible for a module graph to have a loop (SCC, when ignoring boot files)
which requires multiple boot files to break. In this case, we must perform
several hydration steps:
  1. The hydration steps described above, which are necessary for correctness.
  2. An extra hydration step at the end of compiling the entire SCC, in order to
     remove space leaks, as we explain below.

Consider the following example:

   &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;     &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
   &#9474;  A  &#9474;     &#9474;  B  &#9474;
   &#9492;&#9472;&#9472;&#9516;&#9472;&#9472;&#9496;     &#9492;&#9472;&#9472;&#9516;&#9472;&#9472;&#9496;
      &#9474;           &#9474;
  &#9484;&#9472;&#9472;&#9472;&#9660;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9660;&#9472;&#9472;&#9472;&#9488;
  &#9474;         C         &#9474;
  &#9492;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9496;
      &#9474;           &#9474;
 &#9484;&#9472;&#9472;&#9472;&#9472;&#9660;&#9472;&#9472;&#9472;&#9488;   &#9484;&#9472;&#9472;&#9472;&#9660;&#9472;&#9472;&#9472;&#9472;&#9488;
 &#9474; A-boot &#9474;   &#9474; B-boot &#9474;
 &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;   &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;

A, B and C live together in a SCC. Suppose that we compile the modules in the
order:

  A-boot, B-boot, C, A, B.

When we come to compile A, we will perform the necessary hydration steps,
because A has a boot file. This means that C will be hydrated relative to A,
and the ModDetails for A will reference C/A. Then, when B is compiled,
C will be rehydrated again, and so B will reference C/A,B. At this point,
its interface will be hydrated relative to both A and B.
This causes a space leak: there are now two different copies of C's ModDetails,
kept alive by modules A and B. This is especially problematic if C is large.

The way to avoid this space leak is to rehydrate an entire SCC together at the
end of compilation, so that all the ModDetails point to interfaces for .hs files.
In this example, when we hydrate A, B and C together, then both A and B will refer to
C/A,B.

See #21900 for some more discussion.

== Modules &quot;above&quot; the loop

This dark corner is the subject of #14092.

Suppose we add to our example
```
X.hs     module X where
           import A
           data XT = MkX T
           fx = ...g...
```
If in `--make` we compile R.hs-boot, then A.hs, then X.hs, we'll get a `ModDetails` for `X` that has an AbstractTyCon for `T` in the argument type of `MkX`.  So:

* Either we should delay compiling X until after R has been compiled. (This is what we do)
* Or we should rehydrate X after compiling R -- because it transitively depends on R.hs-boot.

Ticket #20200 has exposed some issues to do with the knot-tying logic in GHC.Make, in `--make` mode.
#20200 has lots of issues, many of them now fixed;
this particular issue starts [here](https://gitlab.haskell.org/ghc/ghc/-/issues/20200#note_385758).

The wiki page [Tying the knot](https://gitlab.haskell.org/ghc/ghc/-/wikis/commentary/compiler/tying-the-knot) is helpful.
Also closely related are
    * #14092
    * #14103

-}</span><span>
</span><span id="line-2745"></span><span>
</span><span id="line-2746"></span><span class="annot"><a href="GHC.Driver.Make.html#executeLinkNode"><span class="hs-identifier hs-type">executeLinkNode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Graph.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2747"></span><span id="executeLinkNode"><span class="annot"><span class="annottext">executeLinkNode :: UnitEnvGraph HomeUnitEnv
-&gt; (Int, Int) -&gt; UnitId -&gt; [NodeKey] -&gt; RunMakeM ()
</span><a href="GHC.Driver.Make.html#executeLinkNode"><span class="hs-identifier hs-var hs-var">executeLinkNode</span></a></span></span><span> </span><span id="local-6989586621682089029"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682089029"><span class="hs-identifier hs-var">hug</span></a></span></span><span> </span><span id="local-6989586621682089030"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621682089030"><span class="hs-identifier hs-var">kn</span></a></span></span><span> </span><span id="local-6989586621682089031"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682089031"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682089032"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682089032"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2748"></span><span>  </span><span class="annot"><span class="annottext">UnitId -&gt; RunMakeM () -&gt; RunMakeM ()
forall a. UnitId -&gt; RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withCurrentUnit"><span class="hs-identifier hs-var">withCurrentUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682089031"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">(RunMakeM () -&gt; RunMakeM ()) -&gt; RunMakeM () -&gt; RunMakeM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2749"></span><span>    </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621682089033"><span id="local-6989586621682089034"><span id="local-6989586621682089035"><span id="local-6989586621682089036"><span class="annot"><span class="annottext">Maybe Messager
HscEnv
AbstractSem
forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
hsc_env :: MakeEnv -&gt; HscEnv
compile_sem :: MakeEnv -&gt; AbstractSem
withLogger :: MakeEnv -&gt; forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
env_messager :: MakeEnv -&gt; Maybe Messager
hsc_env :: HscEnv
compile_sem :: AbstractSem
withLogger :: forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
env_messager :: Maybe Messager
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT MakeEnv (MaybeT IO) MakeEnv
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ask/Control.Monad.Trans.Reader.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-2750"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089037"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682089037"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089033"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2751"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089038"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#setHUG"><span class="hs-identifier hs-var">setHUG</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682089029"><span class="hs-identifier hs-var">hug</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089033"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2752"></span><span>        </span><span id="local-6989586621682089039"><span class="annot"><span class="annottext">msg' :: Maybe (RecompileRequired -&gt; IO ())
</span><a href="#local-6989586621682089039"><span class="hs-identifier hs-var hs-var">msg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682089040"><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621682089040"><span class="hs-identifier hs-var">messager</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682089041"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621682089041"><span class="hs-identifier hs-var">recomp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621682089040"><span class="hs-identifier hs-var">messager</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089033"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621682089030"><span class="hs-identifier hs-var">kn</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621682089041"><span class="hs-identifier hs-var">recomp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; UnitId -&gt; ModuleGraphNode
</span><a href="GHC.Unit.Module.Graph.html#LinkNode"><span class="hs-identifier hs-var">LinkNode</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621682089032"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682089031"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Messager -&gt; RecompileRequired -&gt; IO ())
-&gt; Maybe Messager -&gt; Maybe (RecompileRequired -&gt; IO ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089036"><span class="hs-identifier hs-var">env_messager</span></a></span><span>
</span><span id="line-2753"></span><span>
</span><span id="line-2754"></span><span>    </span><span id="local-6989586621682089042"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682089042"><span class="hs-identifier hs-var">linkresult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SuccessFlag -&gt; ReaderT MakeEnv (MaybeT IO) SuccessFlag
forall a. IO a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SuccessFlag -&gt; ReaderT MakeEnv (MaybeT IO) SuccessFlag)
-&gt; IO SuccessFlag -&gt; ReaderT MakeEnv (MaybeT IO) SuccessFlag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractSem -&gt; IO SuccessFlag -&gt; IO SuccessFlag
forall b. AbstractSem -&gt; IO b -&gt; IO b
</span><a href="GHC.Driver.Make.html#withAbstractSem"><span class="hs-identifier hs-var">withAbstractSem</span></a></span><span> </span><span class="annot"><span class="annottext">AbstractSem
</span><a href="#local-6989586621682089034"><span class="hs-identifier hs-var">compile_sem</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SuccessFlag -&gt; IO SuccessFlag)
-&gt; IO SuccessFlag -&gt; IO SuccessFlag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2755"></span><span>                            </span><span class="annot"><span class="annottext">GhcLink
-&gt; Logger
-&gt; TmpFs
-&gt; Hooks
-&gt; DynFlags
-&gt; UnitEnv
-&gt; Bool
-&gt; Maybe (RecompileRequired -&gt; IO ())
-&gt; HomePackageTable
-&gt; IO SuccessFlag
</span><a href="GHC.Driver.Pipeline.html#link"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682089037"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2756"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2757"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2758"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2759"></span><span>                                </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682089037"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2760"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2761"></span><span>                                </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- We already decided to link</span><span>
</span><span id="line-2762"></span><span>                                </span><span class="annot"><span class="annottext">Maybe (RecompileRequired -&gt; IO ())
</span><a href="#local-6989586621682089039"><span class="hs-identifier hs-var">msg'</span></a></span><span>
</span><span id="line-2763"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Env.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089038"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2764"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621682089042"><span class="hs-identifier hs-var">linkresult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2765"></span><span>      </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; RunMakeM ()
forall a. FilePath -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadFail m =&gt; FilePath -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.Fail.html#fail/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Link Failed&quot;</span></span><span>
</span><span id="line-2766"></span><span>      </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; RunMakeM ()
forall a. a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2767"></span><span>
</span><span id="line-2768"></span><span class="hs-comment">{-
Note [ModuleNameSet, efficiency and space leaks]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

During upsweep, the results of compiling modules are placed into a MVar. When we need
to compute the right compilation environment for a module, we consult this MVar and
set the HomeUnitGraph accordingly. This is done to avoid having to precisely track
module dependencies and recreating the HUG from scratch each time, which is very expensive.

In serial mode (-j1), this all works out fine: a module can only be compiled
after its dependencies have finished compiling, and compilation can't be
interleaved with the compilation of other module loops. This ensures that
the HUG only ever contains finalised interfaces.

In parallel mode, we have to be more careful: the HUG variable can contain non-finalised
interfaces, which have been started by another thread. In order to avoid a space leak
in which a finalised interface is compiled against a HPT which contains a non-finalised
interface, we have to restrict the HUG to only contain the visible modules.

The collection of visible modules explains which transitive modules are visible
from a certain point. It is recorded in the ModuleNameSet.
Before a module is compiled, we use this set to restrict the HUG to the visible
modules only, avoiding this tricky space leak.

Efficiency of the ModuleNameSet is of utmost importance, because a union occurs for
each edge in the module graph. To achieve this, the set is represented directly as an IntSet,
which provides suitable performance &#8211; even using a UniqSet (which is backed by an IntMap) is
too slow. The crucial test of performance here is the time taken to a do a no-op build in --make mode.

See test &quot;jspace&quot; for an example which used to trigger this problem.

-}</span><span>
</span><span id="line-2800"></span><span>
</span><span id="line-2801"></span><span class="hs-comment">-- See Note [ModuleNameSet, efficiency and space leaks]</span><span>
</span><span id="line-2802"></span><span class="hs-keyword">type</span><span> </span><span id="ModuleNameSet"><span class="annot"><a href="GHC.Driver.Make.html#ModuleNameSet"><span class="hs-identifier hs-var">ModuleNameSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.Map.Internal.html#Map/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="annot"><a href="../../containers-0.6.7/src/Data.IntSet.Internal.html#IntSet/Data.IntSet.Internal.html#IntSet"><span class="hs-identifier hs-type">I.IntSet</span></a></span><span>
</span><span id="line-2803"></span><span>
</span><span id="line-2804"></span><span class="annot"><a href="GHC.Driver.Make.html#addToModuleNameSet"><span class="hs-identifier hs-type">addToModuleNameSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleNameSet"><span class="hs-identifier hs-type">ModuleNameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleNameSet"><span class="hs-identifier hs-type">ModuleNameSet</span></a></span><span>
</span><span id="line-2805"></span><span id="addToModuleNameSet"><span class="annot"><span class="annottext">addToModuleNameSet :: UnitId -&gt; ModuleName -&gt; ModuleNameSet -&gt; ModuleNameSet
</span><a href="GHC.Driver.Make.html#addToModuleNameSet"><span class="hs-identifier hs-var hs-var">addToModuleNameSet</span></a></span></span><span> </span><span id="local-6989586621682089045"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682089045"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682089046"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682089046"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621682089047"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089047"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2806"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089048"><span class="annot"><span class="annottext">k :: Int
</span><a href="#local-6989586621682089048"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; Int
</span><a href="GHC.Types.Unique.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Unique -&gt; Int) -&gt; Unique -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; Unique) -&gt; ModuleName -&gt; Unique
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682089046"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2807"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(IntSet -&gt; IntSet -&gt; IntSet)
-&gt; UnitId -&gt; IntSet -&gt; ModuleNameSet -&gt; ModuleNameSet
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#insertWith/Data.Map.Strict.Internal.html#insertWith"><span class="hs-identifier hs-var">M.insertWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; IntSet -&gt; IntSet
</span><a href="../../containers-0.6.7/src/Data.IntSet.Internal.html#union/Data.IntSet.Internal.html#union"><span class="hs-identifier hs-var">I.union</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682089045"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IntSet
</span><a href="../../containers-0.6.7/src/Data.IntSet.Internal.html#singleton/Data.IntSet.Internal.html#singleton"><span class="hs-identifier hs-var">I.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089048"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089047"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2808"></span><span>
</span><span id="line-2809"></span><span class="annot"><span class="hs-comment">-- | Wait for some dependencies to finish and then read from the given MVar.</span></span><span>
</span><span id="line-2810"></span><span class="annot"><a href="GHC.Driver.Make.html#wait_deps_hug"><span class="hs-identifier hs-type">wait_deps_hug</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.MVar.html#MVar/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-type">BuildResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#MaybeT/Control.Monad.Trans.Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Env.html#HomeUnitGraph"><span class="hs-identifier hs-type">HomeUnitGraph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleNameSet"><span class="hs-identifier hs-type">ModuleNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2811"></span><span id="wait_deps_hug"><span class="annot"><span class="annottext">wait_deps_hug :: MVar (UnitEnvGraph HomeUnitEnv)
-&gt; [BuildResult]
-&gt; ReaderT
     MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps_hug"><span class="hs-identifier hs-var hs-var">wait_deps_hug</span></a></span></span><span> </span><span id="local-6989586621682089054"><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682089054"><span class="hs-identifier hs-var">hug_var</span></a></span></span><span> </span><span id="local-6989586621682089055"><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2812"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HomeModInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682089056"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089056"><span class="hs-identifier hs-var">module_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[BuildResult] -&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps"><span class="hs-identifier hs-var">wait_deps</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682089055"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-2813"></span><span>  </span><span id="local-6989586621682089058"><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682089058"><span class="hs-identifier hs-var">hug</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (UnitEnvGraph HomeUnitEnv)
-&gt; ReaderT MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv)
forall a. IO a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (UnitEnvGraph HomeUnitEnv)
 -&gt; ReaderT MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv))
-&gt; IO (UnitEnvGraph HomeUnitEnv)
-&gt; ReaderT MakeEnv (MaybeT IO) (UnitEnvGraph HomeUnitEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv) -&gt; IO (UnitEnvGraph HomeUnitEnv)
forall a. MVar a -&gt; IO a
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#readMVar/GHC.MVar.html#readMVar"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (UnitEnvGraph HomeUnitEnv)
</span><a href="#local-6989586621682089054"><span class="hs-identifier hs-var">hug_var</span></a></span><span>
</span><span id="line-2814"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089059"><span class="annot"><span class="annottext">pruneHomeUnitEnv :: UnitId -&gt; HomeUnitEnv -&gt; HomeUnitEnv
</span><a href="#local-6989586621682089059"><span class="hs-identifier hs-var hs-var">pruneHomeUnitEnv</span></a></span></span><span> </span><span id="local-6989586621682089060"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682089060"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span id="local-6989586621682089061"><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682089061"><span class="hs-identifier hs-var">hme</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2815"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Restrict to things which are in the transitive closure to avoid retaining</span><span>
</span><span id="line-2816"></span><span>            </span><span class="hs-comment">-- reference to loop modules which have already been compiled by other threads.</span><span>
</span><span id="line-2817"></span><span>            </span><span class="hs-comment">-- See Note [ModuleNameSet, efficiency and space leaks]</span><span>
</span><span id="line-2818"></span><span>            </span><span class="hs-glyph">!</span><span id="local-6989586621682089062"><span class="annot"><span class="annottext">new :: HomePackageTable
</span><a href="#local-6989586621682089062"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; IntSet -&gt; HomePackageTable
forall key elt. UniqDFM key elt -&gt; IntSet -&gt; UniqDFM key elt
</span><a href="GHC.Types.Unique.DFM.html#udfmRestrictKeysSet"><span class="hs-identifier hs-var">udfmRestrictKeysSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeUnitEnv -&gt; HomePackageTable
</span><a href="GHC.Unit.Env.html#homeUnitEnv_hpt"><span class="hs-identifier hs-var">homeUnitEnv_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682089061"><span class="hs-identifier hs-var">hme</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntSet -&gt; Maybe IntSet -&gt; IntSet
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet
</span><a href="../../containers-0.6.7/src/Data.IntSet.Internal.html#empty/Data.IntSet.Internal.html#empty"><span class="hs-identifier hs-var">I.empty</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe IntSet -&gt; IntSet) -&gt; Maybe IntSet -&gt; IntSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; ModuleNameSet -&gt; Maybe IntSet
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#lookup/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">M.lookup</span></a></span><span>  </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621682089060"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089056"><span class="hs-identifier hs-var">module_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2819"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HomeUnitEnv
</span><a href="#local-6989586621682089061"><span class="hs-identifier hs-var">hme</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#homeUnitEnv_hpt"><span class="hs-identifier hs-var">homeUnitEnv_hpt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682089062"><span class="hs-identifier hs-type">new</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2820"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnitId -&gt; HomeUnitEnv -&gt; HomeUnitEnv)
-&gt; UnitEnvGraph HomeUnitEnv -&gt; UnitEnvGraph HomeUnitEnv
forall v b. (UnitId -&gt; v -&gt; b) -&gt; UnitEnvGraph v -&gt; UnitEnvGraph b
</span><a href="GHC.Unit.Env.html#unitEnv_mapWithKey"><span class="hs-identifier hs-var">unitEnv_mapWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; HomeUnitEnv -&gt; HomeUnitEnv
</span><a href="#local-6989586621682089059"><span class="hs-identifier hs-var">pruneHomeUnitEnv</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnvGraph HomeUnitEnv
</span><a href="#local-6989586621682089058"><span class="hs-identifier hs-var">hug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089056"><span class="hs-identifier hs-var">module_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2821"></span><span>
</span><span id="line-2822"></span><span class="annot"><span class="hs-comment">-- | Wait for dependencies to finish, and then return their results.</span></span><span>
</span><span id="line-2823"></span><span class="annot"><a href="GHC.Driver.Make.html#wait_deps"><span class="hs-identifier hs-type">wait_deps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildResult"><span class="hs-identifier hs-type">BuildResult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#ModuleNameSet"><span class="hs-identifier hs-type">ModuleNameSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2824"></span><span id="wait_deps"><span class="annot"><span class="annottext">wait_deps :: [BuildResult] -&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps"><span class="hs-identifier hs-var hs-var">wait_deps</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([HomeModInfo], ModuleNameSet)
-&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
forall a. a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
forall k a. Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Internal.html#empty/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">M.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2825"></span><span class="annot"><a href="GHC.Driver.Make.html#wait_deps"><span class="hs-identifier hs-var">wait_deps</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682089066"><span class="annot"><span class="annottext">BuildResult
</span><a href="#local-6989586621682089066"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682089067"><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682089067"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2826"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682089068"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682089068"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682089069"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089069"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeT IO (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT MakeEnv m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(MaybeT IO (Maybe HomeModInfo, ModuleNameSet)
 -&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet))
-&gt; MaybeT IO (Maybe HomeModInfo, ModuleNameSet)
-&gt; RunMakeM (Maybe HomeModInfo, ModuleNameSet)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ResultVar (Maybe HomeModInfo, ModuleNameSet)
-&gt; MaybeT IO (Maybe HomeModInfo, ModuleNameSet)
forall a. ResultVar a -&gt; MaybeT IO a
</span><a href="GHC.Driver.Make.html#waitResult"><span class="hs-identifier hs-var">waitResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildResult -&gt; ResultVar (Maybe HomeModInfo, ModuleNameSet)
</span><a href="GHC.Driver.Make.html#resultVar"><span class="hs-identifier hs-var">resultVar</span></a></span><span> </span><span class="annot"><span class="annottext">BuildResult
</span><a href="#local-6989586621682089066"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2827"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682089070"><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682089070"><span class="hs-identifier hs-var">hmis</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682089071"><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089071"><span class="hs-identifier hs-var">all_deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[BuildResult] -&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
</span><a href="GHC.Driver.Make.html#wait_deps"><span class="hs-identifier hs-var">wait_deps</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildResult]
</span><a href="#local-6989586621682089067"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2828"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682089072"><span class="annot"><span class="annottext">new_deps :: ModuleNameSet
</span><a href="#local-6989586621682089072"><span class="hs-identifier hs-var hs-var">new_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089069"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameSet -&gt; ModuleNameSet -&gt; ModuleNameSet
</span><a href="#local-6989586621682089073"><span class="hs-operator hs-var">`unionModuleNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089071"><span class="hs-identifier hs-var">all_deps</span></a></span><span>
</span><span id="line-2829"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621682089068"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2830"></span><span>    </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([HomeModInfo], ModuleNameSet)
-&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
forall a. a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682089070"><span class="hs-identifier hs-var">hmis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089072"><span class="hs-identifier hs-var">new_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2831"></span><span>    </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682089074"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682089074"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([HomeModInfo], ModuleNameSet)
-&gt; RunMakeM ([HomeModInfo], ModuleNameSet)
forall a. a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621682089074"><span class="hs-identifier hs-var">hmi</span></a></span><span class="annot"><span class="annottext">HomeModInfo -&gt; [HomeModInfo] -&gt; [HomeModInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621682089070"><span class="hs-identifier hs-var">hmis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleNameSet
</span><a href="#local-6989586621682089072"><span class="hs-identifier hs-var">new_deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2832"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2833"></span><span>    </span><span id="local-6989586621682089073"><span class="annot"><span class="annottext">unionModuleNameSet :: ModuleNameSet -&gt; ModuleNameSet -&gt; ModuleNameSet
</span><a href="#local-6989586621682089073"><span class="hs-identifier hs-var hs-var">unionModuleNameSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IntSet -&gt; IntSet -&gt; IntSet)
-&gt; ModuleNameSet -&gt; ModuleNameSet -&gt; ModuleNameSet
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers-0.6.7/src/Data.Map.Strict.Internal.html#unionWith/Data.Map.Strict.Internal.html#unionWith"><span class="hs-identifier hs-var">M.unionWith</span></a></span><span> </span><span class="annot"><span class="annottext">IntSet -&gt; IntSet -&gt; IntSet
</span><a href="../../containers-0.6.7/src/Data.IntSet.Internal.html#union/Data.IntSet.Internal.html#union"><span class="hs-identifier hs-var">I.union</span></a></span><span>
</span><span id="line-2834"></span><span>
</span><span id="line-2835"></span><span>
</span><span id="line-2836"></span><span class="hs-comment">-- Executing the pipelines</span><span>
</span><span id="line-2837"></span><span>
</span><span id="line-2838"></span><span>
</span><span id="line-2839"></span><span class="annot"><a href="GHC.Driver.Make.html#label_self"><span class="hs-identifier hs-type">label_self</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2840"></span><span id="label_self"><span class="annot"><span class="annottext">label_self :: FilePath -&gt; IO ()
</span><a href="GHC.Driver.Make.html#label_self"><span class="hs-identifier hs-var hs-var">label_self</span></a></span></span><span> </span><span id="local-6989586621682089078"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682089078"><span class="hs-identifier hs-var">thread_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2841"></span><span>    </span><span id="local-6989586621682089079"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621682089079"><span class="hs-identifier hs-var">self_tid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#myThreadId/GHC.Conc.Sync.html#myThreadId"><span class="hs-identifier hs-var">CC.myThreadId</span></a></span><span>
</span><span id="line-2842"></span><span>    </span><span class="annot"><span class="annottext">ThreadId -&gt; FilePath -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#labelThread/GHC.Conc.Sync.html#labelThread"><span class="hs-identifier hs-var">CC.labelThread</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621682089079"><span class="hs-identifier hs-var">self_tid</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621682089078"><span class="hs-identifier hs-var">thread_name</span></a></span><span>
</span><span id="line-2843"></span><span>
</span><span id="line-2844"></span><span>
</span><span id="line-2845"></span><span class="annot"><a href="GHC.Driver.Make.html#runPipelines"><span class="hs-identifier hs-type">runPipelines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2846"></span><span class="hs-comment">-- Don't even initialise plugins if there are no pipelines</span><span>
</span><span id="line-2847"></span><span id="runPipelines"><span class="annot"><span class="annottext">runPipelines :: Int -&gt; HscEnv -&gt; Maybe Messager -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runPipelines"><span class="hs-identifier hs-var hs-var">runPipelines</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2848"></span><span class="annot"><a href="GHC.Driver.Make.html#runPipelines"><span class="hs-identifier hs-var">runPipelines</span></a></span><span> </span><span id="local-6989586621682089082"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089082"><span class="hs-identifier hs-var">n_job</span></a></span></span><span> </span><span id="local-6989586621682089083"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089083"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682089084"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089084"><span class="hs-identifier hs-var">mHscMessager</span></a></span></span><span> </span><span id="local-6989586621682089085"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089085"><span class="hs-identifier hs-var">all_pipelines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2849"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="GHC.Driver.Make.html#label_self"><span class="hs-identifier hs-var">label_self</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;main --make thread&quot;</span></span><span>
</span><span id="line-2850"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089082"><span class="hs-identifier hs-var">n_job</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2851"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Messager -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runSeqPipelines"><span class="hs-identifier hs-var">runSeqPipelines</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089083"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089084"><span class="hs-identifier hs-var">mHscMessager</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089085"><span class="hs-identifier hs-var">all_pipelines</span></a></span><span>
</span><span id="line-2852"></span><span>    </span><span id="local-6989586621682089087"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089087"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; HscEnv -&gt; Maybe Messager -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runParPipelines"><span class="hs-identifier hs-var">runParPipelines</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089082"><span class="hs-identifier hs-var">n_job</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089083"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089084"><span class="hs-identifier hs-var">mHscMessager</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089085"><span class="hs-identifier hs-var">all_pipelines</span></a></span><span>
</span><span id="line-2853"></span><span>
</span><span id="line-2854"></span><span class="annot"><a href="GHC.Driver.Make.html#runSeqPipelines"><span class="hs-identifier hs-type">runSeqPipelines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2855"></span><span id="runSeqPipelines"><span class="annot"><span class="annottext">runSeqPipelines :: HscEnv -&gt; Maybe Messager -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runSeqPipelines"><span class="hs-identifier hs-var hs-var">runSeqPipelines</span></a></span></span><span> </span><span id="local-6989586621682089089"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089089"><span class="hs-identifier hs-var">plugin_hsc_env</span></a></span></span><span> </span><span id="local-6989586621682089090"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089090"><span class="hs-identifier hs-var">mHscMessager</span></a></span></span><span> </span><span id="local-6989586621682089091"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089091"><span class="hs-identifier hs-var">all_pipelines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2856"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089092"><span class="annot"><span class="annottext">env :: MakeEnv
</span><a href="#local-6989586621682089092"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089089"><span class="hs-identifier hs-var">plugin_hsc_env</span></a></span><span>
</span><span id="line-2857"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">withLogger :: forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Make.html#withLogger"><span class="hs-identifier hs-var">withLogger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682089093"><span class="annot"><span class="annottext">(Logger -&gt; Logger) -&gt; IO a
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Logger -&gt; Logger) -&gt; IO a
</span><a href="#local-6989586621682089093"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; Logger
forall a. a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#id/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2858"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">compile_sem :: AbstractSem
</span><a href="GHC.Driver.Make.html#compile_sem"><span class="hs-identifier hs-var">compile_sem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; AbstractSem
</span><a href="GHC.Driver.Make.html#AbstractSem"><span class="hs-identifier hs-var">AbstractSem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2859"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">env_messager :: Maybe Messager
</span><a href="GHC.Driver.Make.html#env_messager"><span class="hs-identifier hs-var">env_messager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089090"><span class="hs-identifier hs-var">mHscMessager</span></a></span><span>
</span><span id="line-2860"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2861"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MakeEnv -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runAllPipelines"><span class="hs-identifier hs-var">runAllPipelines</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089092"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089091"><span class="hs-identifier hs-var">all_pipelines</span></a></span><span>
</span><span id="line-2862"></span><span>
</span><span id="line-2863"></span><span>
</span><span id="line-2864"></span><span class="annot"><span class="hs-comment">-- | Build and run a pipeline</span></span><span>
</span><span id="line-2865"></span><span class="annot"><a href="GHC.Driver.Make.html#runParPipelines"><span class="hs-identifier hs-type">runParPipelines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ How many capabilities to use</span></span><span>
</span><span id="line-2866"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ The basic HscEnv which is augmented with specific info for each module</span></span><span>
</span><span id="line-2867"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Optional custom messager to use to report progress</span></span><span>
</span><span id="line-2868"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ The build plan for all the module nodes</span></span><span>
</span><span id="line-2869"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2870"></span><span id="runParPipelines"><span class="annot"><span class="annottext">runParPipelines :: Int -&gt; HscEnv -&gt; Maybe Messager -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runParPipelines"><span class="hs-identifier hs-var hs-var">runParPipelines</span></a></span></span><span> </span><span id="local-6989586621682089095"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089095"><span class="hs-identifier hs-var">n_jobs</span></a></span></span><span> </span><span id="local-6989586621682089096"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089096"><span class="hs-identifier hs-var">plugin_hsc_env</span></a></span></span><span> </span><span id="local-6989586621682089097"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089097"><span class="hs-identifier hs-var">mHscMessager</span></a></span></span><span> </span><span id="local-6989586621682089098"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089098"><span class="hs-identifier hs-var">all_pipelines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2871"></span><span>
</span><span id="line-2872"></span><span>
</span><span id="line-2873"></span><span>  </span><span class="hs-comment">-- A variable which we write to when an error has happened and we have to tell the</span><span>
</span><span id="line-2874"></span><span>  </span><span class="hs-comment">-- logging thread to gracefully shut down.</span><span>
</span><span id="line-2875"></span><span>  </span><span id="local-6989586621682089099"><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621682089099"><span class="hs-identifier hs-var">stopped_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (TVar Bool)
forall a. a -&gt; IO (TVar a)
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#newTVarIO/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2876"></span><span>  </span><span class="hs-comment">-- The queue of LogQueues which actions are able to write to. When an action starts it</span><span>
</span><span id="line-2877"></span><span>  </span><span class="hs-comment">-- will add it's LogQueue into this queue.</span><span>
</span><span id="line-2878"></span><span>  </span><span id="local-6989586621682089101"><span class="annot"><span class="annottext">TVar LogQueueQueue
</span><a href="#local-6989586621682089101"><span class="hs-identifier hs-var">log_queue_queue_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LogQueueQueue -&gt; IO (TVar LogQueueQueue)
forall a. a -&gt; IO (TVar a)
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#newTVarIO/GHC.Conc.Sync.html#newTVarIO"><span class="hs-identifier hs-var">newTVarIO</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueueQueue
</span><a href="GHC.Driver.Pipeline.LogQueue.html#newLogQueueQueue"><span class="hs-identifier hs-var">newLogQueueQueue</span></a></span><span>
</span><span id="line-2879"></span><span>  </span><span class="hs-comment">-- Thread which coordinates the printing of logs</span><span>
</span><span id="line-2880"></span><span>  </span><span id="local-6989586621682089103"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682089103"><span class="hs-identifier hs-var">wait_log_thread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Int -&gt; Logger -&gt; TVar Bool -&gt; TVar LogQueueQueue -&gt; IO (IO ())
</span><a href="GHC.Driver.Pipeline.LogQueue.html#logThread"><span class="hs-identifier hs-var">logThread</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089095"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MakeAction] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089098"><span class="hs-identifier hs-var">all_pipelines</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089096"><span class="hs-identifier hs-var">plugin_hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621682089099"><span class="hs-identifier hs-var">stopped_var</span></a></span><span> </span><span class="annot"><span class="annottext">TVar LogQueueQueue
</span><a href="#local-6989586621682089101"><span class="hs-identifier hs-var">log_queue_queue_var</span></a></span><span>
</span><span id="line-2881"></span><span>
</span><span id="line-2882"></span><span>
</span><span id="line-2883"></span><span>  </span><span class="hs-comment">-- Make the logger thread-safe, in case there is some output which isn't sent via the LogQueue.</span><span>
</span><span id="line-2884"></span><span>  </span><span id="local-6989586621682089105"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682089105"><span class="hs-identifier hs-var">thread_safe_logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Logger -&gt; IO Logger
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Logger -&gt; IO Logger) -&gt; IO Logger -&gt; IO Logger
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; IO Logger
</span><a href="GHC.Utils.Logger.html#makeThreadSafe"><span class="hs-identifier hs-var">makeThreadSafe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089096"><span class="hs-identifier hs-var">plugin_hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2885"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089107"><span class="annot"><span class="annottext">thread_safe_hsc_env :: HscEnv
</span><a href="#local-6989586621682089107"><span class="hs-identifier hs-var hs-var">thread_safe_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089096"><span class="hs-identifier hs-var">plugin_hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682089105"><span class="hs-identifier hs-type">thread_safe_logger</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2886"></span><span>
</span><span id="line-2887"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089108"><span class="annot"><span class="annottext">updNumCapabilities :: IO Int
</span><a href="#local-6989586621682089108"><span class="hs-identifier hs-var hs-var">updNumCapabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; IO Int
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; IO Int) -&gt; IO Int -&gt; IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2888"></span><span>          </span><span id="local-6989586621682089109"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089109"><span class="hs-identifier hs-var">n_capabilities</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#getNumCapabilities/GHC.Conc.Sync.html#getNumCapabilities"><span class="hs-identifier hs-var">getNumCapabilities</span></a></span><span>
</span><span id="line-2889"></span><span>          </span><span id="local-6989586621682089110"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089110"><span class="hs-identifier hs-var">n_cpus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#getNumProcessors/GHC.Conc.Sync.html#getNumProcessors"><span class="hs-identifier hs-var">getNumProcessors</span></a></span><span>
</span><span id="line-2890"></span><span>          </span><span class="hs-comment">-- Setting number of capabilities more than</span><span>
</span><span id="line-2891"></span><span>          </span><span class="hs-comment">-- CPU count usually leads to high userspace</span><span>
</span><span id="line-2892"></span><span>          </span><span class="hs-comment">-- lock contention. #9221</span><span>
</span><span id="line-2893"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089111"><span class="annot"><span class="annottext">n_caps :: Int
</span><a href="#local-6989586621682089111"><span class="hs-identifier hs-var hs-var">n_caps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089095"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089110"><span class="hs-identifier hs-var">n_cpus</span></a></span><span>
</span><span id="line-2894"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.2.1/src/Control.Monad.html#unless/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089109"><span class="hs-identifier hs-var">n_capabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#setNumCapabilities/GHC.Conc.Sync.html#setNumCapabilities"><span class="hs-identifier hs-var">setNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089111"><span class="hs-identifier hs-var">n_caps</span></a></span><span>
</span><span id="line-2895"></span><span>          </span><span class="hs-identifier">return</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089109"><span class="hs-identifier hs-var">n_capabilities</span></a></span><span>
</span><span id="line-2896"></span><span>
</span><span id="line-2897"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089114"><span class="annot"><span class="annottext">resetNumCapabilities :: Int -&gt; IO ()
</span><a href="#local-6989586621682089114"><span class="hs-identifier hs-var hs-var">resetNumCapabilities</span></a></span></span><span> </span><span id="local-6989586621682089115"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089115"><span class="hs-identifier hs-var">orig_n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2898"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#setNumCapabilities/GHC.Conc.Sync.html#setNumCapabilities"><span class="hs-identifier hs-var">setNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089115"><span class="hs-identifier hs-var">orig_n</span></a></span><span>
</span><span id="line-2899"></span><span>          </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#atomically/GHC.Conc.Sync.html#atomically"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">(STM () -&gt; IO ()) -&gt; STM () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TVar Bool -&gt; Bool -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#writeTVar/GHC.Conc.Sync.html#writeTVar"><span class="hs-identifier hs-var">writeTVar</span></a></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621682089099"><span class="hs-identifier hs-var">stopped_var</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2900"></span><span>          </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621682089103"><span class="hs-identifier hs-var">wait_log_thread</span></a></span><span>
</span><span id="line-2901"></span><span>
</span><span id="line-2902"></span><span>  </span><span id="local-6989586621682089117"><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621682089117"><span class="hs-identifier hs-var">compile_sem</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO QSem
</span><a href="../../base-4.18.2.1/src/Control.Concurrent.QSem.html#newQSem/Control.Concurrent.QSem.html#newQSem"><span class="hs-identifier hs-var">newQSem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089095"><span class="hs-identifier hs-var">n_jobs</span></a></span><span>
</span><span id="line-2903"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089118"><span class="annot"><span class="annottext">abstract_sem :: AbstractSem
</span><a href="#local-6989586621682089118"><span class="hs-identifier hs-var hs-var">abstract_sem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; AbstractSem
</span><a href="GHC.Driver.Make.html#AbstractSem"><span class="hs-identifier hs-var">AbstractSem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QSem -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Control.Concurrent.QSem.html#waitQSem/Control.Concurrent.QSem.html#waitQSem"><span class="hs-identifier hs-var">waitQSem</span></a></span><span> </span><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621682089117"><span class="hs-identifier hs-var">compile_sem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QSem -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/Control.Concurrent.QSem.html#signalQSem/Control.Concurrent.QSem.html#signalQSem"><span class="hs-identifier hs-var">signalQSem</span></a></span><span> </span><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621682089117"><span class="hs-identifier hs-var">compile_sem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2904"></span><span>    </span><span class="hs-comment">-- Reset the number of capabilities once the upsweep ends.</span><span>
</span><span id="line-2905"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089119"><span class="annot"><span class="annottext">env :: MakeEnv
</span><a href="#local-6989586621682089119"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089107"><span class="hs-identifier hs-var">thread_safe_hsc_env</span></a></span><span>
</span><span id="line-2906"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">withLogger :: forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
</span><a href="GHC.Driver.Make.html#withLogger"><span class="hs-identifier hs-var">withLogger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar LogQueueQueue -&gt; Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
forall b.
TVar LogQueueQueue -&gt; Int -&gt; ((Logger -&gt; Logger) -&gt; IO b) -&gt; IO b
</span><a href="GHC.Driver.Make.html#withParLog"><span class="hs-identifier hs-var">withParLog</span></a></span><span> </span><span class="annot"><span class="annottext">TVar LogQueueQueue
</span><a href="#local-6989586621682089101"><span class="hs-identifier hs-var">log_queue_queue_var</span></a></span><span>
</span><span id="line-2907"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">compile_sem :: AbstractSem
</span><a href="GHC.Driver.Make.html#compile_sem"><span class="hs-identifier hs-var">compile_sem</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AbstractSem
</span><a href="#local-6989586621682089118"><span class="hs-identifier hs-var">abstract_sem</span></a></span><span>
</span><span id="line-2908"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">env_messager :: Maybe Messager
</span><a href="GHC.Driver.Make.html#env_messager"><span class="hs-identifier hs-var">env_messager</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621682089097"><span class="hs-identifier hs-var">mHscMessager</span></a></span><span>
</span><span id="line-2909"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2910"></span><span>
</span><span id="line-2911"></span><span>  </span><span class="annot"><span class="annottext">IO Int -&gt; (Int -&gt; IO ()) -&gt; (Int -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a c b.
(HasCallStack, MonadMask m) =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#bracket/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="#local-6989586621682089108"><span class="hs-identifier hs-var">updNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621682089114"><span class="hs-identifier hs-var">resetNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; IO ()) -&gt; IO ()) -&gt; (Int -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2912"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; MakeEnv -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runAllPipelines"><span class="hs-identifier hs-var">runAllPipelines</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089095"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089119"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089098"><span class="hs-identifier hs-var">all_pipelines</span></a></span><span>
</span><span id="line-2913"></span><span>
</span><span id="line-2914"></span><span id="local-6989586621682086314"><span class="annot"><a href="GHC.Driver.Make.html#withLocalTmpFS"><span class="hs-identifier hs-type">withLocalTmpFS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086314"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086314"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2915"></span><span id="withLocalTmpFS"><span class="annot"><span class="annottext">withLocalTmpFS :: forall a. RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withLocalTmpFS"><span class="hs-identifier hs-var hs-var">withLocalTmpFS</span></a></span></span><span> </span><span id="local-6989586621682089128"><span class="annot"><span class="annottext">RunMakeM a
</span><a href="#local-6989586621682089128"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2916"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682089141"><span class="annot"><span class="annottext">initialiser :: ReaderT MakeEnv (MaybeT IO) HscEnv
</span><a href="#local-6989586621682089141"><span class="hs-identifier hs-var hs-var">initialiser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2917"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621682089142"><span id="local-6989586621682089143"><span id="local-6989586621682089144"><span id="local-6989586621682089145"><span class="annot"><span class="annottext">Maybe Messager
HscEnv
AbstractSem
forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
hsc_env :: MakeEnv -&gt; HscEnv
compile_sem :: MakeEnv -&gt; AbstractSem
withLogger :: MakeEnv -&gt; forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
env_messager :: MakeEnv -&gt; Maybe Messager
hsc_env :: HscEnv
compile_sem :: AbstractSem
withLogger :: forall a. Int -&gt; ((Logger -&gt; Logger) -&gt; IO a) -&gt; IO a
env_messager :: Maybe Messager
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT MakeEnv (MaybeT IO) MakeEnv
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ask/Control.Monad.Trans.Reader.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-2918"></span><span>        </span><span id="local-6989586621682089146"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682089146"><span class="hs-identifier hs-var">lcl_tmpfs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO TmpFs -&gt; ReaderT MakeEnv (MaybeT IO) TmpFs
forall a. IO a -&gt; ReaderT MakeEnv (MaybeT IO) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO TmpFs -&gt; ReaderT MakeEnv (MaybeT IO) TmpFs)
-&gt; IO TmpFs -&gt; ReaderT MakeEnv (MaybeT IO) TmpFs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; IO TmpFs
</span><a href="GHC.Utils.TmpFs.html#forkTmpFsFrom"><span class="hs-identifier hs-var">forkTmpFsFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089142"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2919"></span><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089142"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682089146"><span class="hs-identifier hs-type">lcl_tmpfs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2920"></span><span>      </span><span id="local-6989586621682089162"><span class="annot"><span class="annottext">finaliser :: HscEnv -&gt; ReaderT MakeEnv m ()
</span><a href="#local-6989586621682089162"><span class="hs-identifier hs-var hs-var">finaliser</span></a></span></span><span> </span><span id="local-6989586621682089163"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089163"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2921"></span><span>        </span><span id="local-6989586621682089164"><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089164"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT MakeEnv m MakeEnv
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ask/Control.Monad.Trans.Reader.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-2922"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ReaderT MakeEnv m ()
forall a. IO a -&gt; ReaderT MakeEnv m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ReaderT MakeEnv m ()) -&gt; IO () -&gt; ReaderT MakeEnv m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs -&gt; TmpFs -&gt; IO ()
</span><a href="GHC.Utils.TmpFs.html#mergeTmpFsInto"><span class="hs-identifier hs-var">mergeTmpFsInto</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089163"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MakeEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089164"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2923"></span><span>       </span><span class="hs-comment">-- Add remaining files which weren't cleaned up into local tmp fs for</span><span>
</span><span id="line-2924"></span><span>       </span><span class="hs-comment">-- clean-up later.</span><span>
</span><span id="line-2925"></span><span>       </span><span class="hs-comment">-- Clear the logQueue if this node had it's own log queue</span><span>
</span><span id="line-2926"></span><span>  </span><span class="annot"><span class="annottext">ReaderT MakeEnv (MaybeT IO) HscEnv
-&gt; (HscEnv -&gt; RunMakeM ()) -&gt; (HscEnv -&gt; RunMakeM a) -&gt; RunMakeM a
forall (m :: * -&gt; *) a c b.
(HasCallStack, MonadMask m) =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#bracket/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT MakeEnv (MaybeT IO) HscEnv
</span><a href="#local-6989586621682089141"><span class="hs-identifier hs-var">initialiser</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; RunMakeM ()
forall {m :: * -&gt; *}. MonadIO m =&gt; HscEnv -&gt; ReaderT MakeEnv m ()
</span><a href="#local-6989586621682089162"><span class="hs-identifier hs-var">finaliser</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; RunMakeM a) -&gt; RunMakeM a)
-&gt; (HscEnv -&gt; RunMakeM a) -&gt; RunMakeM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682089166"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682089166"><span class="hs-identifier hs-var">lcl_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(MakeEnv -&gt; MakeEnv) -&gt; RunMakeM a -&gt; RunMakeM a
forall r (m :: * -&gt; *) a.
(r -&gt; r) -&gt; ReaderT r m a -&gt; ReaderT r m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#local/Control.Monad.Trans.Reader.html#local"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682089167"><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089167"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089167"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682089166"><span class="hs-identifier hs-type">lcl_hsc_env</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMakeM a
</span><a href="#local-6989586621682089128"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-2927"></span><span>
</span><span id="line-2928"></span><span class="annot"><span class="hs-comment">-- | Run the given actions and then wait for them all to finish.</span></span><span>
</span><span id="line-2929"></span><span class="annot"><a href="GHC.Driver.Make.html#runAllPipelines"><span class="hs-identifier hs-type">runAllPipelines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2930"></span><span id="runAllPipelines"><span class="annot"><span class="annottext">runAllPipelines :: Int -&gt; MakeEnv -&gt; [MakeAction] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#runAllPipelines"><span class="hs-identifier hs-var hs-var">runAllPipelines</span></a></span></span><span> </span><span id="local-6989586621682089168"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089168"><span class="hs-identifier hs-var">n_jobs</span></a></span></span><span> </span><span id="local-6989586621682089169"><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089169"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621682089170"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089170"><span class="hs-identifier hs-var">acts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2931"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682089171"><span class="hs-identifier hs-type">spawn_actions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#ThreadId/GHC.Conc.Sync.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2932"></span><span>      </span><span id="local-6989586621682089171"><span class="annot"><span class="annottext">spawn_actions :: IO [ThreadId]
</span><a href="#local-6989586621682089171"><span class="hs-identifier hs-var hs-var">spawn_actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682089168"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2933"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadId -&gt; [ThreadId] -&gt; [ThreadId]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ThreadId -&gt; [ThreadId]) -&gt; IO ThreadId -&gt; IO [ThreadId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#forkIOWithUnmask/GHC.Conc.Sync.html#forkIOWithUnmask"><span class="hs-identifier hs-var">forkIOWithUnmask</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId)
-&gt; ((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682089172"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621682089172"><span class="hs-identifier hs-var">unmask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO [()] -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [()] -&gt; IO ()) -&gt; IO [()] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ())
-&gt; MakeEnv -&gt; [MakeAction] -&gt; IO [()]
forall a.
(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a)
-&gt; MakeEnv -&gt; [MakeAction] -&gt; IO [a]
</span><a href="GHC.Driver.Make.html#runLoop"><span class="hs-identifier hs-var">runLoop</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682089175"><span class="annot"><span class="annottext">(forall a. IO a -&gt; IO a) -&gt; IO ()
</span><a href="#local-6989586621682089175"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall a. IO a -&gt; IO a) -&gt; IO ()
</span><a href="#local-6989586621682089175"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall a. IO a -&gt; IO a
</span><a href="#local-6989586621682089172"><span class="hs-identifier hs-var">unmask</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089169"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089170"><span class="hs-identifier hs-var">acts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2934"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId)
-&gt; MakeEnv -&gt; [MakeAction] -&gt; IO [ThreadId]
forall a.
(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a)
-&gt; MakeEnv -&gt; [MakeAction] -&gt; IO [a]
</span><a href="GHC.Driver.Make.html#runLoop"><span class="hs-identifier hs-var">runLoop</span></a></span><span> </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#forkIOWithUnmask/GHC.Conc.Sync.html#forkIOWithUnmask"><span class="hs-identifier hs-var">forkIOWithUnmask</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089169"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089170"><span class="hs-identifier hs-var">acts</span></a></span><span>
</span><span id="line-2935"></span><span>
</span><span id="line-2936"></span><span>      </span><span class="annot"><a href="#local-6989586621682089176"><span class="hs-identifier hs-type">kill_actions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#ThreadId/GHC.Conc.Sync.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2937"></span><span>      </span><span id="local-6989586621682089176"><span class="annot"><span class="annottext">kill_actions :: [ThreadId] -&gt; IO ()
</span><a href="#local-6989586621682089176"><span class="hs-identifier hs-var hs-var">kill_actions</span></a></span></span><span> </span><span id="local-6989586621682089177"><span class="annot"><span class="annottext">[ThreadId]
</span><a href="#local-6989586621682089177"><span class="hs-identifier hs-var">tids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ThreadId -&gt; IO ()) -&gt; [ThreadId] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/GHC.Conc.Sync.html#killThread/GHC.Conc.Sync.html#killThread"><span class="hs-identifier hs-var">killThread</span></a></span><span> </span><span class="annot"><span class="annottext">[ThreadId]
</span><a href="#local-6989586621682089177"><span class="hs-identifier hs-var">tids</span></a></span><span>
</span><span id="line-2938"></span><span>
</span><span id="line-2939"></span><span>  </span><span class="annot"><span class="annottext">IO [ThreadId]
-&gt; ([ThreadId] -&gt; IO ()) -&gt; ([ThreadId] -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a c b.
(HasCallStack, MonadMask m) =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#bracket/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span> </span><span class="annot"><span class="annottext">IO [ThreadId]
</span><a href="#local-6989586621682089171"><span class="hs-identifier hs-var">spawn_actions</span></a></span><span> </span><span class="annot"><span class="annottext">[ThreadId] -&gt; IO ()
</span><a href="#local-6989586621682089176"><span class="hs-identifier hs-var">kill_actions</span></a></span><span> </span><span class="annot"><span class="annottext">(([ThreadId] -&gt; IO ()) -&gt; IO ()) -&gt; ([ThreadId] -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[ThreadId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2940"></span><span>    </span><span class="annot"><span class="annottext">(MakeAction -&gt; IO ()) -&gt; [MakeAction] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">MakeAction -&gt; IO ()
</span><a href="GHC.Driver.Make.html#waitMakeAction"><span class="hs-identifier hs-var">waitMakeAction</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089170"><span class="hs-identifier hs-var">acts</span></a></span><span>
</span><span id="line-2941"></span><span>
</span><span id="line-2942"></span><span class="hs-comment">-- | Execute each action in order, limiting the amount of parallelism by the given</span><span>
</span><span id="line-2943"></span><span class="hs-comment">-- semaphore.</span><span>
</span><span id="line-2944"></span><span id="local-6989586621682086322"><span class="annot"><a href="GHC.Driver.Make.html#runLoop"><span class="hs-identifier hs-type">runLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682089180"><span class="annot"><a href="#local-6989586621682089180"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682089180"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682089180"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682086322"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeEnv"><span class="hs-identifier hs-type">MakeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682086322"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-2945"></span><span id="runLoop"><span class="annot"><span class="annottext">runLoop :: forall a.
(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a)
-&gt; MakeEnv -&gt; [MakeAction] -&gt; IO [a]
</span><a href="GHC.Driver.Make.html#runLoop"><span class="hs-identifier hs-var hs-var">runLoop</span></a></span></span><span> </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682089182"><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089182"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; IO [a]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2946"></span><span class="annot"><a href="GHC.Driver.Make.html#runLoop"><span class="hs-identifier hs-var">runLoop</span></a></span><span> </span><span id="local-6989586621682089183"><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a
</span><a href="#local-6989586621682089183"><span class="hs-identifier hs-var">fork_thread</span></a></span></span><span> </span><span id="local-6989586621682089184"><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089184"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span> </span><span id="local-6989586621682089191"><span class="annot"><span class="annottext">RunMakeM a
</span><a href="#local-6989586621682089191"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621682089192"><span class="annot"><span class="annottext">MVar (Maybe a)
</span><a href="#local-6989586621682089192"><span class="hs-identifier hs-var">res_var</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682089193"><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089193"><span class="hs-identifier hs-var">acts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2947"></span><span>  </span><span id="local-6989586621682089194"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682089194"><span class="hs-identifier hs-var">new_thread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2948"></span><span>    </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a
</span><a href="#local-6989586621682089183"><span class="hs-identifier hs-var">fork_thread</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a)
-&gt; ((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682089195"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621682089195"><span class="hs-identifier hs-var">unmask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><span id="line-2949"></span><span>            </span><span id="local-6989586621682089196"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682089196"><span class="hs-identifier hs-var">mres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; IO (Maybe a)
forall a. IO a -&gt; IO a
</span><a href="#local-6989586621682089195"><span class="hs-identifier hs-var">unmask</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe a) -&gt; IO (Maybe a)) -&gt; IO (Maybe a) -&gt; IO (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RunMakeM a -&gt; IO (Maybe a)
forall a. RunMakeM a -&gt; IO (Maybe a)
</span><a href="#local-6989586621682089197"><span class="hs-identifier hs-var">run_pipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RunMakeM a -&gt; RunMakeM a
forall a. RunMakeM a -&gt; RunMakeM a
</span><a href="GHC.Driver.Make.html#withLocalTmpFS"><span class="hs-identifier hs-var">withLocalTmpFS</span></a></span><span> </span><span class="annot"><span class="annottext">RunMakeM a
</span><a href="#local-6989586621682089191"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2950"></span><span>                      </span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; IO () -&gt; IO (Maybe a)
forall (m :: * -&gt; *) a b.
(HasCallStack, MonadCatch m) =&gt;
m a -&gt; m b -&gt; m a
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#onException/Control.Monad.Catch.html#onException"><span class="hs-operator hs-var">`MC.onException`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar (Maybe a) -&gt; Maybe a -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#putMVar/GHC.MVar.html#putMVar"><span class="hs-identifier hs-var">putMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe a)
</span><a href="#local-6989586621682089192"><span class="hs-identifier hs-var">res_var</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Defensive: If there's an unhandled exception then still signal the failure.</span><span>
</span><span id="line-2951"></span><span>            </span><span class="annot"><span class="annottext">MVar (Maybe a) -&gt; Maybe a -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#putMVar/GHC.MVar.html#putMVar"><span class="hs-identifier hs-var">putMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe a)
</span><a href="#local-6989586621682089192"><span class="hs-identifier hs-var">res_var</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682089196"><span class="hs-identifier hs-var">mres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2952"></span><span>  </span><span id="local-6989586621682089200"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682089200"><span class="hs-identifier hs-var">threads</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a)
-&gt; MakeEnv -&gt; [MakeAction] -&gt; IO [a]
forall a.
(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a)
-&gt; MakeEnv -&gt; [MakeAction] -&gt; IO [a]
</span><a href="GHC.Driver.Make.html#runLoop"><span class="hs-identifier hs-var">runLoop</span></a></span><span> </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO a
</span><a href="#local-6989586621682089183"><span class="hs-identifier hs-var">fork_thread</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089184"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[MakeAction]
</span><a href="#local-6989586621682089193"><span class="hs-identifier hs-var">acts</span></a></span><span>
</span><span id="line-2953"></span><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682089194"><span class="hs-identifier hs-var">new_thread</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682089200"><span class="hs-identifier hs-var">threads</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2954"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2955"></span><span>      </span><span id="local-6989586621682086330"><span class="annot"><a href="#local-6989586621682089197"><span class="hs-identifier hs-type">run_pipeline</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086330"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682086330"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2956"></span><span>      </span><span id="local-6989586621682089197"><span class="annot"><span class="annottext">run_pipeline :: forall a. RunMakeM a -&gt; IO (Maybe a)
</span><a href="#local-6989586621682089197"><span class="hs-identifier hs-var hs-var">run_pipeline</span></a></span></span><span> </span><span id="local-6989586621682089201"><span class="annot"><span class="annottext">RunMakeM a
</span><a href="#local-6989586621682089201"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT IO a -&gt; IO (Maybe a)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Maybe.html#runMaybeT/Control.Monad.Trans.Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RunMakeM a -&gt; MakeEnv -&gt; MaybeT IO a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#runReaderT/Control.Monad.Trans.Reader.html#runReaderT"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">RunMakeM a
</span><a href="#local-6989586621682089201"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">MakeEnv
</span><a href="#local-6989586621682089184"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2957"></span><span>
</span><span id="line-2958"></span><span class="hs-keyword">data</span><span> </span><span id="MakeAction"><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-var">MakeAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682089203"><span class="annot"><a href="#local-6989586621682089203"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span id="MakeAction"><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-var">MakeAction</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#RunMakeM"><span class="hs-identifier hs-type">RunMakeM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089203"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.MVar.html#MVar/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682089203"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2959"></span><span>
</span><span id="line-2960"></span><span class="annot"><a href="GHC.Driver.Make.html#waitMakeAction"><span class="hs-identifier hs-type">waitMakeAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2961"></span><span id="waitMakeAction"><span class="annot"><span class="annottext">waitMakeAction :: MakeAction -&gt; IO ()
</span><a href="GHC.Driver.Make.html#waitMakeAction"><span class="hs-identifier hs-var hs-var">waitMakeAction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#MakeAction"><span class="hs-identifier hs-type">MakeAction</span></a></span><span> </span><span class="annot"><span class="annottext">RunMakeM a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682089205"><span class="annot"><span class="annottext">MVar (Maybe a)
</span><a href="#local-6989586621682089205"><span class="hs-identifier hs-var">mvar</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO (Maybe a) -&gt; IO ()
forall a b. a -&gt; IO b -&gt; IO a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%24/GHC.Base.html#%3C%24"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe a) -&gt; IO (Maybe a)
forall a. MVar a -&gt; IO a
</span><a href="../../base-4.18.2.1/src/GHC.MVar.html#readMVar/GHC.MVar.html#readMVar"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe a)
</span><a href="#local-6989586621682089205"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-2962"></span><span>
</span><span id="line-2963"></span><span class="hs-comment">{- Note [GHC Heap Invariants]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~
This note is a general place to explain some of the heap invariants which should
hold for a program compiled with --make mode. These invariants are all things
which can be checked easily using ghc-debug.

1. No HomeModInfo are reachable via the EPS.
   Why? Interfaces are lazily loaded into the EPS and the lazy thunk retains
        a reference to the entire HscEnv, if we are not careful the HscEnv will
        contain the HomePackageTable at the time the interface was loaded and
        it will never be released.
   Where? dontLeakTheHPT in GHC.Iface.Load

2. No KnotVars are live at the end of upsweep (#20491)
   Why? KnotVars contains an old stale reference to the TypeEnv for modules
        which participate in a loop. At the end of a loop all the KnotVars references
        should be removed by the call to typecheckLoop.
   Where? typecheckLoop in GHC.Driver.Make.

3. Immediately after a reload, no ModDetails are live.
   Why? During the upsweep all old ModDetails are replaced with a new ModDetails
        generated from a ModIface. If we don't clear the ModDetails before the
        reload takes place then memory usage during the reload is twice as much
        as it should be as we retain a copy of the ModDetails for too long.
   Where? pruneCache in GHC.Driver.Make

4. No TcGblEnv or TcLclEnv are live after typechecking is completed.
   Why? By the time we get to simplification all the data structures from typechecking
        should be eliminated.
   Where? No one place in the compiler. These leaks can be introduced by not suitable
          forcing functions which take a TcLclEnv as an argument.

5. At the end of a successful upsweep, the number of live ModDetails equals the
   number of non-boot Modules.
   Why? Each module has a HomeModInfo which contains a ModDetails from that module.
   Where? See Note [ModuleNameSet, efficiency and space leaks], a variety of places
          in the driver are responsible.
-}</span><span>
</span><span id="line-3001"></span></pre></body></html>