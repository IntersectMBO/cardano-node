<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BinaryLiterals #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">-- | A language to express the evaluation context of an expression as a</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- 'Demand' and track how an expression evaluates free variables and arguments</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- in turn as a 'DmdType'.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Lays out the abstract domain for &quot;GHC.Core.Opt.DmdAnal&quot;.</span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Types.Demand</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demands</span></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier">Boxity</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier">Card</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier">C_00</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier">C_01</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier">C_0N</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier">C_10</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier">C_11</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier">C_1N</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#CardNonAbs"><span class="hs-identifier">CardNonAbs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#CardNonOnce"><span class="hs-identifier">CardNonOnce</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier">Demand</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier">AbsDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier">BotDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator">(:*)</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier">SubDemand</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier">Prod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier">Poly</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier">mkProd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier">viewProd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Algebra</span></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier">absDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier">topDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier">botDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDmd"><span class="hs-identifier">seqDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier">topSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Least upper bound</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier">lubCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier">lubDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier">lubSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Plus</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier">plusCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier">plusDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier">plusSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Multiply</span></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier">multCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier">multDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier">multSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Predicates on @Card@inalities and @Demand@s</span></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier">isAbs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier">isUsedOnce</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier">isStrict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier">isAbsDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier">isUsedOnceDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier">isStrUsedDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isStrictDmd"><span class="hs-identifier">isStrictDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#isTopDmd"><span class="hs-identifier">isTopDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isWeakDmd"><span class="hs-identifier">isWeakDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#onlyBoxedArguments"><span class="hs-identifier">onlyBoxedArguments</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Special demands</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#evalDmd"><span class="hs-identifier">evalDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Demands used in PrimOp signatures</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply1Dmd"><span class="hs-identifier">lazyApply1Dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply2Dmd"><span class="hs-identifier">lazyApply2Dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictOnceApply1Dmd"><span class="hs-identifier">strictOnceApply1Dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictManyApply1Dmd"><span class="hs-identifier">strictManyApply1Dmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Other @Demand@ operations</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier">oneifyCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier">oneifyDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDmd"><span class="hs-identifier">strictifyDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier">strictifyDictDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lazifyDmd"><span class="hs-identifier">lazifyDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier">peelCallDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier">peelManyCalls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier">mkCalledOnceDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmds"><span class="hs-identifier">mkCalledOnceDmds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#mkWorkerDemand"><span class="hs-identifier">mkWorkerDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#subDemandIfEvaluated"><span class="hs-identifier">subDemandIfEvaluated</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Extracting one-shot information</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier">argOneShots</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#argsOneShots"><span class="hs-identifier">argsOneShots</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier">saturatedByOneShots</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Manipulating Boxity of a Demand</span></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#unboxDeeplyDmd"><span class="hs-identifier">unboxDeeplyDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Divergence</span></span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier">Divergence</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier">topDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier">botDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier">exnDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier">lubDivergence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier">isDeadEndDiv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand environments</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier">DmdEnv</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#addVarDmdEnv"><span class="hs-identifier">addVarDmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkTermDmdEnv"><span class="hs-identifier">mkTermDmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier">nopDmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdEnv"><span class="hs-identifier">plusDmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdEnvs"><span class="hs-identifier">plusDmdEnvs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#reuseEnv"><span class="hs-identifier">reuseEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand types</span></span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier">DmdType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier">dmdTypeDepth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Algebra</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier">nopDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier">botDmdType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier">lubDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdType"><span class="hs-identifier">plusDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier">multDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#discardArgDmds"><span class="hs-identifier">discardArgDmds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Other operations</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#peelFV"><span class="hs-identifier">peelFV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#findIdDemand"><span class="hs-identifier">findIdDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#addDemand"><span class="hs-identifier">addDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier">splitDmdTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#deferAfterPreciseException"><span class="hs-identifier">deferAfterPreciseException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand signatures</span></span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier">DmdSig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkDmdSigForArity"><span class="hs-identifier">mkDmdSigForArity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkClosedDmdSig"><span class="hs-identifier">mkClosedDmdSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkVanillaDmdSig"><span class="hs-identifier">mkVanillaDmdSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdSig"><span class="hs-identifier">splitDmdSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdSigDmdEnv"><span class="hs-identifier">dmdSigDmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#hasDemandEnvSig"><span class="hs-identifier">hasDemandEnvSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#nopSig"><span class="hs-identifier">nopSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botSig"><span class="hs-identifier">botSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isNopSig"><span class="hs-identifier">isNopSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isBottomingSig"><span class="hs-identifier">isBottomingSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndSig"><span class="hs-identifier">isDeadEndSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndAppSig"><span class="hs-identifier">isDeadEndAppSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxityDmdSig"><span class="hs-identifier">trimBoxityDmdSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#transferArgBoxityDmdSig"><span class="hs-identifier">transferArgBoxityDmdSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Handling arity adjustments</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#prependArgsDmdSig"><span class="hs-identifier">prependArgsDmdSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#etaConvertDmdSig"><span class="hs-identifier">etaConvertDmdSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand transformers from demand signatures</span></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier">DmdTransformer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformSig"><span class="hs-identifier">dmdTransformSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDataConSig"><span class="hs-identifier">dmdTransformDataConSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier">dmdTransformDictSelSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Trim to a type shape</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier">TypeShape</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier">trimToType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier">trimBoxity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-comment">-- * @seq@ing stuff</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier">seqDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier">seqDemandList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier">seqDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdSig"><span class="hs-identifier">seqDmdSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Zapping usage information</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#zapUsageDemand"><span class="hs-identifier">zapUsageDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier">zapDmdEnvSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier">zapUsedOnceDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceSig"><span class="hs-identifier">zapUsedOnceSig</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#orElse"><span class="hs-identifier">orElse</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier">Type</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier">isNewTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier">isClassTyCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#splitDataProductType_maybe"><span class="hs-identifier">splitDataProductType_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#StrictnessMark"><span class="hs-identifier">StrictnessMark</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#isMarkedStrict"><span class="hs-identifier">isMarkedStrict</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier">scaledThing</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html"><span class="hs-identifier">GHC.Utils.Binary</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Coerce.html#/Data.Coerce.html"><span class="hs-identifier">Data.Coerce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">coerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Function.html#/Data.Function.html"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
           Boxity: Whether the box of something is used
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">{- Note [Strictness and Unboxing]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If an argument is used strictly by the function body, we may use use
call-by-value instead of call-by-need for that argument. What's more, we may
unbox an argument that is used strictly, discarding the box at the call site.
This can reduce allocations of the program drastically if the box really isn't
needed in the function body. Here's an example:
```
even :: Int -&gt; Bool
even (I# 0) = True
even (I# 1) = False
even (I# n) = even (I# (n -# 2))
```
All three code paths of 'even' are (a) strict in the argument, and (b)
immediately discard the boxed 'Int'. Now if we have a call site like
`even (I# 42)`, then it would be terrible to allocate the 'I#' box for the
argument only to tear it apart immediately in the body of 'even'! Hence,
worker/wrapper will allocate a wrapper for 'even' that not only uses
call-by-value for the argument (e.g., `case I# 42 of b { $weven b }`), but also
*unboxes* the argument, resulting in
```
even :: Int -&gt; Bool
even (I# n) = $weven n
$weven :: Int# -&gt; Bool
$weven 0 = True
$weven 1 = False
$weven n = $weven (n -# 2)
```
And now the box in `even (I# 42)` will cancel away after inlining the wrapper.

As far as the permission to unbox is concerned, *evaluatedness* of the argument
is the important trait. Unboxing implies eager evaluation of an argument and
we don't want to change the termination properties of the function. One way
to ensure that is to unbox strict arguments only, but strictness is only a
sufficient condition for evaluatedness.
See Note [Unboxing evaluated arguments] in &quot;GHC.Core.Opt.DmdAnal&quot;, where
we manage to unbox *strict fields* of unboxed arguments that the function is not
actually strict in, simply by realising that those fields have to be evaluated.

Note [Boxity analysis]
~~~~~~~~~~~~~~~~~~~~~~
Alas, we don't want to unbox *every* strict argument
(as Note [Strictness and Unboxing] might suggest).
Here's an example (from T19871):
```
data Huge = H Bool Bool ... Bool
ann :: Huge -&gt; (Bool, Huge)
ann h@(Huge True _ ... _) = (False, h)
ann h                     = (True,  h)
```
Unboxing 'h' yields
```
$wann :: Bool -&gt; Bool -&gt; ... -&gt; Bool -&gt; (Bool, Huge)
$wann True b2 ... bn = (False, Huge True b2 ... bn)
$wann b1   b2 ... bn = (True,  Huge b1   b2 ... bn)
```
The pair constructor really needs its fields boxed. But '$wann' doesn't get
passed 'h' anymore, only its components! Ergo it has to reallocate the 'Huge'
box, in a process called &quot;reboxing&quot;. After w/w, call sites like
`case ... of Just h -&gt; ann h` pay for the allocation of the additional box.
In earlier versions of GHC we simply accepted that reboxing would sometimes
happen, but we found some cases where it made a big difference: #19407, for
example.

We therefore perform a simple syntactic boxity analysis that piggy-backs on
demand analysis in order to determine whether the box of a strict argument is
always discarded in the function body, in which case we can pass it unboxed
without risking regressions such as in 'ann' above. But as soon as one use needs
the box, we want Boxed to win over any Unboxed uses.

The demand signature (cf. Note [Demand notation]) will say whether it uses
its arguments boxed or unboxed. Indeed it does so for every sub-component of
the argument demand. Here's an example:
```
f :: (Int, Int) -&gt; Bool
f (a, b) = even (a + b) -- demand signature: &lt;1!P(1!L,1!L)&gt;
```
The '!' indicates places where we want to unbox, the lack thereof indicates the
box is used by the function. Boxity flags are part of the 'Poly' and 'Prod'
'SubDemand's, see Note [Why Boxity in SubDemand and not in Demand?].
The given demand signature says &quot;Unbox the pair and then nestedly unbox its
two fields&quot;. By contrast, the demand signature of 'ann' above would look like
&lt;1P(1L,L,...,L)&gt;, lacking any '!'.

A demand signature like &lt;1P(1!L)&gt; -- Boxed outside but Unboxed in the field --
doesn't make a lot of sense, as we can never unbox the field without unboxing
the containing record. See Note [Finalising boxity for demand signatures] in
&quot;GHC.Core.Opt.DmdAnal&quot; for how we avoid to spread this and other kinds of
misinformed boxities.

Due to various practical reasons, Boxity Analysis is not conservative at times.
Here are reasons for too much optimism:

 * Note [Function body boxity and call sites] is an observation about when it is
   beneficial to unbox a parameter that is returned from a function.
   Note [Unboxed demand on function bodies returning small products] derives
   a heuristic from the former Note, pretending that all call sites of a
   function need returned small products Unboxed.
 * Note [Boxity for bottoming functions] in DmdAnal makes all bottoming
   functions unbox their arguments, incurring reboxing in code paths that will
   diverge anyway. In turn we get more unboxing in hot code paths.

Boxity analysis fixes a number of issues: #19871, #19407, #4267, #16859, #18907, #13331

Note [Function body boxity and call sites]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (from T5949)
```
f n p = case n of
  0 -&gt; p :: (a, b)
  _ -&gt; f (n-1) p
-- Worker/wrapper split if we decide to unbox:
$wf n x y = case n of
  0 -&gt; (# x, y #)
  _ -&gt; $wf (n-1) x y
f n (x,y) = case $wf n x y of (# r, s #) -&gt; (r,s)
```
When is it better to /not/ to unbox 'p'? That depends on the callers of 'f'!
If all call sites

 1. Wouldn't need to allocate fresh boxes for 'p', and
 2. Needed the result pair of 'f' boxed

Only then we'd see an increase in allocation resulting from unboxing. But as
soon as only one of (1) or (2) holds, it really doesn't matter if 'f' unboxes
'p' (and its result, it's important that CPR follows suit). For example
```
res = ... case f m (field t) of (r1,r2) -&gt; ...  -- (1) holds
arg = ... [ f m (x,y) ] ...                     -- (2) holds
```
Because one of the boxes in the call site can cancel away:
```
res = ... case field1 t of (x1,x2) -&gt;
          case field2 t of (y1,y2) -&gt;
          case $wf x1 x2 y1 y2 of (#r1,r2#) -&gt; ...
arg = ... [ case $wf x1 x2 y1 y2 of (#r1,r2#) -&gt; (r1,r2) ] ...
```
And when call sites neither have arg boxes (1) nor need the result boxed (2),
then hesitating to unbox means /more/ allocation in the call site because of the
need for fresh argument boxes.

Summary: If call sites that satisfy both (1) and (2) occur more often than call
sites that satisfy neither condition, then it's best /not/ to unbox 'p'.

Note [Unboxed demand on function bodies returning small products]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Note [Boxity analysis] achieves its biggest wins when we avoid reboxing huge
records. But when we return small products from a function, we often get faster
programs by pretending that the caller unboxes the result. Long version:

Observation: Big record arguments (e.g., DynFlags) tend to be modified much less
             frequently than small records (e.g., Int).
Result:      Big records tend to be passed around boxed (unmodified) much more
             frequently than small records.
Consequence:  The larger the record, the more likely conditions (1) and (2) from
             Note [Function body boxity and call sites] are met, in which case
             unboxing returned parameters leads to reboxing.

So we put an Unboxed demand on function bodies returning small products and a
Boxed demand on the others. What is regarded a small product is controlled by
the -fdmd-unbox-width flag.

This also manages to unbox functions like
```
sum z      []          = z
sum (I# n) ((I# x):xs) = sum (I# (n +# x)) xs
```
where we can unbox 'z' on the grounds that it's but a small box anyway. That in
turn means that the I# allocation in the recursive call site can cancel away and
we get a non-allocating loop, nice and tight.
Note that this is the typical case in &quot;Observation&quot; above: A small box is
unboxed, modified, the result reboxed for the recursive call.

Originally, this came up in binary-trees' check' function and #4267 which
(similarly) features a strict fold over a tree. We'd also regress in join004 and
join007 if we didn't assume an optimistic Unboxed demand on the function body.
T17932 features a (non-recursive) function that returns a large record, e.g.,
```
flags (Options f x) = &lt;huge&gt; `seq` f
```
and here we won't unbox 'f' because it has 5 fields (which is larger than the
default -fdmd-unbox-width threshold).

Why not focus on putting Unboxed demands on *all recursive* function?
Then we'd unbox
```
flags 0 (Options f x) = &lt;huge&gt; `seq` f
flags n o             = flags (n-1) o
```
and that seems hardly useful.
(NB: Similar to 'f' from Note [Preserving Boxity of results is rarely a win],
but there we only had 2 fields.)

What about the Boxity of *fields* of a small, returned box? Consider
```
sumIO :: Int -&gt; Int -&gt; IO Int
sumIO 0 !z = return z     -- What DmdAnal sees: sumIO 0 z s = z `seq` (# s, z #)
sumIO n !z = sumIO (n-1) (z+n)
```
We really want 'z' to unbox here. Yet its use in the returned unboxed pair
is fundamentally a Boxed one! CPR would manage to unbox it, but DmdAnal runs
before that. There is an Unboxed use in the recursive call to 'go' though.
But 'IO Int' returns a small product, and 'Int' is a small product itself.
So we'll put the RHS of 'sumIO' under sub-demand '!P(L,L!P(L))', indicating that
*if* we evaluate 'z', we don't need the box later on. And indeed the bang will
evaluate `z`, so we conclude with a total demand of `1!P(L)` on `z` and unbox
it.

Unlike for recursive functions, where we can often speed up the loop by
unboxing at the cost of a bit of reboxing in the base case, the wins for
non-recursive functions quickly turn into losses when unboxing too deeply.
That happens in T11545, T18109 and T18174. Therefore, we deeply unbox recursive
function bodies but only shallowly unbox non-recursive function bodies (governed
by the max_depth variable).

The implementation is in 'GHC.Core.Opt.DmdAnal.unboxWhenSmall'. It is quite
vital, guarding for regressions in test cases like #2387, #3586, #16040, #5075
and #19871.

Note that this is fundamentally working around a phase problem, namely that the
results of boxity analysis depend on CPR analysis (and vice versa, of course).

Note [unboxedWins]
~~~~~~~~~~~~~~~~~~
We used to use '_unboxedWins' below in 'lubBoxity', which was too optimistic.

While it worked around some shortcomings of the phase separation between Boxity
analysis and CPR analysis, it was a gross hack which caused regressions itself
that needed all kinds of fixes and workarounds. Examples (from #21119):

  * As #20767 says, L and B were no longer top and bottom of our lattice
  * In #20746 we unboxed huge Handle types that were never needed boxed in the
    first place. See Note [deferAfterPreciseException].
  * It also caused unboxing of huge records where we better shouldn't, for
    example in T19871.absent.
  * It became impossible to work with when implementing !7599, mostly due to the
    chaos that results from #20767.

Conclusion: We should use 'boxedWins' in 'lubBoxity', #21119.
Fortunately, we could come up with a number of better mechanisms to make up for
the sometimes huge regressions that would have otherwise incured:

1. A beefed up Note [Unboxed demand on function bodies returning small products]
   that works recursively fixes most regressions. It's a bit unsound, but
   pretty well-behaved.
2. We saw bottoming functions spoil boxity in some less severe cases and
   countered that with Note [Boxity for bottoming functions].

-}</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Types.Demand.html#boxedWins"><span class="hs-identifier hs-type">boxedWins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span>
</span><span id="line-364"></span><span id="boxedWins"><span class="annot"><span class="annottext">boxedWins :: Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#boxedWins"><span class="hs-identifier hs-var hs-var">boxedWins</span></a></span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span>
</span><span id="line-365"></span><span class="annot"><a href="GHC.Types.Demand.html#boxedWins"><span class="hs-identifier hs-var">boxedWins</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Types.Demand.html#_unboxedWins"><span class="hs-identifier hs-type">_unboxedWins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span>
</span><span id="line-368"></span><span class="hs-comment">-- See Note [unboxedWins]</span><span>
</span><span id="line-369"></span><span id="_unboxedWins"><span class="annot"><span class="annottext">_unboxedWins :: Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#_unboxedWins"><span class="hs-identifier hs-var hs-var">_unboxedWins</span></a></span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>
</span><span id="line-370"></span><span class="annot"><a href="GHC.Types.Demand.html#_unboxedWins"><span class="hs-identifier hs-var">_unboxedWins</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-type">lubBoxity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span>
</span><span id="line-373"></span><span class="hs-comment">-- See Note [Boxity analysis] for the lattice.</span><span>
</span><span id="line-374"></span><span id="lubBoxity"><span class="annot"><span class="annottext">lubBoxity :: Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-var hs-var">lubBoxity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#boxedWins"><span class="hs-identifier hs-var">boxedWins</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
           Card: Combining Strictness and Usage
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">{- Note [Evaluation cardinalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The demand analyser uses an (abstraction of) /evaluation cardinality/ of type
Card, to specify how many times a term is evaluated. A Card C_lu
represents an /interval/ of possible cardinalities [l..u], meaning

* Evaluated /at least/ 'l' times (strictness).
  Hence 'l' is either 0 (lazy)
                   or 1 (strict)

* Evaluated /at most/ 'u' times (usage).
  Hence 'u' is either 0 (not used at all),
                   or 1 (used at most once)
                   or n (no information)

Intervals describe sets, so the underlying lattice is the powerset lattice.

Usually l&lt;=u, but we also have C_10, the interval [1,0], the empty interval,
denoting the empty set.   This is the bottom element of the lattice.

See Note [Demand notation] for the notation we use for each of the constructors.

Note [Bit vector representation for Card]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
While the 6 inhabitants of Card admit an efficient representation as an
enumeration, implementing operations such as lubCard, plusCard and multCard
leads to unreasonably bloated code. This was the old defn for lubCard, for
example:

  -- Handle C_10 (bot)
  lubCard C_10 n    = n    -- bot
  lubCard n    C_10 = n    -- bot
  -- Handle C_0N (top)
  lubCard C_0N _    = C_0N -- top
  lubCard _    C_0N = C_0N -- top
  -- Handle C_11
  lubCard C_00 C_11 = C_01 -- {0} &#8746; {1} = {0,1}
  lubCard C_11 C_00 = C_01 -- {0} &#8746; {1} = {0,1}
  lubCard C_11 n    = n    -- {1} is a subset of all other intervals
  lubCard n    C_11 = n    -- {1} is a subset of all other intervals
  -- Handle C_1N
  lubCard C_1N C_1N = C_1N -- reflexivity
  lubCard _    C_1N = C_0N -- {0} &#8746; {1,n} = top
  lubCard C_1N _    = C_0N -- {0} &#8746; {1,n} = top
  -- Handle C_01
  lubCard C_01 _    = C_01 -- {0} &#8746; {0,1} = {0,1}
  lubCard _    C_01 = C_01 -- {0} &#8746; {0,1} = {0,1}
  -- Handle C_00
  lubCard C_00 C_00 = C_00 -- reflexivity

There's a much more compact way to encode these operations if Card is
represented not as distinctly denoted intervals, but as the subset of the set
of all cardinalities {0,1,n} instead. We represent such a subset as a bit vector
of length 3 (which fits in an Int). That's actually pretty common for such
powerset lattices.
There's one bit per denoted cardinality that is set iff that cardinality is part
of the denoted set, with n being the most significand bit (index 2) and 0 being
represented by the least significand bit (index 0).

How does that help? Well, for one, lubCard just becomes

  lubCard (Card a) (Card b) = Card (a .|. b)

The other operations, 'plusCard' and 'multCard', become significantly more
tricky, but immensely more compact. It's all straight-line code with a few bit
twiddling instructions now!

Note [Algebraic specification for plusCard and multCard]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The representation change in Note [Bit vector representation for Card] admits
very dense definitions of 'plusCard' and 'multCard' in terms of bit twiddling,
but the connection to the algebraic operations they implement is lost.
It's helpful to have a written specification of what 'plusCard' and 'multCard'
here that says what they should compute.

  * plusCard: a@[l1,u1] + b@[l2,u2] = r@[l1+l2,u1+u2].
      - In terms of sets, 0 &#8712; r iff 0 &#8712; a and 0 &#8712; b.
        Examples: set in C_00 + C_00, C_01 + C_0N, but not in C_10 + C_00
      - In terms of sets, 1 &#8712; r iff 1 &#8712; a or 1 &#8712; b.
        Examples: set in C_01 + C_00, C_0N + C_0N, but not in C_10 + C_00
      - In terms of sets, n &#8712; r iff n &#8712; a or n &#8712; b, or (1 &#8712; a and 1 &#8712; b),
        so not unlike add with carry.
        Examples: set in C_01 + C_01, C_01 + C_0N, but not in C_10 + C_01
      - Handy special cases:
          o 'plusCard C_10' bumps up the strictness of its argument, just like
            'lubCard C_00' lazifies it, without touching upper bounds.
            See also 'strictifyCard'
          o Similarly, 'plusCard C_0N' discards usage information
            (incl. absence) but leaves strictness alone.

  * multCard: a@[l1,u1] * b@[l2,u2] = r@[l1*l2,u1*u2].
      - In terms of sets, 0 &#8712; r iff 0 &#8712; a or 0 &#8712; b.
        Examples: set in C_00 * C_10, C_01 * C_1N, but not in C_10 * C_1N
      - In terms of sets, 1 &#8712; r iff 1 &#8712; a and 1 &#8712; b.
        Examples: set in C_01 * C_01, C_01 * C_1N, but not in C_11 * C_10
      - In terms of sets, n &#8712; r iff 1 &#8712; r and (n &#8712; a or n &#8712; b).
        Examples: set in C_1N * C_01, C_1N * C_0N, but not in C_10 * C_1N
      - Handy special cases:
          o 'multCard C_1N c' is the same as 'plusCard c c' and
            drops used-once info. But unlike 'plusCard C_0N', it leaves absence
            and strictness.
          o 'multCard C_01' drops strictness info, like 'lubCard C_00'.
          o 'multCard C_0N' does both; it discards all strictness and used-once
            info and retains only absence info.
-}</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-comment">-- | Describes an interval of /evaluation cardinalities/.</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- See Note [Evaluation cardinalities]</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- See Note [Bit vector representation for Card]</span><span>
</span><span id="line-494"></span><span class="hs-keyword">newtype</span><span> </span><span id="Card"><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-var">Card</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Card"><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-var">Card</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681600839"><span id="local-6989586621681600843"><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Bool
(Card -&gt; Card -&gt; Bool) -&gt; (Card -&gt; Card -&gt; Bool) -&gt; Eq Card
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Card -&gt; Card -&gt; Bool
== :: Card -&gt; Card -&gt; Bool
$c/= :: Card -&gt; Card -&gt; Bool
/= :: Card -&gt; Card -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-comment">-- | A subtype of 'Card' for which the upper bound is never 0 (no 'C_00' or</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- 'C_10'). The only four inhabitants are 'C_01', 'C_0N', 'C_11', 'C_1N'.</span><span>
</span><span id="line-499"></span><span class="hs-comment">-- Membership can be tested with 'isCardNonAbs'.</span><span>
</span><span id="line-500"></span><span class="hs-comment">-- See 'D' and 'Call' for use sites and explanation.</span><span>
</span><span id="line-501"></span><span class="hs-keyword">type</span><span> </span><span id="CardNonAbs"><span class="annot"><a href="GHC.Types.Demand.html#CardNonAbs"><span class="hs-identifier hs-var">CardNonAbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="hs-comment">-- | A subtype of 'Card' for which the upper bound is never 1 (no 'C_01' or</span><span>
</span><span id="line-504"></span><span class="hs-comment">-- 'C_11'). The only four inhabitants are 'C_00', 'C_0N', 'C_10', 'C_1N'.</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- Membership can be tested with 'isCardNonOnce'.</span><span>
</span><span id="line-506"></span><span class="hs-comment">-- See 'Poly' for use sites and explanation.</span><span>
</span><span id="line-507"></span><span class="hs-keyword">type</span><span> </span><span id="CardNonOnce"><span class="annot"><a href="GHC.Types.Demand.html#CardNonOnce"><span class="hs-identifier hs-var">CardNonOnce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="annot"><span class="hs-comment">-- | Absent, {0}. Pretty-printed as A.</span></span><span>
</span><span id="line-510"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-type">C_00</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-511"></span><span class="hs-keyword">pattern</span><span> </span><span id="C_00"><span id="%24mC_00"><span id="%24bC_00"><span class="annot"><span class="annottext">$mC_00 :: forall {r}. Card -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bC_00 :: Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var hs-var hs-var">C_00</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="annot"><span class="hs-number">0b001</span></span><span>
</span><span id="line-512"></span><span class="annot"><span class="hs-comment">-- | Bottom, {}. Pretty-printed as A.</span></span><span>
</span><span id="line-513"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-type">C_10</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-514"></span><span class="hs-keyword">pattern</span><span> </span><span id="C_10"><span id="%24mC_10"><span id="%24bC_10"><span class="annot"><span class="annottext">$mC_10 :: forall {r}. Card -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bC_10 :: Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var hs-var hs-var">C_10</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="annot"><span class="hs-number">0b000</span></span><span>
</span><span id="line-515"></span><span class="annot"><span class="hs-comment">-- | Strict and used once, {1}. Pretty-printed as 1.</span></span><span>
</span><span id="line-516"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-type">C_11</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-517"></span><span class="hs-keyword">pattern</span><span> </span><span id="C_11"><span id="%24mC_11"><span id="%24bC_11"><span class="annot"><span class="annottext">$mC_11 :: forall {r}. Card -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bC_11 :: Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var hs-var hs-var">C_11</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="annot"><span class="hs-number">0b010</span></span><span>
</span><span id="line-518"></span><span class="annot"><span class="hs-comment">-- | Used at most once, {0,1}. Pretty-printed as M.</span></span><span>
</span><span id="line-519"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-type">C_01</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-520"></span><span class="hs-keyword">pattern</span><span> </span><span id="C_01"><span id="%24mC_01"><span id="%24bC_01"><span class="annot"><span class="annottext">$mC_01 :: forall {r}. Card -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bC_01 :: Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var hs-var hs-var">C_01</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="annot"><span class="hs-number">0b011</span></span><span>
</span><span id="line-521"></span><span class="annot"><span class="hs-comment">-- | Strict and used (possibly) many times, {1,n}. Pretty-printed as S.</span></span><span>
</span><span id="line-522"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-type">C_1N</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-523"></span><span class="hs-keyword">pattern</span><span> </span><span id="C_1N"><span id="%24mC_1N"><span id="%24bC_1N"><span class="annot"><span class="annottext">$mC_1N :: forall {r}. Card -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bC_1N :: Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var hs-var hs-var">C_1N</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="annot"><span class="hs-number">0b110</span></span><span>
</span><span id="line-524"></span><span class="annot"><span class="hs-comment">-- | Every possible cardinality; the top element, {0,1,n}. Pretty-printed as L.</span></span><span>
</span><span id="line-525"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-type">C_0N</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-526"></span><span class="hs-keyword">pattern</span><span> </span><span id="C_0N"><span id="%24mC_0N"><span id="%24bC_0N"><span class="annot"><span class="annottext">$mC_0N :: forall {r}. Card -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bC_0N :: Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var hs-var hs-var">C_0N</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="annot"><span class="hs-number">0b111</span></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_00"><span class="hs-pragma hs-type">C_00</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_01"><span class="hs-pragma hs-type">C_01</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_0N"><span class="hs-pragma hs-type">C_0N</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_10"><span class="hs-pragma hs-type">C_10</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_11"><span class="hs-pragma hs-type">C_11</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#C_1N"><span class="hs-pragma hs-type">C_1N</span></a></span><span> </span><span class="hs-pragma">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-pragma hs-type">Card</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="annot"><a href="GHC.Types.Demand.html#_botCard"><span class="hs-identifier hs-type">_botCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topCard"><span class="hs-identifier hs-type">topCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-531"></span><span id="_botCard"><span class="annot"><span class="annottext">_botCard :: Card
</span><a href="GHC.Types.Demand.html#_botCard"><span class="hs-identifier hs-var hs-var">_botCard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-532"></span><span id="topCard"><span class="annot"><span class="annottext">topCard :: Card
</span><a href="GHC.Types.Demand.html#topCard"><span class="hs-identifier hs-var hs-var">topCard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="annot"><span class="hs-comment">-- | True &lt;=&gt; lower bound is 1.</span></span><span>
</span><span id="line-535"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-type">isStrict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-536"></span><span class="hs-comment">-- See Note [Bit vector representation for Card]</span><span>
</span><span id="line-537"></span><span id="isStrict"><span class="annot"><span class="annottext">isStrict :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var hs-var">isStrict</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600877"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600877"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600877"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b001</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- simply check 0 bit is not set</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span class="annot"><span class="hs-comment">-- | True &lt;=&gt; upper bound is 0.</span></span><span>
</span><span id="line-540"></span><span class="annot"><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-type">isAbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-541"></span><span class="hs-comment">-- See Note [Bit vector representation for Card]</span><span>
</span><span id="line-542"></span><span id="isAbs"><span class="annot"><span class="annottext">isAbs :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var hs-var">isAbs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600879"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600879"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600879"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b110</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- simply check 1 and n bit are not set</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="annot"><span class="hs-comment">-- | True &lt;=&gt; upper bound is 1.</span></span><span>
</span><span id="line-545"></span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-type">isUsedOnce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-546"></span><span class="hs-comment">-- See Note [Bit vector representation for Card]</span><span>
</span><span id="line-547"></span><span id="isUsedOnce"><span class="annot"><span class="annottext">isUsedOnce :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var hs-var">isUsedOnce</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600880"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600880"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600880"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b100</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- simply check n bit is not set</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="annot"><span class="hs-comment">-- | Is this a 'CardNonAbs'?</span></span><span>
</span><span id="line-550"></span><span class="annot"><a href="GHC.Types.Demand.html#isCardNonAbs"><span class="hs-identifier hs-type">isCardNonAbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-551"></span><span id="isCardNonAbs"><span class="annot"><span class="annottext">isCardNonAbs :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isCardNonAbs"><span class="hs-identifier hs-var hs-var">isCardNonAbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Card -&gt; Bool) -&gt; Card -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="annot"><span class="hs-comment">-- | Is this a 'CardNonOnce'?</span></span><span>
</span><span id="line-554"></span><span class="annot"><a href="GHC.Types.Demand.html#isCardNonOnce"><span class="hs-identifier hs-type">isCardNonOnce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-555"></span><span id="isCardNonOnce"><span class="annot"><span class="annottext">isCardNonOnce :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isCardNonOnce"><span class="hs-identifier hs-var hs-var">isCardNonOnce</span></a></span></span><span> </span><span id="local-6989586621681600883"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600883"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600883"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600883"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="annot"><span class="hs-comment">-- | Intersect with [0,1].</span></span><span>
</span><span id="line-558"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-type">oneifyCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-559"></span><span id="oneifyCard"><span class="annot"><span class="annottext">oneifyCard :: Card -&gt; Card
</span><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-var hs-var">oneifyCard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#glbCard"><span class="hs-identifier hs-var">glbCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><span class="hs-comment">-- | Intersect with [1,n]. The same as @'plusCard' 'C_10'@.</span></span><span>
</span><span id="line-562"></span><span class="annot"><a href="GHC.Types.Demand.html#strictifyCard"><span class="hs-identifier hs-type">strictifyCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-563"></span><span id="strictifyCard"><span class="annot"><span class="annottext">strictifyCard :: Card -&gt; Card
</span><a href="GHC.Types.Demand.html#strictifyCard"><span class="hs-identifier hs-var hs-var">strictifyCard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#glbCard"><span class="hs-identifier hs-var">glbCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="annot"><span class="hs-comment">-- | Denotes '&#8746;' on 'Card'.</span></span><span>
</span><span id="line-566"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-type">lubCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-567"></span><span class="hs-comment">-- See Note [Bit vector representation for Card]</span><span>
</span><span id="line-568"></span><span id="lubCard"><span class="annot"><span class="annottext">lubCard :: Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var hs-var">lubCard</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600887"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600887"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600888"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600888"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Card
</span><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-var">Card</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600887"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600888"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- main point of the bit-vector encoding!</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="annot"><span class="hs-comment">-- | Denotes '&#8745;' on 'Card'.</span></span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.Types.Demand.html#glbCard"><span class="hs-identifier hs-type">glbCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-572"></span><span class="hs-comment">-- See Note [Bit vector representation for Card]</span><span>
</span><span id="line-573"></span><span id="glbCard"><span class="annot"><span class="annottext">glbCard :: Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#glbCard"><span class="hs-identifier hs-var hs-var">glbCard</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600890"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600890"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600891"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600891"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Card
</span><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-var">Card</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600890"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600891"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="annot"><span class="hs-comment">-- | Denotes '+' on lower and upper bounds of 'Card'.</span></span><span>
</span><span id="line-576"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-type">plusCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-577"></span><span class="hs-comment">-- See Note [Algebraic specification for plusCard and multCard]</span><span>
</span><span id="line-578"></span><span id="plusCard"><span class="annot"><span class="annottext">plusCard :: Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var hs-var">plusCard</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600893"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600893"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600894"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600894"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Card
</span><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-var">Card</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600895"><span class="hs-identifier hs-var">bit0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600896"><span class="hs-identifier hs-var">bit1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600897"><span class="hs-identifier hs-var">bitN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621681600895"><span class="annot"><span class="annottext">bit0 :: Int
</span><a href="#local-6989586621681600895"><span class="hs-identifier hs-var hs-var">bit0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600893"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600894"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>                         </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b001</span></span><span>
</span><span id="line-582"></span><span>    </span><span id="local-6989586621681600896"><span class="annot"><span class="annottext">bit1 :: Int
</span><a href="#local-6989586621681600896"><span class="hs-identifier hs-var hs-var">bit1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600893"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600894"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>                         </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b010</span></span><span>
</span><span id="line-583"></span><span>    </span><span id="local-6989586621681600897"><span class="annot"><span class="annottext">bitN :: Int
</span><a href="#local-6989586621681600897"><span class="hs-identifier hs-var hs-var">bitN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600893"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600894"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-identifier hs-var">shiftL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600893"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600894"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b100</span></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="annot"><span class="hs-comment">-- | Denotes '*' on lower and upper bounds of 'Card'.</span></span><span>
</span><span id="line-586"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-type">multCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-587"></span><span class="hs-comment">-- See Note [Algebraic specification for plusCard and multCard]</span><span>
</span><span id="line-588"></span><span id="multCard"><span class="annot"><span class="annottext">multCard :: Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var hs-var">multCard</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600900"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600900"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="local-6989586621681600901"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600901"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Card
</span><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-var">Card</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600902"><span class="hs-identifier hs-var">bit0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600903"><span class="hs-identifier hs-var">bit1</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600904"><span class="hs-identifier hs-var">bitN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-591"></span><span>    </span><span id="local-6989586621681600902"><span class="annot"><span class="annottext">bit0 :: Int
</span><a href="#local-6989586621681600902"><span class="hs-identifier hs-var hs-var">bit0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600900"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600901"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>                   </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b001</span></span><span>
</span><span id="line-592"></span><span>    </span><span id="local-6989586621681600903"><span class="annot"><span class="annottext">bit1 :: Int
</span><a href="#local-6989586621681600903"><span class="hs-identifier hs-var hs-var">bit1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600900"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600901"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>                   </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b010</span></span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621681600904"><span class="annot"><span class="annottext">bitN :: Int
</span><a href="#local-6989586621681600904"><span class="hs-identifier hs-var hs-var">bitN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600900"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%7C./GHC.Bits.html#.%7C."><span class="hs-operator hs-var">.|.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600901"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><a href="GHC.Prelude.Basic.html#shiftL"><span class="hs-identifier hs-var">shiftL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600903"><span class="hs-identifier hs-var">bit1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Bits.html#.%26./GHC.Bits.html#.%26."><span class="hs-operator hs-var">.&amp;.</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0b100</span></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
           Demand: Evaluation contexts
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="hs-comment">-- | A demand describes</span><span>
</span><span id="line-604"></span><span class="hs-comment">--</span><span>
</span><span id="line-605"></span><span class="hs-comment">--   * How many times a variable is evaluated, via a 'Card'inality, and</span><span>
</span><span id="line-606"></span><span class="hs-comment">--   * How deep its value was evaluated in turn, via a 'SubDemand'.</span><span>
</span><span id="line-607"></span><span class="hs-comment">--</span><span>
</span><span id="line-608"></span><span class="hs-comment">-- Examples (using Note [Demand notation]):</span><span>
</span><span id="line-609"></span><span class="hs-comment">--</span><span>
</span><span id="line-610"></span><span class="hs-comment">--   * 'seq' puts demand @1A@ on its first argument: It evaluates the argument</span><span>
</span><span id="line-611"></span><span class="hs-comment">--     strictly (@1@), but not any deeper (@A@).</span><span>
</span><span id="line-612"></span><span class="hs-comment">--   * 'fst' puts demand @1P(1L,A)@ on its argument: It evaluates the argument</span><span>
</span><span id="line-613"></span><span class="hs-comment">--     pair strictly and the first component strictly, but no nested info</span><span>
</span><span id="line-614"></span><span class="hs-comment">--     beyond that (@L@). Its second argument is not used at all.</span><span>
</span><span id="line-615"></span><span class="hs-comment">--   * '$' puts demand @1C(1,L)@ on its first argument: It calls (@C@) the</span><span>
</span><span id="line-616"></span><span class="hs-comment">--     argument function with one argument, exactly once (@1@). No info</span><span>
</span><span id="line-617"></span><span class="hs-comment">--     on how the result of that call is evaluated (@L@).</span><span>
</span><span id="line-618"></span><span class="hs-comment">--   * 'maybe' puts demand @MC(M,L)@ on its second argument: It evaluates</span><span>
</span><span id="line-619"></span><span class="hs-comment">--     the argument function at most once ((M)aybe) and calls it once when</span><span>
</span><span id="line-620"></span><span class="hs-comment">--     it is evaluated.</span><span>
</span><span id="line-621"></span><span class="hs-comment">--   * @fst p + fst p@ puts demand @SP(SL,A)@ on @p@: It's @1P(1L,A)@</span><span>
</span><span id="line-622"></span><span class="hs-comment">--     multiplied by two, so we get @S@ (used at least once, possibly multiple</span><span>
</span><span id="line-623"></span><span class="hs-comment">--     times).</span><span>
</span><span id="line-624"></span><span class="hs-comment">--</span><span>
</span><span id="line-625"></span><span class="hs-comment">-- This data type is quite similar to @'Scaled' 'SubDemand'@, but it's scaled</span><span>
</span><span id="line-626"></span><span class="hs-comment">-- by 'Card', which is an /interval/ on 'Multiplicity', the upper bound of</span><span>
</span><span id="line-627"></span><span class="hs-comment">-- which could be used to infer uniqueness types. Also we treat 'AbsDmd' and</span><span>
</span><span id="line-628"></span><span class="hs-comment">-- 'BotDmd' specially, as the concept of a 'SubDemand' doesn't apply when there</span><span>
</span><span id="line-629"></span><span class="hs-comment">-- isn't any evaluation at all. If you don't care, simply use '(:*)'.</span><span>
</span><span id="line-630"></span><span class="hs-keyword">data</span><span> </span><span id="Demand"><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-var">Demand</span></a></span></span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="BotDmd"><span class="annot"><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span></span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-comment">-- ^ A bottoming demand, produced by a diverging function ('C_10'), hence there is no</span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-comment">-- 'SubDemand' that describes how it was evaluated.</span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="AbsDmd"><span class="annot"><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-comment">-- ^ An absent demand: Evaluated exactly 0 times ('C_00'), hence there is no</span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-comment">-- 'SubDemand' that describes how it was evaluated.</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="D"><span class="annot"><a href="GHC.Types.Demand.html#D"><span class="hs-identifier hs-var">D</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#CardNonAbs"><span class="hs-identifier hs-type">CardNonAbs</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-comment">-- ^ Don't use this internal data constructor; use '(:*)' instead.</span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-comment">-- Since BotDmd deals with 'C_10' and AbsDmd deals with 'C_00', the</span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-comment">-- cardinality component is CardNonAbs</span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681600908"><span id="local-6989586621681600912"><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
(Demand -&gt; Demand -&gt; Bool)
-&gt; (Demand -&gt; Demand -&gt; Bool) -&gt; Eq Demand
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Demand -&gt; Demand -&gt; Bool
== :: Demand -&gt; Demand -&gt; Bool
$c/= :: Demand -&gt; Demand -&gt; Bool
/= :: Demand -&gt; Demand -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span class="annot"><span class="hs-comment">-- | Only meant to be used in the pattern synonym below!</span></span><span>
</span><span id="line-646"></span><span class="annot"><a href="GHC.Types.Demand.html#viewDmdPair"><span class="hs-identifier hs-type">viewDmdPair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span id="viewDmdPair"><span class="annot"><span class="annottext">viewDmdPair :: Demand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewDmdPair"><span class="hs-identifier hs-var hs-var">viewDmdPair</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span class="annot"><a href="GHC.Types.Demand.html#viewDmdPair"><span class="hs-identifier hs-var">viewDmdPair</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span class="annot"><a href="GHC.Types.Demand.html#viewDmdPair"><span class="hs-identifier hs-var">viewDmdPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span id="local-6989586621681600916"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600916"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681600917"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600917"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600916"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600917"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span class="hs-comment">-- | @c :* sd@ is a demand that says \&quot;evaluated @c@ times, and any trace in</span><span>
</span><span id="line-652"></span><span class="hs-comment">-- which it is evaluated will evaluate at least as deep as @sd@\&quot;.</span><span>
</span><span id="line-653"></span><span class="hs-comment">--</span><span>
</span><span id="line-654"></span><span class="hs-comment">-- Matching on this pattern synonym is a complete match.</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- If the matched demand was 'AbsDmd', it will match as @C_00 :* seqSubDmd@.</span><span>
</span><span id="line-656"></span><span class="hs-comment">-- If the matched demand was 'BotDmd', it will match as @C_10 :* botSubDmd@.</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- The builder of this pattern synonym simply /discards/ the 'SubDemand' if the</span><span>
</span><span id="line-658"></span><span class="hs-comment">-- 'Card' was absent and returns 'AbsDmd' or 'BotDmd' instead. It will assert</span><span>
</span><span id="line-659"></span><span class="hs-comment">-- that the discarded sub-demand was 'seqSubDmd' and 'botSubDmd', respectively.</span><span>
</span><span id="line-660"></span><span class="hs-comment">--</span><span>
</span><span id="line-661"></span><span class="hs-comment">-- Call sites should consider whether they really want to look at the</span><span>
</span><span id="line-662"></span><span class="hs-comment">-- 'SubDemand' of an absent demand and match on 'AbsDmd' and/or 'BotDmd'</span><span>
</span><span id="line-663"></span><span class="hs-comment">-- otherwise. Really, any other 'SubDemand' would be allowed and</span><span>
</span><span id="line-664"></span><span class="hs-comment">-- might work better, depending on context.</span><span>
</span><span id="line-665"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">(:*)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-666"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="#local-6989586621681600919"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span id="%3A%2A"><span id="%24m%3A%2A"><span id="%24b%3A%2A"><span class="annot"><span class="annottext">$m:* :: forall {r}.
HasDebugCallStack =&gt;
Demand -&gt; (Card -&gt; SubDemand -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$b:* :: HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var hs-var hs-var hs-var">:*</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621681600922"><span class="hs-identifier hs-type">sd</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#viewDmdPair"><span class="hs-identifier hs-type">viewDmdPair</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681600919"><span class="annot"><a href="#local-6989586621681600919"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681600922"><span class="annot"><a href="#local-6989586621681600922"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-667"></span><span>  </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span id="local-6989586621681600923"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600923"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; (Demand -&gt; Demand) -&gt; Demand
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Function.html#%26/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Demand -&gt; Demand
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600923"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;B /=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600923"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>  </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span id="local-6989586621681600929"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600929"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; (Demand -&gt; Demand) -&gt; Demand
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Function.html#%26/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Demand -&gt; Demand
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600929"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A /=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600929"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>  </span><span id="local-6989586621681600930"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600930"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span id="local-6989586621681600931"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600931"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600930"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600931"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; (Demand -&gt; Demand) -&gt; Demand
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Function.html#%26/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Demand -&gt; Demand
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isCardNonAbs"><span class="hs-identifier hs-var">isCardNonAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600930"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600930"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600931"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">:*</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="hs-comment">-- | A sub-demand describes an /evaluation context/ (in the sense of an</span><span>
</span><span id="line-673"></span><span class="hs-comment">-- operational semantics), e.g. how deep the denoted thing is going to be</span><span>
</span><span id="line-674"></span><span class="hs-comment">-- evaluated. See 'Demand' for examples.</span><span>
</span><span id="line-675"></span><span class="hs-comment">--</span><span>
</span><span id="line-676"></span><span class="hs-comment">-- See Note [SubDemand denotes at least one evaluation] for a more detailed</span><span>
</span><span id="line-677"></span><span class="hs-comment">-- description of what a sub-demand means.</span><span>
</span><span id="line-678"></span><span class="hs-comment">--</span><span>
</span><span id="line-679"></span><span class="hs-comment">-- See Note [Demand notation] for the extensively used short-hand notation.</span><span>
</span><span id="line-680"></span><span class="hs-comment">-- See also Note [Why Boxity in SubDemand and not in Demand?].</span><span>
</span><span id="line-681"></span><span class="hs-keyword">data</span><span> </span><span id="SubDemand"><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-var">SubDemand</span></a></span></span><span>
</span><span id="line-682"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Poly"><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#CardNonOnce"><span class="hs-identifier hs-type">CardNonOnce</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-comment">-- ^ Polymorphic demand, the denoted thing is evaluated arbitrarily deep,</span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-comment">-- with the specified cardinality at every level. The 'Boxity' applies only</span><span>
</span><span id="line-685"></span><span>  </span><span class="hs-comment">-- to the outer evaluation context as well as all inner evaluation context.</span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-comment">-- See Note [Boxity in Poly] for why we want it to carry 'Boxity'.</span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-comment">-- Expands to 'Call' via 'viewCall' and to 'Prod' via 'viewProd'.</span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-comment">-- @Poly b n@ is semantically equivalent to @Prod b [n :* Poly b n, ...]</span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-comment">-- or @Call n (Poly Boxed n)@. 'viewCall' and 'viewProd' do these rewrites.</span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-comment">-- In Note [Demand notation]: @L  === P(L,L,...)@  and @L  === C(L)@,</span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-comment">--                            @B  === P(B,B,...)@  and @B  === C(B)@,</span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-comment">--                            @!A === !P(A,A,...)@ and @!A === C(A)@,</span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-comment">--                            and so on.</span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-comment">-- We'll only see 'Poly' with 'C_10' (B), 'C_00' (A), 'C_0N' (L) and sometimes</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-comment">-- 'C_1N' (S) through 'plusSubDmd', never 'C_01' (M) or 'C_11' (1) (grep the</span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-comment">-- source code). Hence 'CardNonOnce', which is closed under 'lub' and 'plus'.</span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-comment">-- Why doesn't this constructor simply carry a 'Demand' instead of its fields?</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-comment">-- See Note [Call SubDemand vs. evaluation Demand].</span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Call"><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-var">Call</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#CardNonAbs"><span class="hs-identifier hs-type">CardNonAbs</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-comment">-- ^ @Call n sd@ describes the evaluation context of @n@ function</span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-comment">-- applications (with one argument), where the result of each call is</span><span>
</span><span id="line-706"></span><span>  </span><span class="hs-comment">-- evaluated according to @sd@.</span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-comment">-- @sd@ describes program traces in which the denoted thing was called at all,</span><span>
</span><span id="line-708"></span><span>  </span><span class="hs-comment">-- see Note [SubDemand denotes at least one evaluation].</span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-comment">-- That Note also explains why it doesn't make sense for @n@ to be absent,</span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-comment">-- hence we forbid it with 'CardNonAbs'. Absent call demands can still be</span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-comment">-- expressed with 'Poly'.</span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-comment">-- Used only for values of function type. Use the smart constructor 'mkCall'</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-comment">-- whenever possible!</span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Prod"><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-comment">-- ^ @Prod b ds@ describes the evaluation context of a case scrutinisation</span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-comment">-- on an expression of product type, where the product components are</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-comment">-- evaluated according to @ds@. The 'Boxity' @b@ says whether or not the box</span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-comment">-- of the product was used.</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="annot"><span class="hs-comment">-- | We have to respect Poly rewrites through 'viewCall' and 'viewProd'.</span></span><span>
</span><span id="line-721"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681600937"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-722"></span><span>  </span><span id="local-6989586621681600947"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600947"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span id="local-6989586621681600948"><span class="annot"><span class="annottext">== :: SubDemand -&gt; SubDemand -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621681600949"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600949"><span class="hs-identifier hs-var">d2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600947"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681600950"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600950"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681600951"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600951"><span class="hs-identifier hs-var">ds1</span></a></span></span><span>
</span><span id="line-724"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681600952"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600952"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681600953"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600953"><span class="hs-identifier hs-var">ds2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe (Boxity, [Demand])
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600951"><span class="hs-identifier hs-var">ds1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600949"><span class="hs-identifier hs-var">d2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600950"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600952"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600951"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [Demand] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600953"><span class="hs-identifier hs-var">ds2</span></a></span><span>
</span><span id="line-725"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681600956"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600956"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621681600957"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600957"><span class="hs-identifier hs-var">sd1</span></a></span></span><span>
</span><span id="line-726"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681600958"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600958"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681600959"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600959"><span class="hs-identifier hs-var">sd2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600949"><span class="hs-identifier hs-var">d2</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600956"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600958"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600957"><span class="hs-identifier hs-var">sd1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600959"><span class="hs-identifier hs-var">sd2</span></a></span><span>
</span><span id="line-727"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681600960"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600960"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681600961"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600961"><span class="hs-identifier hs-var">n1</span></a></span></span><span>
</span><span id="line-728"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681600962"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600962"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681600963"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600963"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600949"><span class="hs-identifier hs-var">d2</span></a></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600960"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600962"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600961"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600963"><span class="hs-identifier hs-var">n2</span></a></span><span>
</span><span id="line-729"></span><span>    </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="annot"><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-type">topSubDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-type">botSubDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-type">seqSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-732"></span><span id="topSubDmd"><span class="annot"><span class="annottext">topSubDmd :: SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var hs-var">topSubDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span>   </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-733"></span><span id="botSubDmd"><span class="annot"><span class="annottext">botSubDmd :: SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var hs-var">botSubDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-734"></span><span id="seqSubDmd"><span class="annot"><span class="annottext">seqSubDmd :: SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var hs-var">seqSubDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="hs-comment">-- | The uniform field demand when viewing a 'Poly' as a 'Prod', as in</span><span>
</span><span id="line-737"></span><span class="hs-comment">-- 'viewProd'.</span><span>
</span><span id="line-738"></span><span class="annot"><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-type">polyFieldDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#CardNonOnce"><span class="hs-identifier hs-type">CardNonOnce</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-739"></span><span id="polyFieldDmd"><span class="annot"><span class="annottext">polyFieldDmd :: Boxity -&gt; Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-var hs-var">polyFieldDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span>     </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-740"></span><span class="annot"><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-var">polyFieldDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span>     </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-741"></span><span class="annot"><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-var">polyFieldDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span>
</span><span id="line-742"></span><span class="annot"><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-var">polyFieldDmd</span></a></span><span> </span><span id="local-6989586621681600965"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600965"><span class="hs-identifier hs-var">b</span></a></span></span><span>     </span><span id="local-6989586621681600966"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600966"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600966"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600965"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600966"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; (Demand -&gt; Demand) -&gt; Demand
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Function.html#%26/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; Demand -&gt; Demand
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isCardNonOnce"><span class="hs-identifier hs-var">isCardNonOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600966"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600966"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="hs-comment">-- | A smart constructor for 'Prod', applying rewrite rules along the semantic</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- equality @Prod b [n :* Poly Boxed n, ...] === Poly b n@, simplifying to</span><span>
</span><span id="line-746"></span><span class="hs-comment">-- 'Poly' 'SubDemand's when possible. Examples:</span><span>
</span><span id="line-747"></span><span class="hs-comment">--</span><span>
</span><span id="line-748"></span><span class="hs-comment">--   * Rewrites @P(L,L)@ (e.g., arguments @Boxed@, @[L,L]@) to @L@</span><span>
</span><span id="line-749"></span><span class="hs-comment">--   * Rewrites @!P(L!L,L!L)@ (e.g., arguments @Unboxed@, @[L!L,L!L]@) to @!L@</span><span>
</span><span id="line-750"></span><span class="hs-comment">--   * Does not rewrite @P(1L)@, @P(L!L)@, @!P(L)@ or @P(L,A)@</span><span>
</span><span id="line-751"></span><span class="hs-comment">--</span><span>
</span><span id="line-752"></span><span class="annot"><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-type">mkProd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-753"></span><span id="mkProd"><span class="annot"><span class="annottext">mkProd :: Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var hs-var">mkProd</span></a></span></span><span> </span><span id="local-6989586621681600967"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600967"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681600968"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600968"><span class="hs-identifier hs-var">ds</span></a></span></span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Bool) -&gt; [Demand] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600968"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600967"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-755"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Bool) -&gt; [Demand] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600968"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600967"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681600970"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621681600970"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681600971"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600971"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681600972"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600972"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681600973"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600973"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600968"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600971"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600973"><span class="hs-identifier hs-var">m</span></a></span><span>           </span><span class="hs-comment">-- don't rewrite P(SL)  to S</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600967"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600972"><span class="hs-identifier hs-var">b2</span></a></span><span>          </span><span class="hs-comment">-- don't rewrite P(S!S) to !S</span><span>
</span><span id="line-759"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Bool) -&gt; [Demand] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681600970"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600968"><span class="hs-identifier hs-var">ds</span></a></span><span>  </span><span class="hs-comment">-- don't rewrite P(L,A) to L</span><span>
</span><span id="line-760"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600967"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600971"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-761"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600967"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600968"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span class="hs-comment">-- | @viewProd n sd@ interprets @sd@ as a 'Prod' of arity @n@, expanding 'Poly'</span><span>
</span><span id="line-764"></span><span class="hs-comment">-- demands as necessary.</span><span>
</span><span id="line-765"></span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-type">viewProd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span class="hs-comment">-- It's quite important that this function is optimised well;</span><span>
</span><span id="line-767"></span><span class="hs-comment">-- it is used by lubSubDmd and plusSubDmd.</span><span>
</span><span id="line-768"></span><span id="viewProd"><span class="annot"><span class="annottext">viewProd :: Int -&gt; SubDemand -&gt; Maybe (Boxity, [Demand])
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var hs-var">viewProd</span></a></span></span><span> </span><span id="local-6989586621681600975"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600975"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681600976"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600976"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681600977"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600977"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600977"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-var">`lengthIs`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600975"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Boxity, [Demand]) -&gt; Maybe (Boxity, [Demand])
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600976"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600977"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span class="hs-comment">-- Note the strict application to replicate: This makes sure we don't allocate</span><span>
</span><span id="line-771"></span><span class="hs-comment">-- a thunk for it, inlines it and lets case-of-case fire at call sites.</span><span>
</span><span id="line-772"></span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span id="local-6989586621681600979"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600979"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681600980"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600980"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681600981"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600981"><span class="hs-identifier hs-var">card</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681600982"><span class="annot"><span class="annottext">ds :: [Demand]
</span><a href="#local-6989586621681600982"><span class="hs-identifier hs-var hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Demand -&gt; [Demand]
forall a. Int -&gt; a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#replicate/GHC.List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681600979"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; [Demand]) -&gt; Demand -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-var">polyFieldDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600980"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600981"><span class="hs-identifier hs-var">card</span></a></span><span>
</span><span id="line-774"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Boxity, [Demand]) -&gt; Maybe (Boxity, [Demand])
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681600980"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600982"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Boxity, [Demand])
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-777"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-pragma hs-type">viewProd</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- we want to fuse away the replicate and the allocation</span><span>
</span><span id="line-778"></span><span>                        </span><span class="hs-comment">-- for Arity. Otherwise, #18304 bites us.</span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span class="hs-comment">-- | A smart constructor for 'Call', applying rewrite rules along the semantic</span><span>
</span><span id="line-781"></span><span class="hs-comment">-- equality @Call C_0N (Poly C_0N) === Poly C_0N@, simplifying to 'Poly' 'SubDemand's</span><span>
</span><span id="line-782"></span><span class="hs-comment">-- when possible.</span><span>
</span><span id="line-783"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-type">mkCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#CardNonAbs"><span class="hs-identifier hs-type">CardNonAbs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-784"></span><span class="hs-comment">--mkCall C_1N sd@(Poly Boxed C_1N) = sd -- NO! #21085 strikes. See Note [mkCall and plusSubDmd]</span><span>
</span><span id="line-785"></span><span id="mkCall"><span class="annot"><span class="annottext">mkCall :: Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var hs-var">mkCall</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span id="local-6989586621681600985"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621681600985"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600985"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-786"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span id="local-6989586621681600986"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600986"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span id="local-6989586621681600987"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600987"><span class="hs-identifier hs-var">sd</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SubDemand -&gt; SubDemand
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isCardNonAbs"><span class="hs-identifier hs-var">isCardNonAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600986"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600986"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600987"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SubDemand -&gt; SubDemand) -&gt; SubDemand -&gt; SubDemand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-787"></span><span>                                   </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600986"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600987"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span class="hs-comment">-- | @viewCall sd@ interprets @sd@ as a 'Call', expanding 'Poly' subdemands as</span><span>
</span><span id="line-790"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-791"></span><span class="annot"><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-type">viewCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span id="viewCall"><span class="annot"><span class="annottext">viewCall :: SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var hs-var">viewCall</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681600988"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600988"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681600989"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600989"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Card, SubDemand) -&gt; Maybe (Card, SubDemand)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600988"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600989"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span class="annot"><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681600990"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600990"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600990"><span class="hs-identifier hs-var">n</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Card, SubDemand) -&gt; Maybe (Card, SubDemand)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600990"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Card, SubDemand) -&gt; Maybe (Card, SubDemand)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600990"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600990"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span class="annot"><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Card, SubDemand)
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span class="annot"><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-type">topDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-type">absDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-type">botDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDmd"><span class="hs-identifier hs-type">seqDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-799"></span><span id="topDmd"><span class="annot"><span class="annottext">topDmd :: Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var hs-var">topDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-800"></span><span id="absDmd"><span class="annot"><span class="annottext">absDmd :: Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var hs-var">absDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-801"></span><span id="botDmd"><span class="annot"><span class="annottext">botDmd :: Demand
</span><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-var hs-var">botDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-802"></span><span id="seqDmd"><span class="annot"><span class="annottext">seqDmd :: Demand
</span><a href="GHC.Types.Demand.html#seqDmd"><span class="hs-identifier hs-var hs-var">seqDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span class="annot"><span class="hs-comment">-- | Sets 'Boxity' to 'Unboxed' for non-'Call' sub-demands and recurses into 'Prod'.</span></span><span>
</span><span id="line-805"></span><span class="annot"><a href="GHC.Types.Demand.html#unboxDeeplySubDmd"><span class="hs-identifier hs-type">unboxDeeplySubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-806"></span><span id="unboxDeeplySubDmd"><span class="annot"><span class="annottext">unboxDeeplySubDmd :: SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#unboxDeeplySubDmd"><span class="hs-identifier hs-var hs-var">unboxDeeplySubDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681600992"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600992"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600992"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-807"></span><span class="annot"><a href="GHC.Types.Demand.html#unboxDeeplySubDmd"><span class="hs-identifier hs-var">unboxDeeplySubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681600993"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600993"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#unboxDeeplyDmd"><span class="hs-identifier hs-var">unboxDeeplyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681600993"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-808"></span><span class="annot"><a href="GHC.Types.Demand.html#unboxDeeplySubDmd"><span class="hs-identifier hs-var">unboxDeeplySubDmd</span></a></span><span> </span><span id="local-6989586621681600995"><span class="annot"><span class="annottext">call :: SubDemand
</span><a href="#local-6989586621681600995"><span class="hs-identifier hs-var">call</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600995"><span class="hs-identifier hs-var">call</span></a></span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span class="hs-comment">-- | Sets 'Boxity' to 'Unboxed' for the 'Demand', recursing into 'Prod's.</span><span>
</span><span id="line-811"></span><span class="hs-comment">-- Don't recurse into lazy arguments; see GHC.Core.Opt.DmdAnal</span><span>
</span><span id="line-812"></span><span class="hs-comment">--    Note [No lazy, Unboxed demands in demand signature]</span><span>
</span><span id="line-813"></span><span class="annot"><a href="GHC.Types.Demand.html#unboxDeeplyDmd"><span class="hs-identifier hs-type">unboxDeeplyDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-814"></span><span id="unboxDeeplyDmd"><span class="annot"><span class="annottext">unboxDeeplyDmd :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#unboxDeeplyDmd"><span class="hs-identifier hs-var hs-var">unboxDeeplyDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-815"></span><span class="annot"><a href="GHC.Types.Demand.html#unboxDeeplyDmd"><span class="hs-identifier hs-var">unboxDeeplyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-816"></span><span class="annot"><a href="GHC.Types.Demand.html#unboxDeeplyDmd"><span class="hs-identifier hs-var">unboxDeeplyDmd</span></a></span><span> </span><span id="local-6989586621681600996"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621681600996"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span id="local-6989586621681600997"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600997"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681600998"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600998"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600997"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681600997"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#unboxDeeplySubDmd"><span class="hs-identifier hs-var">unboxDeeplySubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681600998"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681600996"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-type">multDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-821"></span><span id="multDmd"><span class="annot"><span class="annottext">multDmd :: Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var hs-var">multDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span id="local-6989586621681600999"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681600999"><span class="hs-identifier hs-var">dmd</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681600999"><span class="hs-identifier hs-var">dmd</span></a></span><span> </span><span class="hs-comment">-- An optimisation</span><span>
</span><span id="line-822"></span><span class="hs-comment">-- The following four lines make sure that we rewrite to AbsDmd and BotDmd</span><span>
</span><span id="line-823"></span><span class="hs-comment">-- whenever the leading cardinality is absent (C_00 or C_10).</span><span>
</span><span id="line-824"></span><span class="hs-comment">-- Otherwise it may happen that the SubDemand is not 'botSubDmd', triggering</span><span>
</span><span id="line-825"></span><span class="hs-comment">-- the assertion in `:*`.</span><span>
</span><span id="line-826"></span><span class="hs-comment">-- Example: `multDmd B 1L = BA`, so with an inner `seqSubDmd`. Our lattice</span><span>
</span><span id="line-827"></span><span class="hs-comment">-- allows us to always rewrite this to proper BotDmd and we maintain the</span><span>
</span><span id="line-828"></span><span class="hs-comment">-- invariant that this is indeed the case.</span><span>
</span><span id="line-829"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-830"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-831"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span id="local-6989586621681601000"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601000"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601000"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-832"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span id="local-6989586621681601001"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601001"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601001"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-833"></span><span class="hs-comment">-- See Note [SubDemand denotes at least one evaluation] for the strictifyCard</span><span>
</span><span id="line-834"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span id="local-6989586621681601002"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601002"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#D"><span class="hs-identifier hs-type">D</span></a></span><span> </span><span id="local-6989586621681601003"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601003"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681601004"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601004"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601002"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601003"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card
</span><a href="GHC.Types.Demand.html#strictifyCard"><span class="hs-identifier hs-var">strictifyCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601002"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601004"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-type">multSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-837"></span><span id="multSubDmd"><span class="annot"><span class="annottext">multSubDmd :: Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var hs-var">multSubDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span id="local-6989586621681601005"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601005"><span class="hs-identifier hs-var">sd</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601005"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="hs-comment">-- An optimisation, for when sd is a deep Prod</span><span>
</span><span id="line-838"></span><span class="hs-comment">-- The following three equations don't have an impact on Demands, only on</span><span>
</span><span id="line-839"></span><span class="hs-comment">-- Boxity. They are needed so that we don't trigger the assertions in `:*`</span><span>
</span><span id="line-840"></span><span class="hs-comment">-- when called from `multDmd`.</span><span>
</span><span id="line-841"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span> </span><span class="hs-comment">-- Otherwise `multSubDmd A L == A /= !A`</span><span>
</span><span id="line-842"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601006"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601006"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601006"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span> </span><span class="hs-comment">-- Otherwise `multSubDmd B L == B /= !B`</span><span>
</span><span id="line-843"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601007"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601007"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601007"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span> </span><span class="hs-comment">-- Otherwise we'd call `mkCall` with absent cardinality</span><span>
</span><span id="line-844"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span id="local-6989586621681601008"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601008"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601009"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601009"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601010"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601010"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601009"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601008"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601010"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span id="local-6989586621681601011"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601011"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601012"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601012"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621681601013"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601013"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601011"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601012"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601013"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-846"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span id="local-6989586621681601014"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601014"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601015"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601015"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601016"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601016"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601015"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601014"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601016"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="annot"><a href="GHC.Types.Demand.html#lazifyIfStrict"><span class="hs-identifier hs-type">lazifyIfStrict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-849"></span><span id="lazifyIfStrict"><span class="annot"><span class="annottext">lazifyIfStrict :: Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lazifyIfStrict"><span class="hs-identifier hs-var hs-var">lazifyIfStrict</span></a></span></span><span> </span><span id="local-6989586621681601018"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601018"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601019"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601019"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#glbCard"><span class="hs-identifier hs-var">glbCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601018"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601019"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-850"></span><span>
</span><span id="line-851"></span><span class="annot"><span class="hs-comment">-- | Denotes '&#8746;' on 'Demand'.</span></span><span>
</span><span id="line-852"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-type">lubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-853"></span><span id="lubDmd"><span class="annot"><span class="annottext">lubDmd :: Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var hs-var">lubDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>      </span><span id="local-6989586621681601020"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601020"><span class="hs-identifier hs-var">dmd2</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601020"><span class="hs-identifier hs-var">dmd2</span></a></span><span>
</span><span id="line-854"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span id="local-6989586621681601021"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601021"><span class="hs-identifier hs-var">dmd1</span></a></span></span><span>        </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601021"><span class="hs-identifier hs-var">dmd1</span></a></span><span>
</span><span id="line-855"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601022"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601022"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601023"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601023"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601024"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601024"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601025"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601025"><span class="hs-identifier hs-var">sd2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTraceWith &quot;lubDmd&quot; (\it -&gt; ppr (n1:*sd1) $$ ppr (n2:*sd2) $$ ppr it) $</span><span>
</span><span id="line-856"></span><span>  </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601022"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601024"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601023"><span class="hs-identifier hs-var">sd1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601025"><span class="hs-identifier hs-var">sd2</span></a></span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-type">lubSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-859"></span><span class="hs-comment">-- Shortcuts for neutral and absorbing elements.</span><span>
</span><span id="line-860"></span><span class="hs-comment">-- Below we assume that Boxed always wins.</span><span>
</span><span id="line-861"></span><span id="lubSubDmd"><span class="annot"><span class="annottext">lubSubDmd :: SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var hs-var">lubSubDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621681601026"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601026"><span class="hs-identifier hs-var">sd</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601026"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-862"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span id="local-6989586621681601027"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601027"><span class="hs-identifier hs-var">sd</span></a></span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601027"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-863"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span id="local-6989586621681601028"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621681601028"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601028"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                    </span><span id="local-6989586621681601029"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621681601029"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601029"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-865"></span><span class="hs-comment">-- Handle Prod</span><span>
</span><span id="line-866"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601030"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601030"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681601031"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601031"><span class="hs-identifier hs-var">ds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601032"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601032"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681601033"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601033"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681601034"><span class="annot"><span class="annottext">d :: Demand
</span><a href="#local-6989586621681601034"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-var">polyFieldDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601032"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601033"><span class="hs-identifier hs-var">n2</span></a></span><span>
</span><span id="line-868"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-var">lubBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601030"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601032"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601034"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601031"><span class="hs-identifier hs-var">ds1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601035"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601035"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681601036"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601036"><span class="hs-identifier hs-var">ds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601037"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601037"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681601038"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601038"><span class="hs-identifier hs-var">ds2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [Demand] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601036"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601038"><span class="hs-identifier hs-var">ds2</span></a></span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-var">lubBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601035"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601037"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#strictZipWith"><span class="hs-identifier hs-var">strictZipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601036"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601038"><span class="hs-identifier hs-var">ds2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span class="hs-comment">-- Handle Call</span><span>
</span><span id="line-873"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601041"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601041"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621681601042"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601042"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601043"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601043"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601044"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601044"><span class="hs-identifier hs-var">sd2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-874"></span><span>  </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601041"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601043"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601042"><span class="hs-identifier hs-var">sd1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601044"><span class="hs-identifier hs-var">sd2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span class="hs-comment">-- Handle Poly</span><span>
</span><span id="line-876"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601045"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601045"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681601046"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601046"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601047"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601047"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681601048"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601048"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-var">lubBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601045"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601047"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601046"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601048"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-877"></span><span class="hs-comment">-- Other Poly case by commutativity</span><span>
</span><span id="line-878"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span id="local-6989586621681601049"><span class="annot"><span class="annottext">sd1 :: SubDemand
</span><a href="#local-6989586621681601049"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span id="local-6989586621681601050"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601050"><span class="hs-identifier hs-var">sd2</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601050"><span class="hs-identifier hs-var">sd2</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601049"><span class="hs-identifier hs-var">sd1</span></a></span><span>
</span><span id="line-879"></span><span class="hs-comment">-- Otherwise (Call `lub` Prod) return Top</span><span>
</span><span id="line-880"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>            </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-881"></span><span>
</span><span id="line-882"></span><span class="annot"><span class="hs-comment">-- | Denotes '+' on 'Demand'.</span></span><span>
</span><span id="line-883"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-type">plusDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-884"></span><span id="plusDmd"><span class="annot"><span class="annottext">plusDmd :: Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var hs-var">plusDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>      </span><span id="local-6989586621681601051"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601051"><span class="hs-identifier hs-var">dmd2</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601051"><span class="hs-identifier hs-var">dmd2</span></a></span><span>
</span><span id="line-885"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span id="local-6989586621681601052"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601052"><span class="hs-identifier hs-var">dmd1</span></a></span></span><span>        </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601052"><span class="hs-identifier hs-var">dmd1</span></a></span><span>
</span><span id="line-886"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601053"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601053"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601054"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601054"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601055"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601055"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601056"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601056"><span class="hs-identifier hs-var">sd2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTraceWith &quot;plusDmd&quot; (\it -&gt; ppr (n1:*sd1) $$ ppr (n2:*sd2) $$ ppr it) $</span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-comment">-- Why lazify? See Note [SubDemand denotes at least one evaluation]</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-comment">-- and also Note [Unrealised opportunity in plusDmd] which applies when both</span><span>
</span><span id="line-889"></span><span>  </span><span class="hs-comment">-- n1 and n2 are lazy already</span><span>
</span><span id="line-890"></span><span>  </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601053"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601055"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lazifyIfStrict"><span class="hs-identifier hs-var">lazifyIfStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601053"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601054"><span class="hs-identifier hs-var">sd1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lazifyIfStrict"><span class="hs-identifier hs-var">lazifyIfStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601055"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601056"><span class="hs-identifier hs-var">sd2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-type">plusSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-893"></span><span class="hs-comment">-- Shortcuts for neutral and absorbing elements.</span><span>
</span><span id="line-894"></span><span class="hs-comment">-- Below we assume that Boxed always wins.</span><span>
</span><span id="line-895"></span><span id="plusSubDmd"><span class="annot"><span class="annottext">plusSubDmd :: SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var hs-var">plusSubDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621681601057"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601057"><span class="hs-identifier hs-var">sd</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601057"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-896"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span id="local-6989586621681601058"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601058"><span class="hs-identifier hs-var">sd</span></a></span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601058"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-897"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span id="local-6989586621681601059"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621681601059"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601059"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-898"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                    </span><span id="local-6989586621681601060"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621681601060"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601060"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-899"></span><span class="hs-comment">-- Handle Prod</span><span>
</span><span id="line-900"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601061"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601061"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681601062"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601062"><span class="hs-identifier hs-var">ds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601063"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601063"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681601064"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601064"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681601065"><span class="annot"><span class="annottext">d :: Demand
</span><a href="#local-6989586621681601065"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyFieldDmd"><span class="hs-identifier hs-var">polyFieldDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601063"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601064"><span class="hs-identifier hs-var">n2</span></a></span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-var">lubBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601061"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601063"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="GHC.Utils.Misc.html#strictMap"><span class="hs-identifier hs-var">strictMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601065"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601062"><span class="hs-identifier hs-var">ds1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601066"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601066"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681601067"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601067"><span class="hs-identifier hs-var">ds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601068"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601068"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681601069"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601069"><span class="hs-identifier hs-var">ds2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [Demand] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601067"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601069"><span class="hs-identifier hs-var">ds2</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-var">lubBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601066"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601068"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#strictZipWith"><span class="hs-identifier hs-var">strictZipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601067"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601069"><span class="hs-identifier hs-var">ds2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span class="hs-comment">-- Handle Call</span><span>
</span><span id="line-907"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601070"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601070"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621681601071"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601071"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601072"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601072"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601073"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601073"><span class="hs-identifier hs-var">sd2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-908"></span><span>  </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601070"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601072"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601071"><span class="hs-identifier hs-var">sd1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601073"><span class="hs-identifier hs-var">sd2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span class="hs-comment">-- Handle Poly</span><span>
</span><span id="line-910"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601074"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601074"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681601075"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601075"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601076"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601076"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621681601077"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601077"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Boxity -&gt; Boxity
</span><a href="GHC.Types.Demand.html#lubBoxity"><span class="hs-identifier hs-var">lubBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601074"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601076"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601075"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601077"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span class="hs-comment">-- Other Poly case by commutativity</span><span>
</span><span id="line-912"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span id="local-6989586621681601078"><span class="annot"><span class="annottext">sd1 :: SubDemand
</span><a href="#local-6989586621681601078"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span id="local-6989586621681601079"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601079"><span class="hs-identifier hs-var">sd2</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601079"><span class="hs-identifier hs-var">sd2</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601078"><span class="hs-identifier hs-var">sd1</span></a></span><span>
</span><span id="line-913"></span><span class="hs-comment">-- Otherwise (Call `plus` Prod) return Top</span><span>
</span><span id="line-914"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>            </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span class="annot"><span class="hs-comment">-- | Used to suppress pretty-printing of an uninformative demand</span></span><span>
</span><span id="line-917"></span><span class="annot"><a href="GHC.Types.Demand.html#isTopDmd"><span class="hs-identifier hs-type">isTopDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-918"></span><span id="isTopDmd"><span class="annot"><span class="annottext">isTopDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isTopDmd"><span class="hs-identifier hs-var hs-var">isTopDmd</span></a></span></span><span> </span><span id="local-6989586621681601080"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601080"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601080"><span class="hs-identifier hs-var">dmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span class="annot"><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-type">isAbsDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-921"></span><span id="isAbsDmd"><span class="annot"><span class="annottext">isAbsDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-var hs-var">isAbsDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601081"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601081"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601081"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-922"></span><span>
</span><span id="line-923"></span><span class="annot"><span class="hs-comment">-- | Contrast with isStrictUsedDmd. See Note [Strict demands]</span></span><span>
</span><span id="line-924"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrictDmd"><span class="hs-identifier hs-type">isStrictDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-925"></span><span id="isStrictDmd"><span class="annot"><span class="annottext">isStrictDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrictDmd"><span class="hs-identifier hs-var hs-var">isStrictDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601082"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601082"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601082"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span class="annot"><span class="hs-comment">-- | Not absent and used strictly. See Note [Strict demands]</span></span><span>
</span><span id="line-928"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier hs-type">isStrUsedDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-929"></span><span id="isStrUsedDmd"><span class="annot"><span class="annottext">isStrUsedDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier hs-var hs-var">isStrUsedDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601083"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601083"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601083"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601083"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span>
</span><span id="line-931"></span><span class="annot"><span class="hs-comment">-- | Is the value used at most once?</span></span><span>
</span><span id="line-932"></span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier hs-type">isUsedOnceDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-933"></span><span id="isUsedOnceDmd"><span class="annot"><span class="annottext">isUsedOnceDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier hs-var hs-var">isUsedOnceDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601084"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601084"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601084"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span class="hs-comment">-- | We try to avoid tracking weak free variable demands in strictness</span><span>
</span><span id="line-936"></span><span class="hs-comment">-- signatures for analysis performance reasons.</span><span>
</span><span id="line-937"></span><span class="hs-comment">-- See Note [Lazy and unleashable free variables] in &quot;GHC.Core.Opt.DmdAnal&quot;.</span><span>
</span><span id="line-938"></span><span class="annot"><a href="GHC.Types.Demand.html#isWeakDmd"><span class="hs-identifier hs-type">isWeakDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-939"></span><span id="isWeakDmd"><span class="annot"><span class="annottext">isWeakDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isWeakDmd"><span class="hs-identifier hs-var hs-var">isWeakDmd</span></a></span></span><span> </span><span id="local-6989586621681601085"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621681601085"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681601086"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601086"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601086"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="#local-6989586621681601087"><span class="hs-identifier hs-var">is_plus_idem_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601085"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-940"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-comment">-- @is_plus_idem_* thing@ checks whether @thing `plus` thing = thing@,</span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-comment">-- e.g. if @thing@ is idempotent wrt. to @plus@.</span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-comment">-- is_plus_idem_card n = plusCard n n == n</span><span>
</span><span id="line-944"></span><span>    </span><span id="local-6989586621681601088"><span class="annot"><span class="annottext">is_plus_idem_card :: Card -&gt; Bool
</span><a href="#local-6989586621681601088"><span class="hs-identifier hs-var hs-var">is_plus_idem_card</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isCardNonOnce"><span class="hs-identifier hs-var">isCardNonOnce</span></a></span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-comment">-- is_plus_idem_dmd dmd = plusDmd dmd dmd == dmd</span><span>
</span><span id="line-946"></span><span>    </span><span id="local-6989586621681601087"><span class="annot"><span class="annottext">is_plus_idem_dmd :: Demand -&gt; Bool
</span><a href="#local-6989586621681601087"><span class="hs-identifier hs-var hs-var">is_plus_idem_dmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-947"></span><span>    </span><span class="annot"><a href="#local-6989586621681601087"><span class="hs-identifier hs-var">is_plus_idem_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-948"></span><span>    </span><span class="annot"><a href="#local-6989586621681601087"><span class="hs-identifier hs-var">is_plus_idem_dmd</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601093"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601093"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601094"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601094"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="#local-6989586621681601088"><span class="hs-identifier hs-var">is_plus_idem_card</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601093"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; Bool
</span><a href="#local-6989586621681601095"><span class="hs-identifier hs-var">is_plus_idem_sub_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601094"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-comment">-- is_plus_idem_sub_dmd sd = plusSubDmd sd sd == sd</span><span>
</span><span id="line-950"></span><span>    </span><span id="local-6989586621681601095"><span class="annot"><span class="annottext">is_plus_idem_sub_dmd :: SubDemand -&gt; Bool
</span><a href="#local-6989586621681601095"><span class="hs-identifier hs-var hs-var">is_plus_idem_sub_dmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601096"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601096"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isCardNonOnce"><span class="hs-identifier hs-var">isCardNonOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601096"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-951"></span><span>    </span><span class="annot"><a href="#local-6989586621681601095"><span class="hs-identifier hs-var">is_plus_idem_sub_dmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601098"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601098"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Bool) -&gt; [Demand] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="#local-6989586621681601087"><span class="hs-identifier hs-var">is_plus_idem_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601098"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-952"></span><span>    </span><span class="annot"><a href="#local-6989586621681601095"><span class="hs-identifier hs-var">is_plus_idem_sub_dmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601099"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601099"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="#local-6989586621681601088"><span class="hs-identifier hs-var">is_plus_idem_card</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601099"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span class="annot"><a href="GHC.Types.Demand.html#evalDmd"><span class="hs-identifier hs-type">evalDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-955"></span><span id="evalDmd"><span class="annot"><span class="annottext">evalDmd :: Demand
</span><a href="GHC.Types.Demand.html#evalDmd"><span class="hs-identifier hs-var hs-var">evalDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span class="hs-comment">-- | First argument of 'GHC.Exts.maskAsyncExceptions#': @1C(1,L)@.</span><span>
</span><span id="line-958"></span><span class="hs-comment">-- Called exactly once.</span><span>
</span><span id="line-959"></span><span class="annot"><a href="GHC.Types.Demand.html#strictOnceApply1Dmd"><span class="hs-identifier hs-type">strictOnceApply1Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-960"></span><span id="strictOnceApply1Dmd"><span class="annot"><span class="annottext">strictOnceApply1Dmd :: Demand
</span><a href="GHC.Types.Demand.html#strictOnceApply1Dmd"><span class="hs-identifier hs-var hs-var">strictOnceApply1Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span class="hs-comment">-- | First argument of 'GHC.Exts.atomically#': @SC(S,L)@.</span><span>
</span><span id="line-963"></span><span class="hs-comment">-- Called at least once, possibly many times.</span><span>
</span><span id="line-964"></span><span class="annot"><a href="GHC.Types.Demand.html#strictManyApply1Dmd"><span class="hs-identifier hs-type">strictManyApply1Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-965"></span><span id="strictManyApply1Dmd"><span class="annot"><span class="annottext">strictManyApply1Dmd :: Demand
</span><a href="GHC.Types.Demand.html#strictManyApply1Dmd"><span class="hs-identifier hs-var hs-var">strictManyApply1Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span class="hs-comment">-- | First argument of catch#: @MC(M,L)@.</span><span>
</span><span id="line-968"></span><span class="hs-comment">-- Evaluates its arg lazily, but then applies it exactly once to one argument.</span><span>
</span><span id="line-969"></span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply1Dmd"><span class="hs-identifier hs-type">lazyApply1Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-970"></span><span id="lazyApply1Dmd"><span class="annot"><span class="annottext">lazyApply1Dmd :: Demand
</span><a href="GHC.Types.Demand.html#lazyApply1Dmd"><span class="hs-identifier hs-var hs-var">lazyApply1Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-971"></span><span>
</span><span id="line-972"></span><span class="hs-comment">-- | Second argument of catch#: @MC(M,C(1,L))@.</span><span>
</span><span id="line-973"></span><span class="hs-comment">-- Calls its arg lazily, but then applies it exactly once to an additional argument.</span><span>
</span><span id="line-974"></span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply2Dmd"><span class="hs-identifier hs-type">lazyApply2Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-975"></span><span id="lazyApply2Dmd"><span class="annot"><span class="annottext">lazyApply2Dmd :: Demand
</span><a href="GHC.Types.Demand.html#lazyApply2Dmd"><span class="hs-identifier hs-var hs-var">lazyApply2Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="annot"><span class="hs-comment">-- | Make a 'Demand' evaluated at-most-once.</span></span><span>
</span><span id="line-978"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier hs-type">oneifyDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-979"></span><span id="oneifyDmd"><span class="annot"><span class="annottext">oneifyDmd :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier hs-var hs-var">oneifyDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-980"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier hs-var">oneifyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-981"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier hs-var">oneifyDmd</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601100"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601100"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601101"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601101"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card
</span><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-var">oneifyCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601100"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601101"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span class="annot"><span class="hs-comment">-- | Make a 'Demand' evaluated at-least-once (e.g. strict).</span></span><span>
</span><span id="line-984"></span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDmd"><span class="hs-identifier hs-type">strictifyDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-985"></span><span id="strictifyDmd"><span class="annot"><span class="annottext">strictifyDmd :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#strictifyDmd"><span class="hs-identifier hs-var hs-var">strictifyDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#seqDmd"><span class="hs-identifier hs-var">seqDmd</span></a></span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span class="hs-comment">-- | If the argument is a used non-newtype dictionary, give it strict demand.</span><span>
</span><span id="line-988"></span><span class="hs-comment">-- Also split the product type &amp; demand and recur in order to similarly</span><span>
</span><span id="line-989"></span><span class="hs-comment">-- strictify the argument's contained used non-newtype superclass dictionaries.</span><span>
</span><span id="line-990"></span><span class="hs-comment">-- We use the demand as our recursive measure to guarantee termination.</span><span>
</span><span id="line-991"></span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-type">strictifyDictDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-992"></span><span id="strictifyDictDmd"><span class="annot"><span class="annottext">strictifyDictDmd :: Type -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-var hs-var">strictifyDictDmd</span></a></span></span><span> </span><span id="local-6989586621681601102"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681601102"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601103"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601103"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601104"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601104"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601105"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601105"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601103"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681601106"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681601106"><span class="hs-identifier hs-var">field_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe [Type]
</span><a href="#local-6989586621681601107"><span class="hs-identifier hs-var">as_non_newtype_dict</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681601102"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601104"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Demand -&gt; Demand) -&gt; [Type] -&gt; [Demand] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-var">strictifyDictDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681601106"><span class="hs-identifier hs-var">field_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601105"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>      </span><span class="hs-comment">-- main idea: ensure it's strict</span><span>
</span><span id="line-997"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-998"></span><span>    </span><span class="hs-comment">-- Return a TyCon and a list of field types if the given</span><span>
</span><span id="line-999"></span><span>    </span><span class="hs-comment">-- type is a non-newtype dictionary type</span><span>
</span><span id="line-1000"></span><span>    </span><span id="local-6989586621681601107"><span class="annot"><span class="annottext">as_non_newtype_dict :: Type -&gt; Maybe [Type]
</span><a href="#local-6989586621681601107"><span class="hs-identifier hs-var hs-var">as_non_newtype_dict</span></a></span></span><span> </span><span id="local-6989586621681601109"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681601109"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1001"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601110"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681601110"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601111"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681601111"><span class="hs-identifier hs-var">_arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601112"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681601112"><span class="hs-identifier hs-var">_data_con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621681601113"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681601113"><span class="hs-identifier hs-var">inst_con_arg_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1002"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, [Type], DataCon, [Scaled Type])
</span><a href="GHC.Core.DataCon.html#splitDataProductType_maybe"><span class="hs-identifier hs-var">splitDataProductType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681601109"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1003"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681601110"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681601110"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-1005"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Maybe [Type]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681601113"><span class="hs-identifier hs-var">inst_con_arg_tys</span></a></span><span>
</span><span id="line-1006"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1007"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Type]
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1008"></span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-var">strictifyDictDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span id="local-6989586621681601114"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601114"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601114"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span class="annot"><span class="hs-comment">-- | Make a 'Demand' lazy.</span></span><span>
</span><span id="line-1011"></span><span class="annot"><a href="GHC.Types.Demand.html#lazifyDmd"><span class="hs-identifier hs-type">lazifyDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1012"></span><span id="lazifyDmd"><span class="annot"><span class="annottext">lazifyDmd :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lazifyDmd"><span class="hs-identifier hs-var hs-var">lazifyDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span>
</span><span id="line-1013"></span><span>
</span><span id="line-1014"></span><span class="annot"><span class="hs-comment">-- | Wraps the 'SubDemand' with a one-shot call demand: @d@ -&gt; @C(1,d)@.</span></span><span>
</span><span id="line-1015"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier hs-type">mkCalledOnceDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-1016"></span><span id="mkCalledOnceDmd"><span class="annot"><span class="annottext">mkCalledOnceDmd :: SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier hs-var hs-var">mkCalledOnceDmd</span></a></span></span><span> </span><span id="local-6989586621681601115"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601115"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601115"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span class="annot"><span class="hs-comment">-- | @mkCalledOnceDmds n d@ returns @C(1,C1...C(1,d))@ where there are @n@ @C1@'s.</span></span><span>
</span><span id="line-1019"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmds"><span class="hs-identifier hs-type">mkCalledOnceDmds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-1020"></span><span id="mkCalledOnceDmds"><span class="annot"><span class="annottext">mkCalledOnceDmds :: Int -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCalledOnceDmds"><span class="hs-identifier hs-var hs-var">mkCalledOnceDmds</span></a></span></span><span> </span><span id="local-6989586621681601116"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601116"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621681601117"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601117"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SubDemand -&gt; SubDemand) -&gt; SubDemand -&gt; [SubDemand]
forall a. (a -&gt; a) -&gt; a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#iterate/GHC.List.html#iterate"><span class="hs-identifier hs-var">iterate</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier hs-var">mkCalledOnceDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601117"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">[SubDemand] -&gt; Int -&gt; SubDemand
forall a. HasCallStack =&gt; [a] -&gt; Int -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.List.html#%21%21/GHC.List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601116"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span class="hs-comment">-- | Peels one call level from the sub-demand, and also returns how many</span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- times we entered the lambda body.</span><span>
</span><span id="line-1024"></span><span class="annot"><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier hs-type">peelCallDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1025"></span><span id="peelCallDmd"><span class="annot"><span class="annottext">peelCallDmd :: SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier hs-var hs-var">peelCallDmd</span></a></span></span><span> </span><span id="local-6989586621681601120"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601120"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601120"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Card, SubDemand) -&gt; (Card, SubDemand) -&gt; (Card, SubDemand)
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#topCard"><span class="hs-identifier hs-var">topCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>
</span><span id="line-1027"></span><span class="hs-comment">-- Peels multiple nestings of 'Call' sub-demands and also returns</span><span>
</span><span id="line-1028"></span><span class="hs-comment">-- whether it was unsaturated in the form of a 'Card'inality, denoting</span><span>
</span><span id="line-1029"></span><span class="hs-comment">-- how many times the lambda body was entered.</span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- See Note [Demands from unsaturated function calls].</span><span>
</span><span id="line-1031"></span><span class="annot"><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-type">peelManyCalls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1032"></span><span id="peelManyCalls"><span class="annot"><span class="annottext">peelManyCalls :: Int -&gt; SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var hs-var">peelManyCalls</span></a></span></span><span> </span><span id="local-6989586621681601121"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601121"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681601122"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601122"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Card -&gt; SubDemand -&gt; (Card, SubDemand)
forall {t}.
(Eq t, Num t) =&gt;
t -&gt; Card -&gt; SubDemand -&gt; (Card, SubDemand)
</span><a href="#local-6989586621681601123"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601121"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601122"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1033"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1034"></span><span>    </span><span id="local-6989586621681601123"><span class="annot"><span class="annottext">go :: t -&gt; Card -&gt; SubDemand -&gt; (Card, SubDemand)
</span><a href="#local-6989586621681601123"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681601130"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601130"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681601131"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601131"><span class="hs-identifier hs-var">sd</span></a></span></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601130"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601131"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1035"></span><span>    </span><span class="annot"><a href="#local-6989586621681601123"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681601132"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681601132"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681601133"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601133"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601134"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601134"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601135"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601135"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; Card -&gt; SubDemand -&gt; (Card, SubDemand)
</span><a href="#local-6989586621681601123"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681601132"><span class="hs-identifier hs-var">k</span></a></span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601133"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-operator hs-var">`multCard`</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601134"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601135"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1036"></span><span>    </span><span class="annot"><a href="#local-6989586621681601123"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#topCard"><span class="hs-identifier hs-var">topCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-pragma hs-type">peelManyCalls</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- so that the pair cancels away in a `fst _` context</span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span class="hs-comment">-- | Extract the 'SubDemand' of a 'Demand'.</span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- PRECONDITION: The SubDemand must be used in a context where the expression</span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- denoted by the Demand is under evaluation.</span><span>
</span><span id="line-1042"></span><span class="annot"><a href="GHC.Types.Demand.html#subDemandIfEvaluated"><span class="hs-identifier hs-type">subDemandIfEvaluated</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-1043"></span><span id="subDemandIfEvaluated"><span class="annot"><span class="annottext">subDemandIfEvaluated :: Demand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#subDemandIfEvaluated"><span class="hs-identifier hs-var hs-var">subDemandIfEvaluated</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601136"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601136"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601136"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1044"></span><span>
</span><span id="line-1045"></span><span class="hs-comment">-- See Note [Demand on the worker] in GHC.Core.Opt.WorkWrap</span><span>
</span><span id="line-1046"></span><span class="annot"><a href="GHC.Types.Demand.html#mkWorkerDemand"><span class="hs-identifier hs-type">mkWorkerDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1047"></span><span id="mkWorkerDemand"><span class="annot"><span class="annottext">mkWorkerDemand :: Int -&gt; Demand
</span><a href="GHC.Types.Demand.html#mkWorkerDemand"><span class="hs-identifier hs-var hs-var">mkWorkerDemand</span></a></span></span><span> </span><span id="local-6989586621681601137"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601137"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand
forall {t}. (Eq t, Num t) =&gt; t -&gt; SubDemand
</span><a href="#local-6989586621681601138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601137"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1048"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681601138"><span class="annot"><span class="annottext">go :: t -&gt; SubDemand
</span><a href="#local-6989586621681601138"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-1049"></span><span>        </span><span class="annot"><a href="#local-6989586621681601138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681601145"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681601145"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">(SubDemand -&gt; SubDemand) -&gt; SubDemand -&gt; SubDemand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; SubDemand
</span><a href="#local-6989586621681601138"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681601145"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span class="annot"><a href="GHC.Types.Demand.html#argsOneShots"><span class="hs-identifier hs-type">argsOneShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Basic.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1052"></span><span class="annot"><span class="hs-comment">-- ^ See Note [Computing one-shot info]</span></span><span>
</span><span id="line-1053"></span><span id="argsOneShots"><span class="annot"><span class="annottext">argsOneShots :: DmdSig -&gt; Int -&gt; [[OneShotInfo]]
</span><a href="GHC.Types.Demand.html#argsOneShots"><span class="hs-identifier hs-var hs-var">argsOneShots</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601147"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601147"><span class="hs-identifier hs-var">arg_ds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601148"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601148"><span class="hs-identifier hs-var">n_val_args</span></a></span></span><span>
</span><span id="line-1054"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681601149"><span class="hs-identifier hs-var">unsaturated_call</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1055"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [[OneShotInfo]]
</span><a href="#local-6989586621681601150"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601147"><span class="hs-identifier hs-var">arg_ds</span></a></span><span>
</span><span id="line-1056"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1057"></span><span>    </span><span id="local-6989586621681601149"><span class="annot"><span class="annottext">unsaturated_call :: Bool
</span><a href="#local-6989586621681601149"><span class="hs-identifier hs-var hs-var">unsaturated_call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601147"><span class="hs-identifier hs-var">arg_ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-operator hs-var">`lengthExceeds`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601148"><span class="hs-identifier hs-var">n_val_args</span></a></span><span>
</span><span id="line-1058"></span><span>
</span><span id="line-1059"></span><span>    </span><span id="local-6989586621681601150"><span class="annot"><span class="annottext">go :: [Demand] -&gt; [[OneShotInfo]]
</span><a href="#local-6989586621681601150"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1060"></span><span>    </span><span class="annot"><a href="#local-6989586621681601150"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601152"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601152"><span class="hs-identifier hs-var">arg_d</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681601153"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601153"><span class="hs-identifier hs-var">arg_ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; [OneShotInfo]
</span><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-var">argOneShots</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601152"><span class="hs-identifier hs-var">arg_d</span></a></span><span> </span><span class="annot"><span class="annottext">[OneShotInfo] -&gt; [[OneShotInfo]] -&gt; [[OneShotInfo]]
forall {a}. [a] -&gt; [[a]] -&gt; [[a]]
</span><a href="#local-6989586621681601154"><span class="hs-operator hs-var">`cons`</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [[OneShotInfo]]
</span><a href="#local-6989586621681601150"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601153"><span class="hs-identifier hs-var">arg_ds</span></a></span><span>
</span><span id="line-1061"></span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-comment">-- Avoid list tail like [ [], [], [] ]</span><span>
</span><span id="line-1063"></span><span>    </span><span id="local-6989586621681601154"><span class="annot"><span class="annottext">cons :: [a] -&gt; [[a]] -&gt; [[a]]
</span><a href="#local-6989586621681601154"><span class="hs-identifier hs-var hs-var">cons</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1064"></span><span>    </span><span class="annot"><a href="#local-6989586621681601154"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span id="local-6989586621681601155"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681601155"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span id="local-6989586621681601156"><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621681601156"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681601155"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">[a] -&gt; [[a]] -&gt; [[a]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621681601156"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span class="annot"><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-type">argOneShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>          </span><span class="annot"><span class="hs-comment">-- ^ depending on saturation</span></span><span>
</span><span id="line-1067"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Basic.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1068"></span><span class="annot"><span class="hs-comment">-- ^ See Note [Computing one-shot info]</span></span><span>
</span><span id="line-1069"></span><span id="argOneShots"><span class="annot"><span class="annottext">argOneShots :: Demand -&gt; [OneShotInfo]
</span><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-var hs-var">argOneShots</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- This defn conflicts with 'saturatedByOneShots',</span><span>
</span><span id="line-1070"></span><span class="annot"><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-var">argOneShots</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- according to which we should return</span><span>
</span><span id="line-1071"></span><span>                           </span><span class="hs-comment">-- @repeat OneShotLam@ here...</span><span>
</span><span id="line-1072"></span><span class="annot"><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-var">argOneShots</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601157"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601157"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621681601158"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601157"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1074"></span><span>    </span><span id="local-6989586621681601158"><span class="annot"><span class="annottext">go :: SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621681601158"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601159"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601159"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601160"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601160"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1075"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601159"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OneShotInfo
</span><a href="GHC.Types.Basic.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a></span><span>    </span><span class="annot"><span class="annottext">OneShotInfo -&gt; [OneShotInfo] -&gt; [OneShotInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621681601158"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601160"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1076"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OneShotInfo
</span><a href="GHC.Types.Basic.html#NoOneShotInfo"><span class="hs-identifier hs-var">NoOneShotInfo</span></a></span><span> </span><span class="annot"><span class="annottext">OneShotInfo -&gt; [OneShotInfo] -&gt; [OneShotInfo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621681601158"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601160"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1077"></span><span>    </span><span class="annot"><a href="#local-6989586621681601158"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-1080"></span><span class="hs-comment">-- @saturatedByOneShots n C(M,C(M,...)) = True@</span><span>
</span><span id="line-1081"></span><span class="hs-comment">--   &lt;=&gt;</span><span>
</span><span id="line-1082"></span><span class="hs-comment">-- There are at least n nested C(M,..) calls.</span><span>
</span><span id="line-1083"></span><span class="hs-comment">-- See Note [Demand on the worker] in GHC.Core.Opt.WorkWrap</span><span>
</span><span id="line-1084"></span><span class="annot"><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier hs-type">saturatedByOneShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1085"></span><span id="saturatedByOneShots"><span class="annot"><span class="annottext">saturatedByOneShots :: Int -&gt; Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier hs-var hs-var">saturatedByOneShots</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1086"></span><span class="annot"><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier hs-var">saturatedByOneShots</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1087"></span><span class="annot"><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier hs-var">saturatedByOneShots</span></a></span><span> </span><span id="local-6989586621681601163"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601163"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601164"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601164"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">(Card -&gt; Bool) -&gt; Card -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Card, SubDemand) -&gt; Card
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Card, SubDemand) -&gt; Card) -&gt; (Card, SubDemand) -&gt; Card
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601163"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601164"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="hs-comment">{- Note [Strict demands]
~~~~~~~~~~~~~~~~~~~~~~~~
'isStrUsedDmd' returns true only of demands that are
   both strict
   and  used

In particular, it is False for &lt;B&gt; (i.e. strict and not used,
cardinality C_10), which can and does arise in, say (#7319)
   f x = raise# &lt;some exception&gt;
Then 'x' is not used, so f gets strictness &lt;B&gt; -&gt; .
Now the w/w generates
   fx = let x &lt;B&gt; = absentError &quot;unused&quot;
        in raise &lt;some exception&gt;
At this point we really don't want to convert to
   fx = case absentError &quot;unused&quot; of x -&gt; raise &lt;some exception&gt;
Since the program is going to diverge, this swaps one error for another,
but it's really a bad idea to *ever* evaluate an absent argument.
In #7319 we get
   T7319.exe: Oops!  Entered absent arg w_s1Hd{v} [lid] [base:GHC.Base.String{tc 36u}]

Note [SubDemand denotes at least one evaluation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a demand `n :* sd` on a binding `let x = e in &lt;body&gt;`.
(Similarly, a call sub-demand `Cn(sd)` on a lambda `\_. e`).
While `n` describes how *often* `x` had been evaluated in &lt;body&gt;,
the sub-demand `sd` describes how *deep* `e` has been evaluated, under the
following

  PREMISE: *for all program traces where `x` had been evaluated at all*

That is, `sd` disregards all program traces where `x` had not been evaluated,
because it can't describe the depth of an evaluation that never happened.
NB: The Premise only makes a difference for lower bounds/strictness.
Upper bounds/usage are unaffected by adding or leaving out evaluations that
never happen.

The Premise comes into play when we have lazy Demands. For example, if `x` was
demanded with `LP(SL,A)`, so perhaps the full expression was
  let x = (e1, e2) in (x `seq` fun y `seq` case x of (a,b) -&gt; a, True)
then `x` will be evaluated lazily, but in any trace in which `x` is evaluated,
the pair in its RHS will ultimately be evaluated deeply with sub-demand
`P(SL,A)`. That means that `e1` is ultimately evaluated strictly, even though
evaluation of the field does not directly follow the eval of `x` due to the
intermittent call `fun y`.

How does the additional strictness help? The long version is the list of
examples at the end of this Note (as procured in #21081 and #18903).
The short version is

  * We get to take advantage of call-by-value/let-to-case in more situations,
    as for e1 above. See example &quot;More let-to-case&quot; below.
  * Note [Eta reduction based on evaluation context] applies in more situations.
    See example &quot;More eta reduction&quot; below.
  * We get to unbox more results, see example &quot;More CPR&quot; below.

It seems like we don't give up anything in return. Indeed that is the case:

  * If we dropped the Premise, then a lazy `n` in `nP(m..)` would always force
    `m` to be lazy, too. That is quite redundant! It seems wasteful not to use
    the lower bound of `m` for something more useful. So indeed we give up on
    nothing in return for some nice wins.
  * Even if `n` is absent (so the Premise does hold for no trace whatsoever),
    it's pretty easy to describe how `e` was evaluated. Answer: 'botSubDmd'.
    We use it when expanding 'Absent' and 'Bottom' demands in 'viewDmdPair' as
    well as when expanding absent 'Poly's to 'Call' sub-demands in 'viewCall'.

Of course, we now have to maintain the Premise when we unpack and rebuild
Demands. For strict demands, we know that the Premise indeed always holds for
any program trace abstracted over, whereas we have to be careful for lazy
demands.

In particular, when doing `plusDmd` we have to *lazify* the nested SubDemand
if the outer cardinality is lazy. E.g.,
  LP(SL) + SP(L) = (L+S)P((M*SL)+L) = SP(L+L) = SP(L)
Multiplying with `M`/`C_01` is the &quot;lazify&quot; part here and is implemented in
`lazifyIfStrict`. Example proving that point:
  d2 :: &lt;LP(SL)&gt;&lt;SP(A)&gt;
  d2 x y = y `seq` (case x of (a,b) -&gt; a, True)
  -- What is the demand on x in (d2 x x)? NOT SP(SL)!!

We used to apply the same reasoning to Call SubDemands `Cn(sd)` in `plusSubDmd`,
but that led to #21717, because different calls return different heap objects.
See Note [Call SubDemand vs. evaluation Demand].

There are a couple more examples that improve in T21081.
Here is a selection of those examples demonstrating the usefulness of The
Premise:

  * &quot;More let-to-case&quot; (from testcase T21081):
    ```hs
    f :: (Bool, Bool) -&gt; (Bool, Bool)
    f pr = (case pr of (a,b) -&gt; a /= b, True)
    g :: Int -&gt; (Bool, Bool)
    g x = let y = let z = odd x in (z,z) in f y
    ```
    Although `f` is lazy in `pr`, we could case-bind `z` because it is always
    evaluated when `y` is evaluated. So we give `pr` demand `LP(SL,SL)`
    (most likely with better upper bounds/usage) and demand analysis then
    infers a strict demand for `z`.

  * &quot;More eta reduction&quot; (from testcase T21081):
    ```hs
    myfoldl :: (a -&gt; b -&gt; a) -&gt; a -&gt; [b] -&gt; a
    myfoldl f z [] = z
    myfoldl f !z (x:xs) = myfoldl (\a b -&gt; f a b) (f z x) xs
    ```
    Here, we can give `f` a demand of `LC(S,C(1,L))` (instead of the lazier
    `LC(L,C(1,L))`) which says &quot;Whenever `f` is evaluated (lazily), it is also
    called with two arguments&quot;.
    And Note [Eta reduction based on evaluation context] means we can rewrite
    `\a b -&gt; f a b` to `f` in the call site of `myfoldl`. Nice!

  * &quot;More CPR&quot; (from testcase T18903):
    ```hs
    h :: Int -&gt; Int
    h m =
      let g :: Int -&gt; (Int,Int)
          g 1 = (m, 0)
          g n = (2 * n, 2 `div` n)
          {-# NOINLINE g #-}
      in case m of
        1 -&gt; 0
        2 -&gt; snd (g m)
        _ -&gt; uncurry (+) (g m)
    ```
    We want to give `g` the demand `MC(1,P(MP(L),1P(L)))`, so we see that in each
    call site of `g`, we are strict in the second component of the returned
    pair. That in turn means that Nested CPR can unbox the result of the
    division even though it might throw.

Note [Unrealised opportunity in plusDmd]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Recall the lazification of SubDemands happening in `plusDmd` as described in
Note [SubDemand denotes at least one evaluation].

We *could* do better when both Demands are lazy already. Example
  (fun 1, fun 2)
Both args put Demand SC(S,L) on `fun`. The lazy pair arg context lazifies
this to LC(S,L), and it would be reasonable to report this Demand on `fun` for
the entire pair expression; after all, `fun` is called whenever it is evaluated.
But our definition of `plusDmd` will compute
  LC(S,L) + LC(S,L) = (L+L)(M*C(S,L) + M*C(S,L)) = L(C(L,L)) = L
Which is clearly less precise.
Doing better here could mean to `lub` when both demands are lazy, e.g.,
  LC(S,L) + LC(S,L) = (L+L)(C(S,L) &#8852; C(S,L)) = L(C(S,L))
Indeed that's what we did at one point between 9.4 and 9.6 after !7599, but it
means that we need a function `lubPlusSubDmd` that lubs on lower bounds but
plus'es upper bounds, implying maintenance challenges and complicated
explanations.

Plus, NoFib says that this special case doesn't bring all that much
(geom. mean +0.0% counted instructions), so we don't bother anymore.

Note [Call SubDemand vs. evaluation Demand]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Although both evaluation Demands and Call SubDemands carry a (Card,SubDemand)
pair, their interpretation is quite different. Example:

  f x = fst x * snd x
    -- f :: &lt;SP(1L,1L)&gt;, because 1P(1L,A)+1P(A,1L) = SP(1L,1L)
  g x = fst (x 1) * snd (x 2)
    -- g :: &lt;SC(S,P(ML,ML))&gt;, because 1C(1,P(1L,A))+1C(1,P(A,1L)) = SC(S,P(ML,ML))

The point about this example is that both demands have P(A,1L)/P(1L,A) as
sub-expressions, but when these sub-demands occur

  1. under an evaluation demand, we combine with `plusSubDmd`
  2. whereas under a Call sub-demand, we combine with `lubSubDmd`

And thus (1) yields a stricter demand on the pair components than (2).

In #21717 we saw that we really need lub in (2), because otherwise we make an
unsound prediction in `g (\n -&gt; if n == 1 then (1,1) else (bot,2))`; we'd say
that the `bot` expression is always evaluated, when it clearly is not.
Operationally, every call to `g` gives back a potentially distinct,
heap-allocated pair with potentially different contents, and we must `lubSubDmd`
over all such calls to approximate how any of those pairs might be used.

That is in stark contrast to f's argument `x`: Operationally, every eval of
`x` must yield the same pair and `f` evaluates both components of that pair.
The theorem &quot;every eval of `x` returns the same heap object&quot; is a very strong
MUST-alias property and we capitalise on that by using `plusSubDmd` in (1).

And indeed we *must* use `plusSubDmd` in (1) for sound upper bounds in an
analysis that assumes call-by-need (as opposed to the weaker call-by-name) for
let bindings. Consider

  h x = fst x * fst x
    -- h :: &lt;SP(SL,A)&gt;

And the expression `let a=1; p=(a,a)} in h p`. Here, *although* the RHS of `p`
is only evaluated once under call-by-need, `a` is still evaluated twice.
If we had used `lubSubDmd`, we'd see SP(1L,A) and the 1L unsoundly says &quot;exactly
once&quot;.

If the analysis had assumed call-by-name, it would be sound to say &quot;a is used
once in p&quot;: p is used multiple times and hence so would a, as if p was a
function. So using `plusSubDmd` does not only yield better strictness, it is
also &quot;holding up the other end of the bargain&quot; of the call-by-need assumption
for upper bounds.

(To SG's knowledge, the distinction between call-by-name and call-by-need does
not matter for strictness analysis/lower bounds, thus it would be sound to use
`lubSubDmd` all the time there.)

Note [mkCall and plusSubDmd]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We never rewrite a strict, non-absent Call sub-demand like C(S,S) to a
polymorphic sub-demand like S, otherwise #21085 strikes. Consider the
following inequality (would also for M and 1 instead of L and S, but we forbid
such Polys):

  L+S = S = C(S,S) &lt; C(S,L) = C(L,L)+C(S,S)

Note that L=C(L,L). If we also had S=C(S,S), we'd be in trouble: Now
`plusSubDmd` would no longer maintain the equality relation on sub-demands,
much less monotonicity. Bad!

Clearly, `n &lt;= Cn(n)` is unproblematic, as is `n &gt;= Cn(n)` for any `n`
except 1 and S. But `C(S,S) &gt;= S` would mean trouble, because then we'd get
the problematic `C(S,S) = S`. We have just established that `S &lt; C(S,S)`!
As such, the rewrite C(S,S) to S is anti-monotone and we forbid it, first
and foremost in `mkCall` (which is the only place that rewrites Cn(n) to n).

Crisis and #21085 averted!

Note [Computing one-shot info]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a call
    f (\pqr. e1) (\xyz. e2) e3
where f has usage signature
    &lt;C(M,C(L,C(M,L)))&gt;&lt;C(M,L)&gt;&lt;L&gt;
Then argsOneShots returns a [[OneShotInfo]] of
    [[OneShot,NoOneShotInfo,OneShot],  [OneShot]]
The occurrence analyser propagates this one-shot infor to the
binders \pqr and \xyz;
see Note [Sources of one-shot information] in GHC.Core.Opt.OccurAnal.

Note [Boxity in Poly]
~~~~~~~~~~~~~~~~~~~~~
To support Note [Boxity analysis], it makes sense that 'Prod' carries a
'Boxity'. But why does 'Poly' have to carry a 'Boxity', too? Shouldn't all
'Poly's be 'Boxed'? Couldn't we simply use 'Prod Unboxed' when we need to
express an unboxing demand?

'botSubDmd' (B) needs to be the bottom of the lattice, so it needs to be an
Unboxed demand (and deeply, at that). Similarly, 'seqSubDmd' (A) is an Unboxed
demand. So why not say that Polys with absent cardinalities have Unboxed boxity?
That doesn't work, because we also need the boxed equivalents. Here's an example
for A (function 'absent' in T19871):
```
f _ True  = 1
f a False = a `seq` 2
  -- demand on a: MA, the A is short for `Poly Boxed C_00`

g a = a `seq` f a True
  -- demand on a: SA, which is `Poly Boxed C_00`

h True  p       = g p -- SA on p (inherited from g)
h False p@(x,y) = x+y -- S!P(1!L,1!L) on p
```
If A is treated as Unboxed, we get reboxing in the call site to 'g'.
So we obviously would need a Boxed variant of A. Rather than introducing a lot
of special cases, we just carry the Boxity in 'Poly'. Plus, we could most likely
find examples like the above for any other cardinality.

Note [Why Boxity in SubDemand and not in Demand?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In #19871, we started out by storing 'Boxity' in 'SubDemand', in the 'Prod'
constructor only. But then we found that we weren't able to express the unboxing
'seqSubDmd', because that one really is a `Poly C_00` sub-demand.
We then tried to store the Boxity in 'Demand' instead, for these reasons:

  1. The whole boxity-of-seq business comes to a satisfying conclusion
  2. Putting Boxity in the SubDemand is weird to begin with, because it
     describes the box and not its fields, just as the evaluation cardinality
     of a Demand describes how often the box is used. It makes more sense that
     Card and Boxity travel together. Also the alternative would have been to
     store Boxity with Poly, which is even weirder and more redundant.

But then we regressed in T7837 (grep #19871 for boring specifics), which needed
to transfer an ambient unboxed *demand* on a dictionary selector to its argument
dictionary, via a 'Call' sub-demand `C(1,sd)`, as
Note [Demand transformer for a dictionary selector] explains. Annoyingly,
the boxity info has to be stored in the *sub-demand* `sd`! There's no demand
to store the boxity in. So we bit the bullet and now we store Boxity in
'SubDemand', both in 'Prod' *and* 'Poly'. See also Note [Boxity in Poly].

Note [Demand transformer for data constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the expression (x,y) with sub-demand P(SL,A).  What is the demand on
x,y?  Obviously `x` is used strictly, and `y` not at all. So we want to
decompose a product demand, and feed its components demands into the
arguments.  That is the job of dmdTransformDataConSig.  More precisely,

 * it gets the demand on the data constructor itself;
   in the above example that is C(1,C(1,P(SL,A)))
 * it returns the demands on the arguments;
   in the above example that is [SL, A]

Nasty wrinkle. Consider this code (#22475 has more realistic examples but
assume this is what the demand analyser sees)

   data T = MkT !Int Bool
   get :: T -&gt; Bool
   get (MkT _ b) = b

   foo = let v::Int = I# 7
             t::T   = MkT v True
         in get t

Now `v` is unused by `get`, /but/ we can't give `v` an Absent demand,
else we'll drop the binding and replace it with an error thunk.
Then the code generator (more specifically GHC.Stg.InferTags.Rewrite)
will add an extra eval of MkT's argument to give
   foo = let v::Int = error &quot;absent&quot;
             t::T   = case v of v' -&gt; MkT v' True
         in get t

Boo!  Because of this extra eval (added in STG-land), the truth is that `MkT`
may (or may not) evaluate its arguments (as established in #21497). Hence the
use of `bump` in dmdTransformDataConSig, which adds in a `C_01` eval. The
`C_01` says &quot;may or may not evaluate&quot; which is absolutely faithful to what
InferTags.Rewrite does.

In particular it is very important /not/ to make that a `C_11` eval,
see Note [Data-con worker strictness].
-}</span><span>
</span><span id="line-1417"></span><span>
</span><span id="line-1418"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Divergence: Whether evaluation surely diverges
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span class="hs-comment">-- | 'Divergence' characterises whether something surely diverges.</span><span>
</span><span id="line-1425"></span><span class="hs-comment">-- Models a subset lattice of the following exhaustive set of divergence</span><span>
</span><span id="line-1426"></span><span class="hs-comment">-- results:</span><span>
</span><span id="line-1427"></span><span class="hs-comment">--</span><span>
</span><span id="line-1428"></span><span class="hs-comment">-- [n] nontermination (e.g. loops)</span><span>
</span><span id="line-1429"></span><span class="hs-comment">-- [i] throws imprecise exception</span><span>
</span><span id="line-1430"></span><span class="hs-comment">-- [p] throws precise exceTtion</span><span>
</span><span id="line-1431"></span><span class="hs-comment">-- [c] converges (reduces to WHNF).</span><span>
</span><span id="line-1432"></span><span class="hs-comment">--</span><span>
</span><span id="line-1433"></span><span class="hs-comment">-- The different lattice elements correspond to different subsets, indicated by</span><span>
</span><span id="line-1434"></span><span class="hs-comment">-- juxtaposition of indicators (e.g. __nc__ definitely doesn't throw an</span><span>
</span><span id="line-1435"></span><span class="hs-comment">-- exception, and may or may not reduce to WHNF).</span><span>
</span><span id="line-1436"></span><span class="hs-comment">--</span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1438"></span><span class="hs-comment">--             Dunno (nipc)</span><span>
</span><span id="line-1439"></span><span class="hs-comment">--                  |</span><span>
</span><span id="line-1440"></span><span class="hs-comment">--            ExnOrDiv (nip)</span><span>
</span><span id="line-1441"></span><span class="hs-comment">--                  |</span><span>
</span><span id="line-1442"></span><span class="hs-comment">--            Diverges (ni)</span><span>
</span><span id="line-1443"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1444"></span><span class="hs-comment">--</span><span>
</span><span id="line-1445"></span><span class="hs-comment">-- As you can see, we don't distinguish __n__ and __i__.</span><span>
</span><span id="line-1446"></span><span class="hs-comment">-- See Note [Precise exceptions and strictness analysis] for why __p__ is so</span><span>
</span><span id="line-1447"></span><span class="hs-comment">-- special compared to __i__.</span><span>
</span><span id="line-1448"></span><span class="hs-keyword">data</span><span> </span><span id="Divergence"><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-var">Divergence</span></a></span></span><span>
</span><span id="line-1449"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Diverges"><span class="annot"><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Definitely throws an imprecise exception or diverges.</span></span><span>
</span><span id="line-1450"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ExnOrDiv"><span class="annot"><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span></span><span> </span><span class="hs-comment">-- ^ Definitely throws a *precise* exception, an imprecise</span><span>
</span><span id="line-1451"></span><span>             </span><span class="hs-comment">--   exception or diverges. Never converges, hence 'isDeadEndDiv'!</span><span>
</span><span id="line-1452"></span><span>             </span><span class="hs-comment">--   See scenario 1 in Note [Precise exceptions and strictness analysis].</span><span>
</span><span id="line-1453"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Dunno"><span class="annot"><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Might diverge, throw any kind of exception or converge.</span></span><span>
</span><span id="line-1454"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681601169"><span id="local-6989586621681601171"><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Bool
(Divergence -&gt; Divergence -&gt; Bool)
-&gt; (Divergence -&gt; Divergence -&gt; Bool) -&gt; Eq Divergence
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Divergence -&gt; Divergence -&gt; Bool
== :: Divergence -&gt; Divergence -&gt; Bool
$c/= :: Divergence -&gt; Divergence -&gt; Bool
/= :: Divergence -&gt; Divergence -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-1455"></span><span>
</span><span id="line-1456"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-type">lubDivergence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-1457"></span><span id="lubDivergence"><span class="annot"><span class="annottext">lubDivergence :: Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var hs-var">lubDivergence</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span id="local-6989586621681601173"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601173"><span class="hs-identifier hs-var">div</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601173"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-1458"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span id="local-6989586621681601174"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601174"><span class="hs-identifier hs-var">div</span></a></span></span><span>      </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601174"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-1459"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-1460"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-1461"></span><span class="hs-comment">-- This needs to commute with defaultFvDmd, i.e.</span><span>
</span><span id="line-1462"></span><span class="hs-comment">-- defaultFvDmd (r1 `lubDivergence` r2) = defaultFvDmd r1 `lubDmd` defaultFvDmd r2</span><span>
</span><span id="line-1463"></span><span class="hs-comment">-- (See Note [Default demand on free variables and arguments] for why)</span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span class="hs-comment">-- | See Note [Asymmetry of plusDmdType], which concludes that 'plusDivergence'</span><span>
</span><span id="line-1466"></span><span class="hs-comment">-- needs to be symmetric.</span><span>
</span><span id="line-1467"></span><span class="hs-comment">-- Strictly speaking, we should have @plusDivergence Dunno Diverges = ExnOrDiv@.</span><span>
</span><span id="line-1468"></span><span class="hs-comment">-- But that regresses in too many places (every infinite loop, basically) to be</span><span>
</span><span id="line-1469"></span><span class="hs-comment">-- worth it and is only relevant in higher-order scenarios</span><span>
</span><span id="line-1470"></span><span class="hs-comment">-- (e.g. Divergence of @f (throwIO blah)@).</span><span>
</span><span id="line-1471"></span><span class="hs-comment">-- So 'plusDivergence' currently is 'glbDivergence', really.</span><span>
</span><span id="line-1472"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-type">plusDivergence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-1473"></span><span id="plusDivergence"><span class="annot"><span class="annottext">plusDivergence :: Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var hs-var">plusDivergence</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-1474"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var">plusDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-1475"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var">plusDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-1476"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var">plusDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span class="hs-comment">-- | In a non-strict scenario, we might not force the Divergence, in which case</span><span>
</span><span id="line-1479"></span><span class="hs-comment">-- we might converge, hence Dunno.</span><span>
</span><span id="line-1480"></span><span class="annot"><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-type">multDivergence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-1481"></span><span id="multDivergence"><span class="annot"><span class="annottext">multDivergence :: Card -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-var hs-var">multDivergence</span></a></span></span><span> </span><span id="local-6989586621681601177"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601177"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601177"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-1482"></span><span class="annot"><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-var">multDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601178"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601178"><span class="hs-identifier hs-var">d</span></a></span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601178"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1483"></span><span>
</span><span id="line-1484"></span><span class="annot"><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-type">topDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier hs-type">exnDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier hs-type">botDiv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-1485"></span><span id="topDiv"><span class="annot"><span class="annottext">topDiv :: Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var hs-var">topDiv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-1486"></span><span id="exnDiv"><span class="annot"><span class="annottext">exnDiv :: Divergence
</span><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier hs-var hs-var">exnDiv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-1487"></span><span id="botDiv"><span class="annot"><span class="annottext">botDiv :: Divergence
</span><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier hs-var hs-var">botDiv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-1488"></span><span>
</span><span id="line-1489"></span><span class="hs-comment">-- | True if the 'Divergence' indicates that evaluation will not return.</span><span>
</span><span id="line-1490"></span><span class="hs-comment">-- See Note [Dead ends].</span><span>
</span><span id="line-1491"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-type">isDeadEndDiv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1492"></span><span id="isDeadEndDiv"><span class="annot"><span class="annottext">isDeadEndDiv :: Divergence -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var hs-var">isDeadEndDiv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1493"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1494"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1495"></span><span>
</span><span id="line-1496"></span><span class="hs-comment">-- See Notes [Default demand on free variables and arguments]</span><span>
</span><span id="line-1497"></span><span class="hs-comment">-- and Scenario 1 in [Precise exceptions and strictness analysis]</span><span>
</span><span id="line-1498"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-type">defaultFvDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1499"></span><span id="defaultFvDmd"><span class="annot"><span class="annottext">defaultFvDmd :: Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var hs-var">defaultFvDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span>
</span><span id="line-1500"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span> </span><span class="hs-comment">-- This is the whole point of ExnOrDiv!</span><span>
</span><span id="line-1501"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-var">botDmd</span></a></span><span> </span><span class="hs-comment">-- Diverges</span><span>
</span><span id="line-1502"></span><span>
</span><span id="line-1503"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-type">defaultArgDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1504"></span><span class="hs-comment">-- TopRes and BotRes are polymorphic, so that</span><span>
</span><span id="line-1505"></span><span class="hs-comment">--      BotRes === (Bot -&gt; BotRes) === ...</span><span>
</span><span id="line-1506"></span><span class="hs-comment">--      TopRes === (Top -&gt; TopRes) === ...</span><span>
</span><span id="line-1507"></span><span class="hs-comment">-- This function makes that concrete</span><span>
</span><span id="line-1508"></span><span class="hs-comment">-- Also see Note [Default demand on free variables and arguments]</span><span>
</span><span id="line-1509"></span><span id="defaultArgDmd"><span class="annot"><span class="annottext">defaultArgDmd :: Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var hs-var">defaultArgDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span>
</span><span id="line-1510"></span><span class="hs-comment">-- NB: not botDmd! We don't want to mask the precise exception by forcing the</span><span>
</span><span id="line-1511"></span><span class="hs-comment">-- argument. But it is still absent.</span><span>
</span><span id="line-1512"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span>
</span><span id="line-1513"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-var">botDmd</span></a></span><span>
</span><span id="line-1514"></span><span>
</span><span id="line-1515"></span><span class="hs-comment">{- Note [Precise vs imprecise exceptions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
An exception is considered to be /precise/ when it is thrown by the 'raiseIO#'
primop. It follows that all other primops (such as 'raise#' or
division-by-zero) throw /imprecise/ exceptions. Note that the actual type of
the exception thrown doesn't have any impact!

GHC undertakes some effort not to apply an optimisation that would mask a
/precise/ exception with some other source of nontermination, such as genuine
divergence or an imprecise exception, so that the user can reliably
intercept the precise exception with a catch handler before and after
optimisations.

See also the wiki page on precise exceptions:
https://gitlab.haskell.org/ghc/ghc/wikis/exceptions/precise-exceptions
Section 5 of &quot;Tackling the awkward squad&quot; talks about semantic concerns.
Imprecise exceptions are actually more interesting than precise ones (which are
fairly standard) from the perspective of semantics. See the paper &quot;A Semantics
for Imprecise Exceptions&quot; for more details.

Note [Dead ends]
~~~~~~~~~~~~~~~~
We call an expression that either diverges or throws a precise or imprecise
exception a &quot;dead end&quot;. We used to call such an expression just &quot;bottoming&quot;,
but with the measures we take to preserve precise exception semantics
(see Note [Precise exceptions and strictness analysis]), that is no longer
accurate: 'exnDiv' is no longer the bottom of the Divergence lattice.

Yet externally to demand analysis, we mostly care about being able to drop dead
code etc., which is all due to the property that such an expression never
returns, hence we consider throwing a precise exception to be a dead end.
See also 'isDeadEndDiv'.

Note [Precise exceptions and strictness analysis]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We have to take care to preserve precise exception semantics in strictness
analysis (#17676). There are two scenarios that need careful treatment.

The fixes were discussed at
https://gitlab.haskell.org/ghc/ghc/wikis/fixing-precise-exceptions

Recall that raiseIO# raises a *precise* exception, in contrast to raise# which
raises an *imprecise* exception. See Note [Precise vs imprecise exceptions].

Scenario 1: Precise exceptions in case alternatives
---------------------------------------------------
Unlike raise# (which returns botDiv), we want raiseIO# to return exnDiv.
Here's why. Consider this example from #13380 (similarly #17676):
  f x y | x&gt;0       = raiseIO# Exc
        | y&gt;0       = return 1
        | otherwise = return 2
Is 'f' strict in 'y'? One might be tempted to say yes! But that plays fast and
loose with the precise exception; after optimisation, (f 42 (error &quot;boom&quot;))
turns from throwing the precise Exc to throwing the imprecise user error
&quot;boom&quot;. So, the defaultFvDmd of raiseIO# should be lazy (topDmd), which can be
achieved by giving it divergence exnDiv.
See Note [Default demand on free variables and arguments].

Why don't we just give it topDiv instead of introducing exnDiv?
Because then the simplifier will fail to discard raiseIO#'s continuation in
  case raiseIO# x s of { (# s', r #) -&gt; &lt;BIG&gt; }
which we'd like to optimise to
  case raiseIO# x s of {}
Hence we came up with exnDiv. The default FV demand of exnDiv is lazy (and
its default arg dmd is absent), but otherwise (in terms of 'isDeadEndDiv') it
behaves exactly as botDiv, so that dead code elimination works as expected.
This is tracked by T13380b.

Scenario 2: Precise exceptions in case scrutinees
-------------------------------------------------
Consider (more complete examples in #148, #1592, testcase strun003)

  case foo x s of { (# s', r #) -&gt; y }

Is this strict in 'y'? Often not! If @foo x s@ might throw a precise exception
(ultimately via raiseIO#), then we must not force 'y', which may fail to
terminate or throw an imprecise exception, until we have performed @foo x s@.

So we have to 'deferAfterPreciseException' (which 'lub's with 'exnDmdType' to
model the exceptional control flow) when @foo x s@ may throw a precise
exception. Motivated by T13380{d,e,f}.
See Note [Which scrutinees may throw precise exceptions] in &quot;GHC.Core.Opt.DmdAnal&quot;.

We have to be careful not to discard dead-end Divergence from case
alternatives, though (#18086):

  m = putStrLn &quot;foo&quot; &gt;&gt; error &quot;bar&quot;

'm' should still have 'exnDiv', which is why it is not sufficient to lub with
'nopDmdType' (which has 'topDiv') in 'deferAfterPreciseException'.

Historical Note: This used to be called the &quot;IO hack&quot;. But that term is rather
a bad fit because
1. It's easily confused with the &quot;State hack&quot;, which also affects IO.
2. Neither &quot;IO&quot; nor &quot;hack&quot; is a good description of what goes on here, which
   is deferring strictness results after possibly throwing a precise exception.
   The &quot;hack&quot; is probably not having to defer when we can prove that the
   expression may not throw a precise exception (increasing precision of the
   analysis), but that's just a favourable guess.

Note [Exceptions and strictness]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We used to smart about catching exceptions, but we aren't anymore.
See #14998 for the way it's resolved at the moment.

Here's a historic breakdown:

Apparently, exception handling prim-ops didn't use to have any special
strictness signatures, thus defaulting to nopSig, which assumes they use their
arguments lazily. Joachim was the first to realise that we could provide richer
information. Thus, in 0558911f91c (Dec 13), he added signatures to
primops.txt.pp indicating that functions like `catch#` and `catchRetry#` call
their argument, which is useful information for usage analysis. Still with a
'Lazy' strictness demand (i.e. 'lazyApply1Dmd'), though, and the world was fine.

In 7c0fff4 (July 15), Simon argued that giving `catch#` et al. a
'strictApply1Dmd' leads to substantial performance gains. That was at the cost
of correctness, as #10712 proved. So, back to 'lazyApply1Dmd' in
28638dfe79e (Dec 15).

Motivated to reproduce the gains of 7c0fff4 without the breakage of #10712,
Ben opened #11222. Simon made the demand analyser &quot;understand catch&quot; in
9915b656 (Jan 16) by adding a new 'catchArgDmd', which basically said to call
its argument strictly, but also swallow any thrown exceptions in
'multDivergence'. This was realized by extending the 'Str' constructor of
'ArgStr' with a 'ExnStr' field, indicating that it catches the exception, and
adding a 'ThrowsExn' constructor to the 'Divergence' lattice as an element
between 'Dunno' and 'Diverges'. Then along came #11555 and finally #13330,
so we had to revert to 'lazyApply1Dmd' again in 701256df88c (Mar 17).

This left the other variants like 'catchRetry#' having 'catchArgDmd', which is
where #14998 picked up. Item 1 was concerned with measuring the impact of also
making `catchRetry#` and `catchSTM#` have 'lazyApply1Dmd'. The result was that
there was none. We removed the last usages of 'catchArgDmd' in 00b8ecb7
(Apr 18). There was a lot of dead code resulting from that change, that we
removed in ef6b283 (Jan 19): We got rid of 'ThrowsExn' and 'ExnStr' again and
removed any code that was dealing with the peculiarities.

Where did the speed-ups vanish to? In #14998, item 3 established that
turning 'catch#' strict in its first argument didn't bring back any of the
alleged performance benefits. Item 2 of that ticket finally found out that it
was entirely due to 'catchException's new (since #11555) definition, which
was simply

    catchException !io handler = catch io handler

While 'catchException' is arguably the saner semantics for 'catch', it is an
internal helper function in &quot;GHC.IO&quot;. Its use in
&quot;GHC.IO.Handle.Internals.do_operation&quot; made for the huge allocation differences:
Remove the bang and you find the regressions we originally wanted to avoid with
'catchArgDmd'. See also #exceptions_and_strictness# in &quot;GHC.IO&quot;.

So history keeps telling us that the only possibly correct strictness annotation
for the first argument of 'catch#' is 'lazyApply1Dmd', because 'catch#' really
is not strict in its argument: Just try this in GHCi

  :set -XScopedTypeVariables
  import Control.Exception
  catch undefined (\(_ :: SomeException) -&gt; putStrLn &quot;you'll see this&quot;)

Any analysis that assumes otherwise will be broken in some way or another
(beyond `-fno-pedantic-bottoms`).

But then #13380 and #17676 suggest (in Mar 20) that we need to re-introduce a
subtly different variant of `ThrowsExn` (which we call `ExnOrDiv` now) that is
only used by `raiseIO#` in order to preserve precise exceptions by strictness
analysis, while not impacting the ability to eliminate dead code.
See Note [Precise exceptions and strictness analysis].

Note [Default demand on free variables and arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Free variables not mentioned in the environment of a 'DmdType'
are demanded according to the demand type's Divergence:
  * In a Diverges (botDiv) context, that demand is botDmd
    (strict and absent).
  * In all other contexts, the demand is absDmd (lazy and absent).
This is recorded in 'defaultFvDmd'.

Similarly, we can eta-expand demand types to get demands on excess arguments
not accounted for in the type, by consulting 'defaultArgDmd':
  * In a Diverges (botDiv) context, that demand is again botDmd.
  * In a ExnOrDiv (exnDiv) context, that demand is absDmd: We surely diverge
    before evaluating the excess argument, but don't want to eagerly evaluate
    it (cf. Note [Precise exceptions and strictness analysis]).
  * In a Dunno context (topDiv), the demand is topDmd, because
    it's perfectly possible to enter the additional lambda and evaluate it
    in unforeseen ways (so, not absent).

Note [Bottom CPR iff Dead-Ending Divergence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Both CPR analysis and Demand analysis handle recursive functions by doing
fixed-point iteration. To find the *least* (e.g., most informative) fixed-point,
iteration starts with the bottom element of the semantic domain. Diverging
functions generally have the bottom element as their least fixed-point.

One might think that CPR analysis and Demand analysis then agree in when a
function gets a bottom denotation. E.g., whenever it has 'botCpr', it should
also have 'botDiv'. But that is not the case, because strictness analysis has to
be careful around precise exceptions, see Note [Precise vs imprecise exceptions].

So Demand analysis gives some diverging functions 'exnDiv' (which is *not* the
bottom element) when the CPR signature says 'botCpr', and that's OK. Here's an
example (from #18086) where that is the case:

ioTest :: IO ()
ioTest = do
  putStrLn &quot;hi&quot;
  undefined

However, one can loosely say that we give a function 'botCpr' whenever its
'Divergence' is 'exnDiv' or 'botDiv', i.e., dead-ending. But that's just
a consequence of fixed-point iteration, it's not important that they agree.

************************************************************************
*                                                                      *
           Demand environments and types
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1734"></span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- Subject to Note [Default demand on free variables and arguments]</span><span>
</span><span id="line-1736"></span><span class="hs-comment">-- | Captures the result of an evaluation of an expression, by</span><span>
</span><span id="line-1737"></span><span class="hs-comment">--</span><span>
</span><span id="line-1738"></span><span class="hs-comment">--   * Listing how the free variables of that expression have been evaluted</span><span>
</span><span id="line-1739"></span><span class="hs-comment">--     ('de_fvs')</span><span>
</span><span id="line-1740"></span><span class="hs-comment">--   * Saying whether or not evaluation would surely diverge ('de_div')</span><span>
</span><span id="line-1741"></span><span class="hs-comment">--</span><span>
</span><span id="line-1742"></span><span class="hs-comment">-- See Note [Demand env Equality].</span><span>
</span><span id="line-1743"></span><span class="hs-keyword">data</span><span> </span><span id="DmdEnv"><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-var">DmdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DE"><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="de_fvs"><span class="annot"><span class="annottext">DmdEnv -&gt; VarEnv Demand
</span><a href="GHC.Types.Demand.html#de_fvs"><span class="hs-identifier hs-var hs-var">de_fvs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="de_div"><span class="annot"><span class="annottext">DmdEnv -&gt; Divergence
</span><a href="GHC.Types.Demand.html#de_div"><span class="hs-identifier hs-var hs-var">de_div</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1744"></span><span>
</span><span id="line-1745"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601186"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1746"></span><span>  </span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601192"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601192"><span class="hs-identifier hs-var">fv1</span></a></span></span><span> </span><span id="local-6989586621681601193"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601193"><span class="hs-identifier hs-var">div1</span></a></span></span><span> </span><span id="local-6989586621681601194"><span class="annot"><span class="annottext">== :: DmdEnv -&gt; DmdEnv -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601195"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601195"><span class="hs-identifier hs-var">fv2</span></a></span></span><span> </span><span id="local-6989586621681601196"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601196"><span class="hs-identifier hs-var">div2</span></a></span></span><span>
</span><span id="line-1747"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601193"><span class="hs-identifier hs-var">div1</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601196"><span class="hs-identifier hs-var">div2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; VarEnv Demand -&gt; VarEnv Demand
forall {key}. Divergence -&gt; UniqFM key Demand -&gt; UniqFM key Demand
</span><a href="#local-6989586621681601197"><span class="hs-identifier hs-var">canonicalise</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601193"><span class="hs-identifier hs-var">div1</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601192"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; VarEnv Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; VarEnv Demand -&gt; VarEnv Demand
forall {key}. Divergence -&gt; UniqFM key Demand -&gt; UniqFM key Demand
</span><a href="#local-6989586621681601197"><span class="hs-identifier hs-var">canonicalise</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601196"><span class="hs-identifier hs-var">div2</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601195"><span class="hs-identifier hs-var">fv2</span></a></span><span>
</span><span id="line-1748"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1749"></span><span>      </span><span id="local-6989586621681601197"><span class="annot"><span class="annottext">canonicalise :: Divergence -&gt; UniqFM key Demand -&gt; UniqFM key Demand
</span><a href="#local-6989586621681601197"><span class="hs-identifier hs-var hs-var">canonicalise</span></a></span></span><span> </span><span id="local-6989586621681601199"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601199"><span class="hs-identifier hs-var">div</span></a></span></span><span> </span><span id="local-6989586621681601200"><span class="annot"><span class="annottext">UniqFM key Demand
</span><a href="#local-6989586621681601200"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Bool) -&gt; UniqFM key Demand -&gt; UniqFM key Demand
forall elt key. (elt -&gt; Bool) -&gt; UniqFM key elt -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#filterUFM"><span class="hs-identifier hs-var">filterUFM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601199"><span class="hs-identifier hs-var">div</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqFM key Demand
</span><a href="#local-6989586621681601200"><span class="hs-identifier hs-var">fv</span></a></span><span>
</span><span id="line-1750"></span><span>
</span><span id="line-1751"></span><span class="annot"><a href="GHC.Types.Demand.html#mkEmptyDmdEnv"><span class="hs-identifier hs-type">mkEmptyDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1752"></span><span id="mkEmptyDmdEnv"><span class="annot"><span class="annottext">mkEmptyDmdEnv :: Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#mkEmptyDmdEnv"><span class="hs-identifier hs-var hs-var">mkEmptyDmdEnv</span></a></span></span><span> </span><span id="local-6989586621681601204"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601204"><span class="hs-identifier hs-var">div</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601204"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-1753"></span><span>
</span><span id="line-1754"></span><span class="hs-comment">-- | Build a potentially terminating 'DmdEnv' from a finite map that says what</span><span>
</span><span id="line-1755"></span><span class="hs-comment">-- has been evaluated so far</span><span>
</span><span id="line-1756"></span><span class="annot"><a href="GHC.Types.Demand.html#mkTermDmdEnv"><span class="hs-identifier hs-type">mkTermDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1757"></span><span id="mkTermDmdEnv"><span class="annot"><span class="annottext">mkTermDmdEnv :: VarEnv Demand -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#mkTermDmdEnv"><span class="hs-identifier hs-var hs-var">mkTermDmdEnv</span></a></span></span><span> </span><span id="local-6989586621681601206"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601206"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601206"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var">topDiv</span></a></span><span>
</span><span id="line-1758"></span><span>
</span><span id="line-1759"></span><span class="annot"><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier hs-type">nopDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1760"></span><span id="nopDmdEnv"><span class="annot"><span class="annottext">nopDmdEnv :: DmdEnv
</span><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier hs-var hs-var">nopDmdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#mkEmptyDmdEnv"><span class="hs-identifier hs-var">mkEmptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var">topDiv</span></a></span><span>
</span><span id="line-1761"></span><span>
</span><span id="line-1762"></span><span class="annot"><a href="GHC.Types.Demand.html#botDmdEnv"><span class="hs-identifier hs-type">botDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1763"></span><span id="botDmdEnv"><span class="annot"><span class="annottext">botDmdEnv :: DmdEnv
</span><a href="GHC.Types.Demand.html#botDmdEnv"><span class="hs-identifier hs-var hs-var">botDmdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#mkEmptyDmdEnv"><span class="hs-identifier hs-var">mkEmptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier hs-var">botDiv</span></a></span><span>
</span><span id="line-1764"></span><span>
</span><span id="line-1765"></span><span class="annot"><a href="GHC.Types.Demand.html#exnDmdEnv"><span class="hs-identifier hs-type">exnDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1766"></span><span id="exnDmdEnv"><span class="annot"><span class="annottext">exnDmdEnv :: DmdEnv
</span><a href="GHC.Types.Demand.html#exnDmdEnv"><span class="hs-identifier hs-var hs-var">exnDmdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#mkEmptyDmdEnv"><span class="hs-identifier hs-var">mkEmptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier hs-var">exnDiv</span></a></span><span>
</span><span id="line-1767"></span><span>
</span><span id="line-1768"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDmdEnv"><span class="hs-identifier hs-type">lubDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1769"></span><span id="lubDmdEnv"><span class="annot"><span class="annottext">lubDmdEnv :: DmdEnv -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#lubDmdEnv"><span class="hs-identifier hs-var hs-var">lubDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601210"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601210"><span class="hs-identifier hs-var">fv1</span></a></span></span><span> </span><span id="local-6989586621681601211"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601211"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601212"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601212"><span class="hs-identifier hs-var">fv2</span></a></span></span><span> </span><span id="local-6989586621681601213"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601213"><span class="hs-identifier hs-var">d2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601214"><span class="hs-identifier hs-var">lub_fv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601215"><span class="hs-identifier hs-var">lub_div</span></a></span><span>
</span><span id="line-1770"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1771"></span><span>    </span><span class="hs-comment">-- See Note [Demand env Equality]</span><span>
</span><span id="line-1772"></span><span>    </span><span id="local-6989586621681601214"><span class="annot"><span class="annottext">lub_fv :: VarEnv Demand
</span><a href="#local-6989586621681601214"><span class="hs-identifier hs-var hs-var">lub_fv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Demand -&gt; Demand)
-&gt; VarEnv Demand
-&gt; Demand
-&gt; VarEnv Demand
-&gt; Demand
-&gt; VarEnv Demand
forall a.
(a -&gt; a -&gt; a) -&gt; VarEnv a -&gt; a -&gt; VarEnv a -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#plusVarEnv_CD"><span class="hs-identifier hs-var">plusVarEnv_CD</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601210"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601211"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601212"><span class="hs-identifier hs-var">fv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601213"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1773"></span><span>    </span><span id="local-6989586621681601215"><span class="annot"><span class="annottext">lub_div :: Divergence
</span><a href="#local-6989586621681601215"><span class="hs-identifier hs-var hs-var">lub_div</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601211"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601213"><span class="hs-identifier hs-var">d2</span></a></span><span>
</span><span id="line-1774"></span><span>
</span><span id="line-1775"></span><span class="annot"><a href="GHC.Types.Demand.html#addVarDmdEnv"><span class="hs-identifier hs-type">addVarDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1776"></span><span id="addVarDmdEnv"><span class="annot"><span class="annottext">addVarDmdEnv :: DmdEnv -&gt; Id -&gt; Demand -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#addVarDmdEnv"><span class="hs-identifier hs-var hs-var">addVarDmdEnv</span></a></span></span><span> </span><span id="local-6989586621681601217"><span class="annot"><span class="annottext">env :: DmdEnv
</span><a href="#local-6989586621681601217"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601218"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601218"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681601219"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601219"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601220"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601220"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681601221"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601221"><span class="hs-identifier hs-var">dmd</span></a></span></span><span>
</span><span id="line-1777"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Id -&gt; Demand -&gt; VarEnv Demand
forall a. VarEnv a -&gt; Id -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601218"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601220"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601221"><span class="hs-identifier hs-var">dmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-operator hs-var">`plusDmd`</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; Id -&gt; Demand
</span><a href="GHC.Types.Demand.html#lookupDmdEnv"><span class="hs-identifier hs-var">lookupDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601217"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601220"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601219"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-1778"></span><span>
</span><span id="line-1779"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdEnv"><span class="hs-identifier hs-type">plusDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1780"></span><span id="plusDmdEnv"><span class="annot"><span class="annottext">plusDmdEnv :: DmdEnv -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#plusDmdEnv"><span class="hs-identifier hs-var hs-var">plusDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601224"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601224"><span class="hs-identifier hs-var">fv1</span></a></span></span><span> </span><span id="local-6989586621681601225"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601225"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601226"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601226"><span class="hs-identifier hs-var">fv2</span></a></span></span><span> </span><span id="local-6989586621681601227"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601227"><span class="hs-identifier hs-var">d2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1781"></span><span>  </span><span class="hs-comment">-- In contrast to Note [Asymmetry of plusDmdType], this function is symmetric.</span><span>
</span><span id="line-1782"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Bool
forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601226"><span class="hs-identifier hs-var">fv2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601227"><span class="hs-identifier hs-var">d2</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span>
</span><span id="line-1783"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601224"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601225"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-operator hs-var">`plusDivergence`</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601227"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- a very common case that is much more efficient</span><span>
</span><span id="line-1784"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Bool
forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601224"><span class="hs-identifier hs-var">fv1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601225"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span>
</span><span id="line-1785"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601226"><span class="hs-identifier hs-var">fv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601225"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-operator hs-var">`plusDivergence`</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601227"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- another very common case that is much more efficient</span><span>
</span><span id="line-1786"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1787"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand -&gt; Demand)
-&gt; VarEnv Demand
-&gt; Demand
-&gt; VarEnv Demand
-&gt; Demand
-&gt; VarEnv Demand
forall a.
(a -&gt; a -&gt; a) -&gt; VarEnv a -&gt; a -&gt; VarEnv a -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#plusVarEnv_CD"><span class="hs-identifier hs-var">plusVarEnv_CD</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601224"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601225"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601226"><span class="hs-identifier hs-var">fv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601227"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1788"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601225"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-operator hs-var">`plusDivergence`</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601227"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1789"></span><span>
</span><span id="line-1790"></span><span class="annot"><span class="hs-comment">-- | 'DmdEnv' is a monoid via 'plusDmdEnv' and 'nopDmdEnv'; this is its 'msum'</span></span><span>
</span><span id="line-1791"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdEnvs"><span class="hs-identifier hs-type">plusDmdEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1792"></span><span id="plusDmdEnvs"><span class="annot"><span class="annottext">plusDmdEnvs :: [DmdEnv] -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#plusDmdEnvs"><span class="hs-identifier hs-var hs-var">plusDmdEnvs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier hs-var">nopDmdEnv</span></a></span><span>
</span><span id="line-1793"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdEnvs"><span class="hs-identifier hs-var">plusDmdEnvs</span></a></span><span> </span><span id="local-6989586621681601229"><span class="annot"><span class="annottext">[DmdEnv]
</span><a href="#local-6989586621681601229"><span class="hs-identifier hs-var">pdas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DmdEnv -&gt; DmdEnv -&gt; DmdEnv) -&gt; [DmdEnv] -&gt; DmdEnv
forall a. HasCallStack =&gt; (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.List.html#foldl1%27/GHC.List.html#foldl1%27"><span class="hs-identifier hs-var">foldl1'</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#plusDmdEnv"><span class="hs-identifier hs-var">plusDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[DmdEnv]
</span><a href="#local-6989586621681601229"><span class="hs-identifier hs-var">pdas</span></a></span><span>
</span><span id="line-1794"></span><span>
</span><span id="line-1795"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-type">multDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1796"></span><span id="multDmdEnv"><span class="annot"><span class="annottext">multDmdEnv :: Card -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var hs-var">multDmdEnv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span id="local-6989586621681601232"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601232"><span class="hs-identifier hs-var">env</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601232"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1797"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var">multDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier hs-var">nopDmdEnv</span></a></span><span>
</span><span id="line-1798"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var">multDmdEnv</span></a></span><span> </span><span id="local-6989586621681601233"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601233"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601234"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601234"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681601235"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601235"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; VarEnv Demand -&gt; VarEnv Demand
forall a b. (a -&gt; b) -&gt; VarEnv a -&gt; VarEnv b
</span><a href="GHC.Types.Var.Env.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601233"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601234"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-var">multDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601233"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601235"><span class="hs-identifier hs-var">div</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1799"></span><span>
</span><span id="line-1800"></span><span class="annot"><a href="GHC.Types.Demand.html#reuseEnv"><span class="hs-identifier hs-type">reuseEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1801"></span><span id="reuseEnv"><span class="annot"><span class="annottext">reuseEnv :: DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#reuseEnv"><span class="hs-identifier hs-var hs-var">reuseEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var">multDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-1802"></span><span>
</span><span id="line-1803"></span><span class="annot"><a href="GHC.Types.Demand.html#lookupDmdEnv"><span class="hs-identifier hs-type">lookupDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1804"></span><span class="hs-comment">-- See Note [Default demand on free variables and arguments]</span><span>
</span><span id="line-1805"></span><span id="lookupDmdEnv"><span class="annot"><span class="annottext">lookupDmdEnv :: DmdEnv -&gt; Id -&gt; Demand
</span><a href="GHC.Types.Demand.html#lookupDmdEnv"><span class="hs-identifier hs-var hs-var">lookupDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601237"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601237"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601238"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601238"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601239"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601239"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Id -&gt; Maybe Demand
forall a. VarEnv a -&gt; Id -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601237"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601239"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Demand -&gt; Demand -&gt; Demand
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601238"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-1806"></span><span>
</span><span id="line-1807"></span><span class="annot"><a href="GHC.Types.Demand.html#delDmdEnv"><span class="hs-identifier hs-type">delDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1808"></span><span id="delDmdEnv"><span class="annot"><span class="annottext">delDmdEnv :: DmdEnv -&gt; Id -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#delDmdEnv"><span class="hs-identifier hs-var hs-var">delDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601242"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601242"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601243"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601243"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601244"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601244"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601242"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Id -&gt; VarEnv Demand
forall a. VarEnv a -&gt; Id -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#delVarEnv"><span class="hs-operator hs-var">`delVarEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601244"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601243"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-1809"></span><span>
</span><span id="line-1810"></span><span class="hs-comment">-- | Characterises how an expression</span><span>
</span><span id="line-1811"></span><span class="hs-comment">--</span><span>
</span><span id="line-1812"></span><span class="hs-comment">--    * Evaluates its free variables ('dt_env') including divergence info</span><span>
</span><span id="line-1813"></span><span class="hs-comment">--    * Evaluates its arguments ('dt_args')</span><span>
</span><span id="line-1814"></span><span class="hs-comment">--</span><span>
</span><span id="line-1815"></span><span class="hs-keyword">data</span><span> </span><span id="DmdType"><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span></span><span>
</span><span id="line-1816"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DmdType"><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span></span><span>
</span><span id="line-1817"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dt_env"><span class="annot"><span class="annottext">DmdType -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#dt_env"><span class="hs-identifier hs-var hs-var">dt_env</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>     </span><span class="hs-comment">-- ^ Demands on free variables.</span><span>
</span><span id="line-1818"></span><span>                           </span><span class="hs-comment">-- See Note [Demand type Divergence]</span><span>
</span><span id="line-1819"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dt_args"><span class="annot"><span class="annottext">DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var hs-var">dt_args</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span>   </span><span class="annot"><span class="hs-comment">-- ^ Demand on arguments</span></span><span>
</span><span id="line-1820"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1821"></span><span>
</span><span id="line-1822"></span><span class="annot"><span class="hs-comment">-- | See Note [Demand env Equality].</span></span><span>
</span><span id="line-1823"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601250"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1824"></span><span>  </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601254"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601254"><span class="hs-identifier hs-var">env1</span></a></span></span><span> </span><span id="local-6989586621681601255"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601255"><span class="hs-identifier hs-var">ds1</span></a></span></span><span> </span><span id="local-6989586621681601256"><span class="annot"><span class="annottext">== :: DmdType -&gt; DmdType -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601257"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601257"><span class="hs-identifier hs-var">env2</span></a></span></span><span> </span><span id="local-6989586621681601258"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601258"><span class="hs-identifier hs-var">ds2</span></a></span></span><span>
</span><span id="line-1825"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601255"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [Demand] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601258"><span class="hs-identifier hs-var">ds2</span></a></span><span> </span><span class="hs-comment">-- cheap checks first</span><span>
</span><span id="line-1826"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601254"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; DmdEnv -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601257"><span class="hs-identifier hs-var">env2</span></a></span><span>
</span><span id="line-1827"></span><span>
</span><span id="line-1828"></span><span class="hs-comment">-- | Compute the least upper bound of two 'DmdType's elicited /by the same</span><span>
</span><span id="line-1829"></span><span class="hs-comment">-- incoming demand/!</span><span>
</span><span id="line-1830"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier hs-type">lubDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1831"></span><span id="lubDmdType"><span class="annot"><span class="annottext">lubDmdType :: DmdType -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier hs-var hs-var">lubDmdType</span></a></span></span><span> </span><span id="local-6989586621681601259"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601259"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span id="local-6989586621681601260"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601260"><span class="hs-identifier hs-var">d2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601261"><span class="hs-identifier hs-var">lub_fv</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601262"><span class="hs-identifier hs-var">lub_ds</span></a></span><span>
</span><span id="line-1832"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1833"></span><span>    </span><span id="local-6989586621681601263"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621681601263"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601259"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601260"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1834"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601265"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601265"><span class="hs-identifier hs-var">fv1</span></a></span></span><span> </span><span id="local-6989586621681601266"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601266"><span class="hs-identifier hs-var">ds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601263"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601259"><span class="hs-identifier hs-var">d1</span></a></span><span>
</span><span id="line-1835"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601268"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601268"><span class="hs-identifier hs-var">fv2</span></a></span></span><span> </span><span id="local-6989586621681601269"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601269"><span class="hs-identifier hs-var">ds2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601263"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601260"><span class="hs-identifier hs-var">d2</span></a></span><span>
</span><span id="line-1836"></span><span>    </span><span id="local-6989586621681601262"><span class="annot"><span class="annottext">lub_ds :: [Demand]
</span><a href="#local-6989586621681601262"><span class="hs-identifier hs-var hs-var">lub_ds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Demand -&gt; Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand] -&gt; [Demand]
forall a b c.
HasDebugCallStack =&gt;
String -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lubDmdType&quot;</span></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601266"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601269"><span class="hs-identifier hs-var">ds2</span></a></span><span>
</span><span id="line-1837"></span><span>    </span><span id="local-6989586621681601261"><span class="annot"><span class="annottext">lub_fv :: DmdEnv
</span><a href="#local-6989586621681601261"><span class="hs-identifier hs-var hs-var">lub_fv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#lubDmdEnv"><span class="hs-identifier hs-var">lubDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601265"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601268"><span class="hs-identifier hs-var">fv2</span></a></span><span>
</span><span id="line-1838"></span><span>
</span><span id="line-1839"></span><span class="annot"><a href="GHC.Types.Demand.html#discardArgDmds"><span class="hs-identifier hs-type">discardArgDmds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1840"></span><span id="discardArgDmds"><span class="annot"><span class="annottext">discardArgDmds :: DmdType -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#discardArgDmds"><span class="hs-identifier hs-var hs-var">discardArgDmds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601271"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601271"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601271"><span class="hs-identifier hs-var">fv</span></a></span><span>
</span><span id="line-1841"></span><span>
</span><span id="line-1842"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdType"><span class="hs-identifier hs-type">plusDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1843"></span><span id="plusDmdType"><span class="annot"><span class="annottext">plusDmdType :: DmdType -&gt; DmdEnv -&gt; DmdType
</span><a href="GHC.Types.Demand.html#plusDmdType"><span class="hs-identifier hs-var hs-var">plusDmdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601272"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601272"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601273"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601273"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601274"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601274"><span class="hs-identifier hs-var">fv'</span></a></span></span><span>
</span><span id="line-1844"></span><span>  </span><span class="hs-comment">-- See Note [Asymmetry of plusDmdType]</span><span>
</span><span id="line-1845"></span><span>  </span><span class="hs-comment">-- 'DmdEnv' forms a (monoidal) action on 'DmdType' via this operation.</span><span>
</span><span id="line-1846"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#plusDmdEnv"><span class="hs-identifier hs-var">plusDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601272"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601274"><span class="hs-identifier hs-var">fv'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601273"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1847"></span><span>
</span><span id="line-1848"></span><span class="annot"><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier hs-type">botDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1849"></span><span id="botDmdType"><span class="annot"><span class="annottext">botDmdType :: DmdType
</span><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier hs-var hs-var">botDmdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#botDmdEnv"><span class="hs-identifier hs-var">botDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1850"></span><span>
</span><span id="line-1851"></span><span class="hs-comment">-- | The demand type of doing nothing (lazy, absent, no Divergence</span><span>
</span><span id="line-1852"></span><span class="hs-comment">-- information). Note that it is ''not'' the top of the lattice (which would be</span><span>
</span><span id="line-1853"></span><span class="hs-comment">-- &quot;may use everything&quot;), so it is (no longer) called topDmdType.</span><span>
</span><span id="line-1854"></span><span class="annot"><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-type">nopDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1855"></span><span id="nopDmdType"><span class="annot"><span class="annottext">nopDmdType :: DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var hs-var">nopDmdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier hs-var">nopDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1856"></span><span>
</span><span id="line-1857"></span><span class="hs-comment">-- | The demand type of an unspecified expression that is guaranteed to</span><span>
</span><span id="line-1858"></span><span class="hs-comment">-- throw a (precise or imprecise) exception or diverge.</span><span>
</span><span id="line-1859"></span><span class="annot"><a href="GHC.Types.Demand.html#exnDmdType"><span class="hs-identifier hs-type">exnDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1860"></span><span id="exnDmdType"><span class="annot"><span class="annottext">exnDmdType :: DmdType
</span><a href="GHC.Types.Demand.html#exnDmdType"><span class="hs-identifier hs-var hs-var">exnDmdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#exnDmdEnv"><span class="hs-identifier hs-var">exnDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1861"></span><span>
</span><span id="line-1862"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-type">dmdTypeDepth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span>
</span><span id="line-1863"></span><span id="dmdTypeDepth"><span class="annot"><span class="annottext">dmdTypeDepth :: DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var hs-var">dmdTypeDepth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([Demand] -&gt; Int) -&gt; (DmdType -&gt; [Demand]) -&gt; DmdType -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span>
</span><span id="line-1864"></span><span>
</span><span id="line-1865"></span><span class="hs-comment">-- | This makes sure we can use the demand type with n arguments after eta</span><span>
</span><span id="line-1866"></span><span class="hs-comment">-- expansion, where n must not be lower than the demand types depth.</span><span>
</span><span id="line-1867"></span><span class="hs-comment">-- It appends the argument list with the correct 'defaultArgDmd'.</span><span>
</span><span id="line-1868"></span><span class="annot"><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-type">etaExpandDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1869"></span><span id="etaExpandDmdType"><span class="annot"><span class="annottext">etaExpandDmdType :: Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var hs-var">etaExpandDmdType</span></a></span></span><span> </span><span id="local-6989586621681601276"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601276"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601277"><span class="annot"><span class="annottext">d :: DmdType
</span><a href="#local-6989586621681601277"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_args :: DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681601278"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601278"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_env :: DmdType -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#dt_env"><span class="hs-identifier hs-var">dt_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681601279"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601279"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-1870"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601276"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601280"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601277"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1871"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601276"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span>  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601280"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601277"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681601282"><span class="hs-identifier hs-type">inc_ds</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1872"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DmdType
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;etaExpandDmdType: arity decrease&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601276"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601277"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1873"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681601280"><span class="annot"><span class="annottext">depth :: Int
</span><a href="#local-6989586621681601280"><span class="hs-identifier hs-var hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601278"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1874"></span><span>        </span><span class="hs-comment">-- Arity increase:</span><span>
</span><span id="line-1875"></span><span>        </span><span class="hs-comment">--  * Demands on FVs are still valid</span><span>
</span><span id="line-1876"></span><span>        </span><span class="hs-comment">--  * Demands on args also valid, plus we can extend with defaultArgDmd</span><span>
</span><span id="line-1877"></span><span>        </span><span class="hs-comment">--    as appropriate for the given Divergence</span><span>
</span><span id="line-1878"></span><span>        </span><span class="hs-comment">--  * Divergence is still valid:</span><span>
</span><span id="line-1879"></span><span>        </span><span class="hs-comment">--    - A dead end after 2 arguments stays a dead end after 3 arguments</span><span>
</span><span id="line-1880"></span><span>        </span><span class="hs-comment">--    - The remaining case is Dunno, which is already topDiv</span><span>
</span><span id="line-1881"></span><span>        </span><span id="local-6989586621681601282"><span class="annot"><span class="annottext">inc_ds :: [Demand]
</span><a href="#local-6989586621681601282"><span class="hs-identifier hs-var hs-var">inc_ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Demand] -&gt; [Demand]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#take/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601276"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601278"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [Demand] -&gt; [Demand]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; [Demand]
forall a. a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#repeat/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; Divergence
</span><a href="GHC.Types.Demand.html#de_div"><span class="hs-identifier hs-var">de_div</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601279"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1882"></span><span>
</span><span id="line-1883"></span><span class="hs-comment">-- | A conservative approximation for a given 'DmdType' in case of an arity</span><span>
</span><span id="line-1884"></span><span class="hs-comment">-- decrease. Currently, it's just nopDmdType.</span><span>
</span><span id="line-1885"></span><span class="annot"><a href="GHC.Types.Demand.html#decreaseArityDmdType"><span class="hs-identifier hs-type">decreaseArityDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1886"></span><span id="decreaseArityDmdType"><span class="annot"><span class="annottext">decreaseArityDmdType :: DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#decreaseArityDmdType"><span class="hs-identifier hs-var hs-var">decreaseArityDmdType</span></a></span></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span>
</span><span id="line-1887"></span><span>
</span><span id="line-1888"></span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier hs-type">splitDmdTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1889"></span><span class="hs-comment">-- Split off one function argument</span><span>
</span><span id="line-1890"></span><span class="hs-comment">-- We already have a suitable demand on all</span><span>
</span><span id="line-1891"></span><span class="hs-comment">-- free vars, so no need to add more!</span><span>
</span><span id="line-1892"></span><span id="splitDmdTy"><span class="annot"><span class="annottext">splitDmdTy :: DmdType -&gt; (Demand, DmdType)
</span><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier hs-var hs-var">splitDmdTy</span></a></span></span><span> </span><span id="local-6989586621681601287"><span class="annot"><span class="annottext">ty :: DmdType
</span><a href="#local-6989586621681601287"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_args :: DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681601288"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601288"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681601289"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601289"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601288"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601287"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="#local-6989586621681601289"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1893"></span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier hs-var">splitDmdTy</span></a></span><span> </span><span id="local-6989586621681601290"><span class="annot"><span class="annottext">ty :: DmdType
</span><a href="#local-6989586621681601290"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_env :: DmdType -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#dt_env"><span class="hs-identifier hs-var">dt_env</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681601291"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601291"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; Divergence
</span><a href="GHC.Types.Demand.html#de_div"><span class="hs-identifier hs-var">de_div</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601291"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601290"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span>
</span><span id="line-1895"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-type">multDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1896"></span><span id="multDmdType"><span class="annot"><span class="annottext">multDmdType :: Card -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-var hs-var">multDmdType</span></a></span></span><span> </span><span id="local-6989586621681601292"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601292"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601293"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601293"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601294"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601294"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1897"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;multDmdType&quot; (ppr n $$ ppr fv $$ ppr (multDmdEnv n fv)) $</span><span>
</span><span id="line-1898"></span><span>    </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var">multDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601292"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601293"><span class="hs-identifier hs-var">fv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1899"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601292"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601294"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span class="annot"><a href="GHC.Types.Demand.html#peelFV"><span class="hs-identifier hs-type">peelFV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1902"></span><span id="peelFV"><span class="annot"><span class="annottext">peelFV :: DmdType -&gt; Id -&gt; (DmdType, Demand)
</span><a href="GHC.Types.Demand.html#peelFV"><span class="hs-identifier hs-var hs-var">peelFV</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601296"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601296"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601297"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601297"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601298"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601298"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;rfv&quot; (ppr id &lt;+&gt; ppr dmd $$ ppr fv)</span><span>
</span><span id="line-1903"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601299"><span class="hs-identifier hs-var">fv'</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601297"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601300"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1904"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1905"></span><span>  </span><span class="hs-comment">-- Force these arguments so that old `Env` is not retained.</span><span>
</span><span id="line-1906"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681601299"><span class="annot"><span class="annottext">fv' :: DmdEnv
</span><a href="#local-6989586621681601299"><span class="hs-identifier hs-var hs-var">fv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601296"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; Id -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#delDmdEnv"><span class="hs-operator hs-var">`delDmdEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601298"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1907"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681601300"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621681601300"><span class="hs-identifier hs-var hs-var">dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; Id -&gt; Demand
</span><a href="GHC.Types.Demand.html#lookupDmdEnv"><span class="hs-identifier hs-var">lookupDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601296"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601298"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1908"></span><span>
</span><span id="line-1909"></span><span class="annot"><a href="GHC.Types.Demand.html#addDemand"><span class="hs-identifier hs-type">addDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1910"></span><span id="addDemand"><span class="annot"><span class="annottext">addDemand :: Demand -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#addDemand"><span class="hs-identifier hs-var hs-var">addDemand</span></a></span></span><span> </span><span id="local-6989586621681601301"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601301"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601302"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601302"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601303"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601303"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601302"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601301"><span class="hs-identifier hs-var">dmd</span></a></span><span class="annot"><span class="annottext">Demand -&gt; [Demand] -&gt; [Demand]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601303"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1911"></span><span>
</span><span id="line-1912"></span><span class="annot"><a href="GHC.Types.Demand.html#findIdDemand"><span class="hs-identifier hs-type">findIdDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1913"></span><span id="findIdDemand"><span class="annot"><span class="annottext">findIdDemand :: DmdType -&gt; Id -&gt; Demand
</span><a href="GHC.Types.Demand.html#findIdDemand"><span class="hs-identifier hs-var hs-var">findIdDemand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601304"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601304"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601305"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601305"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; Id -&gt; Demand
</span><a href="GHC.Types.Demand.html#lookupDmdEnv"><span class="hs-identifier hs-var">lookupDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601304"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681601305"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1914"></span><span>
</span><span id="line-1915"></span><span class="hs-comment">-- | When e is evaluated after executing an IO action that may throw a precise</span><span>
</span><span id="line-1916"></span><span class="hs-comment">-- exception, we act as if there is an additional control flow path that is</span><span>
</span><span id="line-1917"></span><span class="hs-comment">-- taken if e throws a precise exception. The demand type of this control flow</span><span>
</span><span id="line-1918"></span><span class="hs-comment">-- path</span><span>
</span><span id="line-1919"></span><span class="hs-comment">--   * is lazy and absent ('topDmd') and boxed in all free variables and arguments</span><span>
</span><span id="line-1920"></span><span class="hs-comment">--   * has 'exnDiv' 'Divergence' result</span><span>
</span><span id="line-1921"></span><span class="hs-comment">-- See Note [Precise exceptions and strictness analysis]</span><span>
</span><span id="line-1922"></span><span class="hs-comment">--</span><span>
</span><span id="line-1923"></span><span class="hs-comment">-- So we can simply take a variant of 'nopDmdType', 'exnDmdType'.</span><span>
</span><span id="line-1924"></span><span class="hs-comment">-- Why not 'nopDmdType'? Because then the result of 'e' can never be 'exnDiv'!</span><span>
</span><span id="line-1925"></span><span class="hs-comment">-- That means failure to drop dead-ends, see #18086.</span><span>
</span><span id="line-1926"></span><span class="annot"><a href="GHC.Types.Demand.html#deferAfterPreciseException"><span class="hs-identifier hs-type">deferAfterPreciseException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1927"></span><span id="deferAfterPreciseException"><span class="annot"><span class="annottext">deferAfterPreciseException :: DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#deferAfterPreciseException"><span class="hs-identifier hs-var hs-var">deferAfterPreciseException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier hs-var">lubDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#exnDmdType"><span class="hs-identifier hs-var">exnDmdType</span></a></span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span class="hs-comment">{- Note [deferAfterPreciseException]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The big picture is in Note [Precise exceptions and strictness analysis]
The idea is that we want to treat
   case &lt;I/O operation&gt; of (# s', r #) -&gt; rhs

as if it was
   case &lt;I/O operation&gt; of
      Just (# s', r #) -&gt; rhs
      Nothing          -&gt; error

That is, the I/O operation might throw an exception, so that 'rhs' never
gets reached.  For example, we don't want to be strict in the strict free
variables of 'rhs'.

So we have the simple definition
  deferAfterPreciseException = lubDmdType (DmdType emptyDmdEnv [] exnDiv)

Historically, when we had `lubBoxity = _unboxedWins` (see Note [unboxedWins]),
we had a more complicated definition for deferAfterPreciseException to make sure
it preserved boxity in its argument. That was needed for code like
   case &lt;I/O operation&gt; of
      (# s', r) -&gt; f x

which uses `x` *boxed*. If we `lub`bed it with `(DmdType emptyDmdEnv [] exnDiv)`
we'd get an *unboxed* demand on `x` (because we let Unboxed win),
which led to #20746.  Nowadays with `lubBoxity = boxedWins` we don't need
the complicated definition.

Note [Demand type Divergence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In contrast to DmdSigs, DmdTypes are elicited under a specific incoming demand.
This is described in detail in Note [Understanding DmdType and DmdSig].
Here, we'll focus on what that means for a DmdType's Divergence in a higher-order
scenario.

Consider
  err x y = x `seq` y `seq` error (show x)
this has a strictness signature of
  &lt;1L&gt;&lt;1L&gt;b
meaning that we don't know what happens when we call err in weaker contexts than
C(1,C(1,L)), like @err `seq` ()@ (1A) and @err 1 `seq` ()@ (C(S,A)). We
may not unleash the botDiv, hence assume topDiv. Of course, in
@err 1 2 `seq` ()@ the incoming demand C(S,C(S,A)) is strong enough and we see
that the expression diverges.

Now consider a function
  f g = g 1 2
with signature &lt;C(1,C(1,L))&gt;, and the expression
  f err `seq` ()
now f puts a strictness demand of C(1,C(1,L)) onto its argument, which is unleashed
on err via the App rule. In contrast to weaker head strictness, this demand is
strong enough to unleash err's signature and hence we see that the whole
expression diverges!

Note [Demand env Equality]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
What is the difference between the Demand env {x-&gt;A} and {}?
Answer: There is none! They have the exact same semantics, because any var that
is not mentioned in 'de_fvs' implicitly has demand 'defaultFvDmd', based on
the divergence of the demand env 'de_div'.
Similarly, b{x-&gt;B, y-&gt;A} is the same as b{y-&gt;A}, because the default FV
demand of BotDiv is B. But neither is equal to b{}, because y has demand B in
the latter, not A as before.

The Eq instance of DmdEnv must reflect that, otherwise we can get into monotonicity
issues during fixed-point iteration ({x-&gt;A} /= {} /= {x-&gt;A} /= ...).
It does so by filtering out any default FV demands prior to comparing 'de_fvs'.

Note that 'lubDmdEnv' maintains this kind of equality by using 'plusVarEnv_CD',
involving 'defaultFvDmd' for any entries present in one 'de_fvs' but not the
other.

Note [Asymmetry of plusDmdType]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
'plus' for DmdTypes is *asymmetrical*, because there can only one
be one type contributing argument demands!  For example, given (e1 e2), we get
a DmdType dt1 for e1, use its arg demand to analyse e2 giving dt2, and then do
(dt1 `plusType` dt2). Similarly with
  case e of { p -&gt; rhs }
we get dt_scrut from the scrutinee and dt_rhs from the RHS, and then
compute (dt_rhs `plusType` dt_scrut).

We
 1. combine the information on the free variables,
 2. take the demand on arguments from the first argument
 3. combine the termination results, as in plusDivergence.

Since we don't use argument demands of the second argument anyway, 'plus's
second argument is just a 'PlusDmdType'.

But note that the argument demand types are not guaranteed to be observed in
left to right order. For example, analysis of a case expression will pass the
demand type for the alts as the left argument and the type for the scrutinee as
the right argument. Also, it is not at all clear if there is such an order;
consider the LetUp case, where the RHS might be forced at any point while
evaluating the let body.
Therefore, it is crucial that 'plusDivergence' is symmetric!

Note [Demands from unsaturated function calls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a demand transformer d1 -&gt; d2 -&gt; r for f.
If a sufficiently detailed demand is fed into this transformer,
e.g &lt;C(1,C(1,L))&gt; arising from &quot;f x1 x2&quot; in a strict, use-once context,
then d1 and d2 is precisely the demand unleashed onto x1 and x2 (similar for
the free variable environment) and furthermore the result information r is the
one we want to use.

An anonymous lambda is also an unsaturated function all (needs one argument,
none given), so this applies to that case as well.

But the demand fed into f might be less than C(1,C(1,L)). Then we have to
'multDmdType' the announced demand type. Examples:
 * Not strict enough, e.g. C(1,C(1,L)):
   - We have to multiply all argument and free variable demands with C_01,
     zapping strictness.
   - We have to multiply divergence with C_01. If r says that f Diverges for sure,
     then this holds when the demand guarantees that two arguments are going to
     be passed. If the demand is lower, we may just as well converge.
     If we were tracking definite convergence, than that would still hold under
     a weaker demand than expected by the demand transformer.
 * Used more than once, e.g. C(S,C(1,L)):
   - Multiply with C_1N. Even if f puts a used-once demand on any of its argument
     or free variables, if we call f multiple times, we may evaluate this
     argument or free variable multiple times.

In dmdTransformSig, we call peelManyCalls to find out the 'Card'inality with
which we have to multiply and then call multDmdType with that.

Similarly, dmdTransformDictSelSig and dmdAnal, when analyzing a Lambda, use
peelCallDmd, which peels only one level, but also returns the demand put on the
body of the function.
-}</span><span>
</span><span id="line-2062"></span><span>
</span><span id="line-2063"></span><span>
</span><span id="line-2064"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Demand signatures
*                                                                      *
************************************************************************

In a let-bound Id we record its demand signature.
In principle, this demand signature is a demand transformer, mapping
a demand on the Id into a DmdType, which gives
        a) the free vars of the Id's value
        b) the Id's arguments
        c) an indication of the result of applying
           the Id to its arguments

However, in fact we store in the Id an extremely emasculated demand
transformer, namely

                a single DmdType
(Nevertheless we dignify DmdSig as a distinct type.)

This DmdType gives the demands unleashed by the Id when it is applied
to as many arguments as are given in by the arg demands in the DmdType.
Also see Note [Demand type Divergence] for the meaning of a Divergence in a
strictness signature.

If an Id is applied to less arguments than its arity, it means that
the demand on the function at a call site is weaker than the vanilla
call demand, used for signature inference. Therefore we place a top
demand on all arguments. Otherwise, the demand is specified by Id's
signature.

For example, the demand transformer described by the demand signature
        DmdSig (DmdType {x -&gt; &lt;1L&gt;} &lt;A&gt;&lt;1P(L,L)&gt;)
says that when the function is applied to two arguments, it
unleashes demand 1L on the free var x, A on the first arg,
and 1P(L,L) on the second.

If this same function is applied to one arg, all we can say is that it
uses x with 1L, and its arg with demand 1P(L,L).

Note [Understanding DmdType and DmdSig]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Demand types are sound approximations of an expression's semantics relative to
the incoming demand we put the expression under. Consider the following
expression:

    \x y -&gt; x `seq` (y, 2*x)

Here is a table with demand types resulting from different incoming demands we
put that expression under. Note the monotonicity; a stronger incoming demand
yields a more precise demand type:

    incoming demand   |  demand type
    --------------------------------
    1A                  |  &lt;L&gt;&lt;L&gt;{}
    C(1,C(1,L))           |  &lt;1P(L)&gt;&lt;L&gt;{}
    C(1,C(1,1P(1P(L),A))) |  &lt;1P(A)&gt;&lt;A&gt;{}

Note that in the first example, the depth of the demand type was *higher* than
the arity of the incoming call demand due to the anonymous lambda.
The converse is also possible and happens when we unleash demand signatures.
In @f x y@, the incoming call demand on f has arity 2. But if all we have is a
demand signature with depth 1 for @f@ (which we can safely unleash, see below),
the demand type of @f@ under a call demand of arity 2 has a *lower* depth of 1.

So: Demand types are elicited by putting an expression under an incoming (call)
demand, the arity of which can be lower or higher than the depth of the
resulting demand type.
In contrast, a demand signature summarises a function's semantics *without*
immediately specifying the incoming demand it was produced under. Despite StrSig
being a newtype wrapper around DmdType, it actually encodes two things:

  * The threshold (i.e., minimum arity) to unleash the signature
  * A demand type that is sound to unleash when the minimum arity requirement is
    met.

Here comes the subtle part: The threshold is encoded in the wrapped demand
type's depth! So in mkDmdSigForArity we make sure to trim the list of
argument demands to the given threshold arity. Call sites will make sure that
this corresponds to the arity of the call demand that elicited the wrapped
demand type. See also Note [What are demand signatures?].
-}</span><span>
</span><span id="line-2147"></span><span>
</span><span id="line-2148"></span><span class="hs-comment">-- | The depth of the wrapped 'DmdType' encodes the arity at which it is safe</span><span>
</span><span id="line-2149"></span><span class="hs-comment">-- to unleash. Better construct this through 'mkDmdSigForArity'.</span><span>
</span><span id="line-2150"></span><span class="hs-comment">-- See Note [Understanding DmdType and DmdSig]</span><span>
</span><span id="line-2151"></span><span class="hs-keyword">newtype</span><span> </span><span id="DmdSig"><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span></span><span>
</span><span id="line-2152"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DmdSig"><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-2153"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621681601307"><span id="local-6989586621681601311"><span class="annot"><span class="annottext">DmdSig -&gt; DmdSig -&gt; Bool
(DmdSig -&gt; DmdSig -&gt; Bool)
-&gt; (DmdSig -&gt; DmdSig -&gt; Bool) -&gt; Eq DmdSig
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: DmdSig -&gt; DmdSig -&gt; Bool
== :: DmdSig -&gt; DmdSig -&gt; Bool
$c/= :: DmdSig -&gt; DmdSig -&gt; Bool
/= :: DmdSig -&gt; DmdSig -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-2154"></span><span>
</span><span id="line-2155"></span><span class="hs-comment">-- | Turns a 'DmdType' computed for the particular 'Arity' into a 'DmdSig'</span><span>
</span><span id="line-2156"></span><span class="hs-comment">-- unleashable at that arity. See Note [Understanding DmdType and DmdSig].</span><span>
</span><span id="line-2157"></span><span class="annot"><a href="GHC.Types.Demand.html#mkDmdSigForArity"><span class="hs-identifier hs-type">mkDmdSigForArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2158"></span><span id="mkDmdSigForArity"><span class="annot"><span class="annottext">mkDmdSigForArity :: Int -&gt; DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#mkDmdSigForArity"><span class="hs-identifier hs-var hs-var">mkDmdSigForArity</span></a></span></span><span> </span><span id="local-6989586621681601315"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601315"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621681601316"><span class="annot"><span class="annottext">dmd_ty :: DmdType
</span><a href="#local-6989586621681601316"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601317"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601317"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681601318"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601318"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2159"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601315"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601316"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdType -&gt; DmdSig) -&gt; DmdType -&gt; DmdSig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601317"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Demand] -&gt; [Demand]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#take/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601315"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601318"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601315"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601316"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span>
</span><span id="line-2162"></span><span class="annot"><a href="GHC.Types.Demand.html#mkClosedDmdSig"><span class="hs-identifier hs-type">mkClosedDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2163"></span><span id="mkClosedDmdSig"><span class="annot"><span class="annottext">mkClosedDmdSig :: [Demand] -&gt; Divergence -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#mkClosedDmdSig"><span class="hs-identifier hs-var hs-var">mkClosedDmdSig</span></a></span></span><span> </span><span id="local-6989586621681601320"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601320"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621681601321"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601321"><span class="hs-identifier hs-var">div</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#mkDmdSigForArity"><span class="hs-identifier hs-var">mkDmdSigForArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601320"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#mkEmptyDmdEnv"><span class="hs-identifier hs-var">mkEmptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601321"><span class="hs-identifier hs-var">div</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601320"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2164"></span><span>
</span><span id="line-2165"></span><span class="annot"><a href="GHC.Types.Demand.html#mkVanillaDmdSig"><span class="hs-identifier hs-type">mkVanillaDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2166"></span><span id="mkVanillaDmdSig"><span class="annot"><span class="annottext">mkVanillaDmdSig :: Int -&gt; Divergence -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#mkVanillaDmdSig"><span class="hs-identifier hs-var hs-var">mkVanillaDmdSig</span></a></span></span><span> </span><span id="local-6989586621681601322"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601322"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span id="local-6989586621681601323"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601323"><span class="hs-identifier hs-var">div</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; Divergence -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#mkClosedDmdSig"><span class="hs-identifier hs-var">mkClosedDmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Demand -&gt; [Demand]
forall a. Int -&gt; a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#replicate/GHC.List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601322"><span class="hs-identifier hs-var">ar</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601323"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdSig"><span class="hs-identifier hs-type">splitDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2169"></span><span id="splitDmdSig"><span class="annot"><span class="annottext">splitDmdSig :: DmdSig -&gt; ([Demand], Divergence)
</span><a href="GHC.Types.Demand.html#splitDmdSig"><span class="hs-identifier hs-var hs-var">splitDmdSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601324"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601324"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681601325"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601325"><span class="hs-identifier hs-var">dmds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601325"><span class="hs-identifier hs-var">dmds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; Divergence
</span><a href="GHC.Types.Demand.html#de_div"><span class="hs-identifier hs-var">de_div</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601324"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2170"></span><span>
</span><span id="line-2171"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdSigDmdEnv"><span class="hs-identifier hs-type">dmdSigDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-2172"></span><span id="dmdSigDmdEnv"><span class="annot"><span class="annottext">dmdSigDmdEnv :: DmdSig -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#dmdSigDmdEnv"><span class="hs-identifier hs-var hs-var">dmdSigDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601326"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601326"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601326"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2173"></span><span>
</span><span id="line-2174"></span><span class="annot"><a href="GHC.Types.Demand.html#hasDemandEnvSig"><span class="hs-identifier hs-type">hasDemandEnvSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2175"></span><span id="hasDemandEnvSig"><span class="annot"><span class="annottext">hasDemandEnvSig :: DmdSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#hasDemandEnvSig"><span class="hs-identifier hs-var hs-var">hasDemandEnvSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (DmdSig -&gt; Bool) -&gt; DmdSig -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Bool
forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(VarEnv Demand -&gt; Bool)
-&gt; (DmdSig -&gt; VarEnv Demand) -&gt; DmdSig -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; VarEnv Demand
</span><a href="GHC.Types.Demand.html#de_fvs"><span class="hs-identifier hs-var">de_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdEnv -&gt; VarEnv Demand)
-&gt; (DmdSig -&gt; DmdEnv) -&gt; DmdSig -&gt; VarEnv Demand
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DmdSig -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#dmdSigDmdEnv"><span class="hs-identifier hs-var">dmdSigDmdEnv</span></a></span><span>
</span><span id="line-2176"></span><span>
</span><span id="line-2177"></span><span class="annot"><a href="GHC.Types.Demand.html#botSig"><span class="hs-identifier hs-type">botSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2178"></span><span id="botSig"><span class="annot"><span class="annottext">botSig :: DmdSig
</span><a href="GHC.Types.Demand.html#botSig"><span class="hs-identifier hs-var hs-var">botSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier hs-var">botDmdType</span></a></span><span>
</span><span id="line-2179"></span><span>
</span><span id="line-2180"></span><span class="annot"><a href="GHC.Types.Demand.html#nopSig"><span class="hs-identifier hs-type">nopSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2181"></span><span id="nopSig"><span class="annot"><span class="annottext">nopSig :: DmdSig
</span><a href="GHC.Types.Demand.html#nopSig"><span class="hs-identifier hs-var hs-var">nopSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span>
</span><span id="line-2182"></span><span>
</span><span id="line-2183"></span><span class="annot"><a href="GHC.Types.Demand.html#isNopSig"><span class="hs-identifier hs-type">isNopSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2184"></span><span id="isNopSig"><span class="annot"><span class="annottext">isNopSig :: DmdSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#isNopSig"><span class="hs-identifier hs-var hs-var">isNopSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span id="local-6989586621681601327"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601327"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601327"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span>
</span><span id="line-2185"></span><span>
</span><span id="line-2186"></span><span class="hs-comment">-- | True if the signature diverges or throws an exception in a saturated call.</span><span>
</span><span id="line-2187"></span><span class="hs-comment">-- See Note [Dead ends].</span><span>
</span><span id="line-2188"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndSig"><span class="hs-identifier hs-type">isDeadEndSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2189"></span><span id="isDeadEndSig"><span class="annot"><span class="annottext">isDeadEndSig :: DmdSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndSig"><span class="hs-identifier hs-var hs-var">isDeadEndSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601328"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601328"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; Divergence
</span><a href="GHC.Types.Demand.html#de_div"><span class="hs-identifier hs-var">de_div</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601328"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2190"></span><span>
</span><span id="line-2191"></span><span class="hs-comment">-- | True if the signature diverges or throws an imprecise exception in a saturated call.</span><span>
</span><span id="line-2192"></span><span class="hs-comment">-- NB: In constrast to 'isDeadEndSig' this returns False for 'exnDiv'.</span><span>
</span><span id="line-2193"></span><span class="hs-comment">-- See Note [Dead ends]</span><span>
</span><span id="line-2194"></span><span class="hs-comment">-- and Note [Precise vs imprecise exceptions].</span><span>
</span><span id="line-2195"></span><span class="annot"><a href="GHC.Types.Demand.html#isBottomingSig"><span class="hs-identifier hs-type">isBottomingSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2196"></span><span id="isBottomingSig"><span class="annot"><span class="annottext">isBottomingSig :: DmdSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#isBottomingSig"><span class="hs-identifier hs-var hs-var">isBottomingSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601329"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601329"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; Divergence
</span><a href="GHC.Types.Demand.html#de_div"><span class="hs-identifier hs-var">de_div</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601329"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier hs-var">botDiv</span></a></span><span>
</span><span id="line-2197"></span><span>
</span><span id="line-2198"></span><span class="annot"><span class="hs-comment">-- | True when the signature indicates all arguments are boxed</span></span><span>
</span><span id="line-2199"></span><span class="annot"><a href="GHC.Types.Demand.html#onlyBoxedArguments"><span class="hs-identifier hs-type">onlyBoxedArguments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2200"></span><span id="onlyBoxedArguments"><span class="annot"><span class="annottext">onlyBoxedArguments :: DmdSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#onlyBoxedArguments"><span class="hs-identifier hs-var hs-var">onlyBoxedArguments</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601330"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601330"><span class="hs-identifier hs-var">dmds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Bool) -&gt; [Demand] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="#local-6989586621681601331"><span class="hs-identifier hs-var">demandIsBoxed</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601330"><span class="hs-identifier hs-var">dmds</span></a></span><span>
</span><span id="line-2201"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2202"></span><span>   </span><span id="local-6989586621681601331"><span class="annot"><span class="annottext">demandIsBoxed :: Demand -&gt; Bool
</span><a href="#local-6989586621681601331"><span class="hs-identifier hs-var hs-var">demandIsBoxed</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2203"></span><span>   </span><span class="annot"><a href="#local-6989586621681601331"><span class="hs-identifier hs-var">demandIsBoxed</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2204"></span><span>   </span><span class="annot"><a href="#local-6989586621681601331"><span class="hs-identifier hs-var">demandIsBoxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601334"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601334"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; Bool
</span><a href="#local-6989586621681601335"><span class="hs-identifier hs-var">subDemandIsboxed</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601334"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2205"></span><span>
</span><span id="line-2206"></span><span>   </span><span id="local-6989586621681601335"><span class="annot"><span class="annottext">subDemandIsboxed :: SubDemand -&gt; Bool
</span><a href="#local-6989586621681601335"><span class="hs-identifier hs-var hs-var">subDemandIsboxed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2207"></span><span>   </span><span class="annot"><a href="#local-6989586621681601335"><span class="hs-identifier hs-var">subDemandIsboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2208"></span><span>   </span><span class="annot"><a href="#local-6989586621681601335"><span class="hs-identifier hs-var">subDemandIsboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601336"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601336"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; Bool
</span><a href="#local-6989586621681601335"><span class="hs-identifier hs-var">subDemandIsboxed</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601336"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2209"></span><span>   </span><span class="annot"><a href="#local-6989586621681601335"><span class="hs-identifier hs-var">subDemandIsboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2210"></span><span>   </span><span class="annot"><a href="#local-6989586621681601335"><span class="hs-identifier hs-var">subDemandIsboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601337"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601337"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; Bool) -&gt; [Demand] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="#local-6989586621681601331"><span class="hs-identifier hs-var">demandIsBoxed</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601337"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-2211"></span><span>
</span><span id="line-2212"></span><span class="hs-comment">-- | Returns true if an application to n value args would diverge or throw an</span><span>
</span><span id="line-2213"></span><span class="hs-comment">-- exception.</span><span>
</span><span id="line-2214"></span><span class="hs-comment">--</span><span>
</span><span id="line-2215"></span><span class="hs-comment">-- If a function having 'botDiv' is applied to a less number of arguments than</span><span>
</span><span id="line-2216"></span><span class="hs-comment">-- its syntactic arity, we cannot say for sure that it is going to diverge.</span><span>
</span><span id="line-2217"></span><span class="hs-comment">-- Hence this function conservatively returns False in that case.</span><span>
</span><span id="line-2218"></span><span class="hs-comment">-- See Note [Dead ends].</span><span>
</span><span id="line-2219"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndAppSig"><span class="hs-identifier hs-type">isDeadEndAppSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2220"></span><span id="isDeadEndAppSig"><span class="annot"><span class="annottext">isDeadEndAppSig :: DmdSig -&gt; Int -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndAppSig"><span class="hs-identifier hs-var hs-var">isDeadEndAppSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601338"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601338"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681601339"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601339"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601340"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601340"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-2221"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; Divergence
</span><a href="GHC.Types.Demand.html#de_div"><span class="hs-identifier hs-var">de_div</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601338"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601339"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601340"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2222"></span><span>
</span><span id="line-2223"></span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxityDmdEnv"><span class="hs-identifier hs-type">trimBoxityDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-2224"></span><span id="trimBoxityDmdEnv"><span class="annot"><span class="annottext">trimBoxityDmdEnv :: DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#trimBoxityDmdEnv"><span class="hs-identifier hs-var hs-var">trimBoxityDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601342"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601342"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681601343"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601343"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; VarEnv Demand -&gt; VarEnv Demand
forall a b. (a -&gt; b) -&gt; VarEnv a -&gt; VarEnv b
</span><a href="GHC.Types.Var.Env.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-var">trimBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601342"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601343"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-2225"></span><span>
</span><span id="line-2226"></span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxityDmdType"><span class="hs-identifier hs-type">trimBoxityDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-2227"></span><span id="trimBoxityDmdType"><span class="annot"><span class="annottext">trimBoxityDmdType :: DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#trimBoxityDmdType"><span class="hs-identifier hs-var hs-var">trimBoxityDmdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601345"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601345"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681601346"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601346"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2228"></span><span>  </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#trimBoxityDmdEnv"><span class="hs-identifier hs-var">trimBoxityDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601345"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-var">trimBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601346"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2229"></span><span>
</span><span id="line-2230"></span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxityDmdSig"><span class="hs-identifier hs-type">trimBoxityDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2231"></span><span id="trimBoxityDmdSig"><span class="annot"><span class="annottext">trimBoxityDmdSig :: DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#trimBoxityDmdSig"><span class="hs-identifier hs-var hs-var">trimBoxityDmdSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DmdType -&gt; DmdType) -&gt; DmdSig -&gt; DmdSig
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#trimBoxityDmdType"><span class="hs-identifier hs-var">trimBoxityDmdType</span></a></span><span>
</span><span id="line-2232"></span><span>
</span><span id="line-2233"></span><span class="hs-comment">-- | Transfers the boxity of the left arg to the demand structure of the right</span><span>
</span><span id="line-2234"></span><span class="hs-comment">-- arg. This only makes sense if applied to new and old demands of the same</span><span>
</span><span id="line-2235"></span><span class="hs-comment">-- value.</span><span>
</span><span id="line-2236"></span><span class="annot"><a href="GHC.Types.Demand.html#transferBoxity"><span class="hs-identifier hs-type">transferBoxity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-2237"></span><span id="transferBoxity"><span class="annot"><span class="annottext">transferBoxity :: Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#transferBoxity"><span class="hs-identifier hs-var hs-var">transferBoxity</span></a></span></span><span> </span><span id="local-6989586621681601348"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601348"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621681601349"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601349"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601350"><span class="hs-identifier hs-var">go_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601348"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601349"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-2238"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2239"></span><span>    </span><span id="local-6989586621681601350"><span class="annot"><span class="annottext">go_dmd :: Demand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601350"><span class="hs-identifier hs-var hs-var">go_dmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601358"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601358"><span class="hs-identifier hs-var">from_n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601359"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601359"><span class="hs-identifier hs-var">from_sd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601360"><span class="annot"><span class="annottext">to_dmd :: Demand
</span><a href="#local-6989586621681601360"><span class="hs-identifier hs-var">to_dmd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681601361"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601361"><span class="hs-identifier hs-var">to_n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601362"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601362"><span class="hs-identifier hs-var">to_sd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2240"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601358"><span class="hs-identifier hs-var">from_n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601361"><span class="hs-identifier hs-var">to_n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601360"><span class="hs-identifier hs-var">to_dmd</span></a></span><span>
</span><span id="line-2241"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601359"><span class="hs-identifier hs-var">from_sd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601362"><span class="hs-identifier hs-var">to_sd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2242"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601363"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601363"><span class="hs-identifier hs-var">from_b</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601364"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601364"><span class="hs-identifier hs-var">to_c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2243"></span><span>            </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601361"><span class="hs-identifier hs-var">to_n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601363"><span class="hs-identifier hs-var">from_b</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601364"><span class="hs-identifier hs-var">to_c</span></a></span><span>
</span><span id="line-2244"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601365"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601365"><span class="hs-identifier hs-var">to_ds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2245"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601366"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601366"><span class="hs-identifier hs-var">from_b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601367"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601367"><span class="hs-identifier hs-var">from_ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe (Boxity, [Demand])
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601365"><span class="hs-identifier hs-var">to_ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601359"><span class="hs-identifier hs-var">from_sd</span></a></span><span>
</span><span id="line-2246"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601361"><span class="hs-identifier hs-var">to_n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601366"><span class="hs-identifier hs-var">from_b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#strictZipWith"><span class="hs-identifier hs-var">strictZipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601350"><span class="hs-identifier hs-var">go_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601367"><span class="hs-identifier hs-var">from_ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601365"><span class="hs-identifier hs-var">to_ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2247"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601368"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601368"><span class="hs-identifier hs-var">from_b</span></a></span></span><span> </span><span id="local-6989586621681601369"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601369"><span class="hs-identifier hs-var">from_ds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2248"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601370"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601370"><span class="hs-identifier hs-var">to_ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe (Boxity, [Demand])
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601369"><span class="hs-identifier hs-var">from_ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601362"><span class="hs-identifier hs-var">to_sd</span></a></span><span>
</span><span id="line-2249"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601361"><span class="hs-identifier hs-var">to_n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601368"><span class="hs-identifier hs-var">from_b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#strictZipWith"><span class="hs-identifier hs-var">strictZipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601350"><span class="hs-identifier hs-var">go_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601369"><span class="hs-identifier hs-var">from_ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601370"><span class="hs-identifier hs-var">to_ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2250"></span><span>          </span><span class="annot"><span class="annottext">(SubDemand, SubDemand)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-var">trimBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601360"><span class="hs-identifier hs-var">to_dmd</span></a></span><span>
</span><span id="line-2251"></span><span>
</span><span id="line-2252"></span><span class="annot"><a href="GHC.Types.Demand.html#transferArgBoxityDmdType"><span class="hs-identifier hs-type">transferArgBoxityDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-2253"></span><span id="transferArgBoxityDmdType"><span class="annot"><span class="annottext">transferArgBoxityDmdType :: DmdType -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#transferArgBoxityDmdType"><span class="hs-identifier hs-var hs-var">transferArgBoxityDmdType</span></a></span></span><span> </span><span id="local-6989586621681601372"><span class="annot"><span class="annottext">_from :: DmdType
</span><a href="#local-6989586621681601372"><span class="hs-identifier hs-var">_from</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601373"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601373"><span class="hs-identifier hs-var">from_ds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601374"><span class="annot"><span class="annottext">to :: DmdType
</span><a href="#local-6989586621681601374"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601375"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601375"><span class="hs-identifier hs-var">to_env</span></a></span></span><span> </span><span id="local-6989586621681601376"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601376"><span class="hs-identifier hs-var">to_ds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2254"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [Demand] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601373"><span class="hs-identifier hs-var">from_ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601376"><span class="hs-identifier hs-var">to_ds</span></a></span><span>
</span><span id="line-2255"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTraceWith &quot;transfer&quot; (\r -&gt; ppr _from $$ ppr to $$ ppr r) $</span><span>
</span><span id="line-2256"></span><span>    </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601375"><span class="hs-identifier hs-var">to_env</span></a></span><span> </span><span class="hs-comment">-- Only arg boxity! See Note [Don't change boxity without worker/wrapper]</span><span>
</span><span id="line-2257"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#transferBoxity"><span class="hs-identifier hs-var">transferBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601373"><span class="hs-identifier hs-var">from_ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601376"><span class="hs-identifier hs-var">to_ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2258"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#trimBoxityDmdType"><span class="hs-identifier hs-var">trimBoxityDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601374"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-2260"></span><span>
</span><span id="line-2261"></span><span class="annot"><a href="GHC.Types.Demand.html#transferArgBoxityDmdSig"><span class="hs-identifier hs-type">transferArgBoxityDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2262"></span><span id="transferArgBoxityDmdSig"><span class="annot"><span class="annottext">transferArgBoxityDmdSig :: DmdSig -&gt; DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#transferArgBoxityDmdSig"><span class="hs-identifier hs-var hs-var">transferArgBoxityDmdSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DmdType -&gt; DmdType -&gt; DmdType) -&gt; DmdSig -&gt; DmdSig -&gt; DmdSig
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#transferArgBoxityDmdType"><span class="hs-identifier hs-var">transferArgBoxityDmdType</span></a></span><span>
</span><span id="line-2263"></span><span>
</span><span id="line-2264"></span><span class="annot"><a href="GHC.Types.Demand.html#prependArgsDmdSig"><span class="hs-identifier hs-type">prependArgsDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2265"></span><span class="hs-comment">-- ^ Add extra ('topDmd') arguments to a strictness signature.</span><span>
</span><span id="line-2266"></span><span class="hs-comment">-- In contrast to 'etaConvertDmdSig', this /prepends/ additional argument</span><span>
</span><span id="line-2267"></span><span class="hs-comment">-- demands. This is used by FloatOut.</span><span>
</span><span id="line-2268"></span><span id="prependArgsDmdSig"><span class="annot"><span class="annottext">prependArgsDmdSig :: Int -&gt; DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#prependArgsDmdSig"><span class="hs-identifier hs-var hs-var">prependArgsDmdSig</span></a></span></span><span> </span><span id="local-6989586621681601377"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601377"><span class="hs-identifier hs-var">new_args</span></a></span></span><span> </span><span id="local-6989586621681601378"><span class="annot"><span class="annottext">sig :: DmdSig
</span><a href="#local-6989586621681601378"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span id="local-6989586621681601379"><span class="annot"><span class="annottext">dmd_ty :: DmdType
</span><a href="#local-6989586621681601379"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601380"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601380"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681601381"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601381"><span class="hs-identifier hs-var">dmds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2269"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601377"><span class="hs-identifier hs-var">new_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdSig
</span><a href="#local-6989586621681601378"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-2270"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601379"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdSig
</span><a href="#local-6989586621681601378"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-2271"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601380"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601382"><span class="hs-identifier hs-var">dmds'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2272"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2273"></span><span>    </span><span id="local-6989586621681601382"><span class="annot"><span class="annottext">dmds' :: [Demand]
</span><a href="#local-6989586621681601382"><span class="hs-identifier hs-var hs-var">dmds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; [Demand] -&gt; [Demand]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601377"><span class="hs-identifier hs-var">new_args</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601377"><span class="hs-identifier hs-var">new_args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Demand] -&gt; [Demand]) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2274"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; Demand -&gt; [Demand]
forall a. Int -&gt; a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#replicate/GHC.List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601377"><span class="hs-identifier hs-var">new_args</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [Demand] -&gt; [Demand]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601381"><span class="hs-identifier hs-var">dmds</span></a></span><span>
</span><span id="line-2275"></span><span>
</span><span id="line-2276"></span><span class="annot"><a href="GHC.Types.Demand.html#etaConvertDmdSig"><span class="hs-identifier hs-type">etaConvertDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2277"></span><span class="hs-comment">-- ^ We are expanding (\x y. e) to (\x y z. e z) or reducing from the latter to</span><span>
</span><span id="line-2278"></span><span class="hs-comment">-- the former (when the Simplifier identifies a new join points, for example).</span><span>
</span><span id="line-2279"></span><span class="hs-comment">-- In contrast to 'prependArgsDmdSig', this /appends/ extra arg demands if</span><span>
</span><span id="line-2280"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-2281"></span><span class="hs-comment">-- This works by looking at the 'DmdType' (which was produced under a call</span><span>
</span><span id="line-2282"></span><span class="hs-comment">-- demand for the old arity) and trying to transfer as many facts as we can to</span><span>
</span><span id="line-2283"></span><span class="hs-comment">-- the call demand of new arity.</span><span>
</span><span id="line-2284"></span><span class="hs-comment">-- An arity increase (resulting in a stronger incoming demand) can retain much</span><span>
</span><span id="line-2285"></span><span class="hs-comment">-- of the info, while an arity decrease (a weakening of the incoming demand)</span><span>
</span><span id="line-2286"></span><span class="hs-comment">-- must fall back to a conservative default.</span><span>
</span><span id="line-2287"></span><span id="etaConvertDmdSig"><span class="annot"><span class="annottext">etaConvertDmdSig :: Int -&gt; DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#etaConvertDmdSig"><span class="hs-identifier hs-var hs-var">etaConvertDmdSig</span></a></span></span><span> </span><span id="local-6989586621681601383"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601383"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span id="local-6989586621681601384"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601384"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2288"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601383"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601384"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdType -&gt; DmdSig) -&gt; DmdType -&gt; DmdSig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#decreaseArityDmdType"><span class="hs-identifier hs-var">decreaseArityDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601384"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span>
</span><span id="line-2289"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdType -&gt; DmdSig) -&gt; DmdType -&gt; DmdSig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601383"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601384"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Demand transformers
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2298"></span><span>
</span><span id="line-2299"></span><span class="hs-comment">-- | A /demand transformer/ is a monotone function from an incoming evaluation</span><span>
</span><span id="line-2300"></span><span class="hs-comment">-- context ('SubDemand') to a 'DmdType', describing how the denoted thing</span><span>
</span><span id="line-2301"></span><span class="hs-comment">-- (i.e. expression, function) uses its arguments and free variables, and</span><span>
</span><span id="line-2302"></span><span class="hs-comment">-- whether it diverges.</span><span>
</span><span id="line-2303"></span><span class="hs-comment">--</span><span>
</span><span id="line-2304"></span><span class="hs-comment">-- See Note [Understanding DmdType and DmdSig]</span><span>
</span><span id="line-2305"></span><span class="hs-comment">-- and Note [What are demand signatures?].</span><span>
</span><span id="line-2306"></span><span class="hs-keyword">type</span><span> </span><span id="DmdTransformer"><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-var">DmdTransformer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-2307"></span><span>
</span><span id="line-2308"></span><span class="hs-comment">-- | Extrapolate a demand signature ('DmdSig') into a 'DmdTransformer'.</span><span>
</span><span id="line-2309"></span><span class="hs-comment">--</span><span>
</span><span id="line-2310"></span><span class="hs-comment">-- Given a function's 'DmdSig' and a 'SubDemand' for the evaluation context,</span><span>
</span><span id="line-2311"></span><span class="hs-comment">-- return how the function evaluates its free variables and arguments.</span><span>
</span><span id="line-2312"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformSig"><span class="hs-identifier hs-type">dmdTransformSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-type">DmdTransformer</span></a></span><span>
</span><span id="line-2313"></span><span id="dmdTransformSig"><span class="annot"><span class="annottext">dmdTransformSig :: DmdSig -&gt; DmdTransformer
</span><a href="GHC.Types.Demand.html#dmdTransformSig"><span class="hs-identifier hs-var hs-var">dmdTransformSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span id="local-6989586621681601385"><span class="annot"><span class="annottext">dmd_ty :: DmdType
</span><a href="#local-6989586621681601385"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601386"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601386"><span class="hs-identifier hs-var">arg_ds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601387"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601387"><span class="hs-identifier hs-var">sd</span></a></span></span><span>
</span><span id="line-2314"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-var">multDmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Card, SubDemand) -&gt; Card
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Card, SubDemand) -&gt; Card) -&gt; (Card, SubDemand) -&gt; Card
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601386"><span class="hs-identifier hs-var">arg_ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601387"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601385"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span>
</span><span id="line-2315"></span><span>    </span><span class="hs-comment">-- see Note [Demands from unsaturated function calls]</span><span>
</span><span id="line-2316"></span><span>    </span><span class="hs-comment">-- and Note [What are demand signatures?]</span><span>
</span><span id="line-2317"></span><span>
</span><span id="line-2318"></span><span class="hs-comment">-- | A special 'DmdTransformer' for data constructors that feeds product</span><span>
</span><span id="line-2319"></span><span class="hs-comment">-- demands into the constructor arguments.</span><span>
</span><span id="line-2320"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDataConSig"><span class="hs-identifier hs-type">dmdTransformDataConSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-type">DmdTransformer</span></a></span><span>
</span><span id="line-2321"></span><span class="hs-comment">-- See Note [Demand transformer for data constructors]</span><span>
</span><span id="line-2322"></span><span id="dmdTransformDataConSig"><span class="annot"><span class="annottext">dmdTransformDataConSig :: [StrictnessMark] -&gt; DmdTransformer
</span><a href="GHC.Types.Demand.html#dmdTransformDataConSig"><span class="hs-identifier hs-var hs-var">dmdTransformDataConSig</span></a></span></span><span> </span><span id="local-6989586621681601388"><span class="annot"><span class="annottext">[StrictnessMark]
</span><a href="#local-6989586621681601388"><span class="hs-identifier hs-var">str_marks</span></a></span></span><span> </span><span id="local-6989586621681601389"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601389"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe (Boxity, [Demand])
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601390"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601391"><span class="hs-identifier hs-var">body_sd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2323"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601392"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601392"><span class="hs-identifier hs-var">dmds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; [Demand] -&gt; DmdType
</span><a href="#local-6989586621681601393"><span class="hs-identifier hs-var">mk_body_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601394"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601392"><span class="hs-identifier hs-var">dmds</span></a></span><span>
</span><span id="line-2324"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Boxity, [Demand])
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span>
</span><span id="line-2325"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2326"></span><span>    </span><span id="local-6989586621681601390"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621681601390"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StrictnessMark] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[StrictnessMark]
</span><a href="#local-6989586621681601388"><span class="hs-identifier hs-var">str_marks</span></a></span><span>
</span><span id="line-2327"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681601394"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601394"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601391"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601391"><span class="hs-identifier hs-var">body_sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681601390"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601389"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2328"></span><span>    </span><span id="local-6989586621681601393"><span class="annot"><span class="annottext">mk_body_ty :: Card -&gt; [Demand] -&gt; DmdType
</span><a href="#local-6989586621681601393"><span class="hs-identifier hs-var hs-var">mk_body_ty</span></a></span></span><span> </span><span id="local-6989586621681601395"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601395"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601396"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601396"><span class="hs-identifier hs-var">dmds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier hs-var">nopDmdEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(StrictnessMark -&gt; Demand -&gt; Demand)
-&gt; [StrictnessMark] -&gt; [Demand] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; StrictnessMark -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601397"><span class="hs-identifier hs-var">bump</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601395"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StrictnessMark]
</span><a href="#local-6989586621681601388"><span class="hs-identifier hs-var">str_marks</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601396"><span class="hs-identifier hs-var">dmds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2329"></span><span>    </span><span id="local-6989586621681601397"><span class="annot"><span class="annottext">bump :: Card -&gt; StrictnessMark -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601397"><span class="hs-identifier hs-var hs-var">bump</span></a></span></span><span> </span><span id="local-6989586621681601398"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601398"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601399"><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621681601399"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621681601400"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601400"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StrictnessMark -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isMarkedStrict"><span class="hs-identifier hs-var">isMarkedStrict</span></a></span><span> </span><span class="annot"><span class="annottext">StrictnessMark
</span><a href="#local-6989586621681601399"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601398"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601401"><span class="hs-identifier hs-var">str_field_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601400"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2330"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601398"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601400"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-2331"></span><span>    </span><span id="local-6989586621681601401"><span class="annot"><span class="annottext">str_field_dmd :: Demand
</span><a href="#local-6989586621681601401"><span class="hs-identifier hs-var hs-var">str_field_dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span> </span><span class="hs-comment">-- Why not C_11? See Note [Data-con worker strictness]</span><span>
</span><span id="line-2332"></span><span>
</span><span id="line-2333"></span><span class="hs-comment">-- | A special 'DmdTransformer' for dictionary selectors that feeds the demand</span><span>
</span><span id="line-2334"></span><span class="hs-comment">-- on the result into the indicated dictionary component (if saturated).</span><span>
</span><span id="line-2335"></span><span class="hs-comment">-- See Note [Demand transformer for a dictionary selector].</span><span>
</span><span id="line-2336"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier hs-type">dmdTransformDictSelSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-type">DmdTransformer</span></a></span><span>
</span><span id="line-2337"></span><span class="hs-comment">-- NB: This currently doesn't handle newtype dictionaries.</span><span>
</span><span id="line-2338"></span><span class="hs-comment">-- It should simply apply call_sd directly to the dictionary, I suppose.</span><span>
</span><span id="line-2339"></span><span id="dmdTransformDictSelSig"><span class="annot"><span class="annottext">dmdTransformDictSelSig :: DmdSig -&gt; DmdTransformer
</span><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier hs-var hs-var">dmdTransformDictSelSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601403"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601403"><span class="hs-identifier hs-var">prod</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601404"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601404"><span class="hs-identifier hs-var">call_sd</span></a></span></span><span>
</span><span id="line-2340"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601405"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601405"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601406"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601406"><span class="hs-identifier hs-var">sd'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier hs-var">peelCallDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601404"><span class="hs-identifier hs-var">call_sd</span></a></span><span>
</span><span id="line-2341"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601407"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601407"><span class="hs-identifier hs-var">sig_ds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601403"><span class="hs-identifier hs-var">prod</span></a></span><span>
</span><span id="line-2342"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-var">multDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601405"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdType -&gt; DmdType) -&gt; DmdType -&gt; DmdType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2343"></span><span>     </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#nopDmdEnv"><span class="hs-identifier hs-var">nopDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601408"><span class="hs-identifier hs-var">enhance</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601406"><span class="hs-identifier hs-var">sd'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601407"><span class="hs-identifier hs-var">sig_ds</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2344"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2345"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span> </span><span class="hs-comment">-- See Note [Demand transformer for a dictionary selector]</span><span>
</span><span id="line-2346"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2347"></span><span>    </span><span id="local-6989586621681601408"><span class="annot"><span class="annottext">enhance :: SubDemand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621681601408"><span class="hs-identifier hs-var hs-var">enhance</span></a></span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-2348"></span><span>    </span><span class="annot"><a href="#local-6989586621681601408"><span class="hs-identifier hs-var">enhance</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-2349"></span><span>    </span><span class="annot"><a href="#local-6989586621681601408"><span class="hs-identifier hs-var">enhance</span></a></span><span> </span><span id="local-6989586621681601410"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601410"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span id="local-6989586621681601411"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621681601411"><span class="hs-identifier hs-var">_dmd_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601410"><span class="hs-identifier hs-var">sd</span></a></span><span>  </span><span class="hs-comment">-- This is the one!</span><span>
</span><span id="line-2350"></span><span>                                      </span><span class="hs-comment">-- C_11, because we multiply with n above</span><span>
</span><span id="line-2351"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier hs-var">dmdTransformDictSelSig</span></a></span><span> </span><span id="local-6989586621681601412"><span class="annot"><span class="annottext">DmdSig
</span><a href="#local-6989586621681601412"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621681601413"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601413"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DmdType
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dmdTransformDictSelSig: no args&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdSig -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DmdSig
</span><a href="#local-6989586621681601412"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601413"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2352"></span><span>
</span><span id="line-2353"></span><span class="hs-comment">{-
Note [What are demand signatures?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Demand analysis interprets expressions in the abstract domain of demand
transformers. Given a (sub-)demand that denotes the evaluation context, the
abstract transformer of an expression gives us back a demand type denoting
how other things (like arguments and free vars) were used when the expression
was evaluated. Here's an example:

  f x y =
    if x + expensive
      then \z -&gt; z + y * ...
      else \z -&gt; z * ...

The abstract transformer (let's call it F_e) of the if expression (let's
call it e) would transform an incoming (undersaturated!) head demand 1A into
a demand type like {x-&gt;&lt;1L&gt;,y-&gt;&lt;L&gt;}&lt;L&gt;. In pictures:

     Demand ---F_e---&gt; DmdType
     &lt;1A&gt;              {x-&gt;&lt;1L&gt;,y-&gt;&lt;L&gt;}&lt;L&gt;

Let's assume that the demand transformers we compute for an expression are
correct wrt. to some concrete semantics for Core. How do demand signatures fit
in? They are strange beasts, given that they come with strict rules when to
it's sound to unleash them.

Fortunately, we can formalise the rules with Galois connections. Consider
f's strictness signature, {}&lt;1L&gt;&lt;L&gt;. It's a single-point approximation of
the actual abstract transformer of f's RHS for arity 2. So, what happens is that
we abstract *once more* from the abstract domain we already are in, replacing
the incoming Demand by a simple lattice with two elements denoting incoming
arity: A_2 = {&lt;2, &gt;=2} (where '&lt;2' is the top element and &gt;=2 the bottom
element). Here's the diagram:

     A_2 -----f_f----&gt; DmdType
      ^                   |
      | &#945;               &#947; |
      |                   v
  SubDemand --F_f----&gt; DmdType

With
  &#945;(C(1,C(1,_))) = &gt;=2
  &#945;(_)         =  &lt;2
  &#947;(ty)        =  ty
and F_f being the abstract transformer of f's RHS and f_f being the abstracted
abstract transformer computable from our demand signature simply by

  f_f(&gt;=2) = {}&lt;1L&gt;&lt;L&gt;
  f_f(&lt;2)  = multDmdType C_0N {}&lt;1L&gt;&lt;L&gt;

where multDmdType makes a proper top element out of the given demand type.

In practice, the A_n domain is not just a simple Bool, but a Card, which is
exactly the Card with which we have to multDmdType. The Card for arity n
is computed by calling @peelManyCalls n@, which corresponds to &#945; above.

Note [Demand transformer for a dictionary selector]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have a superclass selector 'sc_sel' and a class method
selector 'op_sel', and a function that uses both, like this

-- Strictness sig: 1P(1,A)
sc_sel (x,y) = x

-- Strictness sig: 1P(A,1)
op_sel (p,q)= q

f d v = op_sel (sc_sel d) v

What do we learn about the demand on 'd'?  Alas, we see only the
demand from 'sc_sel', namely '1P(1,A)'.  We /don't/ see that 'd' really has a nested
demand '1P(1P(A,1C(1,1)),A)'.  On the other hand, if we inlined the two selectors
we'd have

f d x = case d of (x,_) -&gt;
        case x of (_,q) -&gt;
        q v

If we analyse that, we'll get a richer, nested demand on 'd'.

We want to behave /as if/ we'd inlined 'op_sel' and 'sc_sel'. We can do this
easily by building a richer demand transformer for dictionary selectors than
is expressible by a regular demand signature.
And that is what 'dmdTransformDictSelSig' does: it transforms the demand on the
result to a demand on the (single) argument.

How does it do that?
If we evaluate (op dict-expr) under demand 'd', then we can push the demand 'd'
into the appropriate field of the dictionary. What *is* the appropriate field?
We just look at the strictness signature of the class op, which will be
something like: P(AAA1AAAAA). Then replace the '1' (or any other non-absent
demand, really) by the demand 'd'. The '1' acts as if it was a demand variable,
the whole signature really means `\d. P(AAAdAAAAA)` for any incoming
demand 'd'.

For single-method classes, which are represented by newtypes the signature
of 'op' won't look like P(...), so matching on Prod will fail.
That's fine: if we are doing strictness analysis we are also doing inlining,
so we'll have inlined 'op' into a cast.  So we can bale out in a conservative
way, returning nopDmdType. SG: Although we then probably want to apply the eval
demand 'd' directly to 'op' rather than turning it into 'topSubDmd'...

It is (just.. #8329) possible to be running strictness analysis *without*
having inlined class ops from single-method classes.  Suppose you are using
ghc --make; and the first module has a local -O0 flag.  So you may load a class
without interface pragmas, ie (currently) without an unfolding for the class
ops.   Now if a subsequent module in the --make sweep has a local -O flag
you might do strictness analysis, but there is no inlining for the class op.
This is weird, so I'm not worried about whether this optimises brilliantly; but
it should not fall over.
-}</span><span>
</span><span id="line-2464"></span><span>
</span><span id="line-2465"></span><span class="annot"><a href="GHC.Types.Demand.html#zapDmdEnv"><span class="hs-identifier hs-type">zapDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-2466"></span><span id="zapDmdEnv"><span class="annot"><span class="annottext">zapDmdEnv :: DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#zapDmdEnv"><span class="hs-identifier hs-var hs-var">zapDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601415"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601415"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#mkEmptyDmdEnv"><span class="hs-identifier hs-var">mkEmptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601415"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-2467"></span><span>
</span><span id="line-2468"></span><span class="annot"><span class="hs-comment">-- | Remove the demand environment from the signature.</span></span><span>
</span><span id="line-2469"></span><span class="annot"><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier hs-type">zapDmdEnvSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2470"></span><span id="zapDmdEnvSig"><span class="annot"><span class="annottext">zapDmdEnvSig :: DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier hs-var hs-var">zapDmdEnvSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601416"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601416"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681601417"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601417"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#zapDmdEnv"><span class="hs-identifier hs-var">zapDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601416"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601417"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2471"></span><span>
</span><span id="line-2472"></span><span class="annot"><a href="GHC.Types.Demand.html#zapUsageDemand"><span class="hs-identifier hs-type">zapUsageDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-2473"></span><span class="hs-comment">-- Remove the usage info, but not the strictness info, from the demand</span><span>
</span><span id="line-2474"></span><span id="zapUsageDemand"><span class="annot"><span class="annottext">zapUsageDemand :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#zapUsageDemand"><span class="hs-identifier hs-var hs-var">zapUsageDemand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span class="annot"><span class="annottext">(KillFlags -&gt; Demand -&gt; Demand) -&gt; KillFlags -&gt; Demand -&gt; Demand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span>
</span><span id="line-2475"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">kf_abs :: Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2476"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_used_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2477"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_called_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var">kf_called_once</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2478"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2479"></span><span>
</span><span id="line-2480"></span><span class="annot"><span class="hs-comment">-- | Remove all `C_01 :*` info (but not `CM` sub-demands) from the demand</span></span><span>
</span><span id="line-2481"></span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier hs-type">zapUsedOnceDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-2482"></span><span id="zapUsedOnceDemand"><span class="annot"><span class="annottext">zapUsedOnceDemand :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier hs-var hs-var">zapUsedOnceDemand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span class="annot"><span class="annottext">(KillFlags -&gt; Demand -&gt; Demand) -&gt; KillFlags -&gt; Demand -&gt; Demand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span>
</span><span id="line-2483"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">kf_abs :: Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2484"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_used_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2485"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_called_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var">kf_called_once</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2486"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2487"></span><span>
</span><span id="line-2488"></span><span class="hs-comment">-- | Remove all `C_01 :*` info (but not `CM` sub-demands) from the strictness</span><span>
</span><span id="line-2489"></span><span class="hs-comment">--   signature</span><span>
</span><span id="line-2490"></span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceSig"><span class="hs-identifier hs-type">zapUsedOnceSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span>
</span><span id="line-2491"></span><span id="zapUsedOnceSig"><span class="annot"><span class="annottext">zapUsedOnceSig :: DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#zapUsedOnceSig"><span class="hs-identifier hs-var hs-var">zapUsedOnceSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601423"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601423"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681601424"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601424"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2492"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601423"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier hs-var">zapUsedOnceDemand</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601424"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2493"></span><span>
</span><span id="line-2494"></span><span class="hs-keyword">data</span><span> </span><span id="KillFlags"><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-var">KillFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="KillFlags"><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-var">KillFlags</span></a></span></span><span>
</span><span id="line-2495"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="kf_abs"><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var hs-var">kf_abs</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2496"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="kf_used_once"><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var hs-var">kf_used_once</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2497"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="kf_called_once"><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var hs-var">kf_called_once</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2498"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2499"></span><span>
</span><span id="line-2500"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-type">kill_usage_card</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-2501"></span><span id="kill_usage_card"><span class="annot"><span class="annottext">kill_usage_card :: KillFlags -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var hs-var">kill_usage_card</span></a></span></span><span> </span><span id="local-6989586621681601426"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601426"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601426"><span class="hs-identifier hs-var">kfs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-2502"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span id="local-6989586621681601427"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601427"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601427"><span class="hs-identifier hs-var">kfs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-2503"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span id="local-6989586621681601428"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601428"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601428"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-2504"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span id="local-6989586621681601429"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601429"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601429"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-2505"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621681601430"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601430"><span class="hs-identifier hs-var">n</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601430"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2506"></span><span>
</span><span id="line-2507"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-type">kill_usage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-2508"></span><span id="kill_usage"><span class="annot"><span class="annottext">kill_usage :: KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var hs-var">kill_usage</span></a></span></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-2509"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-2510"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span id="local-6989586621681601431"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601431"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601432"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601432"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601433"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601433"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601431"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601432"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601431"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601433"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2511"></span><span>
</span><span id="line-2512"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-type">kill_usage_sd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-2513"></span><span id="kill_usage_sd"><span class="annot"><span class="annottext">kill_usage_sd :: KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var hs-var">kill_usage_sd</span></a></span></span><span> </span><span id="local-6989586621681601435"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601435"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601436"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601436"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601437"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601437"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2514"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var">kf_called_once</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601435"><span class="hs-identifier hs-var">kfs</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601436"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601435"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601437"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2515"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601436"><span class="hs-identifier hs-var">n</span></a></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601435"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601437"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2516"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span id="local-6989586621681601438"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601438"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601439"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601439"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601440"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601440"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601439"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621681601438"><span class="hs-identifier hs-var">kfs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601440"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2517"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621681601441"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601441"><span class="hs-identifier hs-var">sd</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601441"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2518"></span><span>
</span><span id="line-2519"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
               TypeShape and demand trimming
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-2524"></span><span>
</span><span id="line-2525"></span><span>
</span><span id="line-2526"></span><span class="hs-keyword">data</span><span> </span><span id="TypeShape"><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-var">TypeShape</span></a></span></span><span> </span><span class="hs-comment">-- See Note [Trimming a demand to a type]</span><span>
</span><span id="line-2527"></span><span>               </span><span class="hs-comment">--     in GHC.Core.Opt.DmdAnal</span><span>
</span><span id="line-2528"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TsFun"><span class="annot"><a href="GHC.Types.Demand.html#TsFun"><span class="hs-identifier hs-var">TsFun</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span>
</span><span id="line-2529"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TsProd"><span class="annot"><a href="GHC.Types.Demand.html#TsProd"><span class="hs-identifier hs-var">TsProd</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2530"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TsUnk"><span class="annot"><a href="GHC.Types.Demand.html#TsUnk"><span class="hs-identifier hs-var">TsUnk</span></a></span></span><span>
</span><span id="line-2531"></span><span>
</span><span id="line-2532"></span><span class="annot"><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-type">trimToType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-2533"></span><span class="hs-comment">-- See Note [Trimming a demand to a type] in GHC.Core.Opt.DmdAnal</span><span>
</span><span id="line-2534"></span><span id="trimToType"><span class="annot"><span class="annottext">trimToType :: Demand -&gt; TypeShape -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-var hs-var">trimToType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="annot"><span class="annottext">TypeShape
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-2535"></span><span class="annot"><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-var">trimToType</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="annot"><span class="annottext">TypeShape
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-2536"></span><span class="annot"><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-var">trimToType</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601445"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601445"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601446"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601446"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681601447"><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621681601447"><span class="hs-identifier hs-var">ts</span></a></span></span><span>
</span><span id="line-2537"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601445"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; TypeShape -&gt; SubDemand
</span><a href="#local-6989586621681601448"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601446"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621681601447"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-2538"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2539"></span><span>    </span><span id="local-6989586621681601448"><span class="annot"><span class="annottext">go :: SubDemand -&gt; TypeShape -&gt; SubDemand
</span><a href="#local-6989586621681601448"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601449"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601449"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601450"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601450"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsProd"><span class="hs-identifier hs-type">TsProd</span></a></span><span> </span><span id="local-6989586621681601451"><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621681601451"><span class="hs-identifier hs-var">tss</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2540"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [TypeShape] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601450"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621681601451"><span class="hs-identifier hs-var">tss</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601449"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; TypeShape -&gt; Demand)
-&gt; [Demand] -&gt; [TypeShape] -&gt; [Demand]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zipWith/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; TypeShape -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-var">trimToType</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601450"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621681601451"><span class="hs-identifier hs-var">tss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2541"></span><span>    </span><span class="annot"><a href="#local-6989586621681601448"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601452"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601452"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601453"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601453"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsFun"><span class="hs-identifier hs-type">TsFun</span></a></span><span> </span><span id="local-6989586621681601454"><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621681601454"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601452"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; TypeShape -&gt; SubDemand
</span><a href="#local-6989586621681601448"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601453"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621681601454"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2542"></span><span>    </span><span class="annot"><a href="#local-6989586621681601448"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681601455"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621681601455"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="annot"><span class="annottext">TypeShape
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601455"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2543"></span><span>    </span><span class="annot"><a href="#local-6989586621681601448"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>           </span><span class="annot"><span class="annottext">TypeShape
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-2544"></span><span>
</span><span id="line-2545"></span><span class="annot"><span class="hs-comment">-- | Drop all boxity</span></span><span>
</span><span id="line-2546"></span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-type">trimBoxity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-2547"></span><span id="trimBoxity"><span class="annot"><span class="annottext">trimBoxity :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-var hs-var">trimBoxity</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-2548"></span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-var">trimBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-2549"></span><span class="annot"><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-var">trimBoxity</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601456"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601456"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601457"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601457"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601456"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand
</span><a href="#local-6989586621681601458"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601457"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2550"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2551"></span><span>    </span><span id="local-6989586621681601458"><span class="annot"><span class="annottext">go :: SubDemand -&gt; SubDemand
</span><a href="#local-6989586621681601458"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601459"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601459"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601459"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2552"></span><span>    </span><span class="annot"><a href="#local-6989586621681601458"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601460"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601460"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; Demand) -&gt; [Demand] -&gt; [Demand]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimBoxity"><span class="hs-identifier hs-var">trimBoxity</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601460"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2553"></span><span>    </span><span class="annot"><a href="#local-6989586621681601458"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601461"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601461"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601462"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601462"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601461"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(SubDemand -&gt; SubDemand) -&gt; SubDemand -&gt; SubDemand
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand
</span><a href="#local-6989586621681601458"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601462"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2554"></span><span>
</span><span id="line-2555"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     'seq'ing demands
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2562"></span><span>
</span><span id="line-2563"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-type">seqDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2564"></span><span id="seqDemand"><span class="annot"><span class="annottext">seqDemand :: Demand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-var hs-var">seqDemand</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2565"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-var">seqDemand</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2566"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-var">seqDemand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601463"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601463"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601463"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2567"></span><span>
</span><span id="line-2568"></span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-type">seqSubDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2569"></span><span id="seqSubDemand"><span class="annot"><span class="annottext">seqSubDemand :: SubDemand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var hs-var">seqSubDemand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601465"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601465"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-var">seqDemandList</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601465"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-2570"></span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601466"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601466"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601466"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2571"></span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2572"></span><span>
</span><span id="line-2573"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-type">seqDemandList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2574"></span><span id="seqDemandList"><span class="annot"><span class="annottext">seqDemandList :: [Demand] -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-var hs-var">seqDemandList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; () -&gt; ()) -&gt; () -&gt; [Demand] -&gt; ()
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">(() -&gt; () -&gt; ()) -&gt; (Demand -&gt; ()) -&gt; Demand -&gt; () -&gt; ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-var">seqDemand</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2575"></span><span>
</span><span id="line-2576"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier hs-type">seqDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2577"></span><span id="seqDmdType"><span class="annot"><span class="annottext">seqDmdType :: DmdType -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier hs-var hs-var">seqDmdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601468"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601468"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681601469"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601469"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2578"></span><span>  </span><span class="annot"><span class="annottext">DmdEnv -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdEnv"><span class="hs-identifier hs-var">seqDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601468"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-var">seqDemandList</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601469"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2579"></span><span>
</span><span id="line-2580"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdEnv"><span class="hs-identifier hs-type">seqDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2581"></span><span id="seqDmdEnv"><span class="annot"><span class="annottext">seqDmdEnv :: DmdEnv -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdEnv"><span class="hs-identifier hs-var hs-var">seqDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601471"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601471"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Demand -&gt; ()) -&gt; VarEnv Demand -&gt; ()
forall elt key. (elt -&gt; ()) -&gt; UniqFM key elt -&gt; ()
</span><a href="GHC.Types.Unique.FM.html#seqEltsUFM"><span class="hs-identifier hs-var">seqEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-var">seqDemand</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601471"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-2582"></span><span>
</span><span id="line-2583"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdSig"><span class="hs-identifier hs-type">seqDmdSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2584"></span><span id="seqDmdSig"><span class="annot"><span class="annottext">seqDmdSig :: DmdSig -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdSig"><span class="hs-identifier hs-var hs-var">seqDmdSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span id="local-6989586621681601473"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601473"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier hs-var">seqDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601473"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2585"></span><span>
</span><span id="line-2586"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Outputable and Binary instances
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2593"></span><span>
</span><span id="line-2594"></span><span class="hs-comment">-- Just for debugging purposes.</span><span>
</span><span id="line-2595"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601475"><span id="local-6989586621681601480"><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Show.html#Show/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2596"></span><span>  </span><span id="local-6989586621681601483"><span class="annot"><span class="annottext">show :: Card -&gt; String
</span><a href="#local-6989586621681601483"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;C_00&quot;</span></span><span>
</span><span id="line-2597"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;C_01&quot;</span></span><span>
</span><span id="line-2598"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;C_0N&quot;</span></span><span>
</span><span id="line-2599"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;C_10&quot;</span></span><span>
</span><span id="line-2600"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;C_11&quot;</span></span><span>
</span><span id="line-2601"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;C_1N&quot;</span></span><span>
</span><span id="line-2602"></span><span>
</span><span id="line-2603"></span><span class="hs-comment">{- Note [Demand notation]
~~~~~~~~~~~~~~~~~~~~~~~~~
This Note should be kept up to date with the documentation of `-fstrictness`
in the user's guide.

For pretty-printing demands, we use quite a compact notation with some
abbreviations. Here's the BNF:

  card ::= B                        {}
        |  A                        {0}
        |  M                        {0,1}
        |  L                        {0,1,n}
        |  1                        {1}
        |  S                        {1,n}

  box  ::= !                        Unboxed
        |  &lt;empty&gt;                  Boxed

  d    ::= card sd                  The :* constructor, just juxtaposition
        |  card                     abbreviation: Same as &quot;card card&quot;

  sd   ::= box card                 @Poly box card@
        |  box P(d,d,..)            @Prod box [d1,d2,..]@
        |  Ccard(sd)                @Call card sd@

So, L can denote a 'Card', polymorphic 'SubDemand' or polymorphic 'Demand',
but it's always clear from context which &quot;overload&quot; is meant. It's like
return-type inference of e.g. 'read'.

Examples are in the haddock for 'Demand'.

This is the syntax for demand signatures:

  div ::= &lt;empty&gt;      topDiv
       |  x            exnDiv
       |  b            botDiv

  sig ::= {x-&gt;dx,y-&gt;dy,z-&gt;dz...}&lt;d1&gt;&lt;d2&gt;&lt;d3&gt;...&lt;dn&gt;div
                  ^              ^   ^   ^      ^   ^
                  |              |   |   |      |   |
                  |              \---+---+------/   |
                  |                  |              |
             demand on free        demand on      divergence
               variables           arguments      information
           (omitted if empty)                     (omitted if
                                                no information)


-}</span><span>
</span><span id="line-2652"></span><span>
</span><span id="line-2653"></span><span class="hs-comment">-- | See Note [Demand notation]</span><span>
</span><span id="line-2654"></span><span class="hs-comment">-- Current syntax was discussed in #19016.</span><span>
</span><span id="line-2655"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2656"></span><span>  </span><span id="local-6989586621681601493"><span class="annot"><span class="annottext">ppr :: Card -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span> </span><span class="hs-comment">-- &quot;Absent&quot;</span><span>
</span><span id="line-2657"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'M'</span></span><span> </span><span class="hs-comment">-- &quot;Maybe&quot;</span><span>
</span><span id="line-2658"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'L'</span></span><span> </span><span class="hs-comment">-- &quot;Lazy&quot;</span><span>
</span><span id="line-2659"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'1'</span></span><span> </span><span class="hs-comment">-- &quot;exactly 1&quot;</span><span>
</span><span id="line-2660"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'S'</span></span><span> </span><span class="hs-comment">-- &quot;Strict&quot;</span><span>
</span><span id="line-2661"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'B'</span></span><span> </span><span class="hs-comment">-- &quot;Bottom&quot;</span><span>
</span><span id="line-2662"></span><span>
</span><span id="line-2663"></span><span class="annot"><span class="hs-comment">-- | See Note [Demand notation]</span></span><span>
</span><span id="line-2664"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2665"></span><span>  </span><span id="local-6989586621681601507"><span class="annot"><span class="annottext">ppr :: Demand -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span>
</span><span id="line-2666"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'B'</span></span><span>
</span><span id="line-2667"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'L'</span></span><span> </span><span class="hs-comment">-- Print LL as just L</span><span>
</span><span id="line-2668"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'S'</span></span><span> </span><span class="hs-comment">-- Dito SS</span><span>
</span><span id="line-2669"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601508"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601508"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601509"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601509"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601508"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601509"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2670"></span><span>
</span><span id="line-2671"></span><span class="annot"><span class="hs-comment">-- | See Note [Demand notation]</span></span><span>
</span><span id="line-2672"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2673"></span><span>  </span><span id="local-6989586621681601527"><span class="annot"><span class="annottext">ppr :: SubDemand -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601528"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601528"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601529"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601529"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; SDoc
</span><a href="GHC.Types.Demand.html#pp_boxity"><span class="hs-identifier hs-var">pp_boxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601528"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601529"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2674"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601531"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601531"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601532"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601532"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'C'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601531"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601532"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2675"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601535"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601535"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601536"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601536"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; SDoc
</span><a href="GHC.Types.Demand.html#pp_boxity"><span class="hs-identifier hs-var">pp_boxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601535"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'P'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand] -&gt; SDoc
forall {a}. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="#local-6989586621681601537"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601536"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2676"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2677"></span><span>      </span><span id="local-6989586621681601537"><span class="annot"><span class="annottext">fields :: [a] -&gt; SDoc
</span><a href="#local-6989586621681601537"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-2678"></span><span>      </span><span class="annot"><a href="#local-6989586621681601537"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681601546"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601546"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601546"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-2679"></span><span>      </span><span class="annot"><a href="#local-6989586621681601537"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601547"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601547"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681601548"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681601548"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601547"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">','</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; SDoc
</span><a href="#local-6989586621681601537"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681601548"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2680"></span><span>
</span><span id="line-2681"></span><span class="annot"><a href="GHC.Types.Demand.html#pp_boxity"><span class="hs-identifier hs-type">pp_boxity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2682"></span><span id="pp_boxity"><span class="annot"><span class="annottext">pp_boxity :: Boxity -&gt; SDoc
</span><a href="GHC.Types.Demand.html#pp_boxity"><span class="hs-identifier hs-var hs-var">pp_boxity</span></a></span></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'!'</span></span><span>
</span><span id="line-2683"></span><span class="annot"><a href="GHC.Types.Demand.html#pp_boxity"><span class="hs-identifier hs-var">pp_boxity</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-2684"></span><span>
</span><span id="line-2685"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2686"></span><span>  </span><span id="local-6989586621681601554"><span class="annot"><span class="annottext">ppr :: Divergence -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'b'</span></span><span> </span><span class="hs-comment">-- for (b)ottom</span><span>
</span><span id="line-2687"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span> </span><span class="hs-comment">-- for e(x)ception</span><span>
</span><span id="line-2688"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-2689"></span><span>
</span><span id="line-2690"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2691"></span><span>  </span><span id="local-6989586621681601566"><span class="annot"><span class="annottext">ppr :: DmdEnv -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span id="local-6989586621681601567"><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601567"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681601568"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601568"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2692"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601568"><span class="hs-identifier hs-var">div</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(Unique, Demand)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Demand)]
</span><a href="#local-6989586621681601570"><span class="hs-identifier hs-var">fv_elts</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-2693"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Unique, Demand) -&gt; SDoc) -&gt; [(Unique, Demand)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Unique, Demand) -&gt; SDoc
forall {a} {a}. (Outputable a, Outputable a) =&gt; (a, a) -&gt; SDoc
</span><a href="#local-6989586621681601573"><span class="hs-identifier hs-var">pp_elt</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Demand)]
</span><a href="#local-6989586621681601570"><span class="hs-identifier hs-var">fv_elts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2694"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2695"></span><span>      </span><span id="local-6989586621681601573"><span class="annot"><span class="annottext">pp_elt :: (a, a) -&gt; SDoc
</span><a href="#local-6989586621681601573"><span class="hs-identifier hs-var hs-var">pp_elt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601581"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601581"><span class="hs-identifier hs-var">uniq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681601582"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601582"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601581"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681601582"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-2696"></span><span>      </span><span id="local-6989586621681601570"><span class="annot"><span class="annottext">fv_elts :: [(Unique, Demand)]
</span><a href="#local-6989586621681601570"><span class="hs-identifier hs-var hs-var">fv_elts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; [(Unique, Demand)]
forall key elt. UniqFM key elt -&gt; [(Unique, elt)]
</span><a href="GHC.Types.Unique.FM.html#nonDetUFMToList"><span class="hs-identifier hs-var">nonDetUFMToList</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><a href="#local-6989586621681601567"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-2697"></span><span>        </span><span class="hs-comment">-- It's OK to use nonDetUFMToList here because we only do it for</span><span>
</span><span id="line-2698"></span><span>        </span><span class="hs-comment">-- pretty printing</span><span>
</span><span id="line-2699"></span><span>
</span><span id="line-2700"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2701"></span><span>  </span><span id="local-6989586621681601590"><span class="annot"><span class="annottext">ppr :: DmdType -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601591"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601591"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601592"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601592"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2702"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Demand -&gt; SDoc) -&gt; [Demand] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#angleBrackets"><span class="hs-identifier hs-var">angleBrackets</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; (Demand -&gt; SDoc) -&gt; Demand -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601592"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601591"><span class="hs-identifier hs-var">fv</span></a></span><span>
</span><span id="line-2703"></span><span>
</span><span id="line-2704"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2705"></span><span>   </span><span id="local-6989586621681601597"><span class="annot"><span class="annottext">ppr :: DmdSig -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span id="local-6989586621681601598"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601598"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601598"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2706"></span><span>
</span><span id="line-2707"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2708"></span><span>  </span><span id="local-6989586621681601611"><span class="annot"><span class="annottext">ppr :: TypeShape -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="GHC.Types.Demand.html#TsUnk"><span class="hs-identifier hs-var">TsUnk</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TsUnk&quot;</span></span><span>
</span><span id="line-2709"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsFun"><span class="hs-identifier hs-type">TsFun</span></a></span><span> </span><span id="local-6989586621681601612"><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621681601612"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TsFun&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeShape -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621681601612"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2710"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsProd"><span class="hs-identifier hs-type">TsProd</span></a></span><span> </span><span id="local-6989586621681601613"><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621681601613"><span class="hs-identifier hs-var">tss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeShape -&gt; SDoc) -&gt; [TypeShape] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TypeShape -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621681601613"><span class="hs-identifier hs-var">tss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2711"></span><span>
</span><span id="line-2712"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601618"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2713"></span><span>  </span><span id="local-6989586621681601630"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; Card -&gt; IO ()
</span><a href="#local-6989586621681601630"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621681601632"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601632"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601632"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2714"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601634"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601634"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601634"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2715"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601635"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601635"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601635"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span>
</span><span id="line-2716"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601636"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601636"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601636"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span>
</span><span id="line-2717"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601637"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601637"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601637"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">4</span></span><span>
</span><span id="line-2718"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601638"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601638"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601638"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">5</span></span><span>
</span><span id="line-2719"></span><span>  </span><span id="local-6989586621681601666"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO Card
</span><a href="#local-6989586621681601666"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681601668"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601668"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2720"></span><span>    </span><span id="local-6989586621681601669"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601669"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Word8
</span><a href="GHC.Utils.Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601668"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2721"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601669"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2722"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; IO Card
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-2723"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; IO Card
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span>
</span><span id="line-2724"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; IO Card
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-2725"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; IO Card
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span>
</span><span id="line-2726"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; IO Card
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-2727"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; IO Card
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-2728"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO Card
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Binary:Card&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601669"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2729"></span><span>
</span><span id="line-2730"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601673"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2731"></span><span>  </span><span id="local-6989586621681601685"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; Demand -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621681601686"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601686"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681601687"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601687"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621681601688"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601688"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Card -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601686"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601687"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601687"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2732"></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2733"></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2734"></span><span>    </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; SubDemand -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601686"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601688"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2735"></span><span>  </span><span id="local-6989586621681601697"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO Demand
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681601698"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601698"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Card
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601698"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">IO Card -&gt; (Card -&gt; IO Demand) -&gt; IO Demand
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681601699"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601699"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601699"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2736"></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; IO Demand
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#AbsDmd"><span class="hs-identifier hs-var">AbsDmd</span></a></span><span>
</span><span id="line-2737"></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; IO Demand
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#BotDmd"><span class="hs-identifier hs-var">BotDmd</span></a></span><span>
</span><span id="line-2738"></span><span>    </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601699"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Card -&gt; SubDemand -&gt; Demand
Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SubDemand -&gt; Demand) -&gt; IO SubDemand -&gt; IO Demand
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO SubDemand
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601698"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2739"></span><span>
</span><span id="line-2740"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601703"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2741"></span><span>  </span><span id="local-6989586621681601724"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; SubDemand -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621681601725"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601725"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621681601726"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601726"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601727"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601727"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601725"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Boxity -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601725"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601726"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Card -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601725"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601727"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2742"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601728"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601728"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621681601729"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601729"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681601730"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601730"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601728"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Card -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601728"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621681601729"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; SubDemand -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601728"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621681601730"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-2743"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601731"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601731"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621681601732"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601732"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681601733"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601733"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601731"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Boxity -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601731"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681601732"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; [Demand] -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601731"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601733"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-2744"></span><span>  </span><span id="local-6989586621681601759"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO SubDemand
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681601760"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2745"></span><span>    </span><span id="local-6989586621681601761"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601761"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Word8
</span><a href="GHC.Utils.Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2746"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601761"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2747"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">(Boxity -&gt; Card -&gt; SubDemand)
-&gt; IO Boxity -&gt; IO (Card -&gt; SubDemand)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Boxity
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Card -&gt; SubDemand) -&gt; IO Card -&gt; IO SubDemand
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Card
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2748"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">(Card -&gt; SubDemand -&gt; SubDemand)
-&gt; IO Card -&gt; IO (SubDemand -&gt; SubDemand)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Card
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">IO (SubDemand -&gt; SubDemand) -&gt; IO SubDemand -&gt; IO SubDemand
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO SubDemand
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2749"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">(Boxity -&gt; [Demand] -&gt; SubDemand)
-&gt; IO Boxity -&gt; IO ([Demand] -&gt; SubDemand)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Boxity
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">IO ([Demand] -&gt; SubDemand) -&gt; IO [Demand] -&gt; IO SubDemand
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO [Demand]
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601760"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2750"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO SubDemand
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Binary:SubDemand&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601761"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2751"></span><span>
</span><span id="line-2752"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601764"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2753"></span><span>  </span><span id="local-6989586621681601771"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; Divergence -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621681601772"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601772"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601772"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2754"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601773"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601773"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601773"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2755"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621681601774"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601774"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601774"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span>
</span><span id="line-2756"></span><span>  </span><span id="local-6989586621681601790"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO Divergence
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681601791"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601791"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2757"></span><span>    </span><span id="local-6989586621681601792"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601792"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Word8
</span><a href="GHC.Utils.Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601791"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2758"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601792"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2759"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; IO Divergence
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-2760"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; IO Divergence
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-2761"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; IO Divergence
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-2762"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IO Divergence
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Binary:Divergence&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621681601792"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2763"></span><span>
</span><span id="line-2764"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601795"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2765"></span><span>  </span><span class="hs-comment">-- Ignore VarEnv when spitting out the DmdType</span><span>
</span><span id="line-2766"></span><span>  </span><span id="local-6989586621681601800"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; DmdEnv -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621681601801"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601801"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-type">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681601802"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601802"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Divergence -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601801"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621681601802"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2767"></span><span>  </span><span id="local-6989586621681601805"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO DmdEnv
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681601806"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601806"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Demand -&gt; Divergence -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#DE"><span class="hs-identifier hs-var">DE</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Demand
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Divergence -&gt; DmdEnv) -&gt; IO Divergence -&gt; IO DmdEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Divergence
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601806"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2768"></span><span>
</span><span id="line-2769"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601809"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2770"></span><span>  </span><span id="local-6989586621681601817"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; DmdType -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621681601818"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601818"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621681601819"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601819"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621681601820"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601820"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; DmdEnv -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601818"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621681601819"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2A%3E/GHC.Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; [Demand] -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601818"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621681601820"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-2771"></span><span>  </span><span id="local-6989586621681601826"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO DmdType
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681601827"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601827"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdEnv -&gt; [Demand] -&gt; DmdType)
-&gt; IO DmdEnv -&gt; IO ([Demand] -&gt; DmdType)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO DmdEnv
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601827"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">IO ([Demand] -&gt; DmdType) -&gt; IO [Demand] -&gt; IO DmdType
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO [Demand]
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601827"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2772"></span><span>
</span><span id="line-2773"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681601830"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2774"></span><span>  </span><span id="local-6989586621681601835"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; DmdSig -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621681601836"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601836"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-type">DmdSig</span></a></span><span> </span><span id="local-6989586621681601837"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601837"><span class="hs-identifier hs-var">aa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; DmdType -&gt; IO ()
forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601836"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621681601837"><span class="hs-identifier hs-var">aa</span></a></span><span>
</span><span id="line-2775"></span><span>  </span><span id="local-6989586621681601840"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO DmdSig
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681601841"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601841"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#DmdSig"><span class="hs-identifier hs-var">DmdSig</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdType -&gt; DmdSig) -&gt; IO DmdType -&gt; IO DmdSig
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO DmdType
forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621681601841"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-2776"></span></pre></body></html>