<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">-- | Handling of C foreign imports/exports</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.HsToCore.Foreign.C</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCImport"><span class="hs-identifier">dsCImport</span></a></span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCFExport"><span class="hs-identifier">dsCFExport</span></a></span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCFExportDynamic"><span class="hs-identifier">dsCFExportDynamic</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>        </span><span class="hs-comment">-- temp</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unfold.Make.html"><span class="hs-identifier">GHC.Core.Unfold.Make</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.Call.html"><span class="hs-identifier">GHC.HsToCore.Foreign.Call</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.Prim.html"><span class="hs-identifier">GHC.HsToCore.Foreign.Prim</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Foreign.Utils.html"><span class="hs-identifier">GHC.HsToCore.Foreign.Utils</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html"><span class="hs-identifier">GHC.HsToCore.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#ds_next_wrapper_num"><span class="hs-identifier">ds_next_wrapper_num</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html"><span class="hs-identifier">GHC.Types.ForeignStubs</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html"><span class="hs-identifier">GHC.Types.ForeignCall</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.html"><span class="hs-identifier">GHC.Driver.Config</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Expr.html"><span class="hs-identifier">GHC.Cmm.Expr</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.Utils.Encoding.html#/GHC.Utils.Encoding.html"><span class="hs-identifier">GHC.Utils.Encoding</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.OldList.html#nub/Data.OldList.html#nub"><span class="hs-identifier">nub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCFExport"><span class="hs-identifier hs-type">dsCFExport</span></a></span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>                 </span><span class="hs-comment">-- Either the exported Id,</span><span>
</span><span id="line-66"></span><span>                                </span><span class="hs-comment">-- or the foreign-export-dynamic constructor</span><span>
</span><span id="line-67"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>           </span><span class="hs-comment">-- Coercion between the Haskell type callable</span><span>
</span><span id="line-68"></span><span>                                </span><span class="hs-comment">-- from C, and its representation type</span><span>
</span><span id="line-69"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CLabelString"><span class="hs-identifier hs-type">CLabelString</span></a></span><span>       </span><span class="hs-comment">-- The name to export to C land</span><span>
</span><span id="line-70"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-71"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>               </span><span class="hs-comment">-- True =&gt; foreign export dynamic</span><span>
</span><span id="line-72"></span><span>                                </span><span class="hs-comment">--         so invoke IO action that's hanging off</span><span>
</span><span id="line-73"></span><span>                                </span><span class="hs-comment">--         the first argument's stable pointer</span><span>
</span><span id="line-74"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span>      </span><span class="hs-comment">-- contents of Module_stub.h</span><span>
</span><span id="line-75"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span>        </span><span class="hs-comment">-- contents of Module_stub.c</span><span>
</span><span id="line-76"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>       </span><span class="hs-comment">-- string describing type to pass to createAdj.</span><span>
</span><span id="line-77"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>          </span><span class="hs-comment">-- size of args to stub function</span><span>
</span><span id="line-78"></span><span>                 </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span id="dsCFExport"><span class="annot"><span class="annottext">dsCFExport :: Id
-&gt; Coercion
-&gt; CLabelString
-&gt; CCallConv
-&gt; Bool
-&gt; DsM (CHeader, CStub, String, Int)
</span><a href="GHC.HsToCore.Foreign.C.html#dsCFExport"><span class="hs-identifier hs-var hs-var">dsCFExport</span></a></span></span><span> </span><span id="local-6989586621682044770"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044770"><span class="hs-identifier hs-var">fn_id</span></a></span></span><span> </span><span id="local-6989586621682044771"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044771"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682044772"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044772"><span class="hs-identifier hs-var">ext_name</span></a></span></span><span> </span><span id="local-6989586621682044773"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044773"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span id="local-6989586621682044774"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044774"><span class="hs-identifier hs-var">isDyn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-82"></span><span>       </span><span id="local-6989586621682044775"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682044775"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044771"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-83"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682044777"><span class="annot"><span class="annottext">[PiTyVarBinder]
</span><a href="#local-6989586621682044777"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044778"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044778"><span class="hs-identifier hs-var">orig_res_ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([PiTyVarBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPiTys"><span class="hs-identifier hs-var">tcSplitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044775"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-84"></span><span>       </span><span id="local-6989586621682044780"><span class="annot"><span class="annottext">fe_arg_tys' :: [Type]
</span><a href="#local-6989586621682044780"><span class="hs-identifier hs-var hs-var">fe_arg_tys'</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PiTyVarBinder -&gt; Maybe Type) -&gt; [PiTyVarBinder] -&gt; [Type]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; Maybe Type
</span><a href="GHC.Types.Var.html#anonPiTyBinderType_maybe"><span class="hs-identifier hs-var">anonPiTyBinderType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[PiTyVarBinder]
</span><a href="#local-6989586621682044777"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-85"></span><span>       </span><span class="hs-comment">-- We must use tcSplits here, because we want to see</span><span>
</span><span id="line-86"></span><span>       </span><span class="hs-comment">-- the (IO t) in the corner of the type!</span><span>
</span><span id="line-87"></span><span>       </span><span id="local-6989586621682044783"><span class="annot"><span class="annottext">fe_arg_tys :: [Type]
</span><a href="#local-6989586621682044783"><span class="hs-identifier hs-var hs-var">fe_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044774"><span class="hs-identifier hs-var">isDyn</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#tail/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682044780"><span class="hs-identifier hs-var">fe_arg_tys'</span></a></span><span>
</span><span id="line-88"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682044780"><span class="hs-identifier hs-var">fe_arg_tys'</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>       </span><span class="hs-comment">-- Look at the result type of the exported function, orig_res_ty</span><span>
</span><span id="line-91"></span><span>       </span><span class="hs-comment">-- If it's IO t, return         (t, True)</span><span>
</span><span id="line-92"></span><span>       </span><span class="hs-comment">-- If it's plain t, return      (t, False)</span><span>
</span><span id="line-93"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682044785"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044785"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044786"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044786"><span class="hs-identifier hs-var">is_IO_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044778"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-94"></span><span>                                </span><span class="hs-comment">-- The function already returns IO t</span><span>
</span><span id="line-95"></span><span>                                </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682044788"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044788"><span class="hs-identifier hs-var">_ioTyCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044789"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044789"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044789"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>                                </span><span class="hs-comment">-- The function returns t</span><span>
</span><span id="line-97"></span><span>                                </span><span class="annot"><span class="annottext">Maybe (TyCon, Type)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044778"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621682044790"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682044790"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">(CHeader, CStub, String, Int) -&gt; DsM (CHeader, CStub, String, Int)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">((CHeader, CStub, String, Int)
 -&gt; DsM (CHeader, CStub, String, Int))
-&gt; (CHeader, CStub, String, Int)
-&gt; DsM (CHeader, CStub, String, Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">DynFlags
-&gt; CLabelString
-&gt; Maybe Id
-&gt; [Type]
-&gt; Type
-&gt; Bool
-&gt; CCallConv
-&gt; (CHeader, CStub, String, Int)
</span><a href="GHC.HsToCore.Foreign.C.html#mkFExportCBits"><span class="hs-identifier hs-var">mkFExportCBits</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682044790"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044772"><span class="hs-identifier hs-var">ext_name</span></a></span><span>
</span><span id="line-102"></span><span>                     </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044774"><span class="hs-identifier hs-var">isDyn</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Id
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe Id
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044770"><span class="hs-identifier hs-var">fn_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                     </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682044783"><span class="hs-identifier hs-var">fe_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044785"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044786"><span class="hs-identifier hs-var">is_IO_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044773"><span class="hs-identifier hs-var">cconv</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCImport"><span class="hs-identifier hs-type">dsCImport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-106"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-107"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CImportSpec"><span class="hs-identifier hs-type">CImportSpec</span></a></span><span>
</span><span id="line-108"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-109"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Safety"><span class="hs-identifier hs-type">Safety</span></a></span><span>
</span><span id="line-110"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span>
</span><span id="line-111"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Foreign.Utils.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span id="dsCImport"><span class="annot"><span class="annottext">dsCImport :: Id
-&gt; Coercion
-&gt; CImportSpec
-&gt; CCallConv
-&gt; Safety
-&gt; Maybe Header
-&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.C.html#dsCImport"><span class="hs-identifier hs-var hs-var">dsCImport</span></a></span></span><span> </span><span id="local-6989586621682044793"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044793"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682044794"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044794"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a></span><span> </span><span id="local-6989586621682044796"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044796"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682044797"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044797"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>   </span><span id="local-6989586621682044798"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682044798"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-114"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682044799"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682044799"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044794"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-115"></span><span>       </span><span id="local-6989586621682044801"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682044801"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682044798"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-116"></span><span>       </span><span id="local-6989586621682044803"><span class="annot"><span class="annottext">fod :: FunctionOrData
</span><a href="#local-6989586621682044803"><span class="hs-identifier hs-var hs-var">fod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Core.Type.html#dropForAlls"><span class="hs-identifier hs-var">dropForAlls</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044799"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>             </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682044806"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044806"><span class="hs-identifier hs-var">tycon</span></a></span></span><span>
</span><span id="line-118"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique
</span><a href="GHC.Core.TyCon.html#tyConUnique"><span class="hs-identifier hs-var">tyConUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044806"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#funPtrTyConKey"><span class="hs-identifier hs-var">funPtrTyConKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>                 </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span>
</span><span id="line-120"></span><span>             </span><span class="annot"><span class="annottext">Maybe TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsData"><span class="hs-identifier hs-var">IsData</span></a></span><span>
</span><span id="line-121"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621682044811"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682044811"><span class="hs-identifier hs-var">resTy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044812"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682044812"><span class="hs-identifier hs-var">foRhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Maybe Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.Call.html#resultWrapper"><span class="hs-identifier hs-var">resultWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044799"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-122"></span><span>   </span><span class="annot"><span class="annottext">Bool
-&gt; DsM ([Binding], CHeader, CStub)
-&gt; DsM ([Binding], CHeader, CStub)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Type -&gt; Type
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#fromJust/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682044811"><span class="hs-identifier hs-var">resTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#addrPrimTy"><span class="hs-identifier hs-var">addrPrimTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DsM ([Binding], CHeader, CStub)
 -&gt; DsM ([Binding], CHeader, CStub))
-&gt; DsM ([Binding], CHeader, CStub)
-&gt; DsM ([Binding], CHeader, CStub)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>    </span><span class="hs-comment">-- typechecker ensures this</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-124"></span><span>        </span><span id="local-6989586621682044818"><span class="annot"><span class="annottext">rhs :: CoreExpr
</span><a href="#local-6989586621682044818"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682044812"><span class="hs-identifier hs-var">foRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabelString -&gt; Maybe Int -&gt; FunctionOrData -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-var">LitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044796"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682044821"><span class="hs-identifier hs-var">stdcall_info</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="#local-6989586621682044803"><span class="hs-identifier hs-var">fod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>        </span><span id="local-6989586621682044822"><span class="annot"><span class="annottext">rhs' :: CoreExpr
</span><a href="#local-6989586621682044822"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682044818"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044794"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621682044821"><span class="annot"><span class="annottext">stdcall_info :: Maybe Int
</span><a href="#local-6989586621682044821"><span class="hs-identifier hs-var hs-var">stdcall_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; CCallConv -&gt; Type -&gt; Maybe Int
</span><a href="GHC.HsToCore.Foreign.C.html#fun_type_arg_stdcall_info"><span class="hs-identifier hs-var">fun_type_arg_stdcall_info</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682044801"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044797"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044799"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">([Binding], CHeader, CStub) -&gt; DsM ([Binding], CHeader, CStub)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044793"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682044822"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CHeader
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CStub
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCImport"><span class="hs-identifier hs-var">dsCImport</span></a></span><span> </span><span id="local-6989586621682044825"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044825"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682044826"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044826"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CFunction"><span class="hs-identifier hs-type">CFunction</span></a></span><span> </span><span id="local-6989586621682044828"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682044828"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682044829"><span class="annot"><span class="annottext">cconv :: CCallConv
</span><a href="#local-6989586621682044829"><span class="hs-identifier hs-var">cconv</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#PrimCallConv"><span class="hs-identifier hs-var">PrimCallConv</span></a></span><span> </span><span id="local-6989586621682044831"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682044831"><span class="hs-identifier hs-var">safety</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Coercion -&gt; ForeignCall -&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.Prim.html#dsPrimCall"><span class="hs-identifier hs-var">dsPrimCall</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044825"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044826"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallSpec -&gt; ForeignCall
</span><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-var">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallTarget -&gt; CCallConv -&gt; Safety -&gt; CCallSpec
</span><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-var">CCallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682044828"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044829"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682044831"><span class="hs-identifier hs-var">safety</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCImport"><span class="hs-identifier hs-var">dsCImport</span></a></span><span> </span><span id="local-6989586621682044835"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044835"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682044836"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044836"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#CFunction"><span class="hs-identifier hs-type">CFunction</span></a></span><span> </span><span id="local-6989586621682044837"><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682044837"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682044838"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044838"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span id="local-6989586621682044839"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682044839"><span class="hs-identifier hs-var">safety</span></a></span></span><span> </span><span id="local-6989586621682044840"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044840"><span class="hs-identifier hs-var">mHeader</span></a></span></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; Coercion
-&gt; ForeignCall
-&gt; Maybe Header
-&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.C.html#dsFCall"><span class="hs-identifier hs-var">dsFCall</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044835"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044836"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallSpec -&gt; ForeignCall
</span><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-var">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallTarget -&gt; CCallConv -&gt; Safety -&gt; CCallSpec
</span><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-var">CCallSpec</span></a></span><span> </span><span class="annot"><span class="annottext">CCallTarget
</span><a href="#local-6989586621682044837"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044838"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682044839"><span class="hs-identifier hs-var">safety</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044840"><span class="hs-identifier hs-var">mHeader</span></a></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCImport"><span class="hs-identifier hs-var">dsCImport</span></a></span><span> </span><span id="local-6989586621682044842"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044842"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682044843"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044843"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="annottext">CImportSpec
</span><a href="Language.Haskell.Syntax.Decls.html#CWrapper"><span class="hs-identifier hs-var">CWrapper</span></a></span><span> </span><span id="local-6989586621682044845"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044845"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Coercion -&gt; CCallConv -&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.C.html#dsCFExportDynamic"><span class="hs-identifier hs-var">dsCFExportDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044842"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044843"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044845"><span class="hs-identifier hs-var">cconv</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">{-
@foreign import &quot;wrapper&quot;@ (previously &quot;foreign export dynamic&quot;) lets
you dress up Haskell IO actions of some fixed type behind an
externally callable interface (i.e., as a C function pointer). Useful
for callbacks and stuff.

\begin{verbatim}
type Fun = Bool -&gt; Int -&gt; IO Int
foreign import &quot;wrapper&quot; f :: Fun -&gt; IO (FunPtr Fun)

-- Haskell-visible constructor, which is generated from the above:
-- SUP: No check for NULL from createAdjustor anymore???

f :: Fun -&gt; IO (FunPtr Fun)
f cback =
   bindIO (newStablePtr cback)
          (\StablePtr sp# -&gt; IO (\s1# -&gt;
              case _ccall_ createAdjustor cconv sp# ``f_helper'' &lt;arg info&gt; s1# of
                 (# s2#, a# #) -&gt; (# s2#, A# a# #)))

foreign import &quot;&amp;f_helper&quot; f_helper :: FunPtr (StablePtr Fun -&gt; Fun)

-- and the helper in C: (approximately; see `mkFExportCBits` below)

f_helper(StablePtr s, HsBool b, HsInt i)
{
        Capability *cap;
        cap = rts_lock();
        rts_inCall(&amp;cap,
                   rts_apply(rts_apply(deRefStablePtr(s),
                                       rts_mkBool(b)), rts_mkInt(i)));
        rts_unlock(cap);
}
\end{verbatim}
-}</span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsCFExportDynamic"><span class="hs-identifier hs-type">dsCFExportDynamic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-174"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-175"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-176"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Foreign.Utils.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span id="dsCFExportDynamic"><span class="annot"><span class="annottext">dsCFExportDynamic :: Id -&gt; Coercion -&gt; CCallConv -&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.C.html#dsCFExportDynamic"><span class="hs-identifier hs-var hs-var">dsCFExportDynamic</span></a></span></span><span> </span><span id="local-6989586621682044846"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044846"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621682044847"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044847"><span class="hs-identifier hs-var">co0</span></a></span></span><span> </span><span id="local-6989586621682044848"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044848"><span class="hs-identifier hs-var">cconv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621682044849"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682044849"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621682044851"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682044851"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682044852"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682044852"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682044851"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682044853"><span class="annot"><span class="annottext">fe_nm :: CLabelString
</span><a href="#local-6989586621682044853"><span class="hs-identifier hs-var hs-var">fe_nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; CLabelString) -&gt; String -&gt; CLabelString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../ghc-boot-9.6.6/src/GHC.Utils.Encoding.html#zEncodeString/GHC.Utils.Encoding.html#zEncodeString"><span class="hs-identifier hs-var">zEncodeString</span></a></span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; String
</span><a href="GHC.Unit.Module.html#moduleStableString"><span class="hs-identifier hs-var">moduleStableString</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682044849"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; String
</span><a href="GHC.HsToCore.Foreign.C.html#toCName"><span class="hs-identifier hs-var">toCName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044846"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-comment">-- Construct the label based on the passed id, don't use names</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- depending on Unique. See #13807 and Note [Unique Determinism].</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621682044858"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044858"><span class="hs-identifier hs-var">cback</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044860"><span class="hs-identifier hs-var">arg_mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044861"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621682044862"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044862"><span class="hs-identifier hs-var">newStablePtrId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#newStablePtrName"><span class="hs-identifier hs-var">newStablePtrName</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span id="local-6989586621682044865"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044865"><span class="hs-identifier hs-var">stable_ptr_tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var">dsLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#stablePtrTyConName"><span class="hs-identifier hs-var">stablePtrTyConName</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-189"></span><span>        </span><span id="local-6989586621682044868"><span class="annot"><span class="annottext">stable_ptr_ty :: Type
</span><a href="#local-6989586621682044868"><span class="hs-identifier hs-var hs-var">stable_ptr_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044865"><span class="hs-identifier hs-var">stable_ptr_tycon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044861"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>        </span><span id="local-6989586621682044870"><span class="annot"><span class="annottext">export_ty :: Type
</span><a href="#local-6989586621682044870"><span class="hs-identifier hs-var hs-var">export_ty</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type -&gt; Type
Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-var">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044868"><span class="hs-identifier hs-var">stable_ptr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044861"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621682044872"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044872"><span class="hs-identifier hs-var">bindIOId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#bindIOName"><span class="hs-identifier hs-var">bindIOName</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621682044874"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044874"><span class="hs-identifier hs-var">stbl_value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044868"><span class="hs-identifier hs-var">stable_ptr_ty</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682044876"><span class="annot"><span class="annottext">CHeader
</span><a href="#local-6989586621682044876"><span class="hs-identifier hs-var">h_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044877"><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621682044877"><span class="hs-identifier hs-var">c_code</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044878"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682044878"><span class="hs-identifier hs-var">typestring</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044879"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682044879"><span class="hs-identifier hs-var">args_size</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; Coercion
-&gt; CLabelString
-&gt; CCallConv
-&gt; Bool
-&gt; DsM (CHeader, CStub, String, Int)
</span><a href="GHC.HsToCore.Foreign.C.html#dsCFExport"><span class="hs-identifier hs-var">dsCFExport</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044846"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier hs-var">mkRepReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044870"><span class="hs-identifier hs-var">export_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044853"><span class="hs-identifier hs-var">fe_nm</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044848"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-195"></span><span>         </span><span class="hs-comment">{-
          The arguments to the external function which will
          create a little bit of (template) code on the fly
          for allowing the (stable pointed) Haskell closure
          to be entered using an external calling convention
          (stdcall, ccall).
         -}</span><span>
</span><span id="line-202"></span><span>        </span><span id="local-6989586621682044881"><span class="annot"><span class="annottext">adj_args :: [CoreExpr]
</span><a href="#local-6989586621682044881"><span class="hs-identifier hs-var hs-var">adj_args</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Integer -&gt; CoreExpr
forall b. Platform -&gt; Integer -&gt; Expr b
</span><a href="GHC.Core.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682044852"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallConv -&gt; Int
</span><a href="GHC.Types.ForeignCall.html#ccallConvToInt"><span class="hs-identifier hs-var">ccallConvToInt</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044848"><span class="hs-identifier hs-var">cconv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044874"><span class="hs-identifier hs-var">stbl_value</span></a></span><span>
</span><span id="line-204"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabelString -&gt; Maybe Int -&gt; FunctionOrData -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitLabel"><span class="hs-identifier hs-var">LitLabel</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044853"><span class="hs-identifier hs-var">fe_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621682044885"><span class="hs-identifier hs-var">mb_sz_args</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionOrData
</span><a href="GHC.Types.Basic.html#IsFunction"><span class="hs-identifier hs-var">IsFunction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitString"><span class="hs-identifier hs-var">mkLitString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682044878"><span class="hs-identifier hs-var">typestring</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>          </span><span class="hs-comment">-- name of external entry point providing these services.</span><span>
</span><span id="line-208"></span><span>          </span><span class="hs-comment">-- (probably in the RTS.)</span><span>
</span><span id="line-209"></span><span>        </span><span id="local-6989586621682044887"><span class="annot"><span class="annottext">adjustor :: CLabelString
</span><a href="#local-6989586621682044887"><span class="hs-identifier hs-var hs-var">adjustor</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;createAdjustor&quot;</span></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-comment">-- Determine the number of bytes of arguments to the stub function,</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-comment">-- so that we can attach the '@N' suffix to its label if it is a</span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-comment">-- stdcall on Windows.</span><span>
</span><span id="line-214"></span><span>        </span><span id="local-6989586621682044885"><span class="annot"><span class="annottext">mb_sz_args :: Maybe Int
</span><a href="#local-6989586621682044885"><span class="hs-identifier hs-var hs-var">mb_sz_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682044848"><span class="hs-identifier hs-var">cconv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-215"></span><span>                        </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#StdCallConv"><span class="hs-identifier hs-var">StdCallConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682044879"><span class="hs-identifier hs-var">args_size</span></a></span><span>
</span><span id="line-216"></span><span>                        </span><span class="annot"><span class="annottext">CCallConv
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621682044890"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682044890"><span class="hs-identifier hs-var">ccall_adj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; [CoreExpr] -&gt; Safety -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Foreign.Call.html#dsCCall"><span class="hs-identifier hs-var">dsCCall</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044887"><span class="hs-identifier hs-var">adjustor</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682044881"><span class="hs-identifier hs-var">adj_args</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="GHC.Types.ForeignCall.html#PlayRisky"><span class="hs-identifier hs-var">PlayRisky</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044893"><span class="hs-identifier hs-var">io_tc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044894"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-comment">-- PlayRisky: the adjustor doesn't allocate in the Haskell heap or do a callback</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682044895"><span class="annot"><span class="annottext">io_app :: CoreExpr
</span><a href="#local-6989586621682044895"><span class="hs-identifier hs-var hs-var">io_app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044897"><span class="hs-identifier hs-var">tvs</span></a></span><span>                  </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-222"></span><span>                 </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044858"><span class="hs-identifier hs-var">cback</span></a></span><span>                   </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-223"></span><span>                 </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044872"><span class="hs-identifier hs-var">bindIOId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044868"><span class="hs-identifier hs-var">stable_ptr_ty</span></a></span><span>
</span><span id="line-225"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044894"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-226"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044862"><span class="hs-identifier hs-var">newStablePtrId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044861"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044858"><span class="hs-identifier hs-var">cback</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044874"><span class="hs-identifier hs-var">stbl_value</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682044890"><span class="hs-identifier hs-var">ccall_adj</span></a></span><span>
</span><span id="line-228"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621682044901"><span class="annot"><span class="annottext">fed :: Binding
</span><a href="#local-6989586621682044901"><span class="hs-identifier hs-var hs-var">fed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044846"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Activation -&gt; Id
</span><a href="GHC.Types.Id.html#setInlineActivation"><span class="hs-operator hs-var">`setInlineActivation`</span></a></span><span> </span><span class="annot"><span class="annottext">Activation
</span><a href="GHC.Types.Basic.html#NeverActive"><span class="hs-identifier hs-var">NeverActive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682044895"><span class="hs-identifier hs-var">io_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044847"><span class="hs-identifier hs-var">co0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>               </span><span class="hs-comment">-- Never inline the f.e.d. function, because the litlit</span><span>
</span><span id="line-232"></span><span>               </span><span class="hs-comment">-- might not be in scope in other modules.</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">([Binding], CHeader, CStub) -&gt; DsM ([Binding], CHeader, CStub)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Binding
</span><a href="#local-6989586621682044901"><span class="hs-identifier hs-var">fed</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CHeader
</span><a href="#local-6989586621682044876"><span class="hs-identifier hs-var">h_code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CStub
</span><a href="#local-6989586621682044877"><span class="hs-identifier hs-var">c_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621682044904"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621682044904"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044847"><span class="hs-identifier hs-var">co0</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682044897"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044897"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682044905"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044905"><span class="hs-identifier hs-var">sans_foralls</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Id], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllInvisTyVars"><span class="hs-identifier hs-var">tcSplitForAllInvisTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044904"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682044860"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044860"><span class="hs-identifier hs-var">arg_mult</span></a></span></span><span> </span><span id="local-6989586621682044861"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044861"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044908"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044908"><span class="hs-identifier hs-var">fn_res_ty</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044905"><span class="hs-identifier hs-var">sans_foralls</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682044893"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044893"><span class="hs-identifier hs-var">io_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044894"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044894"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044908"><span class="hs-identifier hs-var">fn_res_ty</span></a></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-comment">-- Must have an IO type; hence Just</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="annot"><span class="hs-comment">-- | Foreign calls</span></span><span>
</span><span id="line-245"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#dsFCall"><span class="hs-identifier hs-type">dsFCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#ForeignCall"><span class="hs-identifier hs-type">ForeignCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span id="dsFCall"><span class="annot"><span class="annottext">dsFCall :: Id
-&gt; Coercion
-&gt; ForeignCall
-&gt; Maybe Header
-&gt; DsM ([Binding], CHeader, CStub)
</span><a href="GHC.HsToCore.Foreign.C.html#dsFCall"><span class="hs-identifier hs-var hs-var">dsFCall</span></a></span></span><span> </span><span id="local-6989586621682044911"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044911"><span class="hs-identifier hs-var">fn_id</span></a></span></span><span> </span><span id="local-6989586621682044912"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044912"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682044913"><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682044913"><span class="hs-identifier hs-var">fcall</span></a></span></span><span> </span><span id="local-6989586621682044914"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044914"><span class="hs-identifier hs-var">mDeclHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682044915"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044915"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682044916"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044916"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044912"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044912"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682044917"><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682044917"><span class="hs-identifier hs-var">tv_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044918"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044918"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVarBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinders"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044915"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682044920"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682044920"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044921"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044921"><span class="hs-identifier hs-var">io_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044918"><span class="hs-identifier hs-var">rho</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682044922"><span class="annot"><span class="annottext">constQual :: SDoc
</span><a href="#local-6989586621682044922"><span class="hs-identifier hs-var hs-var">constQual</span></a></span></span><span> </span><span class="hs-comment">-- provide 'const' qualifier (#22043)</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044923"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044923"><span class="hs-identifier hs-var">res_ty1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044916"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-255"></span><span>          </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044924"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044924"><span class="hs-identifier hs-var">newty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ((TyCon, Type) -&gt; Type) -&gt; Maybe (TyCon, Type) -&gt; Type
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044923"><span class="hs-identifier hs-var">res_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, Type) -&gt; Type
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044923"><span class="hs-identifier hs-var">res_ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682044927"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044927"><span class="hs-identifier hs-var">ptr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044924"><span class="hs-identifier hs-var">newty</span></a></span><span>
</span><span id="line-257"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044927"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#constPtrConName"><span class="hs-identifier hs-var">constPtrConName</span></a></span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;const&quot;</span></span><span>
</span><span id="line-259"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621682044933"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044933"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; DsM [Id]
</span><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-var">newSysLocalsDs</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682044920"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>  </span><span class="hs-comment">-- no FFI representation polymorphism</span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682044935"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682044935"><span class="hs-identifier hs-var">val_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044936"><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr]
</span><a href="#local-6989586621682044936"><span class="hs-identifier hs-var">arg_wrappers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CoreExpr
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreExpr, CoreExpr -&gt; CoreExpr))
-&gt; [CoreExpr]
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv) ([CoreExpr], [CoreExpr -&gt; CoreExpr])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><a href="../../base-4.18.2.1/src/Control.Monad.html#mapAndUnzipM/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreExpr, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.Call.html#unboxArg"><span class="hs-identifier hs-var">unboxArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; [Id] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044933"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-265"></span><span>        </span><span id="local-6989586621682044939"><span class="annot"><span class="annottext">work_arg_ids :: [Id]
</span><a href="#local-6989586621682044939"><span class="hs-identifier hs-var hs-var">work_arg_ids</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044940"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621682044940"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044940"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682044935"><span class="hs-identifier hs-var">val_args</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- All guaranteed to be vars</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682044941"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044941"><span class="hs-identifier hs-var">ccall_result_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044942"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682044942"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM (Type, CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Foreign.Call.html#boxResult"><span class="hs-identifier hs-var">boxResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044921"><span class="hs-identifier hs-var">io_res_ty</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621682044944"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682044944"><span class="hs-identifier hs-var">ccall_uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621682044946"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682044946"><span class="hs-identifier hs-var">work_uniq</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682044947"><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682044947"><span class="hs-identifier hs-var">fcall'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044948"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044948"><span class="hs-identifier hs-var">cDoc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-273"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682044913"><span class="hs-identifier hs-var">fcall</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-274"></span><span>              </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-type">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-type">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682044950"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044950"><span class="hs-identifier hs-var">cName</span></a></span></span><span> </span><span id="local-6989586621682044951"><span class="annot"><span class="annottext">Maybe Unit
</span><a href="#local-6989586621682044951"><span class="hs-identifier hs-var">mUnitId</span></a></span></span><span> </span><span id="local-6989586621682044952"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044952"><span class="hs-identifier hs-var">isFun</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                               </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CApiConv"><span class="hs-identifier hs-var">CApiConv</span></a></span><span> </span><span id="local-6989586621682044954"><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682044954"><span class="hs-identifier hs-var">safety</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621682044955"><span class="annot"><span class="annottext">IORef (ModuleEnv Int)
</span><a href="#local-6989586621682044955"><span class="hs-identifier hs-var">nextWrapperNum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef (ModuleEnv Int)
</span><a href="GHC.HsToCore.Types.html#ds_next_wrapper_num"><span class="hs-identifier hs-var">ds_next_wrapper_num</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; IORef (ModuleEnv Int))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) DsGblEnv
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (IORef (ModuleEnv Int))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-277"></span><span>                  </span><span id="local-6989586621682044958"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044958"><span class="hs-identifier hs-var">wrapperName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (ModuleEnv Int)
-&gt; String -&gt; String -&gt; IOEnv (Env DsGblEnv DsLclEnv) CLabelString
forall (m :: * -&gt; *).
(MonadIO m, HasModule m) =&gt;
IORef (ModuleEnv Int) -&gt; String -&gt; String -&gt; m CLabelString
</span><a href="GHC.Tc.Utils.Env.html#mkWrapperName"><span class="hs-identifier hs-var">mkWrapperName</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (ModuleEnv Int)
</span><a href="#local-6989586621682044955"><span class="hs-identifier hs-var">nextWrapperNum</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghc_wrapper&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabelString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044950"><span class="hs-identifier hs-var">cName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682044961"><span class="annot"><span class="annottext">fcall' :: ForeignCall
</span><a href="#local-6989586621682044961"><span class="hs-identifier hs-var hs-var">fcall'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallSpec -&gt; ForeignCall
</span><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-var">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CCallTarget -&gt; CCallConv -&gt; Safety -&gt; CCallSpec
</span><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-var">CCallSpec</span></a></span><span>
</span><span id="line-279"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceText -&gt; CLabelString -&gt; Maybe Unit -&gt; Bool -&gt; CCallTarget
</span><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-var">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span>
</span><span id="line-280"></span><span>                                                    </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044958"><span class="hs-identifier hs-var">wrapperName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Unit
</span><a href="#local-6989586621682044951"><span class="hs-identifier hs-var">mUnitId</span></a></span><span>
</span><span id="line-281"></span><span>                                                    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>                                      </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CApiConv"><span class="hs-identifier hs-var">CApiConv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><a href="#local-6989586621682044954"><span class="hs-identifier hs-var">safety</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>                      </span><span id="local-6989586621682044963"><span class="annot"><span class="annottext">c :: SDoc
</span><a href="#local-6989586621682044963"><span class="hs-identifier hs-var hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044964"><span class="hs-identifier hs-var">includes</span></a></span><span>
</span><span id="line-284"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044966"><span class="hs-identifier hs-var">fun_proto</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044969"><span class="hs-identifier hs-var">cRet</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>                      </span><span id="local-6989586621682044964"><span class="annot"><span class="annottext">includes :: SDoc
</span><a href="#local-6989586621682044964"><span class="hs-identifier hs-var hs-var">includes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#include \&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044974"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-286"></span><span>                                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span>
</span><span id="line-287"></span><span>                                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682044974"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044974"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Header] -&gt; [Header]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#nub/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621682044976"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-288"></span><span>                      </span><span id="local-6989586621682044966"><span class="annot"><span class="annottext">fun_proto :: SDoc
</span><a href="#local-6989586621682044966"><span class="hs-identifier hs-var hs-var">fun_proto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044922"><span class="hs-identifier hs-var">constQual</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044977"><span class="hs-identifier hs-var">cResType</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044978"><span class="hs-identifier hs-var">pprCconv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044958"><span class="hs-identifier hs-var">wrapperName</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044981"><span class="hs-identifier hs-var">argTypes</span></a></span><span>
</span><span id="line-289"></span><span>                      </span><span id="local-6989586621682044969"><span class="annot"><span class="annottext">cRet :: SDoc
</span><a href="#local-6989586621682044969"><span class="hs-identifier hs-var hs-var">cRet</span></a></span></span><span>
</span><span id="line-290"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044982"><span class="hs-identifier hs-var">isVoidRes</span></a></span><span> </span><span class="hs-glyph">=</span><span>                   </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044983"><span class="hs-identifier hs-var">cCall</span></a></span><span>
</span><span id="line-291"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;return&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044983"><span class="hs-identifier hs-var">cCall</span></a></span><span>
</span><span id="line-292"></span><span>                      </span><span id="local-6989586621682044983"><span class="annot"><span class="annottext">cCall :: SDoc
</span><a href="#local-6989586621682044983"><span class="hs-identifier hs-var hs-var">cCall</span></a></span></span><span>
</span><span id="line-293"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044952"><span class="hs-identifier hs-var">isFun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044950"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044984"><span class="hs-identifier hs-var">argVals</span></a></span><span>
</span><span id="line-294"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682044920"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682044950"><span class="hs-identifier hs-var">cName</span></a></span><span>
</span><span id="line-295"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsFCall: Unexpected arguments to FFI value import&quot;</span></span><span>
</span><span id="line-296"></span><span>                      </span><span id="local-6989586621682044987"><span class="annot"><span class="annottext">raw_res_ty :: Type
</span><a href="#local-6989586621682044987"><span class="hs-identifier hs-var hs-var">raw_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitIOType_maybe"><span class="hs-identifier hs-var">tcSplitIOType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044921"><span class="hs-identifier hs-var">io_res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-297"></span><span>                                   </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682044988"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682044988"><span class="hs-identifier hs-var">_ioTyCon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044989"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044989"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044989"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-298"></span><span>                                   </span><span class="annot"><span class="annottext">Maybe (TyCon, Type)
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044921"><span class="hs-identifier hs-var">io_res_ty</span></a></span><span>
</span><span id="line-299"></span><span>                      </span><span id="local-6989586621682044982"><span class="annot"><span class="annottext">isVoidRes :: Bool
</span><a href="#local-6989586621682044982"><span class="hs-identifier hs-var hs-var">isVoidRes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044987"><span class="hs-identifier hs-var">raw_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span>
</span><span id="line-300"></span><span>                      </span><span class="hs-special">(</span><span id="local-6989586621682044991"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044991"><span class="hs-identifier hs-var">mHeader</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044977"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044977"><span class="hs-identifier hs-var">cResType</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682044982"><span class="hs-identifier hs-var">isVoidRes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Header
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Maybe Header, SDoc)
</span><a href="GHC.HsToCore.Foreign.C.html#toCType"><span class="hs-identifier hs-var">toCType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044987"><span class="hs-identifier hs-var">raw_res_ty</span></a></span><span>
</span><span id="line-303"></span><span>                      </span><span id="local-6989586621682044978"><span class="annot"><span class="annottext">pprCconv :: SDoc
</span><a href="#local-6989586621682044978"><span class="hs-identifier hs-var hs-var">pprCconv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallConv -&gt; SDoc
</span><a href="GHC.Types.ForeignCall.html#ccallConvAttribute"><span class="hs-identifier hs-var">ccallConvAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CApiConv"><span class="hs-identifier hs-var">CApiConv</span></a></span><span>
</span><span id="line-304"></span><span>                      </span><span id="local-6989586621682044994"><span class="annot"><span class="annottext">mHeadersArgTypeList :: [(Maybe Header, SDoc)]
</span><a href="#local-6989586621682044994"><span class="hs-identifier hs-var hs-var">mHeadersArgTypeList</span></a></span></span><span>
</span><span id="line-305"></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044995"><span class="hs-identifier hs-var">header</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044996"><span class="hs-identifier hs-var">cType</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'a'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682044999"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045000"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682045000"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044999"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682044999"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; [Int] -&gt; [(Scaled Type, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682044920"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682044995"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044995"><span class="hs-identifier hs-var">header</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682044996"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044996"><span class="hs-identifier hs-var">cType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Maybe Header, SDoc)
</span><a href="GHC.HsToCore.Foreign.C.html#toCType"><span class="hs-identifier hs-var">toCType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621682045000"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-308"></span><span>                      </span><span class="hs-special">(</span><span id="local-6989586621682045002"><span class="annot"><span class="annottext">[Maybe Header]
</span><a href="#local-6989586621682045002"><span class="hs-identifier hs-var">mHeaders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682045003"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682045003"><span class="hs-identifier hs-var">argTypeList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Maybe Header, SDoc)] -&gt; ([Maybe Header], [SDoc])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe Header, SDoc)]
</span><a href="#local-6989586621682044994"><span class="hs-identifier hs-var">mHeadersArgTypeList</span></a></span><span>
</span><span id="line-309"></span><span>                      </span><span id="local-6989586621682044981"><span class="annot"><span class="annottext">argTypes :: SDoc
</span><a href="#local-6989586621682044981"><span class="hs-identifier hs-var hs-var">argTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682045003"><span class="hs-identifier hs-var">argTypeList</span></a></span><span>
</span><span id="line-310"></span><span>                                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void&quot;</span></span><span>
</span><span id="line-311"></span><span>                                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621682045003"><span class="hs-identifier hs-var">argTypeList</span></a></span><span>
</span><span id="line-312"></span><span>                      </span><span id="local-6989586621682045008"><span class="annot"><span class="annottext">mHeaders' :: [Maybe Header]
</span><a href="#local-6989586621682045008"><span class="hs-identifier hs-var hs-var">mHeaders'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044914"><span class="hs-identifier hs-var">mDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Header -&gt; [Maybe Header] -&gt; [Maybe Header]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682044991"><span class="hs-identifier hs-var">mHeader</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Header -&gt; [Maybe Header] -&gt; [Maybe Header]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Header]
</span><a href="#local-6989586621682045002"><span class="hs-identifier hs-var">mHeaders</span></a></span><span>
</span><span id="line-313"></span><span>                      </span><span id="local-6989586621682044976"><span class="annot"><span class="annottext">headers :: [Header]
</span><a href="#local-6989586621682044976"><span class="hs-identifier hs-var hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Header] -&gt; [Header]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#catMaybes/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Header]
</span><a href="#local-6989586621682045008"><span class="hs-identifier hs-var">mHeaders'</span></a></span><span>
</span><span id="line-314"></span><span>                      </span><span id="local-6989586621682044984"><span class="annot"><span class="annottext">argVals :: SDoc
</span><a href="#local-6989586621682044984"><span class="hs-identifier hs-var hs-var">argVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-315"></span><span>                                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'a'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045010"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-316"></span><span>                                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682045010"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045010"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; [Int] -&gt; [(Scaled Type, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682044920"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-317"></span><span>                  </span><span class="annot"><span class="annottext">(ForeignCall, SDoc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (ForeignCall, SDoc)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682044961"><span class="hs-identifier hs-var">fcall'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044963"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>              </span><span class="annot"><span class="annottext">ForeignCall
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>                  </span><span class="annot"><span class="annottext">(ForeignCall, SDoc)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (ForeignCall, SDoc)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682044913"><span class="hs-identifier hs-var">fcall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621682045011"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682045011"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-comment">-- Build the worker</span><span>
</span><span id="line-323"></span><span>        </span><span id="local-6989586621682045012"><span class="annot"><span class="annottext">worker_ty :: Type
</span><a href="#local-6989586621682045012"><span class="hs-identifier hs-var hs-var">worker_ty</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682044917"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTysMany"><span class="hs-identifier hs-var">mkVisFunTysMany</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Type) -&gt; [Id] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044939"><span class="hs-identifier hs-var">work_arg_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044941"><span class="hs-identifier hs-var">ccall_result_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621682045016"><span class="annot"><span class="annottext">tvs :: [Id]
</span><a href="#local-6989586621682045016"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVarBinder -&gt; Id) -&gt; [TyVarBinder] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; Id
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682044917"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span>
</span><span id="line-325"></span><span>        </span><span id="local-6989586621682045018"><span class="annot"><span class="annottext">the_ccall_app :: CoreExpr
</span><a href="#local-6989586621682045018"><span class="hs-identifier hs-var hs-var">the_ccall_app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; ForeignCall -&gt; [CoreExpr] -&gt; Type -&gt; CoreExpr
</span><a href="GHC.HsToCore.Foreign.Call.html#mkFCall"><span class="hs-identifier hs-var">mkFCall</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682044944"><span class="hs-identifier hs-var">ccall_uniq</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621682044947"><span class="hs-identifier hs-var">fcall'</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682044935"><span class="hs-identifier hs-var">val_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682044941"><span class="hs-identifier hs-var">ccall_result_ty</span></a></span><span>
</span><span id="line-326"></span><span>        </span><span id="local-6989586621682045020"><span class="annot"><span class="annottext">work_rhs :: CoreExpr
</span><a href="#local-6989586621682045020"><span class="hs-identifier hs-var hs-var">work_rhs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682045016"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044939"><span class="hs-identifier hs-var">work_arg_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682045018"><span class="hs-identifier hs-var">the_ccall_app</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>        </span><span id="local-6989586621682045021"><span class="annot"><span class="annottext">work_id :: Id
</span><a href="#local-6989586621682045021"><span class="hs-identifier hs-var hs-var">work_id</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; Unique -&gt; Type -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$wccall&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682044946"><span class="hs-identifier hs-var">work_uniq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045012"><span class="hs-identifier hs-var">worker_ty</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-comment">-- Build the wrapper</span><span>
</span><span id="line-330"></span><span>        </span><span id="local-6989586621682045023"><span class="annot"><span class="annottext">work_app :: CoreExpr
</span><a href="#local-6989586621682045023"><span class="hs-identifier hs-var hs-var">work_app</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; [Id] -&gt; CoreExpr
forall b. Expr b -&gt; [Id] -&gt; Expr b
</span><a href="GHC.Core.html#mkVarApps"><span class="hs-identifier hs-var">mkVarApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045021"><span class="hs-identifier hs-var">work_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682045016"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682044935"><span class="hs-identifier hs-var">val_args</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span id="local-6989586621682045025"><span class="annot"><span class="annottext">wrapper_body :: CoreExpr
</span><a href="#local-6989586621682045025"><span class="hs-identifier hs-var hs-var">wrapper_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [CoreExpr -&gt; CoreExpr] -&gt; CoreExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">($)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682044942"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682045023"><span class="hs-identifier hs-var">work_app</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr -&gt; CoreExpr]
</span><a href="#local-6989586621682044936"><span class="hs-identifier hs-var">arg_wrappers</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span id="local-6989586621682045027"><span class="annot"><span class="annottext">wrap_rhs :: CoreExpr
</span><a href="#local-6989586621682045027"><span class="hs-identifier hs-var hs-var">wrap_rhs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; CoreExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682045016"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; [Id]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044933"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682045025"><span class="hs-identifier hs-var">wrapper_body</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621682045028"><span class="annot"><span class="annottext">wrap_rhs' :: CoreExpr
</span><a href="#local-6989586621682045028"><span class="hs-identifier hs-var hs-var">wrap_rhs'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Coercion -&gt; CoreExpr
forall b. Expr b -&gt; Coercion -&gt; Expr b
</span><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-var">Cast</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682045027"><span class="hs-identifier hs-var">wrap_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621682044912"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span id="local-6989586621682045029"><span class="annot"><span class="annottext">simpl_opts :: SimpleOpts
</span><a href="#local-6989586621682045029"><span class="hs-identifier hs-var hs-var">simpl_opts</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SimpleOpts
</span><a href="GHC.Driver.Config.html#initSimpleOpts"><span class="hs-identifier hs-var">initSimpleOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682045011"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-335"></span><span>        </span><span id="local-6989586621682045031"><span class="annot"><span class="annottext">fn_id_w_inl :: Id
</span><a href="#local-6989586621682045031"><span class="hs-identifier hs-var hs-var">fn_id_w_inl</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682044911"><span class="hs-identifier hs-var">fn_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Unfolding -&gt; Id
</span><a href="GHC.Types.Id.html#setIdUnfolding"><span class="hs-operator hs-var">`setIdUnfolding`</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts -&gt; UnfoldingSource -&gt; Int -&gt; CoreExpr -&gt; Unfolding
</span><a href="GHC.Core.Unfold.Make.html#mkInlineUnfoldingWithArity"><span class="hs-identifier hs-var">mkInlineUnfoldingWithArity</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621682045029"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span>
</span><span id="line-336"></span><span>                                                </span><span class="annot"><span class="annottext">UnfoldingSource
</span><a href="GHC.Types.Basic.html#StableSystemSrc"><span class="hs-identifier hs-var">StableSystemSrc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682044933"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>                                                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682045028"><span class="hs-identifier hs-var">wrap_rhs'</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">([Binding], CHeader, CStub) -&gt; DsM ([Binding], CHeader, CStub)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045021"><span class="hs-identifier hs-var">work_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682045020"><span class="hs-identifier hs-var">work_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045031"><span class="hs-identifier hs-var">fn_id_w_inl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682045028"><span class="hs-identifier hs-var">wrap_rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CHeader
forall a. Monoid a =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#mempty/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [CLabel] -&gt; [CLabel] -&gt; CStub
</span><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-var">CStub</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682044948"><span class="hs-identifier hs-var">cDoc</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#toCName"><span class="hs-identifier hs-type">toCName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-343"></span><span id="toCName"><span class="annot"><span class="annottext">toCName :: Id -&gt; String
</span><a href="GHC.HsToCore.Foreign.C.html#toCName"><span class="hs-identifier hs-var hs-var">toCName</span></a></span></span><span> </span><span id="local-6989586621682045037"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045037"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDocContext -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#showSDocOneLine"><span class="hs-identifier hs-var">showSDocOneLine</span></a></span><span> </span><span class="annot"><span class="annottext">SDocContext
</span><a href="GHC.Utils.Outputable.html#defaultSDocContext"><span class="hs-identifier hs-var">defaultSDocContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprCode"><span class="hs-identifier hs-var">pprCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045037"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#toCType"><span class="hs-identifier hs-type">toCType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span id="toCType"><span class="annot"><span class="annottext">toCType :: Type -&gt; (Maybe Header, SDoc)
</span><a href="GHC.HsToCore.Foreign.C.html#toCType"><span class="hs-identifier hs-var hs-var">toCType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; (Maybe Header, SDoc)
forall {b}. IsLine b =&gt; Bool -&gt; Type -&gt; (Maybe Header, b)
</span><a href="#local-6989586621682045042"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682045042"><span class="annot"><span class="annottext">f :: Bool -&gt; Type -&gt; (Maybe Header, b)
</span><a href="#local-6989586621682045042"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682045058"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045058"><span class="hs-identifier hs-var">voidOK</span></a></span></span><span> </span><span id="local-6989586621682045059"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045059"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-348"></span><span>           </span><span class="hs-comment">-- First, if we have (Ptr t) of (FunPtr t), then we need to</span><span>
</span><span id="line-349"></span><span>           </span><span class="hs-comment">-- convert t to a C type and put a * after it. If we don't</span><span>
</span><span id="line-350"></span><span>           </span><span class="hs-comment">-- know a type for t, then &quot;void&quot; is fine, though.</span><span>
</span><span id="line-351"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045060"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045060"><span class="hs-identifier hs-var">ptr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621682045061"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045061"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045059"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-352"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045060"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ptrTyConName"><span class="hs-identifier hs-var">ptrTyConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#funPtrTyConName"><span class="hs-identifier hs-var">funPtrTyConName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-353"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; (Maybe Header, b)
</span><a href="#local-6989586621682045042"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045061"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621682045065"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682045065"><span class="hs-identifier hs-var">mh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682045066"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682045066"><span class="hs-identifier hs-var">cType'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682045065"><span class="hs-identifier hs-var">mh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682045066"><span class="hs-identifier hs-var">cType'</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; b
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>           </span><span class="hs-comment">-- Otherwise, if we have a type constructor application, then</span><span>
</span><span id="line-357"></span><span>           </span><span class="hs-comment">-- see if there is a C type associated with that constructor.</span><span>
</span><span id="line-358"></span><span>           </span><span class="hs-comment">-- Note that we aren't looking through type synonyms or</span><span>
</span><span id="line-359"></span><span>           </span><span class="hs-comment">-- anything, as it may be the synonym that is annotated.</span><span>
</span><span id="line-360"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682045067"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045067"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyConPicky_maybe"><span class="hs-identifier hs-var">tyConAppTyConPicky_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045059"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-361"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682045070"><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682045070"><span class="hs-identifier hs-var">mHeader</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682045071"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682045071"><span class="hs-identifier hs-var">cType</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe CType
</span><a href="GHC.Core.TyCon.html#tyConCType_maybe"><span class="hs-identifier hs-var">tyConCType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045067"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-362"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Header
</span><a href="#local-6989586621682045070"><span class="hs-identifier hs-var">mHeader</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; b
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682045071"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>           </span><span class="hs-comment">-- If we don't know a C type for this type, then try looking</span><span>
</span><span id="line-364"></span><span>           </span><span class="hs-comment">-- through one layer of type synonym etc.</span><span>
</span><span id="line-365"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682045073"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045073"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045059"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-366"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; (Maybe Header, b)
</span><a href="#local-6989586621682045042"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045058"><span class="hs-identifier hs-var">voidOK</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045073"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-367"></span><span>          </span><span class="hs-comment">-- Handle 'UnliftedFFITypes' argument</span><span>
</span><span id="line-368"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682045075"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045075"><span class="hs-identifier hs-var">tyCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyConPicky_maybe"><span class="hs-identifier hs-var">tyConAppTyConPicky_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045059"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-369"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045075"><span class="hs-identifier hs-var">tyCon</span></a></span><span>
</span><span id="line-370"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682045077"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682045077"><span class="hs-identifier hs-var">cType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe String
</span><a href="GHC.HsToCore.Foreign.Utils.html#ppPrimTyConStgType"><span class="hs-identifier hs-var">ppPrimTyConStgType</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045075"><span class="hs-identifier hs-var">tyCon</span></a></span><span>
</span><span id="line-371"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Header
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; b
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682045077"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>           </span><span class="hs-comment">-- Otherwise we don't know the C type. If we are allowing</span><span>
</span><span id="line-374"></span><span>           </span><span class="hs-comment">-- void then return that; otherwise something has gone wrong.</span><span>
</span><span id="line-375"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045058"><span class="hs-identifier hs-var">voidOK</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Header
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; b
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-377"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; (Maybe Header, b)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;toCType&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045059"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="hs-comment">{-
*

\subsection{Generating @foreign export@ stubs}

*

For each @foreign export@ function, a C stub function is generated.
The C stub constructs the application of the exported Haskell function
using the hugs/ghc rts invocation API.
-}</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#mkFExportCBits"><span class="hs-identifier hs-type">mkFExportCBits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-392"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-393"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>      </span><span class="hs-comment">-- Just==static, Nothing==dynamic</span><span>
</span><span id="line-394"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-395"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-396"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- True &lt;=&gt; returns an IO type</span><span>
</span><span id="line-397"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-398"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-type">CHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-399"></span><span>                   </span><span class="annot"><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-type">CStub</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-400"></span><span>                   </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- the argument reps</span><span>
</span><span id="line-401"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>          </span><span class="hs-comment">-- total size of arguments</span><span>
</span><span id="line-402"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span id="mkFExportCBits"><span class="annot"><span class="annottext">mkFExportCBits :: DynFlags
-&gt; CLabelString
-&gt; Maybe Id
-&gt; [Type]
-&gt; Type
-&gt; Bool
-&gt; CCallConv
-&gt; (CHeader, CStub, String, Int)
</span><a href="GHC.HsToCore.Foreign.C.html#mkFExportCBits"><span class="hs-identifier hs-var hs-var">mkFExportCBits</span></a></span></span><span> </span><span id="local-6989586621682045081"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682045081"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682045082"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682045082"><span class="hs-identifier hs-var">c_nm</span></a></span></span><span> </span><span id="local-6989586621682045083"><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682045083"><span class="hs-identifier hs-var">maybe_target</span></a></span></span><span> </span><span id="local-6989586621682045084"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682045084"><span class="hs-identifier hs-var">arg_htys</span></a></span></span><span> </span><span id="local-6989586621682045085"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045085"><span class="hs-identifier hs-var">res_hty</span></a></span></span><span> </span><span id="local-6989586621682045086"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045086"><span class="hs-identifier hs-var">is_IO_res_ty</span></a></span></span><span> </span><span id="local-6989586621682045087"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682045087"><span class="hs-identifier hs-var">cc</span></a></span></span><span>
</span><span id="line-404"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CHeader
</span><a href="#local-6989586621682045088"><span class="hs-identifier hs-var">header_bits</span></a></span><span>
</span><span id="line-405"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [CLabel] -&gt; [CLabel] -&gt; CStub
</span><a href="GHC.Types.ForeignStubs.html#CStub"><span class="hs-identifier hs-var">CStub</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045089"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-406"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682045090"><span class="hs-identifier hs-var">type_string</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#sum/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682045094"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682045094"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682045094"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045095"><span class="hs-identifier hs-var">aug_arg_info</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- all the args</span><span>
</span><span id="line-408"></span><span>         </span><span class="hs-comment">-- NB. the calculation here isn't strictly speaking correct.</span><span>
</span><span id="line-409"></span><span>         </span><span class="hs-comment">-- We have a primitive Haskell type (eg. Int#, Double#), and</span><span>
</span><span id="line-410"></span><span>         </span><span class="hs-comment">-- we want to know the size, when passed on the C stack, of</span><span>
</span><span id="line-411"></span><span>         </span><span class="hs-comment">-- the associated C type (eg. HsInt, HsDouble).  We don't have</span><span>
</span><span id="line-412"></span><span>         </span><span class="hs-comment">-- this information to hand, but we know what GHC's conventions</span><span>
</span><span id="line-413"></span><span>         </span><span class="hs-comment">-- are for passing around the primitive Haskell types, so we</span><span>
</span><span id="line-414"></span><span>         </span><span class="hs-comment">-- use that instead.  I hope the two coincide --SDM</span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-417"></span><span>  </span><span id="local-6989586621682045096"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682045096"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682045081"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-comment">-- list the arguments to the C function</span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><a href="#local-6989586621682045097"><span class="hs-identifier hs-type">arg_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- arg name</span><span>
</span><span id="line-421"></span><span>                </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- C type</span><span>
</span><span id="line-422"></span><span>                </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- Haskell type</span><span>
</span><span id="line-423"></span><span>                </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- the CmmType</span><span>
</span><span id="line-424"></span><span>  </span><span id="local-6989586621682045097"><span class="annot"><span class="annottext">arg_info :: [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045097"><span class="hs-identifier hs-var hs-var">arg_info</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682045098"><span class="annot"><span class="annottext">stg_type :: SDoc
</span><a href="#local-6989586621682045098"><span class="hs-identifier hs-var hs-var">stg_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#showStgType"><span class="hs-identifier hs-var">showStgType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045100"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-425"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621682045101"><span class="hs-identifier hs-var">arg_cname</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045102"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045098"><span class="hs-identifier hs-var">stg_type</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-426"></span><span>                 </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045098"><span class="hs-identifier hs-var">stg_type</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-427"></span><span>                 </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045100"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-428"></span><span>                </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#typeCmmType"><span class="hs-identifier hs-var">typeCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045096"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.HsToCore.Foreign.Utils.html#getPrimTyOf"><span class="hs-identifier hs-var">getPrimTyOf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045100"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045100"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045100"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682045102"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045102"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Int] -&gt; [(Type, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682045084"><span class="hs-identifier hs-var">arg_htys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>  </span><span id="local-6989586621682045101"><span class="annot"><span class="annottext">arg_cname :: Int -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621682045101"><span class="hs-identifier hs-var hs-var">arg_cname</span></a></span></span><span> </span><span id="local-6989586621682045105"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045105"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682045106"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045106"><span class="hs-identifier hs-var">stg_ty</span></a></span></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045107"><span class="hs-identifier hs-var">libffi</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045106"><span class="hs-identifier hs-var">stg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-433"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;args&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045105"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'a'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall doc. IsLine doc =&gt; Int -&gt; doc
</span><a href="GHC.Utils.Outputable.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045105"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-comment">-- generate a libffi-style stub if this is a &quot;wrapper&quot; and libffi is enabled</span><span>
</span><span id="line-437"></span><span>  </span><span id="local-6989586621682045107"><span class="annot"><span class="annottext">libffi :: Bool
</span><a href="#local-6989586621682045107"><span class="hs-identifier hs-var hs-var">libffi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlatformMisc -&gt; Bool
</span><a href="GHC.Platform.html#platformMisc_libFFI"><span class="hs-identifier hs-var">platformMisc_libFFI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; PlatformMisc
</span><a href="GHC.Driver.Session.html#platformMisc"><span class="hs-identifier hs-var">platformMisc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682045081"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Id -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isNothing/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682045083"><span class="hs-identifier hs-var">maybe_target</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>  </span><span id="local-6989586621682045090"><span class="annot"><span class="annottext">type_string :: String
</span><a href="#local-6989586621682045090"><span class="hs-identifier hs-var hs-var">type_string</span></a></span></span><span>
</span><span id="line-440"></span><span>      </span><span class="hs-comment">-- libffi needs to know the result type too:</span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045107"><span class="hs-identifier hs-var">libffi</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; Char
</span><a href="GHC.HsToCore.Foreign.Utils.html#primTyDescChar"><span class="hs-identifier hs-var">primTyDescChar</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045096"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045085"><span class="hs-identifier hs-var">res_hty</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682045114"><span class="hs-identifier hs-var">arg_type_string</span></a></span><span>
</span><span id="line-442"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682045114"><span class="hs-identifier hs-var">arg_type_string</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>  </span><span id="local-6989586621682045114"><span class="annot"><span class="annottext">arg_type_string :: String
</span><a href="#local-6989586621682045114"><span class="hs-identifier hs-var hs-var">arg_type_string</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; Char
</span><a href="GHC.HsToCore.Foreign.Utils.html#primTyDescChar"><span class="hs-identifier hs-var">primTyDescChar</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045096"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045115"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682045115"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045115"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045097"><span class="hs-identifier hs-var">arg_info</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-445"></span><span>                </span><span class="hs-comment">-- just the real args</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- add some auxiliary args; the stable ptr in the wrapper case, and</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-comment">-- a slot for the dummy return address in the wrapper + ccall case</span><span>
</span><span id="line-449"></span><span>  </span><span id="local-6989586621682045095"><span class="annot"><span class="annottext">aug_arg_info :: [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045095"><span class="hs-identifier hs-var hs-var">aug_arg_info</span></a></span></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Id -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isNothing/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682045083"><span class="hs-identifier hs-var">maybe_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
</span><a href="#local-6989586621682045116"><span class="hs-identifier hs-var">stable_ptr_arg</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; CCallConv
-&gt; [(SDoc, SDoc, Type, CmmType)]
-&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="GHC.HsToCore.Foreign.C.html#insertRetAddr"><span class="hs-identifier hs-var">insertRetAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045096"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682045087"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045097"><span class="hs-identifier hs-var">arg_info</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045097"><span class="hs-identifier hs-var">arg_info</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>  </span><span id="local-6989586621682045116"><span class="annot"><span class="annottext">stable_ptr_arg :: (SDoc, SDoc, Type, CmmType)
</span><a href="#local-6989586621682045116"><span class="hs-identifier hs-var hs-var">stable_ptr_arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-454"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;the_stableptr&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;StgStablePtr&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
forall a. HasCallStack =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Err.html#undefined/GHC.Err.html#undefined"><span class="hs-identifier hs-var">undefined</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-455"></span><span>         </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#typeCmmType"><span class="hs-identifier hs-var">typeCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045096"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Builtin.Types.Prim.html#mkStablePtrPrimTy"><span class="hs-identifier hs-var">mkStablePtrPrimTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-comment">-- stuff to do with the return type of the C function</span><span>
</span><span id="line-458"></span><span>  </span><span id="local-6989586621682045121"><span class="annot"><span class="annottext">res_hty_is_unit :: Bool
</span><a href="#local-6989586621682045121"><span class="hs-identifier hs-var hs-var">res_hty_is_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045085"><span class="hs-identifier hs-var">res_hty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span>     </span><span class="hs-comment">-- Look through any newtypes</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>  </span><span id="local-6989586621682045122"><span class="annot"><span class="annottext">cResType :: SDoc
</span><a href="#local-6989586621682045122"><span class="hs-identifier hs-var hs-var">cResType</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045121"><span class="hs-identifier hs-var">res_hty_is_unit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void&quot;</span></span><span>
</span><span id="line-461"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#showStgType"><span class="hs-identifier hs-var">showStgType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045085"><span class="hs-identifier hs-var">res_hty</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-comment">-- when the return type is integral and word-sized or smaller, it</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-comment">-- must be assigned as type ffi_arg (#3516).  To see what type</span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-comment">-- libffi is expecting here, take a look in its own testsuite, e.g.</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-comment">-- libffi/testsuite/libffi.call/cls_align_ulonglong.c</span><span>
</span><span id="line-467"></span><span>  </span><span id="local-6989586621682045123"><span class="annot"><span class="annottext">ffi_cResType :: SDoc
</span><a href="#local-6989586621682045123"><span class="hs-identifier hs-var hs-var">ffi_cResType</span></a></span></span><span>
</span><span id="line-468"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045124"><span class="hs-identifier hs-var">is_ffi_arg_type</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ffi_arg&quot;</span></span><span>
</span><span id="line-469"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045122"><span class="hs-identifier hs-var">cResType</span></a></span><span>
</span><span id="line-470"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-471"></span><span>       </span><span id="local-6989586621682045125"><span class="annot"><span class="annottext">res_ty_key :: Unique
</span><a href="#local-6989586621682045125"><span class="hs-identifier hs-var hs-var">res_ty_key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TyCon
</span><a href="GHC.HsToCore.Foreign.C.html#typeTyCon"><span class="hs-identifier hs-var">typeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045085"><span class="hs-identifier hs-var">res_hty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>       </span><span id="local-6989586621682045124"><span class="annot"><span class="annottext">is_ffi_arg_type :: Bool
</span><a href="#local-6989586621682045124"><span class="hs-identifier hs-var hs-var">is_ffi_arg_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682045125"><span class="hs-identifier hs-var">res_ty_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; [Unique] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#notElem/Data.Foldable.html#notElem"><span class="hs-operator hs-var">`notElem`</span></a></span><span>
</span><span id="line-473"></span><span>              </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#floatTyConKey"><span class="hs-identifier hs-var">floatTyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#doubleTyConKey"><span class="hs-identifier hs-var">doubleTyConKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-474"></span><span>               </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#int64TyConKey"><span class="hs-identifier hs-var">int64TyConKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#word64TyConKey"><span class="hs-identifier hs-var">word64TyConKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-comment">-- Now we can cook up the prototype for the exported function.</span><span>
</span><span id="line-477"></span><span>  </span><span id="local-6989586621682045134"><span class="annot"><span class="annottext">pprCconv :: SDoc
</span><a href="#local-6989586621682045134"><span class="hs-identifier hs-var hs-var">pprCconv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CCallConv -&gt; SDoc
</span><a href="GHC.Types.ForeignCall.html#ccallConvAttribute"><span class="hs-identifier hs-var">ccallConvAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682045087"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>  </span><span id="local-6989586621682045088"><span class="annot"><span class="annottext">header_bits :: CHeader
</span><a href="#local-6989586621682045088"><span class="hs-identifier hs-var hs-var">header_bits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; CHeader
</span><a href="GHC.Types.ForeignStubs.html#CHeader"><span class="hs-identifier hs-var">CHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extern&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045136"><span class="hs-identifier hs-var">fun_proto</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>  </span><span id="local-6989586621682045137"><span class="annot"><span class="annottext">fun_args :: SDoc
</span><a href="#local-6989586621682045137"><span class="hs-identifier hs-var hs-var">fun_args</span></a></span></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045095"><span class="hs-identifier hs-var">aug_arg_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void&quot;</span></span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-484"></span><span>                               </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((SDoc, SDoc, Type, CmmType) -&gt; SDoc)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682045138"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045138"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682045139"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045139"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045139"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045138"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045095"><span class="hs-identifier hs-var">aug_arg_info</span></a></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span>  </span><span id="local-6989586621682045136"><span class="annot"><span class="annottext">fun_proto :: SDoc
</span><a href="#local-6989586621682045136"><span class="hs-identifier hs-var hs-var">fun_proto</span></a></span></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045107"><span class="hs-identifier hs-var">libffi</span></a></span><span>
</span><span id="line-488"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682045082"><span class="hs-identifier hs-var">c_nm</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-489"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void *cif STG_UNUSED, void* resp, void** args, void* the_stableptr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-491"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045122"><span class="hs-identifier hs-var">cResType</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045134"><span class="hs-identifier hs-var">pprCconv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682045082"><span class="hs-identifier hs-var">c_nm</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045137"><span class="hs-identifier hs-var">fun_args</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-comment">-- the target which will form the root of what we ask rts_inCall to run</span><span>
</span><span id="line-494"></span><span>  </span><span id="local-6989586621682045140"><span class="annot"><span class="annottext">the_cfun :: SDoc
</span><a href="#local-6989586621682045140"><span class="hs-identifier hs-var hs-var">the_cfun</span></a></span></span><span>
</span><span id="line-495"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682045083"><span class="hs-identifier hs-var">maybe_target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-496"></span><span>          </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(StgClosure*)deRefStablePtr(the_stableptr)&quot;</span></span><span>
</span><span id="line-497"></span><span>          </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682045141"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045141"><span class="hs-identifier hs-var">hs_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&amp;'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045141"><span class="hs-identifier hs-var">hs_fn</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_closure&quot;</span></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>  </span><span id="local-6989586621682045146"><span class="annot"><span class="annottext">cap :: SDoc
</span><a href="#local-6989586621682045146"><span class="hs-identifier hs-var hs-var">cap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cap&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-comment">-- the expression we give to rts_inCall</span><span>
</span><span id="line-502"></span><span>  </span><span id="local-6989586621682045147"><span class="annot"><span class="annottext">expr_to_run :: SDoc
</span><a href="#local-6989586621682045147"><span class="hs-identifier hs-var hs-var">expr_to_run</span></a></span></span><span>
</span><span id="line-503"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; (SDoc, SDoc, Type, CmmType) -&gt; SDoc)
-&gt; SDoc -&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; SDoc
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; (SDoc, SDoc, Type, CmmType) -&gt; SDoc
</span><a href="#local-6989586621682045149"><span class="hs-identifier hs-var">appArg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045140"><span class="hs-identifier hs-var">the_cfun</span></a></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045097"><span class="hs-identifier hs-var">arg_info</span></a></span><span> </span><span class="hs-comment">-- NOT aug_arg_info</span><span>
</span><span id="line-504"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-505"></span><span>          </span><span id="local-6989586621682045149"><span class="annot"><span class="annottext">appArg :: SDoc -&gt; (SDoc, SDoc, Type, CmmType) -&gt; SDoc
</span><a href="#local-6989586621682045149"><span class="hs-identifier hs-var hs-var">appArg</span></a></span></span><span> </span><span id="local-6989586621682045150"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045150"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045151"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045151"><span class="hs-identifier hs-var">arg_cname</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682045152"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045152"><span class="hs-identifier hs-var">arg_hty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CmmType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rts_apply&quot;</span></span><span>
</span><span id="line-507"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045146"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045150"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#mkHObj"><span class="hs-identifier hs-var">mkHObj</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045152"><span class="hs-identifier hs-var">arg_hty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045146"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045151"><span class="hs-identifier hs-var">arg_cname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>  </span><span class="hs-comment">-- various other bits for inside the fn</span><span>
</span><span id="line-510"></span><span>  </span><span id="local-6989586621682045156"><span class="annot"><span class="annottext">declareResult :: SDoc
</span><a href="#local-6989586621682045156"><span class="hs-identifier hs-var hs-var">declareResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HaskellObj ret;&quot;</span></span><span>
</span><span id="line-511"></span><span>  </span><span id="local-6989586621682045157"><span class="annot"><span class="annottext">declareCResult :: SDoc
</span><a href="#local-6989586621682045157"><span class="hs-identifier hs-var hs-var">declareCResult</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045121"><span class="hs-identifier hs-var">res_hty_is_unit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-512"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045122"><span class="hs-identifier hs-var">cResType</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cret;&quot;</span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>  </span><span id="local-6989586621682045158"><span class="annot"><span class="annottext">assignCResult :: SDoc
</span><a href="#local-6989586621682045158"><span class="hs-identifier hs-var hs-var">assignCResult</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045121"><span class="hs-identifier hs-var">res_hty_is_unit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-515"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span>
</span><span id="line-516"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cret=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#unpackHObj"><span class="hs-identifier hs-var">unpackHObj</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045085"><span class="hs-identifier hs-var">res_hty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ret&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-comment">-- an extern decl for the fn being called</span><span>
</span><span id="line-519"></span><span>  </span><span id="local-6989586621682045160"><span class="annot"><span class="annottext">extern_decl :: SDoc
</span><a href="#local-6989586621682045160"><span class="hs-identifier hs-var hs-var">extern_decl</span></a></span></span><span>
</span><span id="line-520"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682045083"><span class="hs-identifier hs-var">maybe_target</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-521"></span><span>          </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsOutput doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-522"></span><span>          </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682045161"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045161"><span class="hs-identifier hs-var">hs_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extern StgClosure &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682045161"><span class="hs-identifier hs-var">hs_fn</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_closure&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-comment">-- finally, the whole darn thing</span><span>
</span><span id="line-526"></span><span>  </span><span id="local-6989586621682045089"><span class="annot"><span class="annottext">body :: SDoc
</span><a href="#local-6989586621682045089"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#space"><span class="hs-identifier hs-var">space</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-528"></span><span>    </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045160"><span class="hs-identifier hs-var">extern_decl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045136"><span class="hs-identifier hs-var">fun_proto</span></a></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-531"></span><span>     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#lbrace"><span class="hs-identifier hs-var">lbrace</span></a></span><span>
</span><span id="line-532"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Capability *cap;&quot;</span></span><span>
</span><span id="line-533"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045156"><span class="hs-identifier hs-var">declareResult</span></a></span><span>
</span><span id="line-534"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045157"><span class="hs-identifier hs-var">declareCResult</span></a></span><span>
</span><span id="line-535"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cap = rts_lock();&quot;</span></span><span>
</span><span id="line-536"></span><span>          </span><span class="hs-comment">-- create the application + perform it.</span><span>
</span><span id="line-537"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rts_inCall&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-538"></span><span>                </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&amp;'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045146"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-539"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rts_apply&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-540"></span><span>                    </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045146"><span class="hs-identifier hs-var">cap</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-541"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(HaskellObj)&quot;</span></span><span>
</span><span id="line-542"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045086"><span class="hs-identifier hs-var">is_IO_res_ty</span></a></span><span>
</span><span id="line-543"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runIO_closure&quot;</span></span><span>
</span><span id="line-544"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runNonIO_closure&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-546"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045147"><span class="hs-identifier hs-var">expr_to_run</span></a></span><span>
</span><span id="line-547"></span><span>                </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-548"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&amp;ret&quot;</span></span><span>
</span><span id="line-549"></span><span>             </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span>
</span><span id="line-550"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rts_checkSchedStatus&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#doubleQuotes"><span class="hs-identifier hs-var">doubleQuotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621682045082"><span class="hs-identifier hs-var">c_nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>                                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cap&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span>
</span><span id="line-552"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045158"><span class="hs-identifier hs-var">assignCResult</span></a></span><span>
</span><span id="line-553"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rts_unlock(cap);&quot;</span></span><span>
</span><span id="line-554"></span><span>     </span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; SDoc
forall doc. IsOutput doc =&gt; Bool -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045121"><span class="hs-identifier hs-var">res_hty_is_unit</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-555"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682045107"><span class="hs-identifier hs-var">libffi</span></a></span><span>
</span><span id="line-556"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045123"><span class="hs-identifier hs-var">ffi_cResType</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-557"></span><span>                       </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;resp = &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682045123"><span class="hs-identifier hs-var">ffi_cResType</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cret;&quot;</span></span><span>
</span><span id="line-558"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;return cret;&quot;</span></span><span>
</span><span id="line-559"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#rbrace"><span class="hs-identifier hs-var">rbrace</span></a></span><span>
</span><span id="line-560"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#mkHObj"><span class="hs-identifier hs-type">mkHObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-563"></span><span id="mkHObj"><span class="annot"><span class="annottext">mkHObj :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#mkHObj"><span class="hs-identifier hs-var hs-var">mkHObj</span></a></span></span><span> </span><span id="local-6989586621682045167"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045167"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rts_mk&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#showFFIType"><span class="hs-identifier hs-var">showFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045167"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#unpackHObj"><span class="hs-identifier hs-type">unpackHObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-566"></span><span id="unpackHObj"><span class="annot"><span class="annottext">unpackHObj :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#unpackHObj"><span class="hs-identifier hs-var hs-var">unpackHObj</span></a></span></span><span> </span><span id="local-6989586621682045169"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045169"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rts_get&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#showFFIType"><span class="hs-identifier hs-var">showFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045169"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#showStgType"><span class="hs-identifier hs-type">showStgType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-569"></span><span id="showStgType"><span class="annot"><span class="annottext">showStgType :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#showStgType"><span class="hs-identifier hs-var hs-var">showStgType</span></a></span></span><span> </span><span id="local-6989586621682045170"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045170"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Hs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#showFFIType"><span class="hs-identifier hs-var">showFFIType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045170"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#showFFIType"><span class="hs-identifier hs-type">showFFIType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-572"></span><span id="showFFIType"><span class="annot"><span class="annottext">showFFIType :: Type -&gt; SDoc
</span><a href="GHC.HsToCore.Foreign.C.html#showFFIType"><span class="hs-identifier hs-var hs-var">showFFIType</span></a></span></span><span> </span><span id="local-6989586621682045171"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045171"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SDoc
forall doc. IsLine doc =&gt; CLabelString -&gt; doc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; CLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TyCon
</span><a href="GHC.HsToCore.Foreign.C.html#typeTyCon"><span class="hs-identifier hs-var">typeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045171"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#typeTyCon"><span class="hs-identifier hs-type">typeTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-575"></span><span id="typeTyCon"><span class="annot"><span class="annottext">typeTyCon :: Type -&gt; TyCon
</span><a href="GHC.HsToCore.Foreign.C.html#typeTyCon"><span class="hs-identifier hs-var hs-var">typeTyCon</span></a></span></span><span> </span><span id="local-6989586621682045174"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045174"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045175"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045175"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045174"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045175"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TyCon
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.HsToCore.Foreign.C.typeTyCon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045174"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#insertRetAddr"><span class="hs-identifier hs-type">insertRetAddr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span>
</span><span id="line-583"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-584"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-585"></span><span id="insertRetAddr"><span class="annot"><span class="annottext">insertRetAddr :: Platform
-&gt; CCallConv
-&gt; [(SDoc, SDoc, Type, CmmType)]
-&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="GHC.HsToCore.Foreign.C.html#insertRetAddr"><span class="hs-identifier hs-var hs-var">insertRetAddr</span></a></span></span><span> </span><span id="local-6989586621682045178"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045178"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-var">CCallConv</span></a></span><span> </span><span id="local-6989586621682045180"><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045180"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045178"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-587"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span>
</span><span id="line-588"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045178"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSMinGW32/GHC.Platform.ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-589"></span><span>          </span><span class="hs-comment">-- On other Windows x86_64 we insert the return address</span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-comment">-- after the 4th argument, because this is the point</span><span>
</span><span id="line-591"></span><span>          </span><span class="hs-comment">-- at which we need to flush a register argument to the stack</span><span>
</span><span id="line-592"></span><span>          </span><span class="hs-comment">-- (See rts/Adjustor.c for details).</span><span>
</span><span id="line-593"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682045185"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-594"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-595"></span><span>              </span><span id="local-6989586621682045185"><span class="annot"><span class="annottext">go :: Int
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045185"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span id="local-6989586621682045186"><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045186"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; (SDoc, SDoc, Type, CmmType)
</span><a href="GHC.HsToCore.Foreign.C.html#ret_addr_arg"><span class="hs-identifier hs-var">ret_addr_arg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045178"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045186"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-596"></span><span>              </span><span class="annot"><a href="#local-6989586621682045185"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682045188"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045188"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045189"><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
</span><a href="#local-6989586621682045189"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682045190"><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045190"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
</span><a href="#local-6989586621682045189"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045185"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045188"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045190"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-597"></span><span>              </span><span class="annot"><a href="#local-6989586621682045185"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-598"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045185"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045180"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-599"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-600"></span><span>          </span><span class="hs-comment">-- On other x86_64 platforms we insert the return address</span><span>
</span><span id="line-601"></span><span>          </span><span class="hs-comment">-- after the 6th integer argument, because this is the point</span><span>
</span><span id="line-602"></span><span>          </span><span class="hs-comment">-- at which we need to flush a register argument to the stack</span><span>
</span><span id="line-603"></span><span>          </span><span class="hs-comment">-- (See rts/Adjustor.c for details).</span><span>
</span><span id="line-604"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682045192"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-605"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-606"></span><span>              </span><span id="local-6989586621682045192"><span class="annot"><span class="annottext">go :: Int
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045192"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span id="local-6989586621682045193"><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045193"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; (SDoc, SDoc, Type, CmmType)
</span><a href="GHC.HsToCore.Foreign.C.html#ret_addr_arg"><span class="hs-identifier hs-var">ret_addr_arg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045178"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045193"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-607"></span><span>              </span><span class="annot"><a href="#local-6989586621682045192"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682045194"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045194"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045195"><span class="annot"><span class="annottext">arg :: (SDoc, SDoc, Type, CmmType)
</span><a href="#local-6989586621682045195"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682045196"><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682045196"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682045197"><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045197"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; CmmType -&gt; Bool
</span><a href="GHC.Cmm.Type.html#cmmEqType_ignoring_ptrhood"><span class="hs-identifier hs-var">cmmEqType_ignoring_ptrhood</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="#local-6989586621682045196"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType
</span><a href="GHC.Cmm.Type.html#b64"><span class="hs-identifier hs-var">b64</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
</span><a href="#local-6989586621682045195"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045192"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045194"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045197"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-609"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
</span><a href="#local-6989586621682045195"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045192"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682045194"><span class="hs-identifier hs-var">n</span></a></span><span>     </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045197"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-610"></span><span>              </span><span class="annot"><a href="#local-6989586621682045192"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-611"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045192"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045180"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-612"></span><span>      </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-613"></span><span>          </span><span class="annot"><span class="annottext">Platform -&gt; (SDoc, SDoc, Type, CmmType)
</span><a href="GHC.HsToCore.Foreign.C.html#ret_addr_arg"><span class="hs-identifier hs-var">ret_addr_arg</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045178"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc, SDoc, Type, CmmType)
-&gt; [(SDoc, SDoc, Type, CmmType)] -&gt; [(SDoc, SDoc, Type, CmmType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045180"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-614"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#insertRetAddr"><span class="hs-identifier hs-var">insertRetAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682045200"><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045200"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SDoc, SDoc, Type, CmmType)]
</span><a href="#local-6989586621682045200"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#ret_addr_arg"><span class="hs-identifier hs-type">ret_addr_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Cmm.Type.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span id="ret_addr_arg"><span class="annot"><span class="annottext">ret_addr_arg :: Platform -&gt; (SDoc, SDoc, Type, CmmType)
</span><a href="GHC.HsToCore.Foreign.C.html#ret_addr_arg"><span class="hs-identifier hs-var hs-var">ret_addr_arg</span></a></span></span><span> </span><span id="local-6989586621682045201"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045201"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;original_return_addr&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void*&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
forall a. HasCallStack =&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Err.html#undefined/GHC.Err.html#undefined"><span class="hs-identifier hs-var">undefined</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-618"></span><span>                         </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#typeCmmType"><span class="hs-identifier hs-var">typeCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045201"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.Prim.html#addrPrimTy"><span class="hs-identifier hs-var">addrPrimTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span class="hs-comment">-- For stdcall labels, if the type was a FunPtr or newtype thereof,</span><span>
</span><span id="line-621"></span><span class="hs-comment">-- then we need to calculate the size of the arguments in order to add</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- the @n suffix to the label.</span><span>
</span><span id="line-623"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#fun_type_arg_stdcall_info"><span class="hs-identifier hs-type">fun_type_arg_stdcall_info</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallConv"><span class="hs-identifier hs-type">CCallConv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-624"></span><span id="fun_type_arg_stdcall_info"><span class="annot"><span class="annottext">fun_type_arg_stdcall_info :: Platform -&gt; CCallConv -&gt; Type -&gt; Maybe Int
</span><a href="GHC.HsToCore.Foreign.C.html#fun_type_arg_stdcall_info"><span class="hs-identifier hs-var hs-var">fun_type_arg_stdcall_info</span></a></span></span><span> </span><span id="local-6989586621682045202"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045202"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#StdCallConv"><span class="hs-identifier hs-var">StdCallConv</span></a></span><span> </span><span id="local-6989586621682045203"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045203"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682045204"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045204"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span class="hs-special">[</span><span id="local-6989586621682045205"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045205"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045203"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-626"></span><span>    </span><span class="annot"><span class="annottext">TyCon -&gt; Unique
</span><a href="GHC.Core.TyCon.html#tyConUnique"><span class="hs-identifier hs-var">tyConUnique</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682045204"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#funPtrTyConKey"><span class="hs-identifier hs-var">funPtrTyConKey</span></a></span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-628"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621682045206"><span class="annot"><span class="annottext">[PiTyVarBinder]
</span><a href="#local-6989586621682045206"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([PiTyVarBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPiTys"><span class="hs-identifier hs-var">tcSplitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682045205"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-629"></span><span>       </span><span id="local-6989586621682045207"><span class="annot"><span class="annottext">fe_arg_tys :: [Type]
</span><a href="#local-6989586621682045207"><span class="hs-identifier hs-var hs-var">fe_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PiTyVarBinder -&gt; Maybe Type) -&gt; [PiTyVarBinder] -&gt; [Type]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">PiTyVarBinder -&gt; Maybe Type
</span><a href="GHC.Types.Var.html#anonPiTyBinderType_maybe"><span class="hs-identifier hs-var">anonPiTyBinderType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[PiTyVarBinder]
</span><a href="#local-6989586621682045206"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-630"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; Int -&gt; Maybe Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#sum/Data.Foldable.html#sum"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Int) -&gt; [Type] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Width -&gt; Int
</span><a href="GHC.Cmm.Type.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Width -&gt; Int) -&gt; (Type -&gt; Width) -&gt; Type -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CmmType -&gt; Width
</span><a href="GHC.Cmm.Type.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a></span><span> </span><span class="annot"><span class="annottext">(CmmType -&gt; Width) -&gt; (Type -&gt; CmmType) -&gt; Type -&gt; Width
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Type -&gt; CmmType
</span><a href="GHC.Cmm.Utils.html#typeCmmType"><span class="hs-identifier hs-var">typeCmmType</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682045202"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; CmmType) -&gt; (Type -&gt; Type) -&gt; Type -&gt; CmmType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.HsToCore.Foreign.Utils.html#getPrimTyOf"><span class="hs-identifier hs-var">getPrimTyOf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682045207"><span class="hs-identifier hs-var">fe_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span class="annot"><a href="GHC.HsToCore.Foreign.C.html#fun_type_arg_stdcall_info"><span class="hs-identifier hs-var">fun_type_arg_stdcall_info</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682045209"><span class="annot"><span class="annottext">CCallConv
</span><a href="#local-6989586621682045209"><span class="hs-identifier hs-var">_other_conv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-633"></span></pre></body></html>