<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Runtime.Context</span><span>
</span><span id="line-2"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier">InteractiveContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-3"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveImport"><span class="hs-identifier">InteractiveImport</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#emptyInteractiveContext"><span class="hs-identifier">emptyInteractiveContext</span></a></span><span>
</span><span id="line-5"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#extendInteractiveContext"><span class="hs-identifier">extendInteractiveContext</span></a></span><span>
</span><span id="line-6"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#extendInteractiveContextWithIds"><span class="hs-identifier">extendInteractiveContextWithIds</span></a></span><span>
</span><span id="line-7"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#setInteractivePrintName"><span class="hs-identifier">setInteractivePrintName</span></a></span><span>
</span><span id="line-8"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#substInteractiveContext"><span class="hs-identifier">substInteractiveContext</span></a></span><span>
</span><span id="line-9"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#replaceImportEnv"><span class="hs-identifier">replaceImportEnv</span></a></span><span>
</span><span id="line-10"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier">icReaderEnv</span></a></span><span>
</span><span id="line-11"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#icInteractiveModule"><span class="hs-identifier">icInteractiveModule</span></a></span><span>
</span><span id="line-12"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#icInScopeTTs"><span class="hs-identifier">icInScopeTTs</span></a></span><span>
</span><span id="line-13"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#icNamePprCtx"><span class="hs-identifier">icNamePprCtx</span></a></span><span>
</span><span id="line-14"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">where</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html"><span class="hs-identifier">GHC.Runtime.Eval.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier">IcGlobalRdrEnv</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#Resume"><span class="hs-identifier">Resume</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Avail.html"><span class="hs-identifier">GHC.Types.Avail</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html"><span class="hs-identifier">GHC.Types.Fixity.Env</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#IdDetails"><span class="hs-identifier">IdDetails</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Ppr.html"><span class="hs-identifier">GHC.Types.Name.Ppr</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#ioTyConName"><span class="hs-identifier">ioTyConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#printName"><span class="hs-identifier">printName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#mkInteractiveModule"><span class="hs-identifier">mkInteractiveModule</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">{-
Note [The interactive package]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Type, class, and value declarations at the command prompt are treated
as if they were defined in modules
   interactive:Ghci1
   interactive:Ghci2
   ...etc...
with each bunch of declarations using a new module, all sharing a
common package 'interactive' (see Module.interactiveUnitId, and
GHC.Builtin.Names.mkInteractiveModule).

This scheme deals well with shadowing.  For example:

   ghci&gt; data T = A
   ghci&gt; data T = B
   ghci&gt; :i A
   data Ghci1.T = A  -- Defined at &lt;interactive&gt;:2:10

Here we must display info about constructor A, but its type T has been
shadowed by the second declaration.  But it has a respectable
qualified name (Ghci1.T), and its source location says where it was
defined, and it can also be used with the qualified name.

So the main invariant continues to hold, that in any session an
original name M.T only refers to one unique thing.  (In a previous
iteration both the T's above were called :Interactive.T, albeit with
different uniques, which gave rise to all sorts of trouble.)

The details are a bit tricky though:

 * The field ic_mod_index counts which Ghci module we've got up to.
   It is incremented when extending ic_tythings

 * ic_tythings contains only things from the 'interactive' package.

 * Module from the 'interactive' package (Ghci1, Ghci2 etc) never go
   in the Home Package Table (HPT).  When you say :load, that's when we
   extend the HPT.

 * The 'homeUnitId' field of DynFlags is *not* set to 'interactive'.
   It stays as 'main' (or whatever -this-unit-id says), and is the
   package to which :load'ed modules are added to.

 * So how do we arrange that declarations at the command prompt get to
   be in the 'interactive' package?  Simply by setting the tcg_mod
   field of the TcGblEnv to &quot;interactive:Ghci1&quot;.  This is done by the
   call to initTc in initTcInteractive, which in turn get the module
   from it 'icInteractiveModule' field of the interactive context.

   The 'homeUnitId' field stays as 'main' (or whatever -this-unit-id says.

 * The main trickiness is that the type environment (tcg_type_env) and
   fixity envt (tcg_fix_env), now contain entities from all the
   interactive-package modules (Ghci1, Ghci2, ...) together, rather
   than just a single module as is usually the case.  So you can't use
   &quot;nameIsLocalOrFrom&quot; to decide whether to look in the TcGblEnv vs
   the HPT/PTE.  This is a change, but not a problem provided you
   know.

* However, the tcg_binds, tcg_sigs, tcg_insts, tcg_fam_insts, etc fields
  of the TcGblEnv, which collect &quot;things defined in this module&quot;, all
  refer to stuff define in a single GHCi command, *not* all the commands
  so far.

  In contrast, tcg_inst_env, tcg_fam_inst_env, have instances from
  all GhciN modules, which makes sense -- they are all &quot;home package&quot;
  modules.


Note [Interactively-bound Ids in GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The Ids bound by previous Stmts in GHCi are currently
        a) GlobalIds, with
        b) An External Name, like Ghci4.foo
           See Note [The interactive package] above
        c) A tidied type

 (a) They must be GlobalIds (not LocalIds) otherwise when we come to
     compile an expression using these ids later, the byte code
     generator will consider the occurrences to be free rather than
     global.

 (b) Having an External Name is important because of Note
     [GlobalRdrEnv shadowing] in GHC.Types.Names.RdrName

 (c) Their types are tidied. This is important, because :info may ask
     to look at them, and :info expects the things it looks up to have
     tidy types

Where do interactively-bound Ids come from?

  - GHCi REPL Stmts   e.g.
         ghci&gt; let foo x = x+1
    These start with an Internal Name because a Stmt is a local
    construct, so the renamer naturally builds an Internal name for
    each of its binders.  Then in tcRnStmt they are externalised via
    GHC.Tc.Module.externaliseAndTidyId, so they get Names like Ghic4.foo.

  - Ids bound by the debugger etc have Names constructed by
    GHC.Iface.Env.newInteractiveBinder; at the call sites it is followed by
    mkVanillaGlobal or mkVanillaGlobalWithInfo.  So again, they are
    all Global, External.

  - TyCons, Classes, and Ids bound by other top-level declarations in
    GHCi (eg foreign import, record selectors) also get External
    Names, with Ghci9 (or 8, or 7, etc) as the module name.


Note [ic_tythings]
~~~~~~~~~~~~~~~~~~
The ic_tythings field contains
  * The TyThings declared by the user at the command prompt
    (eg Ids, TyCons, Classes)

  * The user-visible Ids that arise from such things, which
    *don't* come from 'implicitTyThings', notably:
       - record selectors
       - class ops
    The implicitTyThings are readily obtained from the TyThings
    but record selectors etc are not

It does *not* contain
  * DFunIds (they can be gotten from ic_instances)
  * CoAxioms (ditto)

See also Note [Interactively-bound Ids in GHCi]

Note [Override identical instances in GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If you declare a new instance in GHCi that is identical to a previous one,
we simply override the previous one; we don't regard it as overlapping.
e.g.    Prelude&gt; data T = A | B
        Prelude&gt; instance Eq T where ...
        Prelude&gt; instance Eq T where ...   -- This one overrides

It's exactly the same for type-family instances.  See #7102

Note [icReaderEnv recalculation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The GlobalRdrEnv describing what&#8217;s in scope at the prompts consists
of all the imported things, followed by all the things defined on the prompt, with
shadowing. Defining new things on the prompt is easy: we shadow as needed and then extend the environment.  But changing the set of imports, which can happen later as well,
is tricky: we need to re-apply the shadowing from all the things defined at the prompt!

For example:

    ghci&gt; let empty = True
    ghci&gt; import Data.IntMap.Strict     -- Exports 'empty'
    ghci&gt; empty   -- Still gets the 'empty' defined at the prompt
    True


It would be correct ot re-construct the env from scratch based on
`ic_tythings`, but that'd be quite expensive if there are many entries in
`ic_tythings` that shadow each other.

Therefore we keep around a that `GlobalRdrEnv` in `igre_prompt_env` that
contians _just_ the things defined at the prompt, and use that in
`replaceImportEnv` to rebuild the full env.  Conveniently, `shadowNames` takes
such an `OccEnv` to denote the set of names to shadow.

INVARIANT: Every `OccName` in `igre_prompt_env` is present unqualified as well
(else it would not be right to use pass `igre_prompt_env` to `shadowNames`.)

The definition of the IcGlobalRdrEnv type should conceptually be in this module, and
made abstract, but it&#8217;s used in `Resume`, so it lives in GHC.Runtime.Eval.Type.
-
-}</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Interactive context, recording information about the state of the</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- context in which statements are executed in a GHCi session.</span><span>
</span><span id="line-219"></span><span class="hs-keyword">data</span><span> </span><span id="InteractiveContext"><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-var">InteractiveContext</span></a></span></span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InteractiveContext"><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-var">InteractiveContext</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-221"></span><span>         </span><span id="ic_dflags"><span class="annot"><span class="annottext">InteractiveContext -&gt; DynFlags
</span><a href="GHC.Runtime.Context.html#ic_dflags"><span class="hs-identifier hs-var hs-var">ic_dflags</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>             </span><span class="hs-comment">-- ^ The 'DynFlags' used to evaluate interactive expressions</span><span>
</span><span id="line-223"></span><span>             </span><span class="hs-comment">-- and statements.</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>         </span><span id="ic_mod_index"><span class="annot"><span class="annottext">InteractiveContext -&gt; Int
</span><a href="GHC.Runtime.Context.html#ic_mod_index"><span class="hs-identifier hs-var hs-var">ic_mod_index</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-226"></span><span>             </span><span class="hs-comment">-- ^ Each GHCi stmt or declaration brings some new things into</span><span>
</span><span id="line-227"></span><span>             </span><span class="hs-comment">-- scope. We give them names like interactive:Ghci9.T,</span><span>
</span><span id="line-228"></span><span>             </span><span class="hs-comment">-- where the ic_index is the '9'.  The ic_mod_index is</span><span>
</span><span id="line-229"></span><span>             </span><span class="hs-comment">-- incremented whenever we add something to ic_tythings</span><span>
</span><span id="line-230"></span><span>             </span><span class="hs-comment">-- See Note [The interactive package]</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>         </span><span id="ic_imports"><span class="annot"><span class="annottext">InteractiveContext -&gt; [InteractiveImport]
</span><a href="GHC.Runtime.Context.html#ic_imports"><span class="hs-identifier hs-var hs-var">ic_imports</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveImport"><span class="hs-identifier hs-type">InteractiveImport</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-233"></span><span>             </span><span class="hs-comment">-- ^ The GHCi top-level scope (icReaderEnv) is extended with</span><span>
</span><span id="line-234"></span><span>             </span><span class="hs-comment">-- these imports</span><span>
</span><span id="line-235"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-236"></span><span>             </span><span class="hs-comment">-- This field is only stored here so that the client</span><span>
</span><span id="line-237"></span><span>             </span><span class="hs-comment">-- can retrieve it with GHC.getContext. GHC itself doesn't</span><span>
</span><span id="line-238"></span><span>             </span><span class="hs-comment">-- use it, but does reset it to empty sometimes (such</span><span>
</span><span id="line-239"></span><span>             </span><span class="hs-comment">-- as before a GHC.load). The context is set with GHC.setContext.</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>         </span><span id="ic_tythings"><span class="annot"><span class="annottext">InteractiveContext -&gt; [TyThing]
</span><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var hs-var">ic_tythings</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-242"></span><span>             </span><span class="hs-comment">-- ^ TyThings defined by the user, in reverse order of</span><span>
</span><span id="line-243"></span><span>             </span><span class="hs-comment">-- definition (ie most recent at the front).</span><span>
</span><span id="line-244"></span><span>             </span><span class="hs-comment">-- Also used in GHC.Tc.Module.runTcInteractive to fill the type</span><span>
</span><span id="line-245"></span><span>             </span><span class="hs-comment">-- checker environment.</span><span>
</span><span id="line-246"></span><span>             </span><span class="hs-comment">-- See Note [ic_tythings]</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>         </span><span id="ic_gre_cache"><span class="annot"><span class="annottext">InteractiveContext -&gt; IcGlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#ic_gre_cache"><span class="hs-identifier hs-var hs-var">ic_gre_cache</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-249"></span><span>             </span><span class="hs-comment">-- ^ Essentially the cached 'GlobalRdrEnv'.</span><span>
</span><span id="line-250"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span>             </span><span class="hs-comment">-- The GlobalRdrEnv contains everything in scope at the command</span><span>
</span><span id="line-252"></span><span>             </span><span class="hs-comment">-- line, both imported and everything in ic_tythings, with the</span><span>
</span><span id="line-253"></span><span>             </span><span class="hs-comment">-- correct shadowing.</span><span>
</span><span id="line-254"></span><span>             </span><span class="hs-comment">--</span><span>
</span><span id="line-255"></span><span>             </span><span class="hs-comment">-- The IcGlobalRdrEnv contains extra data to allow efficient</span><span>
</span><span id="line-256"></span><span>             </span><span class="hs-comment">-- recalculation when the set of imports change.</span><span>
</span><span id="line-257"></span><span>             </span><span class="hs-comment">-- See Note [icReaderEnv recalculation]</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>         </span><span id="ic_instances"><span class="annot"><span class="annottext">InteractiveContext -&gt; (InstEnv, [FamInst])
</span><a href="GHC.Runtime.Context.html#ic_instances"><span class="hs-identifier hs-var hs-var">ic_instances</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-260"></span><span>             </span><span class="hs-comment">-- ^ All instances and family instances created during</span><span>
</span><span id="line-261"></span><span>             </span><span class="hs-comment">-- this session.  These are grabbed en masse after each</span><span>
</span><span id="line-262"></span><span>             </span><span class="hs-comment">-- update to be sure that proper overlapping is retained.</span><span>
</span><span id="line-263"></span><span>             </span><span class="hs-comment">-- That is, rather than re-check the overlapping each</span><span>
</span><span id="line-264"></span><span>             </span><span class="hs-comment">-- time we update the context, we just take the results</span><span>
</span><span id="line-265"></span><span>             </span><span class="hs-comment">-- from the instance code that already does that.</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>         </span><span id="ic_fix_env"><span class="annot"><span class="annottext">InteractiveContext -&gt; FixityEnv
</span><a href="GHC.Runtime.Context.html#ic_fix_env"><span class="hs-identifier hs-var hs-var">ic_fix_env</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>            </span><span class="annot"><span class="hs-comment">-- ^ Fixities declared in let statements</span></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>         </span><span id="ic_default"><span class="annot"><span class="annottext">InteractiveContext -&gt; Maybe [Type]
</span><a href="GHC.Runtime.Context.html#ic_default"><span class="hs-identifier hs-var hs-var">ic_default</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ The current default types, set by a 'default' declaration</span></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>         </span><span id="ic_resume"><span class="annot"><span class="annottext">InteractiveContext -&gt; [Resume]
</span><a href="GHC.Runtime.Context.html#ic_resume"><span class="hs-identifier hs-var hs-var">ic_resume</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#Resume"><span class="hs-identifier hs-type">Resume</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ The stack of breakpoint contexts</span></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>         </span><span id="ic_monad"><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Runtime.Context.html#ic_monad"><span class="hs-identifier hs-var hs-var">ic_monad</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ The monad that GHCi is executing in</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>         </span><span id="ic_int_print"><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Runtime.Context.html#ic_int_print"><span class="hs-identifier hs-var hs-var">ic_int_print</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>             </span><span class="hs-comment">-- ^ The function that is used for printing results</span><span>
</span><span id="line-281"></span><span>             </span><span class="hs-comment">-- of expressions in ghci and -e mode.</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>         </span><span id="ic_cwd"><span class="annot"><span class="annottext">InteractiveContext -&gt; Maybe FilePath
</span><a href="GHC.Runtime.Context.html#ic_cwd"><span class="hs-identifier hs-var hs-var">ic_cwd</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>             </span><span class="annot"><span class="hs-comment">-- ^ virtual CWD of the program</span></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>         </span><span id="ic_plugins"><span class="annot"><span class="annottext">InteractiveContext -&gt; Plugins
</span><a href="GHC.Runtime.Context.html#ic_plugins"><span class="hs-identifier hs-var hs-var">ic_plugins</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Driver.Plugins.html#Plugins"><span class="hs-identifier hs-type">Plugins</span></a></span><span>
</span><span id="line-287"></span><span>             </span><span class="hs-comment">-- ^ Cache of loaded plugins. We store them here to avoid having to</span><span>
</span><span id="line-288"></span><span>             </span><span class="hs-comment">-- load them every time we switch to the interactive context.</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-keyword">data</span><span> </span><span id="InteractiveImport"><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveImport"><span class="hs-identifier hs-var">InteractiveImport</span></a></span></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="IIDecl"><span class="annot"><a href="GHC.Runtime.Context.html#IIDecl"><span class="hs-identifier hs-var">IIDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>      </span><span class="hs-comment">-- ^ Bring the exports of a particular module</span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-comment">-- (filtered by an import decl) into scope</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="IIModule"><span class="annot"><a href="GHC.Runtime.Context.html#IIModule"><span class="hs-identifier hs-var">IIModule</span></a></span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-comment">-- ^ Bring into scope the entire top-level envt of</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-comment">-- of this module, including the things imported</span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-comment">-- into it.</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="annot"><a href="GHC.Runtime.Context.html#emptyIcGlobalRdrEnv"><span class="hs-identifier hs-type">emptyIcGlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span>
</span><span id="line-302"></span><span id="emptyIcGlobalRdrEnv"><span class="annot"><span class="annottext">emptyIcGlobalRdrEnv :: IcGlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#emptyIcGlobalRdrEnv"><span class="hs-identifier hs-var hs-var">emptyIcGlobalRdrEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">igre_env :: GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_env"><span class="hs-identifier hs-var">igre_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">igre_prompt_env :: GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_prompt_env"><span class="hs-identifier hs-var">igre_prompt_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="annot"><span class="hs-comment">-- | Constructs an empty InteractiveContext.</span></span><span>
</span><span id="line-308"></span><span class="annot"><a href="GHC.Runtime.Context.html#emptyInteractiveContext"><span class="hs-identifier hs-type">emptyInteractiveContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span>
</span><span id="line-309"></span><span id="emptyInteractiveContext"><span class="annot"><span class="annottext">emptyInteractiveContext :: DynFlags -&gt; InteractiveContext
</span><a href="GHC.Runtime.Context.html#emptyInteractiveContext"><span class="hs-identifier hs-var hs-var">emptyInteractiveContext</span></a></span></span><span> </span><span id="local-6989586621681884044"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681884044"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-311"></span><span>       </span><span class="annot"><span class="annottext">ic_dflags :: DynFlags
</span><a href="GHC.Runtime.Context.html#ic_dflags"><span class="hs-identifier hs-var">ic_dflags</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681884044"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-312"></span><span>       </span><span class="annot"><span class="annottext">ic_imports :: [InteractiveImport]
</span><a href="GHC.Runtime.Context.html#ic_imports"><span class="hs-identifier hs-var">ic_imports</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>       </span><span class="annot"><span class="annottext">ic_gre_cache :: IcGlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#ic_gre_cache"><span class="hs-identifier hs-var">ic_gre_cache</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#emptyIcGlobalRdrEnv"><span class="hs-identifier hs-var">emptyIcGlobalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-314"></span><span>       </span><span class="annot"><span class="annottext">ic_mod_index :: Int
</span><a href="GHC.Runtime.Context.html#ic_mod_index"><span class="hs-identifier hs-var">ic_mod_index</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-315"></span><span>       </span><span class="annot"><span class="annottext">ic_tythings :: [TyThing]
</span><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>       </span><span class="annot"><span class="annottext">ic_instances :: (InstEnv, [FamInst])
</span><a href="GHC.Runtime.Context.html#ic_instances"><span class="hs-identifier hs-var">ic_instances</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnv
</span><a href="GHC.Core.InstEnv.html#emptyInstEnv"><span class="hs-identifier hs-var">emptyInstEnv</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>       </span><span class="annot"><span class="annottext">ic_fix_env :: FixityEnv
</span><a href="GHC.Runtime.Context.html#ic_fix_env"><span class="hs-identifier hs-var">ic_fix_env</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-318"></span><span>       </span><span class="annot"><span class="annottext">ic_monad :: Name
</span><a href="GHC.Runtime.Context.html#ic_monad"><span class="hs-identifier hs-var">ic_monad</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a></span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- IO monad by default</span><span>
</span><span id="line-319"></span><span>       </span><span class="annot"><span class="annottext">ic_int_print :: Name
</span><a href="GHC.Runtime.Context.html#ic_int_print"><span class="hs-identifier hs-var">ic_int_print</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#printName"><span class="hs-identifier hs-var">printName</span></a></span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- System.IO.print by default</span><span>
</span><span id="line-320"></span><span>       </span><span class="annot"><span class="annottext">ic_default :: Maybe [Type]
</span><a href="GHC.Runtime.Context.html#ic_default"><span class="hs-identifier hs-var">ic_default</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Type]
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-321"></span><span>       </span><span class="annot"><span class="annottext">ic_resume :: [Resume]
</span><a href="GHC.Runtime.Context.html#ic_resume"><span class="hs-identifier hs-var">ic_resume</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>       </span><span class="annot"><span class="annottext">ic_cwd :: Maybe FilePath
</span><a href="GHC.Runtime.Context.html#ic_cwd"><span class="hs-identifier hs-var">ic_cwd</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>       </span><span class="annot"><span class="annottext">ic_plugins :: Plugins
</span><a href="GHC.Runtime.Context.html#ic_plugins"><span class="hs-identifier hs-var">ic_plugins</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Plugins
</span><a href="GHC.Driver.Plugins.html#emptyPlugins"><span class="hs-identifier hs-var">emptyPlugins</span></a></span><span>
</span><span id="line-324"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="annot"><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier hs-type">icReaderEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-327"></span><span id="icReaderEnv"><span class="annot"><span class="annottext">icReaderEnv :: InteractiveContext -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier hs-var hs-var">icReaderEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_env"><span class="hs-identifier hs-var">igre_env</span></a></span><span> </span><span class="annot"><span class="annottext">(IcGlobalRdrEnv -&gt; GlobalRdrEnv)
-&gt; (InteractiveContext -&gt; IcGlobalRdrEnv)
-&gt; InteractiveContext
-&gt; GlobalRdrEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; IcGlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#ic_gre_cache"><span class="hs-identifier hs-var">ic_gre_cache</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="annot"><a href="GHC.Runtime.Context.html#icInteractiveModule"><span class="hs-identifier hs-type">icInteractiveModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-330"></span><span id="icInteractiveModule"><span class="annot"><span class="annottext">icInteractiveModule :: InteractiveContext -&gt; Module
</span><a href="GHC.Runtime.Context.html#icInteractiveModule"><span class="hs-identifier hs-var hs-var">icInteractiveModule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ic_mod_index :: InteractiveContext -&gt; Int
</span><a href="GHC.Runtime.Context.html#ic_mod_index"><span class="hs-identifier hs-var">ic_mod_index</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681884049"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681884049"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Module
</span><a href="GHC.Builtin.Names.html#mkInteractiveModule"><span class="hs-identifier hs-var">mkInteractiveModule</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681884049"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-comment">-- | This function returns the list of visible TyThings (useful for</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- e.g. showBindings).</span><span>
</span><span id="line-335"></span><span class="hs-comment">--</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- It picks only those TyThings that are not shadowed by later definitions on the interpreter,</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- to not clutter :showBindings with shadowed ids, which would show up as Ghci9.foo.</span><span>
</span><span id="line-338"></span><span class="hs-comment">--</span><span>
</span><span id="line-339"></span><span class="hs-comment">-- Some TyThings define many names; we include them if _any_ name is still</span><span>
</span><span id="line-340"></span><span class="hs-comment">-- available unqualified.</span><span>
</span><span id="line-341"></span><span class="annot"><a href="GHC.Runtime.Context.html#icInScopeTTs"><span class="hs-identifier hs-type">icInScopeTTs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-342"></span><span id="icInScopeTTs"><span class="annot"><span class="annottext">icInScopeTTs :: InteractiveContext -&gt; [TyThing]
</span><a href="GHC.Runtime.Context.html#icInScopeTTs"><span class="hs-identifier hs-var hs-var">icInScopeTTs</span></a></span></span><span> </span><span id="local-6989586621681884050"><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884050"><span class="hs-identifier hs-var">ictxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; Bool) -&gt; [TyThing] -&gt; [TyThing]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; Bool
</span><a href="#local-6989586621681884051"><span class="hs-identifier hs-var">in_scope_unqualified</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; [TyThing]
</span><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884050"><span class="hs-identifier hs-var">ictxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621681884051"><span class="annot"><span class="annottext">in_scope_unqualified :: TyThing -&gt; Bool
</span><a href="#local-6989586621681884051"><span class="hs-identifier hs-var hs-var">in_scope_unqualified</span></a></span></span><span> </span><span id="local-6989586621681884052"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681884052"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#or/Data.Foldable.html#or"><span class="hs-identifier hs-var">or</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#unQualOK"><span class="hs-identifier hs-var">unQualOK</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681884055"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-346"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681884056"><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621681884056"><span class="hs-identifier hs-var">avail</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; [AvailInfo]
</span><a href="GHC.Types.TyThing.html#tyThingAvailInfo"><span class="hs-identifier hs-var">tyThingAvailInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681884052"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681884058"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681884058"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; [Name]
</span><a href="GHC.Types.Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo
</span><a href="#local-6989586621681884056"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681884055"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681884055"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier hs-var">icReaderEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884050"><span class="hs-identifier hs-var">ictxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681884058"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><span class="hs-comment">-- | Get the NamePprCtx function based on the flags and this InteractiveContext</span></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Runtime.Context.html#icNamePprCtx"><span class="hs-identifier hs-type">icNamePprCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#NamePprCtx"><span class="hs-identifier hs-type">NamePprCtx</span></a></span><span>
</span><span id="line-354"></span><span id="icNamePprCtx"><span class="annot"><span class="annottext">icNamePprCtx :: UnitEnv -&gt; InteractiveContext -&gt; NamePprCtx
</span><a href="GHC.Runtime.Context.html#icNamePprCtx"><span class="hs-identifier hs-var hs-var">icNamePprCtx</span></a></span></span><span> </span><span id="local-6989586621681884061"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621681884061"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621681884062"><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884062"><span class="hs-identifier hs-var">ictxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnv -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#mkNamePprCtx"><span class="hs-identifier hs-var">mkNamePprCtx</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621681884064"><span class="hs-identifier hs-var">ptc</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621681884061"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icReaderEnv"><span class="hs-identifier hs-var">icReaderEnv</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884062"><span class="hs-identifier hs-var">ictxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681884064"><span class="annot"><span class="annottext">ptc :: PromotionTickContext
</span><a href="#local-6989586621681884064"><span class="hs-identifier hs-var hs-var">ptc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.Session.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; DynFlags
</span><a href="GHC.Runtime.Context.html#ic_dflags"><span class="hs-identifier hs-var">ic_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884062"><span class="hs-identifier hs-var">ictxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- | extendInteractiveContext is called with new TyThings recently defined to update the</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- InteractiveContext to include them. By putting new things first, unqualified</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- use will pick the most recently defined thing with a given name, while</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- still keeping the old names in scope in their qualified form (Ghci1.foo).</span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.Runtime.Context.html#extendInteractiveContext"><span class="hs-identifier hs-type">extendInteractiveContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span>
</span><span id="line-362"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-363"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-364"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-365"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span>
</span><span id="line-366"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span>
</span><span id="line-367"></span><span id="extendInteractiveContext"><span class="annot"><span class="annottext">extendInteractiveContext :: InteractiveContext
-&gt; [TyThing]
-&gt; InstEnv
-&gt; [FamInst]
-&gt; Maybe [Type]
-&gt; FixityEnv
-&gt; InteractiveContext
</span><a href="GHC.Runtime.Context.html#extendInteractiveContext"><span class="hs-identifier hs-var hs-var">extendInteractiveContext</span></a></span></span><span> </span><span id="local-6989586621681884066"><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884066"><span class="hs-identifier hs-var">ictxt</span></a></span></span><span> </span><span id="local-6989586621681884067"><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681884067"><span class="hs-identifier hs-var">new_tythings</span></a></span></span><span> </span><span id="local-6989586621681884068"><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621681884068"><span class="hs-identifier hs-var">new_cls_insts</span></a></span></span><span> </span><span id="local-6989586621681884069"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621681884069"><span class="hs-identifier hs-var">new_fam_insts</span></a></span></span><span> </span><span id="local-6989586621681884070"><span class="annot"><span class="annottext">Maybe [Type]
</span><a href="#local-6989586621681884070"><span class="hs-identifier hs-var">defaults</span></a></span></span><span> </span><span id="local-6989586621681884071"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681884071"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884066"><span class="hs-identifier hs-var">ictxt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_mod_index"><span class="hs-identifier hs-var">ic_mod_index</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_mod_index"><span class="hs-identifier hs-var">ic_mod_index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884066"><span class="hs-identifier hs-type">ictxt</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-type">+</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-369"></span><span>                            </span><span class="hs-comment">-- Always bump this; even instances should create</span><span>
</span><span id="line-370"></span><span>                            </span><span class="hs-comment">-- a new mod_index (#9426)</span><span>
</span><span id="line-371"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681884067"><span class="hs-identifier hs-type">new_tythings</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884066"><span class="hs-identifier hs-type">ictxt</span></a></span><span>
</span><span id="line-372"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_gre_cache"><span class="hs-identifier hs-var">ic_gre_cache</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_gre_cache"><span class="hs-identifier hs-var">ic_gre_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884066"><span class="hs-identifier hs-type">ictxt</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#icExtendIcGblRdrEnv"><span class="hs-operator hs-type">`icExtendIcGblRdrEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884067"><span class="hs-identifier hs-type">new_tythings</span></a></span><span>
</span><span id="line-373"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_instances"><span class="hs-identifier hs-var">ic_instances</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621681884068"><span class="hs-identifier hs-type">new_cls_insts</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#unionInstEnv"><span class="hs-operator hs-type">`unionInstEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884075"><span class="hs-identifier hs-type">old_cls_insts</span></a></span><span>
</span><span id="line-374"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681884069"><span class="hs-identifier hs-type">new_fam_insts</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884076"><span class="hs-identifier hs-type">fam_insts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>                            </span><span class="hs-comment">-- we don't shadow old family instances (#7102),</span><span>
</span><span id="line-376"></span><span>                            </span><span class="hs-comment">-- so don't need to remove them here</span><span>
</span><span id="line-377"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_default"><span class="hs-identifier hs-var">ic_default</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681884070"><span class="hs-identifier hs-type">defaults</span></a></span><span>
</span><span id="line-378"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_fix_env"><span class="hs-identifier hs-var">ic_fix_env</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681884071"><span class="hs-identifier hs-type">fix_env</span></a></span><span>  </span><span class="hs-comment">-- See Note [Fixity declarations in GHCi]</span><span>
</span><span id="line-379"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-comment">-- Discard old instances that have been fully overridden</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-comment">-- See Note [Override identical instances in GHCi]</span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681884077"><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621681884077"><span class="hs-identifier hs-var">cls_insts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681884076"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621681884076"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; (InstEnv, [FamInst])
</span><a href="GHC.Runtime.Context.html#ic_instances"><span class="hs-identifier hs-var">ic_instances</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884066"><span class="hs-identifier hs-var">ictxt</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621681884075"><span class="annot"><span class="annottext">old_cls_insts :: InstEnv
</span><a href="#local-6989586621681884075"><span class="hs-identifier hs-var hs-var">old_cls_insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; Bool) -&gt; InstEnv -&gt; InstEnv
</span><a href="GHC.Core.InstEnv.html#filterInstEnv"><span class="hs-identifier hs-var">filterInstEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681884079"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681884079"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; Bool) -&gt; InstEnv -&gt; Bool
</span><a href="GHC.Core.InstEnv.html#anyInstEnv"><span class="hs-identifier hs-var">anyInstEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; ClsInst -&gt; Bool
</span><a href="GHC.Core.InstEnv.html#identicalClsInstHead"><span class="hs-identifier hs-var">identicalClsInstHead</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681884079"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621681884068"><span class="hs-identifier hs-var">new_cls_insts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="#local-6989586621681884077"><span class="hs-identifier hs-var">cls_insts</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="annot"><a href="GHC.Runtime.Context.html#extendInteractiveContextWithIds"><span class="hs-identifier hs-type">extendInteractiveContextWithIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Just a specialised version</span><span>
</span><span id="line-388"></span><span id="extendInteractiveContextWithIds"><span class="annot"><span class="annottext">extendInteractiveContextWithIds :: InteractiveContext -&gt; [Id] -&gt; InteractiveContext
</span><a href="GHC.Runtime.Context.html#extendInteractiveContextWithIds"><span class="hs-identifier hs-var hs-var">extendInteractiveContextWithIds</span></a></span></span><span> </span><span id="local-6989586621681884083"><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884083"><span class="hs-identifier hs-var">ictxt</span></a></span></span><span> </span><span id="local-6989586621681884084"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681884084"><span class="hs-identifier hs-var">new_ids</span></a></span></span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681884084"><span class="hs-identifier hs-var">new_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884083"><span class="hs-identifier hs-var">ictxt</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884083"><span class="hs-identifier hs-var">ictxt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_mod_index"><span class="hs-identifier hs-var">ic_mod_index</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_mod_index"><span class="hs-identifier hs-var">ic_mod_index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884083"><span class="hs-identifier hs-type">ictxt</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-type">+</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-392"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681884086"><span class="hs-identifier hs-type">new_tythings</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884083"><span class="hs-identifier hs-type">ictxt</span></a></span><span>
</span><span id="line-393"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_gre_cache"><span class="hs-identifier hs-var">ic_gre_cache</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_gre_cache"><span class="hs-identifier hs-var">ic_gre_cache</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884083"><span class="hs-identifier hs-type">ictxt</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#icExtendIcGblRdrEnv"><span class="hs-operator hs-type">`icExtendIcGblRdrEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884086"><span class="hs-identifier hs-type">new_tythings</span></a></span><span>
</span><span id="line-394"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621681884086"><span class="annot"><span class="annottext">new_tythings :: [TyThing]
</span><a href="#local-6989586621681884086"><span class="hs-identifier hs-var hs-var">new_tythings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; TyThing) -&gt; [Id] -&gt; [TyThing]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-var">AnId</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681884084"><span class="hs-identifier hs-var">new_ids</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="annot"><a href="GHC.Runtime.Context.html#setInteractivePrintName"><span class="hs-identifier hs-type">setInteractivePrintName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span>
</span><span id="line-399"></span><span id="setInteractivePrintName"><span class="annot"><span class="annottext">setInteractivePrintName :: InteractiveContext -&gt; Name -&gt; InteractiveContext
</span><a href="GHC.Runtime.Context.html#setInteractivePrintName"><span class="hs-identifier hs-var hs-var">setInteractivePrintName</span></a></span></span><span> </span><span id="local-6989586621681884088"><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884088"><span class="hs-identifier hs-var">ic</span></a></span></span><span> </span><span id="local-6989586621681884089"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681884089"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884088"><span class="hs-identifier hs-var">ic</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.Runtime.Context.html#ic_int_print"><span class="hs-identifier hs-var">ic_int_print</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681884089"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><a href="GHC.Runtime.Context.html#icExtendIcGblRdrEnv"><span class="hs-identifier hs-type">icExtendIcGblRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span>
</span><span id="line-402"></span><span id="icExtendIcGblRdrEnv"><span class="annot"><span class="annottext">icExtendIcGblRdrEnv :: IcGlobalRdrEnv -&gt; [TyThing] -&gt; IcGlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icExtendIcGblRdrEnv"><span class="hs-identifier hs-var hs-var">icExtendIcGblRdrEnv</span></a></span></span><span> </span><span id="local-6989586621681884090"><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="#local-6989586621681884090"><span class="hs-identifier hs-var">igre</span></a></span></span><span> </span><span id="local-6989586621681884091"><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681884091"><span class="hs-identifier hs-var">tythings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">igre_env :: GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_env"><span class="hs-identifier hs-var">igre_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_env"><span class="hs-identifier hs-var">igre_env</span></a></span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="#local-6989586621681884090"><span class="hs-identifier hs-var">igre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; [TyThing] -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icExtendGblRdrEnv"><span class="hs-operator hs-var">`icExtendGblRdrEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681884091"><span class="hs-identifier hs-var">tythings</span></a></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">igre_prompt_env :: GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_prompt_env"><span class="hs-identifier hs-var">igre_prompt_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_prompt_env"><span class="hs-identifier hs-var">igre_prompt_env</span></a></span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="#local-6989586621681884090"><span class="hs-identifier hs-var">igre</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; [TyThing] -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icExtendGblRdrEnv"><span class="hs-operator hs-var">`icExtendGblRdrEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681884091"><span class="hs-identifier hs-var">tythings</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-comment">-- This is used by setContext in GHC.Runtime.Eval when the set of imports</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- changes, and recalculates the GlobalRdrEnv. See Note [icReaderEnv recalculation]</span><span>
</span><span id="line-409"></span><span class="annot"><a href="GHC.Runtime.Context.html#replaceImportEnv"><span class="hs-identifier hs-type">replaceImportEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#IcGlobalRdrEnv"><span class="hs-identifier hs-type">IcGlobalRdrEnv</span></a></span><span>
</span><span id="line-410"></span><span id="replaceImportEnv"><span class="annot"><span class="annottext">replaceImportEnv :: IcGlobalRdrEnv -&gt; GlobalRdrEnv -&gt; IcGlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#replaceImportEnv"><span class="hs-identifier hs-var hs-var">replaceImportEnv</span></a></span></span><span> </span><span id="local-6989586621681884093"><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="#local-6989586621681884093"><span class="hs-identifier hs-var">igre</span></a></span></span><span> </span><span id="local-6989586621681884094"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884094"><span class="hs-identifier hs-var">import_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="#local-6989586621681884093"><span class="hs-identifier hs-var">igre</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Eval.Types.html#igre_env"><span class="hs-identifier hs-var">igre_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681884095"><span class="hs-identifier hs-type">new_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621681884096"><span class="annot"><span class="annottext">import_env_shadowed :: GlobalRdrEnv
</span><a href="#local-6989586621681884096"><span class="hs-identifier hs-var hs-var">import_env_shadowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884094"><span class="hs-identifier hs-var">import_env</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv
forall a. GlobalRdrEnv -&gt; OccEnv a -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#shadowNames"><span class="hs-operator hs-var">`shadowNames`</span></a></span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_prompt_env"><span class="hs-identifier hs-var">igre_prompt_env</span></a></span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="#local-6989586621681884093"><span class="hs-identifier hs-var">igre</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span id="local-6989586621681884095"><span class="annot"><span class="annottext">new_env :: GlobalRdrEnv
</span><a href="#local-6989586621681884095"><span class="hs-identifier hs-var hs-var">new_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884096"><span class="hs-identifier hs-var">import_env_shadowed</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#plusGlobalRdrEnv"><span class="hs-operator hs-var">`plusGlobalRdrEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Eval.Types.html#igre_prompt_env"><span class="hs-identifier hs-var">igre_prompt_env</span></a></span><span> </span><span class="annot"><span class="annottext">IcGlobalRdrEnv
</span><a href="#local-6989586621681884093"><span class="hs-identifier hs-var">igre</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="hs-comment">-- | Add TyThings to the GlobalRdrEnv, earlier ones in the list shadowing</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- later ones, and shadowing existing entries in the GlobalRdrEnv.</span><span>
</span><span id="line-417"></span><span class="annot"><a href="GHC.Runtime.Context.html#icExtendGblRdrEnv"><span class="hs-identifier hs-type">icExtendGblRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-418"></span><span id="icExtendGblRdrEnv"><span class="annot"><span class="annottext">icExtendGblRdrEnv :: GlobalRdrEnv -&gt; [TyThing] -&gt; GlobalRdrEnv
</span><a href="GHC.Runtime.Context.html#icExtendGblRdrEnv"><span class="hs-identifier hs-var hs-var">icExtendGblRdrEnv</span></a></span></span><span> </span><span id="local-6989586621681884099"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884099"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681884100"><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681884100"><span class="hs-identifier hs-var">tythings</span></a></span></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv)
-&gt; GlobalRdrEnv -&gt; [TyThing] -&gt; GlobalRdrEnv
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="#local-6989586621681884102"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884099"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681884100"><span class="hs-identifier hs-var">tythings</span></a></span><span>  </span><span class="hs-comment">-- Foldr makes things in the front of</span><span>
</span><span id="line-420"></span><span>                            </span><span class="hs-comment">-- the list shadow things at the back</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-comment">-- One at a time, to ensure each shadows the previous ones</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621681884102"><span class="annot"><span class="annottext">add :: TyThing -&gt; GlobalRdrEnv -&gt; GlobalRdrEnv
</span><a href="#local-6989586621681884102"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621681884108"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681884108"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span id="local-6989586621681884109"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884109"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-424"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; Bool
</span><a href="#local-6989586621681884110"><span class="hs-identifier hs-var">is_sub_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681884108"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-425"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884109"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-426"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-427"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrEnv -&gt; GlobalRdrElt -&gt; GlobalRdrEnv)
-&gt; GlobalRdrEnv -&gt; [GlobalRdrElt] -&gt; GlobalRdrEnv
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; GlobalRdrElt -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#extendGlobalRdrEnv"><span class="hs-identifier hs-var">extendGlobalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884113"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AvailInfo -&gt; [GlobalRdrElt]) -&gt; [AvailInfo] -&gt; [GlobalRdrElt]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; [GlobalRdrElt]
</span><a href="GHC.Types.Name.Reader.html#localGREsFromAvail"><span class="hs-identifier hs-var">localGREsFromAvail</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621681884116"><span class="hs-identifier hs-var">avail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>          </span><span id="local-6989586621681884117"><span class="annot"><span class="annottext">new_gres :: [GreName]
</span><a href="#local-6989586621681884117"><span class="hs-identifier hs-var hs-var">new_gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AvailInfo -&gt; [GreName]) -&gt; [AvailInfo] -&gt; [GreName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">AvailInfo -&gt; [GreName]
</span><a href="GHC.Types.Avail.html#availGreNames"><span class="hs-identifier hs-var">availGreNames</span></a></span><span> </span><span class="annot"><span class="annottext">[AvailInfo]
</span><a href="#local-6989586621681884116"><span class="hs-identifier hs-var">avail</span></a></span><span>
</span><span id="line-430"></span><span>          </span><span id="local-6989586621681884119"><span class="annot"><span class="annottext">new_occs :: OccEnv OccName
</span><a href="#local-6989586621681884119"><span class="hs-identifier hs-var hs-var">new_occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccSet -&gt; OccEnv OccName
</span><a href="GHC.Types.Name.Occurrence.html#occSetToEnv"><span class="hs-identifier hs-var">occSetToEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[OccName] -&gt; OccSet
</span><a href="GHC.Types.Name.Occurrence.html#mkOccSet"><span class="hs-identifier hs-var">mkOccSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GreName -&gt; OccName) -&gt; [GreName] -&gt; [OccName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GreName -&gt; OccName
forall name. HasOccName name =&gt; name -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#occName"><span class="hs-identifier hs-var">occName</span></a></span><span> </span><span class="annot"><span class="annottext">[GreName]
</span><a href="#local-6989586621681884117"><span class="hs-identifier hs-var">new_gres</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>          </span><span id="local-6989586621681884113"><span class="annot"><span class="annottext">env1 :: GlobalRdrEnv
</span><a href="#local-6989586621681884113"><span class="hs-identifier hs-var hs-var">env1</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; OccEnv OccName -&gt; GlobalRdrEnv
forall a. GlobalRdrEnv -&gt; OccEnv a -&gt; GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#shadowNames"><span class="hs-identifier hs-var">shadowNames</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681884109"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">OccEnv OccName
</span><a href="#local-6989586621681884119"><span class="hs-identifier hs-var">new_occs</span></a></span><span>
</span><span id="line-432"></span><span>          </span><span id="local-6989586621681884116"><span class="annot"><span class="annottext">avail :: [AvailInfo]
</span><a href="#local-6989586621681884116"><span class="hs-identifier hs-var hs-var">avail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; [AvailInfo]
</span><a href="GHC.Types.TyThing.html#tyThingAvailInfo"><span class="hs-identifier hs-var">tyThingAvailInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681884108"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-comment">-- Ugh! The new_tythings may include record selectors, since they</span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-comment">-- are not implicit-ids, and must appear in the TypeEnv.  But they</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-comment">-- will also be brought into scope by the corresponding (ATyCon</span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-comment">-- tc).  And we want the latter, because that has the correct</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-comment">-- parent (#10520)</span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621681884110"><span class="annot"><span class="annottext">is_sub_bndr :: TyThing -&gt; Bool
</span><a href="#local-6989586621681884110"><span class="hs-identifier hs-var hs-var">is_sub_bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621681884123"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681884123"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681884123"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-440"></span><span>                             </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-441"></span><span>                             </span><span class="annot"><a href="GHC.Types.Id.Info.html#ClassOpId"><span class="hs-identifier hs-type">ClassOpId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-442"></span><span>                             </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="#local-6989586621681884110"><span class="hs-identifier hs-var">is_sub_bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="annot"><a href="GHC.Runtime.Context.html#substInteractiveContext"><span class="hs-identifier hs-type">substInteractiveContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span>
</span><span id="line-446"></span><span id="substInteractiveContext"><span class="annot"><span class="annottext">substInteractiveContext :: InteractiveContext -&gt; Subst -&gt; InteractiveContext
</span><a href="GHC.Runtime.Context.html#substInteractiveContext"><span class="hs-identifier hs-var hs-var">substInteractiveContext</span></a></span></span><span> </span><span id="local-6989586621681884127"><span class="annot"><span class="annottext">ictxt :: InteractiveContext
</span><a href="#local-6989586621681884127"><span class="hs-identifier hs-var">ictxt</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ic_tythings :: InteractiveContext -&gt; [TyThing]
</span><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681884128"><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681884128"><span class="hs-identifier hs-var">tts</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681884129"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621681884129"><span class="hs-identifier hs-var">subst</span></a></span></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621681884129"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884127"><span class="hs-identifier hs-var">ictxt</span></a></span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681884127"><span class="hs-identifier hs-var">ictxt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#ic_tythings"><span class="hs-identifier hs-var">ic_tythings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-type">map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884131"><span class="hs-identifier hs-type">subst_ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681884128"><span class="hs-identifier hs-type">tts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-450"></span><span>    </span><span id="local-6989586621681884131"><span class="annot"><span class="annottext">subst_ty :: TyThing -&gt; TyThing
</span><a href="#local-6989586621681884131"><span class="hs-identifier hs-var hs-var">subst_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621681884132"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681884132"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TyThing
</span><a href="GHC.Types.TyThing.html#AnId"><span class="hs-identifier hs-var">AnId</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; TyThing) -&gt; Id -&gt; TyThing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Id -&gt; Id
</span><a href="GHC.Types.Var.html#updateIdTypeAndMult"><span class="hs-identifier hs-var">updateIdTypeAndMult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621681884129"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681884132"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-comment">-- Variables in the interactive context *can* mention free type variables</span><span>
</span><span id="line-453"></span><span>      </span><span class="hs-comment">-- because of the runtime debugger. Otherwise you'd expect all</span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-comment">-- variables bound in the interactive context to be closed.</span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="#local-6989586621681884131"><span class="hs-identifier hs-var">subst_ty</span></a></span><span> </span><span id="local-6989586621681884135"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681884135"><span class="hs-identifier hs-var">tt</span></a></span></span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681884135"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Context.html#InteractiveImport"><span class="hs-identifier hs-type">InteractiveImport</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621681884171"><span class="annot"><span class="annottext">ppr :: InteractiveImport -&gt; SDoc
</span><a href="#local-6989586621681884171"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Context.html#IIModule"><span class="hs-identifier hs-type">IIModule</span></a></span><span> </span><span id="local-6989586621681884173"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681884173"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
forall doc. IsLine doc =&gt; Char -&gt; doc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681884173"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Context.html#IIDecl"><span class="hs-identifier hs-type">IIDecl</span></a></span><span> </span><span id="local-6989586621681884176"><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621681884176"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621681884176"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-461"></span></pre></body></html>