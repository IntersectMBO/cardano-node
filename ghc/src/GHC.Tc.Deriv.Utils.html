<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="annot"><span class="hs-comment">-- | Error-checking and other utilities for @deriving@ clauses or declarations.</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Deriv.Utils</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivM"><span class="hs-identifier">DerivM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivEnv"><span class="hs-identifier">DerivEnv</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier">DerivSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#pprDerivSpec"><span class="hs-identifier">pprDerivSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#setDerivSpecTheta"><span class="hs-identifier">setDerivSpecTheta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#zonkDerivSpec"><span class="hs-identifier">zonkDerivSpec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier">DerivSpecMechanism</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#derivSpecMechanismToStrategy"><span class="hs-identifier">derivSpecMechanismToStrategy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecStock"><span class="hs-identifier">isDerivSpecStock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecNewtype"><span class="hs-identifier">isDerivSpecNewtype</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecAnyClass"><span class="hs-identifier">isDerivSpecAnyClass</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecVia"><span class="hs-identifier">isDerivSpecVia</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#zonkDerivSpecMechanism"><span class="hs-identifier">zonkDerivSpecMechanism</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier">DerivContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#OriginativeDerivStatus"><span class="hs-identifier">OriginativeDerivStatus</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier">StockGenFns</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isStandaloneDeriv"><span class="hs-identifier">isStandaloneDeriv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isStandaloneWildcardDeriv"><span class="hs-identifier">isStandaloneWildcardDeriv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#askDerivUserTypeCtxt"><span class="hs-identifier">askDerivUserTypeCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#mkDerivOrigin"><span class="hs-identifier">mkDerivOrigin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#PredSpec"><span class="hs-identifier">PredSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ThetaSpec"><span class="hs-identifier">ThetaSpec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#mkDirectThetaSpec"><span class="hs-identifier">mkDirectThetaSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#substPredSpec"><span class="hs-identifier">substPredSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#captureThetaSpecConstraints"><span class="hs-identifier">captureThetaSpecConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#checkOriginativeSideConditions"><span class="hs-identifier">checkOriginativeSideConditions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#hasStockDeriving"><span class="hs-identifier">hasStockDeriving</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#std_class_via_coercible"><span class="hs-identifier">std_class_via_coercible</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#non_coercible_class"><span class="hs-identifier">non_coercible_class</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#newDerivClsInst"><span class="hs-identifier">newDerivClsInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#extendLocalInstEnv"><span class="hs-identifier">extendLocalInstEnv</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html"><span class="hs-identifier">GHC.Tc.Deriv.Generate</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Functor.html"><span class="hs-identifier">GHC.Tc.Deriv.Functor</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generics.html"><span class="hs-identifier">GHC.Tc.Deriv.Generics</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html"><span class="hs-identifier">GHC.Tc.Errors.Types</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier">WantedConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier">mkNonCanonical</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#tcSubTypeSigma"><span class="hs-identifier">tcSubTypeSigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier">getModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#mi_fix"><span class="hs-identifier">mi_fix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.Env.html"><span class="hs-identifier">GHC.Types.Fixity.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Fixity.Env.html#lookupFixity"><span class="hs-identifier">lookupFixity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Iface.Load.html#loadInterfaceForName"><span class="hs-identifier">loadInterfaceForName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html"><span class="hs-identifier">GHC.Builtin.Names.TH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Names.TH.html#liftClassKey"><span class="hs-identifier">liftClassKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Unique.html"><span class="hs-identifier">GHC.Utils.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier">sameUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#/Control.Monad.Trans.Reader.html"><span class="hs-identifier">Control.Monad.Trans.Reader</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Foldable.html#/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Foldable.html#traverse_/Data.Foldable.html#traverse_"><span class="hs-identifier">traverse_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.LanguageExtensions.html#/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier">assocMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | To avoid having to manually plumb everything in 'DerivEnv' throughout</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- various functions in &quot;GHC.Tc.Deriv&quot; and &quot;GHC.Tc.Deriv.Infer&quot;, we use 'DerivM', which</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- is a simple reader around 'TcRn'.</span><span>
</span><span id="line-80"></span><span class="hs-keyword">type</span><span> </span><span id="DerivM"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivM"><span class="hs-identifier hs-var">DerivM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivEnv"><span class="hs-identifier hs-type">DerivEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="annot"><span class="hs-comment">-- | Is GHC processing a standalone deriving declaration?</span></span><span>
</span><span id="line-83"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isStandaloneDeriv"><span class="hs-identifier hs-type">isStandaloneDeriv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivM"><span class="hs-identifier hs-type">DerivM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-84"></span><span id="isStandaloneDeriv"><span class="annot"><span class="annottext">isStandaloneDeriv :: DerivM Bool
</span><a href="GHC.Tc.Deriv.Utils.html#isStandaloneDeriv"><span class="hs-identifier hs-var hs-var">isStandaloneDeriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DerivEnv -&gt; Bool) -&gt; DerivM Bool
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivContext -&gt; Bool
</span><a href="#local-6989586621682055769"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivContext -&gt; Bool)
-&gt; (DerivEnv -&gt; DerivContext) -&gt; DerivEnv -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DerivEnv -&gt; DerivContext
</span><a href="GHC.Tc.Deriv.Utils.html#denv_ctxt"><span class="hs-identifier hs-var">denv_ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="#local-6989586621682055769"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621682055769"><span class="annot"><span class="annottext">go :: DerivContext -&gt; Bool
</span><a href="#local-6989586621682055769"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#InferContext"><span class="hs-identifier hs-type">InferContext</span></a></span><span> </span><span id="local-6989586621682055773"><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682055773"><span class="hs-identifier hs-var">wildcard</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682055773"><span class="hs-identifier hs-var">wildcard</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="#local-6989586621682055769"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SupplyContext"><span class="hs-identifier hs-type">SupplyContext</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Is GHC processing a standalone deriving declaration with an</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- extra-constraints wildcard as the context?</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- (e.g., @deriving instance _ =&gt; Eq (Foo a)@)</span><span>
</span><span id="line-93"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isStandaloneWildcardDeriv"><span class="hs-identifier hs-type">isStandaloneWildcardDeriv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivM"><span class="hs-identifier hs-type">DerivM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-94"></span><span id="isStandaloneWildcardDeriv"><span class="annot"><span class="annottext">isStandaloneWildcardDeriv :: DerivM Bool
</span><a href="GHC.Tc.Deriv.Utils.html#isStandaloneWildcardDeriv"><span class="hs-identifier hs-var hs-var">isStandaloneWildcardDeriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DerivEnv -&gt; Bool) -&gt; DerivM Bool
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivContext -&gt; Bool
</span><a href="#local-6989586621682055776"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivContext -&gt; Bool)
-&gt; (DerivEnv -&gt; DerivContext) -&gt; DerivEnv -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DerivEnv -&gt; DerivContext
</span><a href="GHC.Tc.Deriv.Utils.html#denv_ctxt"><span class="hs-identifier hs-var">denv_ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="#local-6989586621682055776"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621682055776"><span class="annot"><span class="annottext">go :: DerivContext -&gt; Bool
</span><a href="#local-6989586621682055776"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#InferContext"><span class="hs-identifier hs-type">InferContext</span></a></span><span> </span><span id="local-6989586621682055777"><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682055777"><span class="hs-identifier hs-var">wildcard</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682055777"><span class="hs-identifier hs-var">wildcard</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="#local-6989586621682055776"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SupplyContext"><span class="hs-identifier hs-type">SupplyContext</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Return 'InstDeclCtxt' if processing with a standalone @deriving@</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- declaration or 'DerivClauseCtxt' if processing a @deriving@ clause.</span><span>
</span><span id="line-102"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#askDerivUserTypeCtxt"><span class="hs-identifier hs-type">askDerivUserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivM"><span class="hs-identifier hs-type">DerivM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-103"></span><span id="askDerivUserTypeCtxt"><span class="annot"><span class="annottext">askDerivUserTypeCtxt :: DerivM UserTypeCtxt
</span><a href="GHC.Tc.Deriv.Utils.html#askDerivUserTypeCtxt"><span class="hs-identifier hs-var hs-var">askDerivUserTypeCtxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DerivEnv -&gt; UserTypeCtxt) -&gt; DerivM UserTypeCtxt
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivContext -&gt; UserTypeCtxt
</span><a href="#local-6989586621682055780"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivContext -&gt; UserTypeCtxt)
-&gt; (DerivEnv -&gt; DerivContext) -&gt; DerivEnv -&gt; UserTypeCtxt
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DerivEnv -&gt; DerivContext
</span><a href="GHC.Tc.Deriv.Utils.html#denv_ctxt"><span class="hs-identifier hs-var">denv_ctxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="#local-6989586621682055780"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621682055780"><span class="annot"><span class="annottext">go :: DerivContext -&gt; UserTypeCtxt
</span><a href="#local-6989586621682055780"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SupplyContext"><span class="hs-identifier hs-type">SupplyContext</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="#local-6989586621682055780"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#InferContext"><span class="hs-identifier hs-type">InferContext</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="#local-6989586621682055780"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#InferContext"><span class="hs-identifier hs-type">InferContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DerivClauseCtxt"><span class="hs-identifier hs-var">DerivClauseCtxt</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | @'mkDerivOrigin' wc@ returns 'StandAloneDerivOrigin' if @wc@ is 'True',</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- and 'DerivClauseOrigin' if @wc@ is 'False'. Useful for error-reporting.</span><span>
</span><span id="line-112"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#mkDerivOrigin"><span class="hs-identifier hs-type">mkDerivOrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-113"></span><span id="mkDerivOrigin"><span class="annot"><span class="annottext">mkDerivOrigin :: Bool -&gt; CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#mkDerivOrigin"><span class="hs-identifier hs-var hs-var">mkDerivOrigin</span></a></span></span><span> </span><span id="local-6989586621682055783"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682055783"><span class="hs-identifier hs-var">standalone_wildcard</span></a></span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682055783"><span class="hs-identifier hs-var">standalone_wildcard</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#StandAloneDerivOrigin"><span class="hs-identifier hs-var">StandAloneDerivOrigin</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#DerivClauseOrigin"><span class="hs-identifier hs-var">DerivClauseOrigin</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- | Contains all of the information known about a derived instance when</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- determining what its @EarlyDerivSpec@ should be.</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- See @Note [DerivEnv and DerivSpecMechanism]@.</span><span>
</span><span id="line-120"></span><span class="hs-keyword">data</span><span> </span><span id="DerivEnv"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivEnv"><span class="hs-identifier hs-var">DerivEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DerivEnv"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivEnv"><span class="hs-identifier hs-var">DerivEnv</span></a></span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="denv_overlap_mode"><span class="annot"><span class="annottext">DerivEnv -&gt; Maybe OverlapMode
</span><a href="GHC.Tc.Deriv.Utils.html#denv_overlap_mode"><span class="hs-identifier hs-var hs-var">denv_overlap_mode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#OverlapMode"><span class="hs-identifier hs-type">OverlapMode</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Is this an overlapping instance?</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="denv_tvs"><span class="annot"><span class="annottext">DerivEnv -&gt; [TyVar]
</span><a href="GHC.Tc.Deriv.Utils.html#denv_tvs"><span class="hs-identifier hs-var hs-var">denv_tvs</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-comment">-- ^ Universally quantified type variables in the instance. If the</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-comment">--   @denv_ctxt@ is 'InferContext', these will be 'TcTyVar' skolems.</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">--   If the @denv_ctxt@ is 'SupplyContext', these will be ordinary 'TyVar's.</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-comment">--   See @Note [Overlap and deriving]@ in &quot;GHC.Tc.Deriv.Infer&quot;.</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">--   All type variables that appear in the 'denv_inst_tys', 'denv_ctxt',</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-comment">--   'denv_skol_info', and 'denv_strat' should come from 'denv_tvs'.</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="denv_cls"><span class="annot"><span class="annottext">DerivEnv -&gt; Class
</span><a href="GHC.Tc.Deriv.Utils.html#denv_cls"><span class="hs-identifier hs-var hs-var">denv_cls</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Class for which we need to derive an instance</span></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="denv_inst_tys"><span class="annot"><span class="annottext">DerivEnv -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#denv_inst_tys"><span class="hs-identifier hs-var hs-var">denv_inst_tys</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ All arguments to 'denv_cls' in the derived instance.</span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="denv_ctxt"><span class="annot"><span class="annottext">DerivEnv -&gt; DerivContext
</span><a href="GHC.Tc.Deriv.Utils.html#denv_ctxt"><span class="hs-identifier hs-var hs-var">denv_ctxt</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- ^ @'SupplyContext' theta@ for standalone deriving (where @theta@ is the</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">--   context of the instance).</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">--   'InferContext' for @deriving@ clauses, or for standalone deriving that</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">--   uses a wildcard constraint.</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">--   See @Note [Inferring the instance context]@.</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="denv_skol_info"><span class="annot"><span class="annottext">DerivEnv -&gt; SkolemInfo
</span><a href="GHC.Tc.Deriv.Utils.html#denv_skol_info"><span class="hs-identifier hs-var hs-var">denv_skol_info</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- ^ The 'SkolemInfo' used to skolemise the @denv_tvs@ in the case where</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">--   the 'denv_ctxt' is 'InferContext'.</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="denv_strat"><span class="annot"><span class="annottext">DerivEnv -&gt; Maybe (DerivStrategy GhcTc)
</span><a href="GHC.Tc.Deriv.Utils.html#denv_strat"><span class="hs-identifier hs-var hs-var">denv_strat</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-comment">-- ^ 'Just' if user requests a particular deriving strategy.</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-comment">--   Otherwise, 'Nothing'.</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivEnv"><span class="hs-identifier hs-type">DerivEnv</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621682055846"><span class="annot"><span class="annottext">ppr :: DerivEnv -&gt; SDoc
</span><a href="#local-6989586621682055846"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivEnv"><span class="hs-identifier hs-type">DerivEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">denv_overlap_mode :: DerivEnv -&gt; Maybe OverlapMode
</span><a href="GHC.Tc.Deriv.Utils.html#denv_overlap_mode"><span class="hs-identifier hs-var">denv_overlap_mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055848"><span class="annot"><span class="annottext">Maybe OverlapMode
</span><a href="#local-6989586621682055848"><span class="hs-identifier hs-var">overlap_mode</span></a></span></span><span>
</span><span id="line-151"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">denv_tvs :: DerivEnv -&gt; [TyVar]
</span><a href="GHC.Tc.Deriv.Utils.html#denv_tvs"><span class="hs-identifier hs-var">denv_tvs</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055849"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682055849"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-152"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">denv_cls :: DerivEnv -&gt; Class
</span><a href="GHC.Tc.Deriv.Utils.html#denv_cls"><span class="hs-identifier hs-var">denv_cls</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055850"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682055850"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-153"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">denv_inst_tys :: DerivEnv -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#denv_inst_tys"><span class="hs-identifier hs-var">denv_inst_tys</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055851"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055851"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span>
</span><span id="line-154"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">denv_ctxt :: DerivEnv -&gt; DerivContext
</span><a href="GHC.Tc.Deriv.Utils.html#denv_ctxt"><span class="hs-identifier hs-var">denv_ctxt</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055852"><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682055852"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-155"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">denv_skol_info :: DerivEnv -&gt; SkolemInfo
</span><a href="GHC.Tc.Deriv.Utils.html#denv_skol_info"><span class="hs-identifier hs-var">denv_skol_info</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055853"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682055853"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span>
</span><span id="line-156"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">denv_strat :: DerivEnv -&gt; Maybe (DerivStrategy GhcTc)
</span><a href="GHC.Tc.Deriv.Utils.html#denv_strat"><span class="hs-identifier hs-var">denv_strat</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055854"><span class="annot"><span class="annottext">Maybe (DerivStrategy GhcTc)
</span><a href="#local-6989586621682055854"><span class="hs-identifier hs-var">mb_strat</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DerivEnv&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;denv_overlap_mode&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OverlapMode -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OverlapMode
</span><a href="#local-6989586621682055848"><span class="hs-identifier hs-var">overlap_mode</span></a></span><span>
</span><span id="line-159"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;denv_tvs&quot;</span></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682055849"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-160"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;denv_cls&quot;</span></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682055850"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-161"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;denv_inst_tys&quot;</span></span><span>     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055851"><span class="hs-identifier hs-var">inst_tys</span></a></span><span>
</span><span id="line-162"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;denv_ctxt&quot;</span></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DerivContext -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682055852"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-163"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;denv_skol_info&quot;</span></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682055853"><span class="hs-identifier hs-var">skol_info</span></a></span><span>
</span><span id="line-164"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;denv_strat&quot;</span></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DerivStrategy GhcTc) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DerivStrategy GhcTc)
</span><a href="#local-6989586621682055854"><span class="hs-identifier hs-var">mb_strat</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-keyword">data</span><span> </span><span id="DerivSpec"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-var">DerivSpec</span></a></span></span><span> </span><span id="local-6989586621682055441"><span class="annot"><a href="#local-6989586621682055441"><span class="hs-identifier hs-type">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DS"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DS"><span class="hs-identifier hs-var">DS</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="ds_loc"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; SrcSpan
</span><a href="GHC.Tc.Deriv.Utils.html#ds_loc"><span class="hs-identifier hs-var hs-var">ds_loc</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-167"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_name"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; Name
</span><a href="GHC.Tc.Deriv.Utils.html#ds_name"><span class="hs-identifier hs-var hs-var">ds_name</span></a></span></span><span>                </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>         </span><span class="hs-comment">-- DFun name</span><span>
</span><span id="line-168"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_tvs"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; [TyVar]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tvs"><span class="hs-identifier hs-var hs-var">ds_tvs</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-169"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_theta"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; theta
</span><a href="GHC.Tc.Deriv.Utils.html#ds_theta"><span class="hs-identifier hs-var hs-var">ds_theta</span></a></span></span><span>               </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682055441"><span class="hs-identifier hs-type">theta</span></a></span><span>
</span><span id="line-170"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_cls"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; Class
</span><a href="GHC.Tc.Deriv.Utils.html#ds_cls"><span class="hs-identifier hs-var hs-var">ds_cls</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>
</span><span id="line-171"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_tys"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tys"><span class="hs-identifier hs-var hs-var">ds_tys</span></a></span></span><span>                 </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_skol_info"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; SkolemInfo
</span><a href="GHC.Tc.Deriv.Utils.html#ds_skol_info"><span class="hs-identifier hs-var hs-var">ds_skol_info</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a></span><span>
</span><span id="line-173"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_user_ctxt"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Deriv.Utils.html#ds_user_ctxt"><span class="hs-identifier hs-var hs-var">ds_user_ctxt</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span>
</span><span id="line-174"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_overlap"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; Maybe OverlapMode
</span><a href="GHC.Tc.Deriv.Utils.html#ds_overlap"><span class="hs-identifier hs-var hs-var">ds_overlap</span></a></span></span><span>             </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#OverlapMode"><span class="hs-identifier hs-type">OverlapMode</span></a></span><span>
</span><span id="line-175"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_standalone_wildcard"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; Maybe SrcSpan
</span><a href="GHC.Tc.Deriv.Utils.html#ds_standalone_wildcard"><span class="hs-identifier hs-var hs-var">ds_standalone_wildcard</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-176"></span><span>                              </span><span class="hs-comment">-- See Note [Inferring the instance context]</span><span>
</span><span id="line-177"></span><span>                              </span><span class="hs-comment">-- in GHC.Tc.Deriv.Infer</span><span>
</span><span id="line-178"></span><span>                          </span><span class="hs-special">,</span><span> </span><span id="ds_mechanism"><span class="annot"><span class="annottext">forall theta. DerivSpec theta -&gt; DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#ds_mechanism"><span class="hs-identifier hs-var hs-var">ds_mechanism</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-comment">-- This spec implies a dfun declaration of the form</span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-comment">--       df :: forall tvs. theta =&gt; C tys</span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-comment">-- The Name is the name for the DFun we'll build</span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-comment">-- The tyvars bind all the variables in the rest of the DerivSpec.</span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-comment">-- If we are inferring an instance context, the tyvars will be TcTyVar</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- skolems. After the instance context inference is over, the tyvars</span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-comment">-- will be zonked to TyVars. See</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-comment">-- Note [Overlap and deriving] in GHC.Tc.Deriv.Infer.</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-comment">-- the theta is either the given and final theta, in standalone deriving,</span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-comment">-- or the not-yet-simplified list of constraints together with their origin</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-comment">-- The ds_skol_info is the SkolemInfo that was used to skolemise the</span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-comment">-- TcTyVars (if we are inferring an instance context). The ds_user_ctxt</span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-comment">-- is the UserTypeCtxt that allows error messages to know if we are in</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-comment">-- a deriving clause or a standalone deriving declaration.</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-comment">-- ds_mechanism specifies the means by which GHC derives the instance.</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-comment">-- See Note [Deriving strategies] in GHC.Tc.Deriv</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">{-
Example:

     newtype instance T [a] = MkT (Tree a) deriving( C s )
==&gt;
     axiom T [a] = :RTList a
     axiom :RTList a = Tree a

     DS { ds_tvs = [a,s], ds_cls = C, ds_tys = [s, T [a]]
        , ds_mechanism = DerivSpecNewtype (Tree a) }
-}</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621682055455"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#pprDerivSpec"><span class="hs-identifier hs-type">pprDerivSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055455"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055455"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-212"></span><span id="pprDerivSpec"><span class="annot"><span class="annottext">pprDerivSpec :: forall theta. Outputable theta =&gt; DerivSpec theta -&gt; SDoc
</span><a href="GHC.Tc.Deriv.Utils.html#pprDerivSpec"><span class="hs-identifier hs-var hs-var">pprDerivSpec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DS"><span class="hs-identifier hs-type">DS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ds_loc :: forall theta. DerivSpec theta -&gt; SrcSpan
</span><a href="GHC.Tc.Deriv.Utils.html#ds_loc"><span class="hs-identifier hs-var">ds_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055905"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682055905"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_name :: forall theta. DerivSpec theta -&gt; Name
</span><a href="GHC.Tc.Deriv.Utils.html#ds_name"><span class="hs-identifier hs-var">ds_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055906"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682055906"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_tvs :: forall theta. DerivSpec theta -&gt; [TyVar]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tvs"><span class="hs-identifier hs-var">ds_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055907"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682055907"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_cls :: forall theta. DerivSpec theta -&gt; Class
</span><a href="GHC.Tc.Deriv.Utils.html#ds_cls"><span class="hs-identifier hs-var">ds_cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055908"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682055908"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>                   </span><span class="annot"><span class="annottext">ds_tys :: forall theta. DerivSpec theta -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tys"><span class="hs-identifier hs-var">ds_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055909"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055909"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_theta :: forall theta. DerivSpec theta -&gt; theta
</span><a href="GHC.Tc.Deriv.Utils.html#ds_theta"><span class="hs-identifier hs-var">ds_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055910"><span class="annot"><span class="annottext">theta
</span><a href="#local-6989586621682055910"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_skol_info :: forall theta. DerivSpec theta -&gt; SkolemInfo
</span><a href="GHC.Tc.Deriv.Utils.html#ds_skol_info"><span class="hs-identifier hs-var">ds_skol_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055911"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682055911"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>                   </span><span class="annot"><span class="annottext">ds_standalone_wildcard :: forall theta. DerivSpec theta -&gt; Maybe SrcSpan
</span><a href="GHC.Tc.Deriv.Utils.html#ds_standalone_wildcard"><span class="hs-identifier hs-var">ds_standalone_wildcard</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055912"><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682055912"><span class="hs-identifier hs-var">wildcard</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_mechanism :: forall theta. DerivSpec theta -&gt; DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#ds_mechanism"><span class="hs-identifier hs-var">ds_mechanism</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055913"><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="#local-6989586621682055913"><span class="hs-identifier hs-var">mech</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DerivSpec&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_loc                  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682055905"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-217"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_name                 =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682055906"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-218"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_tvs                  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682055907"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-219"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_cls                  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682055908"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-220"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_tys                  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055909"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-221"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_theta                =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">theta -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">theta
</span><a href="#local-6989586621682055910"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-222"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_skol_info            =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682055911"><span class="hs-identifier hs-var">skol_info</span></a></span><span>
</span><span id="line-223"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_standalone_wildcard  =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682055912"><span class="hs-identifier hs-var">wildcard</span></a></span><span>
</span><span id="line-224"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds_mechanism            =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="#local-6989586621682055913"><span class="hs-identifier hs-var">mech</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682055458"><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055458"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055458"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621682055918"><span class="annot"><span class="annottext">ppr :: DerivSpec theta -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivSpec theta -&gt; SDoc
forall theta. Outputable theta =&gt; DerivSpec theta -&gt; SDoc
</span><a href="GHC.Tc.Deriv.Utils.html#pprDerivSpec"><span class="hs-identifier hs-var">pprDerivSpec</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><span class="hs-comment">-- | Set the 'ds_theta' in a 'DerivSpec'.</span></span><span>
</span><span id="line-230"></span><span id="local-6989586621682055459"><span id="local-6989586621682055460"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#setDerivSpecTheta"><span class="hs-identifier hs-type">setDerivSpecTheta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682055459"><span class="hs-identifier hs-type">theta'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055460"><span class="hs-identifier hs-type">theta</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055459"><span class="hs-identifier hs-type">theta'</span></a></span></span></span><span>
</span><span id="line-231"></span><span id="setDerivSpecTheta"><span class="annot"><span class="annottext">setDerivSpecTheta :: forall theta' theta. theta' -&gt; DerivSpec theta -&gt; DerivSpec theta'
</span><a href="GHC.Tc.Deriv.Utils.html#setDerivSpecTheta"><span class="hs-identifier hs-var hs-var">setDerivSpecTheta</span></a></span></span><span> </span><span id="local-6989586621682055919"><span class="annot"><span class="annottext">theta'
</span><a href="#local-6989586621682055919"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682055920"><span class="annot"><span class="annottext">DerivSpec theta
</span><a href="#local-6989586621682055920"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivSpec theta
</span><a href="#local-6989586621682055920"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">{</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ds_theta"><span class="hs-identifier hs-var">ds_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682055919"><span class="hs-identifier hs-type">theta</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-comment">-- | Zonk the 'TcTyVar's in a 'DerivSpec' to 'TyVar's.</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- See @Note [What is zonking?]@ in &quot;GHC.Tc.Utils.TcMType&quot;.</span><span>
</span><span id="line-235"></span><span class="hs-comment">--</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- This is only used in the final zonking step when inferring</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- the context for a derived instance.</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- See @Note [Overlap and deriving]@ in &quot;GHC.Tc.Deriv.Infer&quot;.</span><span>
</span><span id="line-239"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#zonkDerivSpec"><span class="hs-identifier hs-type">zonkDerivSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span id="zonkDerivSpec"><span class="annot"><span class="annottext">zonkDerivSpec :: DerivSpec [Type] -&gt; TcM (DerivSpec [Type])
</span><a href="GHC.Tc.Deriv.Utils.html#zonkDerivSpec"><span class="hs-identifier hs-var hs-var">zonkDerivSpec</span></a></span></span><span> </span><span id="local-6989586621682055922"><span class="annot"><span class="annottext">ds :: DerivSpec [Type]
</span><a href="#local-6989586621682055922"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DS"><span class="hs-identifier hs-type">DS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ds_tvs :: forall theta. DerivSpec theta -&gt; [TyVar]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tvs"><span class="hs-identifier hs-var">ds_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055923"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682055923"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_theta :: forall theta. DerivSpec theta -&gt; theta
</span><a href="GHC.Tc.Deriv.Utils.html#ds_theta"><span class="hs-identifier hs-var">ds_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055924"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055924"><span class="hs-identifier hs-var">theta</span></a></span></span><span>
</span><span id="line-241"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_tys :: forall theta. DerivSpec theta -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tys"><span class="hs-identifier hs-var">ds_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055925"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055925"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_mechanism :: forall theta. DerivSpec theta -&gt; DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#ds_mechanism"><span class="hs-identifier hs-var">ds_mechanism</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055926"><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="#local-6989586621682055926"><span class="hs-identifier hs-var">mechanism</span></a></span></span><span>
</span><span id="line-242"></span><span>                     </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682055927"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055927"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682055928"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682055928"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TcM (ZonkEnv, [TyVar])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyBndrs"><span class="hs-identifier hs-var">zonkTyBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682055923"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span id="local-6989586621682055930"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055930"><span class="hs-identifier hs-var">theta'</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055927"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055924"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621682055932"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055932"><span class="hs-identifier hs-var">tys'</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055927"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055925"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621682055933"><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="#local-6989586621682055933"><span class="hs-identifier hs-var">mechanism'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; DerivSpecMechanism -&gt; TcM DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#zonkDerivSpecMechanism"><span class="hs-identifier hs-var">zonkDerivSpecMechanism</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055927"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="#local-6989586621682055926"><span class="hs-identifier hs-var">mechanism</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="annottext">DerivSpec [Type] -&gt; TcM (DerivSpec [Type])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpec [Type]
</span><a href="#local-6989586621682055922"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ds_tvs"><span class="hs-identifier hs-var">ds_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682055928"><span class="hs-identifier hs-type">tvs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ds_theta"><span class="hs-identifier hs-var">ds_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682055930"><span class="hs-identifier hs-type">theta'</span></a></span><span>
</span><span id="line-248"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ds_tys"><span class="hs-identifier hs-var">ds_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682055932"><span class="hs-identifier hs-type">tys'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ds_mechanism"><span class="hs-identifier hs-var">ds_mechanism</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682055933"><span class="hs-identifier hs-type">mechanism'</span></a></span><span>
</span><span id="line-249"></span><span>         </span><span class="hs-special">}</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-comment">-- | What action to take in order to derive a class instance.</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- See @Note [DerivEnv and DerivSpecMechanism]@, as well as</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- @Note [Deriving strategies]@ in &quot;GHC.Tc.Deriv&quot;.</span><span>
</span><span id="line-254"></span><span class="hs-keyword">data</span><span> </span><span id="DerivSpecMechanism"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier hs-var">DerivSpecMechanism</span></a></span></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="hs-comment">-- | \&quot;Standard\&quot; classes</span></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DerivSpecStock"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecStock"><span class="hs-identifier hs-var">DerivSpecStock</span></a></span></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="dsm_stock_dit"><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_stock_dit"><span class="hs-identifier hs-var hs-var">dsm_stock_dit</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-comment">-- ^ Information about the arguments to the class in the derived</span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-comment">-- instance, including what type constructor the last argument is</span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-comment">-- headed by. See @Note [DerivEnv and DerivSpecMechanism]@.</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="dsm_stock_gen_fns"><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; StockGenFns
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_stock_gen_fns"><span class="hs-identifier hs-var hs-var">dsm_stock_gen_fns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier hs-type">StockGenFns</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="hs-comment">-- ^ How to generate the instance bindings and associated type family</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-comment">-- instances.</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><span class="hs-comment">-- | @GeneralizedNewtypeDeriving@</span></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DerivSpecNewtype"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecNewtype"><span class="hs-identifier hs-var">DerivSpecNewtype</span></a></span></span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="dsm_newtype_dit"><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_dit"><span class="hs-identifier hs-var hs-var">dsm_newtype_dit</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span>
</span><span id="line-269"></span><span>      </span><span class="hs-comment">-- ^ Information about the arguments to the class in the derived</span><span>
</span><span id="line-270"></span><span>      </span><span class="hs-comment">-- instance, including what type constructor the last argument is</span><span>
</span><span id="line-271"></span><span>      </span><span class="hs-comment">-- headed by. See @Note [DerivEnv and DerivSpecMechanism]@.</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="dsm_newtype_rep_ty"><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_rep_ty"><span class="hs-identifier hs-var hs-var">dsm_newtype_rep_ty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The newtype rep type.</span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="hs-comment">-- | @DeriveAnyClass@</span></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DerivSpecAnyClass"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a></span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><span class="hs-comment">-- | @DerivingVia@</span></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="DerivSpecVia"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecVia"><span class="hs-identifier hs-var">DerivSpecVia</span></a></span></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="dsm_via_cls_tys"><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_cls_tys"><span class="hs-identifier hs-var hs-var">dsm_via_cls_tys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ All arguments to the class besides the last one.</span></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="dsm_via_inst_ty"><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_inst_ty"><span class="hs-identifier hs-var hs-var">dsm_via_inst_ty</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The last argument to the class.</span></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="dsm_via_ty"><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_ty"><span class="hs-identifier hs-var hs-var">dsm_via_ty</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><span class="hs-comment">-- ^ The @via@ type</span></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><span class="hs-comment">-- | Convert a 'DerivSpecMechanism' to its corresponding 'DerivStrategy'.</span></span><span>
</span><span id="line-290"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#derivSpecMechanismToStrategy"><span class="hs-identifier hs-type">derivSpecMechanismToStrategy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#DerivStrategy"><span class="hs-identifier hs-type">DerivStrategy</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-291"></span><span id="derivSpecMechanismToStrategy"><span class="annot"><span class="annottext">derivSpecMechanismToStrategy :: DerivSpecMechanism -&gt; DerivStrategy GhcTc
</span><a href="GHC.Tc.Deriv.Utils.html#derivSpecMechanismToStrategy"><span class="hs-identifier hs-var hs-var">derivSpecMechanismToStrategy</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecStock"><span class="hs-identifier hs-type">DerivSpecStock</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XStockStrategy GhcTc -&gt; DerivStrategy GhcTc
forall pass. XStockStrategy pass -&gt; DerivStrategy pass
</span><a href="Language.Haskell.Syntax.Decls.html#StockStrategy"><span class="hs-identifier hs-var">StockStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">XStockStrategy GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-292"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#derivSpecMechanismToStrategy"><span class="hs-identifier hs-var">derivSpecMechanismToStrategy</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecNewtype"><span class="hs-identifier hs-type">DerivSpecNewtype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XNewtypeStrategy GhcTc -&gt; DerivStrategy GhcTc
forall pass. XNewtypeStrategy pass -&gt; DerivStrategy pass
</span><a href="Language.Haskell.Syntax.Decls.html#NewtypeStrategy"><span class="hs-identifier hs-var">NewtypeStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">XNewtypeStrategy GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-293"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#derivSpecMechanismToStrategy"><span class="hs-identifier hs-var">derivSpecMechanismToStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XAnyClassStrategy GhcTc -&gt; DerivStrategy GhcTc
forall pass. XAnyClassStrategy pass -&gt; DerivStrategy pass
</span><a href="Language.Haskell.Syntax.Decls.html#AnyclassStrategy"><span class="hs-identifier hs-var">AnyclassStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">XAnyClassStrategy GhcTc
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-294"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#derivSpecMechanismToStrategy"><span class="hs-identifier hs-var">derivSpecMechanismToStrategy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecVia"><span class="hs-identifier hs-type">DerivSpecVia</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dsm_via_ty :: DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_ty"><span class="hs-identifier hs-var">dsm_via_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055949"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055949"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XViaStrategy GhcTc -&gt; DerivStrategy GhcTc
forall pass. XViaStrategy pass -&gt; DerivStrategy pass
</span><a href="Language.Haskell.Syntax.Decls.html#ViaStrategy"><span class="hs-identifier hs-var">ViaStrategy</span></a></span><span> </span><span class="annot"><span class="annottext">XViaStrategy GhcTc
Type
</span><a href="#local-6989586621682055949"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecStock"><span class="hs-identifier hs-type">isDerivSpecStock</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecNewtype"><span class="hs-identifier hs-type">isDerivSpecNewtype</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecAnyClass"><span class="hs-identifier hs-type">isDerivSpecAnyClass</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecVia"><span class="hs-identifier hs-type">isDerivSpecVia</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-298"></span><span id="isDerivSpecStock"><span class="annot"><span class="annottext">isDerivSpecStock :: DerivSpecMechanism -&gt; Bool
</span><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecStock"><span class="hs-identifier hs-var hs-var">isDerivSpecStock</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecStock"><span class="hs-identifier hs-type">DerivSpecStock</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-299"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecStock"><span class="hs-identifier hs-var">isDerivSpecStock</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="isDerivSpecNewtype"><span class="annot"><span class="annottext">isDerivSpecNewtype :: DerivSpecMechanism -&gt; Bool
</span><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecNewtype"><span class="hs-identifier hs-var hs-var">isDerivSpecNewtype</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecNewtype"><span class="hs-identifier hs-type">DerivSpecNewtype</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-302"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecNewtype"><span class="hs-identifier hs-var">isDerivSpecNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="isDerivSpecAnyClass"><span class="annot"><span class="annottext">isDerivSpecAnyClass :: DerivSpecMechanism -&gt; Bool
</span><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecAnyClass"><span class="hs-identifier hs-var hs-var">isDerivSpecAnyClass</span></a></span></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-305"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecAnyClass"><span class="hs-identifier hs-var">isDerivSpecAnyClass</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span id="isDerivSpecVia"><span class="annot"><span class="annottext">isDerivSpecVia :: DerivSpecMechanism -&gt; Bool
</span><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecVia"><span class="hs-identifier hs-var hs-var">isDerivSpecVia</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecVia"><span class="hs-identifier hs-type">DerivSpecVia</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-308"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#isDerivSpecVia"><span class="hs-identifier hs-var">isDerivSpecVia</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">-- | Zonk the 'TcTyVar's in a 'DerivSpecMechanism' to 'TyVar's.</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- See @Note [What is zonking?]@ in &quot;GHC.Tc.Utils.TcMType&quot;.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- This is only used in the final zonking step when inferring</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- the context for a derived instance.</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- See @Note [Overlap and deriving]@ in &quot;GHC.Tc.Deriv.Infer&quot;.</span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#zonkDerivSpecMechanism"><span class="hs-identifier hs-type">zonkDerivSpecMechanism</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a></span><span>
</span><span id="line-317"></span><span id="zonkDerivSpecMechanism"><span class="annot"><span class="annottext">zonkDerivSpecMechanism :: ZonkEnv -&gt; DerivSpecMechanism -&gt; TcM DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#zonkDerivSpecMechanism"><span class="hs-identifier hs-var hs-var">zonkDerivSpecMechanism</span></a></span></span><span> </span><span id="local-6989586621682055951"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055951"><span class="hs-identifier hs-var">ze</span></a></span></span><span> </span><span id="local-6989586621682055952"><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="#local-6989586621682055952"><span class="hs-identifier hs-var">mechanism</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="#local-6989586621682055952"><span class="hs-identifier hs-var">mechanism</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecStock"><span class="hs-identifier hs-type">DerivSpecStock</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_stock_dit :: DerivSpecMechanism -&gt; DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_stock_dit"><span class="hs-identifier hs-var">dsm_stock_dit</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055953"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055953"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-320"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_stock_gen_fns :: DerivSpecMechanism -&gt; StockGenFns
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_stock_gen_fns"><span class="hs-identifier hs-var">dsm_stock_gen_fns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055954"><span class="annot"><span class="annottext">StockGenFns
</span><a href="#local-6989586621682055954"><span class="hs-identifier hs-var">gen_fns</span></a></span></span><span>
</span><span id="line-321"></span><span>                   </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-322"></span><span>      </span><span id="local-6989586621682055955"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055955"><span class="hs-identifier hs-var">dit'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; DerivInstTys -&gt; TcM DerivInstTys
</span><a href="GHC.Tc.Deriv.Generate.html#zonkDerivInstTys"><span class="hs-identifier hs-var">zonkDerivInstTys</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055951"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055953"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; TcM DerivSpecMechanism
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivSpecMechanism -&gt; TcM DerivSpecMechanism)
-&gt; DerivSpecMechanism -&gt; TcM DerivSpecMechanism
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecStock"><span class="hs-identifier hs-type">DerivSpecStock</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_stock_dit :: DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_stock_dit"><span class="hs-identifier hs-var">dsm_stock_dit</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055955"><span class="hs-identifier hs-var">dit'</span></a></span><span>
</span><span id="line-324"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_stock_gen_fns :: StockGenFns
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_stock_gen_fns"><span class="hs-identifier hs-var">dsm_stock_gen_fns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StockGenFns
</span><a href="#local-6989586621682055954"><span class="hs-identifier hs-var">gen_fns</span></a></span><span>
</span><span id="line-325"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecNewtype"><span class="hs-identifier hs-type">DerivSpecNewtype</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_newtype_dit :: DerivSpecMechanism -&gt; DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_dit"><span class="hs-identifier hs-var">dsm_newtype_dit</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055957"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055957"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-327"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_newtype_rep_ty :: DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_rep_ty"><span class="hs-identifier hs-var">dsm_newtype_rep_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055958"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055958"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span>
</span><span id="line-328"></span><span>                     </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>      </span><span id="local-6989586621682055959"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055959"><span class="hs-identifier hs-var">dit'</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; DerivInstTys -&gt; TcM DerivInstTys
</span><a href="GHC.Tc.Deriv.Generate.html#zonkDerivInstTys"><span class="hs-identifier hs-var">zonkDerivInstTys</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055951"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055957"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-330"></span><span>      </span><span id="local-6989586621682055960"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055960"><span class="hs-identifier hs-var">rep_ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055951"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055958"><span class="hs-identifier hs-var">rep_ty</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; TcM DerivSpecMechanism
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivSpecMechanism -&gt; TcM DerivSpecMechanism)
-&gt; DerivSpecMechanism -&gt; TcM DerivSpecMechanism
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecNewtype"><span class="hs-identifier hs-type">DerivSpecNewtype</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_newtype_dit :: DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_dit"><span class="hs-identifier hs-var">dsm_newtype_dit</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055959"><span class="hs-identifier hs-var">dit'</span></a></span><span>
</span><span id="line-332"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_newtype_rep_ty :: Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_rep_ty"><span class="hs-identifier hs-var">dsm_newtype_rep_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055960"><span class="hs-identifier hs-var">rep_ty'</span></a></span><span>
</span><span id="line-333"></span><span>                              </span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; TcM DerivSpecMechanism
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecVia"><span class="hs-identifier hs-type">DerivSpecVia</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_via_cls_tys :: DerivSpecMechanism -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_cls_tys"><span class="hs-identifier hs-var">dsm_via_cls_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055962"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055962"><span class="hs-identifier hs-var">cls_tys</span></a></span></span><span>
</span><span id="line-337"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_via_inst_ty :: DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_inst_ty"><span class="hs-identifier hs-var">dsm_via_inst_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055963"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055963"><span class="hs-identifier hs-var">inst_ty</span></a></span></span><span>
</span><span id="line-338"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_via_ty :: DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_ty"><span class="hs-identifier hs-var">dsm_via_ty</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055964"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055964"><span class="hs-identifier hs-var">via_ty</span></a></span></span><span>
</span><span id="line-339"></span><span>                 </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-340"></span><span>      </span><span id="local-6989586621682055965"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055965"><span class="hs-identifier hs-var">cls_tys'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055951"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055962"><span class="hs-identifier hs-var">cls_tys</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span id="local-6989586621682055966"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055966"><span class="hs-identifier hs-var">inst_ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055951"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055963"><span class="hs-identifier hs-var">inst_ty</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span id="local-6989586621682055967"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055967"><span class="hs-identifier hs-var">via_ty'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621682055951"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055964"><span class="hs-identifier hs-var">via_ty</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span class="annot"><span class="annottext">DerivSpecMechanism -&gt; TcM DerivSpecMechanism
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivSpecMechanism -&gt; TcM DerivSpecMechanism)
-&gt; DerivSpecMechanism -&gt; TcM DerivSpecMechanism
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecVia"><span class="hs-identifier hs-type">DerivSpecVia</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_via_cls_tys :: [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_cls_tys"><span class="hs-identifier hs-var">dsm_via_cls_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055965"><span class="hs-identifier hs-var">cls_tys'</span></a></span><span>
</span><span id="line-344"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_via_inst_ty :: Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_inst_ty"><span class="hs-identifier hs-var">dsm_via_inst_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055966"><span class="hs-identifier hs-var">inst_ty'</span></a></span><span>
</span><span id="line-345"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_via_ty :: Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_ty"><span class="hs-identifier hs-var">dsm_via_ty</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055967"><span class="hs-identifier hs-var">via_ty'</span></a></span><span>
</span><span id="line-346"></span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecMechanism"><span class="hs-identifier hs-type">DerivSpecMechanism</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>  </span><span id="local-6989586621682055995"><span class="annot"><span class="annottext">ppr :: DerivSpecMechanism -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecStock"><span class="hs-identifier hs-type">DerivSpecStock</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dsm_stock_dit :: DerivSpecMechanism -&gt; DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_stock_dit"><span class="hs-identifier hs-var">dsm_stock_dit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055996"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055996"><span class="hs-identifier hs-var">dit</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DerivSpecStock&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsm_stock_dit&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055996"><span class="hs-identifier hs-var">dit</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecNewtype"><span class="hs-identifier hs-type">DerivSpecNewtype</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_newtype_dit :: DerivSpecMechanism -&gt; DerivInstTys
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_dit"><span class="hs-identifier hs-var">dsm_newtype_dit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055997"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055997"><span class="hs-identifier hs-var">dit</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_newtype_rep_ty :: DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_newtype_rep_ty"><span class="hs-identifier hs-var">dsm_newtype_rep_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055998"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055998"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DerivSpecNewtype&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsm_newtype_dit&quot;</span></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682055997"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-355"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsm_newtype_rep_ty&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682055998"><span class="hs-identifier hs-var">rep_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSpecMechanism
</span><a href="GHC.Tc.Deriv.Utils.html#DerivSpecAnyClass"><span class="hs-identifier hs-var">DerivSpecAnyClass</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DerivSpecAnyClass&quot;</span></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpecVia"><span class="hs-identifier hs-type">DerivSpecVia</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsm_via_cls_tys :: DerivSpecMechanism -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_cls_tys"><span class="hs-identifier hs-var">dsm_via_cls_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682055999"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055999"><span class="hs-identifier hs-var">cls_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_via_inst_ty :: DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_inst_ty"><span class="hs-identifier hs-var">dsm_via_inst_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056000"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056000"><span class="hs-identifier hs-var">inst_ty</span></a></span></span><span>
</span><span id="line-358"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsm_via_ty :: DerivSpecMechanism -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#dsm_via_ty"><span class="hs-identifier hs-var">dsm_via_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056001"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056001"><span class="hs-identifier hs-var">via_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DerivSpecVia&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>         </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsm_via_cls_tys&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682055999"><span class="hs-identifier hs-var">cls_tys</span></a></span><span>
</span><span id="line-361"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsm_via_inst_ty&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056000"><span class="hs-identifier hs-var">inst_ty</span></a></span><span>
</span><span id="line-362"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsm_via_ty&quot;</span></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056001"><span class="hs-identifier hs-var">via_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="hs-comment">{-
Note [DerivEnv and DerivSpecMechanism]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
DerivEnv contains all of the bits and pieces that are common to every
deriving strategy. (See Note [Deriving strategies] in GHC.Tc.Deriv.) Some deriving
strategies impose stricter requirements on the types involved in the derived
instance than others, and these differences are factored out into the
DerivSpecMechanism type. Suppose that the derived instance looks like this:

  instance ... =&gt; C arg_1 ... arg_n

Each deriving strategy imposes restrictions on arg_1 through arg_n as follows:

* stock (DerivSpecStock):

  Stock deriving requires that:

  - n must be a positive number. This is checked by
    GHC.Tc.Deriv.expectNonNullaryClsArgs
  - arg_n must be an application of an algebraic type constructor. Here,
    &quot;algebraic type constructor&quot; means:

    + An ordinary data type constructor, or
    + A data family type constructor such that the arguments it is applied to
      give rise to a data family instance.

    This is checked by GHC.Tc.Deriv.expectAlgTyConApp.

  This extra structure is witnessed by the DerivInstTys data type, which stores
  arg_1 through arg_(n-1) (dit_cls_tys), the algebraic type constructor
  (dit_tc), and its arguments (dit_tc_args). A DerivInstTys value can be seen
  as a more structured representation of the denv_inst_tys field of DerivEnv.

  If dit_tc is an ordinary data type constructor, then
  dit_rep_tc/dit_rep_tc_args are the same as dit_tc/dit_tc_args. If dit_tc is a
  data family type constructor, then dit_rep_tc is the representation type
  constructor for the data family instance, and dit_rep_tc_args are the
  arguments to the representation type constructor in the corresponding
  instance.

* newtype (DerivSpecNewtype):

  Newtype deriving imposes the same DerivInstTys requirements as stock
  deriving. This is necessary because we need to know what the underlying type
  that the newtype wraps is, and this information can only be learned by
  knowing dit_rep_tc.

* anyclass (DerivSpecAnyclass):

  DeriveAnyClass is the most permissive deriving strategy of all, as it
  essentially imposes no requirements on the derived instance. This is because
  DeriveAnyClass simply derives an empty instance, so it does not need any
  particular knowledge about the types involved. It can do several things
  that stock/newtype deriving cannot do (#13154):

  - n can be 0. That is, one is allowed to anyclass-derive an instance with
    no arguments to the class, such as in this example:

      class C
      deriving anyclass instance C

  - One can derive an instance for a type that is not headed by a type
    constructor, such as in the following example:

      class C (n :: Nat)
      deriving instance C 0
      deriving instance C 1
      ...

  - One can derive an instance for a data family with no data family instances,
    such as in the following example:

      data family Foo a
      class C a
      deriving anyclass instance C (Foo a)

* via (DerivSpecVia):

  Like newtype deriving, DerivingVia requires that n must be a positive number.
  This is because when one derives something like this:

    deriving via Foo instance C Bar

  Then the generated code must specifically mention Bar. However, in
  contrast with newtype deriving, DerivingVia does *not* require Bar to be
  an application of an algebraic type constructor. This is because the
  generated code simply defers to invoking `coerce`, which does not need to
  know anything in particular about Bar (besides that it is representationally
  equal to Foo). This allows DerivingVia to do some things that are not
  possible with newtype deriving, such as deriving instances for data families
  without data instances (#13154):

    data family Foo a
    newtype ByBar a = ByBar a
    class Baz a where ...
    instance Baz (ByBar a) where ...
    deriving via ByBar (Foo a) instance Baz (Foo a)
-}</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-comment">-- | Whether GHC is processing a @deriving@ clause or a standalone deriving</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- declaration.</span><span>
</span><span id="line-465"></span><span class="hs-keyword">data</span><span> </span><span id="DerivContext"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-var">DerivContext</span></a></span></span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InferContext"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#InferContext"><span class="hs-identifier hs-var">InferContext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ @'InferContext mb_wildcard@ is either:</span><span>
</span><span id="line-467"></span><span>                                 </span><span class="hs-comment">--</span><span>
</span><span id="line-468"></span><span>                                 </span><span class="hs-comment">-- * A @deriving@ clause (in which case</span><span>
</span><span id="line-469"></span><span>                                 </span><span class="hs-comment">--   @mb_wildcard@ is 'Nothing').</span><span>
</span><span id="line-470"></span><span>                                 </span><span class="hs-comment">--</span><span>
</span><span id="line-471"></span><span>                                 </span><span class="hs-comment">-- * A standalone deriving declaration with</span><span>
</span><span id="line-472"></span><span>                                 </span><span class="hs-comment">--   an extra-constraints wildcard as the</span><span>
</span><span id="line-473"></span><span>                                 </span><span class="hs-comment">--   context (in which case @mb_wildcard@ is</span><span>
</span><span id="line-474"></span><span>                                 </span><span class="hs-comment">--   @'Just' loc@, where @loc@ is the location</span><span>
</span><span id="line-475"></span><span>                                 </span><span class="hs-comment">--   of the wildcard.</span><span>
</span><span id="line-476"></span><span>                                 </span><span class="hs-comment">--</span><span>
</span><span id="line-477"></span><span>                                 </span><span class="hs-comment">-- GHC should infer the context.</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="SupplyContext"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SupplyContext"><span class="hs-identifier hs-var">SupplyContext</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span>      </span><span class="hs-comment">-- ^ @'SupplyContext' theta@ is a standalone</span><span>
</span><span id="line-480"></span><span>                                 </span><span class="hs-comment">-- deriving declaration, where @theta@ is the</span><span>
</span><span id="line-481"></span><span>                                 </span><span class="hs-comment">-- context supplied by the user.</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-484"></span><span>  </span><span id="local-6989586621682056011"><span class="annot"><span class="annottext">ppr :: DerivContext -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#InferContext"><span class="hs-identifier hs-type">InferContext</span></a></span><span> </span><span id="local-6989586621682056012"><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682056012"><span class="hs-identifier hs-var">standalone</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InferContext&quot;</span></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682056012"><span class="hs-identifier hs-var">standalone</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SupplyContext"><span class="hs-identifier hs-type">SupplyContext</span></a></span><span> </span><span id="local-6989586621682056013"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056013"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SupplyContext&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056013"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">-- | Records whether a particular class can be derived by way of an</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- /originative/ deriving strategy (i.e., @stock@ or @anyclass@).</span><span>
</span><span id="line-489"></span><span class="hs-comment">--</span><span>
</span><span id="line-490"></span><span class="hs-comment">-- See @Note [Deriving strategies]@ in &quot;GHC.Tc.Deriv&quot;.</span><span>
</span><span id="line-491"></span><span class="hs-keyword">data</span><span> </span><span id="OriginativeDerivStatus"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#OriginativeDerivStatus"><span class="hs-identifier hs-var">OriginativeDerivStatus</span></a></span></span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CanDeriveStock"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#CanDeriveStock"><span class="hs-identifier hs-var">CanDeriveStock</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier hs-type">StockGenFns</span></a></span><span> </span><span class="hs-comment">-- Stock class, can derive</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="StockClassError"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockClassError"><span class="hs-identifier hs-var">StockClassError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceErrReason"><span class="hs-identifier hs-type">DeriveInstanceErrReason</span></a></span><span> </span><span class="hs-comment">-- Stock class, but can't do it</span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CanDeriveAnyClass"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#CanDeriveAnyClass"><span class="hs-identifier hs-var">CanDeriveAnyClass</span></a></span></span><span>         </span><span class="hs-comment">-- See Note [Deriving any class]</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NonDerivableClass"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#NonDerivableClass"><span class="hs-identifier hs-var">NonDerivableClass</span></a></span></span><span> </span><span class="hs-comment">-- Cannot derive with either stock or anyclass</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-comment">-- | Describes how to generate instance bindings ('stock_gen_binds') and</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- associated type family instances ('stock_gen_fam_insts') for a particular</span><span>
</span><span id="line-499"></span><span class="hs-comment">-- stock-derived instance.</span><span>
</span><span id="line-500"></span><span class="hs-keyword">data</span><span> </span><span id="StockGenFns"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier hs-var">StockGenFns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StockGenFns"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier hs-var">StockGenFns</span></a></span></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="stock_gen_binds"><span class="annot"><span class="annottext">StockGenFns
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM (LHsBinds GhcPs, [LSig GhcPs], Bag AuxBindSpec, [Name])
</span><a href="GHC.Tc.Deriv.Utils.html#stock_gen_binds"><span class="hs-identifier hs-var hs-var">stock_gen_binds</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-502"></span><span>         </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span>
</span><span id="line-503"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Binds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#AuxBindSpec"><span class="hs-identifier hs-type">AuxBindSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-comment">-- ^ Describes how to generate instance bindings for a stock-derived</span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-comment">-- instance.</span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-comment">-- This function takes two arguments:</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-comment">-- 1. 'SrcSpan': the source location where the instance is being derived.</span><span>
</span><span id="line-510"></span><span>    </span><span class="hs-comment">--    This will eventually be instantiated with the 'ds_loc' field of a</span><span>
</span><span id="line-511"></span><span>    </span><span class="hs-comment">--    'DerivSpec'.</span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-comment">-- 2. 'DerivInstTys': information about the argument types to which a</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-comment">--    class is applied in a derived instance. This will eventually be</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-comment">--    instantiated with the 'dsm_stock_dit' field of a</span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-comment">--    'DerivSpecMechanism'.</span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-comment">-- This function returns four things:</span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-comment">-- 1. @'LHsBinds' 'GhcPs'@: The derived instance's function bindings</span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-comment">--    (e.g., @compare (T x) (T y) = compare x y@)</span><span>
</span><span id="line-522"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-comment">-- 2. @['LSig' 'GhcPs']@: A list of instance specific signatures/pragmas.</span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-comment">--    Most likely @INLINE@ pragmas for class methods.</span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-comment">-- 3. @'Bag' 'AuxBindSpec'@: Auxiliary bindings needed to support the</span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-comment">--    derived instance. As examples, derived 'Eq' and 'Ord' instances</span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-comment">--    sometimes require top-level @con2tag@ functions.</span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-comment">--    See @Note [Auxiliary binders]@ in &quot;GHC.Tc.Deriv.Generate&quot;.</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-comment">-- 4. @['Name']@: A list of Names for which @-Wunused-binds@ should be</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-comment">--    suppressed. This is used to suppress unused warnings for record</span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-comment">--    selectors when deriving 'Read', 'Show', or 'Generic'.</span><span>
</span><span id="line-534"></span><span>    </span><span class="hs-comment">--    See @Note [Deriving and unused record selectors]@.</span><span>
</span><span id="line-535"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stock_gen_fam_insts"><span class="annot"><span class="annottext">StockGenFns -&gt; SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
</span><a href="GHC.Tc.Deriv.Utils.html#stock_gen_fam_insts"><span class="hs-identifier hs-var hs-var">stock_gen_fam_insts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-536"></span><span>         </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-comment">-- ^ Describes how to generate associated type family instances for a</span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-comment">-- stock-derived instance. This function takes the same arguments as the</span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-comment">-- 'stock_gen_binds' function but returns a list of 'FamInst's instead.</span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-comment">-- Generating type family instances is done separately from</span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-comment">-- 'stock_gen_binds' since the type family instances must be generated</span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-comment">-- before the instance bindings can be typechecked. See</span><span>
</span><span id="line-544"></span><span>    </span><span class="hs-comment">-- @Note [Staging of tcDeriving]@ in &quot;GHC.Tc.Deriv&quot;.</span><span>
</span><span id="line-545"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="hs-comment">-- A stock class is one either defined in the Haskell report or for which GHC</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- otherwise knows how to generate code for (possibly requiring the use of a</span><span>
</span><span id="line-549"></span><span class="hs-comment">-- language extension), such as Eq, Ord, Ix, Data, Generic, etc.)</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="hs-comment">-- | A 'PredSpec' specifies a constraint to emitted when inferring the</span><span>
</span><span id="line-552"></span><span class="hs-comment">-- instance context for a derived instance in 'GHC.Tc.Deriv.simplifyInfer'.</span><span>
</span><span id="line-553"></span><span class="hs-keyword">data</span><span> </span><span id="PredSpec"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#PredSpec"><span class="hs-identifier hs-var">PredSpec</span></a></span></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | An ordinary 'PredSpec' that directly stores a 'PredType', which</span><span>
</span><span id="line-555"></span><span>    </span><span class="hs-comment">-- will be emitted as a wanted constraint in the constraint solving</span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-comment">-- machinery. This is the simple case, as there are no skolems,</span><span>
</span><span id="line-557"></span><span>    </span><span class="hs-comment">-- metavariables, or given constraints involved.</span><span>
</span><span id="line-558"></span><span>    </span><span id="SimplePredSpec"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SimplePredSpec"><span class="hs-identifier hs-var">SimplePredSpec</span></a></span></span><span>
</span><span id="line-559"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="sps_pred"><span class="annot"><span class="annottext">PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#sps_pred"><span class="hs-identifier hs-var hs-var">sps_pred</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span>
</span><span id="line-560"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The constraint to emit as a wanted</span></span><span>
</span><span id="line-561"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="sps_origin"><span class="annot"><span class="annottext">PredSpec -&gt; CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#sps_origin"><span class="hs-identifier hs-var hs-var">sps_origin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-562"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The origin of the constraint</span></span><span>
</span><span id="line-563"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="sps_type_or_kind"><span class="annot"><span class="annottext">PredSpec -&gt; TypeOrKind
</span><a href="GHC.Tc.Deriv.Utils.html#sps_type_or_kind"><span class="hs-identifier hs-var hs-var">sps_type_or_kind</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span>
</span><span id="line-564"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Whether the constraint is a type or kind</span></span><span>
</span><span id="line-565"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- | A special 'PredSpec' that is only used by @DeriveAnyClass@. This</span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-comment">-- will check if @stps_ty_actual@ is a subtype of (i.e., more polymorphic</span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-comment">-- than) @stps_ty_expected@ in the constraint solving machinery, emitting an</span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-comment">-- implication constraint as a side effect. For more details on how this</span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-comment">-- works, see @Note [Gathering and simplifying constraints for DeriveAnyClass]@</span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-comment">-- in &quot;GHC.Tc.Deriv.Infer&quot;.</span><span>
</span><span id="line-572"></span><span>    </span><span id="SubTypePredSpec"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SubTypePredSpec"><span class="hs-identifier hs-var">SubTypePredSpec</span></a></span></span><span>
</span><span id="line-573"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="stps_ty_actual"><span class="annot"><span class="annottext">PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_actual"><span class="hs-identifier hs-var hs-var">stps_ty_actual</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-comment">-- ^ The actual type. In the context of @DeriveAnyClass@, this is the</span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-comment">-- default method type signature.</span><span>
</span><span id="line-576"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="stps_ty_expected"><span class="annot"><span class="annottext">PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_expected"><span class="hs-identifier hs-var hs-var">stps_ty_expected</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-comment">-- ^ The expected type. In the context of @DeriveAnyClass@, this is the</span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-comment">-- original method type signature.</span><span>
</span><span id="line-579"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="stps_origin"><span class="annot"><span class="annottext">PredSpec -&gt; CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#stps_origin"><span class="hs-identifier hs-var hs-var">stps_origin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ The origin of the constraint</span></span><span>
</span><span id="line-581"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span class="hs-comment">-- | A list of 'PredSpec' constraints to simplify when inferring a</span><span>
</span><span id="line-584"></span><span class="hs-comment">-- derived instance's context. For the @stock@, @newtype@, and @via@ deriving</span><span>
</span><span id="line-585"></span><span class="hs-comment">-- strategies, these will consist of 'SimplePredSpec's, and for</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- @DeriveAnyClass@, these will consist of 'SubTypePredSpec's. Here is an</span><span>
</span><span id="line-587"></span><span class="hs-comment">-- example to illustrate the latter:</span><span>
</span><span id="line-588"></span><span class="hs-comment">--</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-590"></span><span class="hs-comment">-- class Foo a where</span><span>
</span><span id="line-591"></span><span class="hs-comment">--   bar :: forall b. Ix b =&gt; a -&gt; b -&gt; String</span><span>
</span><span id="line-592"></span><span class="hs-comment">--   default bar :: forall y. (Show a, Ix y) =&gt; a -&gt; y -&gt; String</span><span>
</span><span id="line-593"></span><span class="hs-comment">--   bar x y = show x ++ show (range (y, y))</span><span>
</span><span id="line-594"></span><span class="hs-comment">--</span><span>
</span><span id="line-595"></span><span class="hs-comment">--   baz :: Eq a =&gt; a -&gt; a -&gt; Bool</span><span>
</span><span id="line-596"></span><span class="hs-comment">--   default baz :: Ord a =&gt; a -&gt; a -&gt; Bool</span><span>
</span><span id="line-597"></span><span class="hs-comment">--   baz x y = compare x y == EQ</span><span>
</span><span id="line-598"></span><span class="hs-comment">--</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- data Quux q = Quux deriving anyclass Foo</span><span>
</span><span id="line-600"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-601"></span><span class="hs-comment">--</span><span>
</span><span id="line-602"></span><span class="hs-comment">-- Then it would generate two 'SubTypePredSpec's, one for each method:</span><span>
</span><span id="line-603"></span><span class="hs-comment">--</span><span>
</span><span id="line-604"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-605"></span><span class="hs-comment">-- [ SubTypePredSpec</span><span>
</span><span id="line-606"></span><span class="hs-comment">--     { stps_ty_actual   = forall y. (Show (Quux q), Ix y) =&gt; Quux q -&gt; y -&gt; String</span><span>
</span><span id="line-607"></span><span class="hs-comment">--     , stps_ty_expected = forall b.                (Ix b) =&gt; Quux q -&gt; b -&gt; String</span><span>
</span><span id="line-608"></span><span class="hs-comment">--     , stps_ty_origin   = DerivClauseCtxt</span><span>
</span><span id="line-609"></span><span class="hs-comment">--     }</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- , SubTypePredSpec</span><span>
</span><span id="line-611"></span><span class="hs-comment">--     { stps_ty_actual   = Ord (Quux q) =&gt; Quux q -&gt; Quux q -&gt; Bool</span><span>
</span><span id="line-612"></span><span class="hs-comment">--     , stps_ty_expected = Eq  (Quux q) =&gt; Quux q -&gt; Quux q -&gt; Bool</span><span>
</span><span id="line-613"></span><span class="hs-comment">--     , stps_ty_origin   = DerivClauseCtxt</span><span>
</span><span id="line-614"></span><span class="hs-comment">--     }</span><span>
</span><span id="line-615"></span><span class="hs-comment">-- ]</span><span>
</span><span id="line-616"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-617"></span><span class="hs-comment">--</span><span>
</span><span id="line-618"></span><span class="hs-comment">-- (Note that the type variable @q@ is bound by the data type @Quux@, and thus</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- appears free in the 'stps_ty_actual's and 'stps_ty_expected's.)</span><span>
</span><span id="line-620"></span><span class="hs-comment">--</span><span>
</span><span id="line-621"></span><span class="hs-comment">-- See @Note [Gathering and simplifying constraints for DeriveAnyClass]@</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- in &quot;GHC.Tc.Deriv.Infer&quot; for an explanation of how these 'SubTypePredSpec's</span><span>
</span><span id="line-623"></span><span class="hs-comment">-- are used to compute implication constraints.</span><span>
</span><span id="line-624"></span><span class="hs-keyword">type</span><span> </span><span id="ThetaSpec"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ThetaSpec"><span class="hs-identifier hs-var">ThetaSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#PredSpec"><span class="hs-identifier hs-type">PredSpec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#PredSpec"><span class="hs-identifier hs-type">PredSpec</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-627"></span><span>  </span><span id="local-6989586621682056050"><span class="annot"><span class="annottext">ppr :: PredSpec -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SimplePredSpec"><span class="hs-identifier hs-type">SimplePredSpec</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sps_pred :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#sps_pred"><span class="hs-identifier hs-var">sps_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056051"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056051"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-628"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SimplePredSpec&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sps_pred&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056051"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SubTypePredSpec"><span class="hs-identifier hs-type">SubTypePredSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stps_ty_actual :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_actual"><span class="hs-identifier hs-var">stps_ty_actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056052"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056052"><span class="hs-identifier hs-var">ty_actual</span></a></span></span><span>
</span><span id="line-631"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stps_ty_expected :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_expected"><span class="hs-identifier hs-var">stps_ty_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056053"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056053"><span class="hs-identifier hs-var">ty_expected</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-632"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SubTypePredSpec&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;stps_ty_actual&quot;</span></span><span>   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056052"><span class="hs-identifier hs-var">ty_actual</span></a></span><span>
</span><span id="line-634"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;stps_ty_expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056053"><span class="hs-identifier hs-var">ty_expected</span></a></span><span>
</span><span id="line-635"></span><span>               </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span class="hs-comment">-- | Build a list of 'SimplePredSpec's, using the supplied 'CtOrigin' and</span><span>
</span><span id="line-638"></span><span class="hs-comment">-- 'TypeOrKind' values for each 'PredType'.</span><span>
</span><span id="line-639"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#mkDirectThetaSpec"><span class="hs-identifier hs-type">mkDirectThetaSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ThetaSpec"><span class="hs-identifier hs-type">ThetaSpec</span></a></span><span>
</span><span id="line-640"></span><span id="mkDirectThetaSpec"><span class="annot"><span class="annottext">mkDirectThetaSpec :: CtOrigin -&gt; TypeOrKind -&gt; [Type] -&gt; ThetaSpec
</span><a href="GHC.Tc.Deriv.Utils.html#mkDirectThetaSpec"><span class="hs-identifier hs-var hs-var">mkDirectThetaSpec</span></a></span></span><span> </span><span id="local-6989586621682056054"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056054"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621682056055"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621682056055"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-641"></span><span>  </span><span class="annot"><span class="annottext">(Type -&gt; PredSpec) -&gt; [Type] -&gt; ThetaSpec
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682056056"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056056"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SimplePredSpec"><span class="hs-identifier hs-type">SimplePredSpec</span></a></span><span>
</span><span id="line-642"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sps_pred :: Type
</span><a href="GHC.Tc.Deriv.Utils.html#sps_pred"><span class="hs-identifier hs-var">sps_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056056"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-643"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_origin :: CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#sps_origin"><span class="hs-identifier hs-var">sps_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056054"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-644"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_type_or_kind :: TypeOrKind
</span><a href="GHC.Tc.Deriv.Utils.html#sps_type_or_kind"><span class="hs-identifier hs-var">sps_type_or_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621682056055"><span class="hs-identifier hs-var">t_or_k</span></a></span><span>
</span><span id="line-645"></span><span>               </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#substPredSpec"><span class="hs-identifier hs-type">substPredSpec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Stack.Types.html#HasCallStack/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#PredSpec"><span class="hs-identifier hs-type">PredSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#PredSpec"><span class="hs-identifier hs-type">PredSpec</span></a></span><span>
</span><span id="line-648"></span><span id="substPredSpec"><span class="annot"><span class="annottext">substPredSpec :: HasCallStack =&gt; Subst -&gt; PredSpec -&gt; PredSpec
</span><a href="GHC.Tc.Deriv.Utils.html#substPredSpec"><span class="hs-identifier hs-var hs-var">substPredSpec</span></a></span></span><span> </span><span id="local-6989586621682056061"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682056061"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682056062"><span class="annot"><span class="annottext">PredSpec
</span><a href="#local-6989586621682056062"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PredSpec
</span><a href="#local-6989586621682056062"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SimplePredSpec"><span class="hs-identifier hs-type">SimplePredSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sps_pred :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#sps_pred"><span class="hs-identifier hs-var">sps_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056063"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056063"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-651"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_origin :: PredSpec -&gt; CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#sps_origin"><span class="hs-identifier hs-var">sps_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056064"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056064"><span class="hs-identifier hs-var">origin</span></a></span></span><span>
</span><span id="line-652"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_type_or_kind :: PredSpec -&gt; TypeOrKind
</span><a href="GHC.Tc.Deriv.Utils.html#sps_type_or_kind"><span class="hs-identifier hs-var">sps_type_or_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056065"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621682056065"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span>
</span><span id="line-653"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SimplePredSpec"><span class="hs-identifier hs-type">SimplePredSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sps_pred :: Type
</span><a href="GHC.Tc.Deriv.Utils.html#sps_pred"><span class="hs-identifier hs-var">sps_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682056061"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056063"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-655"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_origin :: CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#sps_origin"><span class="hs-identifier hs-var">sps_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056064"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-656"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_type_or_kind :: TypeOrKind
</span><a href="GHC.Tc.Deriv.Utils.html#sps_type_or_kind"><span class="hs-identifier hs-var">sps_type_or_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621682056065"><span class="hs-identifier hs-var">t_or_k</span></a></span><span>
</span><span id="line-657"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span>    </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SubTypePredSpec"><span class="hs-identifier hs-type">SubTypePredSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stps_ty_actual :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_actual"><span class="hs-identifier hs-var">stps_ty_actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056067"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056067"><span class="hs-identifier hs-var">ty_actual</span></a></span></span><span>
</span><span id="line-660"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stps_ty_expected :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_expected"><span class="hs-identifier hs-var">stps_ty_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056068"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056068"><span class="hs-identifier hs-var">ty_expected</span></a></span></span><span>
</span><span id="line-661"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stps_origin :: PredSpec -&gt; CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#stps_origin"><span class="hs-identifier hs-var">stps_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056069"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056069"><span class="hs-identifier hs-var">origin</span></a></span></span><span>
</span><span id="line-662"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-663"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SubTypePredSpec"><span class="hs-identifier hs-type">SubTypePredSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stps_ty_actual :: Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_actual"><span class="hs-identifier hs-var">stps_ty_actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682056061"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056067"><span class="hs-identifier hs-var">ty_actual</span></a></span><span>
</span><span id="line-664"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stps_ty_expected :: Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_expected"><span class="hs-identifier hs-var">stps_ty_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682056061"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056068"><span class="hs-identifier hs-var">ty_expected</span></a></span><span>
</span><span id="line-665"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stps_origin :: CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#stps_origin"><span class="hs-identifier hs-var">stps_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056069"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-666"></span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="annot"><span class="hs-comment">-- | Capture wanted constraints from a 'ThetaSpec'.</span></span><span>
</span><span id="line-669"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#captureThetaSpecConstraints"><span class="hs-identifier hs-type">captureThetaSpecConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-670"></span><span>     </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-comment">-- ^ Used to inform error messages as to whether</span><span>
</span><span id="line-671"></span><span>                  </span><span class="hs-comment">-- we are in a @deriving@ clause or a standalone</span><span>
</span><span id="line-672"></span><span>                  </span><span class="hs-comment">-- @deriving@ declaration</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ThetaSpec"><span class="hs-identifier hs-type">ThetaSpec</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ The specs from which constraints will be created</span></span><span>
</span><span id="line-674"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span id="captureThetaSpecConstraints"><span class="annot"><span class="annottext">captureThetaSpecConstraints :: UserTypeCtxt -&gt; ThetaSpec -&gt; TcM (TcLevel, WantedConstraints)
</span><a href="GHC.Tc.Deriv.Utils.html#captureThetaSpecConstraints"><span class="hs-identifier hs-var hs-var">captureThetaSpecConstraints</span></a></span></span><span> </span><span id="local-6989586621682056070"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621682056070"><span class="hs-identifier hs-var">user_ctxt</span></a></span></span><span> </span><span id="local-6989586621682056071"><span class="annot"><span class="annottext">ThetaSpec
</span><a href="#local-6989586621682056071"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><span class="annottext">TcM WantedConstraints -&gt; TcM (TcLevel, WantedConstraints)
forall a. TcM a -&gt; TcM (TcLevel, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-var">pushTcLevelM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM WantedConstraints -&gt; TcM (TcLevel, WantedConstraints))
-&gt; TcM WantedConstraints -&gt; TcM (TcLevel, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaSpec -&gt; TcM WantedConstraints
</span><a href="#local-6989586621682056073"><span class="hs-identifier hs-var">mk_wanteds</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaSpec
</span><a href="#local-6989586621682056071"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-678"></span><span>    </span><span class="hs-comment">-- Create the constraints we need to solve. For stock and newtype</span><span>
</span><span id="line-679"></span><span>    </span><span class="hs-comment">-- deriving, these constraints will be simple wanted constraints</span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-comment">-- like (C a, Ord b).</span><span>
</span><span id="line-681"></span><span>    </span><span class="hs-comment">-- But with DeriveAnyClass, we make an implication constraint.</span><span>
</span><span id="line-682"></span><span>    </span><span class="hs-comment">-- See Note [Gathering and simplifying constraints for DeriveAnyClass]</span><span>
</span><span id="line-683"></span><span>    </span><span class="hs-comment">-- in GHC.Tc.Deriv.Infer.</span><span>
</span><span id="line-684"></span><span>    </span><span class="annot"><a href="#local-6989586621682056073"><span class="hs-identifier hs-type">mk_wanteds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#ThetaSpec"><span class="hs-identifier hs-type">ThetaSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span>
</span><span id="line-685"></span><span>    </span><span id="local-6989586621682056073"><span class="annot"><span class="annottext">mk_wanteds :: ThetaSpec -&gt; TcM WantedConstraints
</span><a href="#local-6989586621682056073"><span class="hs-identifier hs-var hs-var">mk_wanteds</span></a></span></span><span> </span><span id="local-6989586621682056074"><span class="annot"><span class="annottext">ThetaSpec
</span><a href="#local-6989586621682056074"><span class="hs-identifier hs-var">preds</span></a></span></span><span>
</span><span id="line-686"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056075"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682056075"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcM ((), WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ((), WantedConstraints))
-&gt; TcM () -&gt; TcM ((), WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-687"></span><span>                             </span><span class="annot"><span class="annottext">(PredSpec -&gt; TcM ()) -&gt; ThetaSpec -&gt; TcM ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#traverse_/Data.Foldable.html#traverse_"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="annot"><span class="annottext">PredSpec -&gt; TcM ()
</span><a href="#local-6989586621682056077"><span class="hs-identifier hs-var">emit_constraints</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaSpec
</span><a href="#local-6989586621682056074"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-688"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM WantedConstraints
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621682056075"><span class="hs-identifier hs-var">wanteds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span>    </span><span class="hs-comment">-- Emit the appropriate constraints depending on what sort of</span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-comment">-- PredSpec we are dealing with.</span><span>
</span><span id="line-692"></span><span>    </span><span class="annot"><a href="#local-6989586621682056077"><span class="hs-identifier hs-type">emit_constraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#PredSpec"><span class="hs-identifier hs-type">PredSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>    </span><span id="local-6989586621682056077"><span class="annot"><span class="annottext">emit_constraints :: PredSpec -&gt; TcM ()
</span><a href="#local-6989586621682056077"><span class="hs-identifier hs-var hs-var">emit_constraints</span></a></span></span><span> </span><span id="local-6989586621682056078"><span class="annot"><span class="annottext">PredSpec
</span><a href="#local-6989586621682056078"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-694"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PredSpec
</span><a href="#local-6989586621682056078"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-695"></span><span>        </span><span class="hs-comment">-- For constraints like (C a, Ord b), emit the</span><span>
</span><span id="line-696"></span><span>        </span><span class="hs-comment">-- constraints directly as simple wanted constraints.</span><span>
</span><span id="line-697"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SimplePredSpec"><span class="hs-identifier hs-type">SimplePredSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sps_pred :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#sps_pred"><span class="hs-identifier hs-var">sps_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056079"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056079"><span class="hs-identifier hs-var">wanted</span></a></span></span><span>
</span><span id="line-698"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_origin :: PredSpec -&gt; CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#sps_origin"><span class="hs-identifier hs-var">sps_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056080"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056080"><span class="hs-identifier hs-var">orig</span></a></span></span><span>
</span><span id="line-699"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sps_type_or_kind :: PredSpec -&gt; TypeOrKind
</span><a href="GHC.Tc.Deriv.Utils.html#sps_type_or_kind"><span class="hs-identifier hs-var">sps_type_or_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056081"><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621682056081"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span>
</span><span id="line-700"></span><span>                       </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-701"></span><span>          </span><span id="local-6989586621682056082"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682056082"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; Type -&gt; TcM CtEvidence
</span><a href="GHC.Tc.Utils.TcMType.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056080"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeOrKind -&gt; Maybe TypeOrKind
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrKind
</span><a href="#local-6989586621682056081"><span class="hs-identifier hs-var">t_or_k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056079"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-702"></span><span>          </span><span class="annot"><span class="annottext">Ct -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-var">emitSimple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682056082"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span>        </span><span class="hs-comment">-- For DeriveAnyClass, check if ty_actual is a subtype of</span><span>
</span><span id="line-705"></span><span>        </span><span class="hs-comment">-- ty_expected, which emits an implication constraint as a</span><span>
</span><span id="line-706"></span><span>        </span><span class="hs-comment">-- side effect. See</span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-comment">-- Note [Gathering and simplifying constraints for DeriveAnyClass].</span><span>
</span><span id="line-708"></span><span>        </span><span class="hs-comment">-- in GHC.Tc.Deriv.Infer.</span><span>
</span><span id="line-709"></span><span>        </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SubTypePredSpec"><span class="hs-identifier hs-type">SubTypePredSpec</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stps_ty_actual :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_actual"><span class="hs-identifier hs-var">stps_ty_actual</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056085"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056085"><span class="hs-identifier hs-var">ty_actual</span></a></span></span><span>
</span><span id="line-710"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stps_ty_expected :: PredSpec -&gt; Type
</span><a href="GHC.Tc.Deriv.Utils.html#stps_ty_expected"><span class="hs-identifier hs-var">stps_ty_expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056086"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056086"><span class="hs-identifier hs-var">ty_expected</span></a></span></span><span>
</span><span id="line-711"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stps_origin :: PredSpec -&gt; CtOrigin
</span><a href="GHC.Tc.Deriv.Utils.html#stps_origin"><span class="hs-identifier hs-var">stps_origin</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056087"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056087"><span class="hs-identifier hs-var">orig</span></a></span></span><span>
</span><span id="line-712"></span><span>                        </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-713"></span><span>          </span><span class="annot"><span class="annottext">HsWrapper
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; Type -&gt; Type -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypeSigma"><span class="hs-identifier hs-var">tcSubTypeSigma</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682056087"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621682056070"><span class="hs-identifier hs-var">user_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056085"><span class="hs-identifier hs-var">ty_actual</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056086"><span class="hs-identifier hs-var">ty_expected</span></a></span><span>
</span><span id="line-714"></span><span>          </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Class deriving diagnostics
*                                                                      *
************************************************************************

Only certain blessed classes can be used in a deriving clause (without the
assistance of GeneralizedNewtypeDeriving or DeriveAnyClass). These classes
are listed below in the definition of hasStockDeriving. The stockSideConditions
function determines the criteria that needs to be met in order for a particular
stock class to be able to be derived successfully.

A class might be able to be used in a deriving clause if -XDeriveAnyClass
is willing to support it.
-}</span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#hasStockDeriving"><span class="hs-identifier hs-type">hasStockDeriving</span></a></span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier hs-type">StockGenFns</span></a></span><span>
</span><span id="line-735"></span><span id="hasStockDeriving"><span class="annot"><span class="annottext">hasStockDeriving :: Class -&gt; Maybe StockGenFns
</span><a href="GHC.Tc.Deriv.Utils.html#hasStockDeriving"><span class="hs-identifier hs-var hs-var">hasStockDeriving</span></a></span></span><span> </span><span id="local-6989586621682056088"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056088"><span class="hs-identifier hs-var">clas</span></a></span></span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Assoc Unique StockGenFns -&gt; Unique -&gt; Maybe StockGenFns
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Assoc Unique StockGenFns
</span><a href="#local-6989586621682056089"><span class="hs-identifier hs-var">gen_list</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056088"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-738"></span><span>    </span><span class="annot"><a href="#local-6989586621682056089"><span class="hs-identifier hs-type">gen_list</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier hs-type">StockGenFns</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-739"></span><span>    </span><span id="local-6989586621682056089"><span class="annot"><span class="annottext">gen_list :: Assoc Unique StockGenFns
</span><a href="#local-6989586621682056089"><span class="hs-identifier hs-var hs-var">gen_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-740"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a></span><span class="hs-special">,</span><span>          </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; m (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056093"><span class="hs-identifier hs-var">simple_bindsM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Eq_binds"><span class="hs-identifier hs-var">gen_Eq_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a></span><span class="hs-special">,</span><span>         </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; m (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056093"><span class="hs-identifier hs-var">simple_bindsM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Ord_binds"><span class="hs-identifier hs-var">gen_Ord_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#enumClassKey"><span class="hs-identifier hs-var">enumClassKey</span></a></span><span class="hs-special">,</span><span>        </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; m (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056093"><span class="hs-identifier hs-var">simple_bindsM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Enum_binds"><span class="hs-identifier hs-var">gen_Enum_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#boundedClassKey"><span class="hs-identifier hs-var">boundedClassKey</span></a></span><span class="hs-special">,</span><span>     </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
     Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056101"><span class="hs-identifier hs-var">simple_binds</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
    Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Bounded_binds"><span class="hs-identifier hs-var">gen_Bounded_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#ixClassKey"><span class="hs-identifier hs-var">ixClassKey</span></a></span><span class="hs-special">,</span><span>          </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; m (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056093"><span class="hs-identifier hs-var">simple_bindsM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Ix_binds"><span class="hs-identifier hs-var">gen_Ix_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a></span><span class="hs-special">,</span><span>        </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name -&gt; Fixity)
 -&gt; SrcSpan
 -&gt; DerivInstTys
 -&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
     Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {t} {a} {c} {a}.
((Name -&gt; Fixity) -&gt; t -&gt; DerivInstTys -&gt; (a, c))
-&gt; t
-&gt; DerivInstTys
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, [a], c, [Name])
</span><a href="#local-6989586621682056106"><span class="hs-identifier hs-var">read_or_show_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Fixity)
-&gt; SrcSpan -&gt; DerivInstTys -&gt; (LHsBinds GhcPs, Bag AuxBindSpec)
(Name -&gt; Fixity)
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
    Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Show_binds"><span class="hs-identifier hs-var">gen_Show_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#readClassKey"><span class="hs-identifier hs-var">readClassKey</span></a></span><span class="hs-special">,</span><span>        </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name -&gt; Fixity)
 -&gt; SrcSpan
 -&gt; DerivInstTys
 -&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
     Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {t} {a} {c} {a}.
((Name -&gt; Fixity) -&gt; t -&gt; DerivInstTys -&gt; (a, c))
-&gt; t
-&gt; DerivInstTys
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, [a], c, [Name])
</span><a href="#local-6989586621682056106"><span class="hs-identifier hs-var">read_or_show_binds</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Fixity)
-&gt; SrcSpan -&gt; DerivInstTys -&gt; (LHsBinds GhcPs, Bag AuxBindSpec)
(Name -&gt; Fixity)
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
    Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Read_binds"><span class="hs-identifier hs-var">gen_Read_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#dataClassKey"><span class="hs-identifier hs-var">dataClassKey</span></a></span><span class="hs-special">,</span><span>        </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; m (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056093"><span class="hs-identifier hs-var">simple_bindsM</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Data_binds"><span class="hs-identifier hs-var">gen_Data_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#functorClassKey"><span class="hs-identifier hs-var">functorClassKey</span></a></span><span class="hs-special">,</span><span>     </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
     Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056101"><span class="hs-identifier hs-var">simple_binds</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
    Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Functor.html#gen_Functor_binds"><span class="hs-identifier hs-var">gen_Functor_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#foldableClassKey"><span class="hs-identifier hs-var">foldableClassKey</span></a></span><span class="hs-special">,</span><span>    </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
     Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056101"><span class="hs-identifier hs-var">simple_binds</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
    Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Functor.html#gen_Foldable_binds"><span class="hs-identifier hs-var">gen_Foldable_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#traversableClassKey"><span class="hs-identifier hs-var">traversableClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
     Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056101"><span class="hs-identifier hs-var">simple_binds</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
    Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Functor.html#gen_Traversable_binds"><span class="hs-identifier hs-var">gen_Traversable_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.TH.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a></span><span class="hs-special">,</span><span>        </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
     Bag AuxBindSpec))
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {m :: * -&gt; *} {t} {t} {a} {c} {a} {a}.
Monad m =&gt;
(t -&gt; t -&gt; (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056101"><span class="hs-identifier hs-var">simple_binds</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; (LHsBinds GhcPs, Bag AuxBindSpec)
SrcSpan
-&gt; DerivInstTys
-&gt; (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
    Bag AuxBindSpec)
</span><a href="GHC.Tc.Deriv.Generate.html#gen_Lift_binds"><span class="hs-identifier hs-var">gen_Lift_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
forall {f :: * -&gt; *} {p} {p} {a}. Applicative f =&gt; p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var">no_fam_insts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#genClassKey"><span class="hs-identifier hs-var">genClassKey</span></a></span><span class="hs-special">,</span><span>         </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericKind
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {a}.
GenericKind
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag a, [Name])
</span><a href="#local-6989586621682056120"><span class="hs-identifier hs-var">generic_binds</span></a></span><span> </span><span class="annot"><span class="annottext">GenericKind
</span><a href="GHC.Tc.Deriv.Generics.html#Gen0"><span class="hs-identifier hs-var">Gen0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericKind -&gt; SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
</span><a href="#local-6989586621682056122"><span class="hs-identifier hs-var">generic_fam_inst</span></a></span><span> </span><span class="annot"><span class="annottext">GenericKind
</span><a href="GHC.Tc.Deriv.Generics.html#Gen0"><span class="hs-identifier hs-var">Gen0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#gen1ClassKey"><span class="hs-identifier hs-var">gen1ClassKey</span></a></span><span class="hs-special">,</span><span>        </span><span class="annot"><span class="annottext">(SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var">mk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericKind
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
forall {a}.
GenericKind
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag a, [Name])
</span><a href="#local-6989586621682056120"><span class="hs-identifier hs-var">generic_binds</span></a></span><span> </span><span class="annot"><span class="annottext">GenericKind
</span><a href="GHC.Tc.Deriv.Generics.html#Gen1"><span class="hs-identifier hs-var">Gen1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenericKind -&gt; SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
</span><a href="#local-6989586621682056122"><span class="hs-identifier hs-var">generic_fam_inst</span></a></span><span> </span><span class="annot"><span class="annottext">GenericKind
</span><a href="GHC.Tc.Deriv.Generics.html#Gen1"><span class="hs-identifier hs-var">Gen1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>    </span><span id="local-6989586621682056092"><span class="annot"><span class="annottext">mk :: (SrcSpan
 -&gt; DerivInstTys
 -&gt; TcM
      (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
       [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name]))
-&gt; (SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]) -&gt; StockGenFns
</span><a href="#local-6989586621682056092"><span class="hs-identifier hs-var hs-var">mk</span></a></span></span><span> </span><span id="local-6989586621682056125"><span class="annot"><span class="annottext">SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
</span><a href="#local-6989586621682056125"><span class="hs-identifier hs-var">gen_binds_fn</span></a></span></span><span> </span><span id="local-6989586621682056126"><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
</span><a href="#local-6989586621682056126"><span class="hs-identifier hs-var">gen_fam_insts_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#StockGenFns"><span class="hs-identifier hs-type">StockGenFns</span></a></span><span>
</span><span id="line-757"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stock_gen_binds :: SrcSpan
-&gt; DerivInstTys
-&gt; TcM (LHsBinds GhcPs, [LSig GhcPs], Bag AuxBindSpec, [Name])
</span><a href="GHC.Tc.Deriv.Utils.html#stock_gen_binds"><span class="hs-identifier hs-var">stock_gen_binds</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; DerivInstTys
-&gt; TcM (LHsBinds GhcPs, [LSig GhcPs], Bag AuxBindSpec, [Name])
SrcSpan
-&gt; DerivInstTys
-&gt; TcM
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag AuxBindSpec, [Name])
</span><a href="#local-6989586621682056125"><span class="hs-identifier hs-var">gen_binds_fn</span></a></span><span>
</span><span id="line-758"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stock_gen_fam_insts :: SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
</span><a href="GHC.Tc.Deriv.Utils.html#stock_gen_fam_insts"><span class="hs-identifier hs-var">stock_gen_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
</span><a href="#local-6989586621682056126"><span class="hs-identifier hs-var">gen_fam_insts_fn</span></a></span><span>
</span><span id="line-759"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span>    </span><span id="local-6989586621682056101"><span class="annot"><span class="annottext">simple_binds :: (t -&gt; t -&gt; (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056101"><span class="hs-identifier hs-var hs-var">simple_binds</span></a></span></span><span> </span><span id="local-6989586621682056135"><span class="annot"><span class="annottext">t -&gt; t -&gt; (a, c)
</span><a href="#local-6989586621682056135"><span class="hs-identifier hs-var">gen_fn</span></a></span></span><span> </span><span id="local-6989586621682056136"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056136"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682056137"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056137"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-762"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682056138"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682056138"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056139"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682056139"><span class="hs-identifier hs-var">aux_specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; (a, c)
</span><a href="#local-6989586621682056135"><span class="hs-identifier hs-var">gen_fn</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056136"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056137"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-763"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a, [a], c, [a]) -&gt; m (a, [a], c, [a])
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682056138"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682056139"><span class="hs-identifier hs-var">aux_specs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-comment">-- Like `simple`, but monadic. The only monadic thing that these functions</span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-comment">-- do is allocate new Uniques, which are used for generating the names of</span><span>
</span><span id="line-767"></span><span>    </span><span class="hs-comment">-- auxiliary bindings.</span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-comment">-- See Note [Auxiliary binders] in GHC.Tc.Deriv.Generate.</span><span>
</span><span id="line-769"></span><span>    </span><span id="local-6989586621682056093"><span class="annot"><span class="annottext">simple_bindsM :: (t -&gt; t -&gt; m (a, c)) -&gt; t -&gt; t -&gt; m (a, [a], c, [a])
</span><a href="#local-6989586621682056093"><span class="hs-identifier hs-var hs-var">simple_bindsM</span></a></span></span><span> </span><span id="local-6989586621682056147"><span class="annot"><span class="annottext">t -&gt; t -&gt; m (a, c)
</span><a href="#local-6989586621682056147"><span class="hs-identifier hs-var">gen_fn</span></a></span></span><span> </span><span id="local-6989586621682056148"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056148"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682056149"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056149"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-770"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682056150"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682056150"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056151"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682056151"><span class="hs-identifier hs-var">aux_specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m (a, c)
</span><a href="#local-6989586621682056147"><span class="hs-identifier hs-var">gen_fn</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056148"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056149"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-771"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, [a], c, [a]) -&gt; m (a, [a], c, [a])
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682056150"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682056151"><span class="hs-identifier hs-var">aux_specs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span>    </span><span id="local-6989586621682056106"><span class="annot"><span class="annottext">read_or_show_binds :: ((Name -&gt; Fixity) -&gt; t -&gt; DerivInstTys -&gt; (a, c))
-&gt; t
-&gt; DerivInstTys
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, [a], c, [Name])
</span><a href="#local-6989586621682056106"><span class="hs-identifier hs-var hs-var">read_or_show_binds</span></a></span></span><span> </span><span id="local-6989586621682056154"><span class="annot"><span class="annottext">(Name -&gt; Fixity) -&gt; t -&gt; DerivInstTys -&gt; (a, c)
</span><a href="#local-6989586621682056154"><span class="hs-identifier hs-var">gen_fn</span></a></span></span><span> </span><span id="local-6989586621682056155"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056155"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682056156"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056156"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-774"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056157"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621682056157"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056156"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-775"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682056159"><span class="annot"><span class="annottext">Name -&gt; Fixity
</span><a href="#local-6989586621682056159"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM (Name -&gt; Fixity)
</span><a href="GHC.Tc.Deriv.Utils.html#getDataConFixityFun"><span class="hs-identifier hs-var">getDataConFixityFun</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056157"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-776"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682056161"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682056161"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056162"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682056162"><span class="hs-identifier hs-var">aux_specs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Fixity) -&gt; t -&gt; DerivInstTys -&gt; (a, c)
</span><a href="#local-6989586621682056154"><span class="hs-identifier hs-var">gen_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Fixity
</span><a href="#local-6989586621682056159"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621682056155"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056156"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-777"></span><span>                 </span><span id="local-6989586621682056163"><span class="annot"><span class="annottext">field_names :: [Name]
</span><a href="#local-6989586621682056163"><span class="hs-identifier hs-var hs-var">field_names</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Name]
</span><a href="#local-6989586621682056164"><span class="hs-identifier hs-var">all_field_names</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056157"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-778"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, [a], c, [Name])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, [a], c, [Name])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682056161"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621682056162"><span class="hs-identifier hs-var">aux_specs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682056163"><span class="hs-identifier hs-var">field_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span>    </span><span id="local-6989586621682056120"><span class="annot"><span class="annottext">generic_binds :: GenericKind
-&gt; SrcSpan
-&gt; DerivInstTys
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag a, [Name])
</span><a href="#local-6989586621682056120"><span class="hs-identifier hs-var hs-var">generic_binds</span></a></span></span><span> </span><span id="local-6989586621682056167"><span class="annot"><span class="annottext">GenericKind
</span><a href="#local-6989586621682056167"><span class="hs-identifier hs-var">gk</span></a></span></span><span> </span><span id="local-6989586621682056168"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682056168"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682056169"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056169"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-781"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056170"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621682056170"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056169"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-782"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682056171"><span class="annot"><span class="annottext">Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs))
</span><a href="#local-6989586621682056171"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056172"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Sig GhcPs)]
</span><a href="#local-6989586621682056172"><span class="hs-identifier hs-var">sigs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenericKind
-&gt; SrcSpan -&gt; DerivInstTys -&gt; TcM (LHsBinds GhcPs, [LSig GhcPs])
</span><a href="GHC.Tc.Deriv.Generics.html#gen_Generic_binds"><span class="hs-identifier hs-var">gen_Generic_binds</span></a></span><span> </span><span class="annot"><span class="annottext">GenericKind
</span><a href="#local-6989586621682056167"><span class="hs-identifier hs-var">gk</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682056168"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056169"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-783"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056174"><span class="annot"><span class="annottext">field_names :: [Name]
</span><a href="#local-6989586621682056174"><span class="hs-identifier hs-var hs-var">field_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Name]
</span><a href="#local-6989586621682056164"><span class="hs-identifier hs-var">all_field_names</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056170"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-784"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
 [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag a, [Name])
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs)),
      [GenLocated SrcSpanAnnA (Sig GhcPs)], Bag a, [Name])
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag (GenLocated SrcSpanAnnA (HsBindLR GhcPs GhcPs))
</span><a href="#local-6989586621682056171"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Sig GhcPs)]
</span><a href="#local-6989586621682056172"><span class="hs-identifier hs-var">sigs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag a
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621682056174"><span class="hs-identifier hs-var">field_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>    </span><span id="local-6989586621682056122"><span class="annot"><span class="annottext">generic_fam_inst :: GenericKind -&gt; SrcSpan -&gt; DerivInstTys -&gt; TcM [FamInst]
</span><a href="#local-6989586621682056122"><span class="hs-identifier hs-var hs-var">generic_fam_inst</span></a></span></span><span> </span><span id="local-6989586621682056179"><span class="annot"><span class="annottext">GenericKind
</span><a href="#local-6989586621682056179"><span class="hs-identifier hs-var">gk</span></a></span></span><span> </span><span id="local-6989586621682056180"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682056180"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682056181"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056181"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-787"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682056182"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621682056182"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056181"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-788"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682056183"><span class="annot"><span class="annottext">Name -&gt; Fixity
</span><a href="#local-6989586621682056183"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM (Name -&gt; Fixity)
</span><a href="GHC.Tc.Deriv.Utils.html#getDataConFixityFun"><span class="hs-identifier hs-var">getDataConFixityFun</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056182"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-789"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682056184"><span class="annot"><span class="annottext">FamInst
</span><a href="#local-6989586621682056184"><span class="hs-identifier hs-var">faminst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenericKind
-&gt; (Name -&gt; Fixity) -&gt; SrcSpan -&gt; DerivInstTys -&gt; TcM FamInst
</span><a href="GHC.Tc.Deriv.Generics.html#gen_Generic_fam_inst"><span class="hs-identifier hs-var">gen_Generic_fam_inst</span></a></span><span> </span><span class="annot"><span class="annottext">GenericKind
</span><a href="#local-6989586621682056179"><span class="hs-identifier hs-var">gk</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Fixity
</span><a href="#local-6989586621682056183"><span class="hs-identifier hs-var">fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682056180"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056181"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-790"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[FamInst] -&gt; TcM [FamInst]
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FamInst
</span><a href="#local-6989586621682056184"><span class="hs-identifier hs-var">faminst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span>    </span><span id="local-6989586621682056095"><span class="annot"><span class="annottext">no_fam_insts :: p -&gt; p -&gt; f [a]
</span><a href="#local-6989586621682056095"><span class="hs-identifier hs-var hs-var">no_fam_insts</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; f [a]
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>    </span><span class="hs-comment">-- See Note [Deriving and unused record selectors]</span><span>
</span><span id="line-795"></span><span>    </span><span id="local-6989586621682056164"><span class="annot"><span class="annottext">all_field_names :: TyCon -&gt; [Name]
</span><a href="#local-6989586621682056164"><span class="hs-identifier hs-var hs-var">all_field_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLabel] -&gt; [Name])
-&gt; (TyCon -&gt; [FieldLabel]) -&gt; TyCon -&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; [FieldLabel]) -&gt; [DataCon] -&gt; [FieldLabel]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [FieldLabel]
</span><a href="GHC.Core.DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a></span><span>
</span><span id="line-796"></span><span>                                     </span><span class="annot"><span class="annottext">([DataCon] -&gt; [FieldLabel])
-&gt; (TyCon -&gt; [DataCon]) -&gt; TyCon -&gt; [FieldLabel]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span class="hs-comment">{-
Note [Deriving and unused record selectors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this (see #13919):

  module Main (main) where

  data Foo = MkFoo {bar :: String} deriving Show

  main :: IO ()
  main = print (Foo &quot;hello&quot;)

Strictly speaking, the record selector `bar` is unused in this module, since
neither `main` nor the derived `Show` instance for `Foo` mention `bar`.
However, the behavior of `main` is affected by the presence of `bar`, since
it will print different output depending on whether `MkFoo` is defined using
record selectors or not. Therefore, we do not to issue a
&quot;Defined but not used: &#8216;bar&#8217;&quot; warning for this module, since removing `bar`
changes the program's behavior. This is the reason behind the [Name] part of
the return type of `hasStockDeriving`&#8212;it tracks all of the record selector
`Name`s for which -Wunused-binds should be suppressed.

Currently, the only three stock derived classes that require this are Read,
Show, and Generic, as their derived code all depend on the record selectors
of the derived data type's constructors.

See also Note [Unused constructors and deriving clauses] in GHC.Tc.Deriv for
another example of a similar trick.
-}</span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#getDataConFixityFun"><span class="hs-identifier hs-type">getDataConFixityFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Fixity.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span class="hs-comment">-- If the TyCon is locally defined, we want the local fixity env;</span><span>
</span><span id="line-830"></span><span class="hs-comment">-- but if it is imported (which happens for standalone deriving)</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- we need to get the fixity env from the interface file</span><span>
</span><span id="line-832"></span><span class="hs-comment">-- c.f. GHC.Rename.Env.lookupFixity, #9830, and #20994</span><span>
</span><span id="line-833"></span><span id="getDataConFixityFun"><span class="annot"><span class="annottext">getDataConFixityFun :: TyCon -&gt; TcM (Name -&gt; Fixity)
</span><a href="GHC.Tc.Deriv.Utils.html#getDataConFixityFun"><span class="hs-identifier hs-var hs-var">getDataConFixityFun</span></a></span></span><span> </span><span id="local-6989586621682056195"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056195"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682056196"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682056196"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-835"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682056196"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682056198"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-836"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682056199"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621682056199"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn FixityEnv
</span><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-var">getFixityEnv</span></a></span><span>
</span><span id="line-837"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Fixity) -&gt; TcM (Name -&gt; Fixity)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FixityEnv -&gt; Name -&gt; Fixity
</span><a href="GHC.Types.Fixity.Env.html#lookupFixity"><span class="hs-identifier hs-var">lookupFixity</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621682056199"><span class="hs-identifier hs-var">fix_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-838"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682056201"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682056201"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Name -&gt; TcRn ModIface
</span><a href="GHC.Iface.Load.html#loadInterfaceForName"><span class="hs-identifier hs-var">loadInterfaceForName</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682056202"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682056198"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-839"></span><span>                            </span><span class="hs-comment">-- Should already be loaded!</span><span>
</span><span id="line-840"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Fixity) -&gt; TcM (Name -&gt; Fixity)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; OccName -&gt; Fixity
</span><a href="GHC.Unit.Module.ModIface.html#mi_fix"><span class="hs-identifier hs-var">mi_fix</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682056201"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; Fixity) -&gt; (Name -&gt; OccName) -&gt; Name -&gt; Fixity
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-842"></span><span>    </span><span id="local-6989586621682056198"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621682056198"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056195"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-843"></span><span>    </span><span id="local-6989586621682056202"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621682056202"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Data con fixities for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682056198"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span class="hs-comment">------------------------------------------------------------------</span><span>
</span><span id="line-846"></span><span class="hs-comment">-- Check side conditions that dis-allow derivability for the originative</span><span>
</span><span id="line-847"></span><span class="hs-comment">-- deriving strategies (stock and anyclass).</span><span>
</span><span id="line-848"></span><span class="hs-comment">-- See Note [Deriving strategies] in GHC.Tc.Deriv for an explanation of what</span><span>
</span><span id="line-849"></span><span class="hs-comment">-- &quot;originative&quot; means.</span><span>
</span><span id="line-850"></span><span class="hs-comment">--</span><span>
</span><span id="line-851"></span><span class="hs-comment">-- This is *apart* from the coerce-based strategies, newtype and via.</span><span>
</span><span id="line-852"></span><span class="hs-comment">--</span><span>
</span><span id="line-853"></span><span class="hs-comment">-- Here we get the representation tycon in case of family instances as it has</span><span>
</span><span id="line-854"></span><span class="hs-comment">-- the data constructors - but we need to be careful to fall back to the</span><span>
</span><span id="line-855"></span><span class="hs-comment">-- family tycon (with indexes) in error messages.</span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#checkOriginativeSideConditions"><span class="hs-identifier hs-type">checkOriginativeSideConditions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivM"><span class="hs-identifier hs-type">DerivM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#OriginativeDerivStatus"><span class="hs-identifier hs-type">OriginativeDerivStatus</span></a></span><span>
</span><span id="line-858"></span><span id="checkOriginativeSideConditions"><span class="annot"><span class="annottext">checkOriginativeSideConditions :: DerivInstTys -&gt; DerivM OriginativeDerivStatus
</span><a href="GHC.Tc.Deriv.Utils.html#checkOriginativeSideConditions"><span class="hs-identifier hs-var hs-var">checkOriginativeSideConditions</span></a></span></span><span> </span><span id="local-6989586621682056205"><span class="annot"><span class="annottext">dit :: DerivInstTys
</span><a href="#local-6989586621682056205"><span class="hs-identifier hs-var">dit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dit_cls_tys :: DerivInstTys -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Generate.html#dit_cls_tys"><span class="hs-identifier hs-var">dit_cls_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056207"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056207"><span class="hs-identifier hs-var">cls_tys</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivEnv"><span class="hs-identifier hs-type">DerivEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">denv_cls :: DerivEnv -&gt; Class
</span><a href="GHC.Tc.Deriv.Utils.html#denv_cls"><span class="hs-identifier hs-var">denv_cls</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056208"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056208"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-860"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">denv_ctxt :: DerivEnv -&gt; DerivContext
</span><a href="GHC.Tc.Deriv.Utils.html#denv_ctxt"><span class="hs-identifier hs-var">denv_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056209"><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682056209"><span class="hs-identifier hs-var">deriv_ctxt</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT DerivEnv (IOEnv (Env TcGblEnv TcLclEnv)) DerivEnv
forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ask/Control.Monad.Trans.Reader.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-861"></span><span>     </span><span id="local-6989586621682056211"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056211"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT DerivEnv (IOEnv (Env TcGblEnv TcLclEnv)) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>     </span><span class="hs-keyword">if</span><span>    </span><span class="hs-comment">-- First, check if stock deriving is possible...</span><span>
</span><span id="line-864"></span><span>        </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682056213"><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056213"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DerivContext -&gt; Class -&gt; Maybe Condition
</span><a href="GHC.Tc.Deriv.Utils.html#stockSideConditions"><span class="hs-identifier hs-var">stockSideConditions</span></a></span><span> </span><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682056209"><span class="hs-identifier hs-var">deriv_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056208"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-865"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056213"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056211"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056205"><span class="hs-identifier hs-var">dit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-866"></span><span>             </span><span class="annot"><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-type">NotValid</span></a></span><span> </span><span id="local-6989586621682056216"><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="#local-6989586621682056216"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a. a -&gt; ReaderT DerivEnv (IOEnv (Env TcGblEnv TcLclEnv)) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus)
-&gt; OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; OriginativeDerivStatus
</span><a href="GHC.Tc.Deriv.Utils.html#StockClassError"><span class="hs-identifier hs-var">StockClassError</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="#local-6989586621682056216"><span class="hs-identifier hs-var">err</span></a></span><span>  </span><span class="hs-comment">-- Class-specific error</span><span>
</span><span id="line-867"></span><span>             </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>  </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056208"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056207"><span class="hs-identifier hs-var">cls_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>                         </span><span class="hs-comment">-- All stock derivable classes are unary in the sense that</span><span>
</span><span id="line-869"></span><span>                         </span><span class="hs-comment">-- there should be not types in cls_tys (i.e., no type args</span><span>
</span><span id="line-870"></span><span>                         </span><span class="hs-comment">-- other than last). Note that cls_types can contain</span><span>
</span><span id="line-871"></span><span>                         </span><span class="hs-comment">-- invisible types as well (e.g., for Generic1, which is</span><span>
</span><span id="line-872"></span><span>                         </span><span class="hs-comment">-- poly-kinded), so make sure those are not counted.</span><span>
</span><span id="line-873"></span><span>                      </span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682056221"><span class="annot"><span class="annottext">StockGenFns
</span><a href="#local-6989586621682056221"><span class="hs-identifier hs-var">gen_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Maybe StockGenFns
</span><a href="GHC.Tc.Deriv.Utils.html#hasStockDeriving"><span class="hs-identifier hs-var">hasStockDeriving</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056208"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-874"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a. a -&gt; ReaderT DerivEnv (IOEnv (Env TcGblEnv TcLclEnv)) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus)
-&gt; OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StockGenFns -&gt; OriginativeDerivStatus
</span><a href="GHC.Tc.Deriv.Utils.html#CanDeriveStock"><span class="hs-identifier hs-var">CanDeriveStock</span></a></span><span> </span><span class="annot"><span class="annottext">StockGenFns
</span><a href="#local-6989586621682056221"><span class="hs-identifier hs-var">gen_fn</span></a></span><span>
</span><span id="line-875"></span><span>                      </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-876"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a. a -&gt; ReaderT DerivEnv (IOEnv (Env TcGblEnv TcLclEnv)) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus)
-&gt; OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; OriginativeDerivStatus
</span><a href="GHC.Tc.Deriv.Utils.html#StockClassError"><span class="hs-identifier hs-var">StockClassError</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; OriginativeDerivStatus)
-&gt; DeriveInstanceErrReason -&gt; OriginativeDerivStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Utils.html#classArgsErr"><span class="hs-identifier hs-var">classArgsErr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056208"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056207"><span class="hs-identifier hs-var">cls_tys</span></a></span><span>
</span><span id="line-877"></span><span>                        </span><span class="hs-comment">-- e.g. deriving( Eq s )</span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span>           </span><span class="hs-comment">-- ...if not, try falling back on DeriveAnyClass.</span><span>
</span><span id="line-880"></span><span>        </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveAnyClass</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056211"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a. a -&gt; ReaderT DerivEnv (IOEnv (Env TcGblEnv TcLclEnv)) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">OriginativeDerivStatus
</span><a href="GHC.Tc.Deriv.Utils.html#CanDeriveAnyClass"><span class="hs-identifier hs-var">CanDeriveAnyClass</span></a></span><span>   </span><span class="hs-comment">-- DeriveAnyClass should work</span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span>        </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-884"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OriginativeDerivStatus -&gt; DerivM OriginativeDerivStatus
forall a. a -&gt; ReaderT DerivEnv (IOEnv (Env TcGblEnv TcLclEnv)) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">OriginativeDerivStatus
</span><a href="GHC.Tc.Deriv.Utils.html#NonDerivableClass"><span class="hs-identifier hs-var">NonDerivableClass</span></a></span><span> </span><span class="hs-comment">-- Neither anyclass nor stock work</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#classArgsErr"><span class="hs-identifier hs-type">classArgsErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceErrReason"><span class="hs-identifier hs-type">DeriveInstanceErrReason</span></a></span><span>
</span><span id="line-888"></span><span id="classArgsErr"><span class="annot"><span class="annottext">classArgsErr :: Class -&gt; [Type] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Utils.html#classArgsErr"><span class="hs-identifier hs-var hs-var">classArgsErr</span></a></span></span><span> </span><span id="local-6989586621682056225"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056225"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682056226"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056226"><span class="hs-identifier hs-var">cls_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrNotAClass"><span class="hs-identifier hs-var">DerivErrNotAClass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056225"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056226"><span class="hs-identifier hs-var">cls_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span class="hs-comment">-- Side conditions (whether the datatype must have at least one constructor,</span><span>
</span><span id="line-891"></span><span class="hs-comment">-- required language extensions, etc.) for using GHC's stock deriving</span><span>
</span><span id="line-892"></span><span class="hs-comment">-- mechanism on certain classes (as opposed to classes that require</span><span>
</span><span id="line-893"></span><span class="hs-comment">-- GeneralizedNewtypeDeriving or DeriveAnyClass). Returns Nothing for a</span><span>
</span><span id="line-894"></span><span class="hs-comment">-- class for which stock deriving isn't possible.</span><span>
</span><span id="line-895"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#stockSideConditions"><span class="hs-identifier hs-type">stockSideConditions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-896"></span><span id="stockSideConditions"><span class="annot"><span class="annottext">stockSideConditions :: DerivContext -&gt; Class -&gt; Maybe Condition
</span><a href="GHC.Tc.Deriv.Utils.html#stockSideConditions"><span class="hs-identifier hs-var hs-var">stockSideConditions</span></a></span></span><span> </span><span id="local-6989586621682056229"><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682056229"><span class="hs-identifier hs-var">deriv_ctxt</span></a></span></span><span> </span><span id="local-6989586621682056230"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-897"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var">cond_std</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var">cond_std</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var">cond_std</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#readClassKey"><span class="hs-identifier hs-var">readClassKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var">cond_std</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#enumClassKey"><span class="hs-identifier hs-var">enumClassKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var">cond_std</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_isEnumeration"><span class="hs-identifier hs-var">cond_isEnumeration</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#ixClassKey"><span class="hs-identifier hs-var">ixClassKey</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var">cond_std</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_enumOrProduct"><span class="hs-identifier hs-var">cond_enumOrProduct</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#boundedClassKey"><span class="hs-identifier hs-var">boundedClassKey</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var">cond_std</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_enumOrProduct"><span class="hs-identifier hs-var">cond_enumOrProduct</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#dataClassKey"><span class="hs-identifier hs-var">dataClassKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveDataTypeable</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-905"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var">cond_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-906"></span><span>                                                   </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#functorClassKey"><span class="hs-identifier hs-var">functorClassKey</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveFunctor</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-908"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var">cond_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-909"></span><span>                                                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_functorOK"><span class="hs-identifier hs-var">cond_functorOK</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-910"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#foldableClassKey"><span class="hs-identifier hs-var">foldableClassKey</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveFoldable</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-911"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var">cond_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-912"></span><span>                                                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_functorOK"><span class="hs-identifier hs-var">cond_functorOK</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>                                                   </span><span class="hs-comment">-- Functor/Fold/Trav works ok</span><span>
</span><span id="line-914"></span><span>                                                   </span><span class="hs-comment">-- for rank-n types</span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#traversableClassKey"><span class="hs-identifier hs-var">traversableClassKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveTraversable</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-916"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var">cond_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-917"></span><span>                                                   </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_functorOK"><span class="hs-identifier hs-var">cond_functorOK</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#genClassKey"><span class="hs-identifier hs-var">genClassKey</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveGeneric</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-919"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var">cond_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-920"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_RepresentableOk"><span class="hs-identifier hs-var">cond_RepresentableOk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#gen1ClassKey"><span class="hs-identifier hs-var">gen1ClassKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveGeneric</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-922"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var">cond_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-923"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_Representable1Ok"><span class="hs-identifier hs-var">cond_Representable1Ok</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-924"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; a -&gt; Bool
</span><a href="GHC.Utils.Unique.html#sameUnique"><span class="hs-identifier hs-var">sameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.TH.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Maybe Condition
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var">checkFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.DeriveLift</span></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-925"></span><span>                                                   </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var">cond_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span>
</span><span id="line-926"></span><span>                                                   </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Condition
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-928"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-929"></span><span>    </span><span id="local-6989586621682056231"><span class="annot"><span class="annottext">cls_key :: Unique
</span><a href="#local-6989586621682056231"><span class="hs-identifier hs-var hs-var">cls_key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056230"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-930"></span><span>    </span><span id="local-6989586621682056232"><span class="annot"><span class="annottext">cond_std :: Condition
</span><a href="#local-6989586621682056232"><span class="hs-identifier hs-var hs-var">cond_std</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivContext -&gt; Bool -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_stdOK"><span class="hs-identifier hs-var">cond_stdOK</span></a></span><span> </span><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682056229"><span class="hs-identifier hs-var">deriv_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-931"></span><span>      </span><span class="hs-comment">-- Vanilla data constructors, at least one, and monotype arguments</span><span>
</span><span id="line-932"></span><span>    </span><span id="local-6989586621682056239"><span class="annot"><span class="annottext">cond_vanilla :: Condition
</span><a href="#local-6989586621682056239"><span class="hs-identifier hs-var hs-var">cond_vanilla</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivContext -&gt; Bool -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_stdOK"><span class="hs-identifier hs-var">cond_stdOK</span></a></span><span> </span><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682056229"><span class="hs-identifier hs-var">deriv_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-933"></span><span>      </span><span class="hs-comment">-- Vanilla data constructors but allow no data cons or polytype arguments</span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span class="hs-keyword">type</span><span> </span><span id="Condition"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-var">Condition</span></a></span></span><span>
</span><span id="line-936"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ Information about the type arguments to the class.</span></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceErrReason"><span class="hs-identifier hs-type">DeriveInstanceErrReason</span></a></span><span>
</span><span id="line-941"></span><span>     </span><span class="hs-comment">-- ^ 'IsValid' if deriving an instance for this type is</span><span>
</span><span id="line-942"></span><span>     </span><span class="hs-comment">-- possible. Otherwise, it's @'NotValid' err@, where @err@</span><span>
</span><span id="line-943"></span><span>     </span><span class="hs-comment">-- explains what went wrong.</span><span>
</span><span id="line-944"></span><span>
</span><span id="line-945"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-identifier hs-type">andCond</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-946"></span><span id="andCond"><span class="annot"><span class="annottext">andCond :: Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-identifier hs-var hs-var">andCond</span></a></span></span><span> </span><span id="local-6989586621682056249"><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056249"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682056250"><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056250"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621682056251"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056251"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682056252"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056252"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-947"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056249"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056251"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056252"><span class="hs-identifier hs-var">dit</span></a></span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
forall a. Validity' a -&gt; Validity' a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#andValid"><span class="hs-operator hs-var">`andValid`</span></a></span><span> </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056250"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056251"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056252"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="hs-comment">-- | Some common validity checks shared among stock derivable classes. One</span><span>
</span><span id="line-950"></span><span class="hs-comment">-- check that absolutely must hold is that if an instance @C (T a)@ is being</span><span>
</span><span id="line-951"></span><span class="hs-comment">-- derived, then @T@ must be a tycon for a data type or a newtype. The</span><span>
</span><span id="line-952"></span><span class="hs-comment">-- remaining checks are only performed if using a @deriving@ clause (i.e.,</span><span>
</span><span id="line-953"></span><span class="hs-comment">-- they're ignored if using @StandaloneDeriving@):</span><span>
</span><span id="line-954"></span><span class="hs-comment">--</span><span>
</span><span id="line-955"></span><span class="hs-comment">-- 1. The data type must have at least one constructor (this check is ignored</span><span>
</span><span id="line-956"></span><span class="hs-comment">--    if using @EmptyDataDeriving@).</span><span>
</span><span id="line-957"></span><span class="hs-comment">--</span><span>
</span><span id="line-958"></span><span class="hs-comment">-- 2. The data type cannot have any GADT constructors.</span><span>
</span><span id="line-959"></span><span class="hs-comment">--</span><span>
</span><span id="line-960"></span><span class="hs-comment">-- 3. The data type cannot have any constructors with existentially quantified</span><span>
</span><span id="line-961"></span><span class="hs-comment">--    type variables.</span><span>
</span><span id="line-962"></span><span class="hs-comment">--</span><span>
</span><span id="line-963"></span><span class="hs-comment">-- 4. The data type cannot have a context (e.g., @data Foo a = Eq a =&gt; MkFoo@).</span><span>
</span><span id="line-964"></span><span class="hs-comment">--</span><span>
</span><span id="line-965"></span><span class="hs-comment">-- 5. The data type cannot have fields with higher-rank types.</span><span>
</span><span id="line-966"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_stdOK"><span class="hs-identifier hs-type">cond_stdOK</span></a></span><span>
</span><span id="line-967"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivContext"><span class="hs-identifier hs-type">DerivContext</span></a></span><span> </span><span class="hs-comment">-- ^ 'SupplyContext' if this is standalone deriving with a</span><span>
</span><span id="line-968"></span><span>                  </span><span class="hs-comment">-- user-supplied context, 'InferContext' if not.</span><span>
</span><span id="line-969"></span><span>                  </span><span class="hs-comment">-- If it is the former, we relax some of the validity checks</span><span>
</span><span id="line-970"></span><span>                  </span><span class="hs-comment">-- we would otherwise perform (i.e., &quot;just go for it&quot;).</span><span>
</span><span id="line-971"></span><span>
</span><span id="line-972"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>         </span><span class="hs-comment">-- ^ 'True' &lt;=&gt; allow higher rank arguments and empty data</span><span>
</span><span id="line-973"></span><span>                  </span><span class="hs-comment">-- types (with no data constructors) even in the absence of</span><span>
</span><span id="line-974"></span><span>                  </span><span class="hs-comment">-- the -XEmptyDataDeriving extension.</span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-977"></span><span id="cond_stdOK"><span class="annot"><span class="annottext">cond_stdOK :: DerivContext -&gt; Bool -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_stdOK"><span class="hs-identifier hs-var hs-var">cond_stdOK</span></a></span></span><span> </span><span id="local-6989586621682056254"><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682056254"><span class="hs-identifier hs-var">deriv_ctxt</span></a></span></span><span> </span><span id="local-6989586621682056255"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056255"><span class="hs-identifier hs-var">permissive</span></a></span></span><span> </span><span id="local-6989586621682056256"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056256"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-978"></span><span>           </span><span id="local-6989586621682056257"><span class="annot"><span class="annottext">dit :: DerivInstTys
</span><a href="#local-6989586621682056257"><span class="hs-identifier hs-var">dit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dit_tc :: DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_tc"><span class="hs-identifier hs-var">dit_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056259"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056259"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dit_rep_tc :: DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056260"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056260"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-979"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056261"><span class="hs-identifier hs-var">valid_ADT</span></a></span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
forall a. Validity' a -&gt; Validity' a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#andValid"><span class="hs-operator hs-var">`andValid`</span></a></span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056262"><span class="hs-identifier hs-var">valid_misc</span></a></span><span>
</span><span id="line-980"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-981"></span><span>    </span><span class="annot"><a href="#local-6989586621682056261"><span class="hs-identifier hs-type">valid_ADT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682056262"><span class="hs-identifier hs-type">valid_misc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceErrReason"><span class="hs-identifier hs-type">DeriveInstanceErrReason</span></a></span><span>
</span><span id="line-982"></span><span>    </span><span id="local-6989586621682056261"><span class="annot"><span class="annottext">valid_ADT :: Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056261"><span class="hs-identifier hs-var hs-var">valid_ADT</span></a></span></span><span>
</span><span id="line-983"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056259"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056259"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-984"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-985"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-comment">-- Complain about functions, primitive types, and other tycons that</span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-comment">-- stock deriving can't handle.</span><span>
</span><span id="line-988"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrLastArgMustBeApp"><span class="hs-identifier hs-var">DerivErrLastArgMustBeApp</span></a></span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span>    </span><span id="local-6989586621682056262"><span class="annot"><span class="annottext">valid_misc :: Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056262"><span class="hs-identifier hs-var hs-var">valid_misc</span></a></span></span><span>
</span><span id="line-991"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DerivContext
</span><a href="#local-6989586621682056254"><span class="hs-identifier hs-var">deriv_ctxt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-992"></span><span>         </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#SupplyContext"><span class="hs-identifier hs-type">SupplyContext</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-993"></span><span>                </span><span class="hs-comment">-- Don't check these conservative conditions for</span><span>
</span><span id="line-994"></span><span>                </span><span class="hs-comment">-- standalone deriving; just generate the code</span><span>
</span><span id="line-995"></span><span>                </span><span class="hs-comment">-- and let the typechecker handle the result</span><span>
</span><span id="line-996"></span><span>         </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#InferContext"><span class="hs-identifier hs-type">InferContext</span></a></span><span> </span><span id="local-6989586621682056267"><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682056267"><span class="hs-identifier hs-var">wildcard</span></a></span></span><span>
</span><span id="line-997"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[DataCon] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682056268"><span class="hs-identifier hs-var">data_cons</span></a></span><span> </span><span class="hs-comment">-- 1.</span><span>
</span><span id="line-998"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056255"><span class="hs-identifier hs-var">permissive</span></a></span><span>
</span><span id="line-999"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.EmptyDataDeriving</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056256"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Utils.html#no_cons_why"><span class="hs-identifier hs-var">no_cons_why</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056260"><span class="hs-identifier hs-var">rep_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1001"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DeriveInstanceBadConstructor] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[DeriveInstanceBadConstructor]
</span><a href="#local-6989586621682056272"><span class="hs-identifier hs-var">con_whys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1002"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
-&gt; [DeriveInstanceBadConstructor] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConstructor"><span class="hs-identifier hs-var">DerivErrBadConstructor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasWildcard -&gt; Maybe HasWildcard
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(HasWildcard -&gt; Maybe HasWildcard)
-&gt; HasWildcard -&gt; Maybe HasWildcard
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan -&gt; HasWildcard
forall {a}. Maybe a -&gt; HasWildcard
</span><a href="#local-6989586621682056274"><span class="hs-identifier hs-var">has_wildcard</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="#local-6989586621682056267"><span class="hs-identifier hs-var">wildcard</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DeriveInstanceBadConstructor]
</span><a href="#local-6989586621682056272"><span class="hs-identifier hs-var">con_whys</span></a></span><span>
</span><span id="line-1003"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1004"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1005"></span><span>
</span><span id="line-1006"></span><span>    </span><span id="local-6989586621682056274"><span class="annot"><span class="annottext">has_wildcard :: Maybe a -&gt; HasWildcard
</span><a href="#local-6989586621682056274"><span class="hs-identifier hs-var hs-var">has_wildcard</span></a></span></span><span> </span><span id="local-6989586621682056275"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682056275"><span class="hs-identifier hs-var">wildcard</span></a></span></span><span>
</span><span id="line-1007"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682056275"><span class="hs-identifier hs-var">wildcard</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1008"></span><span>          </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasWildcard
</span><a href="GHC.Tc.Errors.Types.html#YesHasWildcard"><span class="hs-identifier hs-var">YesHasWildcard</span></a></span><span>
</span><span id="line-1009"></span><span>          </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasWildcard
</span><a href="GHC.Tc.Errors.Types.html#NoHasWildcard"><span class="hs-identifier hs-var">NoHasWildcard</span></a></span><span>
</span><span id="line-1010"></span><span>    </span><span id="local-6989586621682056268"><span class="annot"><span class="annottext">data_cons :: [DataCon]
</span><a href="#local-6989586621682056268"><span class="hs-identifier hs-var hs-var">data_cons</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056260"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1011"></span><span>    </span><span id="local-6989586621682056272"><span class="annot"><span class="annottext">con_whys :: [DeriveInstanceBadConstructor]
</span><a href="#local-6989586621682056272"><span class="hs-identifier hs-var hs-var">con_whys</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Validity' DeriveInstanceBadConstructor]
-&gt; [DeriveInstanceBadConstructor]
forall a. [Validity' a] -&gt; [a]
</span><a href="GHC.Utils.Error.html#getInvalids"><span class="hs-identifier hs-var">getInvalids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DataCon -&gt; Validity' DeriveInstanceBadConstructor)
-&gt; [DataCon] -&gt; [Validity' DeriveInstanceBadConstructor]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Validity' DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056279"><span class="hs-identifier hs-var">check_con</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682056268"><span class="hs-identifier hs-var">data_cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span>    </span><span class="annot"><a href="#local-6989586621682056279"><span class="hs-identifier hs-type">check_con</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceBadConstructor"><span class="hs-identifier hs-type">DeriveInstanceBadConstructor</span></a></span><span>
</span><span id="line-1014"></span><span>    </span><span id="local-6989586621682056279"><span class="annot"><span class="annottext">check_con :: DataCon -&gt; Validity' DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056279"><span class="hs-identifier hs-var hs-var">check_con</span></a></span></span><span> </span><span id="local-6989586621682056280"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056280"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-1015"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqSpec] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682056281"><span class="hs-identifier hs-var">eq_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 2.</span><span>
</span><span id="line-1016"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; DeriveInstanceBadConstructor)
-&gt; Validity' DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056282"><span class="hs-identifier hs-var">bad</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConIsGADT"><span class="hs-identifier hs-var">DerivErrBadConIsGADT</span></a></span><span>
</span><span id="line-1017"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682056284"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 3.</span><span>
</span><span id="line-1018"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; DeriveInstanceBadConstructor)
-&gt; Validity' DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056282"><span class="hs-identifier hs-var">bad</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConHasExistentials"><span class="hs-identifier hs-var">DerivErrBadConHasExistentials</span></a></span><span>
</span><span id="line-1019"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056286"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 4.</span><span>
</span><span id="line-1020"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; DeriveInstanceBadConstructor)
-&gt; Validity' DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056282"><span class="hs-identifier hs-var">bad</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConHasConstraints"><span class="hs-identifier hs-var">DerivErrBadConHasConstraints</span></a></span><span>
</span><span id="line-1021"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056255"><span class="hs-identifier hs-var">permissive</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; DerivInstTys -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Generate.html#derivDataConInstArgTys"><span class="hs-identifier hs-var">derivDataConInstArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056280"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056257"><span class="hs-identifier hs-var">dit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 5.</span><span>
</span><span id="line-1022"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; DeriveInstanceBadConstructor)
-&gt; Validity' DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056282"><span class="hs-identifier hs-var">bad</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConHasHigherRankType"><span class="hs-identifier hs-var">DerivErrBadConHasHigherRankType</span></a></span><span>
</span><span id="line-1023"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1024"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceBadConstructor
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1025"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1026"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056284"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682056284"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056281"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621682056281"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056286"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056286"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TyVar], [TyVar], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056280"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1027"></span><span>        </span><span id="local-6989586621682056282"><span class="annot"><span class="annottext">bad :: (DataCon -&gt; DeriveInstanceBadConstructor)
-&gt; Validity' DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056282"><span class="hs-identifier hs-var hs-var">bad</span></a></span></span><span> </span><span id="local-6989586621682056293"><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056293"><span class="hs-identifier hs-var">mkErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceBadConstructor
-&gt; Validity' DeriveInstanceBadConstructor
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceBadConstructor
 -&gt; Validity' DeriveInstanceBadConstructor)
-&gt; DeriveInstanceBadConstructor
-&gt; Validity' DeriveInstanceBadConstructor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="#local-6989586621682056293"><span class="hs-identifier hs-var">mkErr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056280"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#no_cons_why"><span class="hs-identifier hs-type">no_cons_why</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceErrReason"><span class="hs-identifier hs-type">DeriveInstanceErrReason</span></a></span><span>
</span><span id="line-1030"></span><span id="no_cons_why"><span class="annot"><span class="annottext">no_cons_why :: TyCon -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Utils.html#no_cons_why"><span class="hs-identifier hs-var hs-var">no_cons_why</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrNoConstructors"><span class="hs-identifier hs-var">DerivErrNoConstructors</span></a></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_RepresentableOk"><span class="hs-identifier hs-type">cond_RepresentableOk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1033"></span><span id="cond_RepresentableOk"><span class="annot"><span class="annottext">cond_RepresentableOk :: Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_RepresentableOk"><span class="hs-identifier hs-var hs-var">cond_RepresentableOk</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682056295"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056295"><span class="hs-identifier hs-var">dit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1034"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DerivInstTys -&gt; Validity' [DeriveGenericsErrReason]
</span><a href="GHC.Tc.Deriv.Generics.html#canDoGenerics"><span class="hs-identifier hs-var">canDoGenerics</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056295"><span class="hs-identifier hs-var">dit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1035"></span><span>    </span><span class="annot"><span class="annottext">Validity' [DeriveGenericsErrReason]
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1036"></span><span>    </span><span class="annot"><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-type">NotValid</span></a></span><span> </span><span id="local-6989586621682056297"><span class="annot"><span class="annottext">[DeriveGenericsErrReason]
</span><a href="#local-6989586621682056297"><span class="hs-identifier hs-var">generic_errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[DeriveGenericsErrReason] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrGenerics"><span class="hs-identifier hs-var">DerivErrGenerics</span></a></span><span> </span><span class="annot"><span class="annottext">[DeriveGenericsErrReason]
</span><a href="#local-6989586621682056297"><span class="hs-identifier hs-var">generic_errs</span></a></span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_Representable1Ok"><span class="hs-identifier hs-type">cond_Representable1Ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1039"></span><span id="cond_Representable1Ok"><span class="annot"><span class="annottext">cond_Representable1Ok :: Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_Representable1Ok"><span class="hs-identifier hs-var hs-var">cond_Representable1Ok</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682056299"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056299"><span class="hs-identifier hs-var">dit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1040"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DerivInstTys -&gt; Validity' [DeriveGenericsErrReason]
</span><a href="GHC.Tc.Deriv.Generics.html#canDoGenerics1"><span class="hs-identifier hs-var">canDoGenerics1</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056299"><span class="hs-identifier hs-var">dit</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1041"></span><span>    </span><span class="annot"><span class="annottext">Validity' [DeriveGenericsErrReason]
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1042"></span><span>    </span><span class="annot"><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-type">NotValid</span></a></span><span> </span><span id="local-6989586621682056301"><span class="annot"><span class="annottext">[DeriveGenericsErrReason]
</span><a href="#local-6989586621682056301"><span class="hs-identifier hs-var">generic_errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[DeriveGenericsErrReason] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrGenerics"><span class="hs-identifier hs-var">DerivErrGenerics</span></a></span><span> </span><span class="annot"><span class="annottext">[DeriveGenericsErrReason]
</span><a href="#local-6989586621682056301"><span class="hs-identifier hs-var">generic_errs</span></a></span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_enumOrProduct"><span class="hs-identifier hs-type">cond_enumOrProduct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1045"></span><span id="cond_enumOrProduct"><span class="annot"><span class="annottext">cond_enumOrProduct :: Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_enumOrProduct"><span class="hs-identifier hs-var hs-var">cond_enumOrProduct</span></a></span></span><span> </span><span id="local-6989586621682056302"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056302"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_isEnumeration"><span class="hs-identifier hs-var">cond_isEnumeration</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="#local-6989586621682056303"><span class="hs-operator hs-var">`orCond`</span></a></span><span>
</span><span id="line-1046"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_isProduct"><span class="hs-identifier hs-var">cond_isProduct</span></a></span><span> </span><span class="annot"><span class="annottext">Condition -&gt; Condition -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#andCond"><span class="hs-operator hs-var">`andCond`</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var">cond_args</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056302"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1048"></span><span>    </span><span class="annot"><a href="#local-6989586621682056303"><span class="hs-identifier hs-type">orCond</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1049"></span><span>    </span><span id="local-6989586621682056303"><span class="annot"><span class="annottext">orCond :: Condition -&gt; Condition -&gt; Condition
</span><a href="#local-6989586621682056303"><span class="hs-identifier hs-var hs-var">orCond</span></a></span></span><span> </span><span id="local-6989586621682056305"><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056305"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621682056306"><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056306"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621682056307"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056307"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682056308"><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056308"><span class="hs-identifier hs-var">dit</span></a></span></span><span>
</span><span id="line-1050"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056305"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056307"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056308"><span class="hs-identifier hs-var">dit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Condition
</span><a href="#local-6989586621682056306"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056307"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056308"><span class="hs-identifier hs-var">dit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1051"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span class="hs-special">,</span><span>    </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>    </span><span class="hs-comment">-- c1 succeeds</span><span>
</span><span id="line-1052"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span>          </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>    </span><span class="hs-comment">-- c21 succeeds</span><span>
</span><span id="line-1053"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-type">NotValid</span></a></span><span> </span><span id="local-6989586621682056309"><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="#local-6989586621682056309"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-type">NotValid</span></a></span><span> </span><span id="local-6989586621682056310"><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="#local-6989586621682056310"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason
-&gt; DeriveInstanceErrReason -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrEnumOrProduct"><span class="hs-identifier hs-var">DerivErrEnumOrProduct</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="#local-6989586621682056309"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="#local-6989586621682056310"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1054"></span><span>                                                </span><span class="hs-comment">-- Both fail</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-type">cond_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1058"></span><span class="hs-comment">-- ^ For some classes (eg 'Eq', 'Ord') we allow unlifted arg types</span><span>
</span><span id="line-1059"></span><span class="hs-comment">-- by generating specialised code.  For others (eg 'Data') we don't.</span><span>
</span><span id="line-1060"></span><span class="hs-comment">-- For even others (eg 'Lift'), unlifted types aren't even a special</span><span>
</span><span id="line-1061"></span><span class="hs-comment">-- consideration!</span><span>
</span><span id="line-1062"></span><span id="cond_args"><span class="annot"><span class="annottext">cond_args :: Class -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_args"><span class="hs-identifier hs-var hs-var">cond_args</span></a></span></span><span> </span><span id="local-6989586621682056312"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056312"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682056313"><span class="annot"><span class="annottext">dit :: DerivInstTys
</span><a href="#local-6989586621682056313"><span class="hs-identifier hs-var">dit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dit_rep_tc :: DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056314"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056314"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1063"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056315"><span class="hs-identifier hs-var">bad_args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1064"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1065"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682056316"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056316"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrDunnoHowToDeriveForType"><span class="hs-identifier hs-var">DerivErrDunnoHowToDeriveForType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056316"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1066"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1067"></span><span>    </span><span id="local-6989586621682056315"><span class="annot"><span class="annottext">bad_args :: [Type]
</span><a href="#local-6989586621682056315"><span class="hs-identifier hs-var hs-var">bad_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056318"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682056319"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056319"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056314"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1068"></span><span>                        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682056318"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056318"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DerivInstTys -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Generate.html#derivDataConInstArgTys"><span class="hs-identifier hs-var">derivDataConInstArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056319"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056313"><span class="hs-identifier hs-var">dit</span></a></span><span>
</span><span id="line-1069"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#mightBeUnliftedType"><span class="hs-identifier hs-var">mightBeUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056318"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1070"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682056321"><span class="hs-identifier hs-var">ok_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056318"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span>    </span><span id="local-6989586621682056322"><span class="annot"><span class="annottext">cls_key :: Unique
</span><a href="#local-6989586621682056322"><span class="hs-identifier hs-var hs-var">cls_key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique
</span><a href="GHC.Core.Class.html#classKey"><span class="hs-identifier hs-var">classKey</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056312"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-1073"></span><span>    </span><span id="local-6989586621682056321"><span class="annot"><span class="annottext">ok_ty :: Type -&gt; Bool
</span><a href="#local-6989586621682056321"><span class="hs-identifier hs-var hs-var">ok_ty</span></a></span></span><span> </span><span id="local-6989586621682056324"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056324"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span>
</span><span id="line-1074"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056322"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; [(Type, (RdrName, RdrName, RdrName, RdrName, RdrName))] -&gt; Bool
forall a. Type -&gt; [(Type, a)] -&gt; Bool
</span><a href="#local-6989586621682056325"><span class="hs-identifier hs-var">check_in</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056324"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, (RdrName, RdrName, RdrName, RdrName, RdrName))]
</span><a href="GHC.Tc.Deriv.Generate.html#ordOpTbl"><span class="hs-identifier hs-var">ordOpTbl</span></a></span><span>
</span><span id="line-1075"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056322"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; [(Type, (RdrName, RdrName, RdrName, RdrName, RdrName))] -&gt; Bool
forall a. Type -&gt; [(Type, a)] -&gt; Bool
</span><a href="#local-6989586621682056325"><span class="hs-identifier hs-var">check_in</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056324"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, (RdrName, RdrName, RdrName, RdrName, RdrName))]
</span><a href="GHC.Tc.Deriv.Generate.html#ordOpTbl"><span class="hs-identifier hs-var">ordOpTbl</span></a></span><span>
</span><span id="line-1076"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056322"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; [(Type,
     GenLocated SrcSpanAnnA (HsExpr GhcPs)
     -&gt; GenLocated SrcSpanAnnA (HsExpr GhcPs))]
-&gt; Bool
forall a. Type -&gt; [(Type, a)] -&gt; Bool
</span><a href="#local-6989586621682056325"><span class="hs-identifier hs-var">check_in</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056324"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, LHsExpr GhcPs -&gt; LHsExpr GhcPs)]
[(Type,
  GenLocated SrcSpanAnnA (HsExpr GhcPs)
  -&gt; GenLocated SrcSpanAnnA (HsExpr GhcPs))]
</span><a href="GHC.Tc.Deriv.Generate.html#boxConTbl"><span class="hs-identifier hs-var">boxConTbl</span></a></span><span>
</span><span id="line-1077"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682056322"><span class="hs-identifier hs-var">cls_key</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Unique -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.TH.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>     </span><span class="hs-comment">-- Lift is representation-polymorphic</span><span>
</span><span id="line-1078"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>    </span><span class="hs-comment">-- Read, Ix etc</span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span>    </span><span id="local-6989586621682055572"><span class="annot"><a href="#local-6989586621682056325"><span class="hs-identifier hs-type">check_in</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621682055572"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-1081"></span><span>    </span><span id="local-6989586621682056325"><span class="annot"><span class="annottext">check_in :: forall a. Type -&gt; [(Type, a)] -&gt; Bool
</span><a href="#local-6989586621682056325"><span class="hs-identifier hs-var hs-var">check_in</span></a></span></span><span> </span><span id="local-6989586621682056329"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056329"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span id="local-6989586621682056330"><span class="annot"><span class="annottext">[(Type, a)]
</span><a href="#local-6989586621682056330"><span class="hs-identifier hs-var">tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Type, a) -&gt; Bool) -&gt; [(Type, a)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056329"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; ((Type, a) -&gt; Type) -&gt; (Type, a) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, a) -&gt; Type
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Type, a)]
</span><a href="#local-6989586621682056330"><span class="hs-identifier hs-var">tbl</span></a></span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_isEnumeration"><span class="hs-identifier hs-type">cond_isEnumeration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1085"></span><span id="cond_isEnumeration"><span class="annot"><span class="annottext">cond_isEnumeration :: Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_isEnumeration"><span class="hs-identifier hs-var hs-var">cond_isEnumeration</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dit_rep_tc :: DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056334"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056334"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1086"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056334"><span class="hs-identifier hs-var">rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1087"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrMustBeEnumType"><span class="hs-identifier hs-var">DerivErrMustBeEnumType</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056334"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_isProduct"><span class="hs-identifier hs-type">cond_isProduct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1090"></span><span id="cond_isProduct"><span class="annot"><span class="annottext">cond_isProduct :: Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_isProduct"><span class="hs-identifier hs-var hs-var">cond_isProduct</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dit_rep_tc :: DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056337"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056337"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1091"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon_maybe"><span class="hs-identifier hs-var">tyConSingleDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056337"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1093"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1094"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrMustHaveExactlyOneConstructor"><span class="hs-identifier hs-var">DerivErrMustHaveExactlyOneConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056337"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#cond_functorOK"><span class="hs-identifier hs-type">cond_functorOK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1097"></span><span class="hs-comment">-- OK for Functor/Foldable/Traversable class</span><span>
</span><span id="line-1098"></span><span class="hs-comment">-- Currently: (a) at least one argument</span><span>
</span><span id="line-1099"></span><span class="hs-comment">--            (b) don't use argument contravariantly</span><span>
</span><span id="line-1100"></span><span class="hs-comment">--            (c) don't use argument in the wrong place, e.g. data T a = T (X a a)</span><span>
</span><span id="line-1101"></span><span class="hs-comment">--            (d) optionally: don't use function types</span><span>
</span><span id="line-1102"></span><span class="hs-comment">--            (e) no &quot;stupid context&quot; on data type</span><span>
</span><span id="line-1103"></span><span id="cond_functorOK"><span class="annot"><span class="annottext">cond_functorOK :: Bool -&gt; Bool -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#cond_functorOK"><span class="hs-identifier hs-var hs-var">cond_functorOK</span></a></span></span><span> </span><span id="local-6989586621682056340"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056340"><span class="hs-identifier hs-var">allowFunctions</span></a></span></span><span> </span><span id="local-6989586621682056341"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056341"><span class="hs-identifier hs-var">allowExQuantifiedLastTyVar</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1104"></span><span>               </span><span id="local-6989586621682056342"><span class="annot"><span class="annottext">dit :: DerivInstTys
</span><a href="#local-6989586621682056342"><span class="hs-identifier hs-var">dit</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Generate.html#DerivInstTys"><span class="hs-identifier hs-type">DerivInstTys</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dit_rep_tc :: DerivInstTys -&gt; TyCon
</span><a href="GHC.Tc.Deriv.Generate.html#dit_rep_tc"><span class="hs-identifier hs-var">dit_rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056343"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056343"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682056344"><span class="hs-identifier hs-var">tc_tvs</span></a></span><span>
</span><span id="line-1106"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrMustHaveSomeParameters"><span class="hs-identifier hs-var">DerivErrMustHaveSomeParameters</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056343"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span>    </span><span class="hs-comment">-- We can't handle stupid contexts that mention the last type argument,</span><span>
</span><span id="line-1109"></span><span>    </span><span class="hs-comment">-- so error out if we encounter one.</span><span>
</span><span id="line-1110"></span><span>    </span><span class="hs-comment">-- See Note [The stupid context] in GHC.Core.DataCon.</span><span>
</span><span id="line-1111"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056346"><span class="hs-identifier hs-var">bad_stupid_theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrMustNotHaveClassContext"><span class="hs-identifier hs-var">DerivErrMustNotHaveClassContext</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056343"><span class="hs-identifier hs-var">rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056346"><span class="hs-identifier hs-var">bad_stupid_theta</span></a></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1115"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Validity' DeriveInstanceErrReason]
-&gt; Validity' DeriveInstanceErrReason
forall a. [Validity' a] -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#allValid"><span class="hs-identifier hs-var">allValid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DataCon -&gt; Validity' DeriveInstanceErrReason)
-&gt; [DataCon] -&gt; [Validity' DeriveInstanceErrReason]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056349"><span class="hs-identifier hs-var">check_con</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621682056350"><span class="hs-identifier hs-var">data_cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1117"></span><span>    </span><span id="local-6989586621682056344"><span class="annot"><span class="annottext">tc_tvs :: [TyVar]
</span><a href="#local-6989586621682056344"><span class="hs-identifier hs-var hs-var">tc_tvs</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056343"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1118"></span><span>    </span><span id="local-6989586621682056352"><span class="annot"><span class="annottext">last_tv :: TyVar
</span><a href="#local-6989586621682056352"><span class="hs-identifier hs-var hs-var">last_tv</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TyVar
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#last/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682056344"><span class="hs-identifier hs-var">tc_tvs</span></a></span><span>
</span><span id="line-1119"></span><span>    </span><span id="local-6989586621682056346"><span class="annot"><span class="annottext">bad_stupid_theta :: [Type]
</span><a href="#local-6989586621682056346"><span class="hs-identifier hs-var hs-var">bad_stupid_theta</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; [Type]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621682056354"><span class="hs-identifier hs-var">is_bad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type]
</span><a href="GHC.Core.TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056343"><span class="hs-identifier hs-var">rep_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1120"></span><span>    </span><span id="local-6989586621682056354"><span class="annot"><span class="annottext">is_bad :: Type -&gt; Bool
</span><a href="#local-6989586621682056354"><span class="hs-identifier hs-var hs-var">is_bad</span></a></span></span><span> </span><span id="local-6989586621682056356"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056356"><span class="hs-identifier hs-var">pred</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682056352"><span class="hs-identifier hs-var">last_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Tc.Utils.TcType.html#exactTyCoVarsOfType"><span class="hs-identifier hs-var">exactTyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682056356"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-1121"></span><span>      </span><span class="hs-comment">-- See Note [Check that the type variable is truly universal]</span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span>    </span><span id="local-6989586621682056350"><span class="annot"><span class="annottext">data_cons :: [DataCon]
</span><a href="#local-6989586621682056350"><span class="hs-identifier hs-var hs-var">data_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682056343"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-1124"></span><span>    </span><span id="local-6989586621682056349"><span class="annot"><span class="annottext">check_con :: DataCon -&gt; Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056349"><span class="hs-identifier hs-var hs-var">check_con</span></a></span></span><span> </span><span id="local-6989586621682056359"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056359"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Validity' DeriveInstanceErrReason]
-&gt; Validity' DeriveInstanceErrReason
forall a. [Validity' a] -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#allValid"><span class="hs-identifier hs-var">allValid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056360"><span class="hs-identifier hs-var">check_universal</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056359"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
-&gt; [Validity' DeriveInstanceErrReason]
-&gt; [Validity' DeriveInstanceErrReason]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">FFoldType (Validity' DeriveInstanceErrReason)
-&gt; DataCon -&gt; DerivInstTys -&gt; [Validity' DeriveInstanceErrReason]
forall a. FFoldType a -&gt; DataCon -&gt; DerivInstTys -&gt; [a]
</span><a href="GHC.Tc.Deriv.Functor.html#foldDataConArgs"><span class="hs-identifier hs-var">foldDataConArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; FFoldType (Validity' DeriveInstanceErrReason)
</span><a href="#local-6989586621682056362"><span class="hs-identifier hs-var">ft_check</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056359"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056359"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><a href="#local-6989586621682056342"><span class="hs-identifier hs-var">dit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span>    </span><span class="annot"><a href="#local-6989586621682056360"><span class="hs-identifier hs-type">check_universal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceErrReason"><span class="hs-identifier hs-type">DeriveInstanceErrReason</span></a></span><span>
</span><span id="line-1127"></span><span>    </span><span id="local-6989586621682056360"><span class="annot"><span class="annottext">check_universal :: DataCon -&gt; Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056360"><span class="hs-identifier hs-var hs-var">check_universal</span></a></span></span><span> </span><span id="local-6989586621682056363"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056363"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-1128"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056341"><span class="hs-identifier hs-var">allowExQuantifiedLastTyVar</span></a></span><span>
</span><span id="line-1129"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span> </span><span class="hs-comment">-- See Note [DeriveFoldable with ExistentialQuantification]</span><span>
</span><span id="line-1130"></span><span>                </span><span class="hs-comment">-- in GHC.Tc.Deriv.Functor</span><span>
</span><span id="line-1131"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682056364"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682056364"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Type
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#last/GHC.List.html#last"><span class="hs-identifier hs-var">last</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; [Type]
Type -&gt; [Type]
</span><a href="GHC.Core.Type.html#tyConAppArgs"><span class="hs-identifier hs-var">tyConAppArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056363"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1132"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682056364"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; [TyVar] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056363"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1133"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621682056364"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Tc.Utils.TcType.html#exactTyCoVarsOfTypes"><span class="hs-identifier hs-var">exactTyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [Type]
</span><a href="GHC.Core.DataCon.html#dataConTheta"><span class="hs-identifier hs-var">dataConTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056363"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>   </span><span class="hs-comment">-- See Note [Check that the type variable is truly universal]</span><span>
</span><span id="line-1135"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1136"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
-&gt; [DeriveInstanceBadConstructor] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConstructor"><span class="hs-identifier hs-var">DerivErrBadConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConExistential"><span class="hs-identifier hs-var">DerivErrBadConExistential</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056363"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1137"></span><span>
</span><span id="line-1138"></span><span>    </span><span class="annot"><a href="#local-6989586621682056362"><span class="hs-identifier hs-type">ft_check</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Functor.html#FFoldType"><span class="hs-identifier hs-type">FFoldType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#Validity%27"><span class="hs-identifier hs-type">Validity'</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Errors.Types.html#DeriveInstanceErrReason"><span class="hs-identifier hs-type">DeriveInstanceErrReason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1139"></span><span>    </span><span id="local-6989586621682056362"><span class="annot"><span class="annottext">ft_check :: DataCon -&gt; FFoldType (Validity' DeriveInstanceErrReason)
</span><a href="#local-6989586621682056362"><span class="hs-identifier hs-var hs-var">ft_check</span></a></span></span><span> </span><span id="local-6989586621682056373"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056373"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Functor.html#FT"><span class="hs-identifier hs-type">FT</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_triv :: Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_triv"><span class="hs-identifier hs-var">ft_triv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_var :: Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_var"><span class="hs-identifier hs-var">ft_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1140"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_co_var :: Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_co_var"><span class="hs-identifier hs-var">ft_co_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
-&gt; [DeriveInstanceBadConstructor] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConstructor"><span class="hs-identifier hs-var">DerivErrBadConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConCovariant"><span class="hs-identifier hs-var">DerivErrBadConCovariant</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056373"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1141"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_fun :: Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_fun"><span class="hs-identifier hs-var">ft_fun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682056380"><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056380"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682056381"><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056381"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682056340"><span class="hs-identifier hs-var">allowFunctions</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056380"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
forall a. Validity' a -&gt; Validity' a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#andValid"><span class="hs-operator hs-var">`andValid`</span></a></span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056381"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1142"></span><span>                                                           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
-&gt; [DeriveInstanceBadConstructor] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConstructor"><span class="hs-identifier hs-var">DerivErrBadConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConFunTypes"><span class="hs-identifier hs-var">DerivErrBadConFunTypes</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056373"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1143"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_tup :: TyCon
-&gt; [Validity' DeriveInstanceErrReason]
-&gt; Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_tup"><span class="hs-identifier hs-var">ft_tup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682056384"><span class="annot"><span class="annottext">[Validity' DeriveInstanceErrReason]
</span><a href="#local-6989586621682056384"><span class="hs-identifier hs-var">xs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Validity' DeriveInstanceErrReason]
-&gt; Validity' DeriveInstanceErrReason
forall a. [Validity' a] -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#allValid"><span class="hs-identifier hs-var">allValid</span></a></span><span> </span><span class="annot"><span class="annottext">[Validity' DeriveInstanceErrReason]
</span><a href="#local-6989586621682056384"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1144"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_ty_app :: Type
-&gt; Type
-&gt; Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_ty_app"><span class="hs-identifier hs-var">ft_ty_app</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682056386"><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056386"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056386"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1145"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_bad_app :: Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_bad_app"><span class="hs-identifier hs-var">ft_bad_app</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">(DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason)
-&gt; DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
-&gt; [DeriveInstanceBadConstructor] -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConstructor"><span class="hs-identifier hs-var">DerivErrBadConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HasWildcard
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DataCon -&gt; DeriveInstanceBadConstructor
</span><a href="GHC.Tc.Errors.Types.html#DerivErrBadConWrongArg"><span class="hs-identifier hs-var">DerivErrBadConWrongArg</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682056373"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1146"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_forall :: TyVar
-&gt; Validity' DeriveInstanceErrReason
-&gt; Validity' DeriveInstanceErrReason
</span><a href="GHC.Tc.Deriv.Functor.html#ft_forall"><span class="hs-identifier hs-var">ft_forall</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682056390"><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056390"><span class="hs-identifier hs-var">x</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
</span><a href="#local-6989586621682056390"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1147"></span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-type">checkFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#Condition"><span class="hs-identifier hs-type">Condition</span></a></span><span>
</span><span id="line-1150"></span><span id="checkFlag"><span class="annot"><span class="annottext">checkFlag :: Extension -&gt; Condition
</span><a href="GHC.Tc.Deriv.Utils.html#checkFlag"><span class="hs-identifier hs-var hs-var">checkFlag</span></a></span></span><span> </span><span id="local-6989586621682056391"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682056391"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621682056392"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056392"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="annot"><span class="annottext">DerivInstTys
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1151"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682056391"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682056392"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Validity' DeriveInstanceErrReason
forall a. Validity' a
</span><a href="GHC.Utils.Error.html#IsValid"><span class="hs-identifier hs-var">IsValid</span></a></span><span>
</span><span id="line-1152"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason -&gt; Validity' DeriveInstanceErrReason
forall a. a -&gt; Validity' a
</span><a href="GHC.Utils.Error.html#NotValid"><span class="hs-identifier hs-var">NotValid</span></a></span><span> </span><span class="annot"><span class="annottext">DeriveInstanceErrReason
</span><a href="#local-6989586621682056393"><span class="hs-identifier hs-var">why</span></a></span><span>
</span><span id="line-1153"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1154"></span><span>    </span><span id="local-6989586621682056393"><span class="annot"><span class="annottext">why :: DeriveInstanceErrReason
</span><a href="#local-6989586621682056393"><span class="hs-identifier hs-var hs-var">why</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DeriveInstanceErrReason
</span><a href="GHC.Tc.Errors.Types.html#DerivErrLangExtRequired"><span class="hs-identifier hs-var">DerivErrLangExtRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682056395"><span class="hs-identifier hs-var">the_flag</span></a></span><span>
</span><span id="line-1155"></span><span>    </span><span id="local-6989586621682056395"><span class="annot"><span class="annottext">the_flag :: Extension
</span><a href="#local-6989586621682056395"><span class="hs-identifier hs-var hs-var">the_flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FlagSpec Extension -&gt; Extension
forall flag. FlagSpec flag -&gt; flag
</span><a href="GHC.Driver.Session.html#flagSpecFlag"><span class="hs-identifier hs-var">flagSpecFlag</span></a></span><span> </span><span class="annot"><span class="annottext">FlagSpec Extension
</span><a href="#local-6989586621682056397"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682056397"><span class="annot"><span class="annottext">FlagSpec Extension
</span><a href="#local-6989586621682056397"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FlagSpec Extension]
</span><a href="GHC.Driver.Session.html#xFlags"><span class="hs-identifier hs-var">xFlags</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FlagSpec Extension -&gt; Extension
forall flag. FlagSpec flag -&gt; flag
</span><a href="GHC.Driver.Session.html#flagSpecFlag"><span class="hs-identifier hs-var">flagSpecFlag</span></a></span><span> </span><span class="annot"><span class="annottext">FlagSpec Extension
</span><a href="#local-6989586621682056397"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; Extension -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682056391"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1156"></span><span>                 </span><span class="hs-special">[</span><span id="local-6989586621682056399"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682056399"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621682056399"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1157"></span><span>                 </span><span id="local-6989586621682056400"><span class="annot"><span class="annottext">[Extension]
</span><a href="#local-6989586621682056400"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; Extension
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkFlag&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Extension] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Extension]
</span><a href="#local-6989586621682056400"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1158"></span><span>
</span><span id="line-1159"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#std_class_via_coercible"><span class="hs-identifier hs-type">std_class_via_coercible</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1160"></span><span class="hs-comment">-- These standard classes can be derived for a newtype</span><span>
</span><span id="line-1161"></span><span class="hs-comment">-- using the coercible trick *even if no -XGeneralizedNewtypeDeriving</span><span>
</span><span id="line-1162"></span><span class="hs-comment">-- because giving so gives the same results as generating the boilerplate</span><span>
</span><span id="line-1163"></span><span id="std_class_via_coercible"><span class="annot"><span class="annottext">std_class_via_coercible :: Class -&gt; Bool
</span><a href="GHC.Tc.Deriv.Utils.html#std_class_via_coercible"><span class="hs-identifier hs-var hs-var">std_class_via_coercible</span></a></span></span><span> </span><span id="local-6989586621682056402"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056402"><span class="hs-identifier hs-var">clas</span></a></span></span><span>
</span><span id="line-1164"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique
</span><a href="GHC.Core.Class.html#classKey"><span class="hs-identifier hs-var">classKey</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056402"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; [Unique] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqClassKey"><span class="hs-identifier hs-var">eqClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#ordClassKey"><span class="hs-identifier hs-var">ordClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#ixClassKey"><span class="hs-identifier hs-var">ixClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#boundedClassKey"><span class="hs-identifier hs-var">boundedClassKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1165"></span><span>        </span><span class="hs-comment">-- Not Read/Show because they respect the type</span><span>
</span><span id="line-1166"></span><span>        </span><span class="hs-comment">-- Not Enum, because newtypes are never in Enum</span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#non_coercible_class"><span class="hs-identifier hs-type">non_coercible_class</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1170"></span><span class="annot"><span class="hs-comment">-- *Never* derive Read, Show, Typeable, Data, Generic, Generic1, Lift</span></span><span>
</span><span id="line-1171"></span><span class="hs-comment">-- by Coercible, even with -XGeneralizedNewtypeDeriving</span><span>
</span><span id="line-1172"></span><span class="hs-comment">-- Also, avoid Traversable, as the Coercible-derived instance and the &quot;normal&quot;-derived</span><span>
</span><span id="line-1173"></span><span class="hs-comment">-- instance behave differently if there's a non-lawful Applicative out there.</span><span>
</span><span id="line-1174"></span><span class="hs-comment">-- Besides, with roles, Coercible-deriving Traversable is ill-roled.</span><span>
</span><span id="line-1175"></span><span id="non_coercible_class"><span class="annot"><span class="annottext">non_coercible_class :: Class -&gt; Bool
</span><a href="GHC.Tc.Deriv.Utils.html#non_coercible_class"><span class="hs-identifier hs-var hs-var">non_coercible_class</span></a></span></span><span> </span><span id="local-6989586621682056403"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056403"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-1176"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique
</span><a href="GHC.Core.Class.html#classKey"><span class="hs-identifier hs-var">classKey</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056403"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; [Unique] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#readClassKey"><span class="hs-identifier hs-var">readClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#showClassKey"><span class="hs-identifier hs-var">showClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#dataClassKey"><span class="hs-identifier hs-var">dataClassKey</span></a></span><span>
</span><span id="line-1177"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#genClassKey"><span class="hs-identifier hs-var">genClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#gen1ClassKey"><span class="hs-identifier hs-var">gen1ClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#typeableClassKey"><span class="hs-identifier hs-var">typeableClassKey</span></a></span><span>
</span><span id="line-1178"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#traversableClassKey"><span class="hs-identifier hs-var">traversableClassKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.TH.html#liftClassKey"><span class="hs-identifier hs-var">liftClassKey</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1179"></span><span>
</span><span id="line-1180"></span><span class="hs-comment">------------------------------------------------------------------</span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#newDerivClsInst"><span class="hs-identifier hs-type">newDerivClsInst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DerivSpec"><span class="hs-identifier hs-type">DerivSpec</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span>
</span><span id="line-1183"></span><span id="newDerivClsInst"><span class="annot"><span class="annottext">newDerivClsInst :: DerivSpec [Type] -&gt; TcM ClsInst
</span><a href="GHC.Tc.Deriv.Utils.html#newDerivClsInst"><span class="hs-identifier hs-var hs-var">newDerivClsInst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#DS"><span class="hs-identifier hs-type">DS</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ds_name :: forall theta. DerivSpec theta -&gt; Name
</span><a href="GHC.Tc.Deriv.Utils.html#ds_name"><span class="hs-identifier hs-var">ds_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056405"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682056405"><span class="hs-identifier hs-var">dfun_name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_overlap :: forall theta. DerivSpec theta -&gt; Maybe OverlapMode
</span><a href="GHC.Tc.Deriv.Utils.html#ds_overlap"><span class="hs-identifier hs-var">ds_overlap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056406"><span class="annot"><span class="annottext">Maybe OverlapMode
</span><a href="#local-6989586621682056406"><span class="hs-identifier hs-var">overlap_mode</span></a></span></span><span>
</span><span id="line-1184"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_tvs :: forall theta. DerivSpec theta -&gt; [TyVar]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tvs"><span class="hs-identifier hs-var">ds_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056407"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682056407"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_theta :: forall theta. DerivSpec theta -&gt; theta
</span><a href="GHC.Tc.Deriv.Utils.html#ds_theta"><span class="hs-identifier hs-var">ds_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056408"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056408"><span class="hs-identifier hs-var">theta</span></a></span></span><span>
</span><span id="line-1185"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_cls :: forall theta. DerivSpec theta -&gt; Class
</span><a href="GHC.Tc.Deriv.Utils.html#ds_cls"><span class="hs-identifier hs-var">ds_cls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056409"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056409"><span class="hs-identifier hs-var">clas</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_tys :: forall theta. DerivSpec theta -&gt; [Type]
</span><a href="GHC.Tc.Deriv.Utils.html#ds_tys"><span class="hs-identifier hs-var">ds_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682056410"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056410"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe OverlapMode
-&gt; Name -&gt; [TyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcM ClsInst
</span><a href="GHC.Tc.Utils.Instantiate.html#newClsInst"><span class="hs-identifier hs-var">newClsInst</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe OverlapMode
</span><a href="#local-6989586621682056406"><span class="hs-identifier hs-var">overlap_mode</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682056405"><span class="hs-identifier hs-var">dfun_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621682056407"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056408"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682056409"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682056410"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span id="local-6989586621682055589"><span class="annot"><a href="GHC.Tc.Deriv.Utils.html#extendLocalInstEnv"><span class="hs-identifier hs-type">extendLocalInstEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055589"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682055589"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1189"></span><span class="hs-comment">-- Add new locally-defined instances; don't bother to check</span><span>
</span><span id="line-1190"></span><span class="hs-comment">-- for functional dependency errors -- that'll happen in GHC.Tc.TyCl.Instance</span><span>
</span><span id="line-1191"></span><span id="extendLocalInstEnv"><span class="annot"><span class="annottext">extendLocalInstEnv :: forall a. [ClsInst] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Deriv.Utils.html#extendLocalInstEnv"><span class="hs-identifier hs-var hs-var">extendLocalInstEnv</span></a></span></span><span> </span><span id="local-6989586621682056413"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682056413"><span class="hs-identifier hs-var">dfuns</span></a></span></span><span> </span><span id="local-6989586621682056414"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682056414"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1192"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682056415"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682056415"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1193"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>  </span><span id="local-6989586621682056417"><span class="annot"><span class="annottext">inst_env' :: InstEnv
</span><a href="#local-6989586621682056417"><span class="hs-identifier hs-var hs-var">inst_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnv -&gt; [ClsInst] -&gt; InstEnv
</span><a href="GHC.Core.InstEnv.html#extendInstEnvList"><span class="hs-identifier hs-var">extendInstEnvList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; InstEnv
</span><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682056415"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621682056413"><span class="hs-identifier hs-var">dfuns</span></a></span><span>
</span><span id="line-1194"></span><span>             </span><span id="local-6989586621682056420"><span class="annot"><span class="annottext">env' :: TcGblEnv
</span><a href="#local-6989586621682056420"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682056415"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682056417"><span class="hs-identifier hs-type">inst_env'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1195"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcM a -&gt; TcM a
forall gbl' lcl a gbl.
gbl' -&gt; TcRnIf gbl' lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682056420"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682056414"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span class="hs-comment">{-
Note [Deriving any class]
~~~~~~~~~~~~~~~~~~~~~~~~~
Classic uses of a deriving clause, or a standalone-deriving declaration, are
for:
  * a stock class like Eq or Show, for which GHC knows how to generate
    the instance code
  * a newtype, via the mechanism enabled by GeneralizedNewtypeDeriving

The DeriveAnyClass extension adds a third way to derive instances, based on
empty instance declarations.

The canonical use case is in combination with GHC.Generics and default method
signatures. These allow us to have instance declarations being empty, but still
useful, e.g.

  data T a = ...blah..blah... deriving( Generic )
  instance C a =&gt; C (T a)  -- No 'where' clause

where C is some &quot;random&quot; user-defined class.

This boilerplate code can be replaced by the more compact

  data T a = ...blah..blah... deriving( Generic, C )

if DeriveAnyClass is enabled.

This is not restricted to Generics; any class can be derived, simply giving
rise to an empty instance.

See Note [Gathering and simplifying constraints for DeriveAnyClass] in
GHC.Tc.Deriv.Infer for an explanation hof how the instance context is inferred for
DeriveAnyClass.

Note [Check that the type variable is truly universal]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For Functor and Traversable instances, we must check that the *last argument*
of the type constructor is used truly universally quantified.  Example

   data T a b where
     T1 :: a -&gt; b -&gt; T a b      -- Fine! Vanilla H-98
     T2 :: b -&gt; c -&gt; T a b      -- Fine! Existential c, but we can still map over 'b'
     T3 :: b -&gt; T Int b         -- Fine! Constraint 'a', but 'b' is still polymorphic
     T4 :: Ord b =&gt; b -&gt; T a b  -- No!  'b' is constrained
     T5 :: b -&gt; T b b           -- No!  'b' is constrained
     T6 :: T a (b,b)            -- No!  'b' is constrained

Notice that only the first of these constructors is vanilla H-98. We only
need to take care about the last argument (b in this case).  See #8678.
Eg. for T1-T3 we can write

     fmap f (T1 a b) = T1 a (f b)
     fmap f (T2 b c) = T2 (f b) c
     fmap f (T3 x)   = T3 (f x)

We need not perform these checks for Foldable instances, however, since
functions in Foldable can only consume existentially quantified type variables,
rather than produce them (as is the case in Functor and Traversable functions.)
As a result, T can have a derived Foldable instance:

    foldr f z (T1 a b) = f b z
    foldr f z (T2 b c) = f b z
    foldr f z (T3 x)   = f x z
    foldr f z (T4 x)   = f x z
    foldr f z (T5 x)   = f x z
    foldr _ z T6       = z

See Note [DeriveFoldable with ExistentialQuantification] in GHC.Tc.Deriv.Functor.

For Functor and Traversable, we must take care not to let type synonyms
unfairly reject a type for not being truly universally quantified. An
example of this is:

    type C (a :: Constraint) b = a
    data T a b = C (Show a) b =&gt; MkT b

Here, the existential context (C (Show a) b) does technically mention the last
type variable b. But this is OK, because expanding the type synonym C would give
us the context (Show a), which doesn't mention b. Therefore, we must make sure
to expand type synonyms before performing this check. Not doing so led to #13813.
-}</span><span>
</span><span id="line-1278"></span></pre></body></html>