<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecursiveDo #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Solver.Canonical</span><span class="hs-special">(</span><span>
</span><span id="line-7"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canonicalize"><span class="hs-identifier">canonicalize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier">unifyWanted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#makeSuperClasses"><span class="hs-identifier">makeSuperClasses</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier">StopOrContinue</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier">stopWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier">continueWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#andWhenContinue"><span class="hs-identifier">andWhenContinue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier">rewriteEqEvidence</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>     </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#solveCallStack"><span class="hs-identifier">solveCallStack</span></a></span><span>    </span><span class="hs-comment">-- For GHC.Tc.Solver</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html"><span class="hs-identifier">GHC.Core.Predicate</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Rewrite.html"><span class="hs-identifier">GHC.Tc.Solver.Rewrite</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html"><span class="hs-identifier">GHC.Tc.Solver.Monad</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.InertSet.html"><span class="hs-identifier">GHC.Tc.Solver.InertSet</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.EvTerm.html"><span class="hs-identifier">GHC.Tc.Types.EvTerm</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier">dataConName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>   </span><span class="hs-comment">-- cleverly decomposes types, good for completeness checking</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html"><span class="hs-identifier">GHC.Core.Reduction</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Id.html#mkTemplateLocals"><span class="hs-identifier">mkTemplateLocals</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier">FamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcTopNormaliseNewTypeTF_maybe"><span class="hs-identifier">tcTopNormaliseNewTypeTF_maybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier">mkInScopeSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#delVarSetList"><span class="hs-identifier">delVarSetList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#anyVarSet"><span class="hs-identifier">anyVarSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#anyTypeOfKind"><span class="hs-identifier">anyTypeOfKind</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html"><span class="hs-identifier">GHC.Hs.Type</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsIPName"><span class="hs-identifier">HsIPName</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#hasKey"><span class="hs-identifier">hasKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#coercibleTyConKey"><span class="hs-identifier">coercibleTyConKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html"><span class="hs-identifier">GHC.Data.Pair</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html"><span class="hs-identifier">GHC.Utils.Constants</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier">isJust</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#isNothing/Data.Maybe.html#isNothing"><span class="hs-identifier">isNothing</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#zip4/Data.OldList.html#zip4"><span class="hs-identifier">zip4</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Semigroup.html#/Data.Semigroup.html"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Bifunctor.html#/Data.Bifunctor.html"><span class="hs-identifier">Data.Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Bifunctor.html#bimap/Data.Bifunctor.html#bimap"><span class="hs-identifier">bimap</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
*                      The Canonicaliser                               *
*                                                                      *
************************************************************************

Note [Canonicalization]
~~~~~~~~~~~~~~~~~~~~~~~

Canonicalization converts a simple constraint to a canonical form. It is
unary (i.e. treats individual constraints one at a time).

Constraints originating from user-written code come into being as
CNonCanonicals. We know nothing about these constraints. So, first:

     Classify CNonCanoncal constraints, depending on whether they
     are equalities, class predicates, or other.

Then proceed depending on the shape of the constraint. Generally speaking,
each constraint gets rewritten and then decomposed into one of several forms
(see type Ct in GHC.Tc.Types).

When an already-canonicalized constraint gets kicked out of the inert set,
it must be recanonicalized. But we know a bit about its shape from the
last time through, so we can skip the classification step.

-}</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- Top-level canonicalization</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canonicalize"><span class="hs-identifier hs-type">canonicalize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span id="canonicalize"><span class="annot"><span class="annottext">canonicalize :: Ct -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canonicalize"><span class="hs-identifier hs-var hs-var">canonicalize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CNonCanonical"><span class="hs-identifier hs-type">CNonCanonical</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007731"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007731"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;canNC&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canNC"><span class="hs-identifier hs-var">canNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007731"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canonicalize"><span class="hs-identifier hs-var">canonicalize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-type">CQuantCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_ev :: QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007736"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007736"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pend_sc :: QCInst -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#qci_pend_sc"><span class="hs-identifier hs-var">qci_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007738"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007738"><span class="hs-identifier hs-var">pend_sc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canForAll"><span class="hs-identifier hs-var">canForAll</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007736"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007738"><span class="hs-identifier hs-var">pend_sc</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canonicalize"><span class="hs-identifier hs-var">canonicalize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CIrredCan"><span class="hs-identifier hs-type">CIrredCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007741"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007741"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canNC"><span class="hs-identifier hs-var">canNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007741"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-comment">-- Instead of rewriting the evidence before classifying, it's possible we</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- can make progress without the rewrite. Try this first.</span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-comment">-- For insolubles (all of which are equalities), do /not/ rewrite the arguments</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-comment">-- In #14350 doing so led entire-unnecessary and ridiculously large</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- type function expansion.  Instead, canEqNC just applies</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- the substitution to the predicate, and may do decomposition;</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">--    e.g. a ~ [a], where [G] a ~ [Int], can decompose</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canonicalize"><span class="hs-identifier hs-var">canonicalize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007743"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007743"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007745"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007745"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-117"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007747"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007747"><span class="hs-identifier hs-var">xis</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_pend_sc :: Ct -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cc_pend_sc"><span class="hs-identifier hs-var">cc_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007749"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007749"><span class="hs-identifier hs-var">pend_sc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;canClass&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="annottext">CtEvidence -&gt; Class -&gt; [Type] -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClass"><span class="hs-identifier hs-var">canClass</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007743"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007745"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007747"><span class="hs-identifier hs-var">xis</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007749"><span class="hs-identifier hs-var">pend_sc</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canonicalize"><span class="hs-identifier hs-var">canonicalize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007752"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007752"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-122"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: Ct -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007754"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682007754"><span class="hs-identifier hs-var">lhs</span></a></span></span><span>
</span><span id="line-123"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Ct -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007756"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007756"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-124"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: Ct -&gt; EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007758"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682007758"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;canEqLeafTyVarEq&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqNC"><span class="hs-identifier hs-var">canEqNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007752"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682007758"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682007754"><span class="hs-identifier hs-var">lhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007756"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canNC"><span class="hs-identifier hs-type">canNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span id="canNC"><span class="annot"><span class="annottext">canNC :: CtEvidence -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canNC"><span class="hs-identifier hs-var hs-var">canNC</span></a></span></span><span> </span><span id="local-6989586621682007761"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007761"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007763"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-131"></span><span>      </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621682007765"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007765"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007766"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007766"><span class="hs-identifier hs-var">tys</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEvNC:cls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007765"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007766"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>                                  </span><span class="annot"><span class="annottext">CtEvidence -&gt; Class -&gt; [Type] -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClassNC"><span class="hs-identifier hs-var">canClassNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007761"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007765"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007766"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span id="local-6989586621682007772"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682007772"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682007773"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007773"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682007774"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007774"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEvNC:eq&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007773"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007774"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>                                  </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqNC"><span class="hs-identifier hs-var">canEqNC</span></a></span><span>    </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007761"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682007772"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007773"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007774"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><a href="GHC.Core.Predicate.html#IrredPred"><span class="hs-identifier hs-type">IrredPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEvNC:irred&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007763"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>                                  </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canIrred"><span class="hs-identifier hs-var">canIrred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007761"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><a href="GHC.Core.Predicate.html#ForAllPred"><span class="hs-identifier hs-type">ForAllPred</span></a></span><span> </span><span id="local-6989586621682007779"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007779"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682007780"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007780"><span class="hs-identifier hs-var">th</span></a></span></span><span> </span><span id="local-6989586621682007781"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007781"><span class="hs-identifier hs-var">p</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEvNC:forall&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007763"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>                                  </span><span class="annot"><span class="annottext">CtEvidence
-&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canForAllNC"><span class="hs-identifier hs-var">canForAllNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007761"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007779"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007780"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007781"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621682007763"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621682007763"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007761"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
*                      Class Canonicalization
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canClassNC"><span class="hs-identifier hs-type">canClassNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- &quot;NC&quot; means &quot;non-canonical&quot;; that is, we have got here</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- from a NonCanonical constraint, not from a CDictCan</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- Precondition: EvVar is class evidence</span><span>
</span><span id="line-155"></span><span id="canClassNC"><span class="annot"><span class="annottext">canClassNC :: CtEvidence -&gt; Class -&gt; [Type] -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClassNC"><span class="hs-identifier hs-var hs-var">canClassNC</span></a></span></span><span> </span><span id="local-6989586621682007784"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682007785"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007785"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007786"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007786"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span>  </span><span class="hs-comment">-- See Note [Eagerly expand given superclasses]</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682007788"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682007788"><span class="hs-identifier hs-var">sc_cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mkStrictSuperClasses"><span class="hs-identifier hs-var">mkStrictSuperClasses</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007785"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007786"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-158"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682007788"><span class="hs-identifier hs-var">sc_cts</span></a></span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Class -&gt; [Type] -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClass"><span class="hs-identifier hs-var">canClass</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007785"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007786"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007793"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682007793"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682007794"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682007794"><span class="hs-identifier hs-var">ip_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Maybe FastString
</span><a href="GHC.Core.Predicate.html#isCallStackPred"><span class="hs-identifier hs-var">isCallStackPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007785"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007786"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Bool
</span><a href="GHC.Tc.Types.Origin.html#isPushCallStackOrigin"><span class="hs-identifier hs-var">isPushCallStackOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682007797"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-comment">-- If we're given a CallStack constraint that arose from a function</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-comment">-- call, we need to push the current call-site onto the stack instead</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-comment">-- of solving it directly from a given.</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-comment">-- See Note [Overview of implicit CallStacks] in GHC.Tc.Types.Evidence</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-comment">-- and Note [Solving CallStack constraints] in GHC.Tc.Solver.Types</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- First we emit a new constraint that will capture the</span><span>
</span><span id="line-170"></span><span>         </span><span class="hs-comment">-- given CallStack.</span><span>
</span><span id="line-171"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682007798"><span class="annot"><span class="annottext">new_loc :: CtLoc
</span><a href="#local-6989586621682007798"><span class="hs-identifier hs-var hs-var">new_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#setCtLocOrigin"><span class="hs-identifier hs-var">setCtLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007800"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsIPName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#IPOccOrigin"><span class="hs-identifier hs-var">IPOccOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; HsIPName
</span><a href="Language.Haskell.Syntax.Type.html#HsIPName"><span class="hs-identifier hs-var">HsIPName</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621682007794"><span class="hs-identifier hs-var">ip_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                            </span><span class="hs-comment">-- We change the origin to IPOccOrigin so</span><span>
</span><span id="line-173"></span><span>                            </span><span class="hs-comment">-- this rule does not fire again.</span><span>
</span><span id="line-174"></span><span>                            </span><span class="hs-comment">-- See Note [Overview of implicit CallStacks]</span><span>
</span><span id="line-175"></span><span>                            </span><span class="hs-comment">-- in GHC.Tc.Types.Evidence</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682007803"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007803"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-var">newWantedEvVarNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007798"><span class="hs-identifier hs-var">new_loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682007793"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007805"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>         </span><span class="hs-comment">-- Then we solve the wanted by pushing the call-site</span><span>
</span><span id="line-180"></span><span>         </span><span class="hs-comment">-- onto the newly emitted CallStack</span><span>
</span><span id="line-181"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682007806"><span class="annot"><span class="annottext">ev_cs :: EvCallStack
</span><a href="#local-6989586621682007806"><span class="hs-identifier hs-var hs-var">ev_cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; RealSrcSpan -&gt; EvExpr -&gt; EvCallStack
</span><a href="GHC.Tc.Types.Evidence.html#EvCsPushCall"><span class="hs-identifier hs-var">EvCsPushCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin -&gt; FastString
</span><a href="GHC.Tc.Types.Origin.html#callStackOriginFS"><span class="hs-identifier hs-var">callStackOriginFS</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682007797"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; RealSrcSpan
</span><a href="GHC.Tc.Types.Constraint.html#ctLocSpan"><span class="hs-identifier hs-var">ctLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007800"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CtEvidence -&gt; EvExpr
CtEvidence -&gt; EvExpr
</span><a href="GHC.Tc.Types.Constraint.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007803"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EvCallStack -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Canonical.html#solveCallStack"><span class="hs-identifier hs-var">solveCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EvCallStack
</span><a href="#local-6989586621682007806"><span class="hs-identifier hs-var">ev_cs</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Class -&gt; [Type] -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClass"><span class="hs-identifier hs-var">canClass</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007803"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007785"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007786"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- No superclasses</span><span>
</span><span id="line-186"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Class -&gt; [Type] -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClass"><span class="hs-identifier hs-var">canClass</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007785"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007786"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="#local-6989586621682007811"><span class="hs-identifier hs-var">has_scs</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007785"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621682007811"><span class="annot"><span class="annottext">has_scs :: Class -&gt; Bool
</span><a href="#local-6989586621682007811"><span class="hs-identifier hs-var hs-var">has_scs</span></a></span></span><span> </span><span id="local-6989586621682007813"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007813"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [Type]
</span><a href="GHC.Core.Class.html#classSCTheta"><span class="hs-identifier hs-var">classSCTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007813"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621682007800"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682007800"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621682007797"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621682007797"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007800"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621682007805"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621682007805"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007784"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#solveCallStack"><span class="hs-identifier hs-type">solveCallStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvCallStack"><span class="hs-identifier hs-type">EvCallStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span class="hs-comment">-- Also called from GHC.Tc.Solver when defaulting call stacks</span><span>
</span><span id="line-199"></span><span id="solveCallStack"><span class="annot"><span class="annottext">solveCallStack :: CtEvidence -&gt; EvCallStack -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Canonical.html#solveCallStack"><span class="hs-identifier hs-var hs-var">solveCallStack</span></a></span></span><span> </span><span id="local-6989586621682007819"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007819"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682007820"><span class="annot"><span class="annottext">EvCallStack
</span><a href="#local-6989586621682007820"><span class="hs-identifier hs-var">ev_cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-comment">-- We're given ev_cs :: CallStack, but the evidence term should be a</span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-comment">-- dictionary, so we have to coerce ev_cs to a dictionary for</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-comment">-- `IP ip CallStack`. See Note [Overview of implicit CallStacks]</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621682007821"><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621682007821"><span class="hs-identifier hs-var">cs_tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvCallStack -&gt; TcS EvExpr
forall (m :: * -&gt; *).
(MonadThings m, HasModule m, HasDynFlags m) =&gt;
EvCallStack -&gt; m EvExpr
</span><a href="GHC.Tc.Types.EvTerm.html#evCallStack"><span class="hs-identifier hs-var">evCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">EvCallStack
</span><a href="#local-6989586621682007820"><span class="hs-identifier hs-var">ev_cs</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682007823"><span class="annot"><span class="annottext">ev_tm :: EvTerm
</span><a href="#local-6989586621682007823"><span class="hs-identifier hs-var hs-var">ev_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#mkEvCast"><span class="hs-identifier hs-var">mkEvCast</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621682007821"><span class="hs-identifier hs-var">cs_tm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcCoercion
</span><a href="GHC.Tc.Types.Evidence.html#wrapIP"><span class="hs-identifier hs-var">wrapIP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007819"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="annottext">CtEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier hs-var">setEvBindIfWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007819"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621682007823"><span class="hs-identifier hs-var">ev_tm</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canClass"><span class="hs-identifier hs-type">canClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-208"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="hs-comment">-- True &lt;=&gt; un-explored superclasses</span><span>
</span><span id="line-210"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- Precondition: EvVar is class evidence</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span id="canClass"><span class="annot"><span class="annottext">canClass :: CtEvidence -&gt; Class -&gt; [Type] -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClass"><span class="hs-identifier hs-var hs-var">canClass</span></a></span></span><span> </span><span id="local-6989586621682007827"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007827"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682007828"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007828"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007829"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007829"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621682007830"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007830"><span class="hs-identifier hs-var">pend_sc</span></a></span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- all classes do *nominal* matching</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Role
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRole"><span class="hs-identifier hs-var">ctEvRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007827"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007827"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007828"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007829"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct))
-&gt; TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682007834"><span class="annot"><span class="annottext">redns :: Reductions
</span><a href="#local-6989586621682007834"><span class="hs-identifier hs-var">redns</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reductions"><span class="hs-identifier hs-type">Reductions</span></a></span><span> </span><span class="annot"><span class="annottext">[TcCoercion]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682007836"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007836"><span class="hs-identifier hs-var">xis</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682007837"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682007837"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TyCon -&gt; [Type] -&gt; TcS (Reductions, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewriteArgsNom"><span class="hs-identifier hs-var">rewriteArgsNom</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007827"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682007839"><span class="hs-identifier hs-var">cls_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007829"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-217"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682007840"><span class="annot"><span class="annottext">redn :: Reduction
</span><a href="#local-6989586621682007840"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682007842"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007842"><span class="hs-identifier hs-var">xi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Reductions -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkClassPredRedn"><span class="hs-identifier hs-var">mkClassPredRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007828"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Reductions
</span><a href="#local-6989586621682007834"><span class="hs-identifier hs-var">redns</span></a></span><span>
</span><span id="line-218"></span><span>             </span><span id="local-6989586621682007844"><span class="annot"><span class="annottext">mk_ct :: CtEvidence -&gt; Ct
</span><a href="#local-6989586621682007844"><span class="hs-identifier hs-var hs-var">mk_ct</span></a></span></span><span> </span><span id="local-6989586621682007845"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007845"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007845"><span class="hs-identifier hs-var">new_ev</span></a></span><span>
</span><span id="line-219"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007836"><span class="hs-identifier hs-var">xis</span></a></span><span>
</span><span id="line-220"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_class :: Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007828"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-221"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_pend_sc :: Bool
</span><a href="GHC.Tc.Types.Constraint.html#cc_pend_sc"><span class="hs-identifier hs-var">cc_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007830"><span class="hs-identifier hs-var">pend_sc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-222"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682007846"><span class="annot"><span class="annottext">StopOrContinue CtEvidence
</span><a href="#local-6989586621682007846"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence -&gt; Reduction -&gt; TcS (StopOrContinue CtEvidence)
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682007837"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007827"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682007840"><span class="hs-identifier hs-var">redn</span></a></span><span>
</span><span id="line-223"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canClass&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007827"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-224"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007842"><span class="hs-identifier hs-var">xi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StopOrContinue CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">StopOrContinue CtEvidence
</span><a href="#local-6989586621682007846"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">StopOrContinue Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct)
-&gt; StopOrContinue CtEvidence -&gt; StopOrContinue Ct
forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="#local-6989586621682007844"><span class="hs-identifier hs-var">mk_ct</span></a></span><span> </span><span class="annot"><span class="annottext">StopOrContinue CtEvidence
</span><a href="#local-6989586621682007846"><span class="hs-identifier hs-var">mb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621682007839"><span class="annot"><span class="annottext">cls_tc :: TyCon
</span><a href="#local-6989586621682007839"><span class="hs-identifier hs-var hs-var">cls_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007828"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">{- Note [The superclass story]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We need to add superclass constraints for two reasons:

* For givens [G], they give us a route to proof.  E.g.
    f :: Ord a =&gt; a -&gt; Bool
    f x = x == x
  We get a Wanted (Eq a), which can only be solved from the superclass
  of the Given (Ord a).

* For wanteds [W], they may give useful
  functional dependencies.  E.g.
     class C a b | a -&gt; b where ...
     class C a b =&gt; D a b where ...
  Now a [W] constraint (D Int beta) has (C Int beta) as a superclass
  and that might tell us about beta, via C's fundeps.  We can get this
  by generating a [W] (C Int beta) constraint. We won't use the evidence,
  but it may lead to unification.

See Note [Why adding superclasses can help].

For these reasons we want to generate superclass constraints for both
Givens and Wanteds. But:

* (Minor) they are often not needed, so generating them aggressively
  is a waste of time.

* (Major) if we want recursive superclasses, there would be an infinite
  number of them.  Here is a real-life example (#10318);

     class (Frac (Frac a) ~ Frac a,
            Fractional (Frac a),
            IntegralDomain (Frac a))
         =&gt; IntegralDomain a where
      type Frac a :: *

  Notice that IntegralDomain has an associated type Frac, and one
  of IntegralDomain's superclasses is another IntegralDomain constraint.

So here's the plan:

1. Eagerly generate superclasses for given (but not wanted)
   constraints; see Note [Eagerly expand given superclasses].
   This is done using mkStrictSuperClasses in canClassNC, when
   we take a non-canonical Given constraint and cannonicalise it.

   However stop if you encounter the same class twice.  That is,
   mkStrictSuperClasses expands eagerly, but has a conservative
   termination condition: see Note [Expanding superclasses] in GHC.Tc.Utils.TcType.

2. Solve the wanteds as usual, but do no further expansion of
   superclasses for canonical CDictCans in solveSimpleGivens or
   solveSimpleWanteds; Note [Danger of adding superclasses during solving]

   However, /do/ continue to eagerly expand superclasses for new /given/
   /non-canonical/ constraints (canClassNC does this).  As #12175
   showed, a type-family application can expand to a class constraint,
   and we want to see its superclasses for just the same reason as
   Note [Eagerly expand given superclasses].

3. If we have any remaining unsolved wanteds
        (see Note [When superclasses help] in GHC.Tc.Types.Constraint)
   try harder: take both the Givens and Wanteds, and expand
   superclasses again.  See the calls to expandSuperClasses in
   GHC.Tc.Solver.simpl_loop and solveWanteds.

   This may succeed in generating (a finite number of) extra Givens,
   and extra Wanteds. Both may help the proof.

3a An important wrinkle: only expand Givens from the current level.
   Two reasons:
      - We only want to expand it once, and that is best done at
        the level it is bound, rather than repeatedly at the leaves
        of the implication tree
      - We may be inside a type where we can't create term-level
        evidence anyway, so we can't superclass-expand, say,
        (a ~ b) to get (a ~# b).  This happened in #15290.

4. Go round to (2) again.  This loop (2,3,4) is implemented
   in GHC.Tc.Solver.simpl_loop.

The cc_pend_sc flag in a CDictCan records whether the superclasses of
this constraint have been expanded.  Specifically, in Step 3 we only
expand superclasses for constraints with cc_pend_sc set to true (i.e.
isPendingScDict holds).

Why do we do this?  Two reasons:

* To avoid repeated work, by repeatedly expanding the superclasses of
  same constraint,

* To terminate the above loop, at least in the -XNoUndecidableSuperClasses
  case.  If there are recursive superclasses we could, in principle,
  expand forever, always encountering new constraints.

When we take a CNonCanonical or CIrredCan, but end up classifying it
as a CDictCan, we set the cc_pend_sc flag to False.

Note [Superclass loops]
~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  class C a =&gt; D a
  class D a =&gt; C a

Then, when we expand superclasses, we'll get back to the self-same
predicate, so we have reached a fixpoint in expansion and there is no
point in fruitlessly expanding further.  This case just falls out from
our strategy.  Consider
  f :: C a =&gt; a -&gt; Bool
  f x = x==x
Then canClassNC gets the [G] d1: C a constraint, and eager emits superclasses
G] d2: D a, [G] d3: C a (psc).  (The &quot;psc&quot; means it has its sc_pend flag set.)
When processing d3 we find a match with d1 in the inert set, and we always
keep the inert item (d1) if possible: see Note [Replacement vs keeping] in
GHC.Tc.Solver.Interact.  So d3 dies a quick, happy death.

Note [Eagerly expand given superclasses]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In step (1) of Note [The superclass story], why do we eagerly expand
Given superclasses by one layer?  (By &quot;one layer&quot; we mean expand transitively
until you meet the same class again -- the conservative criterion embodied
in expandSuperClasses.  So a &quot;layer&quot; might be a whole stack of superclasses.)
We do this eagerly for Givens mainly because of some very obscure
cases like this:

   instance Bad a =&gt; Eq (T a)

   f :: (Ord (T a)) =&gt; blah
   f x = ....needs Eq (T a), Ord (T a)....

Here if we can't satisfy (Eq (T a)) from the givens we'll use the
instance declaration; but then we are stuck with (Bad a).  Sigh.
This is really a case of non-confluent proofs, but to stop our users
complaining we expand one layer in advance.

Note [Instance and Given overlap] in GHC.Tc.Solver.Interact.

We also want to do this if we have

   f :: F (T a) =&gt; blah

where
   type instance F (T a) = Ord (T a)

So we may need to do a little work on the givens to expose the
class that has the superclasses.  That's why the superclass
expansion for Givens happens in canClassNC.

This same scenario happens with quantified constraints, whose superclasses
are also eagerly expanded. Test case: typecheck/should_compile/T16502b
These are handled in canForAllNC, analogously to canClassNC.

Note [Why adding superclasses can help]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Examples of how adding superclasses can help:

    --- Example 1
        class C a b | a -&gt; b
    Suppose we want to solve
         [G] C a b
         [W] C a beta
    Then adding [W] beta~b will let us solve it.

    -- Example 2 (similar but using a type-equality superclass)
        class (F a ~ b) =&gt; C a b
    And try to sllve:
         [G] C a b
         [W] C a beta
    Follow the superclass rules to add
         [G] F a ~ b
         [W] F a ~ beta
    Now we get [W] beta ~ b, and can solve that.

    -- Example (tcfail138)
      class L a b | a -&gt; b
      class (G a, L a b) =&gt; C a b

      instance C a b' =&gt; G (Maybe a)
      instance C a b  =&gt; C (Maybe a) a
      instance L (Maybe a) a

    When solving the superclasses of the (C (Maybe a) a) instance, we get
      [G] C a b, and hence by superclasses, [G] G a, [G] L a b
      [W] G (Maybe a)
    Use the instance decl to get
      [W] C a beta
    Generate its superclass
      [W] L a beta.  Now using fundeps, combine with [G] L a b to get
      [W] beta ~ b
    which is what we want.

Note [Danger of adding superclasses during solving]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Here's a serious, but now out-dated example, from #4497:

   class Num (RealOf t) =&gt; Normed t
   type family RealOf x

Assume the generated wanted constraint is:
   [W] RealOf e ~ e
   [W] Normed e

If we were to be adding the superclasses during simplification we'd get:
   [W] RealOf e ~ e
   [W] Normed e
   [W] RealOf e ~ fuv
   [W] Num fuv
==&gt;
   e := fuv, Num fuv, Normed fuv, RealOf fuv ~ fuv

While looks exactly like our original constraint. If we add the
superclass of (Normed fuv) again we'd loop.  By adding superclasses
definitely only once, during canonicalisation, this situation can't
happen.

Note [Nested quantified constraint superclasses]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (typecheck/should_compile/T17202)

  class C1 a
  class (forall c. C1 c) =&gt; C2 a
  class (forall b. (b ~ F a) =&gt; C2 a) =&gt; C3 a

Elsewhere in the code, we get a [G] g1 :: C3 a. We expand its superclass
to get [G] g2 :: (forall b. (b ~ F a) =&gt; C2 a). This constraint has a
superclass, as well. But we now must be careful: we cannot just add
(forall c. C1 c) as a Given, because we need to remember g2's context.
That new constraint is Given only when forall b. (b ~ F a) is true.

It's tempting to make the new Given be (forall b. (b ~ F a) =&gt; forall c. C1 c),
but that's problematic, because it's nested, and ForAllPred is not capable
of representing a nested quantified constraint. (We could change ForAllPred
to allow this, but the solution in this Note is much more local and simpler.)

So, we swizzle it around to get (forall b c. (b ~ F a) =&gt; C1 c).

More generally, if we are expanding the superclasses of
  g0 :: forall tvs. theta =&gt; cls tys
and find a superclass constraint
  forall sc_tvs. sc_theta =&gt; sc_inner_pred
we must have a selector
  sel_id :: forall cls_tvs. cls cls_tvs -&gt; forall sc_tvs. sc_theta =&gt; sc_inner_pred
and thus build
  g_sc :: forall tvs sc_tvs. theta =&gt; sc_theta =&gt; sc_inner_pred
  g_sc = /\ tvs. /\ sc_tvs. \ theta_ids. \ sc_theta_ids.
         sel_id tys (g0 tvs theta_ids) sc_tvs sc_theta_ids

Actually, we cheat a bit by eta-reducing: note that sc_theta_ids are both the
last bound variables and the last arguments. This avoids the need to produce
the sc_theta_ids at all. So our final construction is

  g_sc = /\ tvs. /\ sc_tvs. \ theta_ids.
         sel_id tys (g0 tvs theta_ids) sc_tvs

  -}</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#makeSuperClasses"><span class="hs-identifier hs-type">makeSuperClasses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- Returns strict superclasses, transitively, see Note [The superclass story]</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- See Note [The superclass story]</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- The loop-breaking here follows Note [Expanding superclasses] in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- Specifically, for an incoming (C t) constraint, we return all of (C t)'s</span><span>
</span><span id="line-490"></span><span class="hs-comment">--    superclasses, up to /and including/ the first repetition of C</span><span>
</span><span id="line-491"></span><span class="hs-comment">--</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- Example:  class D a =&gt; C a</span><span>
</span><span id="line-493"></span><span class="hs-comment">--           class C [a] =&gt; D a</span><span>
</span><span id="line-494"></span><span class="hs-comment">-- makeSuperClasses (C x) will return (D x, C [x])</span><span>
</span><span id="line-495"></span><span class="hs-comment">--</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- NB: the incoming constraints have had their cc_pend_sc flag already</span><span>
</span><span id="line-497"></span><span class="hs-comment">--     flipped to False, by isPendingScDict, so we are /obliged/ to at</span><span>
</span><span id="line-498"></span><span class="hs-comment">--     least produce the immediate superclasses</span><span>
</span><span id="line-499"></span><span id="makeSuperClasses"><span class="annot"><span class="annottext">makeSuperClasses :: [Ct] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#makeSuperClasses"><span class="hs-identifier hs-var hs-var">makeSuperClasses</span></a></span></span><span> </span><span id="local-6989586621682007850"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682007850"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; TcS [Ct]) -&gt; [Ct] -&gt; TcS [Ct]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS [Ct]
</span><a href="#local-6989586621682007852"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682007850"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-501"></span><span>    </span><span id="local-6989586621682007852"><span class="annot"><span class="annottext">go :: Ct -&gt; TcS [Ct]
</span><a href="#local-6989586621682007852"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: Ct -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007860"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007860"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_class :: Ct -&gt; Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007861"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007861"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: Ct -&gt; [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007862"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007862"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mkStrictSuperClasses"><span class="hs-identifier hs-var">mkStrictSuperClasses</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007860"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007861"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007862"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><a href="#local-6989586621682007852"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-type">CQuantCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_pred :: QCInst -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#qci_pred"><span class="hs-identifier hs-var">qci_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007864"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007864"><span class="hs-identifier hs-var">pred</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_ev :: QCInst -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007865"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007865"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcS [Ct] -&gt; TcS [Ct]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isClassPred"><span class="hs-identifier hs-var">isClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007864"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007864"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS [Ct] -&gt; TcS [Ct]) -&gt; TcS [Ct] -&gt; TcS [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- The cts should all have</span><span>
</span><span id="line-505"></span><span>                                                   </span><span class="hs-comment">-- class pred heads</span><span>
</span><span id="line-506"></span><span>        </span><span class="annot"><span class="annottext">CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mkStrictSuperClasses"><span class="hs-identifier hs-var">mkStrictSuperClasses</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007865"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007867"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007868"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007869"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007870"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-507"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682007867"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007867"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682007868"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007868"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682007869"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007869"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682007870"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007870"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TcTyVar], [Type], Class, [Type])
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitDFunTy"><span class="hs-identifier hs-var">tcSplitDFunTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007865"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><a href="#local-6989586621682007852"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682007872"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682007872"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS [Ct]
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;makeSuperClasses&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682007872"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#mkStrictSuperClasses"><span class="hs-identifier hs-type">mkStrictSuperClasses</span></a></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span>  </span><span class="hs-comment">-- These two args are non-empty only when taking</span><span>
</span><span id="line-514"></span><span>                             </span><span class="hs-comment">-- superclasses of a /quantified/ constraint</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-516"></span><span class="hs-comment">-- Return constraints for the strict superclasses of</span><span>
</span><span id="line-517"></span><span class="hs-comment">--   ev :: forall as. theta =&gt; cls tys</span><span>
</span><span id="line-518"></span><span id="mkStrictSuperClasses"><span class="annot"><span class="annottext">mkStrictSuperClasses :: CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mkStrictSuperClasses"><span class="hs-identifier hs-var hs-var">mkStrictSuperClasses</span></a></span></span><span> </span><span id="local-6989586621682007876"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007876"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682007877"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007877"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682007878"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007878"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682007879"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007879"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007880"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007880"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet
-&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_strict_superclasses"><span class="hs-identifier hs-var">mk_strict_superclasses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#unitNameSet"><span class="hs-identifier hs-var">unitNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
</span><a href="GHC.Core.Class.html#className"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007879"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>                           </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007876"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007877"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007878"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007879"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007880"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#mk_strict_superclasses"><span class="hs-identifier hs-type">mk_strict_superclasses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-523"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span>
</span><span id="line-524"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- Always return the immediate superclasses of (cls tys);</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- and expand their superclasses, provided none of them are in rec_clss</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- nor are repeated</span><span>
</span><span id="line-528"></span><span id="mk_strict_superclasses"><span class="annot"><span class="annottext">mk_strict_superclasses :: NameSet
-&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_strict_superclasses"><span class="hs-identifier hs-var hs-var">mk_strict_superclasses</span></a></span></span><span> </span><span id="local-6989586621682007884"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007884"><span class="hs-identifier hs-var">rec_clss</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007887"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007887"><span class="hs-identifier hs-var">evar</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682007889"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007889"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>                       </span><span id="local-6989586621682007890"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007890"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682007891"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007891"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682007892"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007892"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007893"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007893"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; TcS [Ct]) -&gt; [TcTyVar] -&gt; TcS [Ct]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcS [Ct]
</span><a href="#local-6989586621682007894"><span class="hs-identifier hs-var">do_one_given</span></a></span><span> </span><span class="annot"><span class="annottext">([TcTyVar] -&gt; TcS [Ct]) -&gt; [TcTyVar] -&gt; TcS [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><span class="annottext">Class -&gt; [TcTyVar]
</span><a href="GHC.Core.Class.html#classSCSelIds"><span class="hs-identifier hs-var">classSCSelIds</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007892"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-533"></span><span>    </span><span id="local-6989586621682007896"><span class="annot"><span class="annottext">dict_ids :: [TcTyVar]
</span><a href="#local-6989586621682007896"><span class="hs-identifier hs-var hs-var">dict_ids</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [TcTyVar]
</span><a href="GHC.Types.Id.html#mkTemplateLocals"><span class="hs-identifier hs-var">mkTemplateLocals</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007891"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-534"></span><span>    </span><span id="local-6989586621682007897"><span class="annot"><span class="annottext">this_size :: PatersonSize
</span><a href="#local-6989586621682007897"><span class="hs-identifier hs-var hs-var">this_size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; PatersonSize
</span><a href="GHC.Tc.Utils.TcType.html#pSizeClassPred"><span class="hs-identifier hs-var">pSizeClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007892"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007893"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>    </span><span id="local-6989586621682007894"><span class="annot"><span class="annottext">do_one_given :: TcTyVar -&gt; TcS [Ct]
</span><a href="#local-6989586621682007894"><span class="hs-identifier hs-var hs-var">do_one_given</span></a></span></span><span> </span><span id="local-6989586621682007899"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007899"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Bool
Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007901"><span class="hs-identifier hs-var">sc_pred</span></a></span><span>
</span><span id="line-538"></span><span>         </span><span class="hs-comment">-- NB: class superclasses are never representation-polymorphic,</span><span>
</span><span id="line-539"></span><span>         </span><span class="hs-comment">-- so isUnliftedType is OK here.</span><span>
</span><span id="line-540"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007890"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007891"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Equality superclasses in quantified constraints]</span><span>
</span><span id="line-542"></span><span>        </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS [Ct]
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-543"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-544"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682007903"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007903"><span class="hs-identifier hs-var">given_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007905"><span class="hs-identifier hs-var">sc_loc</span></a></span><span> </span><span class="annot"><span class="annottext">((Type, EvTerm) -&gt; TcS CtEvidence)
-&gt; (Type, EvTerm) -&gt; TcS CtEvidence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-545"></span><span>                         </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; (Type, EvTerm)
</span><a href="#local-6989586621682007906"><span class="hs-identifier hs-var">mk_given_desc</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007899"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007901"><span class="hs-identifier hs-var">sc_pred</span></a></span><span>
</span><span id="line-546"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_superclasses"><span class="hs-identifier hs-var">mk_superclasses</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007884"><span class="hs-identifier hs-var">rec_clss</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007903"><span class="hs-identifier hs-var">given_ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007890"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007891"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007901"><span class="hs-identifier hs-var">sc_pred</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-547"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-548"></span><span>        </span><span id="local-6989586621682007901"><span class="annot"><span class="annottext">sc_pred :: Type
</span><a href="#local-6989586621682007901"><span class="hs-identifier hs-var hs-var">sc_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#classMethodInstTy"><span class="hs-identifier hs-var">classMethodInstTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007899"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007893"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-comment">-- See Note [Nested quantified constraint superclasses]</span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><a href="#local-6989586621682007906"><span class="hs-identifier hs-type">mk_given_desc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>    </span><span id="local-6989586621682007906"><span class="annot"><span class="annottext">mk_given_desc :: TcTyVar -&gt; Type -&gt; (Type, EvTerm)
</span><a href="#local-6989586621682007906"><span class="hs-identifier hs-var hs-var">mk_given_desc</span></a></span></span><span> </span><span id="local-6989586621682007911"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007911"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span id="local-6989586621682007912"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007912"><span class="hs-identifier hs-var">sc_pred</span></a></span></span><span>
</span><span id="line-553"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007913"><span class="hs-identifier hs-var">swizzled_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621682007914"><span class="hs-identifier hs-var">swizzled_evterm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-555"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682007915"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007915"><span class="hs-identifier hs-var">sc_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682007916"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007916"><span class="hs-identifier hs-var">sc_rho</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TcTyVar], Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVars"><span class="hs-identifier hs-var">splitForAllTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007912"><span class="hs-identifier hs-var">sc_pred</span></a></span><span>
</span><span id="line-556"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682007918"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682007918"><span class="hs-identifier hs-var">sc_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682007919"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007919"><span class="hs-identifier hs-var">sc_inner_pred</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Scaled Type], Type)
</span><a href="GHC.Core.Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007916"><span class="hs-identifier hs-var">sc_rho</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span>        </span><span id="local-6989586621682007921"><span class="annot"><span class="annottext">all_tvs :: [TcTyVar]
</span><a href="#local-6989586621682007921"><span class="hs-identifier hs-var hs-var">all_tvs</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007890"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007915"><span class="hs-identifier hs-var">sc_tvs</span></a></span><span>
</span><span id="line-559"></span><span>        </span><span id="local-6989586621682007923"><span class="annot"><span class="annottext">all_theta :: [Type]
</span><a href="#local-6989586621682007923"><span class="hs-identifier hs-var hs-var">all_theta</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007891"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682007918"><span class="hs-identifier hs-var">sc_theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>        </span><span id="local-6989586621682007913"><span class="annot"><span class="annottext">swizzled_pred :: Type
</span><a href="#local-6989586621682007913"><span class="hs-identifier hs-var hs-var">swizzled_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [Type] -&gt; Type -&gt; Type
(() :: Constraint) =&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#mkInfSigmaTy"><span class="hs-identifier hs-var">mkInfSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007921"><span class="hs-identifier hs-var">all_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007923"><span class="hs-identifier hs-var">all_theta</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007919"><span class="hs-identifier hs-var">sc_inner_pred</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-comment">-- evar :: forall tvs. theta =&gt; cls tys</span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-comment">-- sel_id :: forall cls_tvs. cls cls_tvs</span><span>
</span><span id="line-564"></span><span>        </span><span class="hs-comment">--                        -&gt; forall sc_tvs. sc_theta =&gt; sc_inner_pred</span><span>
</span><span id="line-565"></span><span>        </span><span class="hs-comment">-- swizzled_evterm :: forall tvs sc_tvs. theta =&gt; sc_theta =&gt; sc_inner_pred</span><span>
</span><span id="line-566"></span><span>        </span><span id="local-6989586621682007914"><span class="annot"><span class="annottext">swizzled_evterm :: EvTerm
</span><a href="#local-6989586621682007914"><span class="hs-identifier hs-var hs-var">swizzled_evterm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(EvExpr -&gt; EvTerm) -&gt; EvExpr -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-567"></span><span>          </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; EvExpr -&gt; EvExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007921"><span class="hs-identifier hs-var">all_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">(EvExpr -&gt; EvExpr) -&gt; EvExpr -&gt; EvExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-568"></span><span>          </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; EvExpr -&gt; EvExpr
forall b. [b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007896"><span class="hs-identifier hs-var">dict_ids</span></a></span><span> </span><span class="annot"><span class="annottext">(EvExpr -&gt; EvExpr) -&gt; EvExpr -&gt; EvExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-569"></span><span>          </span><span class="annot"><span class="annottext">TcTyVar -&gt; EvExpr
forall b. TcTyVar -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007911"><span class="hs-identifier hs-var">sel_id</span></a></span><span>
</span><span id="line-570"></span><span>            </span><span class="annot"><span class="annottext">EvExpr -&gt; [Type] -&gt; EvExpr
forall b. Expr b -&gt; [Type] -&gt; Expr b
</span><a href="GHC.Core.html#mkTyApps"><span class="hs-operator hs-var">`mkTyApps`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007893"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-571"></span><span>            </span><span class="annot"><span class="annottext">EvExpr -&gt; EvExpr -&gt; EvExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-operator hs-var">`App`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; EvExpr
</span><a href="GHC.Tc.Types.Evidence.html#evId"><span class="hs-identifier hs-var">evId</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007887"><span class="hs-identifier hs-var">evar</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; [TcTyVar] -&gt; EvExpr
forall b. Expr b -&gt; [TcTyVar] -&gt; Expr b
</span><a href="GHC.Core.html#mkVarApps"><span class="hs-operator hs-var">`mkVarApps`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007890"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; [TcTyVar] -&gt; [TcTyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007896"><span class="hs-identifier hs-var">dict_ids</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>            </span><span class="annot"><span class="annottext">EvExpr -&gt; [TcTyVar] -&gt; EvExpr
forall b. Expr b -&gt; [TcTyVar] -&gt; Expr b
</span><a href="GHC.Core.html#mkVarApps"><span class="hs-operator hs-var">`mkVarApps`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007915"><span class="hs-identifier hs-var">sc_tvs</span></a></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span>    </span><span id="local-6989586621682007905"><span class="annot"><span class="annottext">sc_loc :: CtLoc
</span><a href="#local-6989586621682007905"><span class="hs-identifier hs-var hs-var">sc_loc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isCTupleClass"><span class="hs-identifier hs-var">isCTupleClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007892"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-575"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007889"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="hs-comment">-- For tuple predicates, just take them apart, without</span><span>
</span><span id="line-576"></span><span>                   </span><span class="hs-comment">-- adding their (large) size into the chain.  When we</span><span>
</span><span id="line-577"></span><span>                   </span><span class="hs-comment">-- get down to a base predicate, we'll include its size.</span><span>
</span><span id="line-578"></span><span>                   </span><span class="hs-comment">-- #10335</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>           </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqPredClass"><span class="hs-identifier hs-var">isEqPredClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007892"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007892"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#coercibleTyConKey"><span class="hs-identifier hs-var">coercibleTyConKey</span></a></span><span>
</span><span id="line-581"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007889"><span class="hs-identifier hs-var">loc</span></a></span><span>   </span><span class="hs-comment">-- The only superclasses of ~, ~~, and Coercible are primitive</span><span>
</span><span id="line-582"></span><span>                   </span><span class="hs-comment">-- equalities, and they don't use the GivenSCOrigin mechanism</span><span>
</span><span id="line-583"></span><span>                   </span><span class="hs-comment">-- detailed in Note [Solving superclass constraints] in</span><span>
</span><span id="line-584"></span><span>                   </span><span class="hs-comment">-- GHC.Tc.TyCl.Instance. Skip for a tiny performance win.</span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-587"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007889"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctl_origin"><span class="hs-identifier hs-var">ctl_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682007937"><span class="hs-identifier hs-type">mk_sc_origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-type">ctLocOrigin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007889"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-comment">-- See Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance</span><span>
</span><span id="line-590"></span><span>    </span><span class="hs-comment">-- for explanation of GivenSCOrigin and Note [Replacement vs keeping] in</span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-comment">-- GHC.Tc.Solver.Interact for why we need depths</span><span>
</span><span id="line-592"></span><span>    </span><span class="annot"><a href="#local-6989586621682007937"><span class="hs-identifier hs-type">mk_sc_origin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621682007937"><span class="annot"><span class="annottext">mk_sc_origin :: CtOrigin -&gt; CtOrigin
</span><a href="#local-6989586621682007937"><span class="hs-identifier hs-var hs-var">mk_sc_origin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-type">GivenSCOrigin</span></a></span><span> </span><span id="local-6989586621682007939"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682007939"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span id="local-6989586621682007940"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682007940"><span class="hs-identifier hs-var">sc_depth</span></a></span></span><span> </span><span id="local-6989586621682007941"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007941"><span class="hs-identifier hs-var">already_blocked</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; Int -&gt; Bool -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-var">GivenSCOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682007939"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682007940"><span class="hs-identifier hs-var">sc_depth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Num.html#%2B/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007941"><span class="hs-identifier hs-var">already_blocked</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; Bool
</span><a href="#local-6989586621682007943"><span class="hs-identifier hs-var">newly_blocked</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682007939"><span class="hs-identifier hs-var">skol_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><a href="#local-6989586621682007937"><span class="hs-identifier hs-var">mk_sc_origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#GivenOrigin"><span class="hs-identifier hs-type">GivenOrigin</span></a></span><span> </span><span id="local-6989586621682007945"><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682007945"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- These cases do not already have a superclass constraint: depth starts at 1</span><span>
</span><span id="line-599"></span><span>        </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; Int -&gt; Bool -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#GivenSCOrigin"><span class="hs-identifier hs-var">GivenSCOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682007945"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; Bool
</span><a href="#local-6989586621682007943"><span class="hs-identifier hs-var">newly_blocked</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682007945"><span class="hs-identifier hs-var">skol_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>    </span><span class="annot"><a href="#local-6989586621682007937"><span class="hs-identifier hs-var">mk_sc_origin</span></a></span><span> </span><span id="local-6989586621682007946"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682007946"><span class="hs-identifier hs-var">other_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CtOrigin
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given constraint without given origin&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; CtOrigin) -&gt; SDoc -&gt; CtOrigin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-602"></span><span>                              </span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682007887"><span class="hs-identifier hs-var">evar</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621682007946"><span class="hs-identifier hs-var">other_orig</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621682007943"><span class="annot"><span class="annottext">newly_blocked :: SkolemInfoAnon -&gt; Bool
</span><a href="#local-6989586621682007943"><span class="hs-identifier hs-var hs-var">newly_blocked</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Origin.html#InstSkol"><span class="hs-identifier hs-type">InstSkol</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682007948"><span class="annot"><span class="annottext">PatersonSize
</span><a href="#local-6989586621682007948"><span class="hs-identifier hs-var">head_size</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PatersonSizeFailure -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatersonSize
</span><a href="#local-6989586621682007897"><span class="hs-identifier hs-var">this_size</span></a></span><span> </span><span class="annot"><span class="annottext">PatersonSize -&gt; PatersonSize -&gt; Maybe PatersonSizeFailure
</span><a href="GHC.Tc.Utils.TcType.html#ltPatersonSize"><span class="hs-operator hs-var">`ltPatersonSize`</span></a></span><span> </span><span class="annot"><span class="annottext">PatersonSize
</span><a href="#local-6989586621682007948"><span class="hs-identifier hs-var">head_size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><a href="#local-6989586621682007943"><span class="hs-identifier hs-var">newly_blocked</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#mk_strict_superclasses"><span class="hs-identifier hs-var">mk_strict_superclasses</span></a></span><span> </span><span id="local-6989586621682007950"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007950"><span class="hs-identifier hs-var">rec_clss</span></a></span></span><span> </span><span id="local-6989586621682007951"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007951"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682007952"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007952"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682007953"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007953"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682007954"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007954"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007955"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007955"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; [Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007955"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-609"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS [Ct]
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Wanteds with no variables yield no superclass constraints.</span><span>
</span><span id="line-610"></span><span>              </span><span class="hs-comment">-- See Note [Improvement from Ground Wanteds]</span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-comment">-- Wanted case, just add Wanted superclasses</span><span>
</span><span id="line-613"></span><span>              </span><span class="hs-comment">-- that can lead to improvement.</span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcS [Ct] -&gt; TcS [Ct]
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007952"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007953"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcTyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007952"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007953"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS [Ct] -&gt; TcS [Ct]) -&gt; TcS [Ct] -&gt; TcS [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><span class="annottext">(Type -&gt; TcS [Ct]) -&gt; [Type] -&gt; TcS [Ct]
forall (m :: * -&gt; *) (f :: * -&gt; *) a b.
(Monad m, Traversable f) =&gt;
(a -&gt; m [b]) -&gt; f a -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS [Ct]
</span><a href="#local-6989586621682007958"><span class="hs-identifier hs-var">do_one</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Tc.Utils.TcType.html#immSuperClasses"><span class="hs-identifier hs-var">immSuperClasses</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007954"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007955"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-617"></span><span>    </span><span id="local-6989586621682007960"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682007960"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007951"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (CtOrigin -&gt; CtOrigin) -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#updateCtLocOrigin"><span class="hs-operator hs-var">`updateCtLocOrigin`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; CtOrigin -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#WantedSuperclassOrigin"><span class="hs-identifier hs-var">WantedSuperclassOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007951"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>    </span><span id="local-6989586621682007958"><span class="annot"><span class="annottext">do_one :: Type -&gt; TcS [Ct]
</span><a href="#local-6989586621682007958"><span class="hs-identifier hs-var hs-var">do_one</span></a></span></span><span> </span><span id="local-6989586621682007963"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007963"><span class="hs-identifier hs-var">sc_pred</span></a></span></span><span>
</span><span id="line-620"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mk_strict_superclasses Wanted&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007954"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007955"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007963"><span class="hs-identifier hs-var">sc_pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682007965"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007965"><span class="hs-identifier hs-var">sc_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedNC"><span class="hs-identifier hs-var">newWantedNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682007960"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRewriters"><span class="hs-identifier hs-var">ctEvRewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007951"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007963"><span class="hs-identifier hs-var">sc_pred</span></a></span><span>
</span><span id="line-622"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_superclasses"><span class="hs-identifier hs-var">mk_superclasses</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007950"><span class="hs-identifier hs-var">rec_clss</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007965"><span class="hs-identifier hs-var">sc_ev</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007963"><span class="hs-identifier hs-var">sc_pred</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="hs-comment">{- Note [Improvement from Ground Wanteds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose class C b a =&gt; D a b
and consider
  [W] D Int Bool
Is there any point in emitting [W] C Bool Int?  No!  The only point of
emitting superclass constraints for W constraints is to get
improvement, extra unifications that result from functional
dependencies.  See Note [Why adding superclasses can help] above.

But no variables means no improvement; case closed.
-}</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#mk_superclasses"><span class="hs-identifier hs-type">mk_superclasses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-638"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-639"></span><span class="hs-comment">-- Return this constraint, plus its superclasses, if any</span><span>
</span><span id="line-640"></span><span id="mk_superclasses"><span class="annot"><span class="annottext">mk_superclasses :: NameSet -&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_superclasses"><span class="hs-identifier hs-var hs-var">mk_superclasses</span></a></span></span><span> </span><span id="local-6989586621682007968"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007968"><span class="hs-identifier hs-var">rec_clss</span></a></span></span><span> </span><span id="local-6989586621682007969"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007969"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682007970"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007970"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682007971"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007971"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682007972"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007972"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621682007973"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007973"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007974"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007974"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007972"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet
-&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_superclasses_of"><span class="hs-identifier hs-var">mk_superclasses_of</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007968"><span class="hs-identifier hs-var">rec_clss</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007969"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007970"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007971"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007973"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007974"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-comment">-- Superclass is not a class predicate</span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS [Ct]
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007969"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#mk_superclasses_of"><span class="hs-identifier hs-type">mk_superclasses_of</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-648"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-649"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span class="hs-comment">-- Always return this class constraint,</span><span>
</span><span id="line-651"></span><span class="hs-comment">-- and expand its superclasses</span><span>
</span><span id="line-652"></span><span id="mk_superclasses_of"><span class="annot"><span class="annottext">mk_superclasses_of :: NameSet
-&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_superclasses_of"><span class="hs-identifier hs-var hs-var">mk_superclasses_of</span></a></span></span><span> </span><span id="local-6989586621682007977"><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007977"><span class="hs-identifier hs-var">rec_clss</span></a></span></span><span> </span><span id="local-6989586621682007978"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007978"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682007979"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007979"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682007980"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007980"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682007981"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007982"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007982"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007983"><span class="hs-identifier hs-var">loop_found</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mk_superclasses_of: loop&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007982"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS [Ct]
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682007984"><span class="hs-identifier hs-var">this_ct</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- cc_pend_sc of this_ct = True</span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mk_superclasses_of&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007982"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-656"></span><span>                                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isCTupleClass"><span class="hs-identifier hs-var">isCTupleClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>                                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007977"><span class="hs-identifier hs-var">rec_clss</span></a></span><span>
</span><span id="line-658"></span><span>                                                          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>                    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682007985"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682007985"><span class="hs-identifier hs-var">sc_cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameSet
-&gt; CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mk_strict_superclasses"><span class="hs-identifier hs-var">mk_strict_superclasses</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007986"><span class="hs-identifier hs-var">rec_clss'</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007978"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007979"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007980"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007982"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-660"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS [Ct]
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621682007984"><span class="hs-identifier hs-var">this_ct</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; [Ct] -&gt; [Ct]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682007985"><span class="hs-identifier hs-var">sc_cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-661"></span><span>                                   </span><span class="hs-comment">-- cc_pend_sc of this_ct = False</span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-663"></span><span>    </span><span id="local-6989586621682007987"><span class="annot"><span class="annottext">cls_nm :: Name
</span><a href="#local-6989586621682007987"><span class="hs-identifier hs-var hs-var">cls_nm</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Name
</span><a href="GHC.Core.Class.html#className"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-664"></span><span>    </span><span id="local-6989586621682007983"><span class="annot"><span class="annottext">loop_found :: Bool
</span><a href="#local-6989586621682007983"><span class="hs-identifier hs-var hs-var">loop_found</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isCTupleClass"><span class="hs-identifier hs-var">isCTupleClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682007987"><span class="hs-identifier hs-var">cls_nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007977"><span class="hs-identifier hs-var">rec_clss</span></a></span><span>
</span><span id="line-665"></span><span>                 </span><span class="hs-comment">-- Tuples never contribute to recursion, and can be nested</span><span>
</span><span id="line-666"></span><span>    </span><span id="local-6989586621682007986"><span class="annot"><span class="annottext">rec_clss' :: NameSet
</span><a href="#local-6989586621682007986"><span class="hs-identifier hs-var hs-var">rec_clss'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621682007977"><span class="hs-identifier hs-var">rec_clss</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; Name -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-operator hs-var">`extendNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682007987"><span class="hs-identifier hs-var">cls_nm</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621682007984"><span class="annot"><span class="annottext">this_ct :: Ct
</span><a href="#local-6989586621682007984"><span class="hs-identifier hs-var hs-var">this_ct</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007979"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007980"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-669"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CDictCan"><span class="hs-identifier hs-type">CDictCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007978"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_class :: Class
</span><a href="GHC.Tc.Types.Constraint.html#cc_class"><span class="hs-identifier hs-var">cc_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_tyargs :: [Type]
</span><a href="GHC.Tc.Types.Constraint.html#cc_tyargs"><span class="hs-identifier hs-var">cc_tyargs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007982"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-670"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_pend_sc :: Bool
</span><a href="GHC.Tc.Types.Constraint.html#cc_pend_sc"><span class="hs-identifier hs-var">cc_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007983"><span class="hs-identifier hs-var">loop_found</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-671"></span><span>                 </span><span class="hs-comment">-- NB: If there is a loop, we cut off, so we have not</span><span>
</span><span id="line-672"></span><span>                 </span><span class="hs-comment">--     added the superclasses, hence cc_pend_sc = True</span><span>
</span><span id="line-673"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-674"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#CQuantCan"><span class="hs-identifier hs-var">CQuantCan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_tvs :: [TcTyVar]
</span><a href="GHC.Tc.Types.Constraint.html#qci_tvs"><span class="hs-identifier hs-var">qci_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682007979"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#qci_pred"><span class="hs-identifier hs-var">qci_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007981"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007982"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-675"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007978"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-676"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pend_sc :: Bool
</span><a href="GHC.Tc.Types.Constraint.html#qci_pend_sc"><span class="hs-identifier hs-var">qci_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682007983"><span class="hs-identifier hs-var">loop_found</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="hs-comment">{- Note [Equality superclasses in quantified constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#15359, #15593, #15625)
  f :: (forall a. theta =&gt; a ~ b) =&gt; stuff

It's a bit odd to have a local, quantified constraint for `(a~b)`,
but some people want such a thing (see the tickets). And for
Coercible it is definitely useful
  f :: forall m. (forall p q. Coercible p q =&gt; Coercible (m p) (m q)))
                 =&gt; stuff

Moreover it's not hard to arrange; we just need to look up /equality/
constraints in the quantified-constraint environment, which we do in
GHC.Tc.Solver.Interact.doTopReactOther.

There is a wrinkle though, in the case where 'theta' is empty, so
we have
  f :: (forall a. a~b) =&gt; stuff

Now, potentially, the superclass machinery kicks in, in
makeSuperClasses, giving us a a second quantified constraint
       (forall a. a ~# b)
BUT this is an unboxed value!  And nothing has prepared us for
dictionary &quot;functions&quot; that are unboxed.  Actually it does just
about work, but the simplifier ends up with stuff like
   case (/\a. eq_sel d) of df -&gt; ...(df @Int)...
and fails to simplify that any further.  And it doesn't satisfy
isPredTy any more.

So for now we simply decline to take superclasses in the quantified
case.  Instead we have a special case in GHC.Tc.Solver.Interact.doTopReactOther,
which looks for primitive equalities specially in the quantified
constraints.

See also Note [Evidence for quantified constraints] in GHC.Core.Predicate.


************************************************************************
*                                                                      *
*                      Irreducibles canonicalization
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canIrred"><span class="hs-identifier hs-type">canIrred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- Precondition: ty not a tuple and no other evidence form</span><span>
</span><span id="line-725"></span><span id="canIrred"><span class="annot"><span class="annottext">canIrred :: CtEvidence -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canIrred"><span class="hs-identifier hs-var hs-var">canIrred</span></a></span></span><span> </span><span id="local-6989586621682007991"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007991"><span class="hs-identifier hs-var">ev</span></a></span></span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682007992"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621682007992"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007991"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-727"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can_pred&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IrredPred = &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007992"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682007994"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682007994"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682007995"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682007995"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007991"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007992"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-729"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence -&gt; Reduction -&gt; TcS (StopOrContinue CtEvidence)
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682007995"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007991"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682007994"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue CtEvidence)
-&gt; (CtEvidence -&gt; TcS (StopOrContinue Ct))
-&gt; TcS (StopOrContinue Ct)
forall a b.
TcS (StopOrContinue a)
-&gt; (a -&gt; TcS (StopOrContinue b)) -&gt; TcS (StopOrContinue b)
</span><a href="GHC.Tc.Solver.Canonical.html#andWhenContinue"><span class="hs-operator hs-var">`andWhenContinue`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682007997"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007997"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Re-classify, in case rewriting has improved its shape</span><span>
</span><span id="line-732"></span><span>         </span><span class="hs-comment">-- Code is like the canNC, except</span><span>
</span><span id="line-733"></span><span>         </span><span class="hs-comment">-- that the IrredPred branch stops work</span><span>
</span><span id="line-734"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007997"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-735"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621682007998"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007998"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682007999"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007999"><span class="hs-identifier hs-var">tys</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Class -&gt; [Type] -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canClassNC"><span class="hs-identifier hs-var">canClassNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007997"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682007998"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682007999"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-736"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#EqPred"><span class="hs-identifier hs-type">EqPred</span></a></span><span> </span><span id="local-6989586621682008000"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008000"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008001"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008001"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008002"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008002"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- IrredPreds have kind Constraint, so</span><span>
</span><span id="line-737"></span><span>                                    </span><span class="hs-comment">-- cannot become EqPreds</span><span>
</span><span id="line-738"></span><span>                                    </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS (StopOrContinue Ct)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canIrred: EqPred&quot;</span></span><span>
</span><span id="line-739"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007991"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008000"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008001"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008002"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#ForAllPred"><span class="hs-identifier hs-type">ForAllPred</span></a></span><span> </span><span id="local-6989586621682008003"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008003"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682008004"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008004"><span class="hs-identifier hs-var">th</span></a></span></span><span> </span><span id="local-6989586621682008005"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008005"><span class="hs-identifier hs-var">p</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- this is highly suspect; Quick Look</span><span>
</span><span id="line-741"></span><span>                                    </span><span class="hs-comment">-- should never leave a meta-var filled</span><span>
</span><span id="line-742"></span><span>                                    </span><span class="hs-comment">-- in with a polytype. This is #18987.</span><span>
</span><span id="line-743"></span><span>                                    </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEvNC:forall&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682007992"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>                                       </span><span class="annot"><span class="annottext">CtEvidence
-&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canForAllNC"><span class="hs-identifier hs-var">canForAllNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007991"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008003"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008004"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008005"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-745"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#IrredPred"><span class="hs-identifier hs-type">IrredPred</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; TcS (StopOrContinue Ct)) -&gt; Ct -&gt; TcS (StopOrContinue Ct)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-746"></span><span>                                    </span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#IrredShapeReason"><span class="hs-identifier hs-var">IrredShapeReason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682007997"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span class="annot"><span class="hs-comment">{- *********************************************************************
*                                                                      *
*                      Quantified predicates
*                                                                      *
********************************************************************* -}</span></span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="hs-comment">{- Note [Quantified constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The -XQuantifiedConstraints extension allows type-class contexts like this:

  data Rose f x = Rose x (f (Rose f x))

  instance (Eq a, forall b. Eq b =&gt; Eq (f b))
        =&gt; Eq (Rose f a)  where
    (Rose x1 rs1) == (Rose x2 rs2) = x1==x2 &amp;&amp; rs1 == rs2

Note the (forall b. Eq b =&gt; Eq (f b)) in the instance contexts.
This quantified constraint is needed to solve the
 [W] (Eq (f (Rose f x)))
constraint which arises form the (==) definition.

The wiki page is
  https://gitlab.haskell.org/ghc/ghc/wikis/quantified-constraints
which in turn contains a link to the GHC Proposal where the change
is specified, and a Haskell Symposium paper about it.

We implement two main extensions to the design in the paper:

 1. We allow a variable in the instance head, e.g.
      f :: forall m a. (forall b. m b) =&gt; D (m a)
    Notice the 'm' in the head of the quantified constraint, not
    a class.

 2. We support superclasses to quantified constraints.
    For example (contrived):
      f :: (Ord b, forall b. Ord b =&gt; Ord (m b)) =&gt; m a -&gt; m a -&gt; Bool
      f x y = x==y
    Here we need (Eq (m a)); but the quantified constraint deals only
    with Ord.  But we can make it work by using its superclass.

Here are the moving parts
  * Language extension {-# LANGUAGE QuantifiedConstraints #-}
    and add it to ghc-boot-th:GHC.LanguageExtensions.Type.Extension

  * A new form of evidence, EvDFun, that is used to discharge
    such wanted constraints

  * checkValidType gets some changes to accept forall-constraints
    only in the right places.

  * Predicate.Pred gets a new constructor ForAllPred, and
    and classifyPredType analyses a PredType to decompose
    the new forall-constraints

  * GHC.Tc.Solver.Monad.InertCans gets an extra field, inert_insts,
    which holds all the Given forall-constraints.  In effect,
    such Given constraints are like local instance decls.

  * When trying to solve a class constraint, via
    GHC.Tc.Solver.Interact.matchInstEnv, use the InstEnv from inert_insts
    so that we include the local Given forall-constraints
    in the lookup.  (See GHC.Tc.Solver.Monad.getInstEnvs.)

  * GHC.Tc.Solver.Canonical.canForAll deals with solving a
    forall-constraint.  See
       Note [Solving a Wanted forall-constraint]

  * We augment the kick-out code to kick out an inert
    forall constraint if it can be rewritten by a new
    type equality; see GHC.Tc.Solver.Monad.kick_out_rewritable

Note that a quantified constraint is never /inferred/
(by GHC.Tc.Solver.simplifyInfer).  A function can only have a
quantified constraint in its type if it is given an explicit
type signature.

-}</span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canForAllNC"><span class="hs-identifier hs-type">canForAllNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span>
</span><span id="line-827"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span id="canForAllNC"><span class="annot"><span class="annottext">canForAllNC :: CtEvidence
-&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canForAllNC"><span class="hs-identifier hs-var hs-var">canForAllNC</span></a></span></span><span> </span><span id="local-6989586621682008010"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008010"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008011"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008011"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682008012"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008012"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682008013"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008013"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008010"><span class="hs-identifier hs-var">ev</span></a></span><span>  </span><span class="hs-comment">-- See Note [Eagerly expand given superclasses]</span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008014"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682008014"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008015"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008015"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Class, [Type])
</span><a href="#local-6989586621682008016"><span class="hs-identifier hs-var">cls_pred_tys_maybe</span></a></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008017"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682008017"><span class="hs-identifier hs-var">sc_cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; [TcTyVar] -&gt; [Type] -&gt; Class -&gt; [Type] -&gt; TcS [Ct]
</span><a href="GHC.Tc.Solver.Canonical.html#mkStrictSuperClasses"><span class="hs-identifier hs-var">mkStrictSuperClasses</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008010"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008011"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008012"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682008014"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008015"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-832"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWork"><span class="hs-identifier hs-var">emitWork</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621682008017"><span class="hs-identifier hs-var">sc_cts</span></a></span><span>
</span><span id="line-833"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canForAll"><span class="hs-identifier hs-var">canForAll</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008010"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canForAll"><span class="hs-identifier hs-var">canForAll</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008010"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Class, [Type]) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Class, [Type])
</span><a href="#local-6989586621682008016"><span class="hs-identifier hs-var">cls_pred_tys_maybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-839"></span><span>    </span><span id="local-6989586621682008016"><span class="annot"><span class="annottext">cls_pred_tys_maybe :: Maybe (Class, [Type])
</span><a href="#local-6989586621682008016"><span class="hs-identifier hs-var hs-var">cls_pred_tys_maybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Class, [Type])
</span><a href="GHC.Core.Predicate.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008013"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canForAll"><span class="hs-identifier hs-type">canForAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-842"></span><span class="hs-comment">-- We have a constraint (forall as. blah =&gt; C tys)</span><span>
</span><span id="line-843"></span><span id="canForAll"><span class="annot"><span class="annottext">canForAll :: CtEvidence -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canForAll"><span class="hs-identifier hs-var hs-var">canForAll</span></a></span></span><span> </span><span id="local-6989586621682008019"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008019"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008020"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008020"><span class="hs-identifier hs-var">pend_sc</span></a></span></span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- First rewrite it to apply the current substitution</span><span>
</span><span id="line-845"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008021"><span class="annot"><span class="annottext">pred :: Type
</span><a href="#local-6989586621682008021"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008019"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-846"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008022"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008022"><span class="hs-identifier hs-var">redn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008023"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008023"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008019"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008021"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-847"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence -&gt; Reduction -&gt; TcS (StopOrContinue CtEvidence)
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008023"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008019"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008022"><span class="hs-identifier hs-var">redn</span></a></span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue CtEvidence)
-&gt; (CtEvidence -&gt; TcS (StopOrContinue Ct))
-&gt; TcS (StopOrContinue Ct)
forall a b.
TcS (StopOrContinue a)
-&gt; (a -&gt; TcS (StopOrContinue b)) -&gt; TcS (StopOrContinue b)
</span><a href="GHC.Tc.Solver.Canonical.html#andWhenContinue"><span class="hs-operator hs-var">`andWhenContinue`</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682008024"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008024"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Now decompose into its pieces and solve it</span><span>
</span><span id="line-850"></span><span>         </span><span class="hs-comment">-- (It takes a lot less code to rewrite before decomposing.)</span><span>
</span><span id="line-851"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008024"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-852"></span><span>           </span><span class="annot"><a href="GHC.Core.Predicate.html#ForAllPred"><span class="hs-identifier hs-type">ForAllPred</span></a></span><span> </span><span id="local-6989586621682008025"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008025"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682008026"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008026"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682008027"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008027"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-853"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#solveForAll"><span class="hs-identifier hs-var">solveForAll</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008024"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008025"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008026"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008027"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008020"><span class="hs-identifier hs-var">pend_sc</span></a></span><span>
</span><span id="line-854"></span><span>           </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS (StopOrContinue Ct)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canForAll&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008024"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#solveForAll"><span class="hs-identifier hs-type">solveForAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-858"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span id="solveForAll"><span class="annot"><span class="annottext">solveForAll :: CtEvidence
-&gt; [TcTyVar] -&gt; [Type] -&gt; Type -&gt; Bool -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#solveForAll"><span class="hs-identifier hs-var hs-var">solveForAll</span></a></span></span><span> </span><span id="local-6989586621682008029"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621682008029"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008031"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008031"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008032"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008032"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008033"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008033"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>            </span><span id="local-6989586621682008034"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008034"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682008035"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008035"><span class="hs-identifier hs-var">theta</span></a></span></span><span> </span><span id="local-6989586621682008036"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008036"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621682008037"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008037"><span class="hs-identifier hs-var">_pend_sc</span></a></span></span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Solving a Wanted forall-constraint]</span><span>
</span><span id="line-862"></span><span>    </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct)
forall a. TcLclEnv -&gt; TcS a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.Constraint.html#ctLocEnv"><span class="hs-identifier hs-var">ctLocEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008033"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct))
-&gt; TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-comment">-- This setLclEnv is important: the emitImplicationTcS uses that</span><span>
</span><span id="line-864"></span><span>    </span><span class="hs-comment">-- TcLclEnv for the implication, and that in turn sets the location</span><span>
</span><span id="line-865"></span><span>    </span><span class="hs-comment">-- for the Givens when solving the constraint (#21006)</span><span>
</span><span id="line-866"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008040"><span class="annot"><span class="annottext">empty_subst :: Subst
</span><a href="#local-6989586621682008040"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Subst) -&gt; InScopeSet -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; InScopeSet) -&gt; VarSet -&gt; InScopeSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-867"></span><span>                           </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008036"><span class="hs-identifier hs-var">pred</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008035"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; [TcTyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#delVarSetList"><span class="hs-operator hs-var">`delVarSetList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008034"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-868"></span><span>             </span><span id="local-6989586621682008043"><span class="annot"><span class="annottext">is_qc :: ClsInstOrQC
</span><a href="#local-6989586621682008043"><span class="hs-identifier hs-var hs-var">is_qc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; ClsInstOrQC
</span><a href="GHC.Tc.Types.Origin.html#IsQC"><span class="hs-identifier hs-var">IsQC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008033"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span>         </span><span class="hs-comment">-- rec {..}: see Note [Keeping SkolemInfo inside a SkolemTv]</span><span>
</span><span id="line-871"></span><span>         </span><span class="hs-comment">--           in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-872"></span><span>         </span><span class="hs-comment">-- Very like the code in tcSkolDFunType</span><span>
</span><span id="line-873"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">rec</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008045"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008045"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; TcS SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon
</span><a href="#local-6989586621682008047"><span class="hs-identifier hs-var">skol_info_anon</span></a></span><span>
</span><span id="line-874"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008048"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008048"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008049"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008049"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; Subst -&gt; [TcTyVar] -&gt; TcS (Subst, [TcTyVar])
</span><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008045"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008040"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008034"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-875"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008051"><span class="annot"><span class="annottext">inst_pred :: Type
</span><a href="#local-6989586621682008051"><span class="hs-identifier hs-var hs-var">inst_pred</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span>    </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008048"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008036"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-876"></span><span>                   </span><span id="local-6989586621682008053"><span class="annot"><span class="annottext">inst_theta :: [Type]
</span><a href="#local-6989586621682008053"><span class="hs-identifier hs-var hs-var">inst_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; [Type] -&gt; [Type]
Subst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008048"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008035"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-877"></span><span>                   </span><span id="local-6989586621682008047"><span class="annot"><span class="annottext">skol_info_anon :: SkolemInfoAnon
</span><a href="#local-6989586621682008047"><span class="hs-identifier hs-var hs-var">skol_info_anon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC -&gt; PatersonSize -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#InstSkol"><span class="hs-identifier hs-var">InstSkol</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC
</span><a href="#local-6989586621682008043"><span class="hs-identifier hs-var">is_qc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; PatersonSize
</span><a href="#local-6989586621682008055"><span class="hs-identifier hs-var">get_size</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008051"><span class="hs-identifier hs-var">inst_pred</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008056"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008056"><span class="hs-identifier hs-var">given_ev_vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcS TcTyVar) -&gt; [Type] -&gt; TcS [TcTyVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcS TcTyVar
</span><a href="GHC.Tc.Solver.Monad.html#newEvVar"><span class="hs-identifier hs-var">newEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008053"><span class="hs-identifier hs-var">inst_theta</span></a></span><span>
</span><span id="line-880"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008059"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682008059"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008060"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008060"><span class="hs-identifier hs-var">w_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008061"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008061"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcS (TcTyVar, Bag Ct) -&gt; TcS (TcLevel, (TcTyVar, Bag Ct))
forall a. SDoc -&gt; TcS a -&gt; TcS (TcLevel, a)
</span><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier hs-var">pushLevelNoWorkList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemInfo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008045"><span class="hs-identifier hs-var">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (TcTyVar, Bag Ct) -&gt; TcS (TcLevel, (TcTyVar, Bag Ct)))
-&gt; TcS (TcTyVar, Bag Ct) -&gt; TcS (TcLevel, (TcTyVar, Bag Ct))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-882"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008063"><span class="annot"><span class="annottext">loc' :: CtLoc
</span><a href="#local-6989586621682008063"><span class="hs-identifier hs-var hs-var">loc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtOrigin -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#setCtLocOrigin"><span class="hs-identifier hs-var">setCtLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008033"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInstOrQC -&gt; NakedScFlag -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ScOrigin"><span class="hs-identifier hs-var">ScOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInstOrQC
</span><a href="#local-6989586621682008043"><span class="hs-identifier hs-var">is_qc</span></a></span><span> </span><span class="annot"><span class="annottext">NakedScFlag
</span><a href="GHC.Tc.Types.Origin.html#NakedSc"><span class="hs-identifier hs-var">NakedSc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>                         </span><span class="hs-comment">-- Set the thing to prove to have a ScOrigin, so we are</span><span>
</span><span id="line-884"></span><span>                         </span><span class="hs-comment">-- careful about its termination checks.</span><span>
</span><span id="line-885"></span><span>                         </span><span class="hs-comment">-- See (QC-INV) in Note [Solving a Wanted forall-constraint]</span><span>
</span><span id="line-886"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008066"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008066"><span class="hs-identifier hs-var">wanted_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEvVarNC"><span class="hs-identifier hs-var">newWantedEvVarNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008063"><span class="hs-identifier hs-var">loc'</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008032"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008051"><span class="hs-identifier hs-var">inst_pred</span></a></span><span>
</span><span id="line-887"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TcTyVar, Bag Ct) -&gt; TcS (TcTyVar, Bag Ct)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctEvEvId"><span class="hs-identifier hs-var">ctEvEvId</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008066"><span class="hs-identifier hs-var">wanted_ev</span></a></span><span>
</span><span id="line-888"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008066"><span class="hs-identifier hs-var">wanted_ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008069"><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621682008069"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLevel
-&gt; SkolemInfoAnon
-&gt; [TcTyVar]
-&gt; [TcTyVar]
-&gt; Bag Ct
-&gt; TcS TcEvBinds
</span><a href="GHC.Tc.Solver.Monad.html#emitImplicationTcS"><span class="hs-identifier hs-var">emitImplicationTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682008059"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemInfo -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#getSkolemInfo"><span class="hs-identifier hs-var">getSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008045"><span class="hs-identifier hs-var">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008049"><span class="hs-identifier hs-var">skol_tvs</span></a></span><span>
</span><span id="line-891"></span><span>                                       </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008056"><span class="hs-identifier hs-var">given_ev_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008061"><span class="hs-identifier hs-var">wanteds</span></a></span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcEvDest -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008031"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">(EvTerm -&gt; TcS ()) -&gt; EvTerm -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-894"></span><span>        </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvFun"><span class="hs-identifier hs-type">EvFun</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">et_tvs :: [TcTyVar]
</span><a href="GHC.Tc.Types.Evidence.html#et_tvs"><span class="hs-identifier hs-var">et_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008049"><span class="hs-identifier hs-var">skol_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">et_given :: [TcTyVar]
</span><a href="GHC.Tc.Types.Evidence.html#et_given"><span class="hs-identifier hs-var">et_given</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008056"><span class="hs-identifier hs-var">given_ev_vars</span></a></span><span>
</span><span id="line-895"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">et_binds :: TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#et_binds"><span class="hs-identifier hs-var">et_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621682008069"><span class="hs-identifier hs-var">ev_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">et_body :: TcTyVar
</span><a href="GHC.Tc.Types.Evidence.html#et_body"><span class="hs-identifier hs-var">et_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008060"><span class="hs-identifier hs-var">w_id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008029"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wanted forall-constraint&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-comment">-- Getting the size of the head is a bit horrible</span><span>
</span><span id="line-900"></span><span>    </span><span class="hs-comment">-- because of the special treament for class predicates</span><span>
</span><span id="line-901"></span><span>    </span><span id="local-6989586621682008055"><span class="annot"><span class="annottext">get_size :: Type -&gt; PatersonSize
</span><a href="#local-6989586621682008055"><span class="hs-identifier hs-var hs-var">get_size</span></a></span></span><span> </span><span id="local-6989586621682008078"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008078"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><a href="GHC.Core.Predicate.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008078"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-902"></span><span>                      </span><span class="annot"><a href="GHC.Core.Predicate.html#ClassPred"><span class="hs-identifier hs-type">ClassPred</span></a></span><span> </span><span id="local-6989586621682008079"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682008079"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621682008080"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008080"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; PatersonSize
</span><a href="GHC.Tc.Utils.TcType.html#pSizeClassPred"><span class="hs-identifier hs-var">pSizeClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621682008079"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008080"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-903"></span><span>                      </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; PatersonSize
</span><a href="GHC.Tc.Utils.TcType.html#pSizeType"><span class="hs-identifier hs-var">pSizeType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008078"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span> </span><span class="hs-comment">-- See Note [Solving a Given forall-constraint]</span><span>
</span><span id="line-906"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#solveForAll"><span class="hs-identifier hs-var">solveForAll</span></a></span><span> </span><span id="local-6989586621682008082"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621682008082"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008083"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008083"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621682008084"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008084"><span class="hs-identifier hs-var">_theta</span></a></span></span><span> </span><span id="local-6989586621682008085"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008085"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621682008086"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008086"><span class="hs-identifier hs-var">pend_sc</span></a></span></span><span>
</span><span id="line-907"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">QCInst -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#addInertForAll"><span class="hs-identifier hs-var">addInertForAll</span></a></span><span> </span><span class="annot"><span class="annottext">QCInst
</span><a href="#local-6989586621682008088"><span class="hs-identifier hs-var">qci</span></a></span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008082"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Given forall-constraint&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-910"></span><span>    </span><span id="local-6989586621682008088"><span class="annot"><span class="annottext">qci :: QCInst
</span><a href="#local-6989586621682008088"><span class="hs-identifier hs-var hs-var">qci</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#QCI"><span class="hs-identifier hs-type">QCI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">qci_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#qci_ev"><span class="hs-identifier hs-var">qci_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008082"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_tvs :: [TcTyVar]
</span><a href="GHC.Tc.Types.Constraint.html#qci_tvs"><span class="hs-identifier hs-var">qci_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008083"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-911"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pred :: Type
</span><a href="GHC.Tc.Types.Constraint.html#qci_pred"><span class="hs-identifier hs-var">qci_pred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008085"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">qci_pend_sc :: Bool
</span><a href="GHC.Tc.Types.Constraint.html#qci_pend_sc"><span class="hs-identifier hs-var">qci_pend_sc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008086"><span class="hs-identifier hs-var">pend_sc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="hs-comment">{- Note [Solving a Wanted forall-constraint]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Solving a wanted forall (quantified) constraint
  [W] df :: forall ab. (Eq a, Ord b) =&gt; C x a b
is delightfully easy.   Just build an implication constraint
    forall ab. (g1::Eq a, g2::Ord b) =&gt; [W] d :: C x a
and discharge df thus:
    df = /\ab. \g1 g2. let &lt;binds&gt; in d
where &lt;binds&gt; is filled in by solving the implication constraint.
All the machinery is to hand; there is little to do.

The tricky point is about termination: see #19690.  We want to maintain
the invariant (QC-INV):

  (QC-INV) Every quantified constraint returns a non-bottom dictionary

just as every top-level instance declaration guarantees to return a non-bottom
dictionary.  But as #19690 shows, it is possible to get a bottom dicionary
by superclass selection if we aren't careful.  The situation is very similar
to that described in Note [Recursive superclasses] in GHC.Tc.TyCl.Instance;
and we use the same solution:

* Give the Givens a CtOrigin of (GivenOrigin (InstSkol IsQC head_size))
* Give the Wanted a CtOrigin of (ScOrigin IsQC NakedSc)

Both of these things are done in solveForAll.  Now the mechanism described
in Note [Solving superclass constraints] in GHC.Tc.TyCl.Instance takes over.

Note [Solving a Given forall-constraint]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For a Given constraint
  [G] df :: forall ab. (Eq a, Ord b) =&gt; C x a b
we just add it to TcS's local InstEnv of known instances,
via addInertForall.  Then, if we look up (C x Int Bool), say,
we'll find a match in the InstEnv.

************************************************************************
*                                                                      *
*        Equalities
*                                                                      *
************************************************************************

Note [Canonicalising equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In order to canonicalise an equality, we look at the structure of the
two types at hand, looking for similarities. A difficulty is that the
types may look dissimilar before rewriting but similar after rewriting.
However, we don't just want to jump in and rewrite right away, because
this might be wasted effort. So, after looking for similarities and failing,
we rewrite and then try again. Of course, we don't want to loop, so we
track whether or not we've already rewritten.

It is conceivable to do a better job at tracking whether or not a type
is rewritten, but this is left as future work. (Mar '15)

Note [Decomposing FunTy]
~~~~~~~~~~~~~~~~~~~~~~~~
can_eq_nc' may attempt to decompose a FunTy that is un-zonked.  This
means that we may very well have a FunTy containing a type of some
unknown kind. For instance, we may have,

    FunTy (a :: k) Int

Where k is a unification variable. So the calls to splitRuntimeRep_maybe may
fail (returning Nothing).  In that case we'll fall through, zonk, and try again.
Zonking should fill the variable k, meaning that decomposition will succeed the
second time around.

Also note that we require the FunTyFlag to match.  This will stop
us decomposing
   (Int -&gt; Bool)  ~  (Show a =&gt; blah)
It's as if we treat (-&gt;) and (=&gt;) as different type constructors, which
indeed they are!
-}</span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqNC"><span class="hs-identifier hs-type">canEqNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span id="canEqNC"><span class="annot"><span class="annottext">canEqNC :: CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqNC"><span class="hs-identifier hs-var hs-var">canEqNC</span></a></span></span><span> </span><span id="local-6989586621682008089"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008089"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008090"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008090"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008091"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008091"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008092"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008092"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-990"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008093"><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008093"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="GHC.Tc.Solver.Canonical.html#zonk_eq_types"><span class="hs-identifier hs-var">zonk_eq_types</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008091"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008092"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-991"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008093"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-992"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682008095"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008095"><span class="hs-identifier hs-var">ty</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqReflexive"><span class="hs-identifier hs-var">canEqReflexive</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008089"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008090"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008095"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-993"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682008098"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008098"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span> </span><span id="local-6989586621682008099"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008099"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc"><span class="hs-identifier hs-var">can_eq_nc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008101"><span class="hs-identifier hs-var">ev'</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008090"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008098"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008098"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008099"><span class="hs-identifier hs-var">ty2'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008099"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-994"></span><span>             </span><span class="hs-keyword">where</span><span>
</span><span id="line-995"></span><span>               </span><span id="local-6989586621682008101"><span class="annot"><span class="annottext">ev' :: CtEvidence
</span><a href="#local-6989586621682008101"><span class="hs-identifier hs-var hs-var">ev'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Constants.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CtEvidence -&gt; Type -&gt; CtEvidence
CtEvidence -&gt; Type -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#setCtEvPredType"><span class="hs-identifier hs-var">setCtEvPredType</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008089"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; CtEvidence) -&gt; Type -&gt; CtEvidence
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-996"></span><span>                                 </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008090"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008098"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008099"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-997"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008089"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-998"></span><span>                   </span><span class="hs-comment">-- ev': satisfy the precondition of can_eq_nc</span><span>
</span><span id="line-999"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc"><span class="hs-identifier hs-type">can_eq_nc</span></a></span><span>
</span><span id="line-1002"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="hs-comment">-- True =&gt; both types are rewritten</span><span>
</span><span id="line-1003"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-1004"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-1005"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="hs-comment">-- LHS, after and before type-synonym expansion, resp</span><span>
</span><span id="line-1006"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="hs-comment">-- RHS, after and before type-synonym expansion, resp</span><span>
</span><span id="line-1007"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span class="hs-comment">-- Precondition: in DEBUG mode, the `ctev_pred` of `ev` is (ps_ty1 ~# ps_ty2),</span><span>
</span><span id="line-1009"></span><span class="hs-comment">--               without zonking</span><span>
</span><span id="line-1010"></span><span class="hs-comment">-- This precondition is needed (only in DEBUG) to satisfy the assertions</span><span>
</span><span id="line-1011"></span><span class="hs-comment">--   in mkSelCo, called in canDecomposableTyConAppOK and canDecomposableFunTy</span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span id="can_eq_nc"><span class="annot"><span class="annottext">can_eq_nc :: Bool
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc"><span class="hs-identifier hs-var hs-var">can_eq_nc</span></a></span></span><span> </span><span id="local-6989586621682008105"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008105"><span class="hs-identifier hs-var">rewritten</span></a></span></span><span> </span><span id="local-6989586621682008106"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008106"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008107"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008107"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008108"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008108"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008109"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008109"><span class="hs-identifier hs-var">ps_ty1</span></a></span></span><span> </span><span id="local-6989586621682008110"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008110"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008111"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008111"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can_eq_nc&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1015"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008105"><span class="hs-identifier hs-var">rewritten</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008106"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008107"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008108"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008109"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008110"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008111"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1016"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008112"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008112"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS GlobalRdrEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier hs-var">getGlobalRdrEnvTcS</span></a></span><span>
</span><span id="line-1017"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008114"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008114"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (FamInstEnv, FamInstEnv)
</span><a href="GHC.Tc.Solver.Monad.html#getFamInstEnvs"><span class="hs-identifier hs-var">getFamInstEnvs</span></a></span><span>
</span><span id="line-1018"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; GlobalRdrEnv
-&gt; (FamInstEnv, FamInstEnv)
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008105"><span class="hs-identifier hs-var">rewritten</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008112"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008114"><span class="hs-identifier hs-var">fam_insts</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008106"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008107"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008108"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008109"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008110"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008111"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-type">can_eq_nc'</span></a></span><span>
</span><span id="line-1021"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>           </span><span class="hs-comment">-- True =&gt; both input types are rewritten</span><span>
</span><span id="line-1022"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>   </span><span class="hs-comment">-- needed to see which newtypes are in scope</span><span>
</span><span id="line-1023"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span>    </span><span class="hs-comment">-- needed to unwrap data instances</span><span>
</span><span id="line-1024"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-1025"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-1026"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="hs-comment">-- LHS, after and before type-synonym expansion, resp</span><span>
</span><span id="line-1027"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="hs-comment">-- RHS, after and before type-synonym expansion, resp</span><span>
</span><span id="line-1028"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span class="hs-comment">-- See Note [Comparing nullary type synonyms] in GHC.Core.Type.</span><span>
</span><span id="line-1031"></span><span id="can_eq_nc%27"><span class="annot"><span class="annottext">can_eq_nc' :: Bool
-&gt; GlobalRdrEnv
-&gt; (FamInstEnv, FamInstEnv)
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var hs-var">can_eq_nc'</span></a></span></span><span> </span><span id="local-6989586621682008117"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008117"><span class="hs-identifier hs-var">_flat</span></a></span></span><span> </span><span id="local-6989586621682008118"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008118"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008119"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008119"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008120"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008120"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008121"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008121"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008122"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682008122"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682008124"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008124"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008125"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008125"><span class="hs-identifier hs-var">_ps_ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682008126"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008126"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008127"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008127"><span class="hs-identifier hs-var">_ps_ty2</span></a></span></span><span>
</span><span id="line-1032"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008124"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008126"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1033"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqReflexive"><span class="hs-identifier hs-var">canEqReflexive</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008120"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008121"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008122"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span class="hs-comment">-- Expand synonyms first; see Note [Type synonyms and canonicalization]</span><span>
</span><span id="line-1036"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008128"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008128"><span class="hs-identifier hs-var">rewritten</span></a></span></span><span> </span><span id="local-6989586621682008129"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008129"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008130"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008130"><span class="hs-identifier hs-var">envs</span></a></span></span><span> </span><span id="local-6989586621682008131"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008131"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008132"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008132"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008133"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008133"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008134"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008134"><span class="hs-identifier hs-var">ps_ty1</span></a></span></span><span> </span><span id="local-6989586621682008135"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008135"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008136"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008136"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1037"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008137"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008137"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008133"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; GlobalRdrEnv
-&gt; (FamInstEnv, FamInstEnv)
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008128"><span class="hs-identifier hs-var">rewritten</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008129"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008130"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008131"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008132"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008137"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008134"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008135"><span class="hs-identifier hs-var">ty2</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008136"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span>
</span><span id="line-1038"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008139"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008139"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008135"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; GlobalRdrEnv
-&gt; (FamInstEnv, FamInstEnv)
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008128"><span class="hs-identifier hs-var">rewritten</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008129"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008130"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008131"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008132"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008133"><span class="hs-identifier hs-var">ty1</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008134"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008139"><span class="hs-identifier hs-var">ty2'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008136"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- need to check for reflexivity in the ReprEq case.</span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- See Note [Eager reflexivity check]</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- Check only when rewritten because the zonk_eq_types check in canEqNC takes</span><span>
</span><span id="line-1043"></span><span class="hs-comment">-- care of the non-rewritten case.</span><span>
</span><span id="line-1044"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621682008140"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008140"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008141"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008141"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008142"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008142"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span id="local-6989586621682008144"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008144"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008145"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008145"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1045"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008144"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008145"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1046"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqReflexive"><span class="hs-identifier hs-var">canEqReflexive</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008142"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008144"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span class="hs-comment">-- When working with ReprEq, unwrap newtypes.</span><span>
</span><span id="line-1049"></span><span class="hs-comment">-- See Note [Unwrap newtypes first]</span><span>
</span><span id="line-1050"></span><span class="hs-comment">-- This must be above the TyVarTy case, in order to guarantee (TyEq:N)</span><span>
</span><span id="line-1051"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008147"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008147"><span class="hs-identifier hs-var">_rewritten</span></a></span></span><span> </span><span id="local-6989586621682008148"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008148"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008149"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008149"><span class="hs-identifier hs-var">envs</span></a></span></span><span> </span><span id="local-6989586621682008150"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008150"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008151"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008151"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008152"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008152"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008153"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008153"><span class="hs-identifier hs-var">ps_ty1</span></a></span></span><span> </span><span id="local-6989586621682008154"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008154"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008155"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008155"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1052"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008151"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-1053"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008156"><span class="annot"><span class="annottext">((Bag GlobalRdrElt, TcCoercion), Type)
</span><a href="#local-6989586621682008156"><span class="hs-identifier hs-var">stuff1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
-&gt; GlobalRdrEnv
-&gt; Type
-&gt; Maybe ((Bag GlobalRdrElt, TcCoercion), Type)
</span><a href="GHC.Tc.Instance.Family.html#tcTopNormaliseNewTypeTF_maybe"><span class="hs-identifier hs-var">tcTopNormaliseNewTypeTF_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008149"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008148"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008152"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1054"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; SwapFlag
-&gt; Type
-&gt; ((Bag GlobalRdrElt, TcCoercion), Type)
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_newtype_nc"><span class="hs-identifier hs-var">can_eq_newtype_nc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008150"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008152"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">((Bag GlobalRdrElt, TcCoercion), Type)
</span><a href="#local-6989586621682008156"><span class="hs-identifier hs-var">stuff1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008154"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008155"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008151"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-1057"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008159"><span class="annot"><span class="annottext">((Bag GlobalRdrElt, TcCoercion), Type)
</span><a href="#local-6989586621682008159"><span class="hs-identifier hs-var">stuff2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
-&gt; GlobalRdrEnv
-&gt; Type
-&gt; Maybe ((Bag GlobalRdrElt, TcCoercion), Type)
</span><a href="GHC.Tc.Instance.Family.html#tcTopNormaliseNewTypeTF_maybe"><span class="hs-identifier hs-var">tcTopNormaliseNewTypeTF_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008149"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008148"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008154"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1058"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; SwapFlag
-&gt; Type
-&gt; ((Bag GlobalRdrElt, TcCoercion), Type)
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_newtype_nc"><span class="hs-identifier hs-var">can_eq_newtype_nc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008150"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008154"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">((Bag GlobalRdrElt, TcCoercion), Type)
</span><a href="#local-6989586621682008159"><span class="hs-identifier hs-var">stuff2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008152"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008153"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span>
</span><span id="line-1059"></span><span>
</span><span id="line-1060"></span><span class="hs-comment">-- Then, get rid of casts</span><span>
</span><span id="line-1061"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008161"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008161"><span class="hs-identifier hs-var">rewritten</span></a></span></span><span> </span><span id="local-6989586621682008162"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008162"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008163"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008163"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008164"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008164"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008165"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008165"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682008167"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008167"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008168"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008168"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008169"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008169"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008170"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008170"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1062"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe CanEqLHS -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isNothing/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHS_maybe"><span class="hs-identifier hs-var">canEqLHS_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008169"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See (3) in Note [Equalities with incompatible kinds]</span><span>
</span><span id="line-1063"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; Type
-&gt; TcCoercion
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCast"><span class="hs-identifier hs-var">canEqCast</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008161"><span class="hs-identifier hs-var">rewritten</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008164"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008165"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008167"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008168"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008169"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008170"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span>
</span><span id="line-1064"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008173"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008173"><span class="hs-identifier hs-var">rewritten</span></a></span></span><span> </span><span id="local-6989586621682008174"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008174"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008175"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008175"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008176"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008176"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008177"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008177"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008178"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008178"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008179"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008179"><span class="hs-identifier hs-var">ps_ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682008180"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008180"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008181"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008181"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1065"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe CanEqLHS -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isNothing/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Maybe CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHS_maybe"><span class="hs-identifier hs-var">canEqLHS_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008178"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See (3) in Note [Equalities with incompatible kinds]</span><span>
</span><span id="line-1066"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; Type
-&gt; TcCoercion
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCast"><span class="hs-identifier hs-var">canEqCast</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008173"><span class="hs-identifier hs-var">rewritten</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008176"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008177"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008180"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008181"><span class="hs-identifier hs-var">co2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008178"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008179"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-1069"></span><span class="hs-comment">-- Otherwise try to decompose</span><span>
</span><span id="line-1070"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span class="hs-comment">-- Literals</span><span>
</span><span id="line-1073"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008182"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008182"><span class="hs-identifier hs-var">_rewritten</span></a></span></span><span> </span><span id="local-6989586621682008183"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008183"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008184"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008184"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008185"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008185"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008186"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008186"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008187"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682008187"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621682008189"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008189"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621682008190"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008190"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1074"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008189"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TyLit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008190"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-1075"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier hs-var">setEvBindIfWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008185"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercion -&gt; EvTerm) -&gt; TcCoercion -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008186"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008187"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1076"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008185"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Equal LitTy&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1077"></span><span>
</span><span id="line-1078"></span><span class="hs-comment">-- Decompose FunTy: (s -&gt; t) and (c =&gt; t)</span><span>
</span><span id="line-1079"></span><span class="hs-comment">-- NB: don't decompose (Int -&gt; blah) ~ (Show a =&gt; blah)</span><span>
</span><span id="line-1080"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008193"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008193"><span class="hs-identifier hs-var">_rewritten</span></a></span></span><span> </span><span id="local-6989586621682008194"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008194"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008195"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008195"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008196"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008196"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008197"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008197"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span>
</span><span id="line-1081"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008200"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008200"><span class="hs-identifier hs-var">am1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008202"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008202"><span class="hs-identifier hs-var">af1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008204"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008204"><span class="hs-identifier hs-var">ty1a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008206"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008206"><span class="hs-identifier hs-var">ty1b</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008207"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008207"><span class="hs-identifier hs-var">_ps_ty1</span></a></span></span><span>
</span><span id="line-1082"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008208"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008208"><span class="hs-identifier hs-var">am2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; FunTyFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008209"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008209"><span class="hs-identifier hs-var">af2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008210"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008210"><span class="hs-identifier hs-var">ty2a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008211"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008211"><span class="hs-identifier hs-var">ty2b</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008212"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008212"><span class="hs-identifier hs-var">_ps_ty2</span></a></span></span><span>
</span><span id="line-1083"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008202"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008209"><span class="hs-identifier hs-var">af2</span></a></span><span>  </span><span class="hs-comment">-- See Note [Decomposing FunTy]</span><span>
</span><span id="line-1084"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; FunTyFlag
-&gt; (Type, Type, Type)
-&gt; (Type, Type, Type)
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canDecomposableFunTy"><span class="hs-identifier hs-var">canDecomposableFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008196"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008197"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008202"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008200"><span class="hs-identifier hs-var">am1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008204"><span class="hs-identifier hs-var">ty1a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008206"><span class="hs-identifier hs-var">ty1b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008208"><span class="hs-identifier hs-var">am2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008210"><span class="hs-identifier hs-var">ty2a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008211"><span class="hs-identifier hs-var">ty2b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1085"></span><span>
</span><span id="line-1086"></span><span class="hs-comment">-- Decompose type constructor applications</span><span>
</span><span id="line-1087"></span><span class="hs-comment">-- NB: we have expanded type synonyms already</span><span>
</span><span id="line-1088"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008214"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008214"><span class="hs-identifier hs-var">_rewritten</span></a></span></span><span> </span><span id="local-6989586621682008215"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008215"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008216"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008216"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008217"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008217"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008218"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008218"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008219"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008219"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008220"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008220"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1089"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008221"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008221"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008222"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008222"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008219"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1090"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008224"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008224"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008225"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008225"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008220"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1091"></span><span>   </span><span class="hs-comment">-- we want to catch e.g. Maybe Int ~ (Int -&gt; Int) here for better</span><span>
</span><span id="line-1092"></span><span>   </span><span class="hs-comment">-- error messages rather than decomposing into AppTys;</span><span>
</span><span id="line-1093"></span><span>   </span><span class="hs-comment">-- hence no direct match on TyConApp</span><span>
</span><span id="line-1094"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008221"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008224"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; TyCon
-&gt; [Type]
-&gt; TyCon
-&gt; [Type]
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canTyConApp"><span class="hs-identifier hs-var">canTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008217"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008218"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008221"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008222"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008224"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008225"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span id="local-6989586621682008228"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008228"><span class="hs-identifier hs-var">_rewritten</span></a></span></span><span> </span><span id="local-6989586621682008229"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008229"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008230"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008230"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008231"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008231"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008232"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008232"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span>
</span><span id="line-1099"></span><span>           </span><span id="local-6989586621682008233"><span class="annot"><span class="annottext">s1 :: Type
</span><a href="#local-6989586621682008233"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008236"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682008236"><span class="hs-identifier hs-var">vis1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1100"></span><span>           </span><span id="local-6989586621682008237"><span class="annot"><span class="annottext">s2 :: Type
</span><a href="#local-6989586621682008237"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008238"><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682008238"><span class="hs-identifier hs-var">vis2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1101"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682008236"><span class="hs-identifier hs-var">vis1</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag -&gt; ForAllTyFlag -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqForAllVis"><span class="hs-operator hs-var">`eqForAllVis`</span></a></span><span> </span><span class="annot"><span class="annottext">ForAllTyFlag
</span><a href="#local-6989586621682008238"><span class="hs-identifier hs-var">vis2</span></a></span><span> </span><span class="hs-comment">-- Note [ForAllTy and type equality]</span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc_forall"><span class="hs-identifier hs-var">can_eq_nc_forall</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008231"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008232"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008233"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008237"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span class="hs-comment">-- See Note [Canonicalising type applications] about why we require rewritten types</span><span>
</span><span id="line-1105"></span><span class="hs-comment">-- Use tcSplitAppTy, not matching on AppTy, to catch oversaturated type families</span><span>
</span><span id="line-1106"></span><span class="hs-comment">-- NB: Only decompose AppTy for nominal equality.</span><span>
</span><span id="line-1107"></span><span class="hs-comment">--     See Note [Decomposing AppTy equalities]</span><span>
</span><span id="line-1108"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621682008241"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008241"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008242"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008242"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008243"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008243"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span id="local-6989586621682008245"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008245"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008246"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008246"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008247"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008247"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008248"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008248"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008245"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1110"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008250"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008250"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008251"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008251"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy_maybe"><span class="hs-identifier hs-var">tcSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008246"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1111"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; Type -&gt; Type -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_app"><span class="hs-identifier hs-var">can_eq_app</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008243"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008247"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008248"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008250"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008251"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1114"></span><span class="hs-comment">-- Can't decompose.</span><span>
</span><span id="line-1115"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1116"></span><span>
</span><span id="line-1117"></span><span class="hs-comment">-- No similarity in type structure detected. Rewrite and try again.</span><span>
</span><span id="line-1118"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621682008253"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008253"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008254"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008254"><span class="hs-identifier hs-var">envs</span></a></span></span><span> </span><span id="local-6989586621682008255"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008255"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008256"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008256"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008257"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008257"><span class="hs-identifier hs-var">ps_ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008258"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008258"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1119"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Rewrite the two types and try again</span><span>
</span><span id="line-1120"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008259"><span class="annot"><span class="annottext">redn1 :: Reduction
</span><a href="#local-6989586621682008259"><span class="hs-identifier hs-var">redn1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008260"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008260"><span class="hs-identifier hs-var">xi1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008261"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008261"><span class="hs-identifier hs-var">rewriters1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008255"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008257"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span>
</span><span id="line-1121"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008262"><span class="annot"><span class="annottext">redn2 :: Reduction
</span><a href="#local-6989586621682008262"><span class="hs-identifier hs-var">redn2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008263"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008263"><span class="hs-identifier hs-var">xi2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008264"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008264"><span class="hs-identifier hs-var">rewriters2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008255"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008258"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span>
</span><span id="line-1122"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008265"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008265"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008261"><span class="hs-identifier hs-var">rewriters1</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; RewriterSet -&gt; RewriterSet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">S.&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008264"><span class="hs-identifier hs-var">rewriters2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008255"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008259"><span class="hs-identifier hs-var">redn1</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008262"><span class="hs-identifier hs-var">redn2</span></a></span><span>
</span><span id="line-1123"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; GlobalRdrEnv
-&gt; (FamInstEnv, FamInstEnv)
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008253"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008254"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008265"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008256"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008260"><span class="hs-identifier hs-var">xi1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008260"><span class="hs-identifier hs-var">xi1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008263"><span class="hs-identifier hs-var">xi2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008263"><span class="hs-identifier hs-var">xi2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1124"></span><span>
</span><span id="line-1125"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1126"></span><span class="hs-comment">-- Look for a canonical LHS. See Note [Canonical LHS].</span><span>
</span><span id="line-1127"></span><span class="hs-comment">-- Only rewritten types end up below here.</span><span>
</span><span id="line-1128"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="hs-comment">-- NB: pattern match on True: we want only rewritten types sent to canEqLHS</span><span>
</span><span id="line-1131"></span><span class="hs-comment">-- This means we've rewritten any variables and reduced any type family redexes</span><span>
</span><span id="line-1132"></span><span class="hs-comment">-- See also Note [No top-level newtypes on RHS of representational equalities]</span><span>
</span><span id="line-1133"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621682008266"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008266"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008267"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008267"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008268"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008268"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008269"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008269"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008270"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008270"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008271"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008271"><span class="hs-identifier hs-var">ps_ty1</span></a></span></span><span> </span><span id="local-6989586621682008272"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008272"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008273"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008273"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1134"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008274"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008274"><span class="hs-identifier hs-var">can_eq_lhs1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHS_maybe"><span class="hs-identifier hs-var">canEqLHS_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008270"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1135"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHS"><span class="hs-identifier hs-var">canEqCanLHS</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008268"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008269"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008274"><span class="hs-identifier hs-var">can_eq_lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008271"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008272"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008273"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008276"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008276"><span class="hs-identifier hs-var">can_eq_lhs2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHS_maybe"><span class="hs-identifier hs-var">canEqLHS_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008272"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1138"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHS"><span class="hs-identifier hs-var">canEqCanLHS</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008268"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008269"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008276"><span class="hs-identifier hs-var">can_eq_lhs2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008273"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008270"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008271"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>     </span><span class="hs-comment">-- If the type is TyConApp tc1 args1, then args1 really can't be less</span><span>
</span><span id="line-1141"></span><span>     </span><span class="hs-comment">-- than tyConArity tc1. It could be *more* than tyConArity, but then we</span><span>
</span><span id="line-1142"></span><span>     </span><span class="hs-comment">-- should have handled the case as an AppTy. That case only fires if</span><span>
</span><span id="line-1143"></span><span>     </span><span class="hs-comment">-- _both_ sides of the equality are AppTy-like... but if one side is</span><span>
</span><span id="line-1144"></span><span>     </span><span class="hs-comment">-- AppTy-like and the other isn't (and it also isn't a variable or</span><span>
</span><span id="line-1145"></span><span>     </span><span class="hs-comment">-- saturated type family application, both of which are handled by</span><span>
</span><span id="line-1146"></span><span>     </span><span class="hs-comment">-- can_eq_nc'), we're in a failure mode and can just fall through.</span><span>
</span><span id="line-1147"></span><span>
</span><span id="line-1148"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1149"></span><span class="hs-comment">-- Fall-through. Give up.</span><span>
</span><span id="line-1150"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span class="hs-comment">-- We've rewritten and the types don't match. Give up.</span><span>
</span><span id="line-1153"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc%27"><span class="hs-identifier hs-var">can_eq_nc'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621682008277"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008277"><span class="hs-identifier hs-var">_rdr_env</span></a></span></span><span> </span><span id="local-6989586621682008278"><span class="annot"><span class="annottext">(FamInstEnv, FamInstEnv)
</span><a href="#local-6989586621682008278"><span class="hs-identifier hs-var">_envs</span></a></span></span><span> </span><span id="local-6989586621682008279"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008279"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008280"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008280"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008281"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008281"><span class="hs-identifier hs-var">ps_ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008282"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008282"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1154"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can_eq_nc' catch-all case&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008281"><span class="hs-identifier hs-var">ps_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008282"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008280"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- See Note [Unsolved equalities]</span><span>
</span><span id="line-1156"></span><span>            </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#ReprEqReason"><span class="hs-identifier hs-var">ReprEqReason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008279"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>            </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#ShapeMismatchReason"><span class="hs-identifier hs-var">ShapeMismatchReason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008279"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1158"></span><span>          </span><span class="hs-comment">-- No need to call canEqFailure/canEqHardFailure because they</span><span>
</span><span id="line-1159"></span><span>          </span><span class="hs-comment">-- rewrite, and the types involved here are already rewritten</span><span>
</span><span id="line-1160"></span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span class="hs-comment">{- Note [Unsolved equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we have an unsolved equality like
  (a b ~R# Int)
that is not necessarily insoluble!  Maybe 'a' will turn out to be a newtype.
So we want to make it a potentially-soluble Irred not an insoluble one.
Missing this point is what caused #15431
-}</span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-1172"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc_forall"><span class="hs-identifier hs-type">can_eq_nc_forall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-1173"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="hs-comment">-- LHS and RHS</span><span>
</span><span id="line-1174"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span class="hs-comment">-- (forall as. phi1) ~ (forall bs. phi2)</span><span>
</span><span id="line-1176"></span><span class="hs-comment">-- Check for length match of as, bs</span><span>
</span><span id="line-1177"></span><span class="hs-comment">-- Then build an implication constraint: forall as. phi1 ~ phi2[as/bs]</span><span>
</span><span id="line-1178"></span><span class="hs-comment">-- But remember also to unify the kinds of as and bs</span><span>
</span><span id="line-1179"></span><span class="hs-comment">--  (this is the 'go' loop), and actually substitute phi2[as |&gt; cos / bs]</span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- Remember also that we might have forall z (a:z). blah</span><span>
</span><span id="line-1181"></span><span class="hs-comment">--  so we must proceed one binder at a time (#13879)</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span id="can_eq_nc_forall"><span class="annot"><span class="annottext">can_eq_nc_forall :: CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc_forall"><span class="hs-identifier hs-var hs-var">can_eq_nc_forall</span></a></span></span><span> </span><span id="local-6989586621682008285"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008285"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008286"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008286"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008287"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008287"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682008288"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008288"><span class="hs-identifier hs-var">s2</span></a></span></span><span>
</span><span id="line-1184"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008289"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008289"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008290"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008290"><span class="hs-identifier hs-var">orig_dest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008291"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008291"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008285"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1185"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008292"><span class="annot"><span class="annottext">free_tvs :: VarSet
</span><a href="#local-6989586621682008292"><span class="hs-identifier hs-var hs-var">free_tvs</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008287"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008288"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1186"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682008293"><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008293"><span class="hs-identifier hs-var">bndrs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008294"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008294"><span class="hs-identifier hs-var">phi1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVarBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinders"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008287"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-1187"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682008296"><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008296"><span class="hs-identifier hs-var">bndrs2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008297"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008297"><span class="hs-identifier hs-var">phi2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVarBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTyVarBinders"><span class="hs-identifier hs-var">tcSplitForAllTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008288"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-1188"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; [TyVarBinder] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008293"><span class="hs-identifier hs-var">bndrs1</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008296"><span class="hs-identifier hs-var">bndrs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1189"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Forall failure&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1190"></span><span>                     </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008287"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008288"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008293"><span class="hs-identifier hs-var">bndrs1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008296"><span class="hs-identifier hs-var">bndrs2</span></a></span><span>
</span><span id="line-1191"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ForAllTyFlag] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; [ForAllTyFlag]
forall tv argf. [VarBndr tv argf] -&gt; [argf]
</span><a href="GHC.Types.Var.html#binderFlags"><span class="hs-identifier hs-var">binderFlags</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008293"><span class="hs-identifier hs-var">bndrs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ForAllTyFlag] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; [ForAllTyFlag]
forall tv argf. [VarBndr tv argf] -&gt; [argf]
</span><a href="GHC.Types.Var.html#binderFlags"><span class="hs-identifier hs-var">binderFlags</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008296"><span class="hs-identifier hs-var">bndrs2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1193"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqHardFailure"><span class="hs-identifier hs-var">canEqHardFailure</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008285"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008287"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008288"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1194"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1195"></span><span>   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Creating implication for polytype equality&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008285"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1196"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008301"><span class="annot"><span class="annottext">empty_subst1 :: Subst
</span><a href="#local-6989586621682008301"><span class="hs-identifier hs-var hs-var">empty_subst1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="annot"><span class="annottext">(InScopeSet -&gt; Subst) -&gt; InScopeSet -&gt; Subst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682008292"><span class="hs-identifier hs-var">free_tvs</span></a></span><span>
</span><span id="line-1197"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008302"><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008302"><span class="hs-identifier hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfoAnon -&gt; TcS SkolemInfo
forall (m :: * -&gt; *). MonadIO m =&gt; SkolemInfoAnon -&gt; m SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#mkSkolemInfo"><span class="hs-identifier hs-var">mkSkolemInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#UnifyForAllSkol"><span class="hs-identifier hs-var">UnifyForAllSkol</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008294"><span class="hs-identifier hs-var">phi1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1198"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008304"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008304"><span class="hs-identifier hs-var">subst1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008305"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008305"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; Subst -&gt; [TcTyVar] -&gt; TcS (Subst, [TcTyVar])
</span><a href="GHC.Tc.Solver.Monad.html#tcInstSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008302"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008301"><span class="hs-identifier hs-var">empty_subst1</span></a></span><span> </span><span class="annot"><span class="annottext">([TcTyVar] -&gt; TcS (Subst, [TcTyVar]))
-&gt; [TcTyVar] -&gt; TcS (Subst, [TcTyVar])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1199"></span><span>                              </span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; [TcTyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008293"><span class="hs-identifier hs-var">bndrs1</span></a></span><span>
</span><span id="line-1200"></span><span>
</span><span id="line-1201"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008307"><span class="annot"><span class="annottext">phi1' :: Type
</span><a href="#local-6989586621682008307"><span class="hs-identifier hs-var hs-var">phi1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008304"><span class="hs-identifier hs-var">subst1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008294"><span class="hs-identifier hs-var">phi1</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>            </span><span class="hs-comment">-- Unify the kinds, extend the substitution</span><span>
</span><span id="line-1204"></span><span>            </span><span class="annot"><a href="#local-6989586621682008308"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1205"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>            </span><span id="local-6989586621682008308"><span class="annot"><span class="annottext">go :: [TcTyVar] -&gt; Subst -&gt; [TyVarBinder] -&gt; TcS (TcCoercion, Bag Ct)
</span><a href="#local-6989586621682008308"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008310"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008310"><span class="hs-identifier hs-var">skol_tv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682008311"><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008311"><span class="hs-identifier hs-var">skol_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008312"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008312"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008313"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621682008313"><span class="hs-identifier hs-var">bndr2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682008314"><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008314"><span class="hs-identifier hs-var">bndrs2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008315"><span class="annot"><span class="annottext">tv2 :: TcTyVar
</span><a href="#local-6989586621682008315"><span class="hs-identifier hs-var hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; TcTyVar
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621682008313"><span class="hs-identifier hs-var">bndr2</span></a></span><span>
</span><span id="line-1208"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008317"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008317"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008318"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008318"><span class="hs-identifier hs-var">wanteds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (TcCoercion, Bag Ct)
</span><a href="#local-6989586621682008319"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008289"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008291"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008310"><span class="hs-identifier hs-var">skol_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Subst -&gt; Type -&gt; Type
Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008312"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008315"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008321"><span class="annot"><span class="annottext">subst' :: Subst
</span><a href="#local-6989586621682008321"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst -&gt; TcTyVar -&gt; Type -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008312"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008315"><span class="hs-identifier hs-var">tv2</span></a></span><span>
</span><span id="line-1211"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcCoercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008310"><span class="hs-identifier hs-var">skol_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008317"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>                         </span><span class="hs-comment">-- skol_tv is already in the in-scope set, but the</span><span>
</span><span id="line-1213"></span><span>                         </span><span class="hs-comment">-- free vars of kind_co are not; hence &quot;...AndInScope&quot;</span><span>
</span><span id="line-1214"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008325"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008325"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008326"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008326"><span class="hs-identifier hs-var">wanteds2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Subst -&gt; [TyVarBinder] -&gt; TcS (TcCoercion, Bag Ct)
</span><a href="#local-6989586621682008308"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008311"><span class="hs-identifier hs-var">skol_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008321"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008314"><span class="hs-identifier hs-var">bndrs2</span></a></span><span>
</span><span id="line-1215"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TcCoercion, Bag Ct) -&gt; TcS (TcCoercion, Bag Ct)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008310"><span class="hs-identifier hs-var">skol_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008317"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008325"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1216"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008318"><span class="hs-identifier hs-var">wanteds1</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct -&gt; Bag Ct -&gt; Bag Ct
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008326"><span class="hs-identifier hs-var">wanteds2</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span>            </span><span class="hs-comment">-- Done: unify phi1 ~ phi2</span><span>
</span><span id="line-1219"></span><span>            </span><span class="annot"><a href="#local-6989586621682008308"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682008329"><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008329"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621682008330"><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008330"><span class="hs-identifier hs-var">bndrs2</span></a></span></span><span>
</span><span id="line-1220"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcS (TcCoercion, Bag Ct) -&gt; TcS (TcCoercion, Bag Ct)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBinder] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008330"><span class="hs-identifier hs-var">bndrs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (TcCoercion, Bag Ct) -&gt; TcS (TcCoercion, Bag Ct))
-&gt; TcS (TcCoercion, Bag Ct) -&gt; TcS (TcCoercion, Bag Ct)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1221"></span><span>                </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (TcCoercion, Bag Ct)
</span><a href="#local-6989586621682008319"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008289"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008291"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008286"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008307"><span class="hs-identifier hs-var">phi1'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008329"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008297"><span class="hs-identifier hs-var">phi2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span>            </span><span class="annot"><a href="#local-6989586621682008308"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Subst
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcS (TcCoercion, Bag Ct)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cna_eq_nc_forall&quot;</span></span><span>  </span><span class="hs-comment">-- case (s:ss) []</span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span>            </span><span id="local-6989586621682008334"><span class="annot"><span class="annottext">empty_subst2 :: Subst
</span><a href="#local-6989586621682008334"><span class="hs-identifier hs-var hs-var">empty_subst2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; Subst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptySubst"><span class="hs-identifier hs-var">mkEmptySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Subst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getSubstInScope"><span class="hs-identifier hs-var">getSubstInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008304"><span class="hs-identifier hs-var">subst1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>
</span><span id="line-1227"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008336"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682008336"><span class="hs-identifier hs-var">lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008337"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008337"><span class="hs-identifier hs-var">all_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008338"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008338"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcS (TcCoercion, Bag Ct) -&gt; TcS (TcLevel, (TcCoercion, Bag Ct))
forall a. SDoc -&gt; TcS a -&gt; TcS (TcLevel, a)
</span><a href="GHC.Tc.Solver.Monad.html#pushLevelNoWorkList"><span class="hs-identifier hs-var">pushLevelNoWorkList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemInfo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008302"><span class="hs-identifier hs-var">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (TcCoercion, Bag Ct) -&gt; TcS (TcLevel, (TcCoercion, Bag Ct)))
-&gt; TcS (TcCoercion, Bag Ct) -&gt; TcS (TcLevel, (TcCoercion, Bag Ct))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1228"></span><span>                                    </span><span class="annot"><span class="annottext">[TcTyVar] -&gt; Subst -&gt; [TyVarBinder] -&gt; TcS (TcCoercion, Bag Ct)
</span><a href="#local-6989586621682008308"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008305"><span class="hs-identifier hs-var">skol_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Subst
</span><a href="#local-6989586621682008334"><span class="hs-identifier hs-var">empty_subst2</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBinder]
</span><a href="#local-6989586621682008296"><span class="hs-identifier hs-var">bndrs2</span></a></span><span>
</span><span id="line-1229"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; SkolemInfoAnon -&gt; [TcTyVar] -&gt; Bag Ct -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitTvImplicationTcS"><span class="hs-identifier hs-var">emitTvImplicationTcS</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682008336"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SkolemInfo -&gt; SkolemInfoAnon
</span><a href="GHC.Tc.Types.Origin.html#getSkolemInfo"><span class="hs-identifier hs-var">getSkolemInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621682008302"><span class="hs-identifier hs-var">skol_info</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcTyVar]
</span><a href="#local-6989586621682008305"><span class="hs-identifier hs-var">skol_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621682008338"><span class="hs-identifier hs-var">wanteds</span></a></span><span>
</span><span id="line-1230"></span><span>
</span><span id="line-1231"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TcEvDest -&gt; TcCoercion -&gt; TcS ()
TcEvDest -&gt; TcCoercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008290"><span class="hs-identifier hs-var">orig_dest</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008337"><span class="hs-identifier hs-var">all_co</span></a></span><span>
</span><span id="line-1232"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008285"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Deferred polytype equality&quot;</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1233"></span><span>
</span><span id="line-1234"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1235"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Omitting decomposition of given polytype equality&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1236"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.Solver.Monad.html#pprEq"><span class="hs-identifier hs-var">pprEq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008287"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008288"><span class="hs-identifier hs-var">s2</span></a></span><span>    </span><span class="hs-comment">-- See Note [Do not decompose Given polytype equalities]</span><span>
</span><span id="line-1237"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008285"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Discard given polytype equality&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1238"></span><span>
</span><span id="line-1239"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1240"></span><span>    </span><span class="annot"><a href="#local-6989586621682008319"><span class="hs-identifier hs-type">unify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>    </span><span class="hs-comment">-- This version returns the wanted constraint rather</span><span>
</span><span id="line-1242"></span><span>    </span><span class="hs-comment">-- than putting it in the work list</span><span>
</span><span id="line-1243"></span><span>    </span><span id="local-6989586621682008319"><span class="annot"><span class="annottext">unify :: CtLoc
-&gt; RewriterSet -&gt; Role -&gt; Type -&gt; Type -&gt; TcS (TcCoercion, Bag Ct)
</span><a href="#local-6989586621682008319"><span class="hs-identifier hs-var hs-var">unify</span></a></span></span><span> </span><span id="local-6989586621682008343"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008343"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682008344"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008344"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682008345"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008345"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682008346"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008346"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008347"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008347"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1244"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008346"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008347"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1245"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcCoercion, Bag Ct) -&gt; TcS (TcCoercion, Bag Ct)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008345"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008346"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag Ct
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1247"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008349"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008349"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008350"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008350"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, TcCoercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008343"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008344"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008345"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008346"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008347"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1248"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TcCoercion, Bag Ct) -&gt; TcS (TcCoercion, Bag Ct)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008350"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008349"><span class="hs-identifier hs-var">wanted</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1249"></span><span>
</span><span id="line-1250"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-1251"></span><span class="hs-comment">-- | Compare types for equality, while zonking as necessary. Gives up</span><span>
</span><span id="line-1252"></span><span class="hs-comment">-- as soon as it finds that two types are not equal.</span><span>
</span><span id="line-1253"></span><span class="hs-comment">-- This is quite handy when some unification has made two</span><span>
</span><span id="line-1254"></span><span class="hs-comment">-- types in an inert Wanted to be equal. We can discover the equality without</span><span>
</span><span id="line-1255"></span><span class="hs-comment">-- rewriting, which is sometimes very expensive (in the case of type functions).</span><span>
</span><span id="line-1256"></span><span class="hs-comment">-- In particular, this function makes a ~20% improvement in test case</span><span>
</span><span id="line-1257"></span><span class="hs-comment">-- perf/compiler/T5030.</span><span>
</span><span id="line-1258"></span><span class="hs-comment">--</span><span>
</span><span id="line-1259"></span><span class="hs-comment">-- Returns either the (partially zonked) types in the case of</span><span>
</span><span id="line-1260"></span><span class="hs-comment">-- inequality, or the one type in the case of equality. canEqReflexive is</span><span>
</span><span id="line-1261"></span><span class="hs-comment">-- a good next step in the 'Right' case. Returning 'Left' is always safe.</span><span>
</span><span id="line-1262"></span><span class="hs-comment">--</span><span>
</span><span id="line-1263"></span><span class="hs-comment">-- NB: This does *not* look through type synonyms. In fact, it treats type</span><span>
</span><span id="line-1264"></span><span class="hs-comment">-- synonyms as rigid constructors. In the future, it might be convenient</span><span>
</span><span id="line-1265"></span><span class="hs-comment">-- to look at only those arguments of type synonyms that actually appear</span><span>
</span><span id="line-1266"></span><span class="hs-comment">-- in the synonym RHS. But we're not there yet.</span><span>
</span><span id="line-1267"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#zonk_eq_types"><span class="hs-identifier hs-type">zonk_eq_types</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span id="zonk_eq_types"><span class="annot"><span class="annottext">zonk_eq_types :: Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="GHC.Tc.Solver.Canonical.html#zonk_eq_types"><span class="hs-identifier hs-var hs-var">zonk_eq_types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1269"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1270"></span><span>    </span><span id="local-6989586621682008352"><span class="annot"><span class="annottext">go :: Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682008374"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008374"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682008375"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008375"><span class="hs-identifier hs-var">tv2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVar -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008376"><span class="hs-identifier hs-var">tyvar_tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008374"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008375"><span class="hs-identifier hs-var">tv2</span></a></span><span>
</span><span id="line-1271"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682008377"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008377"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008378"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008378"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; TcTyVar -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008379"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008377"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008378"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1272"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008380"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008380"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682008381"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008381"><span class="hs-identifier hs-var">tv2</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; TcTyVar -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008379"><span class="hs-identifier hs-var">tyvar</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span>  </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008381"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008380"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1273"></span><span>
</span><span id="line-1274"></span><span>    </span><span class="hs-comment">-- We handle FunTys explicitly here despite the fact that they could also be</span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-comment">-- treated as an application. Why? Well, for one it's cheaper to just look</span><span>
</span><span id="line-1276"></span><span>    </span><span class="hs-comment">-- at two types (the argument and result types) than four (the argument,</span><span>
</span><span id="line-1277"></span><span>    </span><span class="hs-comment">-- result, and their RuntimeReps). Also, we haven't completely zonked yet,</span><span>
</span><span id="line-1278"></span><span>    </span><span class="hs-comment">-- so we may run into an unzonked type variable while trying to compute the</span><span>
</span><span id="line-1279"></span><span>    </span><span class="hs-comment">-- RuntimeReps of the argument and result types. This can be observed in</span><span>
</span><span id="line-1280"></span><span>    </span><span class="hs-comment">-- testcase tc269.</span><span>
</span><span id="line-1281"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span id="local-6989586621682008382"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008382"><span class="hs-identifier hs-var">af1</span></a></span></span><span> </span><span id="local-6989586621682008383"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008383"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621682008384"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008384"><span class="hs-identifier hs-var">arg1</span></a></span></span><span> </span><span id="local-6989586621682008385"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008385"><span class="hs-identifier hs-var">res1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span id="local-6989586621682008386"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008386"><span class="hs-identifier hs-var">af2</span></a></span></span><span> </span><span id="local-6989586621682008387"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008387"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621682008388"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008388"><span class="hs-identifier hs-var">arg2</span></a></span></span><span> </span><span id="local-6989586621682008389"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008389"><span class="hs-identifier hs-var">res2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1282"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008382"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008386"><span class="hs-identifier hs-var">af2</span></a></span><span>
</span><span id="line-1283"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008383"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008387"><span class="hs-identifier hs-var">w2</span></a></span><span>
</span><span id="line-1284"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008391"><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008391"><span class="hs-identifier hs-var">res_a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008384"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008388"><span class="hs-identifier hs-var">arg2</span></a></span><span>
</span><span id="line-1285"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008392"><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008392"><span class="hs-identifier hs-var">res_b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008385"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008389"><span class="hs-identifier hs-var">res2</span></a></span><span>
</span><span id="line-1286"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type))
-&gt; Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type)
-&gt; Either (Pair Type) Type
-&gt; Either (Pair Type) Type
-&gt; Either (Pair Type) Type
forall a b c.
(a -&gt; b -&gt; c)
-&gt; Either (Pair b) b -&gt; Either (Pair a) a -&gt; Either (Pair c) c
</span><a href="#local-6989586621682008393"><span class="hs-identifier hs-var">combine_rev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunTyFlag -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008382"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008383"><span class="hs-identifier hs-var">w1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008392"><span class="hs-identifier hs-var">res_b</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008391"><span class="hs-identifier hs-var">res_a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1287"></span><span>
</span><span id="line-1288"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008394"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682008394"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008395"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008395"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
forall {m :: * -&gt; *} {a} {b}.
Monad m =&gt;
a -&gt; a -&gt; m (Either (Pair a) b)
</span><a href="#local-6989586621682008396"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008394"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008395"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1289"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008397"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008397"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008398"><span class="annot"><span class="annottext">ty2 :: Type
</span><a href="#local-6989586621682008398"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
forall {m :: * -&gt; *} {a} {b}.
Monad m =&gt;
a -&gt; a -&gt; m (Either (Pair a) b)
</span><a href="#local-6989586621682008396"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008397"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008398"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1290"></span><span>
</span><span id="line-1291"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008399"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008399"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008400"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008400"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1292"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008401"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008401"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008402"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008402"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConAppNoView_maybe"><span class="hs-identifier hs-var">splitTyConAppNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008399"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1293"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008404"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008404"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008405"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008405"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConAppNoView_maybe"><span class="hs-identifier hs-var">splitTyConAppNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008400"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1294"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008401"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008404"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008402"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008405"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1295"></span><span>          </span><span class="hs-comment">-- Crucial to check for equal-length args, because</span><span>
</span><span id="line-1296"></span><span>          </span><span class="hs-comment">-- we cannot assume that the two args to 'go' have</span><span>
</span><span id="line-1297"></span><span>          </span><span class="hs-comment">-- the same kind.  E.g go (Proxy *      (Maybe Int))</span><span>
</span><span id="line-1298"></span><span>          </span><span class="hs-comment">--                        (Proxy (*-&gt;*) Maybe)</span><span>
</span><span id="line-1299"></span><span>          </span><span class="hs-comment">-- We'll call (go (Maybe Int) Maybe)</span><span>
</span><span id="line-1300"></span><span>          </span><span class="hs-comment">-- See #13083</span><span>
</span><span id="line-1301"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type] -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008406"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008401"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008402"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008405"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1302"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
forall {m :: * -&gt; *} {a} {b}.
Monad m =&gt;
a -&gt; a -&gt; m (Either (Pair a) b)
</span><a href="#local-6989586621682008396"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008399"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008400"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1303"></span><span>
</span><span id="line-1304"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008407"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008407"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008408"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008408"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1305"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008409"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008409"><span class="hs-identifier hs-var">ty1a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008410"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008410"><span class="hs-identifier hs-var">ty1b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#tcSplitAppTyNoView_maybe"><span class="hs-identifier hs-var">tcSplitAppTyNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008407"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1306"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008412"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008412"><span class="hs-identifier hs-var">ty2a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008413"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008413"><span class="hs-identifier hs-var">ty2b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#tcSplitAppTyNoView_maybe"><span class="hs-identifier hs-var">tcSplitAppTyNoView_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008408"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1307"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008414"><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008414"><span class="hs-identifier hs-var">res_a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008409"><span class="hs-identifier hs-var">ty1a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008412"><span class="hs-identifier hs-var">ty2a</span></a></span><span>
</span><span id="line-1308"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008415"><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008415"><span class="hs-identifier hs-var">res_b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008410"><span class="hs-identifier hs-var">ty1b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008413"><span class="hs-identifier hs-var">ty2b</span></a></span><span>
</span><span id="line-1309"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type))
-&gt; Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type)
-&gt; Either (Pair Type) Type
-&gt; Either (Pair Type) Type
-&gt; Either (Pair Type) Type
forall a b c.
(a -&gt; b -&gt; c)
-&gt; Either (Pair b) b -&gt; Either (Pair a) a -&gt; Either (Pair c) c
</span><a href="#local-6989586621682008393"><span class="hs-identifier hs-var">combine_rev</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008415"><span class="hs-identifier hs-var">res_b</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type
</span><a href="#local-6989586621682008414"><span class="hs-identifier hs-var">res_a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1310"></span><span>
</span><span id="line-1311"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008417"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682008417"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621682008418"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008418"><span class="hs-identifier hs-var">lit1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621682008419"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008419"><span class="hs-identifier hs-var">lit2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1312"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008418"><span class="hs-identifier hs-var">lit1</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TyLit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621682008419"><span class="hs-identifier hs-var">lit2</span></a></span><span>
</span><span id="line-1313"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Either (Pair Type) Type
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008417"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1314"></span><span>
</span><span id="line-1315"></span><span>    </span><span class="annot"><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008420"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008420"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008421"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008421"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
forall {m :: * -&gt; *} {a} {b}.
Monad m =&gt;
a -&gt; a -&gt; m (Either (Pair a) b)
</span><a href="#local-6989586621682008396"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008420"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008421"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1316"></span><span>      </span><span class="hs-comment">-- We don't handle more complex forms here</span><span>
</span><span id="line-1317"></span><span>
</span><span id="line-1318"></span><span>    </span><span id="local-6989586621682008396"><span class="annot"><span class="annottext">bale_out :: a -&gt; a -&gt; m (Either (Pair a) b)
</span><a href="#local-6989586621682008396"><span class="hs-identifier hs-var hs-var">bale_out</span></a></span></span><span> </span><span id="local-6989586621682008430"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008430"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008431"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008431"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Pair a) b -&gt; m (Either (Pair a) b)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Pair a) b -&gt; m (Either (Pair a) b))
-&gt; Either (Pair a) b -&gt; m (Either (Pair a) b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pair a -&gt; Either (Pair a) b
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Pair a
forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008430"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008431"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1319"></span><span>
</span><span id="line-1320"></span><span>    </span><span class="annot"><a href="#local-6989586621682008379"><span class="hs-identifier hs-type">tyvar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1321"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1322"></span><span>      </span><span class="hs-comment">-- Try to do as little as possible, as anything we do here is redundant</span><span>
</span><span id="line-1323"></span><span>      </span><span class="hs-comment">-- with rewriting. In particular, no need to zonk kinds. That's why</span><span>
</span><span id="line-1324"></span><span>      </span><span class="hs-comment">-- we don't use the already-defined zonking functions</span><span>
</span><span id="line-1325"></span><span>    </span><span id="local-6989586621682008379"><span class="annot"><span class="annottext">tyvar :: SwapFlag -&gt; TcTyVar -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008379"><span class="hs-identifier hs-var hs-var">tyvar</span></a></span></span><span> </span><span id="local-6989586621682008432"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008432"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008433"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008433"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682008434"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008434"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1326"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008433"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1327"></span><span>          </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: TcTyVarDetails -&gt; IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008438"><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621682008438"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1328"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008439"><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621682008439"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails -&gt; TcS MetaDetails
forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621682008438"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1329"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621682008439"><span class="hs-identifier hs-var">cts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1330"></span><span>                      </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008442"><span class="hs-identifier hs-var">give_up</span></a></span><span>
</span><span id="line-1331"></span><span>                      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621682008444"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008444"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; TcS ()
forall {a} {a}. (Outputable a, Outputable a) =&gt; a -&gt; a -&gt; TcS ()
</span><a href="#local-6989586621682008445"><span class="hs-identifier hs-var">trace_indirect</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008433"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008444"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1332"></span><span>                                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SwapFlag
-&gt; (Type -&gt; Type -&gt; TcS (Either (Pair Type) Type))
-&gt; Type
-&gt; Type
-&gt; TcS (Either (Pair Type) Type)
forall a b. SwapFlag -&gt; (a -&gt; a -&gt; b) -&gt; a -&gt; a -&gt; b
</span><a href="GHC.Types.Basic.html#unSwap"><span class="hs-identifier hs-var">unSwap</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008432"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008444"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008434"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1333"></span><span>          </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008442"><span class="hs-identifier hs-var">give_up</span></a></span><span>
</span><span id="line-1334"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1335"></span><span>        </span><span id="local-6989586621682008442"><span class="annot"><span class="annottext">give_up :: TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008442"><span class="hs-identifier hs-var hs-var">give_up</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type))
-&gt; Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Either (Pair Type) Type
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Pair Type -&gt; Either (Pair Type) Type)
-&gt; Pair Type -&gt; Either (Pair Type) Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
-&gt; (Type -&gt; Type -&gt; Pair Type) -&gt; Type -&gt; Type -&gt; Pair Type
forall a b. SwapFlag -&gt; (a -&gt; a -&gt; b) -&gt; a -&gt; a -&gt; b
</span><a href="GHC.Types.Basic.html#unSwap"><span class="hs-identifier hs-var">unSwap</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008432"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Pair Type
forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008433"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008434"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1336"></span><span>
</span><span id="line-1337"></span><span>    </span><span id="local-6989586621682008376"><span class="annot"><span class="annottext">tyvar_tyvar :: TcTyVar -&gt; TcTyVar -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008376"><span class="hs-identifier hs-var hs-var">tyvar_tyvar</span></a></span></span><span> </span><span id="local-6989586621682008447"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008447"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span id="local-6989586621682008448"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008448"><span class="hs-identifier hs-var">tv2</span></a></span></span><span>
</span><span id="line-1338"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008447"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008448"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Either (Pair Type) Type
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008447"><span class="hs-identifier hs-var">tv1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1339"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008449"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008449"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008450"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008450"><span class="hs-identifier hs-var">progress1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcS (Type, Bool)
</span><a href="#local-6989586621682008451"><span class="hs-identifier hs-var">quick_zonk</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008447"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-1340"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008452"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008452"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008453"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008453"><span class="hs-identifier hs-var">progress2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcS (Type, Bool)
</span><a href="#local-6989586621682008451"><span class="hs-identifier hs-var">quick_zonk</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008448"><span class="hs-identifier hs-var">tv2</span></a></span><span>
</span><span id="line-1341"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008450"><span class="hs-identifier hs-var">progress1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008453"><span class="hs-identifier hs-var">progress2</span></a></span><span>
</span><span id="line-1342"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008449"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008452"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-1343"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type))
-&gt; Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Either (Pair Type) Type
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Pair Type
forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008447"><span class="hs-identifier hs-var">tv1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008448"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1344"></span><span>
</span><span id="line-1345"></span><span>    </span><span id="local-6989586621682008445"><span class="annot"><span class="annottext">trace_indirect :: a -&gt; a -&gt; TcS ()
</span><a href="#local-6989586621682008445"><span class="hs-identifier hs-var hs-var">trace_indirect</span></a></span></span><span> </span><span id="local-6989586621682008461"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008461"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621682008462"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008462"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1346"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Following filled tyvar (zonk_eq_types)&quot;</span></span><span>
</span><span id="line-1347"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008461"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
forall doc. IsLine doc =&gt; doc
</span><a href="GHC.Utils.Outputable.html#equals"><span class="hs-identifier hs-var">equals</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008462"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1348"></span><span>
</span><span id="line-1349"></span><span>    </span><span id="local-6989586621682008451"><span class="annot"><span class="annottext">quick_zonk :: TcTyVar -&gt; TcS (Type, Bool)
</span><a href="#local-6989586621682008451"><span class="hs-identifier hs-var hs-var">quick_zonk</span></a></span></span><span> </span><span id="local-6989586621682008471"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008471"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcTyVarDetails
</span><a href="GHC.Types.Var.html#tcTyVarDetails"><span class="hs-identifier hs-var">tcTyVarDetails</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008471"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1350"></span><span>      </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#MetaTv"><span class="hs-identifier hs-type">MetaTv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mtv_ref :: TcTyVarDetails -&gt; IORef MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#mtv_ref"><span class="hs-identifier hs-var">mtv_ref</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008472"><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621682008472"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1351"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008473"><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621682008473"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails -&gt; TcS MetaDetails
forall a. TcRef a -&gt; TcS a
</span><a href="GHC.Tc.Solver.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef MetaDetails
</span><a href="#local-6989586621682008472"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1352"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="#local-6989586621682008473"><span class="hs-identifier hs-var">cts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1353"></span><span>                  </span><span class="annot"><span class="annottext">MetaDetails
</span><a href="GHC.Tc.Utils.TcType.html#Flexi"><span class="hs-identifier hs-var">Flexi</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type, Bool) -&gt; TcS (Type, Bool)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008471"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1354"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Indirect"><span class="hs-identifier hs-type">Indirect</span></a></span><span> </span><span id="local-6989586621682008474"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008474"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; TcS ()
forall {a} {a}. (Outputable a, Outputable a) =&gt; a -&gt; a -&gt; TcS ()
</span><a href="#local-6989586621682008445"><span class="hs-identifier hs-var">trace_indirect</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008471"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008474"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1355"></span><span>                                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Type, Bool) -&gt; TcS (Type, Bool)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008474"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1356"></span><span>      </span><span class="annot"><span class="annottext">TcTyVarDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type, Bool) -&gt; TcS (Type, Bool)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008471"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1357"></span><span>
</span><span id="line-1358"></span><span>      </span><span class="hs-comment">-- This happens for type families, too. But recall that failure</span><span>
</span><span id="line-1359"></span><span>      </span><span class="hs-comment">-- here just means to try harder, so it's OK if the type function</span><span>
</span><span id="line-1360"></span><span>      </span><span class="hs-comment">-- isn't injective.</span><span>
</span><span id="line-1361"></span><span>    </span><span class="annot"><a href="#local-6989586621682008406"><span class="hs-identifier hs-type">tycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1362"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1363"></span><span>    </span><span id="local-6989586621682008406"><span class="annot"><span class="annottext">tycon :: TyCon -&gt; [Type] -&gt; [Type] -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008406"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621682008475"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008475"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682008476"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008476"><span class="hs-identifier hs-var">tys1</span></a></span></span><span> </span><span id="local-6989586621682008477"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008477"><span class="hs-identifier hs-var">tys2</span></a></span></span><span>
</span><span id="line-1364"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008478"><span class="annot"><span class="annottext">[Either (Pair Type) Type]
</span><a href="#local-6989586621682008478"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; TcS (Either (Pair Type) Type))
-&gt; [Type] -&gt; [Type] -&gt; TcS [Either (Pair Type) Type]
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#zipWithM/Control.Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS (Either (Pair Type) Type)
</span><a href="#local-6989586621682008352"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008476"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008477"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1365"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type))
-&gt; Either (Pair Type) Type -&gt; TcS (Either (Pair Type) Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either (Pair Type) Type] -&gt; Either (Pair [Type]) [Type]
</span><a href="#local-6989586621682008480"><span class="hs-identifier hs-var">combine_results</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (Pair Type) Type]
</span><a href="#local-6989586621682008478"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1366"></span><span>               </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682008481"><span class="annot"><span class="annottext">Pair [Type]
</span><a href="#local-6989586621682008481"><span class="hs-identifier hs-var">tys</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Either (Pair Type) Type
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008475"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; Type) -&gt; Pair [Type] -&gt; Pair Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pair [Type]
</span><a href="#local-6989586621682008481"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1367"></span><span>               </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682008484"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008484"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Either (Pair Type) Type
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008475"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008484"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1368"></span><span>
</span><span id="line-1369"></span><span>    </span><span class="annot"><a href="#local-6989586621682008480"><span class="hs-identifier hs-type">combine_results</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1370"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1371"></span><span>    </span><span id="local-6989586621682008480"><span class="annot"><span class="annottext">combine_results :: [Either (Pair Type) Type] -&gt; Either (Pair [Type]) [Type]
</span><a href="#local-6989586621682008480"><span class="hs-identifier hs-var hs-var">combine_results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pair [Type] -&gt; Pair [Type])
-&gt; ([Type] -&gt; [Type])
-&gt; Either (Pair [Type]) [Type]
-&gt; Either (Pair [Type]) [Type]
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Either a c -&gt; Either b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="../../base-4.18.3.0/src/Data.Bifunctor.html#bimap/Data.Bifunctor.html#bimap"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Type] -&gt; [Type]) -&gt; Pair [Type] -&gt; Pair [Type]
forall a b. (a -&gt; b) -&gt; Pair a -&gt; Pair b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (Pair [Type]) [Type] -&gt; Either (Pair [Type]) [Type])
-&gt; ([Either (Pair Type) Type] -&gt; Either (Pair [Type]) [Type])
-&gt; [Either (Pair Type) Type]
-&gt; Either (Pair [Type]) [Type]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-1372"></span><span>                      </span><span class="annot"><span class="annottext">(Either (Pair [Type]) [Type]
 -&gt; Either (Pair Type) Type -&gt; Either (Pair [Type]) [Type])
-&gt; Either (Pair [Type]) [Type]
-&gt; [Either (Pair Type) Type]
-&gt; Either (Pair [Type]) [Type]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldl%27/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; [Type] -&gt; [Type])
-&gt; Either (Pair [Type]) [Type]
-&gt; Either (Pair Type) Type
-&gt; Either (Pair [Type]) [Type]
forall a b c.
(a -&gt; b -&gt; c)
-&gt; Either (Pair b) b -&gt; Either (Pair a) a -&gt; Either (Pair c) c
</span><a href="#local-6989586621682008393"><span class="hs-identifier hs-var">combine_rev</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Either (Pair [Type]) [Type]
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1373"></span><span>
</span><span id="line-1374"></span><span>      </span><span class="hs-comment">-- combine (in reverse) a new result onto an already-combined result</span><span>
</span><span id="line-1375"></span><span>    </span><span id="local-6989586621682007146"><span id="local-6989586621682007147"><span id="local-6989586621682007148"><span class="annot"><a href="#local-6989586621682008393"><span class="hs-identifier hs-type">combine_rev</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682007146"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682007147"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682007148"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1376"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007147"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682007147"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-1377"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007146"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682007146"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-1378"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Either/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007148"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621682007148"><span class="hs-identifier hs-type">c</span></a></span></span></span></span><span>
</span><span id="line-1379"></span><span>    </span><span id="local-6989586621682008393"><span class="annot"><span class="annottext">combine_rev :: forall a b c.
(a -&gt; b -&gt; c)
-&gt; Either (Pair b) b -&gt; Either (Pair a) a -&gt; Either (Pair c) c
</span><a href="#local-6989586621682008393"><span class="hs-identifier hs-var hs-var">combine_rev</span></a></span></span><span> </span><span id="local-6989586621682008497"><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008497"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682008498"><span class="annot"><span class="annottext">Pair b
</span><a href="#local-6989586621682008498"><span class="hs-identifier hs-var">list</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682008499"><span class="annot"><span class="annottext">Pair a
</span><a href="#local-6989586621682008499"><span class="hs-identifier hs-var">elt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pair c -&gt; Either (Pair c) c
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008497"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; c) -&gt; Pair a -&gt; Pair (b -&gt; c)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pair a
</span><a href="#local-6989586621682008499"><span class="hs-identifier hs-var">elt</span></a></span><span>     </span><span class="annot"><span class="annottext">Pair (b -&gt; c) -&gt; Pair b -&gt; Pair c
forall a b. Pair (a -&gt; b) -&gt; Pair a -&gt; Pair b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pair b
</span><a href="#local-6989586621682008498"><span class="hs-identifier hs-var">list</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>    </span><span class="annot"><a href="#local-6989586621682008393"><span class="hs-identifier hs-var">combine_rev</span></a></span><span> </span><span id="local-6989586621682008500"><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008500"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682008501"><span class="annot"><span class="annottext">Pair b
</span><a href="#local-6989586621682008501"><span class="hs-identifier hs-var">list</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682008502"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008502"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pair c -&gt; Either (Pair c) c
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008500"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; c) -&gt; Pair a -&gt; Pair (b -&gt; c)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Pair a
forall a. a -&gt; Pair a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008502"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Pair (b -&gt; c) -&gt; Pair b -&gt; Pair c
forall a b. Pair (a -&gt; b) -&gt; Pair a -&gt; Pair b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pair b
</span><a href="#local-6989586621682008501"><span class="hs-identifier hs-var">list</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1381"></span><span>    </span><span class="annot"><a href="#local-6989586621682008393"><span class="hs-identifier hs-var">combine_rev</span></a></span><span> </span><span id="local-6989586621682008503"><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008503"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682008504"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682008504"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682008505"><span class="annot"><span class="annottext">Pair a
</span><a href="#local-6989586621682008505"><span class="hs-identifier hs-var">elt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pair c -&gt; Either (Pair c) c
forall a b. a -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008503"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b -&gt; c) -&gt; Pair a -&gt; Pair (b -&gt; c)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pair a
</span><a href="#local-6989586621682008505"><span class="hs-identifier hs-var">elt</span></a></span><span>     </span><span class="annot"><span class="annottext">Pair (b -&gt; c) -&gt; Pair b -&gt; Pair c
forall a b. Pair (a -&gt; b) -&gt; Pair a -&gt; Pair b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; Pair b
forall a. a -&gt; Pair a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682008504"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>    </span><span class="annot"><a href="#local-6989586621682008393"><span class="hs-identifier hs-var">combine_rev</span></a></span><span> </span><span id="local-6989586621682008506"><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008506"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682008507"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682008507"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682008508"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008508"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c -&gt; Either (Pair c) c
forall a b. b -&gt; Either a b
</span><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621682008506"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008508"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621682008507"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1383"></span><span>
</span><span id="line-1384"></span><span class="hs-comment">{- Note [Unwrap newtypes first]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [Decomposing newtype equalities]

Consider
  newtype N m a = MkN (m a)
N will get a conservative, Nominal role for its second parameter 'a',
because it appears as an argument to the unknown 'm'. Now consider
  [W] N Maybe a  ~R#  N Maybe b

If we /decompose/, we'll get
  [W] a ~N# b

But if instead we /unwrap/ we'll get
  [W] Maybe a ~R# Maybe b
which in turn gives us
  [W] a ~R# b
which is easier to satisfy.

Conclusion: we must unwrap newtypes before decomposing them. This happens
in `can_eq_newtype_nc`

We did flirt with making the /rewriter/ expand newtypes, rather than
doing it in `can_eq_newtype_nc`.   But with recursive newtypes we want
to be super-careful about expanding!

   newtype A = MkA [A]   -- Recursive!

   f :: A -&gt; [A]
   f = coerce

We have [W] A ~R# [A].  If we rewrite [A], it'll expand to
   [[[[[...]]]]]
and blow the reduction stack.  See Note [Newtypes can blow the stack]
in GHC.Tc.Solver.Rewrite.  But if we expand only the /top level/ of
both sides, we get
   [W] [A] ~R# [A]
which we can, just, solve by reflexivity.

So we simply unwrap, on-demand, at top level, in `can_eq_newtype_nc`.

This is all very delicate. There is a real risk of a loop in the type checker
with recursive newtypes -- but I think we're doomed to do *something*
delicate, as we're really trying to solve for equirecursive type
equality. Bottom line for users: recursive newtypes do not play well with type
inference for representational equality.  See also Section 5.3.1 and 5.3.4 of
&quot;Safe Zero-cost Coercions for Haskell&quot; (JFP 2016).

See also Note [Decomposing newtype equalities].

--- Historical side note ---

We flirted with doing /both/ unwrap-at-top-level /and/ rewrite-deeply;
see #22519.  But that didn't work: see discussion in #22924. Specifically
we got a loop with a minor variation:
   f2 :: a -&gt; [A]
   f2 = coerce

Note [Eager reflexivity check]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have

  newtype X = MkX (Int -&gt; X)

and

  [W] X ~R X

Naively, we would start unwrapping X and end up in a loop. Instead,
we do this eager reflexivity check. This is necessary only for representational
equality because the rewriter technology deals with the similar case
(recursive type families) for nominal equality.

Note that this check does not catch all cases, but it will catch the cases
we're most worried about, types like X above that are actually inhabited.

Here's another place where this reflexivity check is key:
Consider trying to prove (f a) ~R (f a). The AppTys in there can't
be decomposed, because representational equality isn't congruent with respect
to AppTy. So, when canonicalising the equality above, we get stuck and
would normally produce a CIrredCan. However, we really do want to
be able to solve (f a) ~R (f a). So, in the representational case only,
we do a reflexivity check.

(This would be sound in the nominal case, but unnecessary, and I [Richard
E.] am worried that it would slow down the common case.)

 Note [Newtypes can blow the stack]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have

  newtype X = MkX (Int -&gt; X)
  newtype Y = MkY (Int -&gt; Y)

and now wish to prove

  [W] X ~R Y

This Wanted will loop, expanding out the newtypes ever deeper looking
for a solid match or a solid discrepancy. Indeed, there is something
appropriate to this looping, because X and Y *do* have the same representation,
in the limit -- they're both (Fix ((-&gt;) Int)). However, no finitely-sized
coercion will ever witness it. This loop won't actually cause GHC to hang,
though, because we check our depth in `can_eq_newtype_nc`.
-}</span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-1491"></span><span class="annot"><span class="hs-comment">-- | We're able to unwrap a newtype. Update the bits accordingly.</span></span><span>
</span><span id="line-1492"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_newtype_nc"><span class="hs-identifier hs-type">can_eq_newtype_nc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>           </span><span class="annot"><span class="hs-comment">-- ^ :: ty1 ~ ty2</span></span><span>
</span><span id="line-1493"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-1494"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>                                    </span><span class="annot"><span class="hs-comment">-- ^ ty1</span></span><span>
</span><span id="line-1495"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercion"><span class="hs-identifier hs-type">TcCoercion</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ :: ty1 ~ ty1'</span></span><span>
</span><span id="line-1496"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ ty2</span></span><span>
</span><span id="line-1497"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>               </span><span class="annot"><span class="hs-comment">-- ^ ty2, with type synonyms</span></span><span>
</span><span id="line-1498"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1499"></span><span id="can_eq_newtype_nc"><span class="annot"><span class="annottext">can_eq_newtype_nc :: CtEvidence
-&gt; SwapFlag
-&gt; Type
-&gt; ((Bag GlobalRdrElt, TcCoercion), Type)
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_newtype_nc"><span class="hs-identifier hs-var hs-var">can_eq_newtype_nc</span></a></span></span><span> </span><span id="local-6989586621682008509"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008509"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008510"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008510"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008511"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008511"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682008512"><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621682008512"><span class="hs-identifier hs-var">gres</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008513"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008513"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008514"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008514"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008515"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008515"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008516"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008516"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1500"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;can_eq_newtype_nc&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1501"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008509"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008510"><span class="hs-identifier hs-var">swapped</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008513"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621682008512"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008514"><span class="hs-identifier hs-var">ty1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008515"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1502"></span><span>
</span><span id="line-1503"></span><span>         </span><span class="hs-comment">-- Check for blowing our stack, and increase the depth</span><span>
</span><span id="line-1504"></span><span>         </span><span class="hs-comment">-- See Note [Newtypes can blow the stack]</span><span>
</span><span id="line-1505"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008517"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682008517"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008509"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1506"></span><span>             </span><span id="local-6989586621682008518"><span class="annot"><span class="annottext">ev' :: CtEvidence
</span><a href="#local-6989586621682008518"><span class="hs-identifier hs-var hs-var">ev'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008509"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#setCtEvLoc"><span class="hs-operator hs-var">`setCtEvLoc`</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#bumpCtLocDepth"><span class="hs-identifier hs-var">bumpCtLocDepth</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008517"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1507"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#checkReductionDepth"><span class="hs-identifier hs-var">checkReductionDepth</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008517"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008511"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1508"></span><span>
</span><span id="line-1509"></span><span>         </span><span class="hs-comment">-- Next, we record uses of newtype constructors, since coercing</span><span>
</span><span id="line-1510"></span><span>         </span><span class="hs-comment">-- through newtypes is tantamount to using their constructors.</span><span>
</span><span id="line-1511"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#recordUsedGREs"><span class="hs-identifier hs-var">recordUsedGREs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag GlobalRdrElt
</span><a href="#local-6989586621682008512"><span class="hs-identifier hs-var">gres</span></a></span><span>
</span><span id="line-1512"></span><span>
</span><span id="line-1513"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008523"><span class="annot"><span class="annottext">redn1 :: Reduction
</span><a href="#local-6989586621682008523"><span class="hs-identifier hs-var hs-var">redn1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReduction"><span class="hs-identifier hs-var">mkReduction</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008513"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008514"><span class="hs-identifier hs-var">ty1'</span></a></span><span>
</span><span id="line-1514"></span><span>
</span><span id="line-1515"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008525"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008525"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-var">emptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008518"><span class="hs-identifier hs-var">ev'</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008510"><span class="hs-identifier hs-var">swapped</span></a></span><span>
</span><span id="line-1516"></span><span>                     </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008523"><span class="hs-identifier hs-var">redn1</span></a></span><span>
</span><span id="line-1517"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008516"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1518"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc"><span class="hs-identifier hs-var">can_eq_nc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008525"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008514"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008514"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008515"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008516"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span class="hs-comment">---------</span><span>
</span><span id="line-1521"></span><span class="hs-comment">-- ^ Decompose a type application.</span><span>
</span><span id="line-1522"></span><span class="hs-comment">-- All input types must be rewritten. See Note [Canonicalising type applications]</span><span>
</span><span id="line-1523"></span><span class="hs-comment">-- Nominal equality only!</span><span>
</span><span id="line-1524"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#can_eq_app"><span class="hs-identifier hs-type">can_eq_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>       </span><span class="hs-comment">-- :: s1 t1 ~N s2 t2</span><span>
</span><span id="line-1525"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Xi"><span class="hs-identifier hs-type">Xi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Xi"><span class="hs-identifier hs-type">Xi</span></a></span><span>         </span><span class="hs-comment">-- s1 t1</span><span>
</span><span id="line-1526"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Xi"><span class="hs-identifier hs-type">Xi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Xi"><span class="hs-identifier hs-type">Xi</span></a></span><span>         </span><span class="hs-comment">-- s2 t2</span><span>
</span><span id="line-1527"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span class="hs-comment">-- AppTys only decompose for nominal equality, so this case just leads</span><span>
</span><span id="line-1530"></span><span class="hs-comment">-- to an irreducible constraint; see typecheck/should_compile/T10494</span><span>
</span><span id="line-1531"></span><span class="hs-comment">-- See Note [Decomposing AppTy equalities]</span><span>
</span><span id="line-1532"></span><span id="can_eq_app"><span class="annot"><span class="annottext">can_eq_app :: CtEvidence
-&gt; Type -&gt; Type -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_app"><span class="hs-identifier hs-var hs-var">can_eq_app</span></a></span></span><span> </span><span id="local-6989586621682008530"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008531"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008531"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682008532"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008532"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682008533"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008533"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span id="local-6989586621682008534"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008534"><span class="hs-identifier hs-var">t2</span></a></span></span><span>
</span><span id="line-1533"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008535"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008535"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008536"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008536"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1534"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008537"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008537"><span class="hs-identifier hs-var">co_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008536"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008538"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008531"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008533"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-1535"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008539"><span class="annot"><span class="annottext">arg_loc :: CtLoc
</span><a href="#local-6989586621682008539"><span class="hs-identifier hs-var hs-var">arg_loc</span></a></span></span><span>
</span><span id="line-1536"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isNextArgVisible"><span class="hs-identifier hs-var">isNextArgVisible</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008531"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008538"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-1537"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (CtOrigin -&gt; CtOrigin) -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#updateCtLocOrigin"><span class="hs-identifier hs-var">updateCtLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008538"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#toInvisibleOrigin"><span class="hs-identifier hs-var">toInvisibleOrigin</span></a></span><span>
</span><span id="line-1538"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008542"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008542"><span class="hs-identifier hs-var">co_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008536"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008539"><span class="hs-identifier hs-var">arg_loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008532"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008534"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1539"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008543"><span class="annot"><span class="annottext">co :: TcCoercion
</span><a href="#local-6989586621682008543"><span class="hs-identifier hs-var hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008537"><span class="hs-identifier hs-var">co_s</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008542"><span class="hs-identifier hs-var">co_t</span></a></span><span>
</span><span id="line-1540"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TcEvDest -&gt; TcCoercion -&gt; TcS ()
TcEvDest -&gt; TcCoercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008535"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008543"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1541"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Decomposed [W] AppTy&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1542"></span><span>
</span><span id="line-1543"></span><span>    </span><span class="hs-comment">-- If there is a ForAll/(-&gt;) mismatch, the use of the Left coercion</span><span>
</span><span id="line-1544"></span><span>    </span><span class="hs-comment">-- below is ill-typed, potentially leading to a panic in splitTyConApp</span><span>
</span><span id="line-1545"></span><span>    </span><span class="hs-comment">-- Test case: typecheck/should_run/Typeable1</span><span>
</span><span id="line-1546"></span><span>    </span><span class="hs-comment">-- We could also include this mismatch check above (for W and D), but it's slow</span><span>
</span><span id="line-1547"></span><span>    </span><span class="hs-comment">-- and we'll get a better error message not doing it</span><span>
</span><span id="line-1548"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008545"><span class="hs-identifier hs-var">s1k</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682008546"><span class="hs-operator hs-var">`mismatches`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008547"><span class="hs-identifier hs-var">s2k</span></a></span><span>
</span><span id="line-1549"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqHardFailure"><span class="hs-identifier hs-var">canEqHardFailure</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008531"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008532"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008533"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-operator hs-var">`mkAppTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008534"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span>
</span><span id="line-1551"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008548"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008548"><span class="hs-identifier hs-var">evar</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1552"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008549"><span class="annot"><span class="annottext">co :: TcCoercion
</span><a href="#local-6989586621682008549"><span class="hs-identifier hs-var hs-var">co</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008548"><span class="hs-identifier hs-var">evar</span></a></span><span>
</span><span id="line-1553"></span><span>             </span><span id="local-6989586621682008551"><span class="annot"><span class="annottext">co_s :: TcCoercion
</span><a href="#local-6989586621682008551"><span class="hs-identifier hs-var hs-var">co_s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CLeft"><span class="hs-identifier hs-var">CLeft</span></a></span><span>  </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008549"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1554"></span><span>             </span><span id="local-6989586621682008554"><span class="annot"><span class="annottext">co_t :: TcCoercion
</span><a href="#local-6989586621682008554"><span class="hs-identifier hs-var hs-var">co_t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CRight"><span class="hs-identifier hs-var">CRight</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008549"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1555"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008556"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008556"><span class="hs-identifier hs-var">evar_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008538"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#mkTcEqPredLikeEv"><span class="hs-identifier hs-var">mkTcEqPredLikeEv</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008531"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008533"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-1556"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008551"><span class="hs-identifier hs-var">co_s</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1557"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008558"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008558"><span class="hs-identifier hs-var">evar_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008538"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#mkTcEqPredLikeEv"><span class="hs-identifier hs-var">mkTcEqPredLikeEv</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008532"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008534"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1558"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008554"><span class="hs-identifier hs-var">co_t</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[CtEvidence] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-var">emitWorkNC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008558"><span class="hs-identifier hs-var">evar_t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1560"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqNC"><span class="hs-identifier hs-var">canEqNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008556"><span class="hs-identifier hs-var">evar_s</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008531"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008533"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1561"></span><span>
</span><span id="line-1562"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1563"></span><span>    </span><span id="local-6989586621682008538"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682008538"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008530"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1564"></span><span>
</span><span id="line-1565"></span><span>    </span><span id="local-6989586621682008545"><span class="annot"><span class="annottext">s1k :: Type
</span><a href="#local-6989586621682008545"><span class="hs-identifier hs-var hs-var">s1k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008531"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-1566"></span><span>    </span><span id="local-6989586621682008547"><span class="annot"><span class="annottext">s2k :: Type
</span><a href="#local-6989586621682008547"><span class="hs-identifier hs-var hs-var">s2k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008533"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-1567"></span><span>
</span><span id="line-1568"></span><span>    </span><span id="local-6989586621682008561"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008561"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621682008546"><span class="annot"><span class="annottext">mismatches :: Type -&gt; Type -&gt; Bool
</span><a href="#local-6989586621682008546"><span class="hs-operator hs-var hs-var">`mismatches`</span></a></span></span><span> </span><span id="local-6989586621682008562"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008562"><span class="hs-identifier hs-var">k2</span></a></span></span><span>
</span><span id="line-1569"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008561"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008562"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1570"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008561"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008562"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-1571"></span><span>
</span><span id="line-1572"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1573"></span><span class="hs-comment">-- | Break apart an equality over a casted type</span><span>
</span><span id="line-1574"></span><span class="hs-comment">-- looking like   (ty1 |&gt; co1) ~ ty2   (modulo a swap-flag)</span><span>
</span><span id="line-1575"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqCast"><span class="hs-identifier hs-type">canEqCast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>         </span><span class="hs-comment">-- are both types rewritten?</span><span>
</span><span id="line-1576"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-1577"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-1578"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-1579"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="hs-comment">-- LHS (res. RHS), ty1 |&gt; co1</span><span>
</span><span id="line-1580"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>     </span><span class="hs-comment">-- RHS (res. LHS), ty2 both normal and pretty</span><span>
</span><span id="line-1581"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1582"></span><span id="canEqCast"><span class="annot"><span class="annottext">canEqCast :: Bool
-&gt; CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; Type
-&gt; TcCoercion
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCast"><span class="hs-identifier hs-var hs-var">canEqCast</span></a></span></span><span> </span><span id="local-6989586621682008565"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008565"><span class="hs-identifier hs-var">rewritten</span></a></span></span><span> </span><span id="local-6989586621682008566"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008566"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008567"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008567"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008568"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008568"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008569"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008569"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008570"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008570"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621682008571"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008571"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682008572"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008572"><span class="hs-identifier hs-var">ps_ty2</span></a></span></span><span>
</span><span id="line-1583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Decomposing cast&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008566"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1584"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008569"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;|&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008570"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1585"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008572"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1586"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008573"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008573"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-var">emptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008566"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008568"><span class="hs-identifier hs-var">swapped</span></a></span><span>
</span><span id="line-1587"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; TcCoercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflLeftRedn"><span class="hs-identifier hs-var">mkGReflLeftRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008575"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008569"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008570"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008575"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008572"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1589"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; CtEvidence
-&gt; EqRel
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#can_eq_nc"><span class="hs-identifier hs-var">can_eq_nc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008565"><span class="hs-identifier hs-var">rewritten</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008573"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008567"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008569"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008569"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008571"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008572"><span class="hs-identifier hs-var">ps_ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1590"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1591"></span><span>    </span><span id="local-6989586621682008575"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621682008575"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008567"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-1592"></span><span>
</span><span id="line-1593"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-1594"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canTyConApp"><span class="hs-identifier hs-type">canTyConApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-1595"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1596"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1597"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1598"></span><span class="hs-comment">-- See Note [Decomposing TyConApp equalities]</span><span>
</span><span id="line-1599"></span><span class="hs-comment">-- See Note [Decomposing Dependent TyCons and Processing Wanted Equalities]</span><span>
</span><span id="line-1600"></span><span class="hs-comment">-- Neither tc1 nor tc2 is a saturated funTyCon, nor a type family</span><span>
</span><span id="line-1601"></span><span class="hs-comment">-- But they can be data families.</span><span>
</span><span id="line-1602"></span><span id="canTyConApp"><span class="annot"><span class="annottext">canTyConApp :: CtEvidence
-&gt; EqRel
-&gt; TyCon
-&gt; [Type]
-&gt; TyCon
-&gt; [Type]
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canTyConApp"><span class="hs-identifier hs-var hs-var">canTyConApp</span></a></span></span><span> </span><span id="local-6989586621682008576"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008576"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008577"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008577"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008578"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621682008579"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008579"><span class="hs-identifier hs-var">tys1</span></a></span></span><span> </span><span id="local-6989586621682008580"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008580"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621682008581"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008581"><span class="hs-identifier hs-var">tys2</span></a></span></span><span>
</span><span id="line-1603"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008580"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1604"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008579"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008581"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1605"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008582"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682008582"><span class="hs-identifier hs-var">inerts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS InertSet
</span><a href="GHC.Tc.Solver.Monad.html#getTcSInerts"><span class="hs-identifier hs-var">getTcSInerts</span></a></span><span>
</span><span id="line-1606"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; Bool
</span><a href="#local-6989586621682008584"><span class="hs-identifier hs-var">can_decompose</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682008582"><span class="hs-identifier hs-var">inerts</span></a></span><span>
</span><span id="line-1607"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; TyCon -&gt; [Type] -&gt; [Type] -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canDecomposableTyConAppOK"><span class="hs-identifier hs-var">canDecomposableTyConAppOK</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008576"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008577"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008579"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008581"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1608"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqFailure"><span class="hs-identifier hs-var">canEqFailure</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008576"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008577"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008587"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008588"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1609"></span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-comment">-- See Note [Skolem abstract data] in GHC.Core.Tycon</span><span>
</span><span id="line-1611"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tyConSkolem"><span class="hs-identifier hs-var">tyConSkolem</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tyConSkolem"><span class="hs-identifier hs-var">tyConSkolem</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008580"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1612"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canTyConApp: skolem abstract&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008580"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1613"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#AbstractTyConReason"><span class="hs-identifier hs-var">AbstractTyConReason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008576"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1614"></span><span>
</span><span id="line-1615"></span><span>  </span><span class="hs-comment">-- Fail straight away for better error messages</span><span>
</span><span id="line-1616"></span><span>  </span><span class="hs-comment">-- See Note [Use canEqFailure in canDecomposableTyConApp]</span><span>
</span><span id="line-1617"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008577"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Role -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1618"></span><span>                             </span><span class="annot"><span class="annottext">TyCon -&gt; Role -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGenerativeTyCon"><span class="hs-identifier hs-var">isGenerativeTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008580"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1619"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqFailure"><span class="hs-identifier hs-var">canEqFailure</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008576"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008577"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008587"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008588"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1622"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqHardFailure"><span class="hs-identifier hs-var">canEqHardFailure</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008576"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008587"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008588"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1623"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1624"></span><span>    </span><span class="hs-comment">-- Reconstruct the types for error messages. This would do</span><span>
</span><span id="line-1625"></span><span>    </span><span class="hs-comment">-- the wrong thing (from a pretty printing point of view)</span><span>
</span><span id="line-1626"></span><span>    </span><span class="hs-comment">-- for functions, because we've lost the FunTyFlag; but</span><span>
</span><span id="line-1627"></span><span>    </span><span class="hs-comment">-- in fact we never call canTyConApp on a saturated FunTyCon</span><span>
</span><span id="line-1628"></span><span>    </span><span id="local-6989586621682008587"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682008587"><span class="hs-identifier hs-var hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008579"><span class="hs-identifier hs-var">tys1</span></a></span><span>
</span><span id="line-1629"></span><span>    </span><span id="local-6989586621682008588"><span class="annot"><span class="annottext">ty2 :: Type
</span><a href="#local-6989586621682008588"><span class="hs-identifier hs-var hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008580"><span class="hs-identifier hs-var">tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008581"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1630"></span><span>
</span><span id="line-1631"></span><span>     </span><span class="hs-comment">-- See Note [Decomposing TyConApp equalities]</span><span>
</span><span id="line-1632"></span><span>     </span><span class="hs-comment">-- and Note [Decomposing newtype equalities]</span><span>
</span><span id="line-1633"></span><span>    </span><span id="local-6989586621682008584"><span class="annot"><span class="annottext">can_decompose :: InertSet -&gt; Bool
</span><a href="#local-6989586621682008584"><span class="hs-identifier hs-var hs-var">can_decompose</span></a></span></span><span> </span><span id="local-6989586621682008592"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682008592"><span class="hs-identifier hs-var">inerts</span></a></span></span><span>
</span><span id="line-1634"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">TyCon -&gt; Role -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isInjectiveTyCon"><span class="hs-identifier hs-var">isInjectiveTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008577"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1635"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008577"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; EqRel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1636"></span><span>          </span><span class="hs-comment">-- assert: isInjectiveTyCon is always True for Nominal except</span><span>
</span><span id="line-1637"></span><span>          </span><span class="hs-comment">--   for type synonyms/families, neither of which happen here</span><span>
</span><span id="line-1638"></span><span>          </span><span class="hs-comment">-- Moreover isInjectiveTyCon is True for Representational</span><span>
</span><span id="line-1639"></span><span>          </span><span class="hs-comment">--   for algebraic data types.  So we are down to newtypes</span><span>
</span><span id="line-1640"></span><span>          </span><span class="hs-comment">--   and data families.</span><span>
</span><span id="line-1641"></span><span>          </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008576"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">CtFlavour -&gt; CtFlavour -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; InertSet -&gt; Bool
</span><a href="GHC.Tc.Solver.InertSet.html#noGivenNewtypeReprEqs"><span class="hs-identifier hs-var">noGivenNewtypeReprEqs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008578"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621682008592"><span class="hs-identifier hs-var">inerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1642"></span><span>             </span><span class="hs-comment">-- See Note [Decomposing newtype equalities] (EX2)</span><span>
</span><span id="line-1643"></span><span>
</span><span id="line-1644"></span><span class="hs-comment">{-
Note [Use canEqFailure in canDecomposableTyConApp]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We must use canEqFailure, not canEqHardFailure here, because there is
the possibility of success if working with a representational equality.
Here is one case:

  type family TF a where TF Char = Bool
  data family DF a
  newtype instance DF Bool = MkDF Int

Suppose we are canonicalising (Int ~R DF (TF a)), where we don't yet
know `a`. This is *not* a hard failure, because we might soon learn
that `a` is, in fact, Char, and then the equality succeeds.

Here is another case:

  [G] Age ~R Int

where Age's constructor is not in scope. We don't want to report
an &quot;inaccessible code&quot; error in the context of this Given!

For example, see typecheck/should_compile/T10493, repeated here:

  import Data.Ord (Down)  -- no constructor

  foo :: Coercible (Down Int) Int =&gt; Down Int -&gt; Int
  foo = coerce

That should compile, but only because we use canEqFailure and not
canEqHardFailure.

Note [Fast path when decomposing TyConApps]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we see (T s1 t1 ~ T s2 t2), then we can just decompose to
  (s1 ~ s2, t1 ~ t2)
and push those back into the work list.  But if
  s1 = K k1    s2 = K k2
then we will just decompose s1~s2, and it might be better to
do so on the spot.  An important special case is where s1=s2,
and we get just Refl.

So canDecomposableTyConAppOK uses unifyWanted etc to short-cut that work.
See also Note [Decomposing Dependent TyCons and Processing Wanted Equalities]

Note [Decomposing TyConApp equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
        [G/W] T ty1 ~r T ty2
Can we decompose it, and replace it by
        [G/W] ty1 ~r' ty2
and if so what role is r'?  (In this Note, all the &quot;~&quot; are primitive
equalities &quot;~#&quot;, but I have dropped the noisy &quot;#&quot; symbols.)  Lots of
background in the paper &quot;Safe zero-cost coercions for Haskell&quot;.

This Note covers the topic for
  * Datatypes
  * Newtypes
  * Data families
For the rest:
  * Type synonyms: are always expanded
  * Type families: see Note [Decomposing type family applications]
  * AppTy:         see Note [Decomposing AppTy equalities].

---- Roles of the decomposed constraints ----
For a start, the role r' will always be defined like this:
  * If r=N then r' = N
  * If r=R then r' = role of T's first argument

For example:
   data TR a = MkTR a       -- Role of T's first arg is Representational
   data TN a = MkTN (F a)   -- Role of T's first arg is Nominal

The function tyConRolesX :: Role -&gt; TyCon -&gt; [Role] gets the argument
role r' for a TyCon T at role r.  E.g.
   tyConRolesX Nominal          TR = [Nominal]
   tyConRolesX Representational TR = [Representational]

---- Soundness and completeness ----
For Givens, for /soundness/ of decomposition we need, forall ty1,ty2:
    T ty1 ~r T ty2   ===&gt;    ty1 ~r' ty2
Here &quot;===&gt;&quot; means &quot;implies&quot;.  That is, given evidence for (co1 : T ty1 ~r T co2)
we can produce evidence for (co2 : ty1 ~r' ty2).  But in the solver we
/replace/ co1 with co2 in the inert set, and we don't want to lose any proofs
thereby. So for /completeness/ of decomposition we also need the reverse:
    ty1 ~r' ty2   ===&gt;    T ty1 ~r T ty2

For Wanteds, for /soundness/ of decomposition we need:
    ty1 ~r' ty2   ===&gt;    T ty1 ~r T ty2
because if we do decompose we'll get evidence (co2 : ty1 ~r' ty2) and
from that we want to derive evidence (T co2 : T ty1 ~r T ty2).
For /completeness/ of decomposition we need the reverse implication too,
else we may decompose to a new proof obligation that is stronger than
the one we started with.  See Note [Decomposing newtype equalities].

---- Injectivity ----
When do these bi-implications hold? In one direction it is easy.
We /always/ have
    ty1 ~r'  ty2   ===&gt;    T ty1 ~r T ty2
This is the CO_TYCONAPP rule of the paper (Fig 5); see also the
TyConAppCo case of GHC.Core.Lint.lintCoercion.

In the other direction, we have
    T ty1 ~r T ty2   ==&gt;   ty1 ~r' ty2  if T is /injective at role r/
This is the very /definition/ of injectivity: injectivity means result
is the same =&gt; arguments are the same, modulo the role shift.
See comments on GHC.Core.TyCon.isInjectiveTyCon.  This is also
the CO_NTH rule in Fig 5 of the paper, except in the paper only
newtypes are non-injective at representation role, so the rule says &quot;H
is not a newtype&quot;.

Injectivity is a bit subtle:
                 Nominal   Representational
   Datatype        YES        YES
   Newtype         YES        NO{1}
   Data family     YES        NO{2}

{1} Consider newtype N a = MkN (F a)   -- Arg has Nominal role
    Is it true that (N t1) ~R (N t2)   ==&gt;   t1 ~N t2  ?
    No, absolutely not.  E.g.
       type instance F Int = Int; type instance F Bool = Char
       Then (N Int) ~R (N Bool), by unwrapping, but we don't want Int~Char!

    See Note [Decomposing newtype equalities]

{2} We must treat data families precisely like newtypes, because of the
    possibility of newtype instances. See also
    Note [Decomposing newtype equalities]. See #10534 and
    test case typecheck/should_fail/T10534.

---- Takeaway summary -----
For sound and complete decomposition, we simply need injectivity;
that is for isInjectiveTyCon to be true:

* At Nominal role, isInjectiveTyCon is True for all the TyCons we are
  considering in this Note: datatypes, newtypes, and data families.

* For Givens, injectivity is necessary for soundness; completeness has no
  side conditions.

* For Wanteds, soundness has no side conditions; but injectivity is needed
  for completeness. See Note [Decomposing newtype equalities]

This is implemented in `can_decompose` in `canTyConApp`; it looks at
injectivity, just as specified above.


Note [Decomposing type family applications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Supose we have
   [G/W]  (F ty1) ~r  (F ty2)
This is handled by the TyFamLHS/TyFamLHS case of canEqCanLHS2.

We never decompose to
   [G/W]  ty1 ~r' ty2

Instead

* For Givens we do nothing. Injective type families have no corresponding
  evidence of their injectivity, so we cannot decompose an
  injective-type-family Given.

* For Wanteds, for the Nominal role only, we emit new Wanteds rather like
  functional dependencies, for each injective argument position.

  E.g type family F a b   -- injective in first arg, but not second
      [W] (F s1 t1) ~N (F s2 t2)
  Emit new Wanteds
      [W] s1 ~N s2
  But retain the existing, unsolved constraint.

Note [Decomposing newtype equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This Note also applies to data families, which we treat like
newtype in case of 'newtype instance'.

As Note [Decomposing TyConApp equalities] describes, if N is injective
at role r, we can do this decomposition?
   [G/W] (N ty1) ~r (N ty2)    to     [G/W]  ty1 ~r' ty2

For a Given with r=R, the answer is a solid NO: newtypes are not injective at
representational role, and we must not decompose, or we lose soundness.
Example is wrinkle {1} in Note [Decomposing TyConApp equalities].

For a Wanted with r=R, since newtypes are not injective at representational
role, decomposition is sound, but we may lose completeness.  Nevertheless,
if the newtype is abstract (so can't be unwrapped) we can only solve
the equality by (a) using a Given or (b) decomposition.  If (a) is impossible
(e.g. no Givens) then (b) is safe albeit potentially incomplete.

There are two ways in which decomposing (N ty1) ~r (N ty2) could be incomplete:

* Incompleteness example (EX1): unwrap first
      newtype Nt a = MkNt (Id a)
      type family Id a where Id a = a

      [W] Nt Int ~R Nt Age

  Because of its use of a type family, Nt's parameter will get inferred to
  have a nominal role. Thus, decomposing the wanted will yield [W] Int ~N Age,
  which is unsatisfiable. Unwrapping, though, leads to a solution.

  Conclusion: always unwrap newtypes before attempting to decompose
  them.  This is done in can_eq_nc'.  Of course, we can't unwrap if the data
  constructor isn't in scope.  See Note [Unwrap newtypes first].

* Incompleteness example (EX2): available Givens
      newtype Nt a = Mk Bool         -- NB: a is not used in the RHS,
      type role Nt representational  -- but the user gives it an R role anyway

      [G] Nt t1 ~R Nt t2
      [W] Nt alpha ~R Nt beta

  We *don't* want to decompose to [W] alpha ~R beta, because it's possible
  that alpha and beta aren't representationally equal.  And if we figure
  out (elsewhere) that alpha:=t1 and beta:=t2, we can solve the Wanted
  from the Given.  This is somewhat similar to the question of overlapping
  Givens for class constraints: see Note [Instance and Given overlap] in
  GHC.Tc.Solver.Interact.

  Conclusion: don't decompose [W] N s ~R N t, if there are any Given
  equalities that could later solve it.

  But what precisely does it mean to say &quot;any Given equalities that could
  later solve it&quot;?

  In #22924 we had
     [G] f a ~R# a     [W] Const (f a) a ~R# Const a a
  where Const is an abstract newtype.  If we decomposed the newtype, we
  could solve.  Not-decomposing on the grounds that (f a ~R# a) might turn
  into (Const (f a) a ~R# Const a a) seems a bit silly.

  In #22331 we had
     [G] N a ~R# N b   [W] N b ~R# N a
  (where N is abstract so we can't unwrap). Here we really /don't/ want to
  decompose, because the /only/ way to solve the Wanted is from that Given
  (with a Sym).

  In #22519 we had
     [G] a &lt;= b     [W] IO Age ~R# IO Int

  (where IO is abstract so we can't unwrap, and newtype Age = Int; and (&lt;=)
  is a type-level comparison on Nats).  Here we /must/ decompose, despite the
  existence of an Irred Given, or we will simply be stuck.  (Side note: We
  flirted with deep-rewriting of newtypes (see discussion on #22519 and
  !9623) but that turned out not to solve #22924, and also makes type
  inference loop more often on recursive newtypes.)

  The currently-implemented compromise is this:

    we decompose [W] N s ~R# N t unless there is a [G] N s' ~ N t'

  that is, a Given Irred equality with both sides headed with N.
  See the call to noGivenNewtypeReprEqs in canTyConApp.

  This is not perfect.  In principle a Given like [G] (a b) ~ (c d), or
  even just [G] c, could later turn into N s ~ N t.  But since the free
  vars of a Given are skolems, or at least untouchable unification
  variables, this is extremely unlikely to happen.

  Another worry: there could, just, be a CDictCan with some
  un-expanded equality superclasses; but only in some very obscure
  recursive-superclass situations.

   Yet another approach (!) is desribed in
   Note [Decomposing newtypes a bit more aggressively].

Remember: decomposing Wanteds is always /sound/. This Note is
only about /completeness/.

Note [Decomposing newtypes a bit more aggressively]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
IMPORTANT: the ideas in this Note are *not* implemented. Instead, the
current approach is detailed in Note [Decomposing newtype equalities]
and Note [Unwrap newtypes first].
For more details about the ideas in this Note see
  * GHC propoosal: https://github.com/ghc-proposals/ghc-proposals/pull/549
  * issue #22441
  * discussion on !9282.

Consider [G] c, [W] (IO Int) ~R (IO Age)
where IO is abstract, and
   newtype Age = MkAge Int   -- Not abstract
With the above rules, if there any Given Irreds,
the Wanted is insoluble because we can't decompose it.  But in fact,
if we look at the defn of IO, roughly,
    newtype IO a = State# -&gt; (State#, a)
we can see that decomposing [W] (IO Int) ~R (IO Age) to
    [W] Int ~R Age
definitely does not lose completeness. Why not? Because the role of
IO's argment is representational.  Hence:

  DecomposeNewtypeIdea:
     decompose [W] (N s1 .. sn) ~R (N t1 .. tn)
     if the roles of all N's arguments are representational

If N's arguments really /are/ representational this will not lose
completeness.  Here &quot;really are representational&quot; means &quot;if you expand
all newtypes in N's RHS, we'd infer a representational role for each
of N's type variables in that expansion&quot;.  See Note [Role inference]
in GHC.Tc.TyCl.Utils.

But the user might /override/ a phantom role with an explicit role
annotation, and then we could (obscurely) get incompleteness.
Consider

   module A( silly, T ) where
     newtype T a = MkT Int
     type role T representational  -- Override phantom role

     silly :: Coercion (T Int) (T Bool)
     silly = Coercion  -- Typechecks by unwrapping the newtype

     data Coercion a b where  -- Actually defined in Data.Type.Coercion
       Coercion :: Coercible a b =&gt; Coercion a b

   module B where
     import A
     f :: T Int -&gt; T Bool
     f = case silly of Coercion -&gt; coerce

Here the `coerce` gives [W] (T Int) ~R (T Bool) which, if we decompose,
we'll get stuck with (Int ~R Bool).  Instead we want to use the
[G] (T Int) ~R (T Bool), which will be in the Irreds.

Summary: we could adopt (DecomposeNewtypeIdea), at the cost of a very
obscure incompleteness (above).  But no one is reporting a problem from
the lack of decompostion, so we'll just leave it for now.  This long
Note is just to record the thinking for our future selves.

Note [Decomposing AppTy equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For AppTy all the same questions arise as in
Note [Decomposing TyConApp equalities]. We have

    s1 ~r s2,  t1 ~N t2   ==&gt;   s1 t1 ~r s2 t2       (rule CO_APP)
    s1 t1 ~N s2 t2        ==&gt;   s1 ~N s2,  t1 ~N t2  (CO_LEFT, CO_RIGHT)

In the first of these, why do we need Nominal equality in (t1 ~N t2)?
See {2} below.

For sound and complete solving, we need both directions to decompose. So:
* At nominal role, all is well: we have both directions.
* At representational role, decomposition of Givens is unsound (see {1} below),
  and decomposition of Wanteds is incomplete.

Here is an example of the incompleteness for Wanteds:

    [G] g1 :: a ~R b
    [W] w1 :: Maybe b ~R alpha a
    [W] w2 :: alpha ~N Maybe

Suppose we see w1 before w2. If we decompose, using AppCo to prove w1, we get

    w1 := AppCo w3 w4
    [W] w3 :: Maybe ~R alpha
    [W] w4 :: b ~N a

Note that w4 is *nominal*. A nominal role here is necessary because AppCo
requires a nominal role on its second argument. (See {2} for an example of
why.) Now we are stuck, because w4 is insoluble. On the other hand, if we
see w2 first, setting alpha := Maybe, all is well, as we can decompose
Maybe b ~R Maybe a into b ~R a.

Another example:
    newtype Phant x = MkPhant Int
    [W] w1 :: Phant Int ~R alpha Bool
    [W] w2 :: alpha ~ Phant

If we see w1 first, decomposing would be disastrous, as we would then try
to solve Int ~ Bool. Instead, spotting w2 allows us to simplify w1 to become
    [W] w1' :: Phant Int ~R Phant Bool

which can then (assuming MkPhant is in scope) be simplified to Int ~R Int,
and all will be well. See also Note [Unwrap newtypes first].

Bottom line:
* Always decompose AppTy at nominal role: can_eq_app
* Never decompose AppTy at representational role (neither Given nor Wanted):
  the lack of an equation in can_eq_nc'

Extra points
{1}  Decomposing a Given AppTy over a representational role is simply
     unsound. For example, if we have co1 :: Phant Int ~R a Bool (for
     the newtype Phant, above), then we surely don't want any relationship
     between Int and Bool, lest we also have co2 :: Phant ~ a around.

{2} The role on the AppCo coercion is a conservative choice, because we don't
    know the role signature of the function. For example, let's assume we could
    have a representational role on the second argument of AppCo. Then, consider

    data G a where    -- G will have a nominal role, as G is a GADT
      MkG :: G Int
    newtype Age = MkAge Int

    co1 :: G ~R a        -- by assumption
    co2 :: Age ~R Int    -- by newtype axiom
    co3 = AppCo co1 co2 :: G Age ~R a Int    -- by our broken AppCo

    and now co3 can be used to cast MkG to have type G Age, in violation of
    the way GADTs are supposed to work (which is to use nominal equality).
-}</span><span>
</span><span id="line-2046"></span><span>
</span><span id="line-2047"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canDecomposableTyConAppOK"><span class="hs-identifier hs-type">canDecomposableTyConAppOK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-2048"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2049"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2050"></span><span class="hs-comment">-- Precondition: tys1 and tys2 are the same finite length, hence &quot;OK&quot;</span><span>
</span><span id="line-2051"></span><span id="canDecomposableTyConAppOK"><span class="annot"><span class="annottext">canDecomposableTyConAppOK :: CtEvidence
-&gt; EqRel -&gt; TyCon -&gt; [Type] -&gt; [Type] -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canDecomposableTyConAppOK"><span class="hs-identifier hs-var hs-var">canDecomposableTyConAppOK</span></a></span></span><span> </span><span id="local-6989586621682008597"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008597"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008598"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008598"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008599"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008599"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621682008600"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008600"><span class="hs-identifier hs-var">tys1</span></a></span></span><span> </span><span id="local-6989586621682008601"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008601"><span class="hs-identifier hs-var">tys2</span></a></span></span><span>
</span><span id="line-2052"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008600"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008601"><span class="hs-identifier hs-var">tys2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct))
-&gt; TcS (StopOrContinue Ct) -&gt; TcS (StopOrContinue Ct)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2053"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canDecomposableTyConAppOK&quot;</span></span><span>
</span><span id="line-2054"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008597"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008598"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008599"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008600"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008601"><span class="hs-identifier hs-var">tys2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2055"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008597"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2056"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008602"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008602"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008603"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008603"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2057"></span><span>                  </span><span class="hs-comment">-- new_locs and tc_roles are both infinite, so</span><span>
</span><span id="line-2058"></span><span>                  </span><span class="hs-comment">-- we are guaranteed that cos has the same lengthm</span><span>
</span><span id="line-2059"></span><span>                  </span><span class="hs-comment">-- as tys1 and tys2</span><span>
</span><span id="line-2060"></span><span>                  </span><span class="hs-comment">-- See Note [Fast path when decomposing TyConApps]</span><span>
</span><span id="line-2061"></span><span>                  </span><span class="hs-comment">-- Caution: unifyWanteds is order sensitive</span><span>
</span><span id="line-2062"></span><span>                  </span><span class="hs-comment">-- See Note [Decomposing Dependent TyCons and Processing Wanted Equalities]</span><span>
</span><span id="line-2063"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008604"><span class="annot"><span class="annottext">[TcCoercion]
</span><a href="#local-6989586621682008604"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; [CtLoc] -&gt; [Role] -&gt; [Type] -&gt; [Type] -&gt; TcS [TcCoercion]
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanteds"><span class="hs-identifier hs-var">unifyWanteds</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008603"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">[CtLoc]
</span><a href="#local-6989586621682008606"><span class="hs-identifier hs-var">new_locs</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682008607"><span class="hs-identifier hs-var">tc_roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008600"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008601"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-2064"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TcEvDest -&gt; TcCoercion -&gt; TcS ()
TcEvDest -&gt; TcCoercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008602"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Role -&gt; TyCon -&gt; [TcCoercion] -&gt; TcCoercion
Role -&gt; TyCon -&gt; [TcCoercion] -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008609"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008599"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcCoercion]
</span><a href="#local-6989586621682008604"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2065"></span><span>
</span><span id="line-2066"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008610"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008610"><span class="hs-identifier hs-var">evar</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2067"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008611"><span class="annot"><span class="annottext">ev_co :: TcCoercion
</span><a href="#local-6989586621682008611"><span class="hs-identifier hs-var hs-var">ev_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008610"><span class="hs-identifier hs-var">evar</span></a></span><span>
</span><span id="line-2068"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008612"><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621682008612"><span class="hs-identifier hs-var">given_evs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; [(Type, EvTerm)] -&gt; TcS [CtEvidence]
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVars"><span class="hs-identifier hs-var">newGivenEvVars</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008614"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">([(Type, EvTerm)] -&gt; TcS [CtEvidence])
-&gt; [(Type, EvTerm)] -&gt; TcS [CtEvidence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2069"></span><span>                                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008615"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008616"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008617"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2070"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercion -&gt; EvTerm) -&gt; TcCoercion -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoSel -&gt; TcCoercion -&gt; TcCoercion
CoSel -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Role -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelTyCon"><span class="hs-identifier hs-var">SelTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682008620"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008615"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008611"><span class="hs-identifier hs-var">ev_co</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2071"></span><span>                                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008615"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008615"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008616"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008616"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008617"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008617"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008620"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682008620"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; [Type] -&gt; [Type] -&gt; [Int] -&gt; [(Role, Type, Type, Int)]
forall a b c d. [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [(a, b, c, d)]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#zip4/Data.OldList.html#zip4"><span class="hs-identifier hs-var">zip4</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682008607"><span class="hs-identifier hs-var">tc_roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008600"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008601"><span class="hs-identifier hs-var">tys2</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-2072"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008615"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>
</span><span id="line-2073"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isCoercionTy"><span class="hs-identifier hs-var">isCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008616"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isCoercionTy"><span class="hs-identifier hs-var">isCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008617"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2074"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[CtEvidence] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-var">emitWorkNC</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621682008612"><span class="hs-identifier hs-var">given_evs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2075"></span><span>
</span><span id="line-2076"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008597"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Decomposed TyConApp&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2077"></span><span>
</span><span id="line-2078"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2079"></span><span>    </span><span id="local-6989586621682008614"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682008614"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008597"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2080"></span><span>    </span><span id="local-6989586621682008609"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621682008609"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008598"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-2081"></span><span>
</span><span id="line-2082"></span><span>    </span><span class="hs-comment">-- Infinite, to allow for over-saturated TyConApps</span><span>
</span><span id="line-2083"></span><span>    </span><span id="local-6989586621682008607"><span class="annot"><span class="annottext">tc_roles :: [Role]
</span><a href="#local-6989586621682008607"><span class="hs-identifier hs-var hs-var">tc_roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRoleListX"><span class="hs-identifier hs-var">tyConRoleListX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008609"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008599"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2084"></span><span>
</span><span id="line-2085"></span><span>      </span><span class="hs-comment">-- Add nuances to the location during decomposition:</span><span>
</span><span id="line-2086"></span><span>      </span><span class="hs-comment">--  * if the argument is a kind argument, remember this, so that error</span><span>
</span><span id="line-2087"></span><span>      </span><span class="hs-comment">--    messages say &quot;kind&quot;, not &quot;type&quot;. This is determined based on whether</span><span>
</span><span id="line-2088"></span><span>      </span><span class="hs-comment">--    the corresponding tyConBinder is named (that is, dependent)</span><span>
</span><span id="line-2089"></span><span>      </span><span class="hs-comment">--  * if the argument is invisible, note this as well, again by</span><span>
</span><span id="line-2090"></span><span>      </span><span class="hs-comment">--    looking at the corresponding binder</span><span>
</span><span id="line-2091"></span><span>      </span><span class="hs-comment">-- For oversaturated tycons, we need the (repeat loc) tail, which doesn't</span><span>
</span><span id="line-2092"></span><span>      </span><span class="hs-comment">-- do either of these changes. (Forgetting to do so led to #16188)</span><span>
</span><span id="line-2093"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-2094"></span><span>      </span><span class="hs-comment">-- NB: infinite in length</span><span>
</span><span id="line-2095"></span><span>    </span><span id="local-6989586621682008606"><span class="annot"><span class="annottext">new_locs :: [CtLoc]
</span><a href="#local-6989586621682008606"><span class="hs-identifier hs-var hs-var">new_locs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008625"><span class="hs-identifier hs-var">new_loc</span></a></span><span>
</span><span id="line-2096"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682008626"><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621682008626"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008599"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2097"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008628"><span class="annot"><span class="annottext">new_loc0 :: CtLoc
</span><a href="#local-6989586621682008628"><span class="hs-identifier hs-var hs-var">new_loc0</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNamedTyConBinder"><span class="hs-identifier hs-var">isNamedTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621682008626"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#toKindLoc"><span class="hs-identifier hs-var">toKindLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008614"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2098"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008614"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2099"></span><span>                     </span><span id="local-6989586621682008625"><span class="annot"><span class="annottext">new_loc :: CtLoc
</span><a href="#local-6989586621682008625"><span class="hs-identifier hs-var hs-var">new_loc</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
forall tv. VarBndr tv TyConBndrVis -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isInvisibleTyConBinder"><span class="hs-identifier hs-var">isInvisibleTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621682008626"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-2100"></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (CtOrigin -&gt; CtOrigin) -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#updateCtLocOrigin"><span class="hs-identifier hs-var">updateCtLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008628"><span class="hs-identifier hs-var">new_loc0</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#toInvisibleOrigin"><span class="hs-identifier hs-var">toInvisibleOrigin</span></a></span><span>
</span><span id="line-2101"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2102"></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008628"><span class="hs-identifier hs-var">new_loc0</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2103"></span><span>               </span><span class="annot"><span class="annottext">[CtLoc] -&gt; [CtLoc] -&gt; [CtLoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; [CtLoc]
forall a. a -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#repeat/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008614"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2104"></span><span>
</span><span id="line-2105"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canDecomposableFunTy"><span class="hs-identifier hs-type">canDecomposableFunTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#FunTyFlag"><span class="hs-identifier hs-type">FunTyFlag</span></a></span><span>
</span><span id="line-2106"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- (multiplicity,arg,res)</span><span>
</span><span id="line-2107"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- (multiplicity,arg,res)</span><span>
</span><span id="line-2108"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2109"></span><span id="canDecomposableFunTy"><span class="annot"><span class="annottext">canDecomposableFunTy :: CtEvidence
-&gt; EqRel
-&gt; FunTyFlag
-&gt; (Type, Type, Type)
-&gt; (Type, Type, Type)
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canDecomposableFunTy"><span class="hs-identifier hs-var hs-var">canDecomposableFunTy</span></a></span></span><span> </span><span id="local-6989586621682008633"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008633"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008634"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008634"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008635"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008635"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span id="local-6989586621682008636"><span class="annot"><span class="annottext">f1 :: (Type, Type, Type)
</span><a href="#local-6989586621682008636"><span class="hs-identifier hs-var">f1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682008637"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008637"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682008638"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008638"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682008639"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008639"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682008640"><span class="annot"><span class="annottext">f2 :: (Type, Type, Type)
</span><a href="#local-6989586621682008640"><span class="hs-identifier hs-var">f2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621682008641"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008641"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682008642"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008642"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682008643"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008643"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2110"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canDecomposableFunTy&quot;</span></span><span>
</span><span id="line-2111"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008633"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008634"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, Type, Type) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, Type, Type)
</span><a href="#local-6989586621682008636"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, Type, Type) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, Type, Type)
</span><a href="#local-6989586621682008640"><span class="hs-identifier hs-var">f2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2112"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008633"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2113"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008644"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008644"><span class="hs-identifier hs-var">dest</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008645"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008645"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2114"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008646"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008646"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008645"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008647"><span class="hs-identifier hs-var">mult_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var">funRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008649"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelMult"><span class="hs-identifier hs-var">SelMult</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008637"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008641"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-2115"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008651"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008651"><span class="hs-identifier hs-var">arg</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008645"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008652"><span class="hs-identifier hs-var">loc</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var">funRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008649"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelArg"><span class="hs-identifier hs-var">SelArg</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008638"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008642"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-2116"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008654"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008654"><span class="hs-identifier hs-var">res</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008645"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008652"><span class="hs-identifier hs-var">loc</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var">funRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008649"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelRes"><span class="hs-identifier hs-var">SelRes</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008639"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008643"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-2117"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TcEvDest -&gt; TcCoercion -&gt; TcS ()
TcEvDest -&gt; TcCoercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008644"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
-&gt; FunTyFlag
-&gt; TcCoercion
-&gt; TcCoercion
-&gt; TcCoercion
-&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkNakedFunCo1"><span class="hs-identifier hs-var">mkNakedFunCo1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008649"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008635"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008646"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008651"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008654"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2118"></span><span>
</span><span id="line-2119"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008657"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008657"><span class="hs-identifier hs-var">evar</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2120"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008658"><span class="annot"><span class="annottext">ev_co :: TcCoercion
</span><a href="#local-6989586621682008658"><span class="hs-identifier hs-var hs-var">ev_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008657"><span class="hs-identifier hs-var">evar</span></a></span><span>
</span><span id="line-2121"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008659"><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621682008659"><span class="hs-identifier hs-var">given_evs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; [(Type, EvTerm)] -&gt; TcS [CtEvidence]
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVars"><span class="hs-identifier hs-var">newGivenEvVars</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008652"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">([(Type, EvTerm)] -&gt; TcS [CtEvidence])
-&gt; [(Type, EvTerm)] -&gt; TcS [CtEvidence]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2122"></span><span>                                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008660"><span class="hs-identifier hs-var">role'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008661"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008662"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2123"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercion -&gt; EvTerm) -&gt; TcCoercion -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoSel -&gt; TcCoercion -&gt; TcCoercion
CoSel -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSelCo"><span class="hs-identifier hs-var">mkSelCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel -&gt; CoSel
</span><a href="GHC.Core.TyCo.Rep.html#SelFun"><span class="hs-identifier hs-var">SelFun</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682008664"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008658"><span class="hs-identifier hs-var">ev_co</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2124"></span><span>                                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008664"><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682008664"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008661"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008661"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008662"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008662"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelMult"><span class="hs-identifier hs-var">SelMult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008637"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008641"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2125"></span><span>                                                      </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelArg"><span class="hs-identifier hs-var">SelArg</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008638"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008642"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2126"></span><span>                                                      </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FunSel
</span><a href="GHC.Core.TyCo.Rep.html#SelRes"><span class="hs-identifier hs-var">SelRes</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008639"><span class="hs-identifier hs-var">r1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008643"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2127"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008660"><span class="annot"><span class="annottext">role' :: Role
</span><a href="#local-6989586621682008660"><span class="hs-identifier hs-var hs-var">role'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; FunSel -&gt; Role
</span><a href="GHC.Core.Coercion.html#funRole"><span class="hs-identifier hs-var">funRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008649"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">FunSel
</span><a href="#local-6989586621682008664"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2128"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[CtEvidence] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-var">emitWorkNC</span></a></span><span> </span><span class="annot"><span class="annottext">[CtEvidence]
</span><a href="#local-6989586621682008659"><span class="hs-identifier hs-var">given_evs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2129"></span><span>
</span><span id="line-2130"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008633"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Decomposed TyConApp&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2133"></span><span>    </span><span id="local-6989586621682008652"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682008652"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008633"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2134"></span><span>    </span><span id="local-6989586621682008649"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621682008649"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008634"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-2135"></span><span>    </span><span id="local-6989586621682008647"><span class="annot"><span class="annottext">mult_loc :: CtLoc
</span><a href="#local-6989586621682008647"><span class="hs-identifier hs-var hs-var">mult_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (CtOrigin -&gt; CtOrigin) -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#updateCtLocOrigin"><span class="hs-identifier hs-var">updateCtLocOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008652"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#toInvisibleOrigin"><span class="hs-identifier hs-var">toInvisibleOrigin</span></a></span><span>
</span><span id="line-2136"></span><span>
</span><span id="line-2137"></span><span class="hs-comment">-- | Call when canonicalizing an equality fails, but if the equality is</span><span>
</span><span id="line-2138"></span><span class="hs-comment">-- representational, there is some hope for the future.</span><span>
</span><span id="line-2139"></span><span class="hs-comment">-- Examples in Note [Use canEqFailure in canDecomposableTyConApp]</span><span>
</span><span id="line-2140"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqFailure"><span class="hs-identifier hs-type">canEqFailure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-2141"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2142"></span><span id="canEqFailure"><span class="annot"><span class="annottext">canEqFailure :: CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqFailure"><span class="hs-identifier hs-var hs-var">canEqFailure</span></a></span></span><span> </span><span id="local-6989586621682008665"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008665"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span id="local-6989586621682008666"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008666"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008667"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008667"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2143"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqHardFailure"><span class="hs-identifier hs-var">canEqHardFailure</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008665"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008666"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008667"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2144"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqFailure"><span class="hs-identifier hs-var">canEqFailure</span></a></span><span> </span><span id="local-6989586621682008668"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008668"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span id="local-6989586621682008669"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008669"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008670"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008670"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2145"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008671"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008671"><span class="hs-identifier hs-var">redn1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008672"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008672"><span class="hs-identifier hs-var">rewriters1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008668"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008669"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2146"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008673"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008673"><span class="hs-identifier hs-var">redn2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008674"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008674"><span class="hs-identifier hs-var">rewriters2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewrite"><span class="hs-identifier hs-var">rewrite</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008668"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008670"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2147"></span><span>            </span><span class="hs-comment">-- We must rewrite the types before putting them in the</span><span>
</span><span id="line-2148"></span><span>            </span><span class="hs-comment">-- inert set, so that we are sure to kick them out when</span><span>
</span><span id="line-2149"></span><span>            </span><span class="hs-comment">-- new equalities become available</span><span>
</span><span id="line-2150"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEqFailure with ReprEq&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2151"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008668"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008671"><span class="hs-identifier hs-var">redn1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reduction -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008673"><span class="hs-identifier hs-var">redn2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2152"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008675"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008675"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008672"><span class="hs-identifier hs-var">rewriters1</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; RewriterSet -&gt; RewriterSet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">S.&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008674"><span class="hs-identifier hs-var">rewriters2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008668"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008671"><span class="hs-identifier hs-var">redn1</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008673"><span class="hs-identifier hs-var">redn2</span></a></span><span>
</span><span id="line-2153"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#ReprEqReason"><span class="hs-identifier hs-var">ReprEqReason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008675"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2154"></span><span>
</span><span id="line-2155"></span><span class="annot"><span class="hs-comment">-- | Call when canonicalizing an equality fails with utterly no hope.</span></span><span>
</span><span id="line-2156"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqHardFailure"><span class="hs-identifier hs-type">canEqHardFailure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-2157"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2158"></span><span class="hs-comment">-- See Note [Make sure that insolubles are fully rewritten]</span><span>
</span><span id="line-2159"></span><span id="canEqHardFailure"><span class="annot"><span class="annottext">canEqHardFailure :: CtEvidence -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqHardFailure"><span class="hs-identifier hs-var hs-var">canEqHardFailure</span></a></span></span><span> </span><span id="local-6989586621682008676"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008676"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008677"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008677"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008678"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008678"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2160"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEqHardFailure&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008677"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008678"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008679"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008679"><span class="hs-identifier hs-var">redn1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008680"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008680"><span class="hs-identifier hs-var">rewriters1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewriteForErrors"><span class="hs-identifier hs-var">rewriteForErrors</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008676"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008677"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2162"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008682"><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008682"><span class="hs-identifier hs-var">redn2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008683"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008683"><span class="hs-identifier hs-var">rewriters2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; TcS (Reduction, RewriterSet)
</span><a href="GHC.Tc.Solver.Rewrite.html#rewriteForErrors"><span class="hs-identifier hs-var">rewriteForErrors</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008676"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008678"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2163"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008684"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008684"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008680"><span class="hs-identifier hs-var">rewriters1</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; RewriterSet -&gt; RewriterSet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">S.&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008683"><span class="hs-identifier hs-var">rewriters2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008676"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008679"><span class="hs-identifier hs-var">redn1</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008682"><span class="hs-identifier hs-var">redn2</span></a></span><span>
</span><span id="line-2164"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#ShapeMismatchReason"><span class="hs-identifier hs-var">ShapeMismatchReason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008684"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2165"></span><span>
</span><span id="line-2166"></span><span class="hs-comment">{-
Note [Canonicalising type applications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Given (s1 t1) ~ ty2, how should we proceed?
The simple thing is to see if ty2 is of form (s2 t2), and
decompose.

However, over-eager decomposition gives bad error messages
for things like
   a b ~ Maybe c
   e f ~ p -&gt; q
Suppose (in the first example) we already know a~Array.  Then if we
decompose the application eagerly, yielding
   a ~ Maybe
   b ~ c
we get an error        &quot;Can't match Array ~ Maybe&quot;,
but we'd prefer to get &quot;Can't match Array b ~ Maybe c&quot;.

So instead can_eq_wanted_app rewrites the LHS and RHS, in the hope of
replacing (a b) by (Array b), before using try_decompose_app to
decompose it.

Note [Make sure that insolubles are fully rewritten]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When an equality fails, we still want to rewrite the equality
all the way down, so that it accurately reflects
 (a) the mutable reference substitution in force at start of solving
 (b) any ty-binds in force at this point in solving
See Note [Rewrite insolubles] in GHC.Tc.Solver.InertSet.
And if we don't do this there is a bad danger that
GHC.Tc.Solver.applyTyVarDefaulting will find a variable
that has in fact been substituted.

Note [Do not decompose Given polytype equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider [G] (forall a. t1 ~ forall a. t2).  Can we decompose this?
No -- what would the evidence look like?  So instead we simply discard
this given evidence.

Note [No top-level newtypes on RHS of representational equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we're in this situation:

 work item:  [W] c1 : a ~R b
     inert:  [G] c2 : b ~R Id a

where
  newtype Id a = Id a

We want to make sure canEqCanLHS sees [W] a ~R a, after b is rewritten
and the Id newtype is unwrapped. This is assured by requiring only rewritten
types in canEqCanLHS *and* having the newtype-unwrapping check above
the tyvar check in can_eq_nc.

Note that this only applies to saturated applications of newtype TyCons, as
we can't rewrite an unsaturated application. See for example T22310, where
we ended up with:

  newtype Compose f g a = ...

  [W] t[tau] ~# Compose Foo Bar

Note [Put touchable variables on the left]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Ticket #10009, a very nasty example:

    f :: (UnF (F b) ~ b) =&gt; F b -&gt; ()

    g :: forall a. (UnF (F a) ~ a) =&gt; a -&gt; ()
    g _ = f (undefined :: F a)

For g we get [G]  g1 : UnF (F a) ~ a
             [W] w1 : UnF (F beta) ~ beta
             [W] w2 : F a ~ F beta

g1 is canonical (CEqCan). It is oriented as above because a is not touchable.
See canEqTyVarFunEq.

w1 is similarly canonical, though the occurs-check in canEqTyVarFunEq is key
here.

w2 is canonical. But which way should it be oriented? As written, we'll be
stuck. When w2 is added to the inert set, nothing gets kicked out: g1 is
a Given (and Wanteds don't rewrite Givens), and w2 doesn't mention the LHS
of w2. We'll thus lose.

But if w2 is swapped around, to

    [W] w3 : F beta ~ F a

then we'll kick w1 out of the inert
set (it mentions the LHS of w3). We then rewrite w1 to

    [W] w4 : UnF (F a) ~ beta

and then, using g1, to

    [W] w5 : a ~ beta

at which point we can unify and go on to glory. (This rewriting actually
happens all at once, in the call to rewrite during canonicalisation.)

But what about the new LHS makes it better? It mentions a variable (beta)
that can appear in a Wanted -- a touchable metavariable never appears
in a Given. On the other hand, the original LHS mentioned only variables
that appear in Givens. We thus choose to put variables that can appear
in Wanteds on the left.

Ticket #12526 is another good example of this in action.

-}</span><span>
</span><span id="line-2277"></span><span>
</span><span id="line-2278"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-2279"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHS"><span class="hs-identifier hs-type">canEqCanLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>            </span><span class="hs-comment">-- ev :: lhs ~ rhs</span><span>
</span><span id="line-2280"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2281"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>              </span><span class="hs-comment">-- lhs (or, if swapped, rhs)</span><span>
</span><span id="line-2282"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>                </span><span class="hs-comment">-- lhs: pretty lhs, already rewritten</span><span>
</span><span id="line-2283"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>      </span><span class="hs-comment">-- rhs: already rewritten</span><span>
</span><span id="line-2284"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2285"></span><span id="canEqCanLHS"><span class="annot"><span class="annottext">canEqCanLHS :: CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHS"><span class="hs-identifier hs-var hs-var">canEqCanLHS</span></a></span></span><span> </span><span id="local-6989586621682008685"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008685"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008686"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008686"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008687"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008687"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008688"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008688"><span class="hs-identifier hs-var">lhs1</span></a></span></span><span> </span><span id="local-6989586621682008689"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008689"><span class="hs-identifier hs-var">ps_xi1</span></a></span></span><span> </span><span id="local-6989586621682008690"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008690"><span class="hs-identifier hs-var">xi2</span></a></span></span><span> </span><span id="local-6989586621682008691"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008691"><span class="hs-identifier hs-var">ps_xi2</span></a></span></span><span>
</span><span id="line-2286"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008692"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008693"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-2287"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSHomo"><span class="hs-identifier hs-var">canEqCanLHSHomo</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008685"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008686"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008687"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008688"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008689"><span class="hs-identifier hs-var">ps_xi1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008690"><span class="hs-identifier hs-var">xi2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008691"><span class="hs-identifier hs-var">ps_xi2</span></a></span><span>
</span><span id="line-2288"></span><span>
</span><span id="line-2289"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2290"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSHetero"><span class="hs-identifier hs-var">canEqCanLHSHetero</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008685"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008686"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008687"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008688"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008692"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008690"><span class="hs-identifier hs-var">xi2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008693"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-2291"></span><span>
</span><span id="line-2292"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2293"></span><span>    </span><span id="local-6989586621682008692"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621682008692"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSKind"><span class="hs-identifier hs-var">canEqLHSKind</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008688"><span class="hs-identifier hs-var">lhs1</span></a></span><span>
</span><span id="line-2294"></span><span>    </span><span id="local-6989586621682008693"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621682008693"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008690"><span class="hs-identifier hs-var">xi2</span></a></span><span>
</span><span id="line-2295"></span><span>
</span><span id="line-2296"></span><span>
</span><span id="line-2297"></span><span class="hs-comment">{-
Note [Kind Equality Orientation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
While in theory [W] x ~ y and [W] y ~ x ought to give us the same behaviour, in practice it does not.
See Note [Fundeps with instances, and equality orientation] where this is discussed at length.
As a rule of thumb: we keep the newest unification variables on the left of the equality.
See also Note [Improvement orientation] in GHC.Tc.Solver.Interact.

In particular, `canEqCanLHSHetero` produces the following constraint equalities

[X] (xi1 :: ki1) ~ (xi2 :: ki2)
  --&gt;  [X] kco :: ki1 ~ ki2
       [X] co : xi1 :: ki1 ~ (xi2 |&gt; sym kco) :: ki1

Note that the types in the LHS of the new constraints are the ones that were on the LHS of
the original constraint.

--- Historical note ---
We prevously used to flip the kco to avoid using a sym in the cast

[X] (xi1 :: ki1) ~ (xi2 :: ki2)
  --&gt;  [X] kco :: ki2 ~ ki1
       [X] co : xi1 :: ki1 ~ (xi2 |&gt; kco) :: ki1

But this sent solver in an infinite loop (see #19415).
-- End of historical note --
-}</span><span>
</span><span id="line-2324"></span><span>
</span><span id="line-2325"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSHetero"><span class="hs-identifier hs-type">canEqCanLHSHetero</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>         </span><span class="hs-comment">-- :: (xi1 :: ki1) ~ (xi2 :: ki2)</span><span>
</span><span id="line-2326"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2327"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>           </span><span class="hs-comment">-- xi1</span><span>
</span><span id="line-2328"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>             </span><span class="hs-comment">-- ki1</span><span>
</span><span id="line-2329"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>             </span><span class="hs-comment">-- xi2</span><span>
</span><span id="line-2330"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>             </span><span class="hs-comment">-- ki2</span><span>
</span><span id="line-2331"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2332"></span><span id="canEqCanLHSHetero"><span class="annot"><span class="annottext">canEqCanLHSHetero :: CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSHetero"><span class="hs-identifier hs-var hs-var">canEqCanLHSHetero</span></a></span></span><span> </span><span id="local-6989586621682008698"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008698"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008699"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008699"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008700"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008700"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008701"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008701"><span class="hs-identifier hs-var">lhs1</span></a></span></span><span> </span><span id="local-6989586621682008702"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008702"><span class="hs-identifier hs-var">ki1</span></a></span></span><span> </span><span id="local-6989586621682008703"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008703"><span class="hs-identifier hs-var">xi2</span></a></span></span><span> </span><span id="local-6989586621682008704"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008704"><span class="hs-identifier hs-var">ki2</span></a></span></span><span>
</span><span id="line-2333"></span><span>  </span><span class="hs-comment">-- See Note [Equalities with incompatible kinds]</span><span>
</span><span id="line-2334"></span><span>  </span><span class="hs-comment">-- See Note [Kind Equality Orientation]</span><span>
</span><span id="line-2335"></span><span>  </span><span class="hs-comment">-- NB: preserve left-to-right orientation!!</span><span>
</span><span id="line-2336"></span><span>  </span><span class="hs-comment">-- See Note [Fundeps with instances, and equality orientation]</span><span>
</span><span id="line-2337"></span><span>  </span><span class="hs-comment">--     wrinkle (W2) in GHC.Tc.Solver.Interact</span><span>
</span><span id="line-2338"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008705"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008705"><span class="hs-identifier hs-var">kind_ev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008706"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008706"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (CtEvidence, TcCoercion)
</span><a href="#local-6989586621682008707"><span class="hs-identifier hs-var">mk_kind_eq</span></a></span><span>   </span><span class="hs-comment">-- :: ki1 ~N ki2</span><span>
</span><span id="line-2339"></span><span>
</span><span id="line-2340"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>  </span><span class="hs-comment">-- kind_co :: (ki1 :: *) ~N (ki2 :: *)   (whether swapped or not)</span><span>
</span><span id="line-2341"></span><span>             </span><span id="local-6989586621682008708"><span class="annot"><span class="annottext">lhs_redn :: Reduction
</span><a href="#local-6989586621682008708"><span class="hs-identifier hs-var hs-var">lhs_redn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008709"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008710"><span class="hs-identifier hs-var">xi1</span></a></span><span>
</span><span id="line-2342"></span><span>             </span><span id="local-6989586621682008711"><span class="annot"><span class="annottext">rhs_redn :: Reduction
</span><a href="#local-6989586621682008711"><span class="hs-identifier hs-var hs-var">rhs_redn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; TcCoercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflRightRedn"><span class="hs-identifier hs-var">mkGReflRightRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008709"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008703"><span class="hs-identifier hs-var">xi2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008706"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2343"></span><span>
</span><span id="line-2344"></span><span>             </span><span class="hs-comment">-- See Note [Equalities with incompatible kinds], Wrinkle (1)</span><span>
</span><span id="line-2345"></span><span>             </span><span class="hs-comment">-- This will be ignored in rewriteEqEvidence if the work item is a Given</span><span>
</span><span id="line-2346"></span><span>             </span><span id="local-6989586621682008714"><span class="annot"><span class="annottext">rewriters :: RewriterSet
</span><a href="#local-6989586621682008714"><span class="hs-identifier hs-var hs-var">rewriters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#rewriterSetFromCo"><span class="hs-identifier hs-var">rewriterSetFromCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008706"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-2347"></span><span>
</span><span id="line-2348"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Hetero equality gives rise to kind equality&quot;</span></span><span>
</span><span id="line-2349"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008706"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008702"><span class="hs-identifier hs-var">ki1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;~#&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008704"><span class="hs-identifier hs-var">ki2</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2350"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008718"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008718"><span class="hs-identifier hs-var">type_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008714"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008698"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008700"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008708"><span class="hs-identifier hs-var">lhs_redn</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008711"><span class="hs-identifier hs-var">rhs_redn</span></a></span><span>
</span><span id="line-2351"></span><span>
</span><span id="line-2352"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[CtEvidence] -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#emitWorkNC"><span class="hs-identifier hs-var">emitWorkNC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008718"><span class="hs-identifier hs-var">type_ev</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- delay the type equality until after we've finished</span><span>
</span><span id="line-2353"></span><span>                               </span><span class="hs-comment">-- the kind equality, which may unlock things</span><span>
</span><span id="line-2354"></span><span>                               </span><span class="hs-comment">-- See Note [Equalities with incompatible kinds]</span><span>
</span><span id="line-2355"></span><span>
</span><span id="line-2356"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqNC"><span class="hs-identifier hs-var">canEqNC</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008705"><span class="hs-identifier hs-var">kind_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008702"><span class="hs-identifier hs-var">ki1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008704"><span class="hs-identifier hs-var">ki2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2357"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2358"></span><span>    </span><span class="annot"><a href="#local-6989586621682008707"><span class="hs-identifier hs-type">mk_kind_eq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2359"></span><span>    </span><span id="local-6989586621682008707"><span class="annot"><span class="annottext">mk_kind_eq :: TcS (CtEvidence, TcCoercion)
</span><a href="#local-6989586621682008707"><span class="hs-identifier hs-var hs-var">mk_kind_eq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008698"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2360"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008720"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008720"><span class="hs-identifier hs-var">evar</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2361"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008721"><span class="annot"><span class="annottext">kind_co :: TcCoercion
</span><a href="#local-6989586621682008721"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="#local-6989586621682008722"><span class="hs-identifier hs-var">maybe_sym</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercion -&gt; TcCoercion) -&gt; TcCoercion -&gt; TcCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008720"><span class="hs-identifier hs-var">evar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- :: k1 ~ k2</span><span>
</span><span id="line-2362"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008724"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008724"><span class="hs-identifier hs-var">kind_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008725"><span class="hs-identifier hs-var">kind_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008726"><span class="hs-identifier hs-var">kind_pty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008721"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2363"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(CtEvidence, TcCoercion) -&gt; TcS (CtEvidence, TcCoercion)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008724"><span class="hs-identifier hs-var">kind_ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CtEvidence -&gt; TcCoercion
CtEvidence -&gt; TcCoercion
</span><a href="GHC.Tc.Types.Constraint.html#ctEvCoercion"><span class="hs-identifier hs-var">ctEvCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008724"><span class="hs-identifier hs-var">kind_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2364"></span><span>
</span><span id="line-2365"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008728"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008728"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2366"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, TcCoercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008725"><span class="hs-identifier hs-var">kind_loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008728"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008702"><span class="hs-identifier hs-var">ki1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008704"><span class="hs-identifier hs-var">ki2</span></a></span><span>
</span><span id="line-2367"></span><span>
</span><span id="line-2368"></span><span>    </span><span id="local-6989586621682008710"><span class="annot"><span class="annottext">xi1 :: Type
</span><a href="#local-6989586621682008710"><span class="hs-identifier hs-var hs-var">xi1</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008701"><span class="hs-identifier hs-var">lhs1</span></a></span><span>
</span><span id="line-2369"></span><span>    </span><span id="local-6989586621682008729"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682008729"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008698"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-2370"></span><span>    </span><span id="local-6989586621682008709"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621682008709"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008699"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-2371"></span><span>    </span><span id="local-6989586621682008725"><span class="annot"><span class="annottext">kind_loc :: CtLoc
</span><a href="#local-6989586621682008725"><span class="hs-identifier hs-var hs-var">kind_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; CtLoc -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#mkKindLoc"><span class="hs-identifier hs-var">mkKindLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008710"><span class="hs-identifier hs-var">xi1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008703"><span class="hs-identifier hs-var">xi2</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008729"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2372"></span><span>    </span><span id="local-6989586621682008726"><span class="annot"><span class="annottext">kind_pty :: Type
</span><a href="#local-6989586621682008726"><span class="hs-identifier hs-var hs-var">kind_pty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkHeteroPrimEqPred"><span class="hs-identifier hs-var">mkHeteroPrimEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008702"><span class="hs-identifier hs-var">ki1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008704"><span class="hs-identifier hs-var">ki2</span></a></span><span>
</span><span id="line-2373"></span><span>
</span><span id="line-2374"></span><span>    </span><span id="local-6989586621682008722"><span class="annot"><span class="annottext">maybe_sym :: TcCoercion -&gt; TcCoercion
</span><a href="#local-6989586621682008722"><span class="hs-identifier hs-var hs-var">maybe_sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008700"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2375"></span><span>          </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span>         </span><span class="hs-comment">-- if the input is swapped, then we</span><span>
</span><span id="line-2376"></span><span>                                        </span><span class="hs-comment">-- will have k2 ~ k1, so flip it to k1 ~ k2</span><span>
</span><span id="line-2377"></span><span>          </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
forall a. a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#id/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2378"></span><span>
</span><span id="line-2379"></span><span class="hs-comment">-- guaranteed that typeKind lhs == typeKind rhs</span><span>
</span><span id="line-2380"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSHomo"><span class="hs-identifier hs-type">canEqCanLHSHomo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-2381"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2382"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>           </span><span class="hs-comment">-- lhs (or, if swapped, rhs)</span><span>
</span><span id="line-2383"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>             </span><span class="hs-comment">-- pretty lhs</span><span>
</span><span id="line-2384"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>   </span><span class="hs-comment">-- rhs, pretty rhs</span><span>
</span><span id="line-2385"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2386"></span><span id="canEqCanLHSHomo"><span class="annot"><span class="annottext">canEqCanLHSHomo :: CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; Type
-&gt; Type
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSHomo"><span class="hs-identifier hs-var hs-var">canEqCanLHSHomo</span></a></span></span><span> </span><span id="local-6989586621682008734"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008734"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008735"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008735"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008736"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008736"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008737"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008737"><span class="hs-identifier hs-var">lhs1</span></a></span></span><span> </span><span id="local-6989586621682008738"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008738"><span class="hs-identifier hs-var">ps_xi1</span></a></span></span><span> </span><span id="local-6989586621682008739"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008739"><span class="hs-identifier hs-var">xi2</span></a></span></span><span> </span><span id="local-6989586621682008740"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008740"><span class="hs-identifier hs-var">ps_xi2</span></a></span></span><span>
</span><span id="line-2387"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008741"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008741"><span class="hs-identifier hs-var">xi2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008742"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008742"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, MCoercion)
</span><a href="#local-6989586621682008743"><span class="hs-identifier hs-var">split_cast_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008739"><span class="hs-identifier hs-var">xi2</span></a></span><span>
</span><span id="line-2388"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008744"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008744"><span class="hs-identifier hs-var">lhs2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHS_maybe"><span class="hs-identifier hs-var">canEqLHS_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008741"><span class="hs-identifier hs-var">xi2'</span></a></span><span>
</span><span id="line-2389"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; CanEqLHS
-&gt; Type
-&gt; MCoercion
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHS2"><span class="hs-identifier hs-var">canEqCanLHS2</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008734"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008735"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008736"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008737"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008738"><span class="hs-identifier hs-var">ps_xi1</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008744"><span class="hs-identifier hs-var">lhs2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008740"><span class="hs-identifier hs-var">ps_xi2</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-operator hs-var">`mkCastTyMCo`</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var">mkSymMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008742"><span class="hs-identifier hs-var">mco</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008742"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2390"></span><span>
</span><span id="line-2391"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2392"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; CanEqLHS -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-var">canEqCanLHSFinish</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008734"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008735"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008736"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008737"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008740"><span class="hs-identifier hs-var">ps_xi2</span></a></span><span>
</span><span id="line-2393"></span><span>
</span><span id="line-2394"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2395"></span><span>    </span><span id="local-6989586621682008743"><span class="annot"><span class="annottext">split_cast_ty :: Type -&gt; (Type, MCoercion)
</span><a href="#local-6989586621682008743"><span class="hs-identifier hs-var hs-var">split_cast_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621682008749"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008749"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621682008750"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008750"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008749"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008750"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2396"></span><span>    </span><span class="annot"><a href="#local-6989586621682008743"><span class="hs-identifier hs-var">split_cast_ty</span></a></span><span> </span><span id="local-6989586621682008752"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008752"><span class="hs-identifier hs-var">other</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008752"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2397"></span><span>
</span><span id="line-2398"></span><span class="hs-comment">-- This function deals with the case that both LHS and RHS are potential</span><span>
</span><span id="line-2399"></span><span class="hs-comment">-- CanEqLHSs.</span><span>
</span><span id="line-2400"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHS2"><span class="hs-identifier hs-type">canEqCanLHS2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>              </span><span class="hs-comment">-- lhs ~ (rhs |&gt; mco)</span><span>
</span><span id="line-2401"></span><span>                                        </span><span class="hs-comment">-- or, if swapped: (rhs |&gt; mco) ~ lhs</span><span>
</span><span id="line-2402"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2403"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>                </span><span class="hs-comment">-- lhs (or, if swapped, rhs)</span><span>
</span><span id="line-2404"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>                  </span><span class="hs-comment">-- pretty lhs</span><span>
</span><span id="line-2405"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>                </span><span class="hs-comment">-- rhs</span><span>
</span><span id="line-2406"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>                  </span><span class="hs-comment">-- pretty rhs</span><span>
</span><span id="line-2407"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>               </span><span class="hs-comment">-- :: kind(rhs) ~N kind(lhs)</span><span>
</span><span id="line-2408"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2409"></span><span id="canEqCanLHS2"><span class="annot"><span class="annottext">canEqCanLHS2 :: CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; CanEqLHS
-&gt; Type
-&gt; CanEqLHS
-&gt; Type
-&gt; MCoercion
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHS2"><span class="hs-identifier hs-var hs-var">canEqCanLHS2</span></a></span></span><span> </span><span id="local-6989586621682008754"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008755"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008756"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008756"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008757"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span></span><span> </span><span id="local-6989586621682008758"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008758"><span class="hs-identifier hs-var">ps_xi1</span></a></span></span><span> </span><span id="local-6989586621682008759"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span></span><span> </span><span id="local-6989586621682008760"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008760"><span class="hs-identifier hs-var">ps_xi2</span></a></span></span><span> </span><span id="local-6989586621682008761"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008761"><span class="hs-identifier hs-var">mco</span></a></span></span><span>
</span><span id="line-2410"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; CanEqLHS -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#eqCanEqLHS"><span class="hs-operator hs-var">`eqCanEqLHS`</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span>
</span><span id="line-2411"></span><span>    </span><span class="hs-comment">-- It must be the case that mco is reflexive</span><span>
</span><span id="line-2412"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EqRel -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqReflexive"><span class="hs-identifier hs-var">canEqReflexive</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2413"></span><span>
</span><span id="line-2414"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682008764"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008764"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span>
</span><span id="line-2415"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682008765"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008765"><span class="hs-identifier hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span>
</span><span id="line-2416"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcTyVar -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.Unify.html#swapOverTyVars"><span class="hs-identifier hs-var">swapOverTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008764"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008765"><span class="hs-identifier hs-var">tv2</span></a></span><span>
</span><span id="line-2417"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEqLHS2 swapOver&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008764"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008765"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008756"><span class="hs-identifier hs-var">swapped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2418"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008767"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008767"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS CtEvidence
</span><a href="#local-6989586621682008768"><span class="hs-identifier hs-var">do_swap</span></a></span><span>
</span><span id="line-2419"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; CanEqLHS -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-var">canEqCanLHSFinish</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008767"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-var">TyVarLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008765"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2420"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008758"><span class="hs-identifier hs-var">ps_xi1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-operator hs-var">`mkCastTyMCo`</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008769"><span class="hs-identifier hs-var">sym_mco</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2421"></span><span>
</span><span id="line-2422"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682008770"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008770"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span>
</span><span id="line-2423"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682008772"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008772"><span class="hs-identifier hs-var">fun_tc2</span></a></span></span><span> </span><span id="local-6989586621682008773"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008773"><span class="hs-identifier hs-var">fun_args2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span>
</span><span id="line-2424"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; TcTyVar
-&gt; Type
-&gt; TyCon
-&gt; [Type]
-&gt; Type
-&gt; MCoercion
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqTyVarFunEq"><span class="hs-identifier hs-var">canEqTyVarFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008756"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008770"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008758"><span class="hs-identifier hs-var">ps_xi1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008772"><span class="hs-identifier hs-var">fun_tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008773"><span class="hs-identifier hs-var">fun_args2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008760"><span class="hs-identifier hs-var">ps_xi2</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008761"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2425"></span><span>
</span><span id="line-2426"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682008775"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008775"><span class="hs-identifier hs-var">fun_tc1</span></a></span></span><span> </span><span id="local-6989586621682008776"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008776"><span class="hs-identifier hs-var">fun_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span>
</span><span id="line-2427"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-type">TyVarLHS</span></a></span><span> </span><span id="local-6989586621682008777"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008777"><span class="hs-identifier hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span>
</span><span id="line-2428"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008778"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008778"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS CtEvidence
</span><a href="#local-6989586621682008768"><span class="hs-identifier hs-var">do_swap</span></a></span><span>
</span><span id="line-2429"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; TcTyVar
-&gt; Type
-&gt; TyCon
-&gt; [Type]
-&gt; Type
-&gt; MCoercion
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqTyVarFunEq"><span class="hs-identifier hs-var">canEqTyVarFunEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008778"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008777"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008760"><span class="hs-identifier hs-var">ps_xi2</span></a></span><span>
</span><span id="line-2430"></span><span>                                                 </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008775"><span class="hs-identifier hs-var">fun_tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008776"><span class="hs-identifier hs-var">fun_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008758"><span class="hs-identifier hs-var">ps_xi1</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008769"><span class="hs-identifier hs-var">sym_mco</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2431"></span><span>
</span><span id="line-2432"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682008779"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008779"><span class="hs-identifier hs-var">fun_tc1</span></a></span></span><span> </span><span id="local-6989586621682008780"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008780"><span class="hs-identifier hs-var">fun_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span>
</span><span id="line-2433"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-type">TyFamLHS</span></a></span><span> </span><span id="local-6989586621682008781"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008781"><span class="hs-identifier hs-var">fun_tc2</span></a></span></span><span> </span><span id="local-6989586621682008782"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008782"><span class="hs-identifier hs-var">fun_args2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span>
</span><span id="line-2434"></span><span>  </span><span class="hs-comment">-- See Note [Decomposing type family applications]</span><span>
</span><span id="line-2435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEqCanLHS2 two type families&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2436"></span><span>
</span><span id="line-2437"></span><span>         </span><span class="hs-comment">-- emit wanted equalities for injective type families</span><span>
</span><span id="line-2438"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682008783"><span class="hs-identifier hs-type">inj_eqns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#TypeEqn"><span class="hs-identifier hs-type">TypeEqn</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- TypeEqn = Pair Type</span><span>
</span><span id="line-2439"></span><span>             </span><span id="local-6989586621682008783"><span class="annot"><span class="annottext">inj_eqns :: [Pair Type]
</span><a href="#local-6989586621682008783"><span class="hs-identifier hs-var hs-var">inj_eqns</span></a></span></span><span>
</span><span id="line-2440"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- injectivity applies only for nom. eqs.</span><span>
</span><span id="line-2441"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008779"><span class="hs-identifier hs-var">fun_tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008781"><span class="hs-identifier hs-var">fun_tc2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- if the families don't match, stop.</span><span>
</span><span id="line-2442"></span><span>
</span><span id="line-2443"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#Injective"><span class="hs-identifier hs-type">Injective</span></a></span><span> </span><span id="local-6989586621682008786"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682008786"><span class="hs-identifier hs-var">inj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Injectivity
</span><a href="GHC.Core.TyCon.html#tyConInjectivityInfo"><span class="hs-identifier hs-var">tyConInjectivityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008779"><span class="hs-identifier hs-var">fun_tc1</span></a></span><span>
</span><span id="line-2444"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Pair Type
forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008788"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008789"><span class="hs-identifier hs-var">arg2</span></a></span><span>
</span><span id="line-2445"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008788"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008788"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008789"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008789"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Bool] -&gt; [(Type, Type, Bool)]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip3/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008780"><span class="hs-identifier hs-var">fun_args1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008782"><span class="hs-identifier hs-var">fun_args2</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621682008786"><span class="hs-identifier hs-var">inj</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2446"></span><span>
</span><span id="line-2447"></span><span>                 </span><span class="hs-comment">-- built-in synonym families don't have an entry point</span><span>
</span><span id="line-2448"></span><span>                 </span><span class="hs-comment">-- for this use case. So, we just use sfInteractInert</span><span>
</span><span id="line-2449"></span><span>                 </span><span class="hs-comment">-- and pass two equal RHSs. We *could* add another entry</span><span>
</span><span id="line-2450"></span><span>                 </span><span class="hs-comment">-- point, but then there would be a burden to make</span><span>
</span><span id="line-2451"></span><span>                 </span><span class="hs-comment">-- sure the new entry point and existing ones were</span><span>
</span><span id="line-2452"></span><span>                 </span><span class="hs-comment">-- internally consistent. This is slightly distasteful,</span><span>
</span><span id="line-2453"></span><span>                 </span><span class="hs-comment">-- but it works well in practice and localises the</span><span>
</span><span id="line-2454"></span><span>                 </span><span class="hs-comment">-- problem.</span><span>
</span><span id="line-2455"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008791"><span class="annot"><span class="annottext">BuiltInSynFamily
</span><a href="#local-6989586621682008791"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe BuiltInSynFamily
</span><a href="GHC.Core.TyCon.html#isBuiltInSynFamTyCon_maybe"><span class="hs-identifier hs-var">isBuiltInSynFamTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008779"><span class="hs-identifier hs-var">fun_tc1</span></a></span><span>
</span><span id="line-2456"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008793"><span class="annot"><span class="annottext">ki1 :: Type
</span><a href="#local-6989586621682008793"><span class="hs-identifier hs-var hs-var">ki1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSKind"><span class="hs-identifier hs-var">canEqLHSKind</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span>
</span><span id="line-2457"></span><span>                     </span><span id="local-6989586621682008794"><span class="annot"><span class="annottext">ki2 :: Type
</span><a href="#local-6989586621682008794"><span class="hs-identifier hs-var hs-var">ki2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008761"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2458"></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008793"><span class="hs-identifier hs-var">ki1</span></a></span><span>   </span><span class="hs-comment">-- just a small optimisation</span><span>
</span><span id="line-2459"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2460"></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSKind"><span class="hs-identifier hs-var">canEqLHSKind</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span>
</span><span id="line-2461"></span><span>
</span><span id="line-2462"></span><span>                     </span><span id="local-6989586621682008795"><span class="annot"><span class="annottext">fake_rhs1 :: Type
</span><a href="#local-6989586621682008795"><span class="hs-identifier hs-var hs-var">fake_rhs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Builtin.Types.html#anyTypeOfKind"><span class="hs-identifier hs-var">anyTypeOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008793"><span class="hs-identifier hs-var">ki1</span></a></span><span>
</span><span id="line-2463"></span><span>                     </span><span id="local-6989586621682008796"><span class="annot"><span class="annottext">fake_rhs2 :: Type
</span><a href="#local-6989586621682008796"><span class="hs-identifier hs-var hs-var">fake_rhs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="GHC.Builtin.Types.html#anyTypeOfKind"><span class="hs-identifier hs-var">anyTypeOfKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008794"><span class="hs-identifier hs-var">ki2</span></a></span><span>
</span><span id="line-2464"></span><span>                 </span><span class="hs-keyword">in</span><span>
</span><span id="line-2465"></span><span>                 </span><span class="annot"><span class="annottext">BuiltInSynFamily -&gt; [Type] -&gt; Type -&gt; [Type] -&gt; Type -&gt; [Pair Type]
</span><a href="GHC.Core.Coercion.Axiom.html#sfInteractInert"><span class="hs-identifier hs-var">sfInteractInert</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltInSynFamily
</span><a href="#local-6989586621682008791"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008780"><span class="hs-identifier hs-var">fun_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008795"><span class="hs-identifier hs-var">fake_rhs1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008782"><span class="hs-identifier hs-var">fun_args2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008796"><span class="hs-identifier hs-var">fake_rhs2</span></a></span><span>
</span><span id="line-2466"></span><span>
</span><span id="line-2467"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-comment">-- ordinary, non-injective type family</span><span>
</span><span id="line-2468"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2469"></span><span>
</span><span id="line-2470"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2471"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008798"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008798"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2472"></span><span>             </span><span class="annot"><span class="annottext">(Pair Type -&gt; TcS TcCoercion) -&gt; [Pair Type] -&gt; TcS ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621682008800"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008800"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682008801"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008801"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008798"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008800"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008801"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Pair Type]
</span><a href="#local-6989586621682008783"><span class="hs-identifier hs-var">inj_eqns</span></a></span><span>
</span><span id="line-2473"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcS ()
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2474"></span><span>             </span><span class="hs-comment">-- See Note [No Given/Given fundeps] in GHC.Tc.Solver.Interact</span><span>
</span><span id="line-2475"></span><span>
</span><span id="line-2476"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008802"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682008802"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS TcLevel
</span><a href="GHC.Tc.Solver.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-2477"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008804"><span class="annot"><span class="annottext">tvs1 :: VarSet
</span><a href="#local-6989586621682008804"><span class="hs-identifier hs-var hs-var">tvs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008780"><span class="hs-identifier hs-var">fun_args1</span></a></span><span>
</span><span id="line-2478"></span><span>             </span><span id="local-6989586621682008805"><span class="annot"><span class="annottext">tvs2 :: VarSet
</span><a href="#local-6989586621682008805"><span class="hs-identifier hs-var hs-var">tvs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008782"><span class="hs-identifier hs-var">fun_args2</span></a></span><span>
</span><span id="line-2479"></span><span>
</span><span id="line-2480"></span><span>             </span><span id="local-6989586621682008806"><span class="annot"><span class="annottext">swap_for_rewriting :: Bool
</span><a href="#local-6989586621682008806"><span class="hs-identifier hs-var hs-var">swap_for_rewriting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#anyVarSet"><span class="hs-identifier hs-var">anyVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isTouchableMetaTyVar"><span class="hs-identifier hs-var">isTouchableMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682008802"><span class="hs-identifier hs-var">tclvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682008805"><span class="hs-identifier hs-var">tvs2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2481"></span><span>                          </span><span class="hs-comment">-- swap 'em: Note [Put touchable variables on the left]</span><span>
</span><span id="line-2482"></span><span>                                  </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcTyVar -&gt; Bool) -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#anyVarSet"><span class="hs-identifier hs-var">anyVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; TcTyVar -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isTouchableMetaTyVar"><span class="hs-identifier hs-var">isTouchableMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621682008802"><span class="hs-identifier hs-var">tclvl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682008804"><span class="hs-identifier hs-var">tvs1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2483"></span><span>                          </span><span class="hs-comment">-- this check is just to avoid unfruitful swapping</span><span>
</span><span id="line-2484"></span><span>
</span><span id="line-2485"></span><span>               </span><span class="hs-comment">-- If we have F a ~ F (F a), we want to swap.</span><span>
</span><span id="line-2486"></span><span>             </span><span id="local-6989586621682008808"><span class="annot"><span class="annottext">swap_for_occurs :: Bool
</span><a href="#local-6989586621682008808"><span class="hs-identifier hs-var hs-var">swap_for_occurs</span></a></span></span><span>
</span><span id="line-2487"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cterHasNoProblem"><span class="hs-identifier hs-var">cterHasNoProblem</span></a></span><span>   </span><span class="annot"><span class="annottext">(CheckTyEqResult -&gt; Bool) -&gt; CheckTyEqResult -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Utils.Unify.html#checkTyFamEq"><span class="hs-identifier hs-var">checkTyFamEq</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008781"><span class="hs-identifier hs-var">fun_tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008782"><span class="hs-identifier hs-var">fun_args2</span></a></span><span>
</span><span id="line-2488"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008779"><span class="hs-identifier hs-var">fun_tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008780"><span class="hs-identifier hs-var">fun_args1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2489"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cterHasOccursCheck"><span class="hs-identifier hs-var">cterHasOccursCheck</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckTyEqResult -&gt; Bool) -&gt; CheckTyEqResult -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Utils.Unify.html#checkTyFamEq"><span class="hs-identifier hs-var">checkTyFamEq</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008779"><span class="hs-identifier hs-var">fun_tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008780"><span class="hs-identifier hs-var">fun_args1</span></a></span><span>
</span><span id="line-2490"></span><span>                                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008781"><span class="hs-identifier hs-var">fun_tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008782"><span class="hs-identifier hs-var">fun_args2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2491"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2492"></span><span>
</span><span id="line-2493"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2494"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2495"></span><span>
</span><span id="line-2496"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008806"><span class="hs-identifier hs-var">swap_for_rewriting</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008808"><span class="hs-identifier hs-var">swap_for_occurs</span></a></span><span>
</span><span id="line-2497"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008812"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008812"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS CtEvidence
</span><a href="#local-6989586621682008768"><span class="hs-identifier hs-var">do_swap</span></a></span><span>
</span><span id="line-2498"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; CanEqLHS -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-var">canEqCanLHSFinish</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008812"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008758"><span class="hs-identifier hs-var">ps_xi1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-operator hs-var">`mkCastTyMCo`</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008769"><span class="hs-identifier hs-var">sym_mco</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2499"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue Ct)
</span><a href="#local-6989586621682008813"><span class="hs-identifier hs-var">finish_without_swapping</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2500"></span><span>
</span><span id="line-2501"></span><span>  </span><span class="hs-comment">-- that's all the special cases. Now we just figure out which non-special case</span><span>
</span><span id="line-2502"></span><span>  </span><span class="hs-comment">-- to continue to.</span><span>
</span><span id="line-2503"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2504"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue Ct)
</span><a href="#local-6989586621682008813"><span class="hs-identifier hs-var">finish_without_swapping</span></a></span><span>
</span><span id="line-2505"></span><span>
</span><span id="line-2506"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2507"></span><span>    </span><span id="local-6989586621682008769"><span class="annot"><span class="annottext">sym_mco :: MCoercion
</span><a href="#local-6989586621682008769"><span class="hs-identifier hs-var hs-var">sym_mco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var">mkSymMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008761"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2508"></span><span>
</span><span id="line-2509"></span><span>    </span><span id="local-6989586621682008768"><span class="annot"><span class="annottext">do_swap :: TcS CtEvidence
</span><a href="#local-6989586621682008768"><span class="hs-identifier hs-var hs-var">do_swap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; Type -&gt; Type -&gt; MCoercion -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteCastedEquality"><span class="hs-identifier hs-var">rewriteCastedEquality</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008756"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008759"><span class="hs-identifier hs-var">lhs2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008761"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2510"></span><span>    </span><span id="local-6989586621682008813"><span class="annot"><span class="annottext">finish_without_swapping :: TcS (StopOrContinue Ct)
</span><a href="#local-6989586621682008813"><span class="hs-identifier hs-var hs-var">finish_without_swapping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; CanEqLHS -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-var">canEqCanLHSFinish</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008754"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008755"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008756"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008757"><span class="hs-identifier hs-var">lhs1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008760"><span class="hs-identifier hs-var">ps_xi2</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-operator hs-var">`mkCastTyMCo`</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008761"><span class="hs-identifier hs-var">mco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2511"></span><span>
</span><span id="line-2512"></span><span>
</span><span id="line-2513"></span><span class="hs-comment">-- This function handles the case where one side is a tyvar and the other is</span><span>
</span><span id="line-2514"></span><span class="hs-comment">-- a type family application. Which to put on the left?</span><span>
</span><span id="line-2515"></span><span class="hs-comment">--   If the tyvar is a touchable meta-tyvar, put it on the left, as this may</span><span>
</span><span id="line-2516"></span><span class="hs-comment">--   be our only shot to unify.</span><span>
</span><span id="line-2517"></span><span class="hs-comment">--   Otherwise, put the function on the left, because it's generally better to</span><span>
</span><span id="line-2518"></span><span class="hs-comment">--   rewrite away function calls. This makes types smaller. And it seems necessary:</span><span>
</span><span id="line-2519"></span><span class="hs-comment">--     [W] F alpha ~ alpha</span><span>
</span><span id="line-2520"></span><span class="hs-comment">--     [W] F alpha ~ beta</span><span>
</span><span id="line-2521"></span><span class="hs-comment">--     [W] G alpha beta ~ Int   ( where we have type instance G a a = a )</span><span>
</span><span id="line-2522"></span><span class="hs-comment">--   If we end up with a stuck alpha ~ F alpha, we won't be able to solve this.</span><span>
</span><span id="line-2523"></span><span class="hs-comment">--   Test case: indexed-types/should_compile/CEqCanOccursCheck</span><span>
</span><span id="line-2524"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqTyVarFunEq"><span class="hs-identifier hs-type">canEqTyVarFunEq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>               </span><span class="hs-comment">-- :: lhs ~ (rhs |&gt; mco)</span><span>
</span><span id="line-2525"></span><span>                                            </span><span class="hs-comment">-- or (rhs |&gt; mco) ~ lhs if swapped</span><span>
</span><span id="line-2526"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2527"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>          </span><span class="hs-comment">-- lhs (or if swapped rhs), pretty lhs</span><span>
</span><span id="line-2528"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Xi"><span class="hs-identifier hs-type">Xi</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>  </span><span class="hs-comment">-- rhs (or if swapped lhs) fun and args, pretty rhs</span><span>
</span><span id="line-2529"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>                </span><span class="hs-comment">-- :: kind(rhs) ~N kind(lhs)</span><span>
</span><span id="line-2530"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2531"></span><span id="canEqTyVarFunEq"><span class="annot"><span class="annottext">canEqTyVarFunEq :: CtEvidence
-&gt; EqRel
-&gt; SwapFlag
-&gt; TcTyVar
-&gt; Type
-&gt; TyCon
-&gt; [Type]
-&gt; Type
-&gt; MCoercion
-&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqTyVarFunEq"><span class="hs-identifier hs-var hs-var">canEqTyVarFunEq</span></a></span></span><span> </span><span id="local-6989586621682008815"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008815"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008816"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008816"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008817"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008817"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008818"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008818"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span id="local-6989586621682008819"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008819"><span class="hs-identifier hs-var">ps_xi1</span></a></span></span><span> </span><span id="local-6989586621682008820"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008820"><span class="hs-identifier hs-var">fun_tc2</span></a></span></span><span> </span><span id="local-6989586621682008821"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008821"><span class="hs-identifier hs-var">fun_args2</span></a></span></span><span> </span><span id="local-6989586621682008822"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008822"><span class="hs-identifier hs-var">ps_xi2</span></a></span></span><span> </span><span id="local-6989586621682008823"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008823"><span class="hs-identifier hs-var">mco</span></a></span></span><span>
</span><span id="line-2532"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008824"><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="#local-6989586621682008824"><span class="hs-identifier hs-var">is_touchable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008825"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008825"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtFlavour -&gt; TcTyVar -&gt; Type -&gt; TcS (TouchabilityTestResult, Type)
</span><a href="GHC.Tc.Solver.Monad.html#touchabilityTest"><span class="hs-identifier hs-var">touchabilityTest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtFlavour
</span><a href="GHC.Tc.Types.Constraint.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008815"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008818"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008827"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2533"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="#local-6989586621682008824"><span class="hs-identifier hs-var">is_touchable</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><a href="GHC.Tc.Solver.Monad.html#Untouchable"><span class="hs-identifier hs-var">Untouchable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TouchabilityTestResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2534"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cterHasNoProblem"><span class="hs-identifier hs-var">cterHasNoProblem</span></a></span><span> </span><span class="annot"><span class="annottext">(CheckTyEqResult -&gt; Bool) -&gt; CheckTyEqResult -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2535"></span><span>                </span><span class="annot"><span class="annottext">TcTyVar -&gt; Type -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Utils.Unify.html#checkTyVarEq"><span class="hs-identifier hs-var">checkTyVarEq</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008818"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008825"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; CheckTyEqProblem -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Types.Constraint.html#cterRemoveProblem"><span class="hs-operator hs-var">`cterRemoveProblem`</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteTypeFamily"><span class="hs-identifier hs-var">cteTypeFamily</span></a></span><span>
</span><span id="line-2536"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; CanEqLHS -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-var">canEqCanLHSFinish</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008815"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008816"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008817"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#TyVarLHS"><span class="hs-identifier hs-var">TyVarLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008818"><span class="hs-identifier hs-var">tv1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008825"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2537"></span><span>
</span><span id="line-2538"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2539"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008832"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008832"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; Type -&gt; Type -&gt; MCoercion -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteCastedEquality"><span class="hs-identifier hs-var">rewriteCastedEquality</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008815"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008816"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008817"><span class="hs-identifier hs-var">swapped</span></a></span><span>
</span><span id="line-2540"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008818"><span class="hs-identifier hs-var">tv1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008820"><span class="hs-identifier hs-var">fun_tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008821"><span class="hs-identifier hs-var">fun_args2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2541"></span><span>                                  </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008823"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2542"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; CanEqLHS -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-var">canEqCanLHSFinish</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008832"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008816"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a></span><span>
</span><span id="line-2543"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#TyFamLHS"><span class="hs-identifier hs-var">TyFamLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008820"><span class="hs-identifier hs-var">fun_tc2</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008821"><span class="hs-identifier hs-var">fun_args2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2544"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008819"><span class="hs-identifier hs-var">ps_xi1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-operator hs-var">`mkCastTyMCo`</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008833"><span class="hs-identifier hs-var">sym_mco</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2545"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2546"></span><span>    </span><span id="local-6989586621682008833"><span class="annot"><span class="annottext">sym_mco :: MCoercion
</span><a href="#local-6989586621682008833"><span class="hs-identifier hs-var hs-var">sym_mco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var">mkSymMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008823"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2547"></span><span>    </span><span id="local-6989586621682008827"><span class="annot"><span class="annottext">rhs :: Type
</span><a href="#local-6989586621682008827"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008822"><span class="hs-identifier hs-var">ps_xi2</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-operator hs-var">`mkCastTyMCo`</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008823"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2548"></span><span>
</span><span id="line-2549"></span><span class="hs-comment">-- The RHS here is either not CanEqLHS, or it's one that we</span><span>
</span><span id="line-2550"></span><span class="hs-comment">-- want to rewrite the LHS to (as per e.g. swapOverTyVars)</span><span>
</span><span id="line-2551"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-type">canEqCanLHSFinish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>
</span><span id="line-2552"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2553"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CanEqLHS"><span class="hs-identifier hs-type">CanEqLHS</span></a></span><span>             </span><span class="hs-comment">-- lhs (or, if swapped, rhs)</span><span>
</span><span id="line-2554"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>               </span><span class="hs-comment">-- rhs (or, if swapped, lhs)</span><span>
</span><span id="line-2555"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2556"></span><span id="canEqCanLHSFinish"><span class="annot"><span class="annottext">canEqCanLHSFinish :: CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; CanEqLHS -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqCanLHSFinish"><span class="hs-identifier hs-var hs-var">canEqCanLHSFinish</span></a></span></span><span> </span><span id="local-6989586621682008834"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008834"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008835"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008835"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008836"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008836"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008837"><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682008838"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-2557"></span><span class="hs-comment">-- RHS is fully rewritten, but with type synonyms</span><span>
</span><span id="line-2558"></span><span class="hs-comment">-- preserved as much as possible</span><span>
</span><span id="line-2559"></span><span class="hs-comment">-- guaranteed that tyVarKind lhs == typeKind rhs, for (TyEq:K)</span><span>
</span><span id="line-2560"></span><span class="hs-comment">-- (TyEq:N) is checked in can_eq_nc', and (TyEq:TV) is handled in canEqCanLHS2</span><span>
</span><span id="line-2561"></span><span>
</span><span id="line-2562"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2563"></span><span>          </span><span class="hs-comment">-- this performs the swap if necessary</span><span>
</span><span id="line-2564"></span><span>         </span><span id="local-6989586621682008839"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008839"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-var">emptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008834"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008836"><span class="hs-identifier hs-var">swapped</span></a></span><span>
</span><span id="line-2565"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008840"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008841"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2566"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008840"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2567"></span><span>
</span><span id="line-2568"></span><span>     </span><span class="hs-comment">-- by now, (TyEq:K) is already satisfied</span><span>
</span><span id="line-2569"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcS ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSKind"><span class="hs-identifier hs-var">canEqLHSKind</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2570"></span><span>
</span><span id="line-2571"></span><span>     </span><span class="hs-comment">-- by now, (TyEq:N) is already satisfied (if applicable)</span><span>
</span><span id="line-2572"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcS Bool -&gt; SDoc -&gt; TcS ()
forall (m :: * -&gt; *).
(HasCallStack, Monad m) =&gt;
m Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#assertPprM"><span class="hs-identifier hs-var">assertPprM</span></a></span><span> </span><span class="annot"><span class="annottext">TcS Bool
</span><a href="#local-6989586621682008844"><span class="hs-identifier hs-var">ty_eq_N_OK</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2573"></span><span>           </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CanEqCanLHSFinish: (TyEq:N) not satisfied&quot;</span></span><span>
</span><span id="line-2574"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rhs:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2575"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2576"></span><span>
</span><span id="line-2577"></span><span>     </span><span class="hs-comment">-- guarantees (TyEq:OC), (TyEq:F)</span><span>
</span><span id="line-2578"></span><span>     </span><span class="hs-comment">-- Must do the occurs check even on tyvar/tyvar</span><span>
</span><span id="line-2579"></span><span>     </span><span class="hs-comment">-- equalities, in case have  x ~ (y :: ..x...); this is #12593.</span><span>
</span><span id="line-2580"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008845"><span class="annot"><span class="annottext">result0 :: CheckTyEqResult
</span><a href="#local-6989586621682008845"><span class="hs-identifier hs-var hs-var">result0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Utils.Unify.html#checkTypeEq"><span class="hs-identifier hs-var">checkTypeEq</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; CheckTyEqProblem -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Types.Constraint.html#cterRemoveProblem"><span class="hs-operator hs-var">`cterRemoveProblem`</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqProblem
</span><a href="GHC.Tc.Types.Constraint.html#cteTypeFamily"><span class="hs-identifier hs-var">cteTypeFamily</span></a></span><span>
</span><span id="line-2581"></span><span>     </span><span class="hs-comment">-- type families are OK here</span><span>
</span><span id="line-2582"></span><span>     </span><span class="hs-comment">-- NB: no occCheckExpand here; see Note [Rewriting synonyms] in GHC.Tc.Solver.Rewrite</span><span>
</span><span id="line-2583"></span><span>
</span><span id="line-2584"></span><span>              </span><span class="hs-comment">-- a ~R# b a is soluble if b later turns out to be Identity</span><span>
</span><span id="line-2585"></span><span>             </span><span id="local-6989586621682008847"><span class="annot"><span class="annottext">result :: CheckTyEqResult
</span><a href="#local-6989586621682008847"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008835"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2586"></span><span>                        </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621682008845"><span class="hs-identifier hs-var">result0</span></a></span><span>
</span><span id="line-2587"></span><span>                        </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Types.Constraint.html#cterSetOccursCheckSoluble"><span class="hs-identifier hs-var">cterSetOccursCheckSoluble</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621682008845"><span class="hs-identifier hs-var">result0</span></a></span><span>
</span><span id="line-2588"></span><span>
</span><span id="line-2589"></span><span>             </span><span id="local-6989586621682008849"><span class="annot"><span class="annottext">reason :: CtIrredReason
</span><a href="#local-6989586621682008849"><span class="hs-identifier hs-var hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; CtIrredReason
</span><a href="GHC.Tc.Types.Constraint.html#NonCanonicalReason"><span class="hs-identifier hs-var">NonCanonicalReason</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621682008847"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-2590"></span><span>
</span><span id="line-2591"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cterHasNoProblem"><span class="hs-identifier hs-var">cterHasNoProblem</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621682008847"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-2592"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CEqCan&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2593"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008839"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2594"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008835"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2595"></span><span>
</span><span id="line-2596"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008851"><span class="annot"><span class="annottext">Maybe Reduction
</span><a href="#local-6989586621682008851"><span class="hs-identifier hs-var">m_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
-&gt; CheckTyEqResult -&gt; CanEqLHS -&gt; Type -&gt; TcS (Maybe Reduction)
</span><a href="GHC.Tc.Solver.Monad.html#breakTyEqCycle_maybe"><span class="hs-identifier hs-var">breakTyEqCycle_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008834"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult
</span><a href="#local-6989586621682008847"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2597"></span><span>                           </span><span class="hs-comment">-- See Note [Type equality cycles];</span><span>
</span><span id="line-2598"></span><span>                           </span><span class="hs-comment">-- returning Nothing is the vastly common case</span><span>
</span><span id="line-2599"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Reduction
</span><a href="#local-6989586621682008851"><span class="hs-identifier hs-var">m_stuff</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2600"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe Reduction
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2601"></span><span>                         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEqCanLHSFinish can't make a canonical&quot;</span></span><span>
</span><span id="line-2602"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2603"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="#local-6989586621682008849"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008839"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2604"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008853"><span class="annot"><span class="annottext">rhs_redn :: Reduction
</span><a href="#local-6989586621682008853"><span class="hs-identifier hs-var">rhs_redn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682008854"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008854"><span class="hs-identifier hs-var">new_rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2605"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;canEqCanLHSFinish breaking a cycle&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcS ()) -&gt; SDoc -&gt; TcS ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2606"></span><span>                            </span><span class="annot"><span class="annottext">CanEqLHS -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2607"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;new RHS:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008854"><span class="hs-identifier hs-var">new_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2608"></span><span>
</span><span id="line-2609"></span><span>                   </span><span class="hs-comment">-- This check is Detail (1) in the Note</span><span>
</span><span id="line-2610"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CheckTyEqResult -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#cterHasOccursCheck"><span class="hs-identifier hs-var">cterHasOccursCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type -&gt; CheckTyEqResult
</span><a href="GHC.Tc.Utils.Unify.html#checkTypeEq"><span class="hs-identifier hs-var">checkTypeEq</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008854"><span class="hs-identifier hs-var">new_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2611"></span><span>
</span><span id="line-2612"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Note [Type equality cycles] Detail (1)&quot;</span></span><span>
</span><span id="line-2613"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008854"><span class="hs-identifier hs-var">new_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2614"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtIrredReason -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.Tc.Types.Constraint.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a></span><span> </span><span class="annot"><span class="annottext">CtIrredReason
</span><a href="#local-6989586621682008849"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008839"><span class="hs-identifier hs-var">new_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2615"></span><span>
</span><span id="line-2616"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- See Detail (6) of Note [Type equality cycles]</span><span>
</span><span id="line-2617"></span><span>                             </span><span id="local-6989586621682008855"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008855"><span class="hs-identifier hs-var">new_new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-var">emptyRewriterSet</span></a></span><span>
</span><span id="line-2618"></span><span>                                             </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008839"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span>
</span><span id="line-2619"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkReflRedn"><span class="hs-identifier hs-var">mkReflRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008841"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2620"></span><span>                                             </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008853"><span class="hs-identifier hs-var">rhs_redn</span></a></span><span>
</span><span id="line-2621"></span><span>
</span><span id="line-2622"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; TcS (StopOrContinue Ct)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CEqCan"><span class="hs-identifier hs-type">CEqCan</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cc_ev :: CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#cc_ev"><span class="hs-identifier hs-var">cc_ev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008855"><span class="hs-identifier hs-var">new_new_ev</span></a></span><span>
</span><span id="line-2623"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_lhs :: CanEqLHS
</span><a href="GHC.Tc.Types.Constraint.html#cc_lhs"><span class="hs-identifier hs-var">cc_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2624"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_rhs :: Type
</span><a href="GHC.Tc.Types.Constraint.html#cc_rhs"><span class="hs-identifier hs-var">cc_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008854"><span class="hs-identifier hs-var">new_rhs</span></a></span><span>
</span><span id="line-2625"></span><span>                                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cc_eq_rel :: EqRel
</span><a href="GHC.Tc.Types.Constraint.html#cc_eq_rel"><span class="hs-identifier hs-var">cc_eq_rel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008835"><span class="hs-identifier hs-var">eq_rel</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-2626"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2627"></span><span>    </span><span id="local-6989586621682008840"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621682008840"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008835"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-2628"></span><span>
</span><span id="line-2629"></span><span>    </span><span id="local-6989586621682008841"><span class="annot"><span class="annottext">lhs_ty :: Type
</span><a href="#local-6989586621682008841"><span class="hs-identifier hs-var hs-var">lhs_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanEqLHS -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#canEqLHSType"><span class="hs-identifier hs-var">canEqLHSType</span></a></span><span> </span><span class="annot"><span class="annottext">CanEqLHS
</span><a href="#local-6989586621682008837"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2630"></span><span>
</span><span id="line-2631"></span><span>    </span><span class="hs-comment">-- This is about (TyEq:N): check that we don't have a saturated application</span><span>
</span><span id="line-2632"></span><span>    </span><span class="hs-comment">-- of a newtype TyCon at the top level of the RHS, if the constructor</span><span>
</span><span id="line-2633"></span><span>    </span><span class="hs-comment">-- of the newtype is in scope.</span><span>
</span><span id="line-2634"></span><span>    </span><span class="annot"><a href="#local-6989586621682008844"><span class="hs-identifier hs-type">ty_eq_N_OK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2635"></span><span>    </span><span id="local-6989586621682008844"><span class="annot"><span class="annottext">ty_eq_N_OK :: TcS Bool
</span><a href="#local-6989586621682008844"><span class="hs-identifier hs-var hs-var">ty_eq_N_OK</span></a></span></span><span>
</span><span id="line-2636"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="GHC.Core.Predicate.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008835"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-2637"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008856"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008856"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008857"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008857"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008838"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2638"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008859"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682008859"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe DataCon
</span><a href="GHC.Core.TyCon.html#newTyConDataCon_maybe"><span class="hs-identifier hs-var">newTyConDataCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008856"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2639"></span><span>      </span><span class="hs-comment">-- #22310: only a problem if the newtype TyCon is saturated.</span><span>
</span><span id="line-2640"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008857"><span class="hs-identifier hs-var">tc_args</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Int -&gt; Bool
forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthAtLeast"><span class="hs-operator hs-var">`lengthAtLeast`</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008856"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2641"></span><span>      </span><span class="hs-comment">-- #21010: only a problem if the newtype constructor is in scope.</span><span>
</span><span id="line-2642"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008863"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008863"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS GlobalRdrEnv
</span><a href="GHC.Tc.Solver.Monad.html#getGlobalRdrEnvTcS"><span class="hs-identifier hs-var">getGlobalRdrEnvTcS</span></a></span><span>
</span><span id="line-2643"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008864"><span class="annot"><span class="annottext">con_in_scope :: Bool
</span><a href="#local-6989586621682008864"><span class="hs-identifier hs-var hs-var">con_in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe GlobalRdrElt -&gt; Bool) -&gt; Maybe GlobalRdrElt -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; Name -&gt; Maybe GlobalRdrElt
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682008863"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682008859"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2644"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcS Bool
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; TcS Bool) -&gt; Bool -&gt; TcS Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682008864"><span class="hs-identifier hs-var">con_in_scope</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2645"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2646"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcS Bool
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2647"></span><span>
</span><span id="line-2648"></span><span class="annot"><span class="hs-comment">-- | Solve a reflexive equality constraint</span></span><span>
</span><span id="line-2649"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#canEqReflexive"><span class="hs-identifier hs-type">canEqReflexive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>    </span><span class="hs-comment">-- ty ~ ty</span><span>
</span><span id="line-2650"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span>
</span><span id="line-2651"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>        </span><span class="hs-comment">-- ty</span><span>
</span><span id="line-2652"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- always Stop</span><span>
</span><span id="line-2653"></span><span id="canEqReflexive"><span class="annot"><span class="annottext">canEqReflexive :: CtEvidence -&gt; EqRel -&gt; Type -&gt; TcS (StopOrContinue Ct)
</span><a href="GHC.Tc.Solver.Canonical.html#canEqReflexive"><span class="hs-identifier hs-var hs-var">canEqReflexive</span></a></span></span><span> </span><span id="local-6989586621682008866"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008866"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008867"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008867"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008868"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008868"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2654"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setEvBindIfWanted"><span class="hs-identifier hs-var">setEvBindIfWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008866"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercion -&gt; EvTerm) -&gt; TcCoercion -&gt; EvTerm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2655"></span><span>                               </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008867"><span class="hs-identifier hs-var">eq_rel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008868"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2656"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue Ct)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008866"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Solved by reflexivity&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2657"></span><span>
</span><span id="line-2658"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#rewriteCastedEquality"><span class="hs-identifier hs-type">rewriteCastedEquality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>     </span><span class="hs-comment">-- :: lhs ~ (rhs |&gt; mco), or (rhs |&gt; mco) ~ lhs</span><span>
</span><span id="line-2659"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Predicate.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-2660"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>         </span><span class="hs-comment">-- lhs</span><span>
</span><span id="line-2661"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>         </span><span class="hs-comment">-- rhs</span><span>
</span><span id="line-2662"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>      </span><span class="hs-comment">-- mco</span><span>
</span><span id="line-2663"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-comment">-- :: (lhs |&gt; sym mco) ~ rhs</span><span>
</span><span id="line-2664"></span><span>                                        </span><span class="hs-comment">-- result is independent of SwapFlag</span><span>
</span><span id="line-2665"></span><span id="rewriteCastedEquality"><span class="annot"><span class="annottext">rewriteCastedEquality :: CtEvidence
-&gt; EqRel -&gt; SwapFlag -&gt; Type -&gt; Type -&gt; MCoercion -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteCastedEquality"><span class="hs-identifier hs-var hs-var">rewriteCastedEquality</span></a></span></span><span> </span><span id="local-6989586621682008869"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008869"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008870"><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008870"><span class="hs-identifier hs-var">eq_rel</span></a></span></span><span> </span><span id="local-6989586621682008871"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008871"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span id="local-6989586621682008872"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008872"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621682008873"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008873"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span id="local-6989586621682008874"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008874"><span class="hs-identifier hs-var">mco</span></a></span></span><span>
</span><span id="line-2666"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var">rewriteEqEvidence</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#emptyRewriterSet"><span class="hs-identifier hs-var">emptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008869"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008871"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008875"><span class="hs-identifier hs-var">lhs_redn</span></a></span><span> </span><span class="annot"><span class="annottext">Reduction
</span><a href="#local-6989586621682008876"><span class="hs-identifier hs-var">rhs_redn</span></a></span><span>
</span><span id="line-2667"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2668"></span><span>    </span><span id="local-6989586621682008875"><span class="annot"><span class="annottext">lhs_redn :: Reduction
</span><a href="#local-6989586621682008875"><span class="hs-identifier hs-var hs-var">lhs_redn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflRightMRedn"><span class="hs-identifier hs-var">mkGReflRightMRedn</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008878"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008872"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008879"><span class="hs-identifier hs-var">sym_mco</span></a></span><span>
</span><span id="line-2669"></span><span>    </span><span id="local-6989586621682008876"><span class="annot"><span class="annottext">rhs_redn :: Reduction
</span><a href="#local-6989586621682008876"><span class="hs-identifier hs-var hs-var">rhs_redn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Reduction
</span><a href="GHC.Core.Reduction.html#mkGReflLeftMRedn"><span class="hs-identifier hs-var">mkGReflLeftMRedn</span></a></span><span>  </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008878"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008873"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008874"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2670"></span><span>
</span><span id="line-2671"></span><span>    </span><span id="local-6989586621682008879"><span class="annot"><span class="annottext">sym_mco :: MCoercion
</span><a href="#local-6989586621682008879"><span class="hs-identifier hs-var hs-var">sym_mco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var">mkSymMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621682008874"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2672"></span><span>    </span><span id="local-6989586621682008878"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621682008878"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EqRel -&gt; Role
</span><a href="GHC.Core.Predicate.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><a href="#local-6989586621682008870"><span class="hs-identifier hs-var">eq_rel</span></a></span><span>
</span><span id="line-2673"></span><span>
</span><span id="line-2674"></span><span class="hs-comment">{- Note [Equalities with incompatible kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
What do we do when we have an equality

  (tv :: k1) ~ (rhs :: k2)

where k1 and k2 differ? Easy: we create a coercion that relates k1 and
k2 and use this to cast. To wit, from

  [X] (tv :: k1) ~ (rhs :: k2)

(where [X] is [G] or [W]), we go to

  [X] co :: k1 ~ k2
  [X] (tv :: k1) ~ ((rhs |&gt; sym co) :: k1)

We carry on with the *kind equality*, not the type equality, because
solving the former may unlock the latter. This choice is made in
canEqCanLHSHetero. It is important: otherwise, T13135 loops.

Wrinkles:

 (1) When X is W, the new type-level wanted is effectively rewritten by the
     kind-level one. We thus include the kind-level wanted in the RewriterSet
     for the type-level one. See Note [Wanteds rewrite Wanteds] in GHC.Tc.Types.Constraint.
     This is done in canEqCanLHSHetero.

 (2) If we have [W] w :: alpha ~ (rhs |&gt; sym co_hole), should we unify alpha? No.
     The problem is that the wanted w is effectively rewritten by another wanted,
     and unifying alpha effectively promotes this wanted to a given. Doing so
     means we lose track of the rewriter set associated with the wanted.

     On the other hand, w is perfectly suitable for rewriting, because of the
     way we carefully track rewriter sets.

     We thus allow w to be a CEqCan, but we prevent unification. See
     Note [Unification preconditions] in GHC.Tc.Utils.Unify.

     The only tricky part is that we must later indeed unify if/when the kind-level
     wanted gets solved. This is done in kickOutAfterFillingCoercionHole,
     which kicks out all equalities whose RHS mentions the filled-in coercion hole.
     Note that it looks for type family equalities, too, because of the use of
     unifyTest in canEqTyVarFunEq.

 (3) Suppose we have [W] (a :: k1) ~ (rhs :: k2). We duly follow the
     algorithm detailed here, producing [W] co :: k1 ~ k2, and adding
     [W] (a :: k1) ~ ((rhs |&gt; sym co) :: k1) to the irreducibles. Some time
     later, we solve co, and fill in co's coercion hole. This kicks out
     the irreducible as described in (2).
     But now, during canonicalization, we see the cast
     and remove it, in canEqCast. By the time we get into canEqCanLHS, the equality
     is heterogeneous again, and the process repeats.

     To avoid this, we don't strip casts off a type if the other type
     in the equality is a CanEqLHS (the scenario above can happen with a
     type family, too. testcase: typecheck/should_compile/T13822).
     And this is an improvement regardless:
     because tyvars can, generally, unify with casted types, there's no
     reason to go through the work of stripping off the cast when the
     cast appears opposite a tyvar. This is implemented in the cast case
     of can_eq_nc'.

Historical note:

We used to do this via emitting a Derived kind equality and then parking
the heterogeneous equality as irreducible. But this new approach is much
more direct. And it doesn't produce duplicate Deriveds (as the old one did).

Note [Type synonyms and canonicalization]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We treat type synonym applications as xi types, that is, they do not
count as type function applications.  However, we do need to be a bit
careful with type synonyms: like type functions they may not be
generative or injective.  However, unlike type functions, they are
parametric, so there is no problem in expanding them whenever we see
them, since we do not need to know anything about their arguments in
order to expand them; this is what justifies not having to treat them
as specially as type function applications.  The thing that causes
some subtleties is that we prefer to leave type synonym applications
*unexpanded* whenever possible, in order to generate better error
messages.

If we encounter an equality constraint with type synonym applications
on both sides, or a type synonym application on one side and some sort
of type application on the other, we simply must expand out the type
synonyms in order to continue decomposing the equality constraint into
primitive equality constraints.  For example, suppose we have

  type F a = [Int]

and we encounter the equality

  F a ~ [b]

In order to continue we must expand F a into [Int], giving us the
equality

  [Int] ~ [b]

which we can then decompose into the more primitive equality
constraint

  Int ~ b.

However, if we encounter an equality constraint with a type synonym
application on one side and a variable on the other side, we should
NOT (necessarily) expand the type synonym, since for the purpose of
good error messages we want to leave type synonyms unexpanded as much
as possible.  Hence the ps_xi1, ps_xi2 argument passed to canEqCanLHS.

Note [Type equality cycles]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this situation (from indexed-types/should_compile/GivenLoop):

  instance C (Maybe b)
  *[G] a ~ Maybe (F a)
  [W] C a

or (typecheck/should_compile/T19682b):

  instance C (a -&gt; b)
  *[W] alpha ~ (Arg alpha -&gt; Res alpha)
  [W] C alpha

or (typecheck/should_compile/T21515):

  type family Code a
  *[G] Code a ~ '[ '[ Head (Head (Code a)) ] ]
  [W] Code a ~ '[ '[ alpha ] ]

In order to solve the final Wanted, we must use the starred constraint
for rewriting. But note that all starred constraints have occurs-check failures,
and so we can't straightforwardly add these to the inert set and
use them for rewriting. (NB: A rigid type constructor is at the
top of all RHSs, preventing reorienting in canEqTyVarFunEq in the tyvar
cases.)

The key idea is to replace the outermost type family applications in the RHS of the
starred constraints with a fresh variable, which we'll call a cycle-breaker
variable, or cbv. Then, relate the cbv back with the original type family application
via new equality constraints. Our situations thus become:

  instance C (Maybe b)
  [G] a ~ Maybe cbv
  [G] F a ~ cbv
  [W] C a

or

  instance C (a -&gt; b)
  [W] alpha ~ (cbv1 -&gt; cbv2)
  [W] Arg alpha ~ cbv1
  [W] Res alpha ~ cbv2
  [W] C alpha

or

  [G] Code a ~ '[ '[ cbv ] ]
  [G] Head (Head (Code a)) ~ cbv
  [W] Code a ~ '[ '[ alpha ] ]

This transformation (creating the new types and emitting new equality
constraints) is done in breakTyEqCycle_maybe.

The details depend on whether we're working with a Given or a Wanted.

Given
-----

We emit a new Given, [G] F a ~ cbv, equating the type family application to
our new cbv. Note its orientation: The type family ends up on the left; see
commentary on canEqTyVarFunEq, which decides how to orient such cases. No
special treatment for CycleBreakerTvs is necessary. This scenario is now
easily soluble, by using the first Given to rewrite the Wanted, which can now
be solved.

(The first Given actually also rewrites the second one, giving
[G] F (Maybe cbv) ~ cbv, but this causes no trouble.)

Of course, we don't want our fresh variables leaking into e.g. error messages.
So we fill in the metavariables with their original type family applications
after we're done running the solver (in nestImplicTcS and runTcSWithEvBinds).
This is done by restoreTyVarCycles, which uses the inert_cycle_breakers field in
InertSet, which contains the pairings invented in breakTyEqCycle_maybe.

That is:

We transform
  [G] g : lhs ~ ...(F lhs)...
to
  [G] (Refl lhs) : F lhs ~ cbv      -- CEqCan
  [G] g          : lhs ~ ...cbv...  -- CEqCan

Note that
* `cbv` is a fresh cycle breaker variable.
* `cbv` is a is a meta-tyvar, but it is completely untouchable.
* We track the cycle-breaker variables in inert_cycle_breakers in InertSet
* We eventually fill in the cycle-breakers, with `cbv := F lhs`.
  No one else fills in cycle-breakers!
* The evidence for the new `F lhs ~ cbv` constraint is Refl, because we know
  this fill-in is ultimately going to happen.
* In inert_cycle_breakers, we remember the (cbv, F lhs) pair; that is, we
  remember the /original/ type.  The [G] F lhs ~ cbv constraint may be rewritten
  by other givens (eg if we have another [G] lhs ~ (b,c)), but at the end we
  still fill in with cbv := F lhs
* This fill-in is done when solving is complete, by restoreTyVarCycles
  in nestImplicTcS and runTcSWithEvBinds.

Wanted
------
The fresh cycle-breaker variables here must actually be normal, touchable
metavariables. That is, they are TauTvs. Nothing at all unusual. Repeating
the example from above, we have

  *[W] alpha ~ (Arg alpha -&gt; Res alpha)

and we turn this into

  *[W] alpha ~ (cbv1 -&gt; cbv2)
  [W] Arg alpha ~ cbv1
  [W] Res alpha ~ cbv2

where cbv1 and cbv2 are fresh TauTvs. Why TauTvs? See [Why TauTvs] below.

Critically, we emit the two new constraints (the last two above)
directly instead of calling unifyWanted. (Otherwise, we'd end up unifying cbv1
and cbv2 immediately, achieving nothing.)
Next, we unify alpha := cbv1 -&gt; cbv2, having eliminated the occurs check. This
unification -- which must be the next step after breaking the cycles --
happens in the course of normal behavior of top-level
interactions, later in the solver pipeline. We know this unification will
indeed happen because breakTyEqCycle_maybe, which decides whether to apply
this logic, checks to ensure unification will succeed in its final_check.
(In particular, the LHS must be a touchable tyvar, never a type family. We don't
yet have an example of where this logic is needed with a type family, and it's
unclear how to handle this case, so we're skipping for now.) Now, we're
here (including further context from our original example, from the top of the
Note):

  instance C (a -&gt; b)
  [W] Arg (cbv1 -&gt; cbv2) ~ cbv1
  [W] Res (cbv1 -&gt; cbv2) ~ cbv2
  [W] C (cbv1 -&gt; cbv2)

The first two W constraints reduce to reflexivity and are discarded,
and the last is easily soluble.

[Why TauTvs]:
Let's look at another example (typecheck/should_compile/T19682) where we need
to unify the cbvs:

  class    (AllEqF xs ys, SameShapeAs xs ys) =&gt; AllEq xs ys
  instance (AllEqF xs ys, SameShapeAs xs ys) =&gt; AllEq xs ys

  type family SameShapeAs xs ys :: Constraint where
    SameShapeAs '[] ys      = (ys ~ '[])
    SameShapeAs (x : xs) ys = (ys ~ (Head ys : Tail ys))

  type family AllEqF xs ys :: Constraint where
    AllEqF '[]      '[]      = ()
    AllEqF (x : xs) (y : ys) = (x ~ y, AllEq xs ys)

  [W] alpha ~ (Head alpha : Tail alpha)
  [W] AllEqF '[Bool] alpha

Without the logic detailed in this Note, we're stuck here, as AllEqF cannot
reduce and alpha cannot unify. Let's instead apply our cycle-breaker approach,
just as described above. We thus invent cbv1 and cbv2 and unify
alpha := cbv1 -&gt; cbv2, yielding (after zonking)

  [W] Head (cbv1 : cbv2) ~ cbv1
  [W] Tail (cbv1 : cbv2) ~ cbv2
  [W] AllEqF '[Bool] (cbv1 : cbv2)

The first two W constraints simplify to reflexivity and are discarded.
But the last reduces:

  [W] Bool ~ cbv1
  [W] AllEq '[] cbv2

The first of these is solved by unification: cbv1 := Bool. The second
is solved by the instance for AllEq to become

  [W] AllEqF '[] cbv2
  [W] SameShapeAs '[] cbv2

While the first of these is stuck, the second makes progress, to lead to

  [W] AllEqF '[] cbv2
  [W] cbv2 ~ '[]

This second constraint is solved by unification: cbv2 := '[]. We now
have

  [W] AllEqF '[] '[]

which reduces to

  [W] ()

which is trivially satisfiable. Hooray!

Note that we need to unify the cbvs here; if we did not, there would be
no way to solve those constraints. That's why the cycle-breakers are
ordinary TauTvs.

In all cases
------------

We detect this scenario by the following characteristics:
 - a constraint with a soluble occurs-check failure
   (as indicated by the cteSolubleOccurs bit set in a CheckTyEqResult
   from checkTypeEq)
 - and a nominal equality
 - and either
    - a Given flavour (but see also Detail (7) below)
    - a Wanted flavour, with a touchable metavariable on the left

We don't use this trick for representational equalities, as there is no
concrete use case where it is helpful (unlike for nominal equalities).
Furthermore, because function applications can be CanEqLHSs, but newtype
applications cannot, the disparities between the cases are enough that it
would be effortful to expand the idea to representational equalities. A quick
attempt, with

      data family N a b

      f :: (Coercible a (N a b), Coercible (N a b) b) =&gt; a -&gt; b
      f = coerce

failed with &quot;Could not match 'b' with 'b'.&quot; Further work is held off
until when we have a concrete incentive to explore this dark corner.

Details:

 (1) We don't look under foralls, at all, when substituting away type family
     applications, because doing so can never be fruitful. Recall that we
     are in a case like [G] lhs ~ forall b. ... lhs ....   Until we have a type
     family that can pull the body out from a forall (e.g. type instance F (forall b. ty) = ty),
     this will always be
     insoluble. Note also that the forall cannot be in an argument to a
     type family, or that outer type family application would already have
     been substituted away.

     However, we still must check to make sure that breakTyEqCycle_maybe actually
     succeeds in getting rid of all occurrences of the offending lhs. If
     one is hidden under a forall, this won't be true. A similar problem can
     happen if the variable appears only in a kind
     (e.g. k ~ ... (a :: k) ...). So we perform an additional check after
     performing the substitution. It is tiresome to re-run all of checkTypeEq
     here, but reimplementing just the occurs-check is even more tiresome.

     Skipping this check causes typecheck/should_fail/GivenForallLoop and
     polykinds/T18451 to loop.

 (2) Our goal here is to avoid loops in rewriting. We can thus skip looking
     in coercions, as we don't rewrite in coercions in the algorithm in
     GHC.Solver.Rewrite. (This is another reason
     we need to re-check that we've gotten rid of all occurrences of the
     offending variable.)

 (3) As we're substituting as described in this Note, we can build ill-kinded
     types. For example, if we have Proxy (F a) b, where (b :: F a), then
     replacing this with Proxy cbv b is ill-kinded. However, we will later
     set cbv := F a, and so the zonked type will be well-kinded again.
     The temporary ill-kinded type hurts no one, and avoiding this would
     be quite painfully difficult.

     Specifically, this detail does not contravene the Purely Kinded Type Invariant
     (Note [The Purely Kinded Type Invariant (PKTI)] in GHC.Tc.Gen.HsType).
     The PKTI says that we can call typeKind on any type, without failure.
     It would be violated if we, say, replaced a kind (a -&gt; b) with a kind c,
     because an arrow kind might be consulted in piResultTys. Here, we are
     replacing one opaque type like (F a b c) with another, cbv (opaque in
     that we never assume anything about its structure, like that it has a
     result type or a RuntimeRep argument).

 (4) The evidence for the produced Givens is all just reflexive, because
     we will eventually set the cycle-breaker variable to be the type family,
     and then, after the zonk, all will be well. See also the notes at the
     end of the Given section of this Note.

 (5) The approach here is inefficient because it replaces every (outermost)
     type family application with a type variable, regardless of whether that
     particular appplication is implicated in the occurs check.  An alternative
     would be to replce only type-family applications that mention the offending LHS.
     For instance, we could choose to
     affect only type family applications that mention the offending LHS:
     e.g. in a ~ (F b, G a), we need to replace only G a, not F b. Furthermore,
     we could try to detect cases like a ~ (F a, F a) and use the same
     tyvar to replace F a. (Cf.
     Note [Flattening type-family applications when matching instances]
     in GHC.Core.Unify, which
     goes to this extra effort.) There may be other opportunities for
     improvement. However, this is really a very small corner case.
     The investment to craft a clever,
     performant solution seems unworthwhile.

 (6) We often get the predicate associated with a constraint from its
     evidence with ctPred. We thus must not only make sure the generated
     CEqCan's fields have the updated RHS type (that is, the one produced
     by replacing type family applications with fresh variables),
     but we must also update the evidence itself. This is done by the call to rewriteEqEvidence
     in canEqCanLHSFinish.

 (7) We don't wish to apply this magic on the equalities created
     by this very same process.
     Consider this, from typecheck/should_compile/ContextStack2:

       type instance TF (a, b) = (TF a, TF b)
       t :: (a ~ TF (a, Int)) =&gt; ...

       [G] a ~ TF (a, Int)

     The RHS reduces, so we get

       [G] a ~ (TF a, TF Int)

     We then break cycles, to get

       [G] g1 :: a ~ (cbv1, cbv2)
       [G] g2 :: TF a ~ cbv1
       [G] g3 :: TF Int ~ cbv2

     g1 gets added to the inert set, as written. But then g2 becomes
     the work item. g1 rewrites g2 to become

       [G] TF (cbv1, cbv2) ~ cbv1

     which then uses the type instance to become

       [G] (TF cbv1, TF cbv2) ~ cbv1

     which looks remarkably like the Given we started with. If left
     unchecked, this will end up breaking cycles again, looping ad
     infinitum (and resulting in a context-stack reduction error,
     not an outright loop). The solution is easy: don't break cycles
     on an equality generated by breaking cycles. Instead, we mark this
     final Given as a CIrredCan with a NonCanonicalReason with the soluble
     occurs-check bit set (only).

     We track these equalities by giving them a special CtOrigin,
     CycleBreakerOrigin. This works for both Givens and Wanteds, as
     we need the logic in the W case for e.g. typecheck/should_fail/T17139.
     Because this logic needs to work for Wanteds, too, we cannot
     simply look for a CycleBreakerTv on the left: Wanteds don't use them.

 (8) We really want to do this all only when there is a soluble occurs-check
     failure, not when other problems arise (such as an impredicative
     equality like alpha ~ forall a. a -&gt; a). That is why breakTyEqCycle_maybe
     uses cterHasOnlyProblem when looking at the result of checkTypeEq, which
     checks for many of the invariants on a CEqCan.
-}</span><span>
</span><span id="line-3127"></span><span>
</span><span id="line-3128"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                  Evidence transformation
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-3135"></span><span>
</span><span id="line-3136"></span><span class="hs-keyword">data</span><span> </span><span id="StopOrContinue"><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-var">StopOrContinue</span></a></span></span><span> </span><span id="local-6989586621682007225"><span class="annot"><a href="#local-6989586621682007225"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-3137"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ContinueWith"><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#ContinueWith"><span class="hs-identifier hs-var">ContinueWith</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621682007225"><span class="hs-identifier hs-type">a</span></a></span><span>    </span><span class="hs-comment">-- The constraint was not solved, although it may have</span><span>
</span><span id="line-3138"></span><span>                      </span><span class="hs-comment">--   been rewritten</span><span>
</span><span id="line-3139"></span><span>
</span><span id="line-3140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Stop"><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>   </span><span class="hs-comment">-- The (rewritten) constraint was solved</span><span>
</span><span id="line-3141"></span><span>         </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>         </span><span class="hs-comment">-- Tells how it was solved</span><span>
</span><span id="line-3142"></span><span>                      </span><span class="hs-comment">-- Any new sub-goals have been put on the work list</span><span>
</span><span id="line-3143"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008884"><span id="local-6989586621682008886"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b)
-&gt; (forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a)
-&gt; Functor StopOrContinue
forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a
forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b
fmap :: forall a b. (a -&gt; b) -&gt; StopOrContinue a -&gt; StopOrContinue b
$c&lt;$ :: forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a
&lt;$ :: forall a b. a -&gt; StopOrContinue b -&gt; StopOrContinue a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#Functor/GHC.Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-3144"></span><span>
</span><span id="line-3145"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682007056"><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007056"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007056"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3146"></span><span>  </span><span id="local-6989586621682008899"><span class="annot"><span class="annottext">ppr :: StopOrContinue a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#Stop"><span class="hs-identifier hs-type">Stop</span></a></span><span> </span><span id="local-6989586621682008900"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008900"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008901"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682008901"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Stop&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682008901"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008900"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-3147"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#ContinueWith"><span class="hs-identifier hs-type">ContinueWith</span></a></span><span> </span><span id="local-6989586621682008904"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008904"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ContinueWith&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008904"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-3148"></span><span>
</span><span id="line-3149"></span><span id="local-6989586621682007112"><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-type">continueWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621682007112"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007112"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3150"></span><span id="continueWith"><span class="annot"><span class="annottext">continueWith :: forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var hs-var">continueWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StopOrContinue a -&gt; TcS (StopOrContinue a)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(StopOrContinue a -&gt; TcS (StopOrContinue a))
-&gt; (a -&gt; StopOrContinue a) -&gt; a -&gt; TcS (StopOrContinue a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; StopOrContinue a
forall a. a -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Canonical.html#ContinueWith"><span class="hs-identifier hs-var">ContinueWith</span></a></span><span>
</span><span id="line-3151"></span><span>
</span><span id="line-3152"></span><span id="local-6989586621682007130"><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-type">stopWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007130"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3153"></span><span id="stopWith"><span class="annot"><span class="annottext">stopWith :: forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var hs-var">stopWith</span></a></span></span><span> </span><span id="local-6989586621682008908"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008908"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008909"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682008909"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StopOrContinue a -&gt; TcS (StopOrContinue a)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc -&gt; StopOrContinue a
forall a. CtEvidence -&gt; SDoc -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Canonical.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008908"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682008909"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3154"></span><span>
</span><span id="line-3155"></span><span id="local-6989586621682007110"><span id="local-6989586621682007111"><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#andWhenContinue"><span class="hs-identifier hs-type">andWhenContinue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007110"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3156"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682007110"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007111"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3157"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682007111"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3158"></span><span id="andWhenContinue"><span class="annot"><span class="annottext">andWhenContinue :: forall a b.
TcS (StopOrContinue a)
-&gt; (a -&gt; TcS (StopOrContinue b)) -&gt; TcS (StopOrContinue b)
</span><a href="GHC.Tc.Solver.Canonical.html#andWhenContinue"><span class="hs-identifier hs-var hs-var">andWhenContinue</span></a></span></span><span> </span><span id="local-6989586621682008912"><span class="annot"><span class="annottext">TcS (StopOrContinue a)
</span><a href="#local-6989586621682008912"><span class="hs-identifier hs-var">tcs1</span></a></span></span><span> </span><span id="local-6989586621682008913"><span class="annot"><span class="annottext">a -&gt; TcS (StopOrContinue b)
</span><a href="#local-6989586621682008913"><span class="hs-identifier hs-var">tcs2</span></a></span></span><span>
</span><span id="line-3159"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008914"><span class="annot"><span class="annottext">StopOrContinue a
</span><a href="#local-6989586621682008914"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcS (StopOrContinue a)
</span><a href="#local-6989586621682008912"><span class="hs-identifier hs-var">tcs1</span></a></span><span>
</span><span id="line-3160"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StopOrContinue a
</span><a href="#local-6989586621682008914"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3161"></span><span>           </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#Stop"><span class="hs-identifier hs-type">Stop</span></a></span><span> </span><span id="local-6989586621682008915"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008915"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621682008916"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682008916"><span class="hs-identifier hs-var">s</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StopOrContinue b -&gt; TcS (StopOrContinue b)
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc -&gt; StopOrContinue b
forall a. CtEvidence -&gt; SDoc -&gt; StopOrContinue a
</span><a href="GHC.Tc.Solver.Canonical.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008915"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682008916"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3162"></span><span>           </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#ContinueWith"><span class="hs-identifier hs-type">ContinueWith</span></a></span><span> </span><span id="local-6989586621682008917"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008917"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcS (StopOrContinue b)
</span><a href="#local-6989586621682008913"><span class="hs-identifier hs-var">tcs2</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682008917"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3163"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">0</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#andWhenContinue"><span class="hs-operator hs-type">`andWhenContinue`</span></a></span><span>    </span><span class="hs-comment">-- allow chaining with ($)</span><span>
</span><span id="line-3164"></span><span>
</span><span id="line-3165"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#rewriteEvidence"><span class="hs-identifier hs-type">rewriteEvidence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span>  </span><span class="hs-comment">-- ^ See Note [Wanteds rewrite Wanteds]</span><span>
</span><span id="line-3166"></span><span>                                </span><span class="hs-comment">-- in GHC.Tc.Types.Constraint</span><span>
</span><span id="line-3167"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ old evidence</span></span><span>
</span><span id="line-3168"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ new predicate + coercion, of type &lt;type of old evidence&gt; ~ new predicate</span></span><span>
</span><span id="line-3169"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#StopOrContinue"><span class="hs-identifier hs-type">StopOrContinue</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3170"></span><span class="hs-comment">-- Returns Just new_ev iff either (i)  'co' is reflexivity</span><span>
</span><span id="line-3171"></span><span class="hs-comment">--                             or (ii) 'co' is not reflexivity, and 'new_pred' not cached</span><span>
</span><span id="line-3172"></span><span class="hs-comment">-- In either case, there is nothing new to do with new_ev</span><span>
</span><span id="line-3173"></span><span class="hs-comment">{-
     rewriteEvidence old_ev new_pred co
Main purpose: create new evidence for new_pred;
              unless new_pred is cached already
* Returns a new_ev : new_pred, with same wanted/given flag as old_ev
* If old_ev was wanted, create a binding for old_ev, in terms of new_ev
* If old_ev was given, AND not cached, create a binding for new_ev, in terms of old_ev
* Returns Nothing if new_ev is already cached

        Old evidence    New predicate is               Return new evidence
        flavour                                        of same flavor
        -------------------------------------------------------------------
        Wanted          Already solved or in inert     Nothing
                        Not                            Just new_evidence

        Given           Already in inert               Nothing
                        Not                            Just new_evidence

Note [Rewriting with Refl]
~~~~~~~~~~~~~~~~~~~~~~~~~~
If the coercion is just reflexivity then you may re-use the same
variable.  But be careful!  Although the coercion is Refl, new_pred
may reflect the result of unification alpha := ty, so new_pred might
not _look_ the same as old_pred, and it's vital to proceed from now on
using new_pred.

The rewriter preserves type synonyms, so they should appear in new_pred
as well as in old_pred; that is important for good error messages.

If we are rewriting with Refl, then there are no new rewriters to add to
the rewriter set. We check this with an assertion.
 -}</span><span>
</span><span id="line-3205"></span><span>
</span><span id="line-3206"></span><span>
</span><span id="line-3207"></span><span id="rewriteEvidence"><span class="annot"><span class="annottext">rewriteEvidence :: RewriterSet
-&gt; CtEvidence -&gt; Reduction -&gt; TcS (StopOrContinue CtEvidence)
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEvidence"><span class="hs-identifier hs-var hs-var">rewriteEvidence</span></a></span></span><span> </span><span id="local-6989586621682008918"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008918"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682008919"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008919"><span class="hs-identifier hs-var">old_ev</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621682008920"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008920"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682008921"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008921"><span class="hs-identifier hs-var">new_pred</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3208"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008920"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-comment">-- See Note [Rewriting with Refl]</span><span>
</span><span id="line-3209"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyRewriterSet"><span class="hs-identifier hs-var">isEmptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008918"><span class="hs-identifier hs-var">rewriters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue CtEvidence)
 -&gt; TcS (StopOrContinue CtEvidence))
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3210"></span><span>    </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue CtEvidence)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CtEvidence -&gt; Type -&gt; CtEvidence
CtEvidence -&gt; Type -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#setCtEvPredType"><span class="hs-identifier hs-var">setCtEvPredType</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008919"><span class="hs-identifier hs-var">old_ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008921"><span class="hs-identifier hs-var">new_pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3211"></span><span>
</span><span id="line-3212"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span id="local-6989586621682008924"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008924"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682008925"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621682008925"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008926"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008926"><span class="hs-identifier hs-var">old_evar</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008927"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008927"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3213"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621682008928"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008928"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682008929"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008929"><span class="hs-identifier hs-var">new_pred</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyRewriterSet"><span class="hs-identifier hs-var">isEmptyRewriterSet</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008924"><span class="hs-identifier hs-var">rewriters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcS (StopOrContinue CtEvidence)
 -&gt; TcS (StopOrContinue CtEvidence))
-&gt; TcS (StopOrContinue CtEvidence)
-&gt; TcS (StopOrContinue CtEvidence)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- this is a Given, not a wanted</span><span>
</span><span id="line-3215"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008930"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008930"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008927"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008929"><span class="hs-identifier hs-var">new_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621682008931"><span class="hs-identifier hs-var">new_tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3216"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue CtEvidence)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008930"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3217"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3218"></span><span>    </span><span class="hs-comment">-- mkEvCast optimises ReflCo</span><span>
</span><span id="line-3219"></span><span>    </span><span id="local-6989586621682008931"><span class="annot"><span class="annottext">new_tm :: EvTerm
</span><a href="#local-6989586621682008931"><span class="hs-identifier hs-var hs-var">new_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#mkEvCast"><span class="hs-identifier hs-var">mkEvCast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; EvExpr
</span><a href="GHC.Tc.Types.Evidence.html#evId"><span class="hs-identifier hs-var">evId</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008926"><span class="hs-identifier hs-var">old_evar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3220"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Role
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRole"><span class="hs-identifier hs-var">ctEvRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008925"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008928"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3221"></span><span>
</span><span id="line-3222"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#rewriteEvidence"><span class="hs-identifier hs-var">rewriteEvidence</span></a></span><span> </span><span id="local-6989586621682008933"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008933"><span class="hs-identifier hs-var">new_rewriters</span></a></span></span><span>
</span><span id="line-3223"></span><span>                </span><span id="local-6989586621682008934"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621682008934"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008935"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008935"><span class="hs-identifier hs-var">dest</span></a></span></span><span>
</span><span id="line-3224"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_loc :: CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctev_loc"><span class="hs-identifier hs-var">ctev_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008936"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008936"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-3225"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008937"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008937"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3226"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621682008938"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008938"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621682008939"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008939"><span class="hs-identifier hs-var">new_pred</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3227"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008940"><span class="annot"><span class="annottext">MaybeNew
</span><a href="#local-6989586621682008940"><span class="hs-identifier hs-var">mb_new_ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Type -&gt; TcS MaybeNew
</span><a href="GHC.Tc.Solver.Monad.html#newWanted"><span class="hs-identifier hs-var">newWanted</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008936"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008942"><span class="hs-identifier hs-var">rewriters'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008939"><span class="hs-identifier hs-var">new_pred</span></a></span><span>
</span><span id="line-3228"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcS ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008938"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Role
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRole"><span class="hs-identifier hs-var">ctEvRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008934"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3229"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcEvDest -&gt; EvTerm -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEvTerm"><span class="hs-identifier hs-var">setWantedEvTerm</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008935"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-3230"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#mkEvCast"><span class="hs-identifier hs-var">mkEvCast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MaybeNew -&gt; EvExpr
</span><a href="GHC.Tc.Solver.Monad.html#getEvExpr"><span class="hs-identifier hs-var">getEvExpr</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeNew
</span><a href="#local-6989586621682008940"><span class="hs-identifier hs-var">mb_new_ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3231"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Role
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRole"><span class="hs-identifier hs-var">ctEvRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008934"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008938"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3232"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaybeNew
</span><a href="#local-6989586621682008940"><span class="hs-identifier hs-var">mb_new_ev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3233"></span><span>            </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Fresh"><span class="hs-identifier hs-type">Fresh</span></a></span><span>  </span><span id="local-6989586621682008946"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008946"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS (StopOrContinue CtEvidence)
forall a. a -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#continueWith"><span class="hs-identifier hs-var">continueWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008946"><span class="hs-identifier hs-var">new_ev</span></a></span><span>
</span><span id="line-3234"></span><span>            </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#Cached"><span class="hs-identifier hs-type">Cached</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; String -&gt; TcS (StopOrContinue CtEvidence)
forall a. CtEvidence -&gt; String -&gt; TcS (StopOrContinue a)
</span><a href="GHC.Tc.Solver.Canonical.html#stopWith"><span class="hs-identifier hs-var">stopWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008934"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cached wanted&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3235"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3236"></span><span>    </span><span id="local-6989586621682008942"><span class="annot"><span class="annottext">rewriters' :: RewriterSet
</span><a href="#local-6989586621682008942"><span class="hs-identifier hs-var hs-var">rewriters'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008937"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; RewriterSet -&gt; RewriterSet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">S.&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008933"><span class="hs-identifier hs-var">new_rewriters</span></a></span><span>
</span><span id="line-3237"></span><span>
</span><span id="line-3238"></span><span>
</span><span id="line-3239"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-type">rewriteEqEvidence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span>        </span><span class="hs-comment">-- New rewriters</span><span>
</span><span id="line-3240"></span><span>                                        </span><span class="hs-comment">-- See GHC.Tc.Types.Constraint</span><span>
</span><span id="line-3241"></span><span>                                        </span><span class="hs-comment">-- Note [Wanteds rewrite Wanteds]</span><span>
</span><span id="line-3242"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>         </span><span class="hs-comment">-- Old evidence :: olhs ~ orhs (not swapped)</span><span>
</span><span id="line-3243"></span><span>                                        </span><span class="hs-comment">--              or orhs ~ olhs (swapped)</span><span>
</span><span id="line-3244"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a></span><span>
</span><span id="line-3245"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>          </span><span class="hs-comment">-- lhs_co :: olhs ~ nlhs</span><span>
</span><span id="line-3246"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span>          </span><span class="hs-comment">-- rhs_co :: orhs ~ nrhs</span><span>
</span><span id="line-3247"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a></span><span>     </span><span class="hs-comment">-- Of type nlhs ~ nrhs</span><span>
</span><span id="line-3248"></span><span class="hs-comment">-- With reductions (Reduction lhs_co nlhs) (Reduction rhs_co nrhs),</span><span>
</span><span id="line-3249"></span><span class="hs-comment">-- rewriteEqEvidence yields, for a given equality (Given g olhs orhs):</span><span>
</span><span id="line-3250"></span><span class="hs-comment">-- If not swapped</span><span>
</span><span id="line-3251"></span><span class="hs-comment">--      g1 : nlhs ~ nrhs = sym lhs_co ; g ; rhs_co</span><span>
</span><span id="line-3252"></span><span class="hs-comment">-- If swapped</span><span>
</span><span id="line-3253"></span><span class="hs-comment">--      g1 : nlhs ~ nrhs = sym lhs_co ; Sym g ; rhs_co</span><span>
</span><span id="line-3254"></span><span class="hs-comment">--</span><span>
</span><span id="line-3255"></span><span class="hs-comment">-- For a wanted equality (Wanted w), we do the dual thing:</span><span>
</span><span id="line-3256"></span><span class="hs-comment">-- New  w1 : nlhs ~ nrhs</span><span>
</span><span id="line-3257"></span><span class="hs-comment">-- If not swapped</span><span>
</span><span id="line-3258"></span><span class="hs-comment">--      w : olhs ~ orhs = lhs_co ; w1 ; sym rhs_co</span><span>
</span><span id="line-3259"></span><span class="hs-comment">-- If swapped</span><span>
</span><span id="line-3260"></span><span class="hs-comment">--      w : orhs ~ olhs = rhs_co ; sym w1 ; sym lhs_co</span><span>
</span><span id="line-3261"></span><span class="hs-comment">--</span><span>
</span><span id="line-3262"></span><span class="hs-comment">-- It's all a form of rewriteEvidence, specialised for equalities</span><span>
</span><span id="line-3263"></span><span id="rewriteEqEvidence"><span class="annot"><span class="annottext">rewriteEqEvidence :: RewriterSet
-&gt; CtEvidence
-&gt; SwapFlag
-&gt; Reduction
-&gt; Reduction
-&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Canonical.html#rewriteEqEvidence"><span class="hs-identifier hs-var hs-var">rewriteEqEvidence</span></a></span></span><span> </span><span id="local-6989586621682008948"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008948"><span class="hs-identifier hs-var">new_rewriters</span></a></span></span><span> </span><span id="local-6989586621682008949"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span></span><span> </span><span id="local-6989586621682008950"><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008950"><span class="hs-identifier hs-var">swapped</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621682008951"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008951"><span class="hs-identifier hs-var">lhs_co</span></a></span></span><span> </span><span id="local-6989586621682008952"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008952"><span class="hs-identifier hs-var">nlhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Reduction.html#Reduction"><span class="hs-identifier hs-type">Reduction</span></a></span><span> </span><span id="local-6989586621682008953"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008953"><span class="hs-identifier hs-var">rhs_co</span></a></span></span><span> </span><span id="local-6989586621682008954"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008954"><span class="hs-identifier hs-var">nrhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3264"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="GHC.Types.Basic.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008950"><span class="hs-identifier hs-var">swapped</span></a></span><span>
</span><span id="line-3265"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008951"><span class="hs-identifier hs-var">lhs_co</span></a></span><span>      </span><span class="hs-comment">-- See Note [Rewriting with Refl]</span><span>
</span><span id="line-3266"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008953"><span class="hs-identifier hs-var">rhs_co</span></a></span><span>
</span><span id="line-3267"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS CtEvidence
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CtEvidence -&gt; Type -&gt; CtEvidence
CtEvidence -&gt; Type -&gt; CtEvidence
</span><a href="GHC.Tc.Types.Constraint.html#setCtEvPredType"><span class="hs-identifier hs-var">setCtEvPredType</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008955"><span class="hs-identifier hs-var">new_pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3268"></span><span>
</span><span id="line-3269"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtGiven"><span class="hs-identifier hs-type">CtGiven</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_evar :: CtEvidence -&gt; TcTyVar
</span><a href="GHC.Tc.Types.Constraint.html#ctev_evar"><span class="hs-identifier hs-var">ctev_evar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008956"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008956"><span class="hs-identifier hs-var">old_evar</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span><span>
</span><span id="line-3270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008957"><span class="annot"><span class="annottext">new_tm :: EvTerm
</span><a href="#local-6989586621682008957"><span class="hs-identifier hs-var hs-var">new_tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; EvTerm
</span><a href="GHC.Tc.Types.Evidence.html#evCoercion"><span class="hs-identifier hs-var">evCoercion</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008951"><span class="hs-identifier hs-var">lhs_co</span></a></span><span>
</span><span id="line-3271"></span><span>                                  </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Tc.Types.Evidence.html#maybeSymCo"><span class="hs-identifier hs-var">maybeSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008950"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyVar -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682008956"><span class="hs-identifier hs-var">old_evar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3272"></span><span>                                  </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008953"><span class="hs-identifier hs-var">rhs_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3273"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; (Type, EvTerm) -&gt; TcS CtEvidence
</span><a href="GHC.Tc.Solver.Monad.html#newGivenEvVar"><span class="hs-identifier hs-var">newGivenEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008960"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008955"><span class="hs-identifier hs-var">new_pred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621682008957"><span class="hs-identifier hs-var">new_tm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3274"></span><span>
</span><span id="line-3275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtWanted"><span class="hs-identifier hs-type">CtWanted</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctev_dest :: CtEvidence -&gt; TcEvDest
</span><a href="GHC.Tc.Types.Constraint.html#ctev_dest"><span class="hs-identifier hs-var">ctev_dest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008961"><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008961"><span class="hs-identifier hs-var">dest</span></a></span></span><span>
</span><span id="line-3276"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctev_rewriters :: CtEvidence -&gt; RewriterSet
</span><a href="GHC.Tc.Types.Constraint.html#ctev_rewriters"><span class="hs-identifier hs-var">ctev_rewriters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682008962"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008962"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span><span>
</span><span id="line-3277"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008963"><span class="annot"><span class="annottext">rewriters' :: RewriterSet
</span><a href="#local-6989586621682008963"><span class="hs-identifier hs-var hs-var">rewriters'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008962"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; RewriterSet -&gt; RewriterSet
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%3E/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">S.&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008948"><span class="hs-identifier hs-var">new_rewriters</span></a></span><span>
</span><span id="line-3278"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682008964"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008964"><span class="hs-identifier hs-var">new_ev</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682008965"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008965"><span class="hs-identifier hs-var">hole_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc
-&gt; RewriterSet
-&gt; Role
-&gt; Type
-&gt; Type
-&gt; TcS (CtEvidence, TcCoercion)
</span><a href="GHC.Tc.Solver.Monad.html#newWantedEq"><span class="hs-identifier hs-var">newWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008960"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008963"><span class="hs-identifier hs-var">rewriters'</span></a></span><span>
</span><span id="line-3279"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Role
</span><a href="GHC.Tc.Types.Constraint.html#ctEvRole"><span class="hs-identifier hs-var">ctEvRole</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008952"><span class="hs-identifier hs-var">nlhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008954"><span class="hs-identifier hs-var">nrhs</span></a></span><span>
</span><span id="line-3280"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682008966"><span class="annot"><span class="annottext">co :: TcCoercion
</span><a href="#local-6989586621682008966"><span class="hs-identifier hs-var hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SwapFlag -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Tc.Types.Evidence.html#maybeSymCo"><span class="hs-identifier hs-var">maybeSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">SwapFlag
</span><a href="#local-6989586621682008950"><span class="hs-identifier hs-var">swapped</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercion -&gt; TcCoercion) -&gt; TcCoercion -&gt; TcCoercion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3281"></span><span>                  </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008951"><span class="hs-identifier hs-var">lhs_co</span></a></span><span>
</span><span id="line-3282"></span><span>                  </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008965"><span class="hs-identifier hs-var">hole_co</span></a></span><span>
</span><span id="line-3283"></span><span>                  </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008953"><span class="hs-identifier hs-var">rhs_co</span></a></span><span>
</span><span id="line-3284"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TcEvDest -&gt; TcCoercion -&gt; TcS ()
TcEvDest -&gt; TcCoercion -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#setWantedEq"><span class="hs-identifier hs-var">setWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvDest
</span><a href="#local-6989586621682008961"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008966"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-3285"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcS ()
</span><a href="GHC.Tc.Solver.Monad.html#traceTcS"><span class="hs-identifier hs-var">traceTcS</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rewriteEqEvidence&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span><span>
</span><span id="line-3286"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008952"><span class="hs-identifier hs-var">nlhs</span></a></span><span>
</span><span id="line-3287"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008954"><span class="hs-identifier hs-var">nrhs</span></a></span><span>
</span><span id="line-3288"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008966"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-3289"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008948"><span class="hs-identifier hs-var">new_rewriters</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3290"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; TcS CtEvidence
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008964"><span class="hs-identifier hs-var">new_ev</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt;= 810
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>
</span><span id="line-3294"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">panic</span><span> </span><span class="hs-string">&quot;rewriteEvidence&quot;</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3297"></span><span>    </span><span id="local-6989586621682008955"><span class="annot"><span class="annottext">new_pred :: Type
</span><a href="#local-6989586621682008955"><span class="hs-identifier hs-var hs-var">new_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Types.Constraint.html#mkTcEqPredLikeEv"><span class="hs-identifier hs-var">mkTcEqPredLikeEv</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008952"><span class="hs-identifier hs-var">nlhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008954"><span class="hs-identifier hs-var">nrhs</span></a></span><span>
</span><span id="line-3298"></span><span>    </span><span id="local-6989586621682008960"><span class="annot"><span class="annottext">loc :: CtLoc
</span><a href="#local-6989586621682008960"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621682008949"><span class="hs-identifier hs-var">old_ev</span></a></span><span>
</span><span id="line-3299"></span><span>
</span><span id="line-3300"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Unification
*                                                                      *
************************************************************************

Note [unifyWanted]
~~~~~~~~~~~~~~~~~~
When decomposing equalities we often create new wanted constraints for
(s ~ t).  But what if s=t?  Then it'd be faster to return Refl right away.

Rather than making an equality test (which traverses the structure of the
type, perhaps fruitlessly), unifyWanted traverses the common structure, and
bales out when it finds a difference by creating a new Wanted constraint.
But where it succeeds in finding common structure, it just builds a coercion
to reflect it.
-}</span><span>
</span><span id="line-3318"></span><span>
</span><span id="line-3319"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-type">unifyWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span>
</span><span id="line-3320"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-3321"></span><span class="hs-comment">-- Return coercion witnessing the equality of the two types,</span><span>
</span><span id="line-3322"></span><span class="hs-comment">-- emitting new work equalities where necessary to achieve that</span><span>
</span><span id="line-3323"></span><span class="hs-comment">-- Very good short-cut when the two types are equal, or nearly so</span><span>
</span><span id="line-3324"></span><span class="hs-comment">-- See Note [unifyWanted]</span><span>
</span><span id="line-3325"></span><span class="hs-comment">-- The returned coercion's role matches the input parameter</span><span>
</span><span id="line-3326"></span><span id="unifyWanted"><span class="annot"><span class="annottext">unifyWanted :: RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var hs-var">unifyWanted</span></a></span></span><span> </span><span id="local-6989586621682008967"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008967"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682008968"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008968"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span id="local-6989586621682008969"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008969"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008970"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008970"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-3327"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008971"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008971"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008967"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008968"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008969"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008970"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3328"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcS TcCoercion
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion -&gt; Type -&gt; Type -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008971"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008969"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008970"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3329"></span><span>
</span><span id="line-3330"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span id="local-6989586621682008973"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008973"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682008974"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008974"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621682008975"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621682008976"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008976"><span class="hs-identifier hs-var">orig_ty1</span></a></span></span><span> </span><span id="local-6989586621682008977"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008977"><span class="hs-identifier hs-var">orig_ty2</span></a></span></span><span>
</span><span id="line-3331"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008976"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008977"><span class="hs-identifier hs-var">orig_ty2</span></a></span><span>
</span><span id="line-3332"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3333"></span><span>    </span><span id="local-6989586621682008978"><span class="annot"><span class="annottext">go :: Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682008978"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621682008979"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008979"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008980"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008980"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008981"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008981"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008979"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008981"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008980"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-3334"></span><span>    </span><span class="annot"><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682008982"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008982"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682008983"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008983"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682008984"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008984"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008983"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008982"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008984"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-3335"></span><span>
</span><span id="line-3336"></span><span>    </span><span class="annot"><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span id="local-6989586621682008985"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008985"><span class="hs-identifier hs-var">af1</span></a></span></span><span> </span><span id="local-6989586621682008986"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008986"><span class="hs-identifier hs-var">w1</span></a></span></span><span> </span><span id="local-6989586621682008987"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008987"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621682008988"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008988"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span id="local-6989586621682008989"><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008989"><span class="hs-identifier hs-var">af2</span></a></span></span><span> </span><span id="local-6989586621682008990"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008990"><span class="hs-identifier hs-var">w2</span></a></span></span><span> </span><span id="local-6989586621682008991"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008991"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span id="local-6989586621682008992"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008992"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3337"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008985"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag -&gt; FunTyFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008989"><span class="hs-identifier hs-var">af2</span></a></span><span>    </span><span class="hs-comment">-- Important!  See #21530</span><span>
</span><span id="line-3338"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682008993"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008993"><span class="hs-identifier hs-var">co_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008973"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008974"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008987"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008991"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-3339"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008994"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008994"><span class="hs-identifier hs-var">co_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008973"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008974"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008988"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008992"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-3340"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682008995"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008995"><span class="hs-identifier hs-var">co_w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008973"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008974"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="Language.Haskell.Syntax.Basic.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008986"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008990"><span class="hs-identifier hs-var">w2</span></a></span><span>
</span><span id="line-3341"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcS TcCoercion
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
-&gt; FunTyFlag
-&gt; TcCoercion
-&gt; TcCoercion
-&gt; TcCoercion
-&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkNakedFunCo1"><span class="hs-identifier hs-var">mkNakedFunCo1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">FunTyFlag
</span><a href="#local-6989586621682008985"><span class="hs-identifier hs-var">af1</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008995"><span class="hs-identifier hs-var">co_w</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008993"><span class="hs-identifier hs-var">co_s</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682008994"><span class="hs-identifier hs-var">co_t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3342"></span><span>
</span><span id="line-3343"></span><span>    </span><span class="annot"><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682008996"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008996"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621682008997"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008997"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621682008998"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008998"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621682008999"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008999"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3344"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008996"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008998"><span class="hs-identifier hs-var">tc2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008997"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008999"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-3345"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isInjectiveTyCon"><span class="hs-identifier hs-var">isInjectiveTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008996"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="hs-comment">-- don't look under newtypes at Rep equality</span><span>
</span><span id="line-3346"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682009000"><span class="annot"><span class="annottext">[TcCoercion]
</span><a href="#local-6989586621682009000"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion)
-&gt; [Role] -&gt; [Type] -&gt; [Type] -&gt; TcS [TcCoercion]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008973"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008974"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3347"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRoleListX"><span class="hs-identifier hs-var">tyConRoleListX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008996"><span class="hs-identifier hs-var">tc1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008997"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682008999"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-3348"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcS TcCoercion
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Role -&gt; TyCon -&gt; [TcCoercion] -&gt; TcCoercion
Role -&gt; TyCon -&gt; [TcCoercion] -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682008996"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">[TcCoercion]
</span><a href="#local-6989586621682009000"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3349"></span><span>
</span><span id="line-3350"></span><span>    </span><span class="annot"><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682009002"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682009002"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682009003"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682009003"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682009004"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009004"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-3351"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682009005"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682009005"><span class="hs-identifier hs-var">mb_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcS (Maybe Type)
</span><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var">isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682009003"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-3352"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682009005"><span class="hs-identifier hs-var">mb_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3353"></span><span>                </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682009007"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009007"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009007"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009004"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-3354"></span><span>                </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682009008"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009002"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009004"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-3355"></span><span>    </span><span class="annot"><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682009009"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009009"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682009010"><span class="annot"><span class="annottext">ty2 :: Type
</span><a href="#local-6989586621682009010"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621682009011"><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682009011"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3356"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682009012"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682009012"><span class="hs-identifier hs-var">mb_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; TcS (Maybe Type)
</span><a href="GHC.Tc.Solver.Monad.html#isFilledMetaTyVar_maybe"><span class="hs-identifier hs-var">isFilledMetaTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621682009011"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-3357"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621682009012"><span class="hs-identifier hs-var">mb_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3358"></span><span>                </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682009013"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009013"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009009"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009013"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-3359"></span><span>                </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682009008"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009009"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009010"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3360"></span><span>
</span><span id="line-3361"></span><span>    </span><span class="annot"><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682009014"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621682009014"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3362"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcS TcCoercion
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009014"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- we just don't care about coercions!</span><span>
</span><span id="line-3363"></span><span>
</span><span id="line-3364"></span><span>    </span><span class="annot"><a href="#local-6989586621682008978"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621682009016"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009016"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682009017"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009017"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682009008"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009016"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009017"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-3365"></span><span>
</span><span id="line-3366"></span><span>    </span><span id="local-6989586621682009008"><span class="annot"><span class="annottext">bale_out :: Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="#local-6989586621682009008"><span class="hs-identifier hs-var hs-var">bale_out</span></a></span></span><span> </span><span id="local-6989586621682009018"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009018"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682009019"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009019"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-3367"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009018"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; Type -&gt; Bool
Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.TyCo.Compare.html#tcEqType"><span class="hs-operator hs-var">`tcEqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009019"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercion -&gt; TcS TcCoercion
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; TcCoercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009018"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3368"></span><span>        </span><span class="hs-comment">-- Check for equality; e.g. a ~ a, or (m a) ~ (m a)</span><span>
</span><span id="line-3369"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RewriterSet -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Monad.html#emitNewWantedEq"><span class="hs-identifier hs-var">emitNewWantedEq</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682008974"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682008973"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682008975"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008976"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682008977"><span class="hs-identifier hs-var">orig_ty2</span></a></span><span>
</span><span id="line-3370"></span><span>
</span><span id="line-3371"></span><span>
</span><span id="line-3372"></span><span class="hs-comment">{-
Note [Decomposing Dependent TyCons and Processing Wanted Equalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we decompose a dependent tycon we obtain a list of
mixed wanted type and kind equalities. Ideally we want
all the kind equalities to get solved first so that we avoid
generating duplicate kind equalities

For example, consider decomposing a TyCon equality

    (0) [W] T k_fresh (t1::k_fresh) ~ T k1 (t2::k_fresh)

This gives rise to 2 equalities in the solver worklist

    (1) [W] k_fresh ~ k1
    (2) [W] t1::k_fresh ~ t2::k1

The solver worklist is processed in LIFO order:
see GHC.Tc.Solver.InertSet.selectWorkItem.
i.e. (2) is processed _before_ (1). Now, while solving (2)
we would call `canEqCanLHSHetero` and that would emit a
wanted kind equality

    (3) [W] k_fresh ~ k1

But (3) is exactly the same as (1)!

To avoid such duplicate wanted constraints from being added to the worklist,
we ensure that (2) is processed before (1). Since we are processing
the worklist in a LIFO ordering, we do it by emitting (1) before (2).
This is exactly what we do in `unifyWanteds`.

NB: This ordering is not needed when we decompose FunTyCons as they are not dependently typed
-}</span><span>
</span><span id="line-3406"></span><span>
</span><span id="line-3407"></span><span class="hs-comment">-- NB: Length of [CtLoc] and [Roles] may be infinite</span><span>
</span><span id="line-3408"></span><span class="hs-comment">-- but list of RHS [TcType] and LHS [TcType] is finite and both are of equal length</span><span>
</span><span id="line-3409"></span><span class="annot"><a href="GHC.Tc.Solver.Canonical.html#unifyWanteds"><span class="hs-identifier hs-type">unifyWanteds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#RewriterSet"><span class="hs-identifier hs-type">RewriterSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Basic.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3410"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- List of RHS types</span><span>
</span><span id="line-3411"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- List of LHS types</span><span>
</span><span id="line-3412"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.Monad.html#TcS"><span class="hs-identifier hs-type">TcS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3413"></span><span id="unifyWanteds"><span class="annot"><span class="annottext">unifyWanteds :: RewriterSet
-&gt; [CtLoc] -&gt; [Role] -&gt; [Type] -&gt; [Type] -&gt; TcS [TcCoercion]
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanteds"><span class="hs-identifier hs-var hs-var">unifyWanteds</span></a></span></span><span> </span><span id="local-6989586621682009021"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682009021"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span id="local-6989586621682009022"><span class="annot"><span class="annottext">[CtLoc]
</span><a href="#local-6989586621682009022"><span class="hs-identifier hs-var">ctlocs</span></a></span></span><span> </span><span id="local-6989586621682009023"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682009023"><span class="hs-identifier hs-var">roles</span></a></span></span><span> </span><span id="local-6989586621682009024"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682009024"><span class="hs-identifier hs-var">rhss</span></a></span></span><span> </span><span id="local-6989586621682009025"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682009025"><span class="hs-identifier hs-var">lhss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; [(CtLoc, Role, Type, Type)] -&gt; TcS [TcCoercion]
</span><a href="#local-6989586621682009026"><span class="hs-identifier hs-var">unify_wanteds</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682009021"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">([(CtLoc, Role, Type, Type)] -&gt; TcS [TcCoercion])
-&gt; [(CtLoc, Role, Type, Type)] -&gt; TcS [TcCoercion]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CtLoc]
-&gt; [Role] -&gt; [Type] -&gt; [Type] -&gt; [(CtLoc, Role, Type, Type)]
forall a b c d. [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [(a, b, c, d)]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#zip4/Data.OldList.html#zip4"><span class="hs-identifier hs-var">zip4</span></a></span><span> </span><span class="annot"><span class="annottext">[CtLoc]
</span><a href="#local-6989586621682009022"><span class="hs-identifier hs-var">ctlocs</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621682009023"><span class="hs-identifier hs-var">roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682009024"><span class="hs-identifier hs-var">rhss</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682009025"><span class="hs-identifier hs-var">lhss</span></a></span><span>
</span><span id="line-3414"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3415"></span><span>    </span><span class="hs-comment">-- Order is important here</span><span>
</span><span id="line-3416"></span><span>    </span><span class="hs-comment">-- See Note [Decomposing Dependent TyCons and Processing Wanted Equalities]</span><span>
</span><span id="line-3417"></span><span>    </span><span id="local-6989586621682009026"><span class="annot"><span class="annottext">unify_wanteds :: RewriterSet -&gt; [(CtLoc, Role, Type, Type)] -&gt; TcS [TcCoercion]
</span><a href="#local-6989586621682009026"><span class="hs-identifier hs-var hs-var">unify_wanteds</span></a></span></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcCoercion] -&gt; TcS [TcCoercion]
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3418"></span><span>    </span><span class="annot"><a href="#local-6989586621682009026"><span class="hs-identifier hs-var">unify_wanteds</span></a></span><span> </span><span id="local-6989586621682009031"><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682009031"><span class="hs-identifier hs-var">rewriters</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682009032"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682009032"><span class="hs-identifier hs-var">new_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682009033"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682009033"><span class="hs-identifier hs-var">tc_role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682009034"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009034"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682009035"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009035"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621682009036"><span class="annot"><span class="annottext">[(CtLoc, Role, Type, Type)]
</span><a href="#local-6989586621682009036"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3419"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682009037"><span class="annot"><span class="annottext">[TcCoercion]
</span><a href="#local-6989586621682009037"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; [(CtLoc, Role, Type, Type)] -&gt; TcS [TcCoercion]
</span><a href="#local-6989586621682009026"><span class="hs-identifier hs-var">unify_wanteds</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682009031"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">[(CtLoc, Role, Type, Type)]
</span><a href="#local-6989586621682009036"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-3420"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682009038"><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682009038"><span class="hs-identifier hs-var">co</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RewriterSet -&gt; CtLoc -&gt; Role -&gt; Type -&gt; Type -&gt; TcS TcCoercion
</span><a href="GHC.Tc.Solver.Canonical.html#unifyWanted"><span class="hs-identifier hs-var">unifyWanted</span></a></span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><a href="#local-6989586621682009031"><span class="hs-identifier hs-var">rewriters</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621682009032"><span class="hs-identifier hs-var">new_loc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621682009033"><span class="hs-identifier hs-var">tc_role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009034"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682009035"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-3421"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TcCoercion] -&gt; TcS [TcCoercion]
forall a. a -&gt; TcS a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercion
</span><a href="#local-6989586621682009038"><span class="hs-identifier hs-var">co</span></a></span><span class="annot"><span class="annottext">TcCoercion -&gt; [TcCoercion] -&gt; [TcCoercion]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[TcCoercion]
</span><a href="#local-6989586621682009037"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3422"></span></pre></body></html>