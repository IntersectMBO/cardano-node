<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>  </span><span class="hs-comment">-- instance MonadThings is necessarily an orphan</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Monadery used in desugaring
-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.HsToCore.Monad</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier">DsM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier">mapM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#mapAndUnzipM/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier">mapAndUnzipM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initDs"><span class="hs-identifier">initDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier">initDsTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier">initTcDsForSolver</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsWithModGuts"><span class="hs-identifier">initDsWithModGuts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#fixDs"><span class="hs-identifier">fixDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldlM/Data.Foldable.html#foldlM"><span class="hs-identifier">foldlM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldrM/Data.Foldable.html#foldrM"><span class="hs-identifier">foldrM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier">whenGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier">unsetGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier">unsetWOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier">xoptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Applicative/GHC.Base.html#Applicative"><span class="hs-identifier">Applicative</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator">(&lt;$&gt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#duplicateLocalDs"><span class="hs-identifier">duplicateLocalDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier">newSysLocalDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier">newSysLocalsDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newUniqueId"><span class="hs-identifier">newUniqueId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newFailLocalDs"><span class="hs-identifier">newFailLocalDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newPredVarDs"><span class="hs-identifier">newPredVarDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier">getSrcSpanDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier">putSrcSpanDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDsA"><span class="hs-identifier">putSrcSpanDsA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkNamePprCtxDs"><span class="hs-identifier">mkNamePprCtxDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier">newUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier">UniqSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier">newUniqueSupply</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getGhcModeDs"><span class="hs-identifier">getGhcModeDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier">dsGetFamInstEnvs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier">dsLookupGlobal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier">dsLookupGlobalId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier">dsLookupTyCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier">dsLookupDataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupConLike"><span class="hs-identifier">dsLookupConLike</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getCCIndexDsM"><span class="hs-identifier">getCCIndexDsM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaEnv"><span class="hs-identifier">DsMetaEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaVal"><span class="hs-identifier">DsMetaVal</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetMetaEnv"><span class="hs-identifier">dsGetMetaEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupMetaEnv"><span class="hs-identifier">dsLookupMetaEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsExtendMetaEnv"><span class="hs-identifier">dsExtendMetaEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>        </span><span class="hs-comment">-- Getting and setting pattern match oracle states</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#getPmNablas"><span class="hs-identifier">getPmNablas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#updPmNablas"><span class="hs-identifier">updPmNablas</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>        </span><span class="hs-comment">-- Get COMPLETE sets of a TyCon</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier">dsGetCompleteMatches</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>        </span><span class="hs-comment">-- Warnings and errors</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWarning"><span class="hs-identifier">DsWarning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier">diagnosticDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#errDsCoreExpr"><span class="hs-identifier">errDsCoreExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#failWithDs"><span class="hs-identifier">failWithDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#failDs"><span class="hs-identifier">failDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#discardWarningsDs"><span class="hs-identifier">discardWarningsDs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>        </span><span class="hs-comment">-- Data types</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier">DsMatchContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier">EquationInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier">MatchResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier">runMatchResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWrapper"><span class="hs-identifier">DsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#idDsWrapper"><span class="hs-identifier">idDsWrapper</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-comment">-- Trace injection</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Monad.html#pprRuntimeTrace"><span class="hs-identifier">pprRuntimeTrace</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ppr.html"><span class="hs-identifier">GHC.Driver.Ppr</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Diagnostic.html"><span class="hs-identifier">GHC.Driver.Config.Diagnostic</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html"><span class="hs-identifier">GHC.HsToCore.Types</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html"><span class="hs-identifier">GHC.HsToCore.Errors.Types</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Solver.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier">Nablas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#initNablas"><span class="hs-identifier">initNablas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#unitExpr"><span class="hs-identifier">unitExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier">exprType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.External.html"><span class="hs-identifier">GHC.Unit.External</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html"><span class="hs-identifier">GHC.Unit.Module.ModGuts</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier">Origin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html"><span class="hs-identifier">GHC.Types.TypeEnv</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Ppr.html"><span class="hs-identifier">GHC.Types.Name.Ppr</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html#mkLitString"><span class="hs-identifier">mkLitString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html"><span class="hs-identifier">GHC.Types.CostCentre.State</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html"><span class="hs-identifier">GHC.Types.TyThing</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Strict.html"><span class="hs-identifier">GHC.Data.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Strict</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.IORef.html#/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html"><span class="hs-identifier">GHC.Driver.Env.KnotVars</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Data types for the desugarer
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-keyword">data</span><span> </span><span id="DsMatchContext"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a></span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DsMatchContext"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-var">DsMatchContext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>  </span><span id="local-6989586621682073679"><span class="annot"><span class="annottext">ppr :: DsMatchContext -&gt; SDoc
</span><a href="#local-6989586621682073679"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsMatchContext"><span class="hs-identifier hs-type">DsMatchContext</span></a></span><span> </span><span id="local-6989586621682073681"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621682073681"><span class="hs-identifier hs-var">hs_match</span></a></span></span><span> </span><span id="local-6989586621682073682"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682073682"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682073682"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn -&gt; SDoc
forall p.
(Outputable (IdP (NoGhcTc p)), UnXRec (NoGhcTc p)) =&gt;
HsMatchContext p -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprMatchContext"><span class="hs-identifier hs-var">pprMatchContext</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621682073681"><span class="hs-identifier hs-var">hs_match</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-keyword">data</span><span> </span><span id="EquationInfo"><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-var">EquationInfo</span></a></span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="EqnInfo"><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnInfo"><span class="hs-identifier hs-var">EqnInfo</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="eqn_pats"><span class="annot"><span class="annottext">EquationInfo -&gt; [Pat GhcTc]
</span><a href="GHC.HsToCore.Monad.html#eqn_pats"><span class="hs-identifier hs-var hs-var">eqn_pats</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>              </span><span class="hs-comment">-- ^ The patterns for an equation</span><span>
</span><span id="line-131"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span>              </span><span class="hs-comment">-- NB: We have /already/ applied 'decideBangHood' to</span><span>
</span><span id="line-133"></span><span>              </span><span class="hs-comment">-- these patterns.  See Note [decideBangHood] in &quot;GHC.HsToCore.Utils&quot;</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="eqn_orig"><span class="annot"><span class="annottext">EquationInfo -&gt; Origin
</span><a href="GHC.HsToCore.Monad.html#eqn_orig"><span class="hs-identifier hs-var hs-var">eqn_orig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span>
</span><span id="line-136"></span><span>              </span><span class="hs-comment">-- ^ Was this equation present in the user source?</span><span>
</span><span id="line-137"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-138"></span><span>              </span><span class="hs-comment">-- This helps us avoid warnings on patterns that GHC elaborated.</span><span>
</span><span id="line-139"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-140"></span><span>              </span><span class="hs-comment">-- For instance, the pattern @-1 :: Word@ gets desugared into</span><span>
</span><span id="line-141"></span><span>              </span><span class="hs-comment">-- @W# -1## :: Word@, but we shouldn't warn about an overflowed</span><span>
</span><span id="line-142"></span><span>              </span><span class="hs-comment">-- literal for /both/ of these cases.</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="eqn_rhs"><span class="annot"><span class="annottext">EquationInfo -&gt; MatchResult CoreExpr
</span><a href="GHC.HsToCore.Monad.html#eqn_rhs"><span class="hs-identifier hs-var hs-var">eqn_rhs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-145"></span><span>              </span><span class="annot"><span class="hs-comment">-- ^ What to do after match</span></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621682073713"><span class="annot"><span class="annottext">ppr :: EquationInfo -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Monad.html#EqnInfo"><span class="hs-identifier hs-type">EqnInfo</span></a></span><span> </span><span id="local-6989586621682073714"><span class="annot"><span class="annottext">[Pat GhcTc]
</span><a href="#local-6989586621682073714"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="annot"><span class="annottext">Origin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MatchResult CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat GhcTc] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Pat GhcTc]
</span><a href="#local-6989586621682073714"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-keyword">type</span><span> </span><span id="DsWrapper"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWrapper"><span class="hs-identifier hs-var">DsWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-152"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#idDsWrapper"><span class="hs-identifier hs-type">idDsWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWrapper"><span class="hs-identifier hs-type">DsWrapper</span></a></span><span>
</span><span id="line-153"></span><span id="idDsWrapper"><span class="annot"><span class="annottext">idDsWrapper :: DsWrapper
</span><a href="GHC.HsToCore.Monad.html#idDsWrapper"><span class="hs-identifier hs-var hs-var">idDsWrapper</span></a></span></span><span> </span><span id="local-6989586621682073715"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682073715"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682073715"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- The semantics of (match vs (EqnInfo wrap pats rhs)) is the MatchResult CoreExpr</span><span>
</span><span id="line-156"></span><span class="hs-comment">--      \fail. wrap (case vs of { pats -&gt; rhs fail })</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- where vs are not bound by wrap</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | This is a value of type a with potentially a CoreExpr-shaped hole in it.</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- This is used to deal with cases where we are potentially handling pattern</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- match failure, and want to later specify how failure is handled.</span><span>
</span><span id="line-162"></span><span class="hs-keyword">data</span><span> </span><span id="MatchResult"><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-var">MatchResult</span></a></span></span><span> </span><span id="local-6989586621682073350"><span class="annot"><a href="#local-6989586621682073350"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-comment">-- | We represent the case where there is no hole without a function from</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-comment">-- 'CoreExpr', like this, because sometimes we have nothing to put in the</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-comment">-- hole and so want to be sure there is in fact no hole.</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MR_Infallible"><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073350"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MR_Fallible"><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073350"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073719"><span id="local-6989586621682073723"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b)
-&gt; (forall a b. a -&gt; MatchResult b -&gt; MatchResult a)
-&gt; Functor MatchResult
forall a b. a -&gt; MatchResult b -&gt; MatchResult a
forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
fmap :: forall a b. (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
$c&lt;$ :: forall a b. a -&gt; MatchResult b -&gt; MatchResult a
&lt;$ :: forall a b. a -&gt; MatchResult b -&gt; MatchResult a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#Functor/GHC.Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">-- | Product is an &quot;or&quot; on fallibility---the combined match result is infallible</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- only if the left and right argument match results both were.</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- This is useful for combining a bunch of alternatives together and then</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- getting the overall fallibility of the entire group. See 'mkDataConCase' for</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- an example.</span><span>
</span><span id="line-176"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682073733"><span id="local-6989586621682073737"><span id="local-6989586621682073740"><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Applicative/GHC.Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621682073745"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; MatchResult a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></a></span></span><span> </span><span id="local-6989586621682073746"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073746"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM a -&gt; MatchResult a
forall a. DsM a -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; DsM a
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073746"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621682073749"><span class="annot"><span class="annottext">DsM (a -&gt; b)
</span><a href="#local-6989586621682073749"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682073750"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. MatchResult (a -&gt; b) -&gt; MatchResult a -&gt; MatchResult b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;*&gt;</span></a></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621682073751"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073751"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM b -&gt; MatchResult b
forall a. DsM a -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-var">MR_Infallible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsM (a -&gt; b)
</span><a href="#local-6989586621682073749"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DsM (a -&gt; b) -&gt; DsM a -&gt; DsM b
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) (a -&gt; b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073751"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>  </span><span id="local-6989586621682073752"><span class="annot"><span class="annottext">MatchResult (a -&gt; b)
</span><a href="#local-6989586621682073752"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span id="local-6989586621682073753"><span class="annot"><span class="annottext">MatchResult a
</span><a href="#local-6989586621682073753"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM b) -&gt; MatchResult b
forall a. (CoreExpr -&gt; DsM a) -&gt; MatchResult a
</span><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-var">MR_Fallible</span></a></span><span> </span><span class="annot"><span class="annottext">((CoreExpr -&gt; DsM b) -&gt; MatchResult b)
-&gt; (CoreExpr -&gt; DsM b) -&gt; MatchResult b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682073754"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682073754"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult (a -&gt; b) -&gt; DsM (a -&gt; b)
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682073754"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult (a -&gt; b)
</span><a href="#local-6989586621682073752"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">DsM (a -&gt; b) -&gt; DsM a -&gt; DsM b
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) (a -&gt; b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; MatchResult a -&gt; DsM a
forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var">runMatchResult</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682073754"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">MatchResult a
</span><a href="#local-6989586621682073753"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- Given a fail expression to use, and a MatchResult CoreExpr, compute the filled CoreExpr whether</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- the MatchResult CoreExpr was failable or not.</span><span>
</span><span id="line-183"></span><span id="local-6989586621682073356"><span class="annot"><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-type">runMatchResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073356"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073356"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-184"></span><span id="runMatchResult"><span class="annot"><span class="annottext">runMatchResult :: forall a. CoreExpr -&gt; MatchResult a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#runMatchResult"><span class="hs-identifier hs-var hs-var">runMatchResult</span></a></span></span><span> </span><span id="local-6989586621682073755"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682073755"><span class="hs-identifier hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Infallible"><span class="hs-identifier hs-type">MR_Infallible</span></a></span><span> </span><span id="local-6989586621682073756"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073756"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073756"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Monad.html#MR_Fallible"><span class="hs-identifier hs-type">MR_Fallible</span></a></span><span> </span><span id="local-6989586621682073757"><span class="annot"><span class="annottext">CoreExpr -&gt; DsM a
</span><a href="#local-6989586621682073757"><span class="hs-identifier hs-var">body_fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM a
</span><a href="#local-6989586621682073757"><span class="hs-identifier hs-var">body_fn</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682073755"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Monad functions
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- Compatibility functions</span><span>
</span><span id="line-197"></span><span id="local-6989586621682073358"><span class="annot"><a href="GHC.HsToCore.Monad.html#fixDs"><span class="hs-identifier hs-type">fixDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682073358"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073358"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073358"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-198"></span><span id="fixDs"><span class="annot"><span class="annottext">fixDs :: forall a. (a -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#fixDs"><span class="hs-identifier hs-var hs-var">fixDs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall a env. (a -&gt; IOEnv env a) -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">type</span><span> </span><span id="DsWarning"><span class="annot"><a href="GHC.HsToCore.Monad.html#DsWarning"><span class="hs-identifier hs-var">DsWarning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-comment">-- Not quite the same as a WarnMsg, we have an SDoc here</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-comment">-- and we'll do the name_ppr_ctx stuff later on to turn it</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-comment">-- into a Doc.</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><span class="hs-comment">-- | Run a 'DsM' action inside the 'TcM' monad.</span></span><span>
</span><span id="line-206"></span><span id="local-6989586621682073362"><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier hs-type">initDsTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073362"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073362"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-207"></span><span id="initDsTc"><span class="annot"><span class="annottext">initDsTc :: forall a. DsM a -&gt; TcM (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier hs-var hs-var">initDsTc</span></a></span></span><span> </span><span id="local-6989586621682073770"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073770"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073771"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073771"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-209"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073773"><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073773"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef (Messages DsMessage))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef (Messages DsMessage))
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef (Messages DsMessage))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef (Messages DsMessage)))
-&gt; IO (IORef (Messages DsMessage))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef (Messages DsMessage))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage -&gt; IO (IORef (Messages DsMessage))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-210"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073777"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073777"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-211"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073779"><span class="annot"><span class="annottext">(DsGblEnv, DsLclEnv)
</span><a href="#local-6989586621682073779"><span class="hs-identifier hs-var">envs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; IORef (Messages DsMessage)
-&gt; TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (DsGblEnv, DsLclEnv)
forall (m :: * -&gt; *).
MonadIO m =&gt;
HscEnv
-&gt; IORef (Messages DsMessage) -&gt; TcGblEnv -&gt; m (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-var">mkDsEnvsFromTcGbl</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073777"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073773"><span class="hs-identifier hs-var">msg_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073771"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-212"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073781"><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621682073781"><span class="hs-identifier hs-var">e_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure a)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) a
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure a))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- need to tryM so that we don't discard</span><span>
</span><span id="line-213"></span><span>                             </span><span class="hs-comment">-- DsMessages</span><span>
</span><span id="line-214"></span><span>                     </span><span class="annot"><span class="annottext">(DsGblEnv, DsLclEnv) -&gt; DsM a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall gbl' lcl' a gbl lcl.
(gbl', lcl') -&gt; TcRnIf gbl' lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv, DsLclEnv)
</span><a href="#local-6989586621682073779"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073770"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-215"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073784"><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682073784"><span class="hs-identifier hs-var">msgs</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Messages DsMessage)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Messages DsMessage)
forall a. IO a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages DsMessage)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Messages DsMessage))
-&gt; IO (Messages DsMessage)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Messages DsMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage) -&gt; IO (Messages DsMessage)
forall a. IORef a -&gt; IO a
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#readIORef/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073773"><span class="hs-identifier hs-var">msg_var</span></a></span><span>
</span><span id="line-216"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Messages DsMessage, Maybe a) -&gt; TcM (Messages DsMessage, Maybe a)
forall a. a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682073784"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621682073781"><span class="hs-identifier hs-var">e_result</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-217"></span><span>                                        </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682073786"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073786"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073786"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><span class="hs-comment">-- | Run a 'DsM' action inside the 'IO' monad.</span></span><span>
</span><span id="line-221"></span><span id="local-6989586621682073393"><span class="annot"><a href="GHC.HsToCore.Monad.html#initDs"><span class="hs-identifier hs-type">initDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073393"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073393"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-222"></span><span id="initDs"><span class="annot"><span class="annottext">initDs :: forall a.
HscEnv -&gt; TcGblEnv -&gt; DsM a -&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#initDs"><span class="hs-identifier hs-var hs-var">initDs</span></a></span></span><span> </span><span id="local-6989586621682073792"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073792"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682073793"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073793"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span id="local-6989586621682073794"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073794"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073795"><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073795"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages DsMessage -&gt; IO (IORef (Messages DsMessage))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-224"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073796"><span class="annot"><span class="annottext">(DsGblEnv, DsLclEnv)
</span><a href="#local-6989586621682073796"><span class="hs-identifier hs-var">envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; IORef (Messages DsMessage)
-&gt; TcGblEnv
-&gt; IO (DsGblEnv, DsLclEnv)
forall (m :: * -&gt; *).
MonadIO m =&gt;
HscEnv
-&gt; IORef (Messages DsMessage) -&gt; TcGblEnv -&gt; m (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-var">mkDsEnvsFromTcGbl</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073792"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073795"><span class="hs-identifier hs-var">msg_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073793"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; (DsGblEnv, DsLclEnv)
-&gt; DsM a
-&gt; IO (Messages DsMessage, Maybe a)
forall a.
HscEnv
-&gt; (DsGblEnv, DsLclEnv)
-&gt; DsM a
-&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-var">runDs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073792"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv, DsLclEnv)
</span><a href="#local-6989586621682073796"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073794"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-226"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><span class="hs-comment">-- | Build a set of desugarer environments derived from a 'TcGblEnv'.</span></span><span>
</span><span id="line-229"></span><span id="local-6989586621682073381"><span class="annot"><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-type">mkDsEnvsFromTcGbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#MonadIO/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073381"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-230"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IORef.html#IORef/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-231"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682073381"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-232"></span><span id="mkDsEnvsFromTcGbl"><span class="annot"><span class="annottext">mkDsEnvsFromTcGbl :: forall (m :: * -&gt; *).
MonadIO m =&gt;
HscEnv
-&gt; IORef (Messages DsMessage) -&gt; TcGblEnv -&gt; m (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvsFromTcGbl"><span class="hs-identifier hs-var hs-var">mkDsEnvsFromTcGbl</span></a></span></span><span> </span><span id="local-6989586621682073807"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073807"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682073808"><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073808"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span id="local-6989586621682073809"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073810"><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621682073810"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef CostCentreState) -&gt; m (IORef CostCentreState)
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef CostCentreState) -&gt; m (IORef CostCentreState))
-&gt; IO (IORef CostCentreState) -&gt; m (IORef CostCentreState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreState -&gt; IO (IORef CostCentreState)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreState
</span><a href="GHC.Types.CostCentre.State.html#newCostCentreState"><span class="hs-identifier hs-var">newCostCentreState</span></a></span><span>
</span><span id="line-234"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073812"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682073812"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ExternalPackageState -&gt; m ExternalPackageState
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ExternalPackageState -&gt; m ExternalPackageState)
-&gt; IO ExternalPackageState -&gt; m ExternalPackageState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ExternalPackageState
</span><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073807"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073814"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621682073814"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073807"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-236"></span><span>             </span><span id="local-6989586621682073816"><span class="annot"><span class="annottext">this_mod :: Module
</span><a href="#local-6989586621682073816"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-237"></span><span>             </span><span id="local-6989586621682073818"><span class="annot"><span class="annottext">type_env :: TypeEnv
</span><a href="#local-6989586621682073818"><span class="hs-identifier hs-var hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-238"></span><span>             </span><span id="local-6989586621682073820"><span class="annot"><span class="annottext">rdr_env :: GlobalRdrEnv
</span><a href="#local-6989586621682073820"><span class="hs-identifier hs-var hs-var">rdr_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-239"></span><span>             </span><span id="local-6989586621682073822"><span class="annot"><span class="annottext">fam_inst_env :: FamInstEnv
</span><a href="#local-6989586621682073822"><span class="hs-identifier hs-var hs-var">fam_inst_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; FamInstEnv
</span><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-240"></span><span>             </span><span id="local-6989586621682073824"><span class="annot"><span class="annottext">ptc :: PromotionTickContext
</span><a href="#local-6989586621682073824"><span class="hs-identifier hs-var hs-var">ptc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.Session.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073807"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>             </span><span id="local-6989586621682073827"><span class="annot"><span class="annottext">complete_matches :: [CompleteMatch]
</span><a href="#local-6989586621682073827"><span class="hs-identifier hs-var hs-var">complete_matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [CompleteMatch]
</span><a href="GHC.Driver.Env.html#hptCompleteSigs"><span class="hs-identifier hs-var">hptCompleteSigs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073807"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>         </span><span class="hs-comment">-- from the home package</span><span>
</span><span id="line-242"></span><span>                                </span><span class="annot"><span class="annottext">[CompleteMatch] -&gt; [CompleteMatch] -&gt; [CompleteMatch]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [CompleteMatch]
</span><a href="GHC.Tc.Types.html#tcg_complete_matches"><span class="hs-identifier hs-var">tcg_complete_matches</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-comment">-- from the current module</span><span>
</span><span id="line-243"></span><span>                                </span><span class="annot"><span class="annottext">[CompleteMatch] -&gt; [CompleteMatch] -&gt; [CompleteMatch]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; [CompleteMatch]
</span><a href="GHC.Unit.External.html#eps_complete_matches"><span class="hs-identifier hs-var">eps_complete_matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682073812"><span class="hs-identifier hs-var">eps</span></a></span><span>     </span><span class="hs-comment">-- from imports</span><span>
</span><span id="line-244"></span><span>             </span><span class="hs-comment">-- re-use existing next_wrapper_num to ensure uniqueness</span><span>
</span><span id="line-245"></span><span>             </span><span id="local-6989586621682073831"><span class="annot"><span class="annottext">next_wrapper_num_var :: TcRef (ModuleEnv Int)
</span><a href="#local-6989586621682073831"><span class="hs-identifier hs-var hs-var">next_wrapper_num_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (ModuleEnv Int)
</span><a href="GHC.Tc.Types.html#tcg_next_wrapper_num"><span class="hs-identifier hs-var">tcg_next_wrapper_num</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073809"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-246"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(DsGblEnv, DsLclEnv) -&gt; m (DsGblEnv, DsLclEnv)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">((DsGblEnv, DsLclEnv) -&gt; m (DsGblEnv, DsLclEnv))
-&gt; (DsGblEnv, DsLclEnv) -&gt; m (DsGblEnv, DsLclEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
-&gt; Module
-&gt; GlobalRdrEnv
-&gt; TypeEnv
-&gt; FamInstEnv
-&gt; PromotionTickContext
-&gt; IORef (Messages DsMessage)
-&gt; IORef CostCentreState
-&gt; TcRef (ModuleEnv Int)
-&gt; [CompleteMatch]
-&gt; (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-var">mkDsEnvs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682073814"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073816"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682073820"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621682073818"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621682073822"><span class="hs-identifier hs-var">fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621682073824"><span class="hs-identifier hs-var">ptc</span></a></span><span>
</span><span id="line-247"></span><span>                           </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073808"><span class="hs-identifier hs-var">msg_var</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621682073810"><span class="hs-identifier hs-var">cc_st_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621682073831"><span class="hs-identifier hs-var">next_wrapper_num_var</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621682073827"><span class="hs-identifier hs-var">complete_matches</span></a></span><span>
</span><span id="line-248"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span id="local-6989586621682073395"><span class="annot"><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-type">runDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073395"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073395"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-251"></span><span id="runDs"><span class="annot"><span class="annottext">runDs :: forall a.
HscEnv
-&gt; (DsGblEnv, DsLclEnv)
-&gt; DsM a
-&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-var hs-var">runDs</span></a></span></span><span> </span><span id="local-6989586621682073840"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073840"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073841"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682073841"><span class="hs-identifier hs-var">ds_gbl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073842"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073842"><span class="hs-identifier hs-var">ds_lcl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682073843"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073843"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073844"><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621682073844"><span class="hs-identifier hs-var">res</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char
-&gt; HscEnv
-&gt; DsGblEnv
-&gt; DsLclEnv
-&gt; TcRnIf DsGblEnv DsLclEnv (Either IOEnvFailure a)
-&gt; IO (Either IOEnvFailure a)
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'d'</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073840"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682073841"><span class="hs-identifier hs-var">ds_gbl</span></a></span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073842"><span class="hs-identifier hs-var">ds_lcl</span></a></span><span>
</span><span id="line-253"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsM a -&gt; TcRnIf DsGblEnv DsLclEnv (Either IOEnvFailure a)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073843"><span class="hs-identifier hs-var">thing_inside</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073846"><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682073846"><span class="hs-identifier hs-var">msgs</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage) -&gt; IO (Messages DsMessage)
forall a. IORef a -&gt; IO a
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#readIORef/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef (Messages DsMessage)
</span><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682073841"><span class="hs-identifier hs-var">ds_gbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073848"><span class="annot"><span class="annottext">final_res :: Maybe a
</span><a href="#local-6989586621682073848"><span class="hs-identifier hs-var hs-var">final_res</span></a></span></span><span>
</span><span id="line-256"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Messages DsMessage -&gt; Bool
forall e. Diagnostic e =&gt; Messages e -&gt; Bool
</span><a href="GHC.Types.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682073846"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-257"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682073850"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073850"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621682073844"><span class="hs-identifier hs-var">res</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073850"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-258"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initDs&quot;</span></span><span>
</span><span id="line-259"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Messages DsMessage, Maybe a) -&gt; IO (Messages DsMessage, Maybe a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682073846"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682073848"><span class="hs-identifier hs-var">final_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><span class="hs-comment">-- | Run a 'DsM' action in the context of an existing 'ModGuts'</span></span><span>
</span><span id="line-263"></span><span id="local-6989586621682073417"><span class="annot"><a href="GHC.HsToCore.Monad.html#initDsWithModGuts"><span class="hs-identifier hs-type">initDsWithModGuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073417"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073417"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-264"></span><span id="initDsWithModGuts"><span class="annot"><span class="annottext">initDsWithModGuts :: forall a.
HscEnv -&gt; ModGuts -&gt; DsM a -&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#initDsWithModGuts"><span class="hs-identifier hs-var hs-var">initDsWithModGuts</span></a></span></span><span> </span><span id="local-6989586621682073860"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073860"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_module :: ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073862"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073862"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_binds :: ModGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073864"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621682073864"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-265"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_tcs :: ModGuts -&gt; [TyCon]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_tcs"><span class="hs-identifier hs-var">mg_tcs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073866"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621682073866"><span class="hs-identifier hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_fam_insts :: ModGuts -&gt; [FamInst]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_fam_insts"><span class="hs-identifier hs-var">mg_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073868"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621682073868"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span>
</span><span id="line-266"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_patsyns :: ModGuts -&gt; [PatSyn]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_patsyns"><span class="hs-identifier hs-var">mg_patsyns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073870"><span class="annot"><span class="annottext">[PatSyn]
</span><a href="#local-6989586621682073870"><span class="hs-identifier hs-var">patsyns</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_rdr_env :: ModGuts -&gt; GlobalRdrEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rdr_env"><span class="hs-identifier hs-var">mg_rdr_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073872"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682073872"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span>
</span><span id="line-267"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_fam_inst_env :: ModGuts -&gt; FamInstEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_fam_inst_env"><span class="hs-identifier hs-var">mg_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073874"><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621682073874"><span class="hs-identifier hs-var">fam_inst_env</span></a></span></span><span>
</span><span id="line-268"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_complete_matches :: ModGuts -&gt; [CompleteMatch]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_complete_matches"><span class="hs-identifier hs-var">mg_complete_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073876"><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621682073876"><span class="hs-identifier hs-var">local_complete_matches</span></a></span></span><span>
</span><span id="line-269"></span><span>                          </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682073877"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073877"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073878"><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621682073878"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CostCentreState -&gt; IO (IORef CostCentreState)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreState
</span><a href="GHC.Types.CostCentre.State.html#newCostCentreState"><span class="hs-identifier hs-var">newCostCentreState</span></a></span><span>
</span><span id="line-271"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073879"><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621682073879"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleEnv Int -&gt; IO (TcRef (ModuleEnv Int))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleEnv Int
forall a. ModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#emptyModuleEnv"><span class="hs-identifier hs-var">emptyModuleEnv</span></a></span><span>
</span><span id="line-272"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073881"><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073881"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages DsMessage -&gt; IO (IORef (Messages DsMessage))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
forall e. Messages e
</span><a href="GHC.Types.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-273"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073882"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682073882"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ExternalPackageState -&gt; IO ExternalPackageState
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ExternalPackageState -&gt; IO ExternalPackageState)
-&gt; IO ExternalPackageState -&gt; IO ExternalPackageState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ExternalPackageState
</span><a href="GHC.Driver.Env.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073860"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-274"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073883"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621682073883"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073860"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-275"></span><span>             </span><span id="local-6989586621682073884"><span class="annot"><span class="annottext">type_env :: TypeEnv
</span><a href="#local-6989586621682073884"><span class="hs-identifier hs-var hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [TyCon] -&gt; [PatSyn] -&gt; [FamInst] -&gt; TypeEnv
</span><a href="GHC.Types.TypeEnv.html#typeEnvFromEntities"><span class="hs-identifier hs-var">typeEnvFromEntities</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682073886"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621682073866"><span class="hs-identifier hs-var">tycons</span></a></span><span> </span><span class="annot"><span class="annottext">[PatSyn]
</span><a href="#local-6989586621682073870"><span class="hs-identifier hs-var">patsyns</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621682073868"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-276"></span><span>             </span><span id="local-6989586621682073887"><span class="annot"><span class="annottext">ptc :: PromotionTickContext
</span><a href="#local-6989586621682073887"><span class="hs-identifier hs-var hs-var">ptc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.Session.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073860"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>             </span><span id="local-6989586621682073888"><span class="annot"><span class="annottext">complete_matches :: [CompleteMatch]
</span><a href="#local-6989586621682073888"><span class="hs-identifier hs-var hs-var">complete_matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [CompleteMatch]
</span><a href="GHC.Driver.Env.html#hptCompleteSigs"><span class="hs-identifier hs-var">hptCompleteSigs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073860"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>     </span><span class="hs-comment">-- from the home package</span><span>
</span><span id="line-278"></span><span>                                </span><span class="annot"><span class="annottext">[CompleteMatch] -&gt; [CompleteMatch] -&gt; [CompleteMatch]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621682073876"><span class="hs-identifier hs-var">local_complete_matches</span></a></span><span>  </span><span class="hs-comment">-- from the current module</span><span>
</span><span id="line-279"></span><span>                                </span><span class="annot"><span class="annottext">[CompleteMatch] -&gt; [CompleteMatch] -&gt; [CompleteMatch]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; [CompleteMatch]
</span><a href="GHC.Unit.External.html#eps_complete_matches"><span class="hs-identifier hs-var">eps_complete_matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682073882"><span class="hs-identifier hs-var">eps</span></a></span><span> </span><span class="hs-comment">-- from imports</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>             </span><span id="local-6989586621682073889"><span class="annot"><span class="annottext">bindsToIds :: Bind a -&gt; [a]
</span><a href="#local-6989586621682073889"><span class="hs-identifier hs-var hs-var">bindsToIds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621682073891"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073891"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073891"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>             </span><span class="annot"><a href="#local-6989586621682073889"><span class="hs-identifier hs-var">bindsToIds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span>    </span><span id="local-6989586621682073893"><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621682073893"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Expr a) -&gt; a) -&gt; [(a, Expr a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Expr a) -&gt; a
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Expr a)]
</span><a href="#local-6989586621682073893"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-283"></span><span>             </span><span id="local-6989586621682073886"><span class="annot"><span class="annottext">ids :: [Id]
</span><a href="#local-6989586621682073886"><span class="hs-identifier hs-var hs-var">ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bind Id -&gt; [Id]) -&gt; CoreProgram -&gt; [Id]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">Bind Id -&gt; [Id]
forall {a}. Bind a -&gt; [a]
</span><a href="#local-6989586621682073889"><span class="hs-identifier hs-var">bindsToIds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621682073864"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>             </span><span id="local-6989586621682073896"><span class="annot"><span class="annottext">envs :: (DsGblEnv, DsLclEnv)
</span><a href="#local-6989586621682073896"><span class="hs-identifier hs-var hs-var">envs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv
-&gt; Module
-&gt; GlobalRdrEnv
-&gt; TypeEnv
-&gt; FamInstEnv
-&gt; PromotionTickContext
-&gt; IORef (Messages DsMessage)
-&gt; IORef CostCentreState
-&gt; TcRef (ModuleEnv Int)
-&gt; [CompleteMatch]
-&gt; (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-var">mkDsEnvs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682073883"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073862"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682073872"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621682073884"><span class="hs-identifier hs-var">type_env</span></a></span><span>
</span><span id="line-286"></span><span>                              </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621682073874"><span class="hs-identifier hs-var">fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621682073887"><span class="hs-identifier hs-var">ptc</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073881"><span class="hs-identifier hs-var">msg_var</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621682073878"><span class="hs-identifier hs-var">cc_st_var</span></a></span><span>
</span><span id="line-287"></span><span>                              </span><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621682073879"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621682073888"><span class="hs-identifier hs-var">complete_matches</span></a></span><span>
</span><span id="line-288"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; (DsGblEnv, DsLclEnv)
-&gt; DsM a
-&gt; IO (Messages DsMessage, Maybe a)
forall a.
HscEnv
-&gt; (DsGblEnv, DsLclEnv)
-&gt; DsM a
-&gt; IO (Messages DsMessage, Maybe a)
</span><a href="GHC.HsToCore.Monad.html#runDs"><span class="hs-identifier hs-var">runDs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073860"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv, DsLclEnv)
</span><a href="#local-6989586621682073896"><span class="hs-identifier hs-var">envs</span></a></span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682073877"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-289"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span id="local-6989586621682073434"><span class="annot"><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier hs-type">initTcDsForSolver</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073434"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073434"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-292"></span><span class="hs-comment">-- Spin up a TcM context so that we can run the constraint solver</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- Returns any error messages generated by the constraint solver</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- and (Just res) if no error happened; Nothing if an error happened</span><span>
</span><span id="line-295"></span><span class="hs-comment">--</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- Simon says: I'm not very happy about this.  We spin up a complete TcM monad</span><span>
</span><span id="line-297"></span><span class="hs-comment">--             only to immediately refine it to a TcS monad.</span><span>
</span><span id="line-298"></span><span class="hs-comment">-- Better perhaps to make TcS into its own monad, rather than building on TcS</span><span>
</span><span id="line-299"></span><span class="hs-comment">-- But that may in turn interact with plugins</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="initTcDsForSolver"><span class="annot"><span class="annottext">initTcDsForSolver :: forall a. TcM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier hs-var hs-var">initTcDsForSolver</span></a></span></span><span> </span><span id="local-6989586621682073909"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682073909"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073910"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682073910"><span class="hs-identifier hs-var">gbl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073911"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073911"><span class="hs-identifier hs-var">lcl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv (DsGblEnv, DsLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span>
</span><span id="line-303"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682073913"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073913"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ds_mod :: DsGblEnv -&gt; Module
</span><a href="GHC.HsToCore.Types.html#ds_mod"><span class="hs-identifier hs-var">ds_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073916"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073916"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-306"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_fam_inst_env :: DsGblEnv -&gt; FamInstEnv
</span><a href="GHC.HsToCore.Types.html#ds_fam_inst_env"><span class="hs-identifier hs-var">ds_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073918"><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621682073918"><span class="hs-identifier hs-var">fam_inst_env</span></a></span></span><span>
</span><span id="line-307"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_gbl_rdr_env :: DsGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.HsToCore.Types.html#ds_gbl_rdr_env"><span class="hs-identifier hs-var">ds_gbl_rdr_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073920"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682073920"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682073910"><span class="hs-identifier hs-var">gbl</span></a></span><span>
</span><span id="line-308"></span><span>       </span><span class="hs-comment">-- This is *the* use of ds_gbl_rdr_env:</span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-comment">-- Make sure the solver (used by the pattern-match overlap checker) has</span><span>
</span><span id="line-310"></span><span>       </span><span class="hs-comment">-- access to the GlobalRdrEnv and FamInstEnv for the module, so that it</span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-comment">-- knows how to reduce type families, and which newtypes it can unwrap.</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>             </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsl_loc :: DsLclEnv -&gt; RealSrcSpan
</span><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682073923"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682073923"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073911"><span class="hs-identifier hs-var">lcl</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682073924"><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682073924"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682073925"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682073925"><span class="hs-identifier hs-var">mb_ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Messages TcRnMessage, Maybe a)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Messages TcRnMessage, Maybe a)
forall a. IO a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages TcRnMessage, Maybe a)
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Messages TcRnMessage, Maybe a))
-&gt; IO (Messages TcRnMessage, Maybe a)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (Messages TcRnMessage, Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM a
-&gt; IO (Messages TcRnMessage, Maybe a)
forall r.
HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM r
-&gt; IO (Messages TcRnMessage, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-var">initTc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682073913"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073916"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682073923"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; IO (Messages TcRnMessage, Maybe a))
-&gt; TcM a -&gt; IO (Messages TcRnMessage, Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-317"></span><span>         </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcGblEnv) -&gt; TcM a -&gt; TcM a
forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073929"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073929"><span class="hs-identifier hs-var">tc_gbl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621682073929"><span class="hs-identifier hs-var">tc_gbl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682073918"><span class="hs-identifier hs-type">fam_inst_env</span></a></span><span>
</span><span id="line-318"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682073920"><span class="hs-identifier hs-type">rdr_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-319"></span><span>         </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621682073909"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-320"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621682073925"><span class="hs-identifier hs-var">mb_ret</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-321"></span><span>           </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682073930"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073930"><span class="hs-identifier hs-var">ret</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; DsM a
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682073930"><span class="hs-identifier hs-var">ret</span></a></span><span>
</span><span id="line-322"></span><span>           </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initTcDsForSolver&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bag (MsgEnvelope TcRnMessage) -&gt; [SDoc]
forall e. Diagnostic e =&gt; Bag (MsgEnvelope e) -&gt; [SDoc]
</span><a href="GHC.Utils.Error.html#pprMsgEnvelopeBagWithLocDefault"><span class="hs-identifier hs-var">pprMsgEnvelopeBagWithLocDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages TcRnMessage -&gt; Bag (MsgEnvelope TcRnMessage)
forall e. Diagnostic e =&gt; Messages e -&gt; Bag (MsgEnvelope e)
</span><a href="GHC.Types.Error.html#getErrorMessages"><span class="hs-identifier hs-var">getErrorMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages TcRnMessage
</span><a href="#local-6989586621682073924"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-type">mkDsEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.TypeEnv.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a></span><span>
</span><span id="line-325"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#PromotionTickContext"><span class="hs-identifier hs-type">PromotionTickContext</span></a></span><span>
</span><span id="line-326"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IORef.html#IORef/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IORef.html#IORef/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreState"><span class="hs-identifier hs-type">CostCentreState</span></a></span><span>
</span><span id="line-327"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IORef.html#IORef/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Env.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatches"><span class="hs-identifier hs-type">CompleteMatches</span></a></span><span>
</span><span id="line-328"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span id="mkDsEnvs"><span class="annot"><span class="annottext">mkDsEnvs :: UnitEnv
-&gt; Module
-&gt; GlobalRdrEnv
-&gt; TypeEnv
-&gt; FamInstEnv
-&gt; PromotionTickContext
-&gt; IORef (Messages DsMessage)
-&gt; IORef CostCentreState
-&gt; TcRef (ModuleEnv Int)
-&gt; [CompleteMatch]
-&gt; (DsGblEnv, DsLclEnv)
</span><a href="GHC.HsToCore.Monad.html#mkDsEnvs"><span class="hs-identifier hs-var hs-var">mkDsEnvs</span></a></span></span><span> </span><span id="local-6989586621682073936"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682073936"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682073937"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621682073938"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682073938"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621682073939"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621682073939"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621682073940"><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621682073940"><span class="hs-identifier hs-var">fam_inst_env</span></a></span></span><span> </span><span id="local-6989586621682073941"><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621682073941"><span class="hs-identifier hs-var">ptc</span></a></span></span><span> </span><span id="local-6989586621682073942"><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073942"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span id="local-6989586621682073943"><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621682073943"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>
</span><span id="line-330"></span><span>         </span><span id="local-6989586621682073944"><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621682073944"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span></span><span> </span><span id="local-6989586621682073945"><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621682073945"><span class="hs-identifier hs-var">complete_matches</span></a></span></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682073946"><span class="annot"><span class="annottext">if_genv :: IfGblEnv
</span><a href="#local-6989586621682073946"><span class="hs-identifier hs-var hs-var">if_genv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkDsEnvs&quot;</span></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-comment">-- Failing tests here are `ghci` and `T11985` if you get this wrong.</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-comment">-- this is very very &quot;at a distance&quot; because the reason for this check is that the type_env in interactive</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-comment">-- mode is the smushed together of all the interactive modules.</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-comment">-- See Note [Why is KnotVars not a ModuleEnv]</span><span>
</span><span id="line-336"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">if_rec_types :: KnotVars (IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module]
-&gt; (Module -&gt; Maybe (IfG TypeEnv)) -&gt; KnotVars (IfG TypeEnv)
forall a. [Module] -&gt; (Module -&gt; Maybe a) -&gt; KnotVars a
</span><a href="GHC.Driver.Env.KnotVars.html#KnotVars"><span class="hs-identifier hs-var">KnotVars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073952"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073952"><span class="hs-identifier hs-var">that_mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073952"><span class="hs-identifier hs-var">that_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-var">isInteractiveModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-337"></span><span>                                                          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IfG TypeEnv -&gt; Maybe (IfG TypeEnv)
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeEnv -&gt; IfG TypeEnv
forall a. a -&gt; IOEnv (Env IfGblEnv ()) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621682073939"><span class="hs-identifier hs-var">type_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                                                          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (IfG TypeEnv)
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-339"></span><span>        </span><span id="local-6989586621682073955"><span class="annot"><span class="annottext">if_lenv :: IfLclEnv
</span><a href="#local-6989586621682073955"><span class="hs-identifier hs-var hs-var">if_lenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var">mkIfLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC error in desugarer lookup in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>                             </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621682073958"><span class="annot"><span class="annottext">real_span :: RealSrcSpan
</span><a href="#local-6989586621682073958"><span class="hs-identifier hs-var hs-var">real_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcLoc -&gt; RealSrcSpan
</span><a href="GHC.Types.SrcLoc.html#realSrcLocSpan"><span class="hs-identifier hs-var">realSrcLocSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; FastString
</span><a href="Language.Haskell.Syntax.Module.Name.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>        </span><span id="local-6989586621682073963"><span class="annot"><span class="annottext">gbl_env :: DsGblEnv
</span><a href="#local-6989586621682073963"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ds_mod :: Module
</span><a href="GHC.HsToCore.Types.html#ds_mod"><span class="hs-identifier hs-var">ds_mod</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682073937"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-343"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_fam_inst_env :: FamInstEnv
</span><a href="GHC.HsToCore.Types.html#ds_fam_inst_env"><span class="hs-identifier hs-var">ds_fam_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="#local-6989586621682073940"><span class="hs-identifier hs-var">fam_inst_env</span></a></span><span>
</span><span id="line-344"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_gbl_rdr_env :: GlobalRdrEnv
</span><a href="GHC.HsToCore.Types.html#ds_gbl_rdr_env"><span class="hs-identifier hs-var">ds_gbl_rdr_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682073938"><span class="hs-identifier hs-var">rdr_env</span></a></span><span>
</span><span id="line-345"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_if_env :: (IfGblEnv, IfLclEnv)
</span><a href="GHC.HsToCore.Types.html#ds_if_env"><span class="hs-identifier hs-var">ds_if_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621682073946"><span class="hs-identifier hs-var">if_genv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621682073955"><span class="hs-identifier hs-var">if_lenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_name_ppr_ctx :: NamePprCtx
</span><a href="GHC.HsToCore.Types.html#ds_name_ppr_ctx"><span class="hs-identifier hs-var">ds_name_ppr_ctx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnv -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#mkNamePprCtx"><span class="hs-identifier hs-var">mkNamePprCtx</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621682073941"><span class="hs-identifier hs-var">ptc</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682073936"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621682073938"><span class="hs-identifier hs-var">rdr_env</span></a></span><span>
</span><span id="line-347"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_msgs :: IORef (Messages DsMessage)
</span><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
</span><a href="#local-6989586621682073942"><span class="hs-identifier hs-var">msg_var</span></a></span><span>
</span><span id="line-348"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_complete_matches :: [CompleteMatch]
</span><a href="GHC.HsToCore.Types.html#ds_complete_matches"><span class="hs-identifier hs-var">ds_complete_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621682073945"><span class="hs-identifier hs-var">complete_matches</span></a></span><span>
</span><span id="line-349"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_cc_st :: IORef CostCentreState
</span><a href="GHC.HsToCore.Types.html#ds_cc_st"><span class="hs-identifier hs-var">ds_cc_st</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621682073943"><span class="hs-identifier hs-var">cc_st_var</span></a></span><span>
</span><span id="line-350"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ds_next_wrapper_num :: TcRef (ModuleEnv Int)
</span><a href="GHC.HsToCore.Types.html#ds_next_wrapper_num"><span class="hs-identifier hs-var">ds_next_wrapper_num</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef (ModuleEnv Int)
</span><a href="#local-6989586621682073944"><span class="hs-identifier hs-var">next_wrapper_num</span></a></span><span>
</span><span id="line-351"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621682073970"><span class="annot"><span class="annottext">lcl_env :: DsLclEnv
</span><a href="#local-6989586621682073970"><span class="hs-identifier hs-var hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dsl_meta :: DsMetaEnv
</span><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsMetaEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-353"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsl_loc :: RealSrcSpan
</span><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682073958"><span class="hs-identifier hs-var">real_span</span></a></span><span>
</span><span id="line-354"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dsl_nablas :: Nablas
</span><a href="GHC.HsToCore.Types.html#dsl_nablas"><span class="hs-identifier hs-var">dsl_nablas</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#initNablas"><span class="hs-identifier hs-var">initNablas</span></a></span><span>
</span><span id="line-355"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682073963"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073970"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Operations in the monad
*                                                                      *
************************************************************************

And all this mysterious stuff is so we can occasionally reach out and
grab one or more names.  @newLocalDs@ isn't exported---exported
functions are defined with it.  The difference in name-strings makes
it easier to read debugging output.

-}</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="hs-comment">-- Make a new Id with the same print name, but different type, and new unique</span><span>
</span><span id="line-374"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newUniqueId"><span class="hs-identifier hs-type">newUniqueId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-375"></span><span id="newUniqueId"><span class="annot"><span class="annottext">newUniqueId :: Id -&gt; Mult -&gt; Mult -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newUniqueId"><span class="hs-identifier hs-var hs-var">newUniqueId</span></a></span></span><span> </span><span id="local-6989586621682073975"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682073975"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM Id
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m Id
</span><a href="GHC.Types.Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FastString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682073975"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#duplicateLocalDs"><span class="hs-identifier hs-type">duplicateLocalDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-378"></span><span id="duplicateLocalDs"><span class="annot"><span class="annottext">duplicateLocalDs :: Id -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#duplicateLocalDs"><span class="hs-identifier hs-var hs-var">duplicateLocalDs</span></a></span></span><span> </span><span id="local-6989586621682073980"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682073980"><span class="hs-identifier hs-var">old_local</span></a></span></span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073981"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682073981"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; DsM Id
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Unique -&gt; Id
</span><a href="GHC.Types.Id.html#setIdUnique"><span class="hs-identifier hs-var">setIdUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682073980"><span class="hs-identifier hs-var">old_local</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621682073981"><span class="hs-identifier hs-var">uniq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newPredVarDs"><span class="hs-identifier hs-type">newPredVarDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-383"></span><span id="newPredVarDs"><span class="annot"><span class="annottext">newPredVarDs :: Mult -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newPredVarDs"><span class="hs-identifier hs-var hs-var">newPredVarDs</span></a></span></span><span>
</span><span id="line-384"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM Id
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m Id
</span><a href="GHC.Types.Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span>  </span><span class="hs-comment">-- like newSysLocalDs, but we allow covars</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-type">newSysLocalDs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html#newFailLocalDs"><span class="hs-identifier hs-type">newFailLocalDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-387"></span><span id="newSysLocalDs"><span class="annot"><span class="annottext">newSysLocalDs :: Mult -&gt; Mult -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var hs-var">newSysLocalDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM Id
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m Id
</span><a href="GHC.Types.Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ds&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span id="newFailLocalDs"><span class="annot"><span class="annottext">newFailLocalDs :: Mult -&gt; Mult -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newFailLocalDs"><span class="hs-identifier hs-var hs-var">newFailLocalDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Mult -&gt; Mult -&gt; DsM Id
forall (m :: * -&gt; *).
MonadUnique m =&gt;
FastString -&gt; Mult -&gt; Mult -&gt; m Id
</span><a href="GHC.Types.Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fail&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-type">newSysLocalsDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-391"></span><span id="newSysLocalsDs"><span class="annot"><span class="annottext">newSysLocalsDs :: [Scaled Mult] -&gt; DsM [Id]
</span><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-var hs-var">newSysLocalsDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled Mult -&gt; DsM Id) -&gt; [Scaled Mult] -&gt; DsM [Id]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621682073989"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621682073990"><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682073990"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Mult -&gt; Mult -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682073989"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Mult
</span><a href="#local-6989586621682073990"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-comment">{-
We can also reach out and either set/grab location information from
the @SrcSpan@ being carried around.
-}</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getGhcModeDs"><span class="hs-identifier hs-type">getGhcModeDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#GhcMode"><span class="hs-identifier hs-type">GhcMode</span></a></span><span>
</span><span id="line-399"></span><span id="getGhcModeDs"><span class="annot"><span class="annottext">getGhcModeDs :: DsM GhcMode
</span><a href="GHC.HsToCore.Monad.html#getGhcModeDs"><span class="hs-identifier hs-var hs-var">getGhcModeDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
-&gt; (DynFlags -&gt; DsM GhcMode) -&gt; DsM GhcMode
forall a b.
IOEnv (Env DsGblEnv DsLclEnv) a
-&gt; (a -&gt; IOEnv (Env DsGblEnv DsLclEnv) b)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">GhcMode -&gt; DsM GhcMode
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcMode -&gt; DsM GhcMode)
-&gt; (DynFlags -&gt; GhcMode) -&gt; DynFlags -&gt; DsM GhcMode
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcMode
</span><a href="GHC.Driver.Session.html#ghcMode"><span class="hs-identifier hs-var">ghcMode</span></a></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><span class="hs-comment">-- | Get the current pattern match oracle state. See 'dsl_nablas'.</span></span><span>
</span><span id="line-402"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getPmNablas"><span class="hs-identifier hs-type">getPmNablas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span>
</span><span id="line-403"></span><span id="getPmNablas"><span class="annot"><span class="annottext">getPmNablas :: DsM Nablas
</span><a href="GHC.HsToCore.Monad.html#getPmNablas"><span class="hs-identifier hs-var hs-var">getPmNablas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073994"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073994"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Nablas -&gt; DsM Nablas
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsLclEnv -&gt; Nablas
</span><a href="GHC.HsToCore.Types.html#dsl_nablas"><span class="hs-identifier hs-var">dsl_nablas</span></a></span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073994"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- | Set the pattern match oracle state within the scope of the given action.</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- See 'dsl_nablas'.</span><span>
</span><span id="line-407"></span><span id="local-6989586621682073487"><span class="annot"><a href="GHC.HsToCore.Monad.html#updPmNablas"><span class="hs-identifier hs-type">updPmNablas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073487"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073487"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-408"></span><span id="updPmNablas"><span class="annot"><span class="annottext">updPmNablas :: forall a. Nablas -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#updPmNablas"><span class="hs-identifier hs-var hs-var">updPmNablas</span></a></span></span><span> </span><span id="local-6989586621682073996"><span class="annot"><span class="annottext">Nablas
</span><a href="#local-6989586621682073996"><span class="hs-identifier hs-var">nablas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; DsLclEnv)
-&gt; TcRnIf DsGblEnv DsLclEnv a -&gt; TcRnIf DsGblEnv DsLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682073998"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073998"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073998"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_nablas"><span class="hs-identifier hs-var">dsl_nablas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682073996"><span class="hs-identifier hs-type">nablas</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-type">getSrcSpanDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-411"></span><span id="getSrcSpanDs"><span class="annot"><span class="annottext">getSrcSpanDs :: DsM SrcSpan
</span><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-var hs-var">getSrcSpanDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682073999"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073999"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-412"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DsM SrcSpan
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Maybe BufSpan -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-var">RealSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsLclEnv -&gt; RealSrcSpan
</span><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682073999"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
forall a. Maybe a
</span><a href="GHC.Data.Strict.html#Nothing"><span class="hs-identifier hs-var">Strict.Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span id="local-6989586621682073495"><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-type">putSrcSpanDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073495"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073495"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-415"></span><span id="putSrcSpanDs"><span class="annot"><span class="annottext">putSrcSpanDs :: forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var hs-var">putSrcSpanDs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-type">UnhelpfulSpan</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682074003"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074003"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074003"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-417"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span id="local-6989586621682074004"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621682074004"><span class="hs-identifier hs-var">real_span</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682074005"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074005"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; DsLclEnv) -&gt; DsM a -&gt; DsM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682074006"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074006"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074006"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_loc"><span class="hs-identifier hs-var">dsl_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682074004"><span class="hs-identifier hs-type">real_span</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074005"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span id="local-6989586621682073497"><span id="local-6989586621682073498"><span class="annot"><a href="GHC.HsToCore.Monad.html#putSrcSpanDsA"><span class="hs-identifier hs-type">putSrcSpanDsA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#SrcSpanAnn%27"><span class="hs-identifier hs-type">SrcSpanAnn'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073497"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073498"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073498"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-421"></span><span id="putSrcSpanDsA"><span class="annot"><span class="annottext">putSrcSpanDsA :: forall ann a. SrcSpanAnn' ann -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDsA"><span class="hs-identifier hs-var hs-var">putSrcSpanDsA</span></a></span></span><span> </span><span id="local-6989586621682074007"><span class="annot"><span class="annottext">SrcSpanAnn' ann
</span><a href="#local-6989586621682074007"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; DsM a -&gt; DsM a
forall a. SrcSpan -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#putSrcSpanDs"><span class="hs-identifier hs-var">putSrcSpanDs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpanAnn' ann -&gt; SrcSpan
forall a. SrcSpanAnn' a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnn' ann
</span><a href="#local-6989586621682074007"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-comment">-- | Emit a diagnostic for the current source location. In case the diagnostic is a warning,</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- the latter will be ignored and discarded if the relevant 'WarningFlag' is not set in the DynFlags.</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- See Note [Discarding Messages] in 'GHC.Types.Error'.</span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-type">diagnosticDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span id="diagnosticDs"><span class="annot"><span class="annottext">diagnosticDs :: DsMessage -&gt; DsM ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var hs-var">diagnosticDs</span></a></span></span><span> </span><span id="local-6989586621682074010"><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621682074010"><span class="hs-identifier hs-var">dsMessage</span></a></span></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682074011"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074011"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-429"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682074012"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682074012"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM SrcSpan
</span><a href="GHC.HsToCore.Monad.html#getSrcSpanDs"><span class="hs-identifier hs-var">getSrcSpanDs</span></a></span><span>
</span><span id="line-430"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621682074013"><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682074013"><span class="hs-identifier hs-var">diag_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DiagOpts
</span><a href="GHC.Driver.Config.Diagnostic.html#initDiagOpts"><span class="hs-identifier hs-var">initDiagOpts</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DiagOpts)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) DynFlags
-&gt; IOEnv (Env DsGblEnv DsLclEnv) DiagOpts
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-431"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682074015"><span class="annot"><span class="annottext">msg :: MsgEnvelope DsMessage
</span><a href="#local-6989586621682074015"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagOpts
-&gt; SrcSpan -&gt; NamePprCtx -&gt; DsMessage -&gt; MsgEnvelope DsMessage
forall e.
Diagnostic e =&gt;
DiagOpts -&gt; SrcSpan -&gt; NamePprCtx -&gt; e -&gt; MsgEnvelope e
</span><a href="GHC.Utils.Error.html#mkMsgEnvelope"><span class="hs-identifier hs-var">mkMsgEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">DiagOpts
</span><a href="#local-6989586621682074013"><span class="hs-identifier hs-var">diag_opts</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621682074012"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv -&gt; NamePprCtx
</span><a href="GHC.HsToCore.Types.html#ds_name_ppr_ctx"><span class="hs-identifier hs-var">ds_name_ppr_ctx</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074011"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621682074010"><span class="hs-identifier hs-var">dsMessage</span></a></span><span>
</span><span id="line-432"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
-&gt; (Messages DsMessage -&gt; Messages DsMessage) -&gt; DsM ()
forall a env. IORef a -&gt; (a -&gt; a) -&gt; IOEnv env ()
</span><a href="GHC.Data.IOEnv.html#updMutVar"><span class="hs-identifier hs-var">updMutVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef (Messages DsMessage)
</span><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074011"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682074018"><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682074018"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DsMessage
</span><a href="#local-6989586621682074015"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">MsgEnvelope DsMessage -&gt; Messages DsMessage -&gt; Messages DsMessage
forall e. MsgEnvelope e -&gt; Messages e -&gt; Messages e
</span><a href="GHC.Types.Error.html#addMessage"><span class="hs-operator hs-var">`addMessage`</span></a></span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682074018"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-comment">-- | Issue an error, but return the expression for (), so that we can continue</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- reporting errors.</span><span>
</span><span id="line-436"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#errDsCoreExpr"><span class="hs-identifier hs-type">errDsCoreExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-437"></span><span id="errDsCoreExpr"><span class="annot"><span class="annottext">errDsCoreExpr :: DsMessage -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Monad.html#errDsCoreExpr"><span class="hs-identifier hs-var hs-var">errDsCoreExpr</span></a></span></span><span> </span><span id="local-6989586621682074020"><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621682074020"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; DsM ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621682074020"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-439"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="GHC.Core.Make.html#unitExpr"><span class="hs-identifier hs-var">unitExpr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span id="local-6989586621682073510"><span class="annot"><a href="GHC.HsToCore.Monad.html#failWithDs"><span class="hs-identifier hs-type">failWithDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Errors.Types.html#DsMessage"><span class="hs-identifier hs-type">DsMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073510"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-442"></span><span id="failWithDs"><span class="annot"><span class="annottext">failWithDs :: forall a. DsMessage -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#failWithDs"><span class="hs-identifier hs-var hs-var">failWithDs</span></a></span></span><span> </span><span id="local-6989586621682074022"><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621682074022"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DsMessage -&gt; DsM ()
</span><a href="GHC.HsToCore.Monad.html#diagnosticDs"><span class="hs-identifier hs-var">diagnosticDs</span></a></span><span> </span><span class="annot"><span class="annottext">DsMessage
</span><a href="#local-6989586621682074022"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">DsM a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span id="local-6989586621682073514"><span class="annot"><a href="GHC.HsToCore.Monad.html#failDs"><span class="hs-identifier hs-type">failDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073514"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-447"></span><span id="failDs"><span class="annot"><span class="annottext">failDs :: forall a. DsM a
</span><a href="GHC.HsToCore.Monad.html#failDs"><span class="hs-identifier hs-var hs-var">failDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#mkNamePprCtxDs"><span class="hs-identifier hs-type">mkNamePprCtxDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#NamePprCtx"><span class="hs-identifier hs-type">NamePprCtx</span></a></span><span>
</span><span id="line-450"></span><span id="mkNamePprCtxDs"><span class="annot"><span class="annottext">mkNamePprCtxDs :: DsM NamePprCtx
</span><a href="GHC.HsToCore.Monad.html#mkNamePprCtxDs"><span class="hs-identifier hs-var hs-var">mkNamePprCtxDs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; NamePprCtx
</span><a href="GHC.HsToCore.Types.html#ds_name_ppr_ctx"><span class="hs-identifier hs-var">ds_name_ppr_ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; NamePprCtx)
-&gt; TcRnIf DsGblEnv DsLclEnv DsGblEnv -&gt; DsM NamePprCtx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-451"></span><span>
</span><span id="line-452"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621682074028"><span id="local-6989586621682074032"><span id="local-6989586621682074035"><span class="annot"><a href="GHC.Types.TyThing.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-453"></span><span>    </span><span id="local-6989586621682074038"><span class="annot"><span class="annottext">lookupThing :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="#local-6989586621682074038"><span class="hs-identifier hs-var hs-var hs-var hs-var">lookupThing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-type">dsLookupGlobal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.TyThing.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span>
</span><span id="line-456"></span><span class="hs-comment">-- Very like GHC.Tc.Utils.Env.tcLookupGlobal</span><span>
</span><span id="line-457"></span><span id="dsLookupGlobal"><span class="annot"><span class="annottext">dsLookupGlobal :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var hs-var">dsLookupGlobal</span></a></span></span><span> </span><span id="local-6989586621682074040"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074040"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682074041"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074041"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(IfGblEnv, IfLclEnv)
-&gt; TcRnIf IfGblEnv IfLclEnv TyThing
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
forall gbl' lcl' a gbl lcl.
(gbl', lcl') -&gt; TcRnIf gbl' lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv -&gt; (IfGblEnv, IfLclEnv)
</span><a href="GHC.HsToCore.Types.html#ds_if_env"><span class="hs-identifier hs-var">ds_if_env</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074041"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcRnIf IfGblEnv IfLclEnv TyThing
</span><a href="GHC.IfaceToCore.html#tcIfaceGlobal"><span class="hs-identifier hs-var">tcIfaceGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074040"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-type">dsLookupGlobalId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-463"></span><span id="dsLookupGlobalId"><span class="annot"><span class="annottext">dsLookupGlobalId :: Name -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var hs-var">dsLookupGlobalId</span></a></span></span><span> </span><span id="local-6989586621682074043"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074043"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TyThing -&gt; Id
TyThing -&gt; Id
</span><a href="GHC.Types.TyThing.html#tyThingId"><span class="hs-identifier hs-var">tyThingId</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; Id) -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing -&gt; DsM Id
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074043"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-type">dsLookupTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-467"></span><span id="dsLookupTyCon"><span class="annot"><span class="annottext">dsLookupTyCon :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var hs-var">dsLookupTyCon</span></a></span></span><span> </span><span id="local-6989586621682074045"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074045"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TyThing -&gt; TyCon
TyThing -&gt; TyCon
</span><a href="GHC.Types.TyThing.html#tyThingTyCon"><span class="hs-identifier hs-var">tyThingTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; TyCon)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyCon
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074045"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-type">dsLookupDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-471"></span><span id="dsLookupDataCon"><span class="annot"><span class="annottext">dsLookupDataCon :: Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) DataCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-var hs-var">dsLookupDataCon</span></a></span></span><span> </span><span id="local-6989586621682074047"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074047"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TyThing -&gt; DataCon
TyThing -&gt; DataCon
</span><a href="GHC.Types.TyThing.html#tyThingDataCon"><span class="hs-identifier hs-var">tyThingDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; DataCon)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
-&gt; IOEnv (Env DsGblEnv DsLclEnv) DataCon
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074047"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupConLike"><span class="hs-identifier hs-type">dsLookupConLike</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-475"></span><span id="dsLookupConLike"><span class="annot"><span class="annottext">dsLookupConLike :: Name -&gt; DsM ConLike
</span><a href="GHC.HsToCore.Monad.html#dsLookupConLike"><span class="hs-identifier hs-var hs-var">dsLookupConLike</span></a></span></span><span> </span><span id="local-6989586621682074049"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074049"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; TyThing -&gt; ConLike
TyThing -&gt; ConLike
</span><a href="GHC.Types.TyThing.html#tyThingConLike"><span class="hs-identifier hs-var">tyThingConLike</span></a></span><span> </span><span class="annot"><span class="annottext">(TyThing -&gt; ConLike)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing -&gt; DsM ConLike
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env DsGblEnv DsLclEnv) TyThing
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobal"><span class="hs-identifier hs-var">dsLookupGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074049"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-type">dsGetFamInstEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span>
</span><span id="line-480"></span><span class="hs-comment">-- Gets both the external-package inst-env</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- and the home-pkg inst env (includes module being compiled)</span><span>
</span><span id="line-482"></span><span id="dsGetFamInstEnvs"><span class="annot"><span class="annottext">dsGetFamInstEnvs :: DsM FamInstEnvs
</span><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var hs-var">dsGetFamInstEnvs</span></a></span></span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682074051"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682074051"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv ExternalPackageState
forall gbl lcl. TcRnIf gbl lcl ExternalPackageState
</span><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier hs-var">getEps</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621682074053"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074053"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-484"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; DsM FamInstEnvs
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalPackageState -&gt; FamInstEnv
</span><a href="GHC.Unit.External.html#eps_fam_inst_env"><span class="hs-identifier hs-var">eps_fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621682074051"><span class="hs-identifier hs-var">eps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; FamInstEnv
</span><a href="GHC.HsToCore.Types.html#ds_fam_inst_env"><span class="hs-identifier hs-var">ds_fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074053"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetMetaEnv"><span class="hs-identifier hs-type">dsGetMetaEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span id="dsGetMetaEnv"><span class="annot"><span class="annottext">dsGetMetaEnv :: DsM DsMetaEnv
</span><a href="GHC.HsToCore.Monad.html#dsGetMetaEnv"><span class="hs-identifier hs-var hs-var">dsGetMetaEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682074055"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074055"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">DsMetaEnv -&gt; DsM DsMetaEnv
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsLclEnv -&gt; DsMetaEnv
</span><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074055"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span class="annot"><span class="hs-comment">-- | The @COMPLETE@ pragmas that are in scope.</span></span><span>
</span><span id="line-490"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier hs-type">dsGetCompleteMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatches"><span class="hs-identifier hs-type">CompleteMatches</span></a></span><span>
</span><span id="line-491"></span><span id="dsGetCompleteMatches"><span class="annot"><span class="annottext">dsGetCompleteMatches :: DsM [CompleteMatch]
</span><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier hs-var hs-var">dsGetCompleteMatches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; [CompleteMatch]
</span><a href="GHC.HsToCore.Types.html#ds_complete_matches"><span class="hs-identifier hs-var">ds_complete_matches</span></a></span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; [CompleteMatch])
-&gt; TcRnIf DsGblEnv DsLclEnv DsGblEnv -&gt; DsM [CompleteMatch]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#dsLookupMetaEnv"><span class="hs-identifier hs-type">dsLookupMetaEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span id="dsLookupMetaEnv"><span class="annot"><span class="annottext">dsLookupMetaEnv :: Name -&gt; DsM (Maybe DsMetaVal)
</span><a href="GHC.HsToCore.Monad.html#dsLookupMetaEnv"><span class="hs-identifier hs-var hs-var">dsLookupMetaEnv</span></a></span></span><span> </span><span id="local-6989586621682074056"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074056"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682074057"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074057"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe DsMetaVal -&gt; DsM (Maybe DsMetaVal)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsMetaEnv -&gt; Name -&gt; Maybe DsMetaVal
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsLclEnv -&gt; DsMetaEnv
</span><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074057"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621682074056"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span id="local-6989586621682073526"><span class="annot"><a href="GHC.HsToCore.Monad.html#dsExtendMetaEnv"><span class="hs-identifier hs-type">dsExtendMetaEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsMetaEnv"><span class="hs-identifier hs-type">DsMetaEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073526"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073526"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-497"></span><span id="dsExtendMetaEnv"><span class="annot"><span class="annottext">dsExtendMetaEnv :: forall a. DsMetaEnv -&gt; DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#dsExtendMetaEnv"><span class="hs-identifier hs-var hs-var">dsExtendMetaEnv</span></a></span></span><span> </span><span id="local-6989586621682074059"><span class="annot"><span class="annottext">DsMetaEnv
</span><a href="#local-6989586621682074059"><span class="hs-identifier hs-var">menv</span></a></span></span><span> </span><span id="local-6989586621682074060"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074060"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsLclEnv -&gt; DsLclEnv) -&gt; DsM a -&gt; DsM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682074061"><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074061"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DsLclEnv
</span><a href="#local-6989586621682074061"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#dsl_meta"><span class="hs-identifier hs-var">dsl_meta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074061"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#plusNameEnv"><span class="hs-operator hs-type">`plusNameEnv`</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682074059"><span class="hs-identifier hs-type">menv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074060"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span id="local-6989586621682073529"><span class="annot"><a href="GHC.HsToCore.Monad.html#discardWarningsDs"><span class="hs-identifier hs-type">discardWarningsDs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073529"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682073529"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-501"></span><span class="hs-comment">-- Ignore warnings inside the thing inside;</span><span>
</span><span id="line-502"></span><span class="hs-comment">-- used to ignore inaccessible cases etc. inside generated code</span><span>
</span><span id="line-503"></span><span id="discardWarningsDs"><span class="annot"><span class="annottext">discardWarningsDs :: forall a. DsM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#discardWarningsDs"><span class="hs-identifier hs-var hs-var">discardWarningsDs</span></a></span></span><span> </span><span id="local-6989586621682074068"><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074068"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682074069"><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074069"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv DsGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-505"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682074070"><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682074070"><span class="hs-identifier hs-var">old_msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage)
-&gt; TcRnIf DsGblEnv DsLclEnv (Messages DsMessage)
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef (Messages DsMessage)
</span><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074069"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682074072"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682074072"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM a
</span><a href="#local-6989586621682074068"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>        </span><span class="hs-comment">-- Revert messages to old_msgs</span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef (Messages DsMessage) -&gt; Messages DsMessage -&gt; DsM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef (Messages DsMessage)
</span><a href="GHC.HsToCore.Types.html#ds_msgs"><span class="hs-identifier hs-var">ds_msgs</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv
</span><a href="#local-6989586621682074069"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Messages DsMessage
</span><a href="#local-6989586621682074070"><span class="hs-identifier hs-var">old_msgs</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">a -&gt; DsM a
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682074072"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="hs-comment">-- | Inject a trace message into the compiled program. Whereas</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- pprTrace prints out information *while compiling*, pprRuntimeTrace</span><span>
</span><span id="line-516"></span><span class="hs-comment">-- captures that information and causes it to be printed *at runtime*</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- using Debug.Trace.trace.</span><span>
</span><span id="line-518"></span><span class="hs-comment">--</span><span>
</span><span id="line-519"></span><span class="hs-comment">--   pprRuntimeTrace hdr doc expr</span><span>
</span><span id="line-520"></span><span class="hs-comment">--</span><span>
</span><span id="line-521"></span><span class="hs-comment">-- will produce an expression that looks like</span><span>
</span><span id="line-522"></span><span class="hs-comment">--</span><span>
</span><span id="line-523"></span><span class="hs-comment">--   trace (hdr + doc) expr</span><span>
</span><span id="line-524"></span><span class="hs-comment">--</span><span>
</span><span id="line-525"></span><span class="hs-comment">-- When using this to debug a module that Debug.Trace depends on,</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- it is necessary to import {-# SOURCE #-} Debug.Trace () in that</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- module. We could avoid this inconvenience by wiring in Debug.Trace.trace,</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- but that doesn't seem worth the effort and maintenance cost.</span><span>
</span><span id="line-529"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#pprRuntimeTrace"><span class="hs-identifier hs-type">pprRuntimeTrace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>   </span><span class="annot"><span class="hs-comment">-- ^ header</span></span><span>
</span><span id="line-530"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>     </span><span class="annot"><span class="hs-comment">-- ^ information to output</span></span><span>
</span><span id="line-531"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ expression</span></span><span>
</span><span id="line-532"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-533"></span><span id="pprRuntimeTrace"><span class="annot"><span class="annottext">pprRuntimeTrace :: String -&gt; SDoc -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Monad.html#pprRuntimeTrace"><span class="hs-identifier hs-var hs-var">pprRuntimeTrace</span></a></span></span><span> </span><span id="local-6989586621682074074"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682074074"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621682074075"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682074075"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621682074076"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682074076"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-534"></span><span>  </span><span id="local-6989586621682074077"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682074077"><span class="hs-identifier hs-var">traceId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#traceName"><span class="hs-identifier hs-var">traceName</span></a></span><span>
</span><span id="line-535"></span><span>  </span><span id="local-6989586621682074079"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682074079"><span class="hs-identifier hs-var">unpackCStringId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#unpackCStringName"><span class="hs-identifier hs-var">unpackCStringName</span></a></span><span>
</span><span id="line-536"></span><span>  </span><span id="local-6989586621682074081"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682074081"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env DsGblEnv DsLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682074082"><span class="hs-identifier hs-type">message</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-538"></span><span>      </span><span id="local-6989586621682074082"><span class="annot"><span class="annottext">message :: CoreExpr
</span><a href="#local-6989586621682074082"><span class="hs-identifier hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsWrapper
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682074079"><span class="hs-identifier hs-var">unpackCStringId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DsWrapper -&gt; DsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-539"></span><span>                </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; CoreExpr) -&gt; Literal -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Literal
</span><a href="GHC.Types.Literal.html#mkLitString"><span class="hs-identifier hs-var">mkLitString</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Literal) -&gt; String -&gt; Literal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; String
</span><a href="GHC.Driver.Ppr.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682074081"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682074074"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621682074075"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; CoreExpr -&gt; DsM CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682074077"><span class="hs-identifier hs-var">traceId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Mult -&gt; CoreExpr
forall b. Mult -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreExpr -&gt; Mult
CoreExpr -&gt; Mult
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682074076"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682074082"><span class="hs-identifier hs-var">message</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682074076"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><span class="hs-comment">-- | See 'getCCIndexM'.</span></span><span>
</span><span id="line-543"></span><span class="annot"><a href="GHC.HsToCore.Monad.html#getCCIndexDsM"><span class="hs-identifier hs-type">getCCIndexDsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreIndex"><span class="hs-identifier hs-type">CostCentreIndex</span></a></span><span>
</span><span id="line-544"></span><span id="getCCIndexDsM"><span class="annot"><span class="annottext">getCCIndexDsM :: FastString -&gt; DsM CostCentreIndex
</span><a href="GHC.HsToCore.Monad.html#getCCIndexDsM"><span class="hs-identifier hs-var hs-var">getCCIndexDsM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DsGblEnv -&gt; IORef CostCentreState)
-&gt; FastString -&gt; DsM CostCentreIndex
forall gbl lcl.
(gbl -&gt; IORef CostCentreState)
-&gt; FastString -&gt; TcRnIf gbl lcl CostCentreIndex
</span><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier hs-var">getCCIndexM</span></a></span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef CostCentreState
</span><a href="GHC.HsToCore.Types.html#ds_cc_st"><span class="hs-identifier hs-var">ds_cc_st</span></a></span><span>
</span><span id="line-545"></span></pre></body></html>