<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stg to C-- code generation</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- (c) The University of Glasgow 2004-2006</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.StgToCmm</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier">codeGen</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Prelude.html#/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Prof.html"><span class="hs-identifier">GHC.StgToCmm.Prof</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Prof.html#initCostCentres"><span class="hs-identifier">initCostCentres</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Prof.html#ldvEnter"><span class="hs-identifier">ldvEnter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html"><span class="hs-identifier">GHC.StgToCmm.Monad</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Env.html"><span class="hs-identifier">GHC.StgToCmm.Env</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Bind.html"><span class="hs-identifier">GHC.StgToCmm.Bind</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.DataCon.html"><span class="hs-identifier">GHC.StgToCmm.DataCon</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Layout.html"><span class="hs-identifier">GHC.StgToCmm.Layout</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Utils.html"><span class="hs-identifier">GHC.StgToCmm.Utils</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Closure.html"><span class="hs-identifier">GHC.StgToCmm.Closure</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html"><span class="hs-identifier">GHC.StgToCmm.Config</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Hpc.html"><span class="hs-identifier">GHC.StgToCmm.Hpc</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Ticky.html"><span class="hs-identifier">GHC.StgToCmm.Ticky</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier">ModuleLFInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Utils.html"><span class="hs-identifier">GHC.Cmm.Utils</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html"><span class="hs-identifier">GHC.Cmm.CLabel</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Graph.html"><span class="hs-identifier">GHC.Cmm.Graph</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html"><span class="hs-identifier">GHC.Types.IPE</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html"><span class="hs-identifier">GHC.Types.HpcInfo</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#isEmptyDVarSet"><span class="hs-identifier">isEmptyDVarSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html"><span class="hs-identifier">GHC.Data.OrdList</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Map.html"><span class="hs-identifier">GHC.Types.Unique.Map</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier">when</span></a></span><span class="hs-special">,</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Foldable.html#forM_/Data.Foldable.html#forM_"><span class="hs-identifier">forM_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/System.IO.Unsafe.html#/System.IO.Unsafe.html"><span class="hs-identifier">System.IO.Unsafe</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring-0.11.5.4/src/Data.ByteString.html#/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.IORef.html#/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier">assertPpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier hs-type">codeGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>                </span><span class="hs-comment">-- (Local/global) cost-centres needing declaring/registering.</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- Bindings to convert</span><span>
</span><span id="line-80"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroup"><span class="hs-identifier hs-type">CmmGroup</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier hs-type">ModuleLFInfos</span></a></span><span>       </span><span class="hs-comment">-- Output as a stream, so codegen can</span><span>
</span><span id="line-82"></span><span>                                       </span><span class="hs-comment">-- be interleaved with output</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="codeGen"><span class="annot"><span class="annottext">codeGen :: Logger
-&gt; TmpFs
-&gt; StgToCmmConfig
-&gt; InfoTableProvMap
-&gt; [TyCon]
-&gt; CollectedCCs
-&gt; [CgStgTopBinding]
-&gt; HpcInfo
-&gt; Stream IO CmmGroup ModuleLFInfos
</span><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier hs-var hs-var">codeGen</span></a></span></span><span> </span><span id="local-6989586621681970753"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681970753"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681970754"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681970754"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681970755"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970755"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.Map.html#UniqMap"><span class="hs-identifier hs-type">UniqMap</span></a></span><span> </span><span id="local-6989586621681970758"><span class="annot"><span class="annottext">UniqFM
  DataCon (DataCon, NonEmpty (WordOff, Maybe IpeSourceLocation))
</span><a href="#local-6989586621681970758"><span class="hs-identifier hs-var">denv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ClosureMap
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">InfoTableToSourceLocationMap
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681970759"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681970759"><span class="hs-identifier hs-var">data_tycons</span></a></span></span><span>
</span><span id="line-85"></span><span>        </span><span id="local-6989586621681970760"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681970760"><span class="hs-identifier hs-var">cost_centre_info</span></a></span></span><span> </span><span id="local-6989586621681970761"><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681970761"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span> </span><span id="local-6989586621681970762"><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681970762"><span class="hs-identifier hs-var">hpc_info</span></a></span></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>     </span><span class="hs-comment">-- cg: run the code generator, and yield the resulting CmmGroup</span><span>
</span><span id="line-87"></span><span>              </span><span class="hs-comment">-- Using an IORef to store the state is a bit crude, but otherwise</span><span>
</span><span id="line-88"></span><span>              </span><span class="hs-comment">-- we would need to add a state monad layer which regresses</span><span>
</span><span id="line-89"></span><span>              </span><span class="hs-comment">-- allocations by 0.5-2%.</span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681970763"><span class="annot"><span class="annottext">IORef CgState
</span><a href="#local-6989586621681970763"><span class="hs-identifier hs-var">cgref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef CgState) -&gt; Stream IO CmmGroup (IORef CgState)
forall a. IO a -&gt; Stream IO CmmGroup a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef CgState) -&gt; Stream IO CmmGroup (IORef CgState))
-&gt; IO (IORef CgState) -&gt; Stream IO CmmGroup (IORef CgState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO CgState
</span><a href="GHC.StgToCmm.Monad.html#initC"><span class="hs-identifier hs-var">initC</span></a></span><span> </span><span class="annot"><span class="annottext">IO CgState -&gt; (CgState -&gt; IO (IORef CgState)) -&gt; IO (IORef CgState)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681970766"><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970766"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CgState -&gt; IO (IORef CgState)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970766"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970569"><span class="annot"><a href="#local-6989586621681970768"><span class="hs-identifier hs-type">cg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681970569"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroup"><span class="hs-identifier hs-type">CmmGroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681970569"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-92"></span><span>              </span><span id="local-6989586621681970768"><span class="annot"><span class="annottext">cg :: forall a. FCode a -&gt; Stream IO CmmGroup a
</span><a href="#local-6989586621681970768"><span class="hs-identifier hs-var hs-var">cg</span></a></span></span><span> </span><span id="local-6989586621681970779"><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621681970779"><span class="hs-identifier hs-var">fcode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-93"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681970780"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681970780"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681970781"><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681970781"><span class="hs-identifier hs-var">cmm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (a, CmmGroup) -&gt; Stream IO CmmGroup (a, CmmGroup)
forall a. IO a -&gt; Stream IO CmmGroup a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (a, CmmGroup) -&gt; Stream IO CmmGroup (a, CmmGroup))
-&gt; (IO (a, CmmGroup) -&gt; IO (a, CmmGroup))
-&gt; IO (a, CmmGroup)
-&gt; Stream IO CmmGroup (a, CmmGroup)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; SDoc
-&gt; ((a, CmmGroup) -&gt; ())
-&gt; IO (a, CmmGroup)
-&gt; IO (a, CmmGroup)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTimingSilent"><span class="hs-identifier hs-var">withTimingSilent</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681970753"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;STG -&gt; Cmm&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, CmmGroup) -&gt; () -&gt; ()
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (a, CmmGroup) -&gt; Stream IO CmmGroup (a, CmmGroup))
-&gt; IO (a, CmmGroup) -&gt; Stream IO CmmGroup (a, CmmGroup)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>                         </span><span id="local-6989586621681970785"><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970785"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef CgState -&gt; IO CgState
forall a. IORef a -&gt; IO a
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#readIORef/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CgState
</span><a href="#local-6989586621681970763"><span class="hs-identifier hs-var">cgref</span></a></span><span>
</span><span id="line-95"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970787"><span class="annot"><span class="annottext">fstate :: FCodeState
</span><a href="#local-6989586621681970787"><span class="hs-identifier hs-var hs-var">fstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; FCodeState
</span><a href="GHC.StgToCmm.Monad.html#initFCodeState"><span class="hs-identifier hs-var">initFCodeState</span></a></span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; FCodeState) -&gt; Platform -&gt; FCodeState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Platform
</span><a href="GHC.StgToCmm.Config.html#stgToCmmPlatform"><span class="hs-identifier hs-var">stgToCmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970755"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-96"></span><span>                         </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681970790"><span class="annot"><span class="annottext">(a, CmmGroup)
</span><a href="#local-6989586621681970790"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681970791"><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970791"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; FCodeState
-&gt; CgState
-&gt; FCode (a, CmmGroup)
-&gt; ((a, CmmGroup), CgState)
forall a.
StgToCmmConfig -&gt; FCodeState -&gt; CgState -&gt; FCode a -&gt; (a, CgState)
</span><a href="GHC.StgToCmm.Monad.html#runC"><span class="hs-identifier hs-var">runC</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970755"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">FCodeState
</span><a href="#local-6989586621681970787"><span class="hs-identifier hs-var">fstate</span></a></span><span> </span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970785"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FCode a -&gt; FCode (a, CmmGroup)
forall a. FCode a -&gt; FCode (a, CmmGroup)
</span><a href="GHC.StgToCmm.Monad.html#getCmm"><span class="hs-identifier hs-var">getCmm</span></a></span><span> </span><span class="annot"><span class="annottext">FCode a
</span><a href="#local-6989586621681970779"><span class="hs-identifier hs-var">fcode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>                         </span><span class="hs-comment">-- NB. stub-out cgs_tops and cgs_stmts.  This fixes</span><span>
</span><span id="line-99"></span><span>                         </span><span class="hs-comment">-- a big space leak.  DO NOT REMOVE!</span><span>
</span><span id="line-100"></span><span>                         </span><span class="hs-comment">-- This is observed by the #3294 test</span><span>
</span><span id="line-101"></span><span>                         </span><span class="annot"><span class="annottext">IORef CgState -&gt; CgState -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#writeIORef/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CgState
</span><a href="#local-6989586621681970763"><span class="hs-identifier hs-var">cgref</span></a></span><span> </span><span class="annot"><span class="annottext">(CgState -&gt; IO ()) -&gt; CgState -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970791"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#cgs_tops"><span class="hs-identifier hs-var">cgs_tops</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.OrdList.html#nilOL"><span class="hs-identifier hs-type">nilOL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#cgs_stmts"><span class="hs-identifier hs-var">cgs_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Cmm.Graph.html#mkNop"><span class="hs-identifier hs-type">mkNop</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>                         </span><span class="annot"><span class="annottext">(a, CmmGroup) -&gt; IO (a, CmmGroup)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(a, CmmGroup)
</span><a href="#local-6989586621681970790"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-103"></span><span>                </span><span class="annot"><span class="annottext">CmmGroup -&gt; Stream IO CmmGroup ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Stream m a ()
</span><a href="GHC.Data.Stream.html#yield"><span class="hs-identifier hs-var">yield</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681970781"><span class="hs-identifier hs-var">cmm</span></a></span><span>
</span><span id="line-104"></span><span>                </span><span class="annot"><span class="annottext">a -&gt; Stream IO CmmGroup a
forall a. a -&gt; Stream IO CmmGroup a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681970780"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>               </span><span class="hs-comment">-- Note [codegen-split-init] the cmm_init block must come</span><span>
</span><span id="line-107"></span><span>               </span><span class="hs-comment">-- FIRST.  This is because when -split-objs is on we need to</span><span>
</span><span id="line-108"></span><span>               </span><span class="hs-comment">-- combine this block with its initialisation routines; see</span><span>
</span><span id="line-109"></span><span>               </span><span class="hs-comment">-- Note [pipeline-split-init].</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; Stream IO CmmGroup ()
forall a. FCode a -&gt; Stream IO CmmGroup a
</span><a href="#local-6989586621681970768"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectedCCs -&gt; Module -&gt; HpcInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#mkModuleInit"><span class="hs-identifier hs-var">mkModuleInit</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681970760"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Module
</span><a href="GHC.StgToCmm.Config.html#stgToCmmThisModule"><span class="hs-identifier hs-var">stgToCmmThisModule</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970755"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681970762"><span class="hs-identifier hs-var">hpc_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(CgStgTopBinding -&gt; Stream IO CmmGroup ())
-&gt; [CgStgTopBinding] -&gt; Stream IO CmmGroup ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FCode () -&gt; Stream IO CmmGroup ()
forall a. FCode a -&gt; Stream IO CmmGroup a
</span><a href="#local-6989586621681970768"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; Stream IO CmmGroup ())
-&gt; (CgStgTopBinding -&gt; FCode ())
-&gt; CgStgTopBinding
-&gt; Stream IO CmmGroup ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; StgToCmmConfig -&gt; CgStgTopBinding -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgTopBinding"><span class="hs-identifier hs-var">cgTopBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681970753"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681970754"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970755"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681970761"><span class="hs-identifier hs-var">stg_binds</span></a></span><span>
</span><span id="line-113"></span><span>                </span><span class="hs-comment">-- Put datatype_stuff after code_stuff, because the</span><span>
</span><span id="line-114"></span><span>                </span><span class="hs-comment">-- datatype closure table (for enumeration types) to</span><span>
</span><span id="line-115"></span><span>                </span><span class="hs-comment">-- (say) PrelBase_True_closure, which is defined in</span><span>
</span><span id="line-116"></span><span>                </span><span class="hs-comment">-- code_stuff</span><span>
</span><span id="line-117"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970810"><span class="annot"><span class="annottext">do_tycon :: TyCon -&gt; Stream IO CmmGroup ()
</span><a href="#local-6989586621681970810"><span class="hs-identifier hs-var hs-var">do_tycon</span></a></span></span><span> </span><span id="local-6989586621681970811"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681970811"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>                </span><span class="hs-comment">-- Generate a table of static closures for an</span><span>
</span><span id="line-119"></span><span>                </span><span class="hs-comment">-- enumeration type Note that the closure pointers are</span><span>
</span><span id="line-120"></span><span>                </span><span class="hs-comment">-- tagged.</span><span>
</span><span id="line-121"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Stream IO CmmGroup () -&gt; Stream IO CmmGroup ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681970811"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Stream IO CmmGroup () -&gt; Stream IO CmmGroup ())
-&gt; Stream IO CmmGroup () -&gt; Stream IO CmmGroup ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; Stream IO CmmGroup ()
forall a. FCode a -&gt; Stream IO CmmGroup a
</span><a href="#local-6989586621681970768"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgEnumerationTyCon"><span class="hs-identifier hs-var">cgEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681970811"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>                 </span><span class="hs-comment">-- Emit normal info_tables, for data constructors defined in this module.</span><span>
</span><span id="line-123"></span><span>                 </span><span class="annot"><span class="annottext">(DataCon -&gt; Stream IO CmmGroup ())
-&gt; [DataCon] -&gt; Stream IO CmmGroup ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FCode () -&gt; Stream IO CmmGroup ()
forall a. FCode a -&gt; Stream IO CmmGroup a
</span><a href="#local-6989586621681970768"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; Stream IO CmmGroup ())
-&gt; (DataCon -&gt; FCode ()) -&gt; DataCon -&gt; Stream IO CmmGroup ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfoTableLocation -&gt; DataCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-var">cgDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfoTableLocation
</span><a href="GHC.Cmm.CLabel.html#DefinitionSite"><span class="hs-identifier hs-var">DefinitionSite</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681970811"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Stream IO CmmGroup ())
-&gt; [TyCon] -&gt; Stream IO CmmGroup ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Stream IO CmmGroup ()
</span><a href="#local-6989586621681970810"><span class="hs-identifier hs-var">do_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681970759"><span class="hs-identifier hs-var">data_tycons</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-comment">-- Emit special info tables for everything used in this module</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-comment">-- This will only do something if  `-fdistinct-info-tables` is turned on.</span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">((DataCon, NonEmpty (WordOff, Maybe IpeSourceLocation))
 -&gt; Stream IO CmmGroup ())
-&gt; [(DataCon, NonEmpty (WordOff, Maybe IpeSourceLocation))]
-&gt; Stream IO CmmGroup ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#mapM_/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681970817"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970817"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681970818"><span class="annot"><span class="annottext">NonEmpty (WordOff, Maybe IpeSourceLocation)
</span><a href="#local-6989586621681970818"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (WordOff, Maybe IpeSourceLocation)
-&gt; ((WordOff, Maybe IpeSourceLocation) -&gt; Stream IO CmmGroup ())
-&gt; Stream IO CmmGroup ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#forM_/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (WordOff, Maybe IpeSourceLocation)
</span><a href="#local-6989586621681970818"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">(((WordOff, Maybe IpeSourceLocation) -&gt; Stream IO CmmGroup ())
 -&gt; Stream IO CmmGroup ())
-&gt; ((WordOff, Maybe IpeSourceLocation) -&gt; Stream IO CmmGroup ())
-&gt; Stream IO CmmGroup ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681970819"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970819"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681970820"><span class="annot"><span class="annottext">Maybe IpeSourceLocation
</span><a href="#local-6989586621681970820"><span class="hs-identifier hs-var">_ss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FCode () -&gt; Stream IO CmmGroup ()
forall a. FCode a -&gt; Stream IO CmmGroup a
</span><a href="#local-6989586621681970768"><span class="hs-identifier hs-var">cg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConInfoTableLocation -&gt; DataCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-var">cgDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; WordOff -&gt; ConInfoTableLocation
</span><a href="GHC.Cmm.CLabel.html#UsageSite"><span class="hs-identifier hs-var">UsageSite</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Module
</span><a href="GHC.StgToCmm.Config.html#stgToCmmThisModule"><span class="hs-identifier hs-var">stgToCmmThisModule</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970755"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970819"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970817"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM
  DataCon (DataCon, NonEmpty (WordOff, Maybe IpeSourceLocation))
-&gt; [(DataCon, NonEmpty (WordOff, Maybe IpeSourceLocation))]
forall key elt. UniqFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.FM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM
  DataCon (DataCon, NonEmpty (WordOff, Maybe IpeSourceLocation))
</span><a href="#local-6989586621681970758"><span class="hs-identifier hs-var">denv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681970823"><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970823"><span class="hs-identifier hs-var">final_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CgState -&gt; Stream IO CmmGroup CgState
forall a. IO a -&gt; Stream IO CmmGroup a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef CgState -&gt; IO CgState
forall a. IORef a -&gt; IO a
</span><a href="../../base-4.18.3.0/src/GHC.IORef.html#readIORef/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CgState
</span><a href="#local-6989586621681970763"><span class="hs-identifier hs-var">cgref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970824"><span class="annot"><span class="annottext">cg_id_infos :: CgBindings
</span><a href="#local-6989586621681970824"><span class="hs-identifier hs-var hs-var">cg_id_infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgState -&gt; CgBindings
</span><a href="GHC.StgToCmm.Monad.html#cgs_binds"><span class="hs-identifier hs-var">cgs_binds</span></a></span><span> </span><span class="annot"><span class="annottext">CgState
</span><a href="#local-6989586621681970823"><span class="hs-identifier hs-var">final_state</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>          </span><span class="hs-comment">-- See Note [Conveying CAF-info and LFInfo between modules] in</span><span>
</span><span id="line-135"></span><span>          </span><span class="hs-comment">-- GHC.StgToCmm.Types</span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970826"><span class="annot"><span class="annottext">extractInfo :: CgIdInfo -&gt; (Name, LambdaFormInfo)
</span><a href="#local-6989586621681970826"><span class="hs-identifier hs-var hs-var">extractInfo</span></a></span></span><span> </span><span id="local-6989586621681970827"><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621681970827"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681970828"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="#local-6989586621681970829"><span class="hs-identifier hs-var">lf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>                  </span><span class="hs-glyph">!</span><span id="local-6989586621681970828"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681970828"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgIdInfo -&gt; Var
</span><a href="GHC.StgToCmm.Monad.html#cg_id"><span class="hs-identifier hs-var">cg_id</span></a></span><span> </span><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621681970827"><span class="hs-identifier hs-var">info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>                  </span><span class="hs-glyph">!</span><span id="local-6989586621681970829"><span class="annot"><span class="annottext">lf :: LambdaFormInfo
</span><a href="#local-6989586621681970829"><span class="hs-identifier hs-var hs-var">lf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgIdInfo -&gt; LambdaFormInfo
</span><a href="GHC.StgToCmm.Monad.html#cg_lf"><span class="hs-identifier hs-var">cg_lf</span></a></span><span> </span><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621681970827"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>              </span><span class="hs-glyph">!</span><span id="local-6989586621681970833"><span class="annot"><span class="annottext">generatedInfo :: ModuleLFInfos
</span><a href="#local-6989586621681970833"><span class="hs-identifier hs-var hs-var">generatedInfo</span></a></span></span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Bool
</span><a href="GHC.StgToCmm.Config.html#stgToCmmOmitIfPragmas"><span class="hs-identifier hs-var">stgToCmmOmitIfPragmas</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970755"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-143"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-144"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-145"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, LambdaFormInfo)] -&gt; ModuleLFInfos
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CgIdInfo -&gt; (Name, LambdaFormInfo))
-&gt; [CgIdInfo] -&gt; [(Name, LambdaFormInfo)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">Prelude.map</span></a></span><span> </span><span class="annot"><span class="annottext">CgIdInfo -&gt; (Name, LambdaFormInfo)
</span><a href="#local-6989586621681970826"><span class="hs-identifier hs-var">extractInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgBindings -&gt; [CgIdInfo]
forall key elt. UniqFM key elt -&gt; [elt]
</span><a href="GHC.Types.Unique.FM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">CgBindings
</span><a href="#local-6989586621681970824"><span class="hs-identifier hs-var">cg_id_infos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos -&gt; Stream IO CmmGroup ModuleLFInfos
forall a. a -&gt; Stream IO CmmGroup a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621681970833"><span class="hs-identifier hs-var">generatedInfo</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-151"></span><span class="hs-comment">--      Top-level bindings</span><span>
</span><span id="line-152"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">{- 'cgTopBinding' is only used for top-level bindings, since they need
to be allocated statically (not in the heap) and need to be labelled.
No unboxed bindings can happen at top level.

In the code below, the static bindings are accumulated in the
@MkCgState@, and transferred into the ``statics'' slot by @forkStatics@.
This is so that we can write the top level processing in a compositional
style, with the increasing static environment being plumbed as a state
variable. -}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="annot"><a href="GHC.StgToCmm.html#cgTopBinding"><span class="hs-identifier hs-type">cgTopBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgTopBinding"><span class="hs-identifier hs-type">CgStgTopBinding</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span id="cgTopBinding"><span class="annot"><span class="annottext">cgTopBinding :: Logger -&gt; TmpFs -&gt; StgToCmmConfig -&gt; CgStgTopBinding -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgTopBinding"><span class="hs-identifier hs-var hs-var">cgTopBinding</span></a></span></span><span> </span><span id="local-6989586621681970837"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681970837"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681970838"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681970838"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621681970839"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970839"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-type">StgNonRec</span></a></span><span> </span><span id="local-6989586621681970842"><span class="annot"><span class="annottext">BinderP 'CodeGen
</span><a href="#local-6989586621681970842"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681970843"><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621681970843"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-167"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681970844"><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621681970844"><span class="hs-identifier hs-var">info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681970845"><span class="annot"><span class="annottext">FCode ()
</span><a href="#local-6989586621681970845"><span class="hs-identifier hs-var">fcode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; RecFlag -&gt; Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var">cgTopRhs</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970839"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">Var
BinderP 'CodeGen
</span><a href="#local-6989586621681970842"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgRhs 'CodeGen
</span><a href="#local-6989586621681970843"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><span class="annottext">FCode ()
</span><a href="#local-6989586621681970845"><span class="hs-identifier hs-var">fcode</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">CgIdInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Env.html#addBindC"><span class="hs-identifier hs-var">addBindC</span></a></span><span> </span><span class="annot"><span class="annottext">CgIdInfo
</span><a href="#local-6989586621681970844"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-type">StgTopLifted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-type">StgRec</span></a></span><span> </span><span id="local-6989586621681970850"><span class="annot"><span class="annottext">[(BinderP 'CodeGen, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621681970850"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681970851"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681970851"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681970852"><span class="annot"><span class="annottext">[GenStgRhs 'CodeGen]
</span><a href="#local-6989586621681970852"><span class="hs-identifier hs-var">rhss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Var, GenStgRhs 'CodeGen)] -&gt; ([Var], [GenStgRhs 'CodeGen])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.3.0/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Var, GenStgRhs 'CodeGen)]
[(BinderP 'CodeGen, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621681970850"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970854"><span class="annot"><span class="annottext">pairs' :: [(Var, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621681970854"><span class="hs-identifier hs-var hs-var">pairs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [GenStgRhs 'CodeGen] -&gt; [(Var, GenStgRhs 'CodeGen)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681970851"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[GenStgRhs 'CodeGen]
</span><a href="#local-6989586621681970852"><span class="hs-identifier hs-var">rhss</span></a></span><span>
</span><span id="line-174"></span><span>            </span><span id="local-6989586621681970855"><span class="annot"><span class="annottext">r :: [(CgIdInfo, FCode ())]
</span><a href="#local-6989586621681970855"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ()))
-&gt; [(Var, GenStgRhs 'CodeGen)] -&gt; [(CgIdInfo, FCode ())]
forall a b c. (a -&gt; b -&gt; c) -&gt; [(a, b)] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#unzipWith"><span class="hs-identifier hs-var">unzipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; RecFlag -&gt; Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var">cgTopRhs</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970839"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="GHC.Types.Basic.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, GenStgRhs 'CodeGen)]
</span><a href="#local-6989586621681970854"><span class="hs-identifier hs-var">pairs'</span></a></span><span>
</span><span id="line-175"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681970858"><span class="annot"><span class="annottext">[CgIdInfo]
</span><a href="#local-6989586621681970858"><span class="hs-identifier hs-var">infos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681970859"><span class="annot"><span class="annottext">[FCode ()]
</span><a href="#local-6989586621681970859"><span class="hs-identifier hs-var">fcodes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CgIdInfo, FCode ())] -&gt; ([CgIdInfo], [FCode ()])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.3.0/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(CgIdInfo, FCode ())]
</span><a href="#local-6989586621681970855"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">[CgIdInfo] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Env.html#addBindsC"><span class="hs-identifier hs-var">addBindsC</span></a></span><span> </span><span class="annot"><span class="annottext">[CgIdInfo]
</span><a href="#local-6989586621681970858"><span class="hs-identifier hs-var">infos</span></a></span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">[FCode ()] -&gt; FCode ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#sequence_/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="annot"><span class="annottext">[FCode ()]
</span><a href="#local-6989586621681970859"><span class="hs-identifier hs-var">fcodes</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-type">StgTopStringLit</span></a></span><span> </span><span id="local-6989586621681970863"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681970863"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681970864"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681970864"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970865"><span class="annot"><span class="annottext">label :: CLabel
</span><a href="#local-6989586621681970865"><span class="hs-keyword hs-var hs-var">label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkBytesLabel"><span class="hs-identifier hs-var">mkBytesLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681970863"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-comment">-- emit either a CmmString literal or dump the string in a file and emit a</span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-comment">-- CmmFileEmbed literal.  If binary blobs aren't supported,</span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-comment">-- the threshold in `cfg` will be 0.</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- See Note [Embedding large binary blobs] in GHC.CmmToAsm.Ppr</span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681970867"><span class="annot"><span class="annottext">asString :: Bool
</span><a href="#local-6989586621681970867"><span class="hs-identifier hs-var hs-var">asString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Maybe Word
</span><a href="GHC.StgToCmm.Config.html#stgToCmmBinBlobThresh"><span class="hs-identifier hs-var">stgToCmmBinBlobThresh</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970839"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-186"></span><span>              </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681970869"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681970869"><span class="hs-identifier hs-var">bin_blob_threshold</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Real.html#fromIntegral/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; WordOff
</span><a href="../../bytestring-0.11.5.4/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">BS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681970864"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621681970869"><span class="hs-identifier hs-var">bin_blob_threshold</span></a></span><span>
</span><span id="line-187"></span><span>              </span><span class="annot"><span class="annottext">Maybe Word
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681970872"><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621681970872"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681970873"><span class="annot"><span class="annottext">CmmDecl
</span><a href="#local-6989586621681970873"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681970867"><span class="hs-identifier hs-var">asString</span></a></span><span>
</span><span id="line-190"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; ByteString -&gt; (CmmLit, CmmDecl)
forall (raw :: Bool) info stmt.
CLabel
-&gt; ByteString -&gt; (CmmLit, GenCmmDecl (GenCmmStatics raw) info stmt)
</span><a href="GHC.Cmm.Utils.html#mkByteStringCLit"><span class="hs-identifier hs-var">mkByteStringCLit</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681970865"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681970864"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-191"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">IO (CmmLit, CmmDecl) -&gt; (CmmLit, CmmDecl)
forall a. IO a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.IO.Unsafe.html#unsafePerformIO/GHC.IO.Unsafe.html#unsafePerformIO"><span class="hs-identifier hs-var">unsafePerformIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (CmmLit, CmmDecl) -&gt; (CmmLit, CmmDecl))
-&gt; IO (CmmLit, CmmDecl) -&gt; (CmmLit, CmmDecl)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>                     </span><span id="local-6989586621681970876"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681970876"><span class="hs-identifier hs-var">bFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681970837"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621681970838"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; TempDir
</span><a href="GHC.StgToCmm.Config.html#stgToCmmTmpDir"><span class="hs-identifier hs-var">stgToCmmTmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970839"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.dat&quot;</span></span><span>
</span><span id="line-193"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; ByteString -&gt; IO ()
</span><a href="../../bytestring-0.11.5.4/src/Data.ByteString.html#writeFile/Data.ByteString.html#writeFile"><span class="hs-identifier hs-var">BS.writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681970876"><span class="hs-identifier hs-var">bFile</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681970864"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-194"></span><span>                     </span><span class="annot"><span class="annottext">(CmmLit, CmmDecl) -&gt; IO (CmmLit, CmmDecl)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">((CmmLit, CmmDecl) -&gt; IO (CmmLit, CmmDecl))
-&gt; (CmmLit, CmmDecl) -&gt; IO (CmmLit, CmmDecl)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; String -&gt; WordOff -&gt; (CmmLit, CmmDecl)
forall (raw :: Bool) info stmt.
CLabel
-&gt; String
-&gt; WordOff
-&gt; (CmmLit, GenCmmDecl (GenCmmStatics raw) info stmt)
</span><a href="GHC.Cmm.Utils.html#mkFileEmbedLit"><span class="hs-identifier hs-var">mkFileEmbedLit</span></a></span><span> </span><span class="annot"><span class="annottext">CLabel
</span><a href="#local-6989586621681970865"><span class="hs-keyword hs-var">label</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681970876"><span class="hs-identifier hs-var">bFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; WordOff
</span><a href="../../bytestring-0.11.5.4/src/Data.ByteString.html#length/Data.ByteString.html#length"><span class="hs-identifier hs-var">BS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681970864"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">CmmDecl -&gt; FCode ()
</span><a href="GHC.StgToCmm.Monad.html#emitDecl"><span class="hs-identifier hs-var">emitDecl</span></a></span><span> </span><span class="annot"><span class="annottext">CmmDecl
</span><a href="#local-6989586621681970873"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">CgIdInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Env.html#addBindC"><span class="hs-identifier hs-var">addBindC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Var -&gt; LambdaFormInfo -&gt; CmmLit -&gt; CgIdInfo
</span><a href="GHC.StgToCmm.Env.html#litIdInfo"><span class="hs-identifier hs-var">litIdInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Platform
</span><a href="GHC.StgToCmm.Config.html#stgToCmmPlatform"><span class="hs-identifier hs-var">stgToCmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970839"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681970863"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaFormInfo
</span><a href="GHC.StgToCmm.Closure.html#mkLFStringLit"><span class="hs-identifier hs-var">mkLFStringLit</span></a></span><span> </span><span class="annot"><span class="annottext">CmmLit
</span><a href="#local-6989586621681970872"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="annot"><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-type">cgTopRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Config.html#StgToCmmConfig"><span class="hs-identifier hs-type">StgToCmmConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#RecFlag"><span class="hs-identifier hs-type">RecFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#CgStgRhs"><span class="hs-identifier hs-type">CgStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Monad.html#CgIdInfo"><span class="hs-identifier hs-type">CgIdInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-comment">-- The Id is passed along for setting up a binding...</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="cgTopRhs"><span class="annot"><span class="annottext">cgTopRhs :: StgToCmmConfig
-&gt; RecFlag -&gt; Var -&gt; GenStgRhs 'CodeGen -&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var hs-var">cgTopRhs</span></a></span></span><span> </span><span id="local-6989586621681970887"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970887"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621681970888"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621681970888"><span class="hs-identifier hs-var">_rec</span></a></span></span><span> </span><span id="local-6989586621681970889"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681970889"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-type">StgRhsCon</span></a></span><span> </span><span id="local-6989586621681970891"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681970891"><span class="hs-identifier hs-var">_cc</span></a></span></span><span> </span><span id="local-6989586621681970892"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970892"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681970893"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681970893"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621681970894"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681970894"><span class="hs-identifier hs-var">_ts</span></a></span></span><span> </span><span id="local-6989586621681970895"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681970895"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
-&gt; Var
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [NonVoid StgArg]
-&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.DataCon.html#cgTopRhsCon"><span class="hs-identifier hs-var">cgTopRhsCon</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970887"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681970889"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970892"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681970893"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg] -&gt; [NonVoid StgArg]
</span><a href="GHC.StgToCmm.Closure.html#assertNonVoidStgArgs"><span class="hs-identifier hs-var">assertNonVoidStgArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681970895"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>      </span><span class="hs-comment">-- con args are always non-void,</span><span>
</span><span id="line-205"></span><span>      </span><span class="hs-comment">-- see Note [Post-unarisation invariants] in GHC.Stg.Unarise</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="annot"><a href="GHC.StgToCmm.html#cgTopRhs"><span class="hs-identifier hs-var">cgTopRhs</span></a></span><span> </span><span id="local-6989586621681970898"><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970898"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621681970899"><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621681970899"><span class="hs-identifier hs-var">rec</span></a></span></span><span> </span><span id="local-6989586621681970900"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681970900"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-type">StgRhsClosure</span></a></span><span> </span><span id="local-6989586621681970902"><span class="annot"><span class="annottext">XRhsClosure 'CodeGen
</span><a href="#local-6989586621681970902"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681970903"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681970903"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621681970904"><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681970904"><span class="hs-identifier hs-var">upd_flag</span></a></span></span><span> </span><span id="local-6989586621681970905"><span class="annot"><span class="annottext">[BinderP 'CodeGen]
</span><a href="#local-6989586621681970905"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681970906"><span class="annot"><span class="annottext">GenStgExpr 'CodeGen
</span><a href="#local-6989586621681970906"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; (CgIdInfo, FCode ()) -&gt; (CgIdInfo, FCode ())
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DIdSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyDVarSet"><span class="hs-identifier hs-var">isEmptyDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
XRhsClosure 'CodeGen
</span><a href="#local-6989586621681970902"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fvs:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
XRhsClosure 'CodeGen
</span><a href="#local-6989586621681970902"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((CgIdInfo, FCode ()) -&gt; (CgIdInfo, FCode ()))
-&gt; (CgIdInfo, FCode ()) -&gt; (CgIdInfo, FCode ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>   </span><span class="hs-comment">-- There should be no free variables</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><span class="annottext">Platform
-&gt; RecFlag
-&gt; Var
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [Var]
-&gt; GenStgExpr 'CodeGen
-&gt; (CgIdInfo, FCode ())
</span><a href="GHC.StgToCmm.Bind.html#cgTopRhsClosure"><span class="hs-identifier hs-var">cgTopRhsClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgToCmmConfig -&gt; Platform
</span><a href="GHC.StgToCmm.Config.html#stgToCmmPlatform"><span class="hs-identifier hs-var">stgToCmmPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">StgToCmmConfig
</span><a href="#local-6989586621681970898"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RecFlag
</span><a href="#local-6989586621681970899"><span class="hs-identifier hs-var">rec</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681970900"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681970903"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681970904"><span class="hs-identifier hs-var">upd_flag</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
[BinderP 'CodeGen]
</span><a href="#local-6989586621681970905"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr 'CodeGen
</span><a href="#local-6989586621681970906"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-213"></span><span class="hs-comment">--      Module initialisation code</span><span>
</span><span id="line-214"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="annot"><a href="GHC.StgToCmm.html#mkModuleInit"><span class="hs-identifier hs-type">mkModuleInit</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>         </span><span class="hs-comment">-- cost centre info</span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.HpcInfo.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span id="mkModuleInit"><span class="annot"><span class="annottext">mkModuleInit :: CollectedCCs -&gt; Module -&gt; HpcInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#mkModuleInit"><span class="hs-identifier hs-var hs-var">mkModuleInit</span></a></span></span><span> </span><span id="local-6989586621681970910"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681970910"><span class="hs-identifier hs-var">cost_centre_info</span></a></span></span><span> </span><span id="local-6989586621681970911"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681970911"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681970912"><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681970912"><span class="hs-identifier hs-var">hpc_info</span></a></span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Module -&gt; HpcInfo -&gt; FCode ()
</span><a href="GHC.StgToCmm.Hpc.html#initHpc"><span class="hs-identifier hs-var">initHpc</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681970911"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681970912"><span class="hs-identifier hs-var">hpc_info</span></a></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CollectedCCs -&gt; FCode ()
</span><a href="GHC.StgToCmm.Prof.html#initCostCentres"><span class="hs-identifier hs-var">initCostCentres</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681970910"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-229"></span><span class="hs-comment">--      Generating static stuff for algebraic data types</span><span>
</span><span id="line-230"></span><span class="hs-comment">---------------------------------------------------------------</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><a href="GHC.StgToCmm.html#cgEnumerationTyCon"><span class="hs-identifier hs-type">cgEnumerationTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span id="cgEnumerationTyCon"><span class="annot"><span class="annottext">cgEnumerationTyCon :: TyCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgEnumerationTyCon"><span class="hs-identifier hs-var hs-var">cgEnumerationTyCon</span></a></span></span><span> </span><span id="local-6989586621681970914"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681970914"><span class="hs-identifier hs-var">tycon</span></a></span></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681970915"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681970915"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-236"></span><span>       </span><span class="annot"><span class="annottext">CLabel -&gt; [CmmLit] -&gt; FCode ()
</span><a href="GHC.StgToCmm.Utils.html#emitRODataLits"><span class="hs-identifier hs-var">emitRODataLits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CafInfo -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkClosureTableLabel"><span class="hs-identifier hs-var">mkClosureTableLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681970914"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>             </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CLabel -&gt; WordOff -&gt; CmmLit
</span><a href="GHC.Cmm.Expr.html#CmmLabelOff"><span class="hs-identifier hs-var">CmmLabelOff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CafInfo -&gt; CLabel
</span><a href="GHC.Cmm.CLabel.html#mkClosureLabel"><span class="hs-identifier hs-var">mkClosureLabel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970924"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CafInfo
</span><a href="GHC.Types.Id.Info.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; DataCon -&gt; WordOff
</span><a href="GHC.StgToCmm.Closure.html#tagForCon"><span class="hs-identifier hs-var">tagForCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681970915"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970924"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681970924"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970924"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681970914"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="annot"><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-type">cgDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Cmm.CLabel.html#ConInfoTableLocation"><span class="hs-identifier hs-type">ConInfoTableLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Monad.html#FCode"><span class="hs-identifier hs-type">FCode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- Generate the entry code, info tables, and (for niladic constructor)</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- the static closure, for a constructor.</span><span>
</span><span id="line-245"></span><span id="cgDataCon"><span class="annot"><span class="annottext">cgDataCon :: ConInfoTableLocation -&gt; DataCon -&gt; FCode ()
</span><a href="GHC.StgToCmm.html#cgDataCon"><span class="hs-identifier hs-var hs-var">cgDataCon</span></a></span></span><span> </span><span id="local-6989586621681970926"><span class="annot"><span class="annottext">ConInfoTableLocation
</span><a href="#local-6989586621681970926"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621681970927"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970927"><span class="hs-identifier hs-var">data_con</span></a></span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FCode ()
forall (m :: * -&gt; *). (HasCallStack, Applicative m) =&gt; Bool -&gt; m ()
</span><a href="GHC.Utils.Panic.Plain.html#massert"><span class="hs-identifier hs-var">massert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970927"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970927"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681970933"><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681970933"><span class="hs-identifier hs-var">profile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Profile
</span><a href="GHC.StgToCmm.Monad.html#getProfile"><span class="hs-identifier hs-var">getProfile</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681970935"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681970935"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FCode Platform
</span><a href="GHC.StgToCmm.Monad.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681970936"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970936"><span class="hs-identifier hs-var">tot_wds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">--  #ptr_wds + #nonptr_wds</span><span>
</span><span id="line-251"></span><span>             </span><span id="local-6989586621681970937"><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970937"><span class="hs-identifier hs-var">ptr_wds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  #ptr_wds</span><span>
</span><span id="line-252"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Profile -&gt; [NonVoid PrimRep] -&gt; (WordOff, WordOff)
</span><a href="GHC.StgToCmm.Layout.html#mkVirtConstrSizes"><span class="hs-identifier hs-var">mkVirtConstrSizes</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681970933"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">[NonVoid PrimRep]
</span><a href="#local-6989586621681970939"><span class="hs-identifier hs-var">arg_reps</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>            </span><span id="local-6989586621681970940"><span class="annot"><span class="annottext">nonptr_wds :: WordOff
</span><a href="#local-6989586621681970940"><span class="hs-identifier hs-var hs-var">nonptr_wds</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970936"><span class="hs-identifier hs-var">tot_wds</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; WordOff -&gt; WordOff
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970937"><span class="hs-identifier hs-var">ptr_wds</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>            </span><span id="local-6989586621681970941"><span class="annot"><span class="annottext">dyn_info_tbl :: CmmInfoTable
</span><a href="#local-6989586621681970941"><span class="hs-identifier hs-var hs-var">dyn_info_tbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>              </span><span class="annot"><span class="annottext">Profile
-&gt; DataCon
-&gt; ConInfoTableLocation
-&gt; Bool
-&gt; WordOff
-&gt; WordOff
-&gt; CmmInfoTable
</span><a href="GHC.StgToCmm.Closure.html#mkDataConInfoTable"><span class="hs-identifier hs-var">mkDataConInfoTable</span></a></span><span> </span><span class="annot"><span class="annottext">Profile
</span><a href="#local-6989586621681970933"><span class="hs-identifier hs-var">profile</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970927"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">ConInfoTableLocation
</span><a href="#local-6989586621681970926"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970937"><span class="hs-identifier hs-var">ptr_wds</span></a></span><span> </span><span class="annot"><span class="annottext">WordOff
</span><a href="#local-6989586621681970940"><span class="hs-identifier hs-var">nonptr_wds</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>            </span><span class="hs-comment">-- We're generating info tables, so we don't know and care about</span><span>
</span><span id="line-260"></span><span>            </span><span class="hs-comment">-- what the actual arguments are. Using () here as the place holder.</span><span>
</span><span id="line-261"></span><span>            </span><span class="annot"><a href="#local-6989586621681970939"><span class="hs-identifier hs-type">arg_reps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-type">NonVoid</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#PrimRep"><span class="hs-identifier hs-type">PrimRep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>            </span><span id="local-6989586621681970939"><span class="annot"><span class="annottext">arg_reps :: [NonVoid PrimRep]
</span><a href="#local-6989586621681970939"><span class="hs-identifier hs-var hs-var">arg_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; NonVoid PrimRep
forall a. a -&gt; NonVoid a
</span><a href="GHC.StgToCmm.Closure.html#NonVoid"><span class="hs-identifier hs-var">NonVoid</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681970944"><span class="hs-identifier hs-var">rep_ty</span></a></span><span>
</span><span id="line-263"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681970945"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681970945"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConRepArgTys"><span class="hs-identifier hs-var">dataConRepArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970927"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-264"></span><span>                       </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681970944"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681970944"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Type -&gt; [PrimRep]
Type -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681970945"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVoidRep"><span class="hs-identifier hs-var">isVoidRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681970944"><span class="hs-identifier hs-var">rep_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; CmmInfoTable -&gt; Convention -&gt; [LocalReg] -&gt; FCode () -&gt; FCode ()
</span><a href="GHC.StgToCmm.Layout.html#emitClosureAndInfoTable"><span class="hs-identifier hs-var">emitClosureAndInfoTable</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681970935"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">CmmInfoTable
</span><a href="#local-6989586621681970941"><span class="hs-identifier hs-var">dyn_info_tbl</span></a></span><span> </span><span class="annot"><span class="annottext">Convention
</span><a href="GHC.Cmm.Node.html#NativeDirectCall"><span class="hs-identifier hs-var">NativeDirectCall</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(FCode () -&gt; FCode ()) -&gt; FCode () -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-comment">-- NB: the closure pointer is assumed *untagged* on</span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-comment">-- entry to a constructor.  If the pointer is tagged,</span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-comment">-- then we should not be entering it.  This assumption</span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-comment">-- is used in ldvEnter and when tagging the pointer to</span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-comment">-- return it.</span><span>
</span><span id="line-273"></span><span>            </span><span class="hs-comment">-- NB 2: We don't set CC when entering data (WDP 94/06)</span><span>
</span><span id="line-274"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyEnterDynCon"><span class="hs-identifier hs-var">tickyEnterDynCon</span></a></span><span>
</span><span id="line-275"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CmmExpr -&gt; FCode ()
</span><a href="GHC.StgToCmm.Prof.html#ldvEnter"><span class="hs-identifier hs-var">ldvEnter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="GHC.Cmm.Reg.html#nodeReg"><span class="hs-identifier hs-var">nodeReg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WordOff -&gt; FCode ()
</span><a href="GHC.StgToCmm.Ticky.html#tickyReturnOldCon"><span class="hs-identifier hs-var">tickyReturnOldCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NonVoid PrimRep] -&gt; WordOff
forall a. [a] -&gt; WordOff
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; WordOff
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[NonVoid PrimRep]
</span><a href="#local-6989586621681970939"><span class="hs-identifier hs-var">arg_reps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FCode ReturnKind -&gt; FCode ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(FCode ReturnKind -&gt; FCode ()) -&gt; FCode ReturnKind -&gt; FCode ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CmmExpr] -&gt; FCode ReturnKind
</span><a href="GHC.StgToCmm.Layout.html#emitReturn"><span class="hs-identifier hs-var">emitReturn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Platform -&gt; CmmExpr -&gt; WordOff -&gt; CmmExpr
</span><a href="GHC.Cmm.Utils.html#cmmOffsetB"><span class="hs-identifier hs-var">cmmOffsetB</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681970935"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmReg -&gt; CmmExpr
</span><a href="GHC.Cmm.Expr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a></span><span> </span><span class="annot"><span class="annottext">CmmReg
</span><a href="GHC.Cmm.Reg.html#nodeReg"><span class="hs-identifier hs-var">nodeReg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; DataCon -&gt; WordOff
</span><a href="GHC.StgToCmm.Closure.html#tagForCon"><span class="hs-identifier hs-var">tagForCon</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681970935"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681970927"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-279"></span><span>                    </span><span class="hs-comment">-- The case continuation code expects a tagged pointer</span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-281"></span></pre></body></html>