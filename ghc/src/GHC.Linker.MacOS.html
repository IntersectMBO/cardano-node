<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Linker.MacOS</span><span>
</span><span id="line-2"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Linker.MacOS.html#runInjectRPaths"><span class="hs-identifier">runInjectRPaths</span></a></span><span>
</span><span id="line-3"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.MacOS.html#getUnitFrameworkOpts"><span class="hs-identifier">getUnitFrameworkOpts</span></a></span><span>
</span><span id="line-4"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.MacOS.html#getFrameworkOpts"><span class="hs-identifier">getFrameworkOpts</span></a></span><span>
</span><span id="line-5"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Linker.MacOS.html#loadFramework"><span class="hs-identifier">loadFramework</span></a></span><span>
</span><span id="line-6"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Config.html"><span class="hs-identifier">GHC.Linker.Config</span></a></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.html"><span class="hs-identifier">GHC.Settings</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.Tasks.html"><span class="hs-identifier">GHC.SysTools.Tasks</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#isPrefixOf/Data.OldList.html#isPrefixOf"><span class="hs-identifier">isPrefixOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#nub/Data.OldList.html#nub"><span class="hs-identifier">nub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#sort/Data.OldList.html#sort"><span class="hs-identifier">sort</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#intersperse/Data.OldList.html#intersperse"><span class="hs-identifier">intersperse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.OldList.html#intercalate/Data.OldList.html#intercalate"><span class="hs-identifier">intercalate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Char.html#/Data.Char.html"><span class="hs-identifier">Data.Char</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#join/GHC.Base.html#join"><span class="hs-identifier">join</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Traversable.html#forM/Data.Traversable.html#forM"><span class="hs-identifier">forM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#filterM/Control.Monad.html#filterM"><span class="hs-identifier">filterM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.8.5/src/System.Directory.html#/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../directory-1.3.8.5/src/System.Directory.html#doesFileExist/System.Directory.html#doesFileExist"><span class="hs-identifier">doesFileExist</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../directory-1.3.8.5/src/System.Directory.html#getHomeDirectory/System.Directory.html#getHomeDirectory"><span class="hs-identifier">getHomeDirectory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/System.FilePath.html#/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator">(&lt;/&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator">(&lt;.&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#/Text.ParserCombinators.ReadP.html"><span class="hs-identifier">Text.ParserCombinators.ReadP</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parser</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | On macOS we rely on the linkers @-dead_strip_dylibs@ flag to remove unused</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- libraries from the dynamic library.  We do this to reduce the number of load</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- commands that end up in the dylib, and has been limited to 32K (32768) since</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- macOS Sierra (10.14).</span><span>
</span><span id="line-40"></span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- @-dead_strip_dylibs@ does not dead strip @-rpath@ entries, as such passing</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- @-l@ and @-rpath@ to the linker will result in the unnecessary libraries not</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- being included in the load commands, however the @-rpath@ entries are all</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- forced to be included.  This can lead to 100s of @-rpath@ entries being</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- included when only a handful of libraries end up being truly linked.</span><span>
</span><span id="line-46"></span><span class="hs-comment">--</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- Thus after building the library, we run a fixup phase where we inject the</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- @-rpath@ for each found library (in the given library search paths) into the</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- dynamic library through @-add_rpath@.</span><span>
</span><span id="line-50"></span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- See Note [Dynamic linking on macOS]</span><span>
</span><span id="line-52"></span><span class="annot"><a href="GHC.Linker.MacOS.html#runInjectRPaths"><span class="hs-identifier hs-type">runInjectRPaths</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Settings.html#ToolSettings"><span class="hs-identifier hs-type">ToolSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span id="runInjectRPaths"><span class="annot"><span class="annottext">runInjectRPaths :: Logger -&gt; ToolSettings -&gt; [FilePath] -&gt; FilePath -&gt; IO ()
</span><a href="GHC.Linker.MacOS.html#runInjectRPaths"><span class="hs-identifier hs-var hs-var">runInjectRPaths</span></a></span></span><span> </span><span id="local-6989586621681918945"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681918945"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681918946"><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681918946"><span class="hs-identifier hs-var">toolSettings</span></a></span></span><span> </span><span id="local-6989586621681918947"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918947"><span class="hs-identifier hs-var">lib_paths</span></a></span></span><span> </span><span id="local-6989586621681918948"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918948"><span class="hs-identifier hs-var">dylib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621681918949"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918949"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#lines/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; [FilePath]) -&gt; IO FilePath -&gt; IO [FilePath]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; ToolSettings -&gt; Maybe FilePath -&gt; [Option] -&gt; IO FilePath
</span><a href="GHC.SysTools.Tasks.html#askOtool"><span class="hs-identifier hs-var">askOtool</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681918945"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681918946"><span class="hs-identifier hs-var">toolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-L&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918948"><span class="hs-identifier hs-var">dylib</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-comment">-- filter the output for only the libraries. And then drop the @rpath prefix.</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681918954"><span class="annot"><span class="annottext">libs :: [FilePath]
</span><a href="#local-6989586621681918954"><span class="hs-identifier hs-var hs-var">libs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FilePath -&gt; FilePath
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#drop/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [FilePath]) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Bool) -&gt; [FilePath] -&gt; [FilePath]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#isPrefixOf/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;@rpath&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [FilePath]) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath] -&gt; FilePath
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.List.html#head/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span class="annot"><span class="annottext">([FilePath] -&gt; FilePath)
-&gt; (FilePath -&gt; [FilePath]) -&gt; FilePath -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#words/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [FilePath]) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918949"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-comment">-- find any pre-existing LC_PATH items</span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621681918959"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918959"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#lines/Data.OldList.html#lines"><span class="hs-identifier hs-var">lines</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; [FilePath]) -&gt; IO FilePath -&gt; IO [FilePath]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; ToolSettings -&gt; Maybe FilePath -&gt; [Option] -&gt; IO FilePath
</span><a href="GHC.SysTools.Tasks.html#askOtool"><span class="hs-identifier hs-var">askOtool</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681918945"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681918946"><span class="hs-identifier hs-var">toolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-l&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918948"><span class="hs-identifier hs-var">dylib</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681918960"><span class="annot"><span class="annottext">paths :: [FilePath]
</span><a href="#local-6989586621681918960"><span class="hs-identifier hs-var hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Maybe FilePath) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#mapMaybe/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
</span><a href="GHC.Linker.MacOS.html#get_rpath"><span class="hs-identifier hs-var">get_rpath</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918959"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-60"></span><span>      </span><span id="local-6989586621681918963"><span class="annot"><span class="annottext">lib_paths' :: [FilePath]
</span><a href="#local-6989586621681918963"><span class="hs-identifier hs-var hs-var">lib_paths'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918964"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681918964"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918964"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918947"><span class="hs-identifier hs-var">lib_paths</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918964"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918960"><span class="hs-identifier hs-var">paths</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-comment">-- only find those rpaths, that aren't already in the library.</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621681918967"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918967"><span class="hs-identifier hs-var">rpaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#nub/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [FilePath])
-&gt; ([[FilePath]] -&gt; [FilePath]) -&gt; [[FilePath]] -&gt; [FilePath]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#sort/Data.OldList.html#sort"><span class="hs-identifier hs-var">sort</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [FilePath])
-&gt; ([[FilePath]] -&gt; [FilePath]) -&gt; [[FilePath]] -&gt; [FilePath]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[[FilePath]] -&gt; [FilePath]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#join/GHC.Base.html#join"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">([[FilePath]] -&gt; [FilePath]) -&gt; IO [[FilePath]] -&gt; IO [FilePath]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; (FilePath -&gt; IO [FilePath]) -&gt; IO [[FilePath]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#forM/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918954"><span class="hs-identifier hs-var">libs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681918968"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918968"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO Bool) -&gt; [FilePath] -&gt; IO [FilePath]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#filterM/Control.Monad.html#filterM"><span class="hs-identifier hs-var">filterM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681918969"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918969"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#doesFileExist/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918969"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918968"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918963"><span class="hs-identifier hs-var">lib_paths'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-comment">-- inject the rpaths</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918967"><span class="hs-identifier hs-var">rpaths</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="annottext">[FilePath]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; ToolSettings -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runInstallNameTool"><span class="hs-identifier hs-var">runInstallNameTool</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681918945"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681918946"><span class="hs-identifier hs-var">toolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">([Option] -&gt; IO ()) -&gt; [Option] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Option) -&gt; [FilePath] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; [Option]) -&gt; [FilePath] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-add_rpath&quot;</span></span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#intersperse/Data.OldList.html#intersperse"><span class="hs-identifier hs-var">intersperse</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-add_rpath&quot;</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918967"><span class="hs-identifier hs-var">rpaths</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918948"><span class="hs-identifier hs-var">dylib</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><a href="GHC.Linker.MacOS.html#get_rpath"><span class="hs-identifier hs-type">get_rpath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-69"></span><span id="get_rpath"><span class="annot"><span class="annottext">get_rpath :: FilePath -&gt; Maybe FilePath
</span><a href="GHC.Linker.MacOS.html#get_rpath"><span class="hs-identifier hs-var hs-var">get_rpath</span></a></span></span><span> </span><span id="local-6989586621681918971"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918971"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReadP FilePath -&gt; ReadS FilePath
forall a. ReadP a -&gt; ReadS a
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#readP_to_S/Text.ParserCombinators.ReadP.html#readP_to_S"><span class="hs-identifier hs-var">readP_to_S</span></a></span><span> </span><span class="annot"><span class="annottext">ReadP FilePath
</span><a href="GHC.Linker.MacOS.html#rpath_parser"><span class="hs-identifier hs-var">rpath_parser</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918971"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-70"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621681918974"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918974"><span class="hs-identifier hs-var">rpath</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918974"><span class="hs-identifier hs-var">rpath</span></a></span><span>
</span><span id="line-71"></span><span>                </span><span class="annot"><span class="annottext">[(FilePath, FilePath)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><a href="GHC.Linker.MacOS.html#rpath_parser"><span class="hs-identifier hs-type">rpath_parser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#ReadP/Text.ParserCombinators.ReadP.html#ReadP"><span class="hs-identifier hs-type">ReadP</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-75"></span><span id="rpath_parser"><span class="annot"><span class="annottext">rpath_parser :: ReadP FilePath
</span><a href="GHC.Linker.MacOS.html#rpath_parser"><span class="hs-identifier hs-var hs-var">rpath_parser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><span class="annottext">ReadP ()
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#skipSpaces/Text.ParserCombinators.ReadP.html#skipSpaces"><span class="hs-identifier hs-var">skipSpaces</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="annottext">ReadP FilePath -&gt; ReadP ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(ReadP FilePath -&gt; ReadP ()) -&gt; ReadP FilePath -&gt; ReadP ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ReadP FilePath
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#string/Text.ParserCombinators.ReadP.html#string"><span class="hs-identifier hs-var">string</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;path&quot;</span></span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="annottext">ReadP FilePath -&gt; ReadP ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(ReadP FilePath -&gt; ReadP ()) -&gt; ReadP FilePath -&gt; ReadP ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReadP Char -&gt; ReadP FilePath
forall a. ReadP a -&gt; ReadP [a]
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#many1/Text.ParserCombinators.ReadP.html#many1"><span class="hs-identifier hs-var">many1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ReadP Char
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#satisfy/Text.ParserCombinators.ReadP.html#satisfy"><span class="hs-identifier hs-var">satisfy</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="../../base-4.18.3.0/src/GHC.Unicode.html#isSpace/GHC.Unicode.html#isSpace"><span class="hs-identifier hs-var">isSpace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span id="local-6989586621681918980"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918980"><span class="hs-identifier hs-var">rpath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadP Char -&gt; ReadP FilePath
forall a. ReadP a -&gt; ReadP [a]
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#many/Text.ParserCombinators.ReadP.html#many"><span class="hs-identifier hs-var">many</span></a></span><span> </span><span class="annot"><span class="annottext">ReadP Char
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#get/Text.ParserCombinators.ReadP.html#get"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="annottext">ReadP FilePath -&gt; ReadP ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(ReadP FilePath -&gt; ReadP ()) -&gt; ReadP FilePath -&gt; ReadP ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReadP Char -&gt; ReadP FilePath
forall a. ReadP a -&gt; ReadP [a]
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#many1/Text.ParserCombinators.ReadP.html#many1"><span class="hs-identifier hs-var">many1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ReadP Char
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#satisfy/Text.ParserCombinators.ReadP.html#satisfy"><span class="hs-identifier hs-var">satisfy</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="../../base-4.18.3.0/src/GHC.Unicode.html#isSpace/GHC.Unicode.html#isSpace"><span class="hs-identifier hs-var">isSpace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><span class="annottext">ReadP FilePath -&gt; ReadP ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(ReadP FilePath -&gt; ReadP ()) -&gt; ReadP FilePath -&gt; ReadP ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; ReadP FilePath
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#string/Text.ParserCombinators.ReadP.html#string"><span class="hs-identifier hs-var">string</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;(offset &quot;</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><span class="annottext">ReadP FilePath -&gt; ReadP ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(ReadP FilePath -&gt; ReadP ()) -&gt; ReadP FilePath -&gt; ReadP ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; ReadP FilePath
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#munch1/Text.ParserCombinators.ReadP.html#munch1"><span class="hs-identifier hs-var">munch1</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="../../base-4.18.3.0/src/GHC.Unicode.html#isDigit/GHC.Unicode.html#isDigit"><span class="hs-identifier hs-var">isDigit</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="annottext">ReadP Char -&gt; ReadP ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../base-4.18.3.0/src/Data.Functor.html#void/Data.Functor.html#void"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(ReadP Char -&gt; ReadP ()) -&gt; ReadP Char -&gt; ReadP ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ReadP Char
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#char/Text.ParserCombinators.ReadP.html#char"><span class="hs-identifier hs-var">Parser.char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">')'</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="annottext">ReadP ()
</span><a href="../../base-4.18.3.0/src/Text.ParserCombinators.ReadP.html#skipSpaces/Text.ParserCombinators.ReadP.html#skipSpaces"><span class="hs-identifier hs-var">skipSpaces</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="annottext">FilePath -&gt; ReadP FilePath
forall a. a -&gt; ReadP a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918980"><span class="hs-identifier hs-var">rpath</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="GHC.Linker.MacOS.html#getUnitFrameworkOpts"><span class="hs-identifier hs-type">getUnitFrameworkOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span id="getUnitFrameworkOpts"><span class="annot"><span class="annottext">getUnitFrameworkOpts :: UnitEnv -&gt; [UnitId] -&gt; IO [FilePath]
</span><a href="GHC.Linker.MacOS.html#getUnitFrameworkOpts"><span class="hs-identifier hs-var hs-var">getUnitFrameworkOpts</span></a></span></span><span> </span><span id="local-6989586621681918986"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621681918986"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621681918987"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681918987"><span class="hs-identifier hs-var">dep_packages</span></a></span></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformUsesFrameworks"><span class="hs-identifier hs-var">platformUsesFrameworks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; Platform
</span><a href="GHC.Unit.Env.html#ue_platform"><span class="hs-identifier hs-var">ue_platform</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621681918986"><span class="hs-identifier hs-var">unit_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>        </span><span id="local-6989586621681918990"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681918990"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeErr UnitErr [UnitInfo] -&gt; IO [UnitInfo]
forall a. MaybeErr UnitErr a -&gt; IO a
</span><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-var">mayThrowUnitErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; [UnitId] -&gt; MaybeErr UnitErr [UnitInfo]
</span><a href="GHC.Unit.Env.html#preloadUnitsInfo%27"><span class="hs-identifier hs-var">preloadUnitsInfo'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621681918986"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681918987"><span class="hs-identifier hs-var">dep_packages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681918993"><span class="annot"><span class="annottext">pkg_framework_path_opts :: [FilePath]
</span><a href="#local-6989586621681918993"><span class="hs-identifier hs-var hs-var">pkg_framework_path_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-F&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [FilePath]
</span><a href="GHC.Unit.Info.html#collectFrameworksDirs"><span class="hs-identifier hs-var">collectFrameworksDirs</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681918990"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>            </span><span id="local-6989586621681918995"><span class="annot"><span class="annottext">pkg_framework_opts :: [FilePath]
</span><a href="#local-6989586621681918995"><span class="hs-identifier hs-var hs-var">pkg_framework_opts</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[FilePath]] -&gt; [FilePath]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-framework&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918997"><span class="hs-identifier hs-var">fw</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>                                             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681918997"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681918997"><span class="hs-identifier hs-var">fw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [FilePath]
</span><a href="GHC.Unit.Info.html#collectFrameworks"><span class="hs-identifier hs-var">collectFrameworks</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681918990"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-95"></span><span>                                             </span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">[FilePath] -&gt; IO [FilePath]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918993"><span class="hs-identifier hs-var">pkg_framework_path_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681918995"><span class="hs-identifier hs-var">pkg_framework_opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; IO [FilePath]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="GHC.Linker.MacOS.html#getFrameworkOpts"><span class="hs-identifier hs-type">getFrameworkOpts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Linker.Config.html#FrameworkOpts"><span class="hs-identifier hs-type">FrameworkOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span id="getFrameworkOpts"><span class="annot"><span class="annottext">getFrameworkOpts :: FrameworkOpts -&gt; Platform -&gt; [FilePath]
</span><a href="GHC.Linker.MacOS.html#getFrameworkOpts"><span class="hs-identifier hs-var hs-var">getFrameworkOpts</span></a></span></span><span> </span><span id="local-6989586621681918999"><span class="annot"><span class="annottext">FrameworkOpts
</span><a href="#local-6989586621681918999"><span class="hs-identifier hs-var">fwOpts</span></a></span></span><span> </span><span id="local-6989586621681919000"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681919000"><span class="hs-identifier hs-var">platform</span></a></span></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformUsesFrameworks"><span class="hs-identifier hs-var">platformUsesFrameworks</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681919000"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919001"><span class="hs-identifier hs-var">framework_path_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919002"><span class="hs-identifier hs-var">framework_opts</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621681919003"><span class="annot"><span class="annottext">framework_paths :: [FilePath]
</span><a href="#local-6989586621681919003"><span class="hs-identifier hs-var hs-var">framework_paths</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FrameworkOpts -&gt; [FilePath]
</span><a href="GHC.Linker.Config.html#foFrameworkPaths"><span class="hs-identifier hs-var">foFrameworkPaths</span></a></span><span> </span><span class="annot"><span class="annottext">FrameworkOpts
</span><a href="#local-6989586621681918999"><span class="hs-identifier hs-var">fwOpts</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621681919001"><span class="annot"><span class="annottext">framework_path_opts :: [FilePath]
</span><a href="#local-6989586621681919001"><span class="hs-identifier hs-var hs-var">framework_path_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; [FilePath] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-F&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919003"><span class="hs-identifier hs-var">framework_paths</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621681919005"><span class="annot"><span class="annottext">frameworks :: [FilePath]
</span><a href="#local-6989586621681919005"><span class="hs-identifier hs-var hs-var">frameworks</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FrameworkOpts -&gt; [FilePath]
</span><a href="GHC.Linker.Config.html#foCmdlineFrameworks"><span class="hs-identifier hs-var">foCmdlineFrameworks</span></a></span><span> </span><span class="annot"><span class="annottext">FrameworkOpts
</span><a href="#local-6989586621681918999"><span class="hs-identifier hs-var">fwOpts</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- reverse because they're added in reverse order from the cmd line:</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621681919002"><span class="annot"><span class="annottext">framework_opts :: [FilePath]
</span><a href="#local-6989586621681919002"><span class="hs-identifier hs-var hs-var">framework_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[FilePath]] -&gt; [FilePath]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-framework&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919007"><span class="hs-identifier hs-var">fw</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681919007"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919007"><span class="hs-identifier hs-var">fw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919005"><span class="hs-identifier hs-var">frameworks</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">{-
Note [macOS Big Sur dynamic libraries]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

macOS Big Sur makes the following change to how frameworks are shipped
with the OS:

&gt; New in macOS Big Sur 11 beta, the system ships with a built-in
&gt; dynamic linker cache of all system-provided libraries.  As part of
&gt; this change, copies of dynamic libraries are no longer present on
&gt; the filesystem.  Code that attempts to check for dynamic library
&gt; presence by looking for a file at a path or enumerating a directory
&gt; will fail.  Instead, check for library presence by attempting to
&gt; dlopen() the path, which will correctly check for the library in the
&gt; cache. (62986286)

(https://developer.apple.com/documentation/macos-release-notes/macos-big-sur-11-beta-release-notes/)

Therefore, the previous method of checking whether a library exists
before attempting to load it makes GHC.Linker.MacOS.loadFramework
fail to find frameworks installed at /System/Library/Frameworks.
Instead, any attempt to load a framework at runtime, such as by
passing -framework OpenGL to runghc or running code loading such a
framework with GHCi, fails with a 'not found' message.

GHC.Linker.MacOS.loadFramework now opportunistically loads the
framework libraries without checking for their existence first,
failing only if all attempts to load a given framework from any of the
various possible locations fail.  See also #18446, which this change
addresses.
-}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- Darwin / MacOS X only: load a framework</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- a framework is a dynamic library packaged inside a directory of the same</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- name. They are searched for in different paths than normal libraries.</span><span>
</span><span id="line-149"></span><span class="annot"><a href="GHC.Linker.MacOS.html#loadFramework"><span class="hs-identifier hs-type">loadFramework</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span id="loadFramework"><span class="annot"><span class="annottext">loadFramework :: Interp -&gt; [FilePath] -&gt; FilePath -&gt; IO (Maybe FilePath)
</span><a href="GHC.Linker.MacOS.html#loadFramework"><span class="hs-identifier hs-var hs-var">loadFramework</span></a></span></span><span> </span><span id="local-6989586621681919009"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681919009"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span id="local-6989586621681919010"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919010"><span class="hs-identifier hs-var">extraPaths</span></a></span></span><span> </span><span id="local-6989586621681919011"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919011"><span class="hs-identifier hs-var">rootname</span></a></span></span><span>
</span><span id="line-151"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681919012"><span class="annot"><span class="annottext">Either IOException FilePath
</span><a href="#local-6989586621681919012"><span class="hs-identifier hs-var">either_dir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FilePath -&gt; IO (Either IOException FilePath)
forall a. IO a -&gt; IO (Either IOException a)
</span><a href="GHC.Utils.Exception.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO FilePath
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#getHomeDirectory/System.Directory.html#getHomeDirectory"><span class="hs-identifier hs-var">getHomeDirectory</span></a></span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681919014"><span class="annot"><span class="annottext">homeFrameworkPath :: [FilePath]
</span><a href="#local-6989586621681919014"><span class="hs-identifier hs-var hs-var">homeFrameworkPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException FilePath
</span><a href="#local-6989586621681919012"><span class="hs-identifier hs-var">either_dir</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>                                  </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-154"></span><span>                                  </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681919015"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919015"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919015"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Library/Frameworks&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>              </span><span id="local-6989586621681919016"><span class="annot"><span class="annottext">ps :: [FilePath]
</span><a href="#local-6989586621681919016"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919010"><span class="hs-identifier hs-var">extraPaths</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919014"><span class="hs-identifier hs-var">homeFrameworkPath</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919017"><span class="hs-identifier hs-var">defaultFrameworkPaths</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681919018"><span class="annot"><span class="annottext">Maybe [FilePath]
</span><a href="#local-6989586621681919018"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; IO (Maybe [FilePath])
</span><a href="#local-6989586621681919019"><span class="hs-identifier hs-var">findLoadDLL</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919016"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; IO (Maybe FilePath)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe FilePath -&gt; IO (Maybe FilePath))
-&gt; Maybe FilePath -&gt; IO (Maybe FilePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; FilePath) -&gt; Maybe [FilePath] -&gt; Maybe FilePath
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; FilePath
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/Data.OldList.html#intercalate/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;, &quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [FilePath]
</span><a href="#local-6989586621681919018"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-159"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>     </span><span id="local-6989586621681919020"><span class="annot"><span class="annottext">fwk_file :: FilePath
</span><a href="#local-6989586621681919020"><span class="hs-identifier hs-var hs-var">fwk_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919011"><span class="hs-identifier hs-var">rootname</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;framework&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919011"><span class="hs-identifier hs-var">rootname</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>     </span><span class="hs-comment">-- sorry for the hardcoded paths, I hope they won't change anytime soon:</span><span>
</span><span id="line-163"></span><span>     </span><span id="local-6989586621681919017"><span class="annot"><span class="annottext">defaultFrameworkPaths :: [FilePath]
</span><a href="#local-6989586621681919017"><span class="hs-identifier hs-var hs-var">defaultFrameworkPaths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;/Library/Frameworks&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;/System/Library/Frameworks&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>     </span><span class="hs-comment">-- Try to call loadDLL for each candidate path.</span><span>
</span><span id="line-166"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span>     </span><span class="hs-comment">-- See Note [macOS Big Sur dynamic libraries]</span><span>
</span><span id="line-168"></span><span>     </span><span id="local-6989586621681919019"><span class="annot"><span class="annottext">findLoadDLL :: [FilePath] -&gt; [FilePath] -&gt; IO (Maybe [FilePath])
</span><a href="#local-6989586621681919019"><span class="hs-identifier hs-var hs-var">findLoadDLL</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681919021"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919021"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>       </span><span class="hs-comment">-- Tried all our known library paths, but dlopen()</span><span>
</span><span id="line-170"></span><span>       </span><span class="hs-comment">-- has no built-in paths for frameworks: give up</span><span>
</span><span id="line-171"></span><span>       </span><span class="annot"><span class="annottext">Maybe [FilePath] -&gt; IO (Maybe [FilePath])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [FilePath] -&gt; IO (Maybe [FilePath]))
-&gt; Maybe [FilePath] -&gt; IO (Maybe [FilePath])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; Maybe [FilePath]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919021"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-172"></span><span>     </span><span class="annot"><a href="#local-6989586621681919019"><span class="hs-identifier hs-var">findLoadDLL</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681919022"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919022"><span class="hs-identifier hs-var">p</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681919023"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919023"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681919024"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919024"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>       </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681919025"><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621681919025"><span class="hs-identifier hs-var">dll</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; FilePath -&gt; IO (Maybe FilePath)
</span><a href="GHC.Runtime.Interpreter.html#loadDLL"><span class="hs-identifier hs-var">loadDLL</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681919009"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919022"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath-1.4.301.0/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919020"><span class="hs-identifier hs-var">fwk_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621681919025"><span class="hs-identifier hs-var">dll</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-175"></span><span>              </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [FilePath] -&gt; IO (Maybe [FilePath])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [FilePath]
forall a. Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-176"></span><span>              </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681919027"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919027"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; IO (Maybe [FilePath])
</span><a href="#local-6989586621681919019"><span class="hs-identifier hs-var">findLoadDLL</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919023"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919022"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681919027"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681919024"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span></pre></body></html>