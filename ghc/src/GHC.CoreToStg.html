<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- (c) The GRASP/AQUA Project, Glasgow University, 1993-1998</span><span>
</span><span id="line-8"></span><span class="hs-comment">--</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Converting Core to STG Syntax</span><span>
</span><span id="line-12"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">-- And, as we have the info in hand, we may convert some lets to</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- let-no-escapes.</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.CoreToStg</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier">CoreToStgOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#coreToStg"><span class="hs-identifier">coreToStg</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Arity.html"><span class="hs-identifier">GHC.Core.Opt.Arity</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Arity.html#manifestArity"><span class="hs-identifier">manifestArity</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Debug.html"><span class="hs-identifier">GHC.Stg.Debug</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Utils.html"><span class="hs-identifier">GHC.Stg.Utils</span></a></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.RepType.html"><span class="hs-identifier">GHC.Types.RepType</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html"><span class="hs-identifier">GHC.Types.Id.Make</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Id.Make.html#coercionTokenId"><span class="hs-identifier">coercionTokenId</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html"><span class="hs-identifier">GHC.Types.Tickish</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier">isExternalName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier">nameModule_maybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier">Arity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrConstraint"><span class="hs-identifier">TypeOrConstraint</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Literal.html"><span class="hs-identifier">GHC.Types.Literal</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.ForeignCall.html"><span class="hs-identifier">GHC.Types.ForeignCall</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html"><span class="hs-identifier">GHC.Types.IPE</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html"><span class="hs-identifier">GHC.Types.Demand</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier">isUsedOnceDmd</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#mkGeneralSrcSpan"><span class="hs-identifier">mkGeneralSrcSpan</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier">Platform</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier">HasDebugCallStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#ap/GHC.Base.html#ap"><span class="hs-identifier">ap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- Note [Live vs free]</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-64"></span><span class="hs-comment">--</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- The two are not the same. Liveness is an operational property rather</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- than a semantic one. A variable is live at a particular execution</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- point if it can be referred to directly again. In particular, a dead</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- variable's stack slot (if it has one):</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-comment">--           - should be stubbed to avoid space leaks, and</span><span>
</span><span id="line-71"></span><span class="hs-comment">--           - may be reused for something else.</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- There ought to be a better way to say this. Here are some examples:</span><span>
</span><span id="line-74"></span><span class="hs-comment">--</span><span>
</span><span id="line-75"></span><span class="hs-comment">--         let v = [q] \[x] -&gt; e</span><span>
</span><span id="line-76"></span><span class="hs-comment">--         in</span><span>
</span><span id="line-77"></span><span class="hs-comment">--         ...v...  (but no q's)</span><span>
</span><span id="line-78"></span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- Just after the `in', v is live, but q is dead. If the whole of that</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- let expression was enclosed in a case expression, thus:</span><span>
</span><span id="line-81"></span><span class="hs-comment">--</span><span>
</span><span id="line-82"></span><span class="hs-comment">--         case (let v = [q] \[x] -&gt; e in ...v...) of</span><span>
</span><span id="line-83"></span><span class="hs-comment">--                 alts[...q...]</span><span>
</span><span id="line-84"></span><span class="hs-comment">--</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- (ie `alts' mention `q'), then `q' is live even after the `in'; because</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- we'll return later to the `alts' and need it.</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- Let-no-escapes make this a bit more interesting:</span><span>
</span><span id="line-89"></span><span class="hs-comment">--</span><span>
</span><span id="line-90"></span><span class="hs-comment">--         let-no-escape v = [q] \ [x] -&gt; e</span><span>
</span><span id="line-91"></span><span class="hs-comment">--         in</span><span>
</span><span id="line-92"></span><span class="hs-comment">--         ...v...</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- Here, `q' is still live at the `in', because `v' is represented not by</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- a closure but by the current stack state.  In other words, if `v' is</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- live then so is `q'. Furthermore, if `e' mentions an enclosing</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- let-no-escaped variable, then its free variables are also live if `v' is.</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- Note [What are these SRTs all about?]</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-101"></span><span class="hs-comment">--</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- Consider the Core program,</span><span>
</span><span id="line-103"></span><span class="hs-comment">--</span><span>
</span><span id="line-104"></span><span class="hs-comment">--     fibs = go 1 1</span><span>
</span><span id="line-105"></span><span class="hs-comment">--       where go a b = let c = a + c</span><span>
</span><span id="line-106"></span><span class="hs-comment">--                      in c : go b c</span><span>
</span><span id="line-107"></span><span class="hs-comment">--     add x = map (\y -&gt; x*y) fibs</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- In this case we have a CAF, 'fibs', which is quite large after evaluation and</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- has only one possible user, 'add'. Consequently, we want to ensure that when</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- all references to 'add' die we can garbage collect any bit of 'fibs' that we</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- have evaluated.</span><span>
</span><span id="line-113"></span><span class="hs-comment">--</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- However, how do we know whether there are any references to 'fibs' still</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- around? Afterall, the only reference to it is buried in the code generated</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- for 'add'. The answer is that we record the CAFs referred to by a definition</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- in its info table, namely a part of it known as the Static Reference Table</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- (SRT).</span><span>
</span><span id="line-119"></span><span class="hs-comment">--</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- Since SRTs are so common, we use a special compact encoding for them in: we</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- produce one table containing a list of CAFs in a module and then include a</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- bitmap in each info table describing which entries of this table the closure</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- references.</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- See also: commentary/rts/storage/gc/CAFs on the GHC Wiki.</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- Note [What is a non-escaping let]</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- NB: Nowadays this is recognized by the occurrence analyser by turning a</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- &quot;non-escaping let&quot; into a join point. The following is then an operational</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- account of join points.</span><span>
</span><span id="line-133"></span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- Consider:</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">--     let x = fvs \ args -&gt; e</span><span>
</span><span id="line-137"></span><span class="hs-comment">--     in</span><span>
</span><span id="line-138"></span><span class="hs-comment">--         if ... then x else</span><span>
</span><span id="line-139"></span><span class="hs-comment">--            if ... then x else ...</span><span>
</span><span id="line-140"></span><span class="hs-comment">--</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- `x' is used twice (so we probably can't unfold it), but when it is</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- entered, the stack is deeper than it was when the definition of `x'</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- happened.  Specifically, if instead of allocating a closure for `x',</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- we saved all `x's fvs on the stack, and remembered the stack depth at</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- that moment, then whenever we enter `x' we can simply set the stack</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- pointer(s) to these remembered (compile-time-fixed) values, and jump</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- to the code for `x'.</span><span>
</span><span id="line-148"></span><span class="hs-comment">--</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- All of this is provided x is:</span><span>
</span><span id="line-150"></span><span class="hs-comment">--   1. non-updatable;</span><span>
</span><span id="line-151"></span><span class="hs-comment">--   2. guaranteed to be entered before the stack retreats -- ie x is not</span><span>
</span><span id="line-152"></span><span class="hs-comment">--      buried in a heap-allocated closure, or passed as an argument to</span><span>
</span><span id="line-153"></span><span class="hs-comment">--      something;</span><span>
</span><span id="line-154"></span><span class="hs-comment">--   3. all the enters have exactly the right number of arguments,</span><span>
</span><span id="line-155"></span><span class="hs-comment">--      no more no less;</span><span>
</span><span id="line-156"></span><span class="hs-comment">--   4. all the enters are tail calls; that is, they return to the</span><span>
</span><span id="line-157"></span><span class="hs-comment">--      caller enclosing the definition of `x'.</span><span>
</span><span id="line-158"></span><span class="hs-comment">--</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- Under these circumstances we say that `x' is non-escaping.</span><span>
</span><span id="line-160"></span><span class="hs-comment">--</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- An example of when (4) does not hold:</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">--     let x = ...</span><span>
</span><span id="line-164"></span><span class="hs-comment">--     in case x of ...alts...</span><span>
</span><span id="line-165"></span><span class="hs-comment">--</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- Here, `x' is certainly entered only when the stack is deeper than when</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- `x' is defined, but here it must return to ...alts... So we can't just</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- adjust the stack down to `x''s recalled points, because that would lost</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- alts' context.</span><span>
</span><span id="line-170"></span><span class="hs-comment">--</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- Things can get a little more complicated.  Consider:</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span class="hs-comment">--     let y = ...</span><span>
</span><span id="line-174"></span><span class="hs-comment">--     in let x = fvs \ args -&gt; ...y...</span><span>
</span><span id="line-175"></span><span class="hs-comment">--     in ...x...</span><span>
</span><span id="line-176"></span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- Now, if `x' is used in a non-escaping way in ...x..., and `y' is used in a</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- non-escaping way in ...y..., then `y' is non-escaping.</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- `x' can even be recursive!  Eg:</span><span>
</span><span id="line-181"></span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span class="hs-comment">--     letrec x = [y] \ [v] -&gt; if v then x True else ...</span><span>
</span><span id="line-183"></span><span class="hs-comment">--     in</span><span>
</span><span id="line-184"></span><span class="hs-comment">--         ...(x b)...</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- Note [Cost-centre initialization plan]</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-188"></span><span class="hs-comment">--</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- Previously `coreToStg` was initializing cost-centre stack fields as `noCCS`,</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- and the fields were then fixed by a separate pass `stgMassageForProfiling`.</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- We now initialize these correctly. The initialization works like this:</span><span>
</span><span id="line-192"></span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span class="hs-comment">--   - For non-top level bindings always use `currentCCS`.</span><span>
</span><span id="line-194"></span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span class="hs-comment">--   - For top-level bindings, check if the binding is a CAF</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span class="hs-comment">--     - CAF:      If -fcaf-all is enabled, create a new CAF just for this CAF</span><span>
</span><span id="line-198"></span><span class="hs-comment">--                 and use it. Note that these new cost centres need to be</span><span>
</span><span id="line-199"></span><span class="hs-comment">--                 collected to be able to generate cost centre initialization</span><span>
</span><span id="line-200"></span><span class="hs-comment">--                 code, so `coreToTopStgRhs` now returns `CollectedCCs`.</span><span>
</span><span id="line-201"></span><span class="hs-comment">--</span><span>
</span><span id="line-202"></span><span class="hs-comment">--                 If -fcaf-all is not enabled, use &quot;all CAFs&quot; cost centre.</span><span>
</span><span id="line-203"></span><span class="hs-comment">--</span><span>
</span><span id="line-204"></span><span class="hs-comment">--     - Non-CAF:  Top-level (static) data is not counted in heap profiles; nor</span><span>
</span><span id="line-205"></span><span class="hs-comment">--                 do we set CCCS from it; so we just slam in</span><span>
</span><span id="line-206"></span><span class="hs-comment">--                 dontCareCostCentre.</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- Note [Coercion tokens]</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- In coreToStgArgs, we drop type arguments completely, but we replace</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- coercions with a special coercionToken# placeholder. Why? Consider:</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-comment">--   f :: forall a. Int ~# Bool -&gt; a</span><span>
</span><span id="line-214"></span><span class="hs-comment">--   f = /\a. \(co :: Int ~# Bool) -&gt; error &quot;impossible&quot;</span><span>
</span><span id="line-215"></span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- If we erased the coercion argument completely, we&#8217;d end up with just</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- f = error &quot;impossible&quot;, but then f `seq` () would be &#8869;!</span><span>
</span><span id="line-218"></span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- This is an artificial example, but back in the day we *did* treat</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- coercion lambdas like type lambdas, and we had bug reports as a</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- result. So now we treat coercion lambdas like value lambdas, but we</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- treat coercions themselves as zero-width arguments &#8212; coercionToken#</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- has representation VoidRep &#8212; which gets the best of both worlds.</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- (For the gory details, see also the (unpublished) paper, &#8220;Practical</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- aspects of evidence-based compilation in System FC.&#8221;)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- --------------------------------------------------------------</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Setting variable info: top-level, binds, RHSs</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- --------------------------------------------------------------</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStg"><span class="hs-identifier hs-type">coreToStg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-234"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.IPE.html#InfoTableProvMap"><span class="hs-identifier hs-type">InfoTableProvMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span id="coreToStg"><span class="annot"><span class="annottext">coreToStg :: CoreToStgOpts
-&gt; Module
-&gt; ModLocation
-&gt; CoreProgram
-&gt; ([StgTopBinding], InfoTableProvMap, CollectedCCs)
</span><a href="GHC.CoreToStg.html#coreToStg"><span class="hs-identifier hs-var hs-var">coreToStg</span></a></span></span><span> </span><span id="local-6989586621681830196"><span class="annot"><span class="annottext">opts :: CoreToStgOpts
</span><a href="#local-6989586621681830196"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">coreToStg_ways :: CoreToStgOpts -&gt; Ways
</span><a href="GHC.CoreToStg.html#coreToStg_ways"><span class="hs-identifier hs-var">coreToStg_ways</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830199"><span class="annot"><span class="annottext">Ways
</span><a href="#local-6989586621681830199"><span class="hs-identifier hs-var">ways</span></a></span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">coreToStg_AutoSccsOnIndividualCafs :: CoreToStgOpts -&gt; Bool
</span><a href="GHC.CoreToStg.html#coreToStg_AutoSccsOnIndividualCafs"><span class="hs-identifier hs-var">coreToStg_AutoSccsOnIndividualCafs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830201"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830201"><span class="hs-identifier hs-var">opt_AutoSccsOnIndividualCafs</span></a></span></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">coreToStg_InfoTableMap :: CoreToStgOpts -&gt; Bool
</span><a href="GHC.CoreToStg.html#coreToStg_InfoTableMap"><span class="hs-identifier hs-var">coreToStg_InfoTableMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830203"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830203"><span class="hs-identifier hs-var">opt_InfoTableMap</span></a></span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">coreToStg_stgDebugOpts :: CoreToStgOpts -&gt; StgDebugOpts
</span><a href="GHC.CoreToStg.html#coreToStg_stgDebugOpts"><span class="hs-identifier hs-var">coreToStg_stgDebugOpts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830205"><span class="annot"><span class="annottext">StgDebugOpts
</span><a href="#local-6989586621681830205"><span class="hs-identifier hs-var">stgDebugOpts</span></a></span></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681830206"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830206"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681830207"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681830207"><span class="hs-identifier hs-var">ml</span></a></span></span><span> </span><span id="local-6989586621681830208"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681830208"><span class="hs-identifier hs-var">pgm</span></a></span></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681830209"><span class="hs-identifier hs-var">pgm''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681830210"><span class="hs-identifier hs-var">denv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830211"><span class="hs-identifier hs-var">final_ccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdEnv HowBound
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830212"><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621681830212"><span class="hs-identifier hs-var">local_ccs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830213"><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621681830213"><span class="hs-identifier hs-var">local_cc_stacks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830214"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681830214"><span class="hs-identifier hs-var">pgm'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; IdEnv HowBound
-&gt; CollectedCCs
-&gt; CoreProgram
-&gt; (IdEnv HowBound, CollectedCCs, [StgTopBinding])
</span><a href="GHC.CoreToStg.html#coreTopBindsToStg"><span class="hs-identifier hs-var">coreTopBindsToStg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830196"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830206"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="GHC.Types.CostCentre.html#emptyCollectedCCs"><span class="hs-identifier hs-var">emptyCollectedCCs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681830208"><span class="hs-identifier hs-var">pgm</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-comment">-- See Note [Mapping Info Tables to Source Positions]</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621681830209"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681830209"><span class="hs-identifier hs-var">pgm''</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681830210"><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="#local-6989586621681830210"><span class="hs-identifier hs-var">denv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830203"><span class="hs-identifier hs-var">opt_InfoTableMap</span></a></span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgDebugOpts
-&gt; ModLocation
-&gt; [StgTopBinding]
-&gt; ([StgTopBinding], InfoTableProvMap)
</span><a href="GHC.Stg.Debug.html#collectDebugInformation"><span class="hs-identifier hs-var">collectDebugInformation</span></a></span><span> </span><span class="annot"><span class="annottext">StgDebugOpts
</span><a href="#local-6989586621681830205"><span class="hs-identifier hs-var">stgDebugOpts</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681830207"><span class="hs-identifier hs-var">ml</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681830214"><span class="hs-identifier hs-var">pgm'</span></a></span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681830214"><span class="hs-identifier hs-var">pgm'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InfoTableProvMap
</span><a href="GHC.Types.IPE.html#emptyInfoTableProvMap"><span class="hs-identifier hs-var">emptyInfoTableProvMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621681830220"><span class="annot"><span class="annottext">prof :: Bool
</span><a href="#local-6989586621681830220"><span class="hs-identifier hs-var hs-var">prof</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-identifier hs-var">hasWay</span></a></span><span> </span><span class="annot"><span class="annottext">Ways
</span><a href="#local-6989586621681830199"><span class="hs-identifier hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayProf"><span class="hs-identifier hs-var">WayProf</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621681830211"><span class="annot"><span class="annottext">final_ccs :: CollectedCCs
</span><a href="#local-6989586621681830211"><span class="hs-identifier hs-var hs-var">final_ccs</span></a></span></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830220"><span class="hs-identifier hs-var">prof</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830201"><span class="hs-identifier hs-var">opt_AutoSccsOnIndividualCafs</span></a></span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621681830212"><span class="hs-identifier hs-var">local_ccs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621681830213"><span class="hs-identifier hs-var">local_cc_stacks</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- don't need &quot;all CAFs&quot; CC</span><span>
</span><span id="line-257"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830220"><span class="hs-identifier hs-var">prof</span></a></span><span>
</span><span id="line-258"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830224"><span class="hs-identifier hs-var">all_cafs_cc</span></a></span><span class="annot"><span class="annottext">CostCentre -&gt; [CostCentre] -&gt; [CostCentre]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621681830212"><span class="hs-identifier hs-var">local_ccs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681830225"><span class="hs-identifier hs-var">all_cafs_ccs</span></a></span><span class="annot"><span class="annottext">CostCentreStack -&gt; [CostCentreStack] -&gt; [CostCentreStack]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621681830213"><span class="hs-identifier hs-var">local_cc_stacks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="GHC.Types.CostCentre.html#emptyCollectedCCs"><span class="hs-identifier hs-var">emptyCollectedCCs</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830224"><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830224"><span class="hs-identifier hs-var">all_cafs_cc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830225"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681830225"><span class="hs-identifier hs-var">all_cafs_ccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; (CostCentre, CostCentreStack)
</span><a href="GHC.CoreToStg.html#getAllCAFsCC"><span class="hs-identifier hs-var">getAllCAFsCC</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830206"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="GHC.CoreToStg.html#coreTopBindsToStg"><span class="hs-identifier hs-type">coreTopBindsToStg</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span>           </span><span class="hs-comment">-- environment for the bindings</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span id="coreTopBindsToStg"><span class="annot"><span class="annottext">coreTopBindsToStg :: CoreToStgOpts
-&gt; Module
-&gt; IdEnv HowBound
-&gt; CollectedCCs
-&gt; CoreProgram
-&gt; (IdEnv HowBound, CollectedCCs, [StgTopBinding])
</span><a href="GHC.CoreToStg.html#coreTopBindsToStg"><span class="hs-identifier hs-var hs-var">coreTopBindsToStg</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><span class="hs-identifier">_</span></span><span>      </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span>        </span><span id="local-6989586621681830227"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830227"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681830228"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830228"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830227"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830228"><span class="hs-identifier hs-var">ccs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span class="annot"><a href="GHC.CoreToStg.html#coreTopBindsToStg"><span class="hs-identifier hs-var">coreTopBindsToStg</span></a></span><span> </span><span id="local-6989586621681830229"><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830229"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621681830230"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830230"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681830231"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830231"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681830232"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830232"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830233"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830233"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681830234"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681830234"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830236"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830236"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830233"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; Bool
forall b. Expr b -&gt; Bool
</span><a href="GHC.Core.html#isTyCoArg"><span class="hs-identifier hs-var">isTyCoArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830236"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; IdEnv HowBound
-&gt; CollectedCCs
-&gt; CoreProgram
-&gt; (IdEnv HowBound, CollectedCCs, [StgTopBinding])
</span><a href="GHC.CoreToStg.html#coreTopBindsToStg"><span class="hs-identifier hs-var">coreTopBindsToStg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830229"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830230"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830238"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830239"><span class="hs-identifier hs-var">ccs1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681830234"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830240"><span class="hs-identifier hs-var">env2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830241"><span class="hs-identifier hs-var">ccs2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgTopBinding
</span><a href="#local-6989586621681830242"><span class="hs-identifier hs-var">b'</span></a></span><span class="annot"><span class="annottext">StgTopBinding -&gt; [StgTopBinding] -&gt; [StgTopBinding]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681830243"><span class="hs-identifier hs-var">bs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830238"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830238"><span class="hs-identifier hs-var">env1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830239"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830239"><span class="hs-identifier hs-var">ccs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830242"><span class="annot"><span class="annottext">StgTopBinding
</span><a href="#local-6989586621681830242"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; IdEnv HowBound
-&gt; CollectedCCs
-&gt; CoreBind
-&gt; (IdEnv HowBound, CollectedCCs, StgTopBinding)
</span><a href="GHC.CoreToStg.html#coreTopBindToStg"><span class="hs-identifier hs-var">coreTopBindToStg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830229"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830230"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830231"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830232"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830233"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830240"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830240"><span class="hs-identifier hs-var">env2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830241"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830241"><span class="hs-identifier hs-var">ccs2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830243"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681830243"><span class="hs-identifier hs-var">bs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; IdEnv HowBound
-&gt; CollectedCCs
-&gt; CoreProgram
-&gt; (IdEnv HowBound, CollectedCCs, [StgTopBinding])
</span><a href="GHC.CoreToStg.html#coreTopBindsToStg"><span class="hs-identifier hs-var">coreTopBindsToStg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830229"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830230"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830238"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830239"><span class="hs-identifier hs-var">ccs1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681830234"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><a href="GHC.CoreToStg.html#coreTopBindToStg"><span class="hs-identifier hs-type">coreTopBindToStg</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span id="coreTopBindToStg"><span class="annot"><span class="annottext">coreTopBindToStg :: CoreToStgOpts
-&gt; Module
-&gt; IdEnv HowBound
-&gt; CollectedCCs
-&gt; CoreBind
-&gt; (IdEnv HowBound, CollectedCCs, StgTopBinding)
</span><a href="GHC.CoreToStg.html#coreTopBindToStg"><span class="hs-identifier hs-var hs-var">coreTopBindToStg</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830245"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830245"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681830246"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830246"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621681830247"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830247"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681830248"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830248"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681830249"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830249"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; Maybe ByteString
</span><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-var">exprIsTickedString_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830248"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- top-level string literal</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-comment">-- See Note [Core top-level string literals] in GHC.Core</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-296"></span><span>        </span><span id="local-6989586621681830251"><span class="annot"><span class="annottext">env' :: IdEnv HowBound
</span><a href="#local-6989586621681830251"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound -&gt; Id -&gt; HowBound -&gt; IdEnv HowBound
forall a. VarEnv a -&gt; Id -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830245"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830247"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="#local-6989586621681830253"><span class="hs-identifier hs-var">how_bound</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span id="local-6989586621681830253"><span class="annot"><span class="annottext">how_bound :: HowBound
</span><a href="#local-6989586621681830253"><span class="hs-identifier hs-var hs-var">how_bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetInfo -&gt; Int -&gt; HowBound
</span><a href="GHC.CoreToStg.html#LetBound"><span class="hs-identifier hs-var">LetBound</span></a></span><span> </span><span class="annot"><span class="annottext">LetInfo
</span><a href="GHC.CoreToStg.html#TopLet"><span class="hs-identifier hs-var">TopLet</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830251"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830246"><span class="hs-identifier hs-var">ccs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; ByteString -&gt; StgTopBinding
forall (pass :: StgPass). Id -&gt; ByteString -&gt; GenStgTopBinding pass
</span><a href="GHC.Stg.Syntax.html#StgTopStringLit"><span class="hs-identifier hs-var">StgTopStringLit</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830247"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830249"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="annot"><a href="GHC.CoreToStg.html#coreTopBindToStg"><span class="hs-identifier hs-var">coreTopBindToStg</span></a></span><span> </span><span id="local-6989586621681830257"><span class="annot"><span class="annottext">opts :: CoreToStgOpts
</span><a href="#local-6989586621681830257"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">coreToStg_platform :: CoreToStgOpts -&gt; Platform
</span><a href="GHC.CoreToStg.html#coreToStg_platform"><span class="hs-identifier hs-var">coreToStg_platform</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830259"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830259"><span class="hs-identifier hs-var">platform</span></a></span></span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681830260"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830260"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681830261"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830261"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681830262"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830262"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621681830263"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830263"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681830264"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830264"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-304"></span><span>        </span><span id="local-6989586621681830265"><span class="annot"><span class="annottext">env' :: IdEnv HowBound
</span><a href="#local-6989586621681830265"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound -&gt; Id -&gt; HowBound -&gt; IdEnv HowBound
forall a. VarEnv a -&gt; Id -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830261"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830263"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="#local-6989586621681830266"><span class="hs-identifier hs-var">how_bound</span></a></span><span>
</span><span id="line-305"></span><span>        </span><span id="local-6989586621681830266"><span class="annot"><span class="annottext">how_bound :: HowBound
</span><a href="#local-6989586621681830266"><span class="hs-identifier hs-var hs-var">how_bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetInfo -&gt; Int -&gt; HowBound
</span><a href="GHC.CoreToStg.html#LetBound"><span class="hs-identifier hs-var">LetBound</span></a></span><span> </span><span class="annot"><span class="annottext">LetInfo
</span><a href="GHC.CoreToStg.html#TopLet"><span class="hs-identifier hs-var">TopLet</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; HowBound) -&gt; Int -&gt; HowBound
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; Int
</span><a href="GHC.Core.Opt.Arity.html#manifestArity"><span class="hs-identifier hs-var">manifestArity</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830264"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681830268"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830268"><span class="hs-identifier hs-var">ccs'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830269"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830269"><span class="hs-identifier hs-var">id'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830270"><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681830270"><span class="hs-identifier hs-var">stg_rhs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>            </span><span class="annot"><span class="annottext">Platform
-&gt; IdEnv HowBound
-&gt; CtsM (CollectedCCs, (Id, StgRhs))
-&gt; (CollectedCCs, (Id, StgRhs))
forall a. Platform -&gt; IdEnv HowBound -&gt; CtsM a -&gt; a
</span><a href="GHC.CoreToStg.html#initCts"><span class="hs-identifier hs-var">initCts</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830259"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830261"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">(CtsM (CollectedCCs, (Id, StgRhs)) -&gt; (CollectedCCs, (Id, StgRhs)))
-&gt; CtsM (CollectedCCs, (Id, StgRhs))
-&gt; (CollectedCCs, (Id, StgRhs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-309"></span><span>              </span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; CollectedCCs
-&gt; (Id, CoreArg)
-&gt; CtsM (CollectedCCs, (Id, StgRhs))
</span><a href="GHC.CoreToStg.html#coreToTopStgRhs"><span class="hs-identifier hs-var">coreToTopStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830257"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830260"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830262"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830263"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830264"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>        </span><span id="local-6989586621681830273"><span class="annot"><span class="annottext">bind :: StgTopBinding
</span><a href="#local-6989586621681830273"><span class="hs-identifier hs-var hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla -&gt; StgTopBinding
forall (pass :: StgPass).
GenStgBinding pass -&gt; GenStgTopBinding pass
</span><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a></span><span> </span><span class="annot"><span class="annottext">(GenStgBinding 'Vanilla -&gt; StgTopBinding)
-&gt; GenStgBinding 'Vanilla -&gt; StgTopBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BinderP 'Vanilla -&gt; StgRhs -&gt; GenStgBinding 'Vanilla
forall (pass :: StgPass).
BinderP pass -&gt; GenStgRhs pass -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
BinderP 'Vanilla
</span><a href="#local-6989586621681830269"><span class="hs-identifier hs-var">id'</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681830270"><span class="hs-identifier hs-var">stg_rhs</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-313"></span><span>      </span><span class="hs-comment">-- NB: previously the assertion printed 'rhs' and 'bind'</span><span>
</span><span id="line-314"></span><span>      </span><span class="hs-comment">--     as well as 'id', but that led to a black hole</span><span>
</span><span id="line-315"></span><span>      </span><span class="hs-comment">--     where printing the assertion error tripped the</span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-comment">--     assertion again!</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830265"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830268"><span class="hs-identifier hs-var">ccs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgTopBinding
</span><a href="#local-6989586621681830273"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="annot"><a href="GHC.CoreToStg.html#coreTopBindToStg"><span class="hs-identifier hs-var">coreTopBindToStg</span></a></span><span> </span><span id="local-6989586621681830276"><span class="annot"><span class="annottext">opts :: CoreToStgOpts
</span><a href="#local-6989586621681830276"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">coreToStg_platform :: CoreToStgOpts -&gt; Platform
</span><a href="GHC.CoreToStg.html#coreToStg_platform"><span class="hs-identifier hs-var">coreToStg_platform</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830277"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830277"><span class="hs-identifier hs-var">platform</span></a></span></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681830278"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830278"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681830279"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830279"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681830280"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830280"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621681830282"><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830282"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (IdEnv HowBound, CollectedCCs, StgTopBinding)
-&gt; (IdEnv HowBound, CollectedCCs, StgTopBinding)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Id, CoreArg)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830282"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((IdEnv HowBound, CollectedCCs, StgTopBinding)
 -&gt; (IdEnv HowBound, CollectedCCs, StgTopBinding))
-&gt; (IdEnv HowBound, CollectedCCs, StgTopBinding)
-&gt; (IdEnv HowBound, CollectedCCs, StgTopBinding)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621681830286"><span class="annot"><span class="annottext">extra_env' :: [(Id, HowBound)]
</span><a href="#local-6989586621681830286"><span class="hs-identifier hs-var hs-var">extra_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830287"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LetInfo -&gt; Int -&gt; HowBound
</span><a href="GHC.CoreToStg.html#LetBound"><span class="hs-identifier hs-var">LetBound</span></a></span><span> </span><span class="annot"><span class="annottext">LetInfo
</span><a href="GHC.CoreToStg.html#TopLet"><span class="hs-identifier hs-var">TopLet</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; HowBound) -&gt; Int -&gt; HowBound
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; Int
</span><a href="GHC.Core.Opt.Arity.html#manifestArity"><span class="hs-identifier hs-var">manifestArity</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830288"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830287"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830287"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830288"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830288"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830282"><span class="hs-identifier hs-var">pairs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span>        </span><span id="local-6989586621681830289"><span class="annot"><span class="annottext">env' :: IdEnv HowBound
</span><a href="#local-6989586621681830289"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound -&gt; [(Id, HowBound)] -&gt; IdEnv HowBound
forall a. VarEnv a -&gt; [(Id, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnvList"><span class="hs-identifier hs-var">extendVarEnvList</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830279"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)]
</span><a href="#local-6989586621681830286"><span class="hs-identifier hs-var">extra_env'</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-comment">-- generate StgTopBindings and CAF cost centres created for CAFs</span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681830291"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830291"><span class="hs-identifier hs-var">ccs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830292"><span class="annot"><span class="annottext">[(Id, StgRhs)]
</span><a href="#local-6989586621681830292"><span class="hs-identifier hs-var">stg_rhss</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform
-&gt; IdEnv HowBound
-&gt; CtsM (CollectedCCs, [(Id, StgRhs)])
-&gt; (CollectedCCs, [(Id, StgRhs)])
forall a. Platform -&gt; IdEnv HowBound -&gt; CtsM a -&gt; a
</span><a href="GHC.CoreToStg.html#initCts"><span class="hs-identifier hs-var">initCts</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830277"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830289"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">(CtsM (CollectedCCs, [(Id, StgRhs)])
 -&gt; (CollectedCCs, [(Id, StgRhs)]))
-&gt; CtsM (CollectedCCs, [(Id, StgRhs)])
-&gt; (CollectedCCs, [(Id, StgRhs)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectedCCs
 -&gt; (Id, CoreArg) -&gt; CtsM (CollectedCCs, (Id, StgRhs)))
-&gt; CollectedCCs
-&gt; [(Id, CoreArg)]
-&gt; CtsM (CollectedCCs, [(Id, StgRhs)])
forall (m :: * -&gt; *) (t :: * -&gt; *) acc x y.
(Monad m, Traversable t) =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; t x -&gt; m (acc, t y)
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; CollectedCCs
-&gt; (Id, CoreArg)
-&gt; CtsM (CollectedCCs, (Id, StgRhs))
</span><a href="GHC.CoreToStg.html#coreToTopStgRhs"><span class="hs-identifier hs-var">coreToTopStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830276"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830278"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830280"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830282"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span id="local-6989586621681830294"><span class="annot"><span class="annottext">bind :: StgTopBinding
</span><a href="#local-6989586621681830294"><span class="hs-identifier hs-var hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla -&gt; StgTopBinding
forall (pass :: StgPass).
GenStgBinding pass -&gt; GenStgTopBinding pass
</span><a href="GHC.Stg.Syntax.html#StgTopLifted"><span class="hs-identifier hs-var">StgTopLifted</span></a></span><span> </span><span class="annot"><span class="annottext">(GenStgBinding 'Vanilla -&gt; StgTopBinding)
-&gt; GenStgBinding 'Vanilla -&gt; StgTopBinding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(BinderP 'Vanilla, StgRhs)] -&gt; GenStgBinding 'Vanilla
forall (pass :: StgPass).
[(BinderP pass, GenStgRhs pass)] -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, StgRhs)]
[(BinderP 'Vanilla, StgRhs)]
</span><a href="#local-6989586621681830292"><span class="hs-identifier hs-var">stg_rhss</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830289"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830291"><span class="hs-identifier hs-var">ccs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StgTopBinding
</span><a href="#local-6989586621681830294"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToTopStgRhs"><span class="hs-identifier hs-type">coreToTopStgRhs</span></a></span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span id="coreToTopStgRhs"><span class="annot"><span class="annottext">coreToTopStgRhs :: CoreToStgOpts
-&gt; Module
-&gt; CollectedCCs
-&gt; (Id, CoreArg)
-&gt; CtsM (CollectedCCs, (Id, StgRhs))
</span><a href="GHC.CoreToStg.html#coreToTopStgRhs"><span class="hs-identifier hs-var hs-var">coreToTopStgRhs</span></a></span></span><span> </span><span id="local-6989586621681830297"><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830297"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621681830298"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830298"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681830299"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830299"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830300"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830300"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830301"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830301"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681830302"><span class="annot"><span class="annottext">PreStgRhs
</span><a href="#local-6989586621681830302"><span class="hs-identifier hs-var">new_rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM PreStgRhs
CoreArg -&gt; CtsM PreStgRhs
</span><a href="GHC.CoreToStg.html#coreToPreStgRhs"><span class="hs-identifier hs-var">coreToPreStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830301"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830304"><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681830304"><span class="hs-identifier hs-var">stg_rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830305"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830305"><span class="hs-identifier hs-var">ccs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-346"></span><span>               </span><span class="annot"><span class="annottext">CoreToStgOpts
-&gt; Module
-&gt; CollectedCCs
-&gt; Id
-&gt; PreStgRhs
-&gt; (StgRhs, CollectedCCs)
</span><a href="GHC.CoreToStg.html#mkTopStgRhs"><span class="hs-identifier hs-var">mkTopStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToStgOpts
</span><a href="#local-6989586621681830297"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830298"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830299"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830300"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">PreStgRhs
</span><a href="#local-6989586621681830302"><span class="hs-identifier hs-var">new_rhs</span></a></span><span>
</span><span id="line-347"></span><span>             </span><span id="local-6989586621681830307"><span class="annot"><span class="annottext">stg_arity :: Int
</span><a href="#local-6989586621681830307"><span class="hs-identifier hs-var hs-var">stg_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>               </span><span class="annot"><span class="annottext">StgRhs -&gt; Int
</span><a href="GHC.Stg.Syntax.html#stgRhsArity"><span class="hs-identifier hs-var">stgRhsArity</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681830304"><span class="hs-identifier hs-var">stg_rhs</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(CollectedCCs, (Id, StgRhs)) -&gt; CtsM (CollectedCCs, (Id, StgRhs))
forall a. a -&gt; CtsM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830305"><span class="hs-identifier hs-var">ccs'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830300"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; StgRhs -&gt; StgRhs
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Bool
</span><a href="#local-6989586621681830310"><span class="hs-identifier hs-var">arity_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830307"><span class="hs-identifier hs-var">stg_arity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc
</span><a href="#local-6989586621681830311"><span class="hs-identifier hs-var">mk_arity_msg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830307"><span class="hs-identifier hs-var">stg_arity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681830304"><span class="hs-identifier hs-var">stg_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-comment">-- It's vital that the arity on a top-level Id matches</span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-comment">-- the arity of the generated STG binding, else an importing</span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-comment">-- module will use the wrong calling convention</span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-comment">--      (#2844 was an example where this happened)</span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-comment">-- NB1: we can't move the assertion further out without</span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-comment">--      blocking the &quot;knot&quot; tied in coreTopBindsToStg</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-comment">-- NB2: the arity check is only needed for Ids with External</span><span>
</span><span id="line-359"></span><span>        </span><span class="hs-comment">--      Names, because they are externally visible.  The CorePrep</span><span>
</span><span id="line-360"></span><span>        </span><span class="hs-comment">--      pass introduces &quot;sat&quot; things with Local Names and does</span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-comment">--      not bother to set their Arity info, so don't fail for those</span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621681830310"><span class="annot"><span class="annottext">arity_ok :: Int -&gt; Bool
</span><a href="#local-6989586621681830310"><span class="hs-identifier hs-var hs-var">arity_ok</span></a></span></span><span> </span><span id="local-6989586621681830312"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830312"><span class="hs-identifier hs-var">stg_arity</span></a></span></span><span>
</span><span id="line-363"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830300"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830314"><span class="hs-identifier hs-var">id_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830312"><span class="hs-identifier hs-var">stg_arity</span></a></span><span>
</span><span id="line-364"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621681830314"><span class="annot"><span class="annottext">id_arity :: Int
</span><a href="#local-6989586621681830314"><span class="hs-identifier hs-var hs-var">id_arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Types.Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830300"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621681830311"><span class="annot"><span class="annottext">mk_arity_msg :: Int -&gt; SDoc
</span><a href="#local-6989586621681830311"><span class="hs-identifier hs-var hs-var">mk_arity_msg</span></a></span></span><span> </span><span id="local-6989586621681830316"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830316"><span class="hs-identifier hs-var">stg_arity</span></a></span></span><span>
</span><span id="line-367"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsDoc doc =&gt; [doc] -&gt; doc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830300"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-368"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Id arity:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830314"><span class="hs-identifier hs-var">id_arity</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-369"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;STG arity:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830316"><span class="hs-identifier hs-var">stg_arity</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- Expressions</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">-- coreToStgExpr panics if the input expression is a value lambda. CorePrep</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- ensures that value lambdas only exist as the RHS of bindings, which we</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- handle with the function coreToPreStgRhs.</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-type">coreToStgExpr</span></a></span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-comment">-- The second and third components can be derived in a simple bottom up pass, not</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- dependent on any decisions about which variables will be let-no-escaped or</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- not.  The first component, that is, the decorated expression, may then depend</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- on these components, but it in turn is not scrutinised as the basis for any</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- decisions.  Hence no black holes.</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">-- No bignum literal should be left by the time this is called.</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- CorePrep should have converted them all to a real core representation.</span><span>
</span><span id="line-391"></span><span id="coreToStgExpr"><span class="annot"><span class="annottext">coreToStgExpr :: (() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var hs-var">coreToStgExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Literal.html#LitNumber"><span class="hs-identifier hs-type">LitNumber</span></a></span><span> </span><span class="annot"><span class="annottext">LitNumType
</span><a href="GHC.Types.Literal.html#LitNumBigNat"><span class="hs-identifier hs-var">LitNumBigNat</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; CtsM StgExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coreToStgExpr: LitNumBigNat&quot;</span></span><span>
</span><span id="line-392"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621681830360"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681830360"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgExpr -&gt; CtsM StgExpr
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; StgExpr
forall (pass :: StgPass). Literal -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-var">StgLit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681830360"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681830363"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830363"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [CoreArg] -&gt; [CoreTickish] -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgApp"><span class="hs-identifier hs-var">coreToStgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830363"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-comment">-- See Note [Coercion tokens]</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [CoreArg] -&gt; [CoreTickish] -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgApp"><span class="hs-identifier hs-var">coreToStgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Types.Id.Make.html#coercionTokenId"><span class="hs-identifier hs-var">coercionTokenId</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span id="local-6989586621681830366"><span class="annot"><span class="annottext">expr :: CoreArg
</span><a href="#local-6989586621681830366"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830368"><span class="hs-identifier hs-var">app_head</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-400"></span><span>      </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681830369"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830369"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [CoreArg] -&gt; [CoreTickish] -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgApp"><span class="hs-identifier hs-var">coreToStgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830369"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830370"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830371"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="hs-comment">-- Regular application</span><span>
</span><span id="line-401"></span><span>      </span><span class="annot"><a href="GHC.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span id="local-6989586621681830372"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681830372"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Bool
</span><a href="GHC.Types.Literal.html#isLitRubbish"><span class="hs-identifier hs-var">isLitRubbish</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621681830372"><span class="hs-identifier hs-var">l</span></a></span><span>             </span><span class="hs-comment">-- If there is LitRubbish at the head,</span><span>
</span><span id="line-402"></span><span>                                         </span><span class="hs-comment">--    discard the arguments</span><span>
</span><span id="line-403"></span><span>                                         </span><span class="hs-comment">--    Recompute representation, because in</span><span>
</span><span id="line-404"></span><span>                                         </span><span class="hs-comment">--    '(RUBBISH[rep] x) :: (T :: TYPE rep2)'</span><span>
</span><span id="line-405"></span><span>                                         </span><span class="hs-comment">--    rep might not be equal to rep2</span><span>
</span><span id="line-406"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StgExpr -&gt; CtsM StgExpr
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Literal -&gt; StgExpr
forall (pass :: StgPass). Literal -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLit"><span class="hs-identifier hs-var">StgLit</span></a></span><span> </span><span class="annot"><span class="annottext">(Literal -&gt; StgExpr) -&gt; Literal -&gt; StgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrConstraint -&gt; RuntimeRepType -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitRubbish"><span class="hs-identifier hs-var">LitRubbish</span></a></span><span> </span><span class="annot"><span class="annottext">TypeOrConstraint
</span><a href="GHC.Types.Basic.html#TypeLike"><span class="hs-identifier hs-var">TypeLike</span></a></span><span> </span><span class="annot"><span class="annottext">(RuntimeRepType -&gt; Literal) -&gt; RuntimeRepType -&gt; Literal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; RuntimeRepType -&gt; RuntimeRepType
RuntimeRepType -&gt; RuntimeRepType
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; RuntimeRepType
CoreArg -&gt; RuntimeRepType
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830366"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>      </span><span class="annot"><span class="annottext">CoreArg
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CtsM StgExpr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coreToStgExpr - Invalid app head:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830366"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-410"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681830368"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830368"><span class="hs-identifier hs-var">app_head</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830370"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830370"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830371"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830371"><span class="hs-identifier hs-var">ticks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt;
CoreArg -&gt; (CoreArg, [CoreArg], [CoreTickish])
CoreArg -&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="GHC.CoreToStg.html#myCollectArgs"><span class="hs-identifier hs-var">myCollectArgs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830366"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span id="local-6989586621681830380"><span class="annot"><span class="annottext">expr :: CoreArg
</span><a href="#local-6989586621681830380"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681830382"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830382"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830383"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830383"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; ([Id], CoreArg)
</span><a href="GHC.CoreToStg.html#myCollectBinders"><span class="hs-identifier hs-var">myCollectBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830380"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id]
</span><a href="GHC.CoreToStg.html#filterStgBinders"><span class="hs-identifier hs-var">filterStgBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830382"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830383"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>      </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CtsM StgExpr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coretoStgExpr&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; CtsM StgExpr) -&gt; SDoc -&gt; CtsM StgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected value lambda:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830380"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621681830388"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621681830388"><span class="hs-identifier hs-var">tick</span></a></span></span><span> </span><span id="local-6989586621681830389"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830389"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681830390"><span class="annot"><span class="annottext">stg_tick :: StgTickish
</span><a href="#local-6989586621681830390"><span class="hs-identifier hs-var hs-var">stg_tick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuntimeRepType -&gt; CoreTickish -&gt; StgTickish
</span><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-var">coreToStgTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; RuntimeRepType
CoreArg -&gt; RuntimeRepType
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830389"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621681830388"><span class="hs-identifier hs-var">tick</span></a></span><span>
</span><span id="line-425"></span><span>       </span><span class="hs-glyph">!</span><span id="local-6989586621681830392"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830392"><span class="hs-identifier hs-var">expr2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830389"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-426"></span><span>       </span><span class="annot"><span class="annottext">StgExpr -&gt; CtsM StgExpr
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgTickish -&gt; StgExpr -&gt; StgExpr
forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681830390"><span class="hs-identifier hs-var">stg_tick</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830392"><span class="hs-identifier hs-var">expr2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621681830395"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830395"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830395"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- Cases require a little more real work.</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">{-
coreToStgExpr (Case scrut _ _ [])
  = coreToStgExpr scrut
    -- See Note [Empty case alternatives] in GHC.Core If the case
    -- alternatives are empty, the scrutinee must diverge or raise an
    -- exception, so we can just dive into it.
    --
    -- Of course this may seg-fault if the scrutinee *does* return.  A
    -- belt-and-braces approach would be to move this case into the
    -- code generator, and put a return point anyway that calls a
    -- runtime system error function.

coreToStgExpr e0@(Case scrut bndr _ [alt]) = do
  | isUnsafeEqualityProof scrut
  , isDeadBinder bndr -- We can only discard the case if the case-binder is dead
                      -- It usually is, but see #18227
  , (_,_,rhs) &lt;- alt
  = coreToStgExpr rhs
    -- See (U2) in Note [Implementing unsafeCoerce] in base:Unsafe.Coerce
-}</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">-- The normal case for case-expressions</span><span>
</span><span id="line-455"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Case"><span class="hs-identifier hs-type">Case</span></a></span><span> </span><span id="local-6989586621681830397"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830397"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621681830398"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830398"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830399"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830399"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681830400"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830400"><span class="hs-identifier hs-var">scrut2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830397"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-457"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681830401"><span class="annot"><span class="annottext">[StgAlt]
</span><a href="#local-6989586621681830401"><span class="hs-identifier hs-var">alts2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)] -&gt; CtsM [StgAlt] -&gt; CtsM [StgAlt]
forall a. [(Id, HowBound)] -&gt; CtsM a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#extendVarEnvCts"><span class="hs-identifier hs-var">extendVarEnvCts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830398"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="GHC.CoreToStg.html#LambdaBound"><span class="hs-identifier hs-var">LambdaBound</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Alt Id -&gt; CtsM StgAlt) -&gt; [Alt Id] -&gt; CtsM [StgAlt]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Alt Id -&gt; CtsM StgAlt
</span><a href="#local-6989586621681830405"><span class="hs-identifier hs-var">vars_alt</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830399"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">StgExpr -&gt; CtsM StgExpr
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgExpr -&gt; BinderP 'Vanilla -&gt; AltType -&gt; [StgAlt] -&gt; StgExpr
forall (pass :: StgPass).
GenStgExpr pass
-&gt; BinderP pass -&gt; AltType -&gt; [GenStgAlt pass] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgCase"><span class="hs-identifier hs-var">StgCase</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830400"><span class="hs-identifier hs-var">scrut2</span></a></span><span> </span><span class="annot"><span class="annottext">Id
BinderP 'Vanilla
</span><a href="#local-6989586621681830398"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [Alt Id] -&gt; AltType
</span><a href="GHC.CoreToStg.html#mkStgAltType"><span class="hs-identifier hs-var">mkStgAltType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830398"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830399"><span class="hs-identifier hs-var">alts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgAlt]
</span><a href="#local-6989586621681830401"><span class="hs-identifier hs-var">alts2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-460"></span><span>    </span><span class="annot"><a href="#local-6989586621681830405"><span class="hs-identifier hs-type">vars_alt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgAlt"><span class="hs-identifier hs-type">StgAlt</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span id="local-6989586621681830405"><span class="annot"><span class="annottext">vars_alt :: Alt Id -&gt; CtsM StgAlt
</span><a href="#local-6989586621681830405"><span class="hs-identifier hs-var hs-var">vars_alt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span id="local-6989586621681830410"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621681830410"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681830411"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830411"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681830412"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830412"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>     </span><span class="hs-comment">-- Remove type variables</span><span>
</span><span id="line-463"></span><span>            </span><span id="local-6989586621681830413"><span class="annot"><span class="annottext">binders' :: [Id]
</span><a href="#local-6989586621681830413"><span class="hs-identifier hs-var hs-var">binders'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id]
</span><a href="GHC.CoreToStg.html#filterStgBinders"><span class="hs-identifier hs-var">filterStgBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830411"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-465"></span><span>        </span><span class="annot"><span class="annottext">[(Id, HowBound)] -&gt; CtsM StgAlt -&gt; CtsM StgAlt
forall a. [(Id, HowBound)] -&gt; CtsM a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#extendVarEnvCts"><span class="hs-identifier hs-var">extendVarEnvCts</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830414"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="GHC.CoreToStg.html#LambdaBound"><span class="hs-identifier hs-var">LambdaBound</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681830414"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830414"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830413"><span class="hs-identifier hs-var">binders'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(CtsM StgAlt -&gt; CtsM StgAlt) -&gt; CtsM StgAlt -&gt; CtsM StgAlt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>        </span><span id="local-6989586621681830415"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830415"><span class="hs-identifier hs-var">rhs2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830412"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-467"></span><span>        </span><span class="annot"><span class="annottext">StgAlt -&gt; CtsM StgAlt
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(StgAlt -&gt; CtsM StgAlt) -&gt; StgAlt -&gt; CtsM StgAlt
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24%21/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#GenStgAlt"><span class="hs-identifier hs-type">GenStgAlt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">alt_con :: AltCon
</span><a href="GHC.Stg.Syntax.html#alt_con"><span class="hs-identifier hs-var">alt_con</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621681830410"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-468"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_bndrs :: [BinderP 'Vanilla]
</span><a href="GHC.Stg.Syntax.html#alt_bndrs"><span class="hs-identifier hs-var">alt_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id]
[BinderP 'Vanilla]
</span><a href="#local-6989586621681830413"><span class="hs-identifier hs-var">binders'</span></a></span><span>
</span><span id="line-469"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">alt_rhs :: StgExpr
</span><a href="GHC.Stg.Syntax.html#alt_rhs"><span class="hs-identifier hs-var">alt_rhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830415"><span class="hs-identifier hs-var">rhs2</span></a></span><span>
</span><span id="line-470"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621681830421"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830421"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621681830422"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830422"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgLet"><span class="hs-identifier hs-var">coreToStgLet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830421"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830422"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-473"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span id="local-6989586621681830424"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830424"><span class="hs-identifier hs-var">e</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CtsM StgExpr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coreToStgExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830424"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="annot"><a href="GHC.CoreToStg.html#mkStgAltType"><span class="hs-identifier hs-type">mkStgAltType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#AltType"><span class="hs-identifier hs-type">AltType</span></a></span><span>
</span><span id="line-476"></span><span id="mkStgAltType"><span class="annot"><span class="annottext">mkStgAltType :: Id -&gt; [Alt Id] -&gt; AltType
</span><a href="GHC.CoreToStg.html#mkStgAltType"><span class="hs-identifier hs-var hs-var">mkStgAltType</span></a></span></span><span> </span><span id="local-6989586621681830425"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830425"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span id="local-6989586621681830426"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830426"><span class="hs-identifier hs-var">alts</span></a></span></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">RuntimeRepType -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830428"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830428"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; AltType
</span><a href="GHC.Stg.Syntax.html#MultiValAlt"><span class="hs-identifier hs-var">MultiValAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PrimRep] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681830433"><span class="hs-identifier hs-var">prim_reps</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- always use MultiValAlt for unboxed tuples</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681830433"><span class="hs-identifier hs-var">prim_reps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-482"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621681830434"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681830434"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGcPtrRep"><span class="hs-identifier hs-var">isGcPtrRep</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681830434"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-483"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RuntimeRepType -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeRepType -&gt; RuntimeRepType
</span><a href="GHC.Types.RepType.html#unwrapType"><span class="hs-identifier hs-var">unwrapType</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830428"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-484"></span><span>          </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681830438"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830438"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAbstractTyCon"><span class="hs-identifier hs-var">isAbstractTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830438"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="#local-6989586621681830440"><span class="hs-identifier hs-var">look_for_better_tycon</span></a></span><span>
</span><span id="line-486"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830438"><span class="hs-identifier hs-var">tc</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; AltType
</span><a href="GHC.Stg.Syntax.html#AlgAlt"><span class="hs-identifier hs-var">AlgAlt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830438"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-487"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; AltType -&gt; AltType
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="#local-6989586621681830443"><span class="hs-identifier hs-var">_is_poly_alt_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830438"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830438"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="GHC.Stg.Syntax.html#PolyAlt"><span class="hs-identifier hs-var">PolyAlt</span></a></span><span>
</span><span id="line-488"></span><span>          </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AltType
</span><a href="GHC.Stg.Syntax.html#PolyAlt"><span class="hs-identifier hs-var">PolyAlt</span></a></span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621681830445"><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681830445"><span class="hs-identifier hs-var">non_gcd</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimRep -&gt; AltType
</span><a href="GHC.Stg.Syntax.html#PrimAlt"><span class="hs-identifier hs-var">PrimAlt</span></a></span><span> </span><span class="annot"><span class="annottext">PrimRep
</span><a href="#local-6989586621681830445"><span class="hs-identifier hs-var">non_gcd</span></a></span><span>
</span><span id="line-490"></span><span>      </span><span id="local-6989586621681830447"><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681830447"><span class="hs-identifier hs-var">not_unary</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; AltType
</span><a href="GHC.Stg.Syntax.html#MultiValAlt"><span class="hs-identifier hs-var">MultiValAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PrimRep] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681830447"><span class="hs-identifier hs-var">not_unary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-492"></span><span>   </span><span id="local-6989586621681830428"><span class="annot"><span class="annottext">bndr_ty :: RuntimeRepType
</span><a href="#local-6989586621681830428"><span class="hs-identifier hs-var hs-var">bndr_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; RuntimeRepType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830425"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-493"></span><span>   </span><span id="local-6989586621681830433"><span class="annot"><span class="annottext">prim_reps :: [PrimRep]
</span><a href="#local-6989586621681830433"><span class="hs-identifier hs-var hs-var">prim_reps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; RuntimeRepType -&gt; [PrimRep]
RuntimeRepType -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830428"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span>   </span><span id="local-6989586621681830443"><span class="annot"><span class="annottext">_is_poly_alt_tycon :: TyCon -&gt; Bool
</span><a href="#local-6989586621681830443"><span class="hs-identifier hs-var hs-var">_is_poly_alt_tycon</span></a></span></span><span> </span><span id="local-6989586621681830450"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830450"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830450"><span class="hs-identifier hs-var">tc</span></a></span><span>   </span><span class="hs-comment">-- &quot;Any&quot; is lifted but primitive</span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFamilyTyCon"><span class="hs-identifier hs-var">isFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681830450"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-comment">-- Type family; e.g. Any, or arising from strict</span><span>
</span><span id="line-498"></span><span>                            </span><span class="hs-comment">-- function application where argument has a</span><span>
</span><span id="line-499"></span><span>                            </span><span class="hs-comment">-- type-family type</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>   </span><span class="hs-comment">-- Sometimes, the TyCon is a AbstractTyCon which may not have any</span><span>
</span><span id="line-502"></span><span>   </span><span class="hs-comment">-- constructors inside it.  Then we may get a better TyCon by</span><span>
</span><span id="line-503"></span><span>   </span><span class="hs-comment">-- grabbing the one from a constructor alternative</span><span>
</span><span id="line-504"></span><span>   </span><span class="hs-comment">-- if one exists.</span><span>
</span><span id="line-505"></span><span>   </span><span id="local-6989586621681830440"><span class="annot"><span class="annottext">look_for_better_tycon :: AltType
</span><a href="#local-6989586621681830440"><span class="hs-identifier hs-var hs-var">look_for_better_tycon</span></a></span></span><span>
</span><span id="line-506"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-type">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621681830454"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830454"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830455"><span class="hs-identifier hs-var">data_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-507"></span><span>                </span><span class="annot"><span class="annottext">TyCon -&gt; AltType
</span><a href="GHC.Stg.Syntax.html#AlgAlt"><span class="hs-identifier hs-var">AlgAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830454"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-509"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; AltType -&gt; AltType
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Alt Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830455"><span class="hs-identifier hs-var">data_alts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                </span><span class="annot"><span class="annottext">AltType
</span><a href="GHC.Stg.Syntax.html#PolyAlt"><span class="hs-identifier hs-var">PolyAlt</span></a></span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-512"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621681830455"><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830455"><span class="hs-identifier hs-var">data_alts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830457"><span class="annot"><span class="annottext">Maybe CoreArg
</span><a href="#local-6989586621681830457"><span class="hs-identifier hs-var">_deflt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Alt Id] -&gt; ([Alt Id], Maybe CoreArg)
forall b. [Alt b] -&gt; ([Alt b], Maybe (Expr b))
</span><a href="GHC.Core.Utils.html#findDefault"><span class="hs-identifier hs-var">findDefault</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Id]
</span><a href="#local-6989586621681830426"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- Applications</span><span>
</span><span id="line-516"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgApp"><span class="hs-identifier hs-type">coreToStgApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>            </span><span class="hs-comment">-- Function</span><span>
</span><span id="line-519"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreArg"><span class="hs-identifier hs-type">CoreArg</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Arguments</span><span>
</span><span id="line-520"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Debug ticks</span><span>
</span><span id="line-521"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a></span><span>
</span><span id="line-522"></span><span id="coreToStgApp"><span class="annot"><span class="annottext">coreToStgApp :: Id -&gt; [CoreArg] -&gt; [CoreTickish] -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgApp"><span class="hs-identifier hs-var hs-var">coreToStgApp</span></a></span></span><span> </span><span id="local-6989586621681830459"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681830460"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830460"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681830461"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830461"><span class="hs-identifier hs-var">ticks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830462"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830462"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830463"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830463"><span class="hs-identifier hs-var">ticks'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreArg] -&gt; CtsM ([StgArg], [StgTickish])
</span><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var">coreToStgArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830460"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span id="local-6989586621681830465"><span class="annot"><span class="annottext">HowBound
</span><a href="#local-6989586621681830465"><span class="hs-identifier hs-var">how_bound</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CtsM HowBound
</span><a href="GHC.CoreToStg.html#lookupVarCts"><span class="hs-identifier hs-var">lookupVarCts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-527"></span><span>        </span><span id="local-6989586621681830467"><span class="annot"><span class="annottext">n_val_args :: Int
</span><a href="#local-6989586621681830467"><span class="hs-identifier hs-var hs-var">n_val_args</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreArg] -&gt; Int
forall b. [Arg b] -&gt; Int
</span><a href="GHC.Core.html#valArgCount"><span class="hs-identifier hs-var">valArgCount</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830460"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-comment">-- Mostly, the arity info of a function is in the fn's IdInfo</span><span>
</span><span id="line-530"></span><span>        </span><span class="hs-comment">-- But new bindings introduced by CoreSat may not have no</span><span>
</span><span id="line-531"></span><span>        </span><span class="hs-comment">-- arity info; it would do us no good anyway.  For example:</span><span>
</span><span id="line-532"></span><span>        </span><span class="hs-comment">--      let f = \ab -&gt; e in f</span><span>
</span><span id="line-533"></span><span>        </span><span class="hs-comment">-- No point in having correct arity info for f!</span><span>
</span><span id="line-534"></span><span>        </span><span class="hs-comment">-- Hence the hasArity stuff below.</span><span>
</span><span id="line-535"></span><span>        </span><span class="hs-comment">-- NB: f_arity is only consulted for LetBound things</span><span>
</span><span id="line-536"></span><span>        </span><span id="local-6989586621681830469"><span class="annot"><span class="annottext">f_arity :: Int
</span><a href="#local-6989586621681830469"><span class="hs-identifier hs-var hs-var">f_arity</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; HowBound -&gt; Int
</span><a href="GHC.CoreToStg.html#stgArity"><span class="hs-identifier hs-var">stgArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="#local-6989586621681830465"><span class="hs-identifier hs-var">how_bound</span></a></span><span>
</span><span id="line-537"></span><span>        </span><span id="local-6989586621681830471"><span class="annot"><span class="annottext">saturated :: Bool
</span><a href="#local-6989586621681830471"><span class="hs-identifier hs-var hs-var">saturated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830469"><span class="hs-identifier hs-var">f_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830467"><span class="hs-identifier hs-var">n_val_args</span></a></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>        </span><span id="local-6989586621681830473"><span class="annot"><span class="annottext">res_ty :: RuntimeRepType
</span><a href="#local-6989586621681830473"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; RuntimeRepType
CoreArg -&gt; RuntimeRepType
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg -&gt; [CoreArg] -&gt; CoreArg
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreArg
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830460"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>        </span><span id="local-6989586621681830475"><span class="annot"><span class="annottext">app :: StgExpr
</span><a href="#local-6989586621681830475"><span class="hs-identifier hs-var hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-541"></span><span>                </span><span class="annot"><a href="GHC.Types.Id.Info.html#DataConWorkId"><span class="hs-identifier hs-type">DataConWorkId</span></a></span><span> </span><span id="local-6989586621681830478"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830478"><span class="hs-identifier hs-var">dc</span></a></span></span><span>
</span><span id="line-542"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830471"><span class="hs-identifier hs-var">saturated</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ConstructorNumber -&gt; [StgArg] -&gt; [RuntimeRepType] -&gt; StgExpr
forall (pass :: StgPass).
DataCon
-&gt; ConstructorNumber
-&gt; [StgArg]
-&gt; [RuntimeRepType]
-&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-var">StgConApp</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830478"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="GHC.Stg.Syntax.html#NoNumber"><span class="hs-identifier hs-var">NoNumber</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830462"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-543"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RuntimeRepType] -&gt; [RuntimeRepType]
</span><a href="GHC.Core.Type.html#dropRuntimeRepArgs"><span class="hs-identifier hs-var">dropRuntimeRepArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[RuntimeRepType] -&gt; Maybe [RuntimeRepType] -&gt; [RuntimeRepType]
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeRepType -&gt; Maybe [RuntimeRepType]
</span><a href="GHC.Core.Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830473"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span>                </span><span class="hs-comment">-- Some primitive operator that might be implemented as a library call.</span><span>
</span><span id="line-546"></span><span>                </span><span class="hs-comment">-- As noted by Note [Eta expanding primops] in GHC.Builtin.PrimOps</span><span>
</span><span id="line-547"></span><span>                </span><span class="hs-comment">-- we require that primop applications be saturated.</span><span>
</span><span id="line-548"></span><span>                </span><span class="annot"><a href="GHC.Types.Id.Info.html#PrimOpId"><span class="hs-identifier hs-type">PrimOpId</span></a></span><span> </span><span id="local-6989586621681830484"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621681830484"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- assertPpr saturated (ppr f &lt;+&gt; ppr args) $</span><span>
</span><span id="line-549"></span><span>                                    </span><span class="annot"><span class="annottext">StgOp -&gt; [StgArg] -&gt; RuntimeRepType -&gt; StgExpr
forall (pass :: StgPass).
StgOp -&gt; [StgArg] -&gt; RuntimeRepType -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp -&gt; StgOp
</span><a href="GHC.Stg.Syntax.html#StgPrimOp"><span class="hs-identifier hs-var">StgPrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621681830484"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830462"><span class="hs-identifier hs-var">args'</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830473"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>                </span><span class="hs-comment">-- A call to some primitive Cmm function.</span><span>
</span><span id="line-552"></span><span>                </span><span class="annot"><a href="GHC.Types.Id.Info.html#FCallId"><span class="hs-identifier hs-type">FCallId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCall"><span class="hs-identifier hs-type">CCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#CCallSpec"><span class="hs-identifier hs-type">CCallSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.ForeignCall.html#StaticTarget"><span class="hs-identifier hs-type">StaticTarget</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830491"><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621681830491"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681830492"><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621681830492"><span class="hs-identifier hs-var">pkgId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>                                          </span><span class="annot"><span class="annottext">CCallConv
</span><a href="GHC.Types.ForeignCall.html#PrimCallConv"><span class="hs-identifier hs-var">PrimCallConv</span></a></span><span> </span><span class="annot"><span class="annottext">Safety
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; StgExpr -&gt; StgExpr
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830471"><span class="hs-identifier hs-var">saturated</span></a></span><span> </span><span class="annot"><span class="annottext">(StgExpr -&gt; StgExpr) -&gt; StgExpr -&gt; StgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-555"></span><span>                                    </span><span class="annot"><span class="annottext">StgOp -&gt; [StgArg] -&gt; RuntimeRepType -&gt; StgExpr
forall (pass :: StgPass).
StgOp -&gt; [StgArg] -&gt; RuntimeRepType -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimCall -&gt; StgOp
</span><a href="GHC.Stg.Syntax.html#StgPrimCallOp"><span class="hs-identifier hs-var">StgPrimCallOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CLabelString -&gt; Unit -&gt; PrimCall
</span><a href="GHC.Builtin.PrimOps.html#PrimCall"><span class="hs-identifier hs-var">PrimCall</span></a></span><span> </span><span class="annot"><span class="annottext">CLabelString
</span><a href="#local-6989586621681830491"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621681830492"><span class="hs-identifier hs-var">pkgId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830462"><span class="hs-identifier hs-var">args'</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830473"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>                </span><span class="hs-comment">-- A regular foreign call.</span><span>
</span><span id="line-558"></span><span>                </span><span class="annot"><a href="GHC.Types.Id.Info.html#FCallId"><span class="hs-identifier hs-type">FCallId</span></a></span><span> </span><span id="local-6989586621681830496"><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621681830496"><span class="hs-identifier hs-var">call</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; StgExpr -&gt; StgExpr
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#assert"><span class="hs-identifier hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830471"><span class="hs-identifier hs-var">saturated</span></a></span><span> </span><span class="annot"><span class="annottext">(StgExpr -&gt; StgExpr) -&gt; StgExpr -&gt; StgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-559"></span><span>                                    </span><span class="annot"><span class="annottext">StgOp -&gt; [StgArg] -&gt; RuntimeRepType -&gt; StgExpr
forall (pass :: StgPass).
StgOp -&gt; [StgArg] -&gt; RuntimeRepType -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgOpApp"><span class="hs-identifier hs-var">StgOpApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignCall -&gt; RuntimeRepType -&gt; StgOp
</span><a href="GHC.Stg.Syntax.html#StgFCallOp"><span class="hs-identifier hs-var">StgFCallOp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignCall
</span><a href="#local-6989586621681830496"><span class="hs-identifier hs-var">call</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; RuntimeRepType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830462"><span class="hs-identifier hs-var">args'</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830473"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span>                </span><span class="annot"><a href="GHC.Types.Id.Info.html#TickBoxOpId"><span class="hs-identifier hs-type">TickBoxOpId</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; StgExpr
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coreToStg TickBox&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; StgExpr) -&gt; SDoc -&gt; StgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, [StgArg]) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830462"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>                </span><span id="local-6989586621681830499"><span class="annot"><span class="annottext">IdDetails
</span><a href="#local-6989586621681830499"><span class="hs-identifier hs-var">_other</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [StgArg] -&gt; StgExpr
forall (pass :: StgPass). Id -&gt; [StgArg] -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgApp"><span class="hs-identifier hs-var">StgApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830459"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830462"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>        </span><span id="local-6989586621681830501"><span class="annot"><span class="annottext">add_tick :: StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="#local-6989586621681830501"><span class="hs-identifier hs-var hs-var">add_tick</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681830502"><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681830502"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681830503"><span class="annot"><span class="annottext">GenStgExpr pass
</span><a href="#local-6989586621681830503"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgTick"><span class="hs-identifier hs-var">StgTick</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish
</span><a href="#local-6989586621681830502"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgExpr pass
</span><a href="#local-6989586621681830503"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-565"></span><span>        </span><span id="local-6989586621681830504"><span class="annot"><span class="annottext">tapp :: StgExpr
</span><a href="#local-6989586621681830504"><span class="hs-identifier hs-var hs-var">tapp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgTickish -&gt; StgExpr -&gt; StgExpr)
-&gt; StgExpr -&gt; [StgTickish] -&gt; StgExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish -&gt; StgExpr -&gt; StgExpr
forall (pass :: StgPass).
StgTickish -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="#local-6989586621681830501"><span class="hs-identifier hs-var">add_tick</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830475"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreTickish -&gt; StgTickish) -&gt; [CoreTickish] -&gt; [StgTickish]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeRepType -&gt; CoreTickish -&gt; StgTickish
</span><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-var">coreToStgTick</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830473"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830461"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish] -&gt; [StgTickish] -&gt; [StgTickish]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830463"><span class="hs-identifier hs-var">ticks'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-comment">-- Forcing these fixes a leak in the code generator, noticed while</span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-comment">-- profiling for trac #4367</span><span>
</span><span id="line-569"></span><span>    </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830475"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr -&gt; CtsM StgExpr -&gt; CtsM StgExpr
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">StgExpr -&gt; CtsM StgExpr
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830504"><span class="hs-identifier hs-var">tapp</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-572"></span><span class="hs-comment">-- Argument lists</span><span>
</span><span id="line-573"></span><span class="hs-comment">-- This is the guy that turns applications into A-normal form</span><span>
</span><span id="line-574"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><a href="GHC.CoreToStg.html#getStgArgFromTrivialArg"><span class="hs-identifier hs-type">getStgArgFromTrivialArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreArg"><span class="hs-identifier hs-type">CoreArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span>
</span><span id="line-577"></span><span class="hs-comment">-- A (non-erased) trivial CoreArg corresponds to an atomic StgArg.</span><span>
</span><span id="line-578"></span><span class="hs-comment">-- CoreArgs may not immediately look trivial, e.g., `case e of {}` or</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- `case unsafeequalityProof of UnsafeRefl -&gt; e` might intervene.</span><span>
</span><span id="line-580"></span><span class="hs-comment">-- Good thing we can just call `trivial_expr_fold` here.</span><span>
</span><span id="line-581"></span><span id="getStgArgFromTrivialArg"><span class="annot"><span class="annottext">getStgArgFromTrivialArg :: (() :: Constraint) =&gt; CoreArg -&gt; StgArg
</span><a href="GHC.CoreToStg.html#getStgArgFromTrivialArg"><span class="hs-identifier hs-var hs-var">getStgArgFromTrivialArg</span></a></span></span><span> </span><span id="local-6989586621681830511"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830511"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681830512"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830512"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; Maybe ByteString
</span><a href="GHC.Core.Utils.html#exprIsTickedString_maybe"><span class="hs-identifier hs-var">exprIsTickedString_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830511"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- This case is just for backport to GHC 9.8,</span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Literal
</span><a href="GHC.Types.Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681830512"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- where we used to treat strings as valid StgArgs</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; StgArg)
-&gt; (Literal -&gt; StgArg) -&gt; StgArg -&gt; StgArg -&gt; CoreArg -&gt; StgArg
forall r. (Id -&gt; r) -&gt; (Literal -&gt; r) -&gt; r -&gt; r -&gt; CoreArg -&gt; r
</span><a href="GHC.Core.Utils.html#trivial_expr_fold"><span class="hs-identifier hs-var">trivial_expr_fold</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgLitArg"><span class="hs-identifier hs-var">StgLitArg</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681830517"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681830517"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830511"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-587"></span><span>    </span><span id="local-6989586621681830517"><span class="annot"><span class="annottext">panic :: StgArg
</span><a href="#local-6989586621681830517"><span class="hs-identifier hs-var hs-var">panic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; StgArg
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getStgArgFromTrivialArg&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830511"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-type">coreToStgArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreArg"><span class="hs-identifier hs-type">CoreArg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgArg"><span class="hs-identifier hs-type">StgArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#StgTickish"><span class="hs-identifier hs-type">StgTickish</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span id="coreToStgArgs"><span class="annot"><span class="annottext">coreToStgArgs :: [CoreArg] -&gt; CtsM ([StgArg], [StgTickish])
</span><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var hs-var">coreToStgArgs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-591"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([StgArg], [StgTickish]) -&gt; CtsM ([StgArg], [StgTickish])
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var">coreToStgArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681830519"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830519"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>     </span><span class="hs-comment">-- Type argument</span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830520"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830520"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830521"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830521"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreArg] -&gt; CtsM ([StgArg], [StgTickish])
</span><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var">coreToStgArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830519"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><span class="annottext">([StgArg], [StgTickish]) -&gt; CtsM ([StgArg], [StgTickish])
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830520"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830521"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var">coreToStgArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681830522"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830522"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Coercion argument; See Note [Coercion tokens]</span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830523"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830523"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830524"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830524"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreArg] -&gt; CtsM ([StgArg], [StgTickish])
</span><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var">coreToStgArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830522"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-599"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([StgArg], [StgTickish]) -&gt; CtsM ([StgArg], [StgTickish])
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; StgArg
</span><a href="GHC.Stg.Syntax.html#StgVarArg"><span class="hs-identifier hs-var">StgVarArg</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="GHC.Types.Id.Make.html#coercionTokenId"><span class="hs-identifier hs-var">coercionTokenId</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; [StgArg] -&gt; [StgArg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830523"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830524"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var">coreToStgArgs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830525"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830525"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681830526"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830526"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>         </span><span class="hs-comment">-- Non-type argument</span><span>
</span><span id="line-602"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830527"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830527"><span class="hs-identifier hs-var">stg_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830528"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830528"><span class="hs-identifier hs-var">ticks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreArg] -&gt; CtsM ([StgArg], [StgTickish])
</span><a href="GHC.CoreToStg.html#coreToStgArgs"><span class="hs-identifier hs-var">coreToStgArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830526"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-603"></span><span>    </span><span class="hs-comment">-- We know that `arg` must be trivial, but it may contain Ticks.</span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-comment">-- Example from test case `decodeMyStack`:</span><span>
</span><span id="line-605"></span><span>    </span><span class="hs-comment">--   $ @... ((src&lt;decodeMyStack.hs:18:26-28&gt; Data.Tuple.snd) @Int @[..])</span><span>
</span><span id="line-606"></span><span>    </span><span class="hs-comment">-- Note that unfortunately the Tick is not at the top.</span><span>
</span><span id="line-607"></span><span>    </span><span class="hs-comment">-- So we'll traverse the expression twice:</span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-comment">--   * Once with `stripTicksT` (which collects *all* ticks from the expression)</span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-comment">--   * and another time with `getStgArgFromTrivialArg`.</span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-comment">-- Since the argument is trivial, the only place the Tick can occur is</span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-comment">-- somehow wrapping a variable (give or take type args, as above).</span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621681830529"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830529"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtsM Platform
</span><a href="GHC.CoreToStg.html#getPlatform"><span class="hs-identifier hs-var">getPlatform</span></a></span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681830531"><span class="annot"><span class="annottext">arg_ty :: RuntimeRepType
</span><a href="#local-6989586621681830531"><span class="hs-identifier hs-var hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; RuntimeRepType
CoreArg -&gt; RuntimeRepType
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830525"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-614"></span><span>        </span><span id="local-6989586621681830532"><span class="annot"><span class="annottext">ticks' :: [StgTickish]
</span><a href="#local-6989586621681830532"><span class="hs-identifier hs-var hs-var">ticks'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreTickish -&gt; StgTickish) -&gt; [CoreTickish] -&gt; [StgTickish]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuntimeRepType -&gt; CoreTickish -&gt; StgTickish
</span><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-var">coreToStgTick</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830531"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreTickish -&gt; Bool) -&gt; CoreArg -&gt; [CoreTickish]
forall b. (CoreTickish -&gt; Bool) -&gt; Expr b -&gt; [CoreTickish]
</span><a href="GHC.Core.Utils.html#stripTicksT"><span class="hs-identifier hs-var">stripTicksT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (CoreTickish -&gt; Bool) -&gt; CoreTickish -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishIsCode"><span class="hs-identifier hs-var">tickishIsCode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830525"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>        </span><span id="local-6989586621681830536"><span class="annot"><span class="annottext">arg' :: StgArg
</span><a href="#local-6989586621681830536"><span class="hs-identifier hs-var hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; StgArg
CoreArg -&gt; StgArg
</span><a href="GHC.CoreToStg.html#getStgArgFromTrivialArg"><span class="hs-identifier hs-var">getStgArgFromTrivialArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830525"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-616"></span><span>        </span><span id="local-6989586621681830537"><span class="annot"><span class="annottext">arg_rep :: [PrimRep]
</span><a href="#local-6989586621681830537"><span class="hs-identifier hs-var hs-var">arg_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; RuntimeRepType -&gt; [PrimRep]
RuntimeRepType -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830531"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-617"></span><span>        </span><span id="local-6989586621681830538"><span class="annot"><span class="annottext">stg_arg_rep :: [PrimRep]
</span><a href="#local-6989586621681830538"><span class="hs-identifier hs-var hs-var">stg_arg_rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; RuntimeRepType -&gt; [PrimRep]
RuntimeRepType -&gt; [PrimRep]
</span><a href="GHC.Types.RepType.html#typePrimRep"><span class="hs-identifier hs-var">typePrimRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgArg -&gt; RuntimeRepType
</span><a href="GHC.Stg.Syntax.html#stgArgType"><span class="hs-identifier hs-var">stgArgType</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681830536"><span class="hs-identifier hs-var">arg'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>        </span><span id="local-6989586621681830540"><span class="annot"><span class="annottext">bad_args :: Bool
</span><a href="#local-6989586621681830540"><span class="hs-identifier hs-var hs-var">bad_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; [PrimRep] -&gt; [PrimRep] -&gt; Bool
</span><a href="GHC.Core.TyCon.html#primRepsCompatible"><span class="hs-identifier hs-var">primRepsCompatible</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830529"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681830537"><span class="hs-identifier hs-var">arg_rep</span></a></span><span> </span><span class="annot"><span class="annottext">[PrimRep]
</span><a href="#local-6989586621681830538"><span class="hs-identifier hs-var">stg_arg_rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; CtsM ()
forall (m :: * -&gt; *).
(HasCallStack, Applicative m) =&gt;
Bool -&gt; SDoc -&gt; m ()
</span><a href="GHC.Utils.Panic.html#massertPpr"><span class="hs-identifier hs-var">massertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgTickish] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830532"><span class="hs-identifier hs-var">ticks'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;More than one Tick in trivial arg:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830525"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; SDoc -&gt; CtsM () -&gt; CtsM ()
forall a. HasCallStack =&gt; Bool -&gt; String -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Trace.html#warnPprTrace"><span class="hs-identifier hs-var">warnPprTrace</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830540"><span class="hs-identifier hs-var">bad_args</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Dangerous-looking argument. Probable cause: bad unsafeCoerce#&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830525"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; CtsM ()
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>    </span><span class="annot"><span class="annottext">([StgArg], [StgTickish]) -&gt; CtsM ([StgArg], [StgTickish])
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgArg
</span><a href="#local-6989586621681830536"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">StgArg -&gt; [StgArg] -&gt; [StgArg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830527"><span class="hs-identifier hs-var">stg_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830532"><span class="hs-identifier hs-var">ticks'</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish] -&gt; [StgTickish] -&gt; [StgTickish]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830528"><span class="hs-identifier hs-var">ticks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-type">coreToStgTick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-comment">-- type of the ticked expression</span><span>
</span><span id="line-626"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span>
</span><span id="line-627"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Tickish.html#StgTickish"><span class="hs-identifier hs-type">StgTickish</span></a></span><span>
</span><span id="line-628"></span><span id="coreToStgTick"><span class="annot"><span class="annottext">coreToStgTick :: RuntimeRepType -&gt; CoreTickish -&gt; StgTickish
</span><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-var hs-var">coreToStgTick</span></a></span></span><span> </span><span id="local-6989586621681830545"><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830545"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#HpcTick"><span class="hs-identifier hs-type">HpcTick</span></a></span><span> </span><span id="local-6989586621681830547"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830547"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681830548"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830548"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Int -&gt; StgTickish
forall (pass :: TickishPass). Module -&gt; Int -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#HpcTick"><span class="hs-identifier hs-var">HpcTick</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830547"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830548"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-629"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-var">coreToStgTick</span></a></span><span> </span><span id="local-6989586621681830549"><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830549"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier hs-type">SourceNote</span></a></span><span> </span><span id="local-6989586621681830551"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681830551"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621681830552"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830552"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; String -&gt; StgTickish
forall (pass :: TickishPass).
RealSrcSpan -&gt; String -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#SourceNote"><span class="hs-identifier hs-var">SourceNote</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681830551"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681830552"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-630"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-var">coreToStgTick</span></a></span><span> </span><span id="local-6989586621681830553"><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830553"><span class="hs-identifier hs-var">_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#ProfNote"><span class="hs-identifier hs-type">ProfNote</span></a></span><span> </span><span id="local-6989586621681830555"><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830555"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621681830556"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830556"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span id="local-6989586621681830557"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830557"><span class="hs-identifier hs-var">scope</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CostCentre -&gt; Bool -&gt; Bool -&gt; StgTickish
forall (pass :: TickishPass).
CostCentre -&gt; Bool -&gt; Bool -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#ProfNote"><span class="hs-identifier hs-var">ProfNote</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830555"><span class="hs-identifier hs-var">cc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830556"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830557"><span class="hs-identifier hs-var">scope</span></a></span><span>
</span><span id="line-631"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgTick"><span class="hs-identifier hs-var">coreToStgTick</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681830558"><span class="annot"><span class="annottext">RuntimeRepType
</span><a href="#local-6989586621681830558"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-type">Breakpoint</span></a></span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassCore
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830560"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830560"><span class="hs-identifier hs-var">bid</span></a></span></span><span> </span><span id="local-6989586621681830561"><span class="annot"><span class="annottext">[XTickishId 'TickishPassCore]
</span><a href="#local-6989586621681830561"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XBreakpoint 'TickishPassStg
-&gt; Int -&gt; [XTickishId 'TickishPassStg] -&gt; StgTickish
forall (pass :: TickishPass).
XBreakpoint pass -&gt; Int -&gt; [XTickishId pass] -&gt; GenTickish pass
</span><a href="GHC.Types.Tickish.html#Breakpoint"><span class="hs-identifier hs-var">Breakpoint</span></a></span><span> </span><span class="annot"><span class="annottext">RuntimeRepType
XBreakpoint 'TickishPassStg
</span><a href="#local-6989586621681830558"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830560"><span class="hs-identifier hs-var">bid</span></a></span><span> </span><span class="annot"><span class="annottext">[XTickishId 'TickishPassCore]
[XTickishId 'TickishPassStg]
</span><a href="#local-6989586621681830561"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- The magic for lets:</span><span>
</span><span id="line-635"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgLet"><span class="hs-identifier hs-type">coreToStgLet</span></a></span><span>
</span><span id="line-638"></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span>     </span><span class="hs-comment">-- bindings</span><span>
</span><span id="line-639"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>     </span><span class="hs-comment">-- body</span><span>
</span><span id="line-640"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a></span><span> </span><span class="hs-comment">-- new let</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span id="coreToStgLet"><span class="annot"><span class="annottext">coreToStgLet :: CoreBind -&gt; CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgLet"><span class="hs-identifier hs-var hs-var">coreToStgLet</span></a></span></span><span> </span><span id="local-6989586621681830562"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830562"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621681830563"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830563"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830564"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830564"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830562"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; Bool
forall b. Expr b -&gt; Bool
</span><a href="GHC.Core.html#isTyCoArg"><span class="hs-identifier hs-var">isTyCoArg</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830564"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830563"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830565"><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681830565"><span class="hs-identifier hs-var">bind2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830566"><span class="annot"><span class="annottext">[(Id, HowBound)]
</span><a href="#local-6989586621681830566"><span class="hs-identifier hs-var">env_ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
</span><a href="#local-6989586621681830567"><span class="hs-identifier hs-var">vars_bind</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830562"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>          </span><span class="hs-comment">-- Do the body</span><span>
</span><span id="line-650"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681830568"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830568"><span class="hs-identifier hs-var">body2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)] -&gt; CtsM StgExpr -&gt; CtsM StgExpr
forall a. [(Id, HowBound)] -&gt; CtsM a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#extendVarEnvCts"><span class="hs-identifier hs-var">extendVarEnvCts</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)]
</span><a href="#local-6989586621681830566"><span class="hs-identifier hs-var">env_ext</span></a></span><span> </span><span class="annot"><span class="annottext">(CtsM StgExpr -&gt; CtsM StgExpr) -&gt; CtsM StgExpr -&gt; CtsM StgExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-651"></span><span>                    </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830563"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>        </span><span class="hs-comment">-- Compute the new let-expression</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681830569"><span class="annot"><span class="annottext">new_let :: StgExpr
</span><a href="#local-6989586621681830569"><span class="hs-identifier hs-var hs-var">new_let</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; Bool
</span><a href="GHC.Core.Utils.html#isJoinBind"><span class="hs-identifier hs-var">isJoinBind</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621681830562"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-655"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XLetNoEscape 'Vanilla
-&gt; GenStgBinding 'Vanilla -&gt; StgExpr -&gt; StgExpr
forall (pass :: StgPass).
XLetNoEscape pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLetNoEscape"><span class="hs-identifier hs-var">StgLetNoEscape</span></a></span><span> </span><span class="annot"><span class="annottext">XLetNoEscape 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681830565"><span class="hs-identifier hs-var">bind2</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830568"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-656"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-657"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XLet 'Vanilla -&gt; GenStgBinding 'Vanilla -&gt; StgExpr -&gt; StgExpr
forall (pass :: StgPass).
XLet pass
-&gt; GenStgBinding pass -&gt; GenStgExpr pass -&gt; GenStgExpr pass
</span><a href="GHC.Stg.Syntax.html#StgLet"><span class="hs-identifier hs-var">StgLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span> </span><span class="annot"><span class="annottext">GenStgBinding 'Vanilla
</span><a href="#local-6989586621681830565"><span class="hs-identifier hs-var">bind2</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830568"><span class="hs-identifier hs-var">body2</span></a></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">StgExpr -&gt; CtsM StgExpr
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830569"><span class="hs-identifier hs-var">new_let</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-661"></span><span>    </span><span id="local-6989586621681830574"><span class="annot"><span class="annottext">mk_binding :: a -&gt; CoreArg -&gt; (a, HowBound)
</span><a href="#local-6989586621681830574"><span class="hs-identifier hs-var hs-var">mk_binding</span></a></span></span><span> </span><span id="local-6989586621681830575"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681830575"><span class="hs-identifier hs-var">binder</span></a></span></span><span> </span><span id="local-6989586621681830576"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830576"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-662"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681830575"><span class="hs-identifier hs-var">binder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LetInfo -&gt; Int -&gt; HowBound
</span><a href="GHC.CoreToStg.html#LetBound"><span class="hs-identifier hs-var">LetBound</span></a></span><span> </span><span class="annot"><span class="annottext">LetInfo
</span><a href="GHC.CoreToStg.html#NestedLet"><span class="hs-identifier hs-var">NestedLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg -&gt; Int
</span><a href="GHC.Core.Opt.Arity.html#manifestArity"><span class="hs-identifier hs-var">manifestArity</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830576"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><a href="#local-6989586621681830567"><span class="hs-identifier hs-type">vars_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span>
</span><span id="line-665"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgBinding"><span class="hs-identifier hs-type">StgBinding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-666"></span><span>                       </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- extension to environment</span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621681830567"><span class="annot"><span class="annottext">vars_bind :: CoreBind -&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
</span><a href="#local-6989586621681830567"><span class="hs-identifier hs-var hs-var">vars_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-type">NonRec</span></a></span><span> </span><span id="local-6989586621681830579"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830579"><span class="hs-identifier hs-var">binder</span></a></span></span><span> </span><span id="local-6989586621681830580"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830580"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-669"></span><span>        </span><span id="local-6989586621681830581"><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681830581"><span class="hs-identifier hs-var">rhs2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Id, CoreArg) -&gt; CtsM StgRhs
</span><a href="GHC.CoreToStg.html#coreToStgRhs"><span class="hs-identifier hs-var">coreToStgRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830579"><span class="hs-identifier hs-var">binder</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830580"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-671"></span><span>            </span><span id="local-6989586621681830583"><span class="annot"><span class="annottext">env_ext_item :: (Id, HowBound)
</span><a href="#local-6989586621681830583"><span class="hs-identifier hs-var hs-var">env_ext_item</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreArg -&gt; (Id, HowBound)
forall {a}. a -&gt; CoreArg -&gt; (a, HowBound)
</span><a href="#local-6989586621681830574"><span class="hs-identifier hs-var">mk_binding</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830579"><span class="hs-identifier hs-var">binder</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830580"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>        </span><span class="annot"><span class="annottext">(GenStgBinding 'Vanilla, [(Id, HowBound)])
-&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BinderP 'Vanilla -&gt; StgRhs -&gt; GenStgBinding 'Vanilla
forall (pass :: StgPass).
BinderP pass -&gt; GenStgRhs pass -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgNonRec"><span class="hs-identifier hs-var">StgNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
BinderP 'Vanilla
</span><a href="#local-6989586621681830579"><span class="hs-identifier hs-var">binder</span></a></span><span> </span><span class="annot"><span class="annottext">StgRhs
</span><a href="#local-6989586621681830581"><span class="hs-identifier hs-var">rhs2</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Id, HowBound)
</span><a href="#local-6989586621681830583"><span class="hs-identifier hs-var">env_ext_item</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><a href="#local-6989586621681830567"><span class="hs-identifier hs-var">vars_bind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Rec"><span class="hs-identifier hs-type">Rec</span></a></span><span> </span><span id="local-6989586621681830584"><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830584"><span class="hs-identifier hs-var">pairs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>      </span><span class="hs-glyph">=</span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-677"></span><span>                </span><span id="local-6989586621681830585"><span class="annot"><span class="annottext">binders :: [Id]
</span><a href="#local-6989586621681830585"><span class="hs-identifier hs-var hs-var">binders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, CoreArg) -&gt; Id) -&gt; [(Id, CoreArg)] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, CoreArg) -&gt; Id
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.3.0/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830584"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-678"></span><span>                </span><span id="local-6989586621681830587"><span class="annot"><span class="annottext">env_ext :: [(Id, HowBound)]
</span><a href="#local-6989586621681830587"><span class="hs-identifier hs-var hs-var">env_ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreArg -&gt; (Id, HowBound)
forall {a}. a -&gt; CoreArg -&gt; (a, HowBound)
</span><a href="#local-6989586621681830574"><span class="hs-identifier hs-var">mk_binding</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830588"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830589"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-679"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830588"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830588"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681830589"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830589"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830584"><span class="hs-identifier hs-var">pairs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-680"></span><span>           </span><span class="hs-keyword">in</span><span>
</span><span id="line-681"></span><span>           </span><span class="annot"><span class="annottext">[(Id, HowBound)]
-&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
-&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
forall a. [(Id, HowBound)] -&gt; CtsM a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#extendVarEnvCts"><span class="hs-identifier hs-var">extendVarEnvCts</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)]
</span><a href="#local-6989586621681830587"><span class="hs-identifier hs-var">env_ext</span></a></span><span> </span><span class="annot"><span class="annottext">(CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
 -&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)]))
-&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
-&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-682"></span><span>              </span><span id="local-6989586621681830590"><span class="annot"><span class="annottext">[StgRhs]
</span><a href="#local-6989586621681830590"><span class="hs-identifier hs-var">rhss2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Id, CoreArg) -&gt; CtsM StgRhs) -&gt; [(Id, CoreArg)] -&gt; CtsM [StgRhs]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.3.0/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, CoreArg) -&gt; CtsM StgRhs
</span><a href="GHC.CoreToStg.html#coreToStgRhs"><span class="hs-identifier hs-var">coreToStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, CoreArg)]
</span><a href="#local-6989586621681830584"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-683"></span><span>              </span><span class="annot"><span class="annottext">(GenStgBinding 'Vanilla, [(Id, HowBound)])
-&gt; CtsM (GenStgBinding 'Vanilla, [(Id, HowBound)])
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(BinderP 'Vanilla, StgRhs)] -&gt; GenStgBinding 'Vanilla
forall (pass :: StgPass).
[(BinderP pass, GenStgRhs pass)] -&gt; GenStgBinding pass
</span><a href="GHC.Stg.Syntax.html#StgRec"><span class="hs-identifier hs-var">StgRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830585"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [StgRhs] -&gt; [(Id, StgRhs)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[StgRhs]
</span><a href="#local-6989586621681830590"><span class="hs-identifier hs-var">rhss2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)]
</span><a href="#local-6989586621681830587"><span class="hs-identifier hs-var">env_ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToStgRhs"><span class="hs-identifier hs-type">coreToStgRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span id="coreToStgRhs"><span class="annot"><span class="annottext">coreToStgRhs :: (Id, CoreArg) -&gt; CtsM StgRhs
</span><a href="GHC.CoreToStg.html#coreToStgRhs"><span class="hs-identifier hs-var hs-var">coreToStgRhs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830591"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830591"><span class="hs-identifier hs-var">bndr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830592"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830592"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-689"></span><span>    </span><span id="local-6989586621681830593"><span class="annot"><span class="annottext">PreStgRhs
</span><a href="#local-6989586621681830593"><span class="hs-identifier hs-var">new_rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM PreStgRhs
CoreArg -&gt; CtsM PreStgRhs
</span><a href="GHC.CoreToStg.html#coreToPreStgRhs"><span class="hs-identifier hs-var">coreToPreStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830592"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><span class="annottext">StgRhs -&gt; CtsM StgRhs
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; PreStgRhs -&gt; StgRhs
</span><a href="GHC.CoreToStg.html#mkStgRhs"><span class="hs-identifier hs-var">mkStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830591"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">PreStgRhs
</span><a href="#local-6989586621681830593"><span class="hs-identifier hs-var">new_rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-comment">-- Represents the RHS of a binding for use with mk(Top)StgRhs.</span><span>
</span><span id="line-693"></span><span class="hs-keyword">data</span><span> </span><span id="PreStgRhs"><span class="annot"><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-var">PreStgRhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PreStgRhs"><span class="annot"><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-var">PreStgRhs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgExpr"><span class="hs-identifier hs-type">StgExpr</span></a></span><span> </span><span class="hs-comment">-- The [Id] is empty for thunks</span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="hs-comment">-- Convert the RHS of a binding from Core to STG. This is a wrapper around</span><span>
</span><span id="line-696"></span><span class="hs-comment">-- coreToStgExpr that can handle value lambdas.</span><span>
</span><span id="line-697"></span><span class="annot"><a href="GHC.CoreToStg.html#coreToPreStgRhs"><span class="hs-identifier hs-type">coreToPreStgRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-type">PreStgRhs</span></a></span><span>
</span><span id="line-698"></span><span id="coreToPreStgRhs"><span class="annot"><span class="annottext">coreToPreStgRhs :: (() :: Constraint) =&gt; CoreArg -&gt; CtsM PreStgRhs
</span><a href="GHC.CoreToStg.html#coreToPreStgRhs"><span class="hs-identifier hs-var hs-var">coreToPreStgRhs</span></a></span></span><span> </span><span id="local-6989586621681830600"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830600"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)] -&gt; CtsM PreStgRhs -&gt; CtsM PreStgRhs
forall a. [(Id, HowBound)] -&gt; CtsM a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#extendVarEnvCts"><span class="hs-identifier hs-var">extendVarEnvCts</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830601"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="GHC.CoreToStg.html#LambdaBound"><span class="hs-identifier hs-var">LambdaBound</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681830601"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830601"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830602"><span class="hs-identifier hs-var">args'</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(CtsM PreStgRhs -&gt; CtsM PreStgRhs)
-&gt; CtsM PreStgRhs -&gt; CtsM PreStgRhs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-700"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681830603"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830603"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreArg -&gt; CtsM StgExpr
CoreArg -&gt; CtsM StgExpr
</span><a href="GHC.CoreToStg.html#coreToStgExpr"><span class="hs-identifier hs-var">coreToStgExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830604"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-701"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PreStgRhs -&gt; CtsM PreStgRhs
forall a. a -&gt; CtsM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; StgExpr -&gt; PreStgRhs
</span><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-var">PreStgRhs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830602"><span class="hs-identifier hs-var">args'</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830603"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-703"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621681830605"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830605"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830604"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830604"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; ([Id], CoreArg)
</span><a href="GHC.CoreToStg.html#myCollectBinders"><span class="hs-identifier hs-var">myCollectBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830600"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-704"></span><span>   </span><span id="local-6989586621681830602"><span class="annot"><span class="annottext">args' :: [Id]
</span><a href="#local-6989586621681830602"><span class="hs-identifier hs-var hs-var">args'</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id]
</span><a href="GHC.CoreToStg.html#filterStgBinders"><span class="hs-identifier hs-var">filterStgBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830605"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="hs-comment">-- Generate a top-level RHS. Any new cost centres generated for CAFs will be</span><span>
</span><span id="line-707"></span><span class="hs-comment">-- appended to `CollectedCCs` argument.</span><span>
</span><span id="line-708"></span><span class="annot"><a href="GHC.CoreToStg.html#mkTopStgRhs"><span class="hs-identifier hs-type">mkTopStgRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>
</span><span id="line-709"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-type">PreStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span id="mkTopStgRhs"><span class="annot"><span class="annottext">mkTopStgRhs :: CoreToStgOpts
-&gt; Module
-&gt; CollectedCCs
-&gt; Id
-&gt; PreStgRhs
-&gt; (StgRhs, CollectedCCs)
</span><a href="GHC.CoreToStg.html#mkTopStgRhs"><span class="hs-identifier hs-var hs-var">mkTopStgRhs</span></a></span></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-type">CoreToStgOpts</span></a></span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">coreToStg_platform :: CoreToStgOpts -&gt; Platform
</span><a href="GHC.CoreToStg.html#coreToStg_platform"><span class="hs-identifier hs-var">coreToStg_platform</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830606"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830606"><span class="hs-identifier hs-var">platform</span></a></span></span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">coreToStg_ExternalDynamicRefs :: CoreToStgOpts -&gt; Bool
</span><a href="GHC.CoreToStg.html#coreToStg_ExternalDynamicRefs"><span class="hs-identifier hs-var">coreToStg_ExternalDynamicRefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830608"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830608"><span class="hs-identifier hs-var">opt_ExternalDynamicRefs</span></a></span></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">coreToStg_AutoSccsOnIndividualCafs :: CoreToStgOpts -&gt; Bool
</span><a href="GHC.CoreToStg.html#coreToStg_AutoSccsOnIndividualCafs"><span class="hs-identifier hs-var">coreToStg_AutoSccsOnIndividualCafs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681830609"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830609"><span class="hs-identifier hs-var">opt_AutoSccsOnIndividualCafs</span></a></span></span><span>
</span><span id="line-715"></span><span>  </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681830610"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830610"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681830611"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830611"><span class="hs-identifier hs-var">ccs</span></a></span></span><span> </span><span id="local-6989586621681830612"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830612"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-type">PreStgRhs</span></a></span><span> </span><span id="local-6989586621681830613"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830613"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621681830614"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830614"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830613"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The list of arguments is non-empty, so not CAF</span><span>
</span><span id="line-718"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'Vanilla]
-&gt; StgExpr
-&gt; StgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-719"></span><span>                    </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#dontCareCCS"><span class="hs-identifier hs-var">dontCareCCS</span></a></span><span>
</span><span id="line-720"></span><span>                    </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a></span><span>
</span><span id="line-721"></span><span>                    </span><span class="annot"><span class="annottext">[Id]
[BinderP 'Vanilla]
</span><a href="#local-6989586621681830613"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830614"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830611"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>  </span><span class="hs-comment">-- After this point we know that `bndrs` is empty,</span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-comment">-- so this is not a function binding</span><span>
</span><span id="line-726"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621681830618"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830618"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681830619"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681830619"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621681830620"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830620"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[RuntimeRepType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830621"><span class="hs-identifier hs-var">unticked_rhs</span></a></span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Dynamic StgConApps are updatable</span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; Bool -&gt; Module -&gt; DataCon -&gt; [StgArg] -&gt; Bool
</span><a href="GHC.Stg.Syntax.html#isDllConApp"><span class="hs-identifier hs-var">isDllConApp</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830606"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830608"><span class="hs-identifier hs-var">opt_ExternalDynamicRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830610"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830618"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830620"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- CorePrep does this right, but just to make sure</span><span>
</span><span id="line-730"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; (StgRhs, CollectedCCs) -&gt; (StgRhs, CollectedCCs)
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedTupleDataCon"><span class="hs-identifier hs-var">isUnboxedTupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830618"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isUnboxedSumDataCon"><span class="hs-identifier hs-var">isUnboxedSumDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830618"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830612"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830618"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830620"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; StgRhs
forall (pass :: StgPass).
CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#dontCareCCS"><span class="hs-identifier hs-var">dontCareCCS</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830618"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681830619"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830626"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830620"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830611"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-comment">-- Otherwise it's a CAF, see Note [Cost-centre initialization plan].</span><span>
</span><span id="line-735"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681830609"><span class="hs-identifier hs-var">opt_AutoSccsOnIndividualCafs</span></a></span><span>
</span><span id="line-736"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'Vanilla]
-&gt; StgExpr
-&gt; StgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-737"></span><span>                    </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681830627"><span class="hs-identifier hs-var">caf_ccs</span></a></span><span>
</span><span id="line-738"></span><span>                    </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681830628"><span class="hs-identifier hs-var">upd_flag</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830614"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-739"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CostCentre -&gt; CostCentreStack -&gt; CollectedCCs -&gt; CollectedCCs
</span><a href="GHC.Types.CostCentre.html#collectCC"><span class="hs-identifier hs-var">collectCC</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830630"><span class="hs-identifier hs-var">caf_cc</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681830627"><span class="hs-identifier hs-var">caf_ccs</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830611"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-742"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'Vanilla]
-&gt; StgExpr
-&gt; StgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-743"></span><span>                    </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681830631"><span class="hs-identifier hs-var">all_cafs_ccs</span></a></span><span>
</span><span id="line-744"></span><span>                    </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681830628"><span class="hs-identifier hs-var">upd_flag</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830614"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-745"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681830611"><span class="hs-identifier hs-var">ccs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830626"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830626"><span class="hs-identifier hs-var">ticks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830621"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830621"><span class="hs-identifier hs-var">unticked_rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgTickish -&gt; Bool) -&gt; StgExpr -&gt; ([StgTickish], StgExpr)
forall (p :: StgPass).
(StgTickish -&gt; Bool)
-&gt; GenStgExpr p -&gt; ([StgTickish], GenStgExpr p)
</span><a href="GHC.Stg.Utils.html#stripStgTicksTop"><span class="hs-identifier hs-var">stripStgTicksTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (StgTickish -&gt; Bool) -&gt; StgTickish -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishIsCode"><span class="hs-identifier hs-var">tickishIsCode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830614"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>    </span><span id="local-6989586621681830628"><span class="annot"><span class="annottext">upd_flag :: UpdateFlag
</span><a href="#local-6989586621681830628"><span class="hs-identifier hs-var hs-var">upd_flag</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier hs-var">isUsedOnceDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Demand
</span><a href="GHC.Types.Id.html#idDemandInfo"><span class="hs-identifier hs-var">idDemandInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830612"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#SingleEntry"><span class="hs-identifier hs-var">SingleEntry</span></a></span><span>
</span><span id="line-751"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#Updatable"><span class="hs-identifier hs-var">Updatable</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span>    </span><span class="hs-comment">-- CAF cost centres generated for -fcaf-all</span><span>
</span><span id="line-754"></span><span>    </span><span id="local-6989586621681830630"><span class="annot"><span class="annottext">caf_cc :: CostCentre
</span><a href="#local-6989586621681830630"><span class="hs-identifier hs-var hs-var">caf_cc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Module -&gt; CostCentre
</span><a href="GHC.Types.CostCentre.html#mkAutoCC"><span class="hs-identifier hs-var">mkAutoCC</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830612"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830637"><span class="hs-identifier hs-var">modl</span></a></span><span>
</span><span id="line-755"></span><span>    </span><span id="local-6989586621681830627"><span class="annot"><span class="annottext">caf_ccs :: CostCentreStack
</span><a href="#local-6989586621681830627"><span class="hs-identifier hs-var hs-var">caf_ccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CostCentre -&gt; CostCentreStack
</span><a href="GHC.Types.CostCentre.html#mkSingletonCCS"><span class="hs-identifier hs-var">mkSingletonCCS</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830630"><span class="hs-identifier hs-var">caf_cc</span></a></span><span>
</span><span id="line-756"></span><span>           </span><span class="hs-comment">-- careful: the binder might be :Main.main,</span><span>
</span><span id="line-757"></span><span>           </span><span class="hs-comment">-- which doesn't belong to module mod_name.</span><span>
</span><span id="line-758"></span><span>           </span><span class="hs-comment">-- bug #249, tests prof001, prof002</span><span>
</span><span id="line-759"></span><span>    </span><span id="local-6989586621681830637"><span class="annot"><span class="annottext">modl :: Module
</span><a href="#local-6989586621681830637"><span class="hs-identifier hs-var hs-var">modl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681830639"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830639"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Module
</span><a href="GHC.Types.Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830612"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830639"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-760"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830610"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-comment">-- default CAF cost centre</span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostCentre
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830631"><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681830631"><span class="hs-identifier hs-var">all_cafs_ccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; (CostCentre, CostCentreStack)
</span><a href="GHC.CoreToStg.html#getAllCAFsCC"><span class="hs-identifier hs-var">getAllCAFsCC</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830610"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="hs-comment">-- Generate a non-top-level RHS. Cost-centre is always currentCCS,</span><span>
</span><span id="line-766"></span><span class="hs-comment">-- see Note [Cost-centre initialization plan].</span><span>
</span><span id="line-767"></span><span class="annot"><a href="GHC.CoreToStg.html#mkStgRhs"><span class="hs-identifier hs-type">mkStgRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-type">PreStgRhs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgRhs"><span class="hs-identifier hs-type">StgRhs</span></a></span><span>
</span><span id="line-768"></span><span id="mkStgRhs"><span class="annot"><span class="annottext">mkStgRhs :: Id -&gt; PreStgRhs -&gt; StgRhs
</span><a href="GHC.CoreToStg.html#mkStgRhs"><span class="hs-identifier hs-var hs-var">mkStgRhs</span></a></span></span><span> </span><span id="local-6989586621681830640"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830640"><span class="hs-identifier hs-var">bndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CoreToStg.html#PreStgRhs"><span class="hs-identifier hs-type">PreStgRhs</span></a></span><span> </span><span id="local-6989586621681830641"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830641"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621681830642"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830642"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830641"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'Vanilla]
-&gt; StgExpr
-&gt; StgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-771"></span><span>                  </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#currentCCS"><span class="hs-identifier hs-var">currentCCS</span></a></span><span>
</span><span id="line-772"></span><span>                  </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a></span><span>
</span><span id="line-773"></span><span>                  </span><span class="annot"><span class="annottext">[Id]
[BinderP 'Vanilla]
</span><a href="#local-6989586621681830641"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830642"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-comment">-- After this point we know that `bndrs` is empty,</span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-comment">-- so this is not a function binding</span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830640"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="hs-comment">-- Must be a nullary join point</span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- It might have /type/ arguments (T18328),</span><span>
</span><span id="line-780"></span><span>    </span><span class="hs-comment">-- so its JoinArity might be &gt;0</span><span>
</span><span id="line-781"></span><span>    </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'Vanilla]
-&gt; StgExpr
-&gt; StgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-782"></span><span>                  </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#currentCCS"><span class="hs-identifier hs-var">currentCCS</span></a></span><span>
</span><span id="line-783"></span><span>                  </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#ReEntrant"><span class="hs-identifier hs-var">ReEntrant</span></a></span><span> </span><span class="hs-comment">-- ignored for LNE</span><span>
</span><span id="line-784"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830642"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html#StgConApp"><span class="hs-identifier hs-type">StgConApp</span></a></span><span> </span><span id="local-6989586621681830645"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830645"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681830646"><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681830646"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621681830647"><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830647"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">[RuntimeRepType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830648"><span class="hs-identifier hs-var">unticked_rhs</span></a></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; StgRhs
forall (pass :: StgPass).
CostCentreStack
-&gt; DataCon
-&gt; ConstructorNumber
-&gt; [StgTickish]
-&gt; [StgArg]
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsCon"><span class="hs-identifier hs-var">StgRhsCon</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#currentCCS"><span class="hs-identifier hs-var">currentCCS</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681830645"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorNumber
</span><a href="#local-6989586621681830646"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830649"><span class="hs-identifier hs-var">ticks</span></a></span><span> </span><span class="annot"><span class="annottext">[StgArg]
</span><a href="#local-6989586621681830647"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-790"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP 'Vanilla]
-&gt; StgExpr
-&gt; StgRhs
forall (pass :: StgPass).
XRhsClosure pass
-&gt; CostCentreStack
-&gt; UpdateFlag
-&gt; [BinderP pass]
-&gt; GenStgExpr pass
-&gt; GenStgRhs pass
</span><a href="GHC.Stg.Syntax.html#StgRhsClosure"><span class="hs-identifier hs-var">StgRhsClosure</span></a></span><span> </span><span class="annot"><span class="annottext">XRhsClosure 'Vanilla
NoExtFieldSilent
</span><a href="GHC.Stg.Syntax.html#noExtFieldSilent"><span class="hs-identifier hs-var">noExtFieldSilent</span></a></span><span>
</span><span id="line-791"></span><span>                  </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="GHC.Types.CostCentre.html#currentCCS"><span class="hs-identifier hs-var">currentCCS</span></a></span><span>
</span><span id="line-792"></span><span>                  </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="#local-6989586621681830650"><span class="hs-identifier hs-var">upd_flag</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830642"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-794"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681830649"><span class="annot"><span class="annottext">[StgTickish]
</span><a href="#local-6989586621681830649"><span class="hs-identifier hs-var">ticks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681830648"><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830648"><span class="hs-identifier hs-var">unticked_rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StgTickish -&gt; Bool) -&gt; StgExpr -&gt; ([StgTickish], StgExpr)
forall (p :: StgPass).
(StgTickish -&gt; Bool)
-&gt; GenStgExpr p -&gt; ([StgTickish], GenStgExpr p)
</span><a href="GHC.Stg.Utils.html#stripStgTicksTop"><span class="hs-identifier hs-var">stripStgTicksTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (StgTickish -&gt; Bool) -&gt; StgTickish -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">StgTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishIsCode"><span class="hs-identifier hs-var">tickishIsCode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StgExpr
</span><a href="#local-6989586621681830642"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span>    </span><span id="local-6989586621681830650"><span class="annot"><span class="annottext">upd_flag :: UpdateFlag
</span><a href="#local-6989586621681830650"><span class="hs-identifier hs-var hs-var">upd_flag</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier hs-var">isUsedOnceDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Demand
</span><a href="GHC.Types.Id.html#idDemandInfo"><span class="hs-identifier hs-var">idDemandInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830640"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#SingleEntry"><span class="hs-identifier hs-var">SingleEntry</span></a></span><span>
</span><span id="line-797"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UpdateFlag
</span><a href="GHC.Stg.Syntax.html#Updatable"><span class="hs-identifier hs-var">Updatable</span></a></span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-comment">{-
    SDM: disabled.  Eval/Apply can't handle functions with arity zero very
    well; and making these into simple non-updatable thunks breaks other
    assumptions (namely that they will be entered only once).

    upd_flag | isPAP env rhs  = ReEntrant
             | otherwise      = Updatable

-- Detect thunks which will reduce immediately to PAPs, and make them
-- non-updatable.  This has several advantages:
--
--         - the non-updatable thunk behaves exactly like the PAP,
--
--         - the thunk is more efficient to enter, because it is
--           specialised to the task.
--
--         - we save one update frame, one stg_update_PAP, one update
--           and lots of PAP_enters.
--
--         - in the case where the thunk is top-level, we save building
--           a black hole and furthermore the thunk isn't considered to
--           be a CAF any more, so it doesn't appear in any SRTs.
--
-- We do it here, because the arity information is accurate, and we need
-- to do it before the SRT pass to save the SRT entries associated with
-- any top-level PAPs.

isPAP env (StgApp f args) = listLengthCmp args arity == LT -- idArity f &gt; length args
                              where
                                 arity = stgArity f (lookupBinding env f)
isPAP env _               = False

-}</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="hs-comment">{- ToDo:
          upd = if isOnceDem dem
                    then (if isNotTop toplev
                            then SingleEntry    -- HA!  Paydirt for &quot;dem&quot;
                            else
                     (if debugIsOn then trace &quot;WARNING: SE CAFs unsupported, forcing UPD instead&quot; else id) $
                     Updatable)
                else Updatable
        -- For now we forbid SingleEntry CAFs; they tickle the
        -- ASSERT in rts/Storage.c line 215 at newCAF() re mut_link,
        -- and I don't understand why.  There's only one SE_CAF (well,
        -- only one that tickled a great gaping bug in an earlier attempt
        -- at ClosureInfo.getEntryConvention) in the whole of nofib,
        -- specifically Main.lvl6 in spectral/cryptarithm2.
        -- So no great loss.  KSW 2000-07.
-}</span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-851"></span><span class="hs-comment">-- A monad for the core-to-STG pass</span><span>
</span><span id="line-852"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="hs-comment">-- There's a lot of stuff to pass around, so we use this CtsM</span><span>
</span><span id="line-855"></span><span class="hs-comment">-- (&quot;core-to-STG monad&quot;) monad to help.  All the stuff here is only passed</span><span>
</span><span id="line-856"></span><span class="annot"><span class="hs-comment">-- *down*.</span></span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span class="hs-keyword">newtype</span><span> </span><span id="CtsM"><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-var">CtsM</span></a></span></span><span> </span><span id="local-6989586621681830026"><span class="annot"><a href="#local-6989586621681830026"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CtsM"><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-var">CtsM</span></a></span></span><span>
</span><span id="line-859"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="unCtsM"><span class="annot"><span class="annottext">forall a. CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
</span><a href="GHC.CoreToStg.html#unCtsM"><span class="hs-identifier hs-var hs-var">unCtsM</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-comment">-- Needed for checking for bad coercions in coreToStgArgs</span><span>
</span><span id="line-860"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span>
</span><span id="line-861"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681830026"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-863"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830654"><span id="local-6989586621681830656"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; CtsM a -&gt; CtsM b)
-&gt; (forall a b. a -&gt; CtsM b -&gt; CtsM a) -&gt; Functor CtsM
forall a b. a -&gt; CtsM b -&gt; CtsM a
forall a b. (a -&gt; b) -&gt; CtsM a -&gt; CtsM b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; CtsM a -&gt; CtsM b
fmap :: forall a b. (a -&gt; b) -&gt; CtsM a -&gt; CtsM b
$c&lt;$ :: forall a b. a -&gt; CtsM b -&gt; CtsM a
&lt;$ :: forall a b. a -&gt; CtsM b -&gt; CtsM a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#Functor/GHC.Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span class="hs-keyword">data</span><span> </span><span id="HowBound"><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-var">HowBound</span></a></span></span><span>
</span><span id="line-866"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ImportBound"><span class="annot"><a href="GHC.CoreToStg.html#ImportBound"><span class="hs-identifier hs-var">ImportBound</span></a></span></span><span>         </span><span class="hs-comment">-- Used only as a response to lookupBinding; never</span><span>
</span><span id="line-867"></span><span>                        </span><span class="hs-comment">-- exists in the range of the (IdEnv HowBound)</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LetBound"><span class="annot"><a href="GHC.CoreToStg.html#LetBound"><span class="hs-identifier hs-var">LetBound</span></a></span></span><span>            </span><span class="hs-comment">-- A let(rec) in this module</span><span>
</span><span id="line-870"></span><span>        </span><span class="annot"><a href="GHC.CoreToStg.html#LetInfo"><span class="hs-identifier hs-type">LetInfo</span></a></span><span>         </span><span class="hs-comment">-- Whether top level or nested</span><span>
</span><span id="line-871"></span><span>        </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span>           </span><span class="hs-comment">-- Its arity (local Ids don't have arity info at this point)</span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LambdaBound"><span class="annot"><a href="GHC.CoreToStg.html#LambdaBound"><span class="hs-identifier hs-var">LambdaBound</span></a></span></span><span>         </span><span class="hs-comment">-- Used for both lambda and case</span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830661"><span id="local-6989586621681830666"><span class="annot"><span class="annottext">HowBound -&gt; HowBound -&gt; Bool
(HowBound -&gt; HowBound -&gt; Bool)
-&gt; (HowBound -&gt; HowBound -&gt; Bool) -&gt; Eq HowBound
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: HowBound -&gt; HowBound -&gt; Bool
== :: HowBound -&gt; HowBound -&gt; Bool
$c/= :: HowBound -&gt; HowBound -&gt; Bool
/= :: HowBound -&gt; HowBound -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span class="hs-keyword">data</span><span> </span><span id="LetInfo"><span class="annot"><a href="GHC.CoreToStg.html#LetInfo"><span class="hs-identifier hs-var">LetInfo</span></a></span></span><span>
</span><span id="line-877"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TopLet"><span class="annot"><a href="GHC.CoreToStg.html#TopLet"><span class="hs-identifier hs-var">TopLet</span></a></span></span><span>              </span><span class="hs-comment">-- top level things</span><span>
</span><span id="line-878"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NestedLet"><span class="annot"><a href="GHC.CoreToStg.html#NestedLet"><span class="hs-identifier hs-var">NestedLet</span></a></span></span><span>
</span><span id="line-879"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681830671"><span id="local-6989586621681830673"><span class="annot"><span class="annottext">LetInfo -&gt; LetInfo -&gt; Bool
(LetInfo -&gt; LetInfo -&gt; Bool)
-&gt; (LetInfo -&gt; LetInfo -&gt; Bool) -&gt; Eq LetInfo
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: LetInfo -&gt; LetInfo -&gt; Bool
== :: LetInfo -&gt; LetInfo -&gt; Bool
$c/= :: LetInfo -&gt; LetInfo -&gt; Bool
/= :: LetInfo -&gt; LetInfo -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="hs-comment">-- For a let(rec)-bound variable, x, we record LiveInfo, the set of</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- variables that are live if x is live.  This LiveInfo comprises</span><span>
</span><span id="line-883"></span><span class="hs-comment">--         (a) dynamic live variables (ones with a non-top-level binding)</span><span>
</span><span id="line-884"></span><span class="hs-comment">--         (b) static live variables (CAFs or things that refer to CAFs)</span><span>
</span><span id="line-885"></span><span class="hs-comment">--</span><span>
</span><span id="line-886"></span><span class="hs-comment">-- For &quot;normal&quot; variables (a) is just x alone.  If x is a let-no-escaped</span><span>
</span><span id="line-887"></span><span class="hs-comment">-- variable then x is represented by a code pointer and a stack pointer</span><span>
</span><span id="line-888"></span><span class="hs-comment">-- (well, one for each stack).  So all of the variables needed in the</span><span>
</span><span id="line-889"></span><span class="hs-comment">-- execution of x are live if x is, and are therefore recorded in the</span><span>
</span><span id="line-890"></span><span class="hs-comment">-- LetBound constructor; x itself *is* included.</span><span>
</span><span id="line-891"></span><span class="hs-comment">--</span><span>
</span><span id="line-892"></span><span class="hs-comment">-- The set of dynamic live variables is guaranteed ot have no further</span><span>
</span><span id="line-893"></span><span class="hs-comment">-- let-no-escaped variables in it.</span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span class="hs-comment">-- The std monad functions:</span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span id="local-6989586621681829919"><span class="annot"><a href="GHC.CoreToStg.html#initCts"><span class="hs-identifier hs-type">initCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681829919"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681829919"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-898"></span><span id="initCts"><span class="annot"><span class="annottext">initCts :: forall a. Platform -&gt; IdEnv HowBound -&gt; CtsM a -&gt; a
</span><a href="GHC.CoreToStg.html#initCts"><span class="hs-identifier hs-var hs-var">initCts</span></a></span></span><span> </span><span id="local-6989586621681830675"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830675"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681830676"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830676"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681830677"><span class="annot"><span class="annottext">CtsM a
</span><a href="#local-6989586621681830677"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
forall a. CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
</span><a href="GHC.CoreToStg.html#unCtsM"><span class="hs-identifier hs-var">unCtsM</span></a></span><span> </span><span class="annot"><span class="annottext">CtsM a
</span><a href="#local-6989586621681830677"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830675"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830676"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#thenCts"><span class="hs-pragma hs-type">thenCts</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-903"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#returnCts"><span class="hs-pragma hs-type">returnCts</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span id="local-6989586621681830680"><span class="annot"><a href="GHC.CoreToStg.html#returnCts"><span class="hs-identifier hs-type">returnCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681830680"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830680"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-906"></span><span id="returnCts"><span class="annot"><span class="annottext">returnCts :: forall a. a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#returnCts"><span class="hs-identifier hs-var hs-var">returnCts</span></a></span></span><span> </span><span id="local-6989586621681830681"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681830681"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
forall a. (Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-var">CtsM</span></a></span><span> </span><span class="annot"><span class="annottext">((Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a)
-&gt; (Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681830681"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span id="local-6989586621681830035"><span id="local-6989586621681830036"><span class="annot"><a href="GHC.CoreToStg.html#thenCts"><span class="hs-identifier hs-type">thenCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830035"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681830035"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830036"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681830036"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-909"></span><span id="thenCts"><span class="annot"><span class="annottext">thenCts :: forall a b. CtsM a -&gt; (a -&gt; CtsM b) -&gt; CtsM b
</span><a href="GHC.CoreToStg.html#thenCts"><span class="hs-identifier hs-var hs-var">thenCts</span></a></span></span><span> </span><span id="local-6989586621681830682"><span class="annot"><span class="annottext">CtsM a
</span><a href="#local-6989586621681830682"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681830683"><span class="annot"><span class="annottext">a -&gt; CtsM b
</span><a href="#local-6989586621681830683"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; IdEnv HowBound -&gt; b) -&gt; CtsM b
forall a. (Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-var">CtsM</span></a></span><span> </span><span class="annot"><span class="annottext">((Platform -&gt; IdEnv HowBound -&gt; b) -&gt; CtsM b)
-&gt; (Platform -&gt; IdEnv HowBound -&gt; b) -&gt; CtsM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681830684"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830684"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681830685"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830685"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-910"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtsM b -&gt; Platform -&gt; IdEnv HowBound -&gt; b
forall a. CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
</span><a href="GHC.CoreToStg.html#unCtsM"><span class="hs-identifier hs-var">unCtsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; CtsM b
</span><a href="#local-6989586621681830683"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
forall a. CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
</span><a href="GHC.CoreToStg.html#unCtsM"><span class="hs-identifier hs-var">unCtsM</span></a></span><span> </span><span class="annot"><span class="annottext">CtsM a
</span><a href="#local-6989586621681830682"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830684"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830685"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830684"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830685"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681830691"><span id="local-6989586621681830694"><span id="local-6989586621681830697"><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Applicative/GHC.Base.html#Applicative"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-913"></span><span>    </span><span id="local-6989586621681830700"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; CtsM a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; CtsM a
forall a. a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#returnCts"><span class="hs-identifier hs-var">returnCts</span></a></span><span>
</span><span id="line-914"></span><span>    </span><span id="local-6989586621681830702"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. CtsM (a -&gt; b) -&gt; CtsM a -&gt; CtsM b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3C%2A%3E/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtsM (a -&gt; b) -&gt; CtsM a -&gt; CtsM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m (a -&gt; b) -&gt; m a -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#ap/GHC.Base.html#ap"><span class="hs-identifier hs-var">ap</span></a></span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681830707"><span id="local-6989586621681830710"><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#Monad/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-917"></span><span>    </span><span id="local-6989586621681830713"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. CtsM a -&gt; (a -&gt; CtsM b) -&gt; CtsM b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var hs-var hs-var hs-var">(&gt;&gt;=)</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtsM a -&gt; (a -&gt; CtsM b) -&gt; CtsM b
forall a b. CtsM a -&gt; (a -&gt; CtsM b) -&gt; CtsM b
</span><a href="GHC.CoreToStg.html#thenCts"><span class="hs-identifier hs-var">thenCts</span></a></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="annot"><a href="GHC.CoreToStg.html#getPlatform"><span class="hs-identifier hs-type">getPlatform</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-920"></span><span id="getPlatform"><span class="annot"><span class="annottext">getPlatform :: CtsM Platform
</span><a href="GHC.CoreToStg.html#getPlatform"><span class="hs-identifier hs-var hs-var">getPlatform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; IdEnv HowBound -&gt; Platform) -&gt; CtsM Platform
forall a. (Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-var">CtsM</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; IdEnv HowBound -&gt; Platform
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span>
</span><span id="line-921"></span><span>
</span><span id="line-922"></span><span class="hs-comment">-- Functions specific to this monad:</span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span id="local-6989586621681829959"><span class="annot"><a href="GHC.CoreToStg.html#extendVarEnvCts"><span class="hs-identifier hs-type">extendVarEnvCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681829959"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681829959"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-925"></span><span id="extendVarEnvCts"><span class="annot"><span class="annottext">extendVarEnvCts :: forall a. [(Id, HowBound)] -&gt; CtsM a -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#extendVarEnvCts"><span class="hs-identifier hs-var hs-var">extendVarEnvCts</span></a></span></span><span> </span><span id="local-6989586621681830715"><span class="annot"><span class="annottext">[(Id, HowBound)]
</span><a href="#local-6989586621681830715"><span class="hs-identifier hs-var">ids_w_howbound</span></a></span></span><span> </span><span id="local-6989586621681830716"><span class="annot"><span class="annottext">CtsM a
</span><a href="#local-6989586621681830716"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-926"></span><span>   </span><span class="hs-glyph">=</span><span>    </span><span class="annot"><span class="annottext">(Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
forall a. (Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-var">CtsM</span></a></span><span> </span><span class="annot"><span class="annottext">((Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a)
-&gt; (Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>   </span><span class="hs-glyph">\</span><span id="local-6989586621681830717"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830717"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span id="local-6989586621681830718"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830718"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-927"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
forall a. CtsM a -&gt; Platform -&gt; IdEnv HowBound -&gt; a
</span><a href="GHC.CoreToStg.html#unCtsM"><span class="hs-identifier hs-var">unCtsM</span></a></span><span> </span><span class="annot"><span class="annottext">CtsM a
</span><a href="#local-6989586621681830716"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681830717"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdEnv HowBound -&gt; [(Id, HowBound)] -&gt; IdEnv HowBound
forall a. VarEnv a -&gt; [(Id, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnvList"><span class="hs-identifier hs-var">extendVarEnvList</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830718"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, HowBound)]
</span><a href="#local-6989586621681830715"><span class="hs-identifier hs-var">ids_w_howbound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span class="annot"><a href="GHC.CoreToStg.html#lookupVarCts"><span class="hs-identifier hs-type">lookupVarCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-type">CtsM</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span>
</span><span id="line-930"></span><span id="lookupVarCts"><span class="annot"><span class="annottext">lookupVarCts :: Id -&gt; CtsM HowBound
</span><a href="GHC.CoreToStg.html#lookupVarCts"><span class="hs-identifier hs-var hs-var">lookupVarCts</span></a></span></span><span> </span><span id="local-6989586621681830719"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830719"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; IdEnv HowBound -&gt; HowBound) -&gt; CtsM HowBound
forall a. (Platform -&gt; IdEnv HowBound -&gt; a) -&gt; CtsM a
</span><a href="GHC.CoreToStg.html#CtsM"><span class="hs-identifier hs-var">CtsM</span></a></span><span> </span><span class="annot"><span class="annottext">((Platform -&gt; IdEnv HowBound -&gt; HowBound) -&gt; CtsM HowBound)
-&gt; (Platform -&gt; IdEnv HowBound -&gt; HowBound) -&gt; CtsM HowBound
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830720"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830720"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound -&gt; Id -&gt; HowBound
</span><a href="GHC.CoreToStg.html#lookupBinding"><span class="hs-identifier hs-var">lookupBinding</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830720"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830719"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span class="annot"><a href="GHC.CoreToStg.html#lookupBinding"><span class="hs-identifier hs-type">lookupBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#IdEnv"><span class="hs-identifier hs-type">IdEnv</span></a></span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span>
</span><span id="line-933"></span><span id="lookupBinding"><span class="annot"><span class="annottext">lookupBinding :: IdEnv HowBound -&gt; Id -&gt; HowBound
</span><a href="GHC.CoreToStg.html#lookupBinding"><span class="hs-identifier hs-var hs-var">lookupBinding</span></a></span></span><span> </span><span id="local-6989586621681830722"><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830722"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681830723"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830723"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound -&gt; Id -&gt; Maybe HowBound
forall a. VarEnv a -&gt; Id -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">IdEnv HowBound
</span><a href="#local-6989586621681830722"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830723"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-934"></span><span>                        </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681830725"><span class="annot"><span class="annottext">HowBound
</span><a href="#local-6989586621681830725"><span class="hs-identifier hs-var">xx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="#local-6989586621681830725"><span class="hs-identifier hs-var">xx</span></a></span><span>
</span><span id="line-935"></span><span>                        </span><span class="annot"><span class="annottext">Maybe HowBound
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; HowBound -&gt; HowBound
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isGlobalId"><span class="hs-identifier hs-var">isGlobalId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830723"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830723"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="GHC.CoreToStg.html#ImportBound"><span class="hs-identifier hs-var">ImportBound</span></a></span><span>
</span><span id="line-936"></span><span>
</span><span id="line-937"></span><span class="annot"><a href="GHC.CoreToStg.html#getAllCAFsCC"><span class="hs-identifier hs-type">getAllCAFsCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.CostCentre.html#CostCentre"><span class="hs-identifier hs-type">CostCentre</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CostCentreStack"><span class="hs-identifier hs-type">CostCentreStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span id="getAllCAFsCC"><span class="annot"><span class="annottext">getAllCAFsCC :: Module -&gt; (CostCentre, CostCentreStack)
</span><a href="GHC.CoreToStg.html#getAllCAFsCC"><span class="hs-identifier hs-var hs-var">getAllCAFsCC</span></a></span></span><span> </span><span id="local-6989586621681830727"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830727"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-939"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-940"></span><span>      </span><span id="local-6989586621681830728"><span class="annot"><span class="annottext">span :: SrcSpan
</span><a href="#local-6989586621681830728"><span class="hs-identifier hs-var hs-var">span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CLabelString -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#mkGeneralSrcSpan"><span class="hs-identifier hs-var">mkGeneralSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CLabelString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;entire-module&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- XXX do better</span><span>
</span><span id="line-941"></span><span>      </span><span id="local-6989586621681830730"><span class="annot"><span class="annottext">all_cafs_cc :: CostCentre
</span><a href="#local-6989586621681830730"><span class="hs-identifier hs-var hs-var">all_cafs_cc</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; SrcSpan -&gt; CostCentre
</span><a href="GHC.Types.CostCentre.html#mkAllCafsCC"><span class="hs-identifier hs-var">mkAllCafsCC</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681830727"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681830728"><span class="hs-identifier hs-var">span</span></a></span><span>
</span><span id="line-942"></span><span>      </span><span id="local-6989586621681830732"><span class="annot"><span class="annottext">all_cafs_ccs :: CostCentreStack
</span><a href="#local-6989586621681830732"><span class="hs-identifier hs-var hs-var">all_cafs_ccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CostCentre -&gt; CostCentreStack
</span><a href="GHC.Types.CostCentre.html#mkSingletonCCS"><span class="hs-identifier hs-var">mkSingletonCCS</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830730"><span class="hs-identifier hs-var">all_cafs_cc</span></a></span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-944"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CostCentre
</span><a href="#local-6989586621681830730"><span class="hs-identifier hs-var">all_cafs_cc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CostCentreStack
</span><a href="#local-6989586621681830732"><span class="hs-identifier hs-var">all_cafs_ccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span class="hs-comment">-- Misc.</span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span class="annot"><a href="GHC.CoreToStg.html#filterStgBinders"><span class="hs-identifier hs-type">filterStgBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-949"></span><span id="filterStgBinders"><span class="annot"><span class="annottext">filterStgBinders :: [Id] -&gt; [Id]
</span><a href="GHC.CoreToStg.html#filterStgBinders"><span class="hs-identifier hs-var hs-var">filterStgBinders</span></a></span></span><span> </span><span id="local-6989586621681830734"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830734"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#filter/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isId"><span class="hs-identifier hs-var">isId</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681830734"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span class="annot"><a href="GHC.CoreToStg.html#myCollectBinders"><span class="hs-identifier hs-type">myCollectBinders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span id="myCollectBinders"><span class="annot"><span class="annottext">myCollectBinders :: CoreArg -&gt; ([Id], CoreArg)
</span><a href="GHC.CoreToStg.html#myCollectBinders"><span class="hs-identifier hs-var hs-var">myCollectBinders</span></a></span></span><span> </span><span id="local-6989586621681830736"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830736"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreArg -&gt; ([Id], CoreArg)
forall {a}. [a] -&gt; Expr a -&gt; ([a], Expr a)
</span><a href="#local-6989586621681830737"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830736"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-955"></span><span>    </span><span id="local-6989586621681830737"><span class="annot"><span class="annottext">go :: [a] -&gt; Expr a -&gt; ([a], Expr a)
</span><a href="#local-6989586621681830737"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681830738"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681830738"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621681830739"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681830739"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681830740"><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621681830740"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Expr a -&gt; ([a], Expr a)
</span><a href="#local-6989586621681830737"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681830739"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681830738"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621681830740"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-956"></span><span>    </span><span class="annot"><a href="#local-6989586621681830737"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681830741"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681830741"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621681830742"><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621681830742"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Expr a -&gt; ([a], Expr a)
</span><a href="#local-6989586621681830737"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681830741"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621681830742"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-957"></span><span>    </span><span class="annot"><a href="#local-6989586621681830737"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681830743"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681830743"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681830744"><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621681830744"><span class="hs-identifier hs-var">e</span></a></span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.List.html#reverse/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681830743"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr a
</span><a href="#local-6989586621681830744"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span class="hs-comment">-- | If the argument expression is (potential chain of) 'App', return the head</span><span>
</span><span id="line-960"></span><span class="hs-comment">-- of the app chain, and collect ticks/args along the chain.</span><span>
</span><span id="line-961"></span><span class="annot"><a href="GHC.CoreToStg.html#myCollectArgs"><span class="hs-identifier hs-type">myCollectArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreArg"><span class="hs-identifier hs-type">CoreArg</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Tickish.html#CoreTickish"><span class="hs-identifier hs-type">CoreTickish</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span id="myCollectArgs"><span class="annot"><span class="annottext">myCollectArgs :: (() :: Constraint) =&gt;
CoreArg -&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="GHC.CoreToStg.html#myCollectArgs"><span class="hs-identifier hs-var hs-var">myCollectArgs</span></a></span></span><span> </span><span id="local-6989586621681830747"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830747"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreArg
-&gt; [CoreArg]
-&gt; [CoreTickish]
-&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830747"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-965"></span><span>    </span><span id="local-6989586621681830748"><span class="annot"><span class="annottext">go :: CoreArg
-&gt; [CoreArg]
-&gt; [CoreTickish]
-&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="#local-6989586621681830748"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681830762"><span class="annot"><span class="annottext">h :: CoreArg
</span><a href="#local-6989586621681830762"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681830763"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830763"><span class="hs-identifier hs-var">_v</span></a></span></span><span class="hs-special">)</span><span>       </span><span id="local-6989586621681830764"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830764"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621681830765"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830765"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830762"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830764"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830765"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>    </span><span class="annot"><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621681830766"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830766"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681830767"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830767"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>        </span><span id="local-6989586621681830768"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830768"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621681830769"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830769"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreArg
-&gt; [CoreArg]
-&gt; [CoreTickish]
-&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830766"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830767"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">CoreArg -&gt; [CoreArg] -&gt; [CoreArg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830768"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830769"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-967"></span><span>    </span><span class="annot"><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621681830770"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621681830770"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681830771"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830771"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>       </span><span id="local-6989586621681830772"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830772"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621681830773"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830773"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; SDoc
-&gt; (CoreArg, [CoreArg], [CoreTickish])
-&gt; (CoreArg, [CoreArg], [CoreTickish])
forall a. HasCallStack =&gt; Bool -&gt; SDoc -&gt; a -&gt; a
</span><a href="GHC.Utils.Panic.html#assertPpr"><span class="hs-identifier hs-var">assertPpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish -&gt; Bool
forall (pass :: TickishPass). GenTickish pass -&gt; Bool
</span><a href="GHC.Types.Tickish.html#tickishIsCode"><span class="hs-identifier hs-var">tickishIsCode</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621681830770"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(CoreArg -&gt; Bool) -&gt; [CoreArg] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#all/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg -&gt; Bool
forall b. Expr b -&gt; Bool
</span><a href="GHC.Core.html#isTypeArg"><span class="hs-identifier hs-var">isTypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830772"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830771"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830772"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830773"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((CoreArg, [CoreArg], [CoreTickish])
 -&gt; (CoreArg, [CoreArg], [CoreTickish]))
-&gt; (CoreArg, [CoreArg], [CoreTickish])
-&gt; (CoreArg, [CoreArg], [CoreTickish])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-969"></span><span>                                </span><span class="hs-comment">-- See Note [Ticks in applications]</span><span>
</span><span id="line-970"></span><span>                                </span><span class="annot"><span class="annottext">CoreArg
-&gt; [CoreArg]
-&gt; [CoreTickish]
-&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830771"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830772"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621681830770"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">CoreTickish -&gt; [CoreTickish] -&gt; [CoreTickish]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830773"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ticks can appear in type apps</span><span>
</span><span id="line-971"></span><span>    </span><span class="annot"><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621681830776"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830776"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span id="local-6989586621681830777"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830777"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621681830778"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830778"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreArg
-&gt; [CoreArg]
-&gt; [CoreTickish]
-&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830776"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830777"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830778"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-972"></span><span>    </span><span class="annot"><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span id="local-6989586621681830779"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830779"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681830780"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830780"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>        </span><span id="local-6989586621681830781"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830781"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621681830782"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830782"><span class="hs-identifier hs-var">ts</span></a></span></span><span>
</span><span id="line-973"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830779"><span class="hs-identifier hs-var">b</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreArg
-&gt; [CoreArg]
-&gt; [CoreTickish]
-&gt; (CoreArg, [CoreArg], [CoreTickish])
</span><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830780"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830781"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830782"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-comment">-- Note [Collect args]</span><span>
</span><span id="line-974"></span><span>    </span><span class="annot"><a href="#local-6989586621681830748"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681830784"><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830784"><span class="hs-identifier hs-var">e</span></a></span></span><span>                </span><span id="local-6989586621681830785"><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830785"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621681830786"><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830786"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreArg
</span><a href="#local-6989586621681830784"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreArg]
</span><a href="#local-6989586621681830785"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreTickish]
</span><a href="#local-6989586621681830786"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span class="hs-comment">{- Note [Collect args]
~~~~~~~~~~~~~~~~~~~~~~
This big-lambda case occurred following a rather obscure eta expansion.
It all seems a bit yukky to me.

Note [Ticks in applications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We can get an application like
   (tick t f) True False
via inlining in the CorePrep pass; see Note [Inlining in CorePrep]
in GHC.CoreToStg.Prep.  The tick does not satisfy tickishIsCode;
the inlining-in-CorePrep happens for cpExprIsTrivial which tests
tickishIsCode.

So we test the same thing here, pushing any non-code ticks to
the top (they don't generate any code, after all).  This showed
up in the fallout from fixing #19360.
-}</span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span class="annot"><a href="GHC.CoreToStg.html#stgArity"><span class="hs-identifier hs-type">stgArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#HowBound"><span class="hs-identifier hs-type">HowBound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span>
</span><span id="line-996"></span><span id="stgArity"><span class="annot"><span class="annottext">stgArity :: Id -&gt; HowBound -&gt; Int
</span><a href="GHC.CoreToStg.html#stgArity"><span class="hs-identifier hs-var hs-var">stgArity</span></a></span></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CoreToStg.html#LetBound"><span class="hs-identifier hs-type">LetBound</span></a></span><span> </span><span class="annot"><span class="annottext">LetInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681830787"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830787"><span class="hs-identifier hs-var">arity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681830787"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-997"></span><span class="annot"><a href="GHC.CoreToStg.html#stgArity"><span class="hs-identifier hs-var">stgArity</span></a></span><span> </span><span id="local-6989586621681830788"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830788"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="GHC.CoreToStg.html#ImportBound"><span class="hs-identifier hs-var">ImportBound</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Int
</span><a href="GHC.Types.Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681830788"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-998"></span><span class="annot"><a href="GHC.CoreToStg.html#stgArity"><span class="hs-identifier hs-var">stgArity</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HowBound
</span><a href="GHC.CoreToStg.html#LambdaBound"><span class="hs-identifier hs-var">LambdaBound</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span class="hs-keyword">data</span><span> </span><span id="CoreToStgOpts"><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-var">CoreToStgOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CoreToStgOpts"><span class="annot"><a href="GHC.CoreToStg.html#CoreToStgOpts"><span class="hs-identifier hs-var">CoreToStgOpts</span></a></span></span><span>
</span><span id="line-1001"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="coreToStg_platform"><span class="annot"><span class="annottext">CoreToStgOpts -&gt; Platform
</span><a href="GHC.CoreToStg.html#coreToStg_platform"><span class="hs-identifier hs-var hs-var">coreToStg_platform</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="coreToStg_ways"><span class="annot"><span class="annottext">CoreToStgOpts -&gt; Ways
</span><a href="GHC.CoreToStg.html#coreToStg_ways"><span class="hs-identifier hs-var hs-var">coreToStg_ways</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html#Ways"><span class="hs-identifier hs-type">Ways</span></a></span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="coreToStg_AutoSccsOnIndividualCafs"><span class="annot"><span class="annottext">CoreToStgOpts -&gt; Bool
</span><a href="GHC.CoreToStg.html#coreToStg_AutoSccsOnIndividualCafs"><span class="hs-identifier hs-var hs-var">coreToStg_AutoSccsOnIndividualCafs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1004"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="coreToStg_InfoTableMap"><span class="annot"><span class="annottext">CoreToStgOpts -&gt; Bool
</span><a href="GHC.CoreToStg.html#coreToStg_InfoTableMap"><span class="hs-identifier hs-var hs-var">coreToStg_InfoTableMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1005"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="coreToStg_ExternalDynamicRefs"><span class="annot"><span class="annottext">CoreToStgOpts -&gt; Bool
</span><a href="GHC.CoreToStg.html#coreToStg_ExternalDynamicRefs"><span class="hs-identifier hs-var hs-var">coreToStg_ExternalDynamicRefs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1006"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="coreToStg_stgDebugOpts"><span class="annot"><span class="annottext">CoreToStgOpts -&gt; StgDebugOpts
</span><a href="GHC.CoreToStg.html#coreToStg_stgDebugOpts"><span class="hs-identifier hs-var hs-var">coreToStg_stgDebugOpts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Stg.Debug.html#StgDebugOpts"><span class="hs-identifier hs-type">StgDebugOpts</span></a></span><span>
</span><span id="line-1007"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1008"></span></pre></body></html>