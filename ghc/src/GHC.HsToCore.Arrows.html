<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BlockArguments #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Desugaring arrow commands
-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.HsToCore.Arrows</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsProcExpr"><span class="hs-identifier">dsProcExpr</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Match.html"><span class="hs-identifier">GHC.HsToCore.Match</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Utils.html"><span class="hs-identifier">GHC.HsToCore.Utils</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Syn.Type.html"><span class="hs-identifier">GHC.Hs.Syn.Type</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">-- NB: The desugarer, which straddles the source and Core worlds, sometimes</span><span>
</span><span id="line-25"></span><span class="hs-comment">--     needs to see source types (newtypes etc), and sometimes not</span><span>
</span><span id="line-26"></span><span class="hs-comment">--     So WATCH OUT; check each use of split*Ty functions.</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- Sigh.  This is a pain.</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html"><span class="hs-identifier">GHC.HsToCore.Expr</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier">dsExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier">dsLExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsLocalBinds"><span class="hs-identifier">dsLocalBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>                                          </span><span class="annot"><a href="GHC.HsToCore.Expr.html#dsSyntaxExpr"><span class="hs-identifier">dsSyntaxExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FVs.html"><span class="hs-identifier">GHC.Core.FVs</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Binds.html"><span class="hs-identifier">GHC.HsToCore.Binds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier">dsHsWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier">assocMaybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Foldable.html#/Data.Foldable.html"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Foldable.html#toList/Data.Foldable.html#toList"><span class="hs-identifier">toList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier">mapAccumL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.NonEmpty.html#/Data.List.NonEmpty.html"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#NonEmpty/GHC.Base.html#NonEmpty"><span class="hs-identifier">NonEmpty</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.NonEmpty.html#nonEmpty/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier">nonEmpty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">data</span><span> </span><span id="DsCmdEnv"><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-var">DsCmdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DsCmdEnv"><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-var">DsCmdEnv</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-59"></span><span>        </span><span id="arr_id"><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#arr_id"><span class="hs-identifier hs-var hs-var">arr_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="compose_id"><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#compose_id"><span class="hs-identifier hs-var hs-var">compose_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="first_id"><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#first_id"><span class="hs-identifier hs-var hs-var">first_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="app_id"><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#app_id"><span class="hs-identifier hs-var hs-var">app_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="choice_id"><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#choice_id"><span class="hs-identifier hs-var hs-var">choice_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="loop_id"><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#loop_id"><span class="hs-identifier hs-var hs-var">loop_id</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#mkCmdEnv"><span class="hs-identifier hs-type">mkCmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#CmdSyntaxTable"><span class="hs-identifier hs-type">CmdSyntaxTable</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-comment">-- See Note [CmdSyntaxTable] in GHC.Hs.Expr</span><span>
</span><span id="line-64"></span><span id="mkCmdEnv"><span class="annot"><span class="annottext">mkCmdEnv :: CmdSyntaxTable (GhcPass 'Typechecked) -&gt; DsM ([CoreBind], DsCmdEnv)
</span><a href="GHC.HsToCore.Arrows.html#mkCmdEnv"><span class="hs-identifier hs-var hs-var">mkCmdEnv</span></a></span></span><span> </span><span id="local-6989586621682057191"><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057191"><span class="hs-identifier hs-var">tc_meths</span></a></span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057192"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621682057192"><span class="hs-identifier hs-var">meth_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057193"><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621682057193"><span class="hs-identifier hs-var">prs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, HsExpr (GhcPass 'Typechecked))
 -&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreBind, (Name, Id)))
-&gt; CmdSyntaxTable (GhcPass 'Typechecked)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ([CoreBind], [(Name, Id)])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><a href="../../base-4.18.2.1/src/Control.Monad.html#mapAndUnzipM/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, HsExpr (GhcPass 'Typechecked))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreBind, (Name, Id))
forall {a}.
(a, HsExpr (GhcPass 'Typechecked))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreBind, (a, Id))
</span><a href="#local-6989586621682057195"><span class="hs-identifier hs-var">mk_bind</span></a></span><span> </span><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057191"><span class="hs-identifier hs-var">tc_meths</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>       </span><span class="hs-comment">-- NB: Some of these lookups might fail, but that's OK if the</span><span>
</span><span id="line-68"></span><span>       </span><span class="hs-comment">-- symbol is never used. That's why we use Maybe first and then</span><span>
</span><span id="line-69"></span><span>       </span><span class="hs-comment">-- panic. An eager panic caused trouble in typecheck/should_compile/tc192</span><span>
</span><span id="line-70"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057196"><span class="annot"><span class="annottext">the_arr_id :: Maybe Id
</span><a href="#local-6989586621682057196"><span class="hs-identifier hs-var hs-var">the_arr_id</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Id)] -&gt; Name -&gt; Maybe Id
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621682057193"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#arrAName"><span class="hs-identifier hs-var">arrAName</span></a></span><span>
</span><span id="line-71"></span><span>             </span><span id="local-6989586621682057198"><span class="annot"><span class="annottext">the_compose_id :: Maybe Id
</span><a href="#local-6989586621682057198"><span class="hs-identifier hs-var hs-var">the_compose_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Id)] -&gt; Name -&gt; Maybe Id
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621682057193"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#composeAName"><span class="hs-identifier hs-var">composeAName</span></a></span><span>
</span><span id="line-72"></span><span>             </span><span id="local-6989586621682057200"><span class="annot"><span class="annottext">the_first_id :: Maybe Id
</span><a href="#local-6989586621682057200"><span class="hs-identifier hs-var hs-var">the_first_id</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Id)] -&gt; Name -&gt; Maybe Id
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621682057193"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#firstAName"><span class="hs-identifier hs-var">firstAName</span></a></span><span>
</span><span id="line-73"></span><span>             </span><span id="local-6989586621682057202"><span class="annot"><span class="annottext">the_app_id :: Maybe Id
</span><a href="#local-6989586621682057202"><span class="hs-identifier hs-var hs-var">the_app_id</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Id)] -&gt; Name -&gt; Maybe Id
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621682057193"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#appAName"><span class="hs-identifier hs-var">appAName</span></a></span><span>
</span><span id="line-74"></span><span>             </span><span id="local-6989586621682057204"><span class="annot"><span class="annottext">the_choice_id :: Maybe Id
</span><a href="#local-6989586621682057204"><span class="hs-identifier hs-var hs-var">the_choice_id</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Id)] -&gt; Name -&gt; Maybe Id
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621682057193"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#choiceAName"><span class="hs-identifier hs-var">choiceAName</span></a></span><span>
</span><span id="line-75"></span><span>             </span><span id="local-6989586621682057206"><span class="annot"><span class="annottext">the_loop_id :: Maybe Id
</span><a href="#local-6989586621682057206"><span class="hs-identifier hs-var hs-var">the_loop_id</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Id)] -&gt; Name -&gt; Maybe Id
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621682057193"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#loopAName"><span class="hs-identifier hs-var">loopAName</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([CoreBind], DsCmdEnv) -&gt; DsM ([CoreBind], DsCmdEnv)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621682057192"><span class="hs-identifier hs-var">meth_binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-78"></span><span>               </span><span class="annot"><span class="annottext">arr_id :: CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#arr_id"><span class="hs-identifier hs-var">arr_id</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Id -&gt; Name -&gt; Id
forall {a} {a}. Outputable a =&gt; Maybe a -&gt; a -&gt; a
</span><a href="#local-6989586621682057209"><span class="hs-identifier hs-var">unmaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682057196"><span class="hs-identifier hs-var">the_arr_id</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#arrAName"><span class="hs-identifier hs-var">arrAName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>               </span><span class="annot"><span class="annottext">compose_id :: CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#compose_id"><span class="hs-identifier hs-var">compose_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Id -&gt; Name -&gt; Id
forall {a} {a}. Outputable a =&gt; Maybe a -&gt; a -&gt; a
</span><a href="#local-6989586621682057209"><span class="hs-identifier hs-var">unmaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682057198"><span class="hs-identifier hs-var">the_compose_id</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#composeAName"><span class="hs-identifier hs-var">composeAName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>               </span><span class="annot"><span class="annottext">first_id :: CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#first_id"><span class="hs-identifier hs-var">first_id</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Id -&gt; Name -&gt; Id
forall {a} {a}. Outputable a =&gt; Maybe a -&gt; a -&gt; a
</span><a href="#local-6989586621682057209"><span class="hs-identifier hs-var">unmaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682057200"><span class="hs-identifier hs-var">the_first_id</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#firstAName"><span class="hs-identifier hs-var">firstAName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>               </span><span class="annot"><span class="annottext">app_id :: CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#app_id"><span class="hs-identifier hs-var">app_id</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Id -&gt; Name -&gt; Id
forall {a} {a}. Outputable a =&gt; Maybe a -&gt; a -&gt; a
</span><a href="#local-6989586621682057209"><span class="hs-identifier hs-var">unmaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682057202"><span class="hs-identifier hs-var">the_app_id</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#appAName"><span class="hs-identifier hs-var">appAName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>               </span><span class="annot"><span class="annottext">choice_id :: CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#choice_id"><span class="hs-identifier hs-var">choice_id</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Id -&gt; Name -&gt; Id
forall {a} {a}. Outputable a =&gt; Maybe a -&gt; a -&gt; a
</span><a href="#local-6989586621682057209"><span class="hs-identifier hs-var">unmaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682057204"><span class="hs-identifier hs-var">the_choice_id</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#choiceAName"><span class="hs-identifier hs-var">choiceAName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>               </span><span class="annot"><span class="annottext">loop_id :: CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#loop_id"><span class="hs-identifier hs-var">loop_id</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Id -&gt; Name -&gt; Id
forall {a} {a}. Outputable a =&gt; Maybe a -&gt; a -&gt; a
</span><a href="#local-6989586621682057209"><span class="hs-identifier hs-var">unmaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621682057206"><span class="hs-identifier hs-var">the_loop_id</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#loopAName"><span class="hs-identifier hs-var">loopAName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>             </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621682057195"><span class="annot"><span class="annottext">mk_bind :: (a, HsExpr (GhcPass 'Typechecked))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreBind, (a, Id))
</span><a href="#local-6989586621682057195"><span class="hs-identifier hs-var hs-var">mk_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057214"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057214"><span class="hs-identifier hs-var">std_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057215"><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057215"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682057216"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057216"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057215"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-88"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621682057217"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057217"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057216"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>           </span><span class="hs-comment">-- no check needed; these are functions</span><span>
</span><span id="line-90"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(CoreBind, (a, Id))
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (CoreBind, (a, Id))
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreBind
forall b. b -&gt; Expr b -&gt; Bind b
</span><a href="GHC.Core.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057217"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057216"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057214"><span class="hs-identifier hs-var">std_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057217"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621682057209"><span class="annot"><span class="annottext">unmaybe :: Maybe a -&gt; a -&gt; a
</span><a href="#local-6989586621682057209"><span class="hs-identifier hs-var hs-var">unmaybe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621682057229"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057229"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkCmdEnv&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not found:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057229"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="#local-6989586621682057209"><span class="hs-identifier hs-var">unmaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682057234"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057234"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682057234"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- arr :: forall b c. (b -&gt; c) -&gt; a b c</span><span>
</span><span id="line-96"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-type">do_arr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-97"></span><span id="do_arr"><span class="annot"><span class="annottext">do_arr :: DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var hs-var">do_arr</span></a></span></span><span> </span><span id="local-6989586621682057236"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057236"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057237"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057237"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span id="local-6989586621682057238"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057238"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span id="local-6989586621682057239"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057239"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#arr_id"><span class="hs-identifier hs-var">arr_id</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057236"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057237"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057238"><span class="hs-identifier hs-var">c_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057239"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- (&gt;&gt;&gt;) :: forall b c d. a b c -&gt; a c d -&gt; a b d</span><span>
</span><span id="line-100"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-type">do_compose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>                </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-102"></span><span id="do_compose"><span class="annot"><span class="annottext">do_compose :: DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var hs-var">do_compose</span></a></span></span><span> </span><span id="local-6989586621682057243"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057243"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057244"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057244"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span id="local-6989586621682057245"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057245"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span id="local-6989586621682057246"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057246"><span class="hs-identifier hs-var">d_ty</span></a></span></span><span> </span><span id="local-6989586621682057247"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057247"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682057248"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057248"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#compose_id"><span class="hs-identifier hs-var">compose_id</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057243"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057244"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057245"><span class="hs-identifier hs-var">c_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057246"><span class="hs-identifier hs-var">d_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057247"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057248"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- first :: forall b c d. a b c -&gt; a (b,d) (c,d)</span><span>
</span><span id="line-106"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#do_first"><span class="hs-identifier hs-type">do_first</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-107"></span><span id="do_first"><span class="annot"><span class="annottext">do_first :: DsCmdEnv -&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_first"><span class="hs-identifier hs-var hs-var">do_first</span></a></span></span><span> </span><span id="local-6989586621682057250"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057250"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057251"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057251"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span id="local-6989586621682057252"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057252"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span id="local-6989586621682057253"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057253"><span class="hs-identifier hs-var">d_ty</span></a></span></span><span> </span><span id="local-6989586621682057254"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057254"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#first_id"><span class="hs-identifier hs-var">first_id</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057250"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057251"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057252"><span class="hs-identifier hs-var">c_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057253"><span class="hs-identifier hs-var">d_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057254"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- app :: forall b c. a (a b c, b) c</span><span>
</span><span id="line-111"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#do_app"><span class="hs-identifier hs-type">do_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-112"></span><span id="do_app"><span class="annot"><span class="annottext">do_app :: DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_app"><span class="hs-identifier hs-var hs-var">do_app</span></a></span></span><span> </span><span id="local-6989586621682057256"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057256"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057257"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057257"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span id="local-6989586621682057258"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057258"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#app_id"><span class="hs-identifier hs-var">app_id</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057256"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057257"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057258"><span class="hs-identifier hs-var">c_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- (|||) :: forall b d c. a b d -&gt; a c d -&gt; a (Either b c) d</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- note the swapping of d and c</span><span>
</span><span id="line-116"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#do_choice"><span class="hs-identifier hs-type">do_choice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-117"></span><span>                </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-118"></span><span id="do_choice"><span class="annot"><span class="annottext">do_choice :: DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_choice"><span class="hs-identifier hs-var hs-var">do_choice</span></a></span></span><span> </span><span id="local-6989586621682057260"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057260"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057261"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057261"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span id="local-6989586621682057262"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057262"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span id="local-6989586621682057263"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057263"><span class="hs-identifier hs-var">d_ty</span></a></span></span><span> </span><span id="local-6989586621682057264"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057264"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682057265"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057265"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#choice_id"><span class="hs-identifier hs-var">choice_id</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057260"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057261"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057263"><span class="hs-identifier hs-var">d_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057262"><span class="hs-identifier hs-var">c_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057264"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057265"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- loop :: forall b d c. a (b,d) (c,d) -&gt; a b c</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- note the swapping of d and c</span><span>
</span><span id="line-123"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#do_loop"><span class="hs-identifier hs-type">do_loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-124"></span><span id="do_loop"><span class="annot"><span class="annottext">do_loop :: DsCmdEnv -&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_loop"><span class="hs-identifier hs-var hs-var">do_loop</span></a></span></span><span> </span><span id="local-6989586621682057267"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057267"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057268"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057268"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span id="local-6989586621682057269"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057269"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span id="local-6989586621682057270"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057270"><span class="hs-identifier hs-var">d_ty</span></a></span></span><span> </span><span id="local-6989586621682057271"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057271"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#loop_id"><span class="hs-identifier hs-var">loop_id</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057267"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057268"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057270"><span class="hs-identifier hs-var">d_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057269"><span class="hs-identifier hs-var">c_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057271"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- premap :: forall b c d. (b -&gt; c) -&gt; a c d -&gt; a b d</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- premap f g = arr f &gt;&gt;&gt; g</span><span>
</span><span id="line-129"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-type">do_premap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>                </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-131"></span><span id="do_premap"><span class="annot"><span class="annottext">do_premap :: DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var hs-var">do_premap</span></a></span></span><span> </span><span id="local-6989586621682057273"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057273"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057274"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057274"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span id="local-6989586621682057275"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057275"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span id="local-6989586621682057276"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057276"><span class="hs-identifier hs-var">d_ty</span></a></span></span><span> </span><span id="local-6989586621682057277"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057277"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682057278"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057278"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-132"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var">do_compose</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057273"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057274"><span class="hs-identifier hs-var">b_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057275"><span class="hs-identifier hs-var">c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057276"><span class="hs-identifier hs-var">d_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var">do_arr</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057273"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057274"><span class="hs-identifier hs-var">b_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057275"><span class="hs-identifier hs-var">c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057277"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057278"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- construct CoreExpr for \ (a :: a_ty, b :: b_ty) -&gt; a</span><span>
</span><span id="line-135"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#mkFstExpr"><span class="hs-identifier hs-type">mkFstExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-136"></span><span id="mkFstExpr"><span class="annot"><span class="annottext">mkFstExpr :: Type -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkFstExpr"><span class="hs-identifier hs-var hs-var">mkFstExpr</span></a></span></span><span> </span><span id="local-6989586621682057280"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057280"><span class="hs-identifier hs-var">a_ty</span></a></span></span><span> </span><span id="local-6989586621682057281"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057281"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621682057282"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057282"><span class="hs-identifier hs-var">a_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057280"><span class="hs-identifier hs-var">a_ty</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621682057283"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057283"><span class="hs-identifier hs-var">b_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057281"><span class="hs-identifier hs-var">b_ty</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621682057284"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057284"><span class="hs-identifier hs-var">pair_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057280"><span class="hs-identifier hs-var">a_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057281"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057284"><span class="hs-identifier hs-var">pair_var</span></a></span><span>
</span><span id="line-141"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCasePair"><span class="hs-identifier hs-var">coreCasePair</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057284"><span class="hs-identifier hs-var">pair_var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057282"><span class="hs-identifier hs-var">a_var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057283"><span class="hs-identifier hs-var">b_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057282"><span class="hs-identifier hs-var">a_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- construct CoreExpr for \ (a :: a_ty, b :: b_ty) -&gt; b</span><span>
</span><span id="line-144"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#mkSndExpr"><span class="hs-identifier hs-type">mkSndExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-145"></span><span id="mkSndExpr"><span class="annot"><span class="annottext">mkSndExpr :: Type -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkSndExpr"><span class="hs-identifier hs-var hs-var">mkSndExpr</span></a></span></span><span> </span><span id="local-6989586621682057289"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057289"><span class="hs-identifier hs-var">a_ty</span></a></span></span><span> </span><span id="local-6989586621682057290"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057290"><span class="hs-identifier hs-var">b_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621682057291"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057291"><span class="hs-identifier hs-var">a_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057289"><span class="hs-identifier hs-var">a_ty</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span id="local-6989586621682057292"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057292"><span class="hs-identifier hs-var">b_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057290"><span class="hs-identifier hs-var">b_ty</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621682057293"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057293"><span class="hs-identifier hs-var">pair_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057289"><span class="hs-identifier hs-var">a_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057290"><span class="hs-identifier hs-var">b_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057293"><span class="hs-identifier hs-var">pair_var</span></a></span><span>
</span><span id="line-150"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCasePair"><span class="hs-identifier hs-var">coreCasePair</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057293"><span class="hs-identifier hs-var">pair_var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057291"><span class="hs-identifier hs-var">a_var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057292"><span class="hs-identifier hs-var">b_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057292"><span class="hs-identifier hs-var">b_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">{-
Build case analysis of a tuple.  This cannot be done in the DsM monad,
because the list of variables is typically not yet defined.
-}</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- coreCaseTuple [u1..] v [x1..xn] body</span><span>
</span><span id="line-158"></span><span class="hs-comment">--      = case v of v { (x1, .., xn) -&gt; body }</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- But the matching may be nested if the tuple is very big</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#coreCaseTuple"><span class="hs-identifier hs-type">coreCaseTuple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-162"></span><span id="coreCaseTuple"><span class="annot"><span class="annottext">coreCaseTuple :: UniqSupply -&gt; Id -&gt; [Id] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCaseTuple"><span class="hs-identifier hs-var hs-var">coreCaseTuple</span></a></span></span><span> </span><span id="local-6989586621682057295"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057295"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span> </span><span id="local-6989586621682057296"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057296"><span class="hs-identifier hs-var">scrut_var</span></a></span></span><span> </span><span id="local-6989586621682057297"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057297"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621682057298"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057298"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; [Id] -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigTupleCase"><span class="hs-identifier hs-var">mkBigTupleCase</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057295"><span class="hs-identifier hs-var">uniqs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057297"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057298"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057296"><span class="hs-identifier hs-var">scrut_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#coreCasePair"><span class="hs-identifier hs-type">coreCasePair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-166"></span><span id="coreCasePair"><span class="annot"><span class="annottext">coreCasePair :: Id -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCasePair"><span class="hs-identifier hs-var hs-var">coreCasePair</span></a></span></span><span> </span><span id="local-6989586621682057300"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057300"><span class="hs-identifier hs-var">scrut_var</span></a></span></span><span> </span><span id="local-6989586621682057301"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057301"><span class="hs-identifier hs-var">var1</span></a></span></span><span> </span><span id="local-6989586621682057302"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057302"><span class="hs-identifier hs-var">var2</span></a></span></span><span> </span><span id="local-6989586621682057303"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057303"><span class="hs-identifier hs-var">body</span></a></span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Id -&gt; Type -&gt; [Alt Id] -&gt; CoreExpr
forall b. Expr b -&gt; b -&gt; Type -&gt; [Alt b] -&gt; Expr b
</span><a href="GHC.Core.html#Case"><span class="hs-identifier hs-var">Case</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057300"><span class="hs-identifier hs-var">scrut_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057300"><span class="hs-identifier hs-var">scrut_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057303"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>         </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AltCon -&gt; [Id] -&gt; CoreExpr -&gt; Alt Id
forall b. AltCon -&gt; [b] -&gt; Expr b -&gt; Alt b
</span><a href="GHC.Core.html#Alt"><span class="hs-identifier hs-var">Alt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; AltCon
</span><a href="GHC.Core.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; DataCon
</span><a href="GHC.Builtin.Types.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="Language.Haskell.Syntax.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057301"><span class="hs-identifier hs-var">var1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057302"><span class="hs-identifier hs-var">var2</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057303"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-type">mkCorePairTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-171"></span><span id="mkCorePairTy"><span class="annot"><span class="annottext">mkCorePairTy :: Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var hs-var">mkCorePairTy</span></a></span></span><span> </span><span id="local-6989586621682057309"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057309"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621682057310"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057310"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type
</span><a href="GHC.Builtin.Types.html#mkBoxedTupleTy"><span class="hs-identifier hs-var">mkBoxedTupleTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057309"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057310"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-type">mkCorePairExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-174"></span><span id="mkCorePairExpr"><span class="annot"><span class="annottext">mkCorePairExpr :: CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var hs-var">mkCorePairExpr</span></a></span></span><span> </span><span id="local-6989586621682057313"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057313"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621682057314"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057314"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreTup"><span class="hs-identifier hs-var">mkCoreTup</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057313"><span class="hs-identifier hs-var">e1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057314"><span class="hs-identifier hs-var">e2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#mkCoreUnitExpr"><span class="hs-identifier hs-type">mkCoreUnitExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-177"></span><span id="mkCoreUnitExpr"><span class="annot"><span class="annottext">mkCoreUnitExpr :: CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCoreUnitExpr"><span class="hs-identifier hs-var hs-var">mkCoreUnitExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreTup"><span class="hs-identifier hs-var">mkCoreTup</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">{- Note [Environment and stack]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The input is divided into

* A local environment, which is a flat tuple (unless it's too big)
  The elements of the local environment can be
  - of kind Type (for ordinary variables), or
  - of kind Constraint (for dictionaries bound by patterns)

* A stack, which is a right-nested pair.
  The elements on the stack are always of kind Type.

So in general, the input has the form

        ((x1,...,xn), (s1,...(sk,())...))

where xi are the environment values, and si the ones on the stack,
with s1 being the &quot;top&quot;, the first one to be matched with a lambda.
-}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-type">envStackType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-200"></span><span id="envStackType"><span class="annot"><span class="annottext">envStackType :: [Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var hs-var">envStackType</span></a></span></span><span> </span><span id="local-6989586621682057318"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057318"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057319"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057319"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057318"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057319"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- splitTypeAt n (t1,... (tn,t)...) = ([t1, ..., tn], t)</span><span>
</span><span id="line-203"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#splitTypeAt"><span class="hs-identifier hs-type">splitTypeAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span id="splitTypeAt"><span class="annot"><span class="annottext">splitTypeAt :: Int -&gt; Type -&gt; ([Type], Type)
</span><a href="GHC.HsToCore.Arrows.html#splitTypeAt"><span class="hs-identifier hs-var hs-var">splitTypeAt</span></a></span></span><span> </span><span id="local-6989586621682057322"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682057322"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621682057323"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057323"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682057322"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057323"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="GHC.Tc.Utils.TcType.html#tcTyConAppArgs"><span class="hs-identifier hs-var">tcTyConAppArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057323"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621682057325"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057325"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057326"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057326"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057327"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682057327"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057328"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057328"><span class="hs-identifier hs-var">ty_r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; ([Type], Type)
</span><a href="GHC.HsToCore.Arrows.html#splitTypeAt"><span class="hs-identifier hs-var">splitTypeAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682057322"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.2.1/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057326"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057325"><span class="hs-identifier hs-var">t</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682057327"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057328"><span class="hs-identifier hs-var">ty_r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ([Type], Type)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;splitTypeAt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057323"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-211"></span><span class="hs-comment">--              buildEnvStack</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-comment">--      ((x1,...,xn),stk)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-type">buildEnvStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-216"></span><span id="buildEnvStack"><span class="annot"><span class="annottext">buildEnvStack :: [Id] -&gt; Id -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-var hs-var">buildEnvStack</span></a></span></span><span> </span><span id="local-6989586621682057330"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057330"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span id="local-6989586621682057331"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057331"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057330"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057331"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-220"></span><span class="hs-comment">--              matchEnvStack</span><span>
</span><span id="line-221"></span><span class="hs-comment">--</span><span>
</span><span id="line-222"></span><span class="hs-comment">--      \ ((x1,...,xn),stk) -&gt; body</span><span>
</span><span id="line-223"></span><span class="hs-comment">--      =&gt;</span><span>
</span><span id="line-224"></span><span class="hs-comment">--      \ pair -&gt;</span><span>
</span><span id="line-225"></span><span class="hs-comment">--      case pair of (tup,stk) -&gt;</span><span>
</span><span id="line-226"></span><span class="hs-comment">--      case tup of (x1,...,xn) -&gt;</span><span>
</span><span id="line-227"></span><span class="hs-comment">--      body</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-type">matchEnvStack</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- x1..xn</span><span>
</span><span id="line-230"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>           </span><span class="hs-comment">-- stk</span><span>
</span><span id="line-231"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>     </span><span class="hs-comment">-- e</span><span>
</span><span id="line-232"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-233"></span><span id="matchEnvStack"><span class="annot"><span class="annottext">matchEnvStack :: [Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var hs-var">matchEnvStack</span></a></span></span><span> </span><span id="local-6989586621682057334"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057334"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span id="local-6989586621682057335"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057335"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span id="local-6989586621682057336"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057336"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621682057337"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057337"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621682057339"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057339"><span class="hs-identifier hs-var">tup_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057334"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057340"><span class="annot"><span class="annottext">match_env :: CoreExpr
</span><a href="#local-6989586621682057340"><span class="hs-identifier hs-var hs-var">match_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; Id -&gt; [Id] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCaseTuple"><span class="hs-identifier hs-var">coreCaseTuple</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057337"><span class="hs-identifier hs-var">uniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057339"><span class="hs-identifier hs-var">tup_var</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057334"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057336"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621682057341"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057341"><span class="hs-identifier hs-var">pair_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057339"><span class="hs-identifier hs-var">tup_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057335"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057341"><span class="hs-identifier hs-var">pair_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCasePair"><span class="hs-identifier hs-var">coreCasePair</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057341"><span class="hs-identifier hs-var">pair_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057339"><span class="hs-identifier hs-var">tup_var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057335"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057340"><span class="hs-identifier hs-var">match_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-241"></span><span class="hs-comment">--              matchEnv</span><span>
</span><span id="line-242"></span><span class="hs-comment">--</span><span>
</span><span id="line-243"></span><span class="hs-comment">--      \ (x1,...,xn) -&gt; body</span><span>
</span><span id="line-244"></span><span class="hs-comment">--      =&gt;</span><span>
</span><span id="line-245"></span><span class="hs-comment">--      \ tup -&gt;</span><span>
</span><span id="line-246"></span><span class="hs-comment">--      case tup of (x1,...,xn) -&gt;</span><span>
</span><span id="line-247"></span><span class="hs-comment">--      body</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#matchEnv"><span class="hs-identifier hs-type">matchEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- x1..xn</span><span>
</span><span id="line-250"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>    </span><span class="hs-comment">-- e</span><span>
</span><span id="line-251"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-252"></span><span id="matchEnv"><span class="annot"><span class="annottext">matchEnv :: [Id] -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnv"><span class="hs-identifier hs-var hs-var">matchEnv</span></a></span></span><span> </span><span id="local-6989586621682057344"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057344"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span id="local-6989586621682057345"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057345"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621682057346"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057346"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621682057347"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057347"><span class="hs-identifier hs-var">tup_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057344"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057347"><span class="hs-identifier hs-var">tup_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; Id -&gt; [Id] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCaseTuple"><span class="hs-identifier hs-var">coreCaseTuple</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057346"><span class="hs-identifier hs-var">uniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057347"><span class="hs-identifier hs-var">tup_id</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057344"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057345"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">----------------------------------------------</span><span>
</span><span id="line-258"></span><span class="hs-comment">--              matchVarStack</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-comment">--      case (x1, ...(xn, s)...) -&gt; e</span><span>
</span><span id="line-261"></span><span class="hs-comment">--      =&gt;</span><span>
</span><span id="line-262"></span><span class="hs-comment">--      case z0 of (x1,z1) -&gt;</span><span>
</span><span id="line-263"></span><span class="hs-comment">--      case zn-1 of (xn,s) -&gt;</span><span>
</span><span id="line-264"></span><span class="hs-comment">--      e</span><span>
</span><span id="line-265"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#matchVarStack"><span class="hs-identifier hs-type">matchVarStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span id="matchVarStack"><span class="annot"><span class="annottext">matchVarStack :: [Id] -&gt; Id -&gt; CoreExpr -&gt; DsM (Id, CoreExpr)
</span><a href="GHC.HsToCore.Arrows.html#matchVarStack"><span class="hs-identifier hs-var hs-var">matchVarStack</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682057349"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057349"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span id="local-6989586621682057350"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057350"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; DsM (Id, CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057349"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057350"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#matchVarStack"><span class="hs-identifier hs-var">matchVarStack</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057351"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057351"><span class="hs-identifier hs-var">param_id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682057352"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057352"><span class="hs-identifier hs-var">param_ids</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057353"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057353"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span id="local-6989586621682057354"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057354"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057355"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057355"><span class="hs-identifier hs-var">tail_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057356"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057356"><span class="hs-identifier hs-var">tail_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM (Id, CoreExpr)
</span><a href="GHC.HsToCore.Arrows.html#matchVarStack"><span class="hs-identifier hs-var">matchVarStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057352"><span class="hs-identifier hs-var">param_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057353"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057354"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621682057357"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057357"><span class="hs-identifier hs-var">pair_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057351"><span class="hs-identifier hs-var">param_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057355"><span class="hs-identifier hs-var">tail_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="annottext">(Id, CoreExpr) -&gt; DsM (Id, CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057357"><span class="hs-identifier hs-var">pair_id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCasePair"><span class="hs-identifier hs-var">coreCasePair</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057357"><span class="hs-identifier hs-var">pair_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057351"><span class="hs-identifier hs-var">param_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057355"><span class="hs-identifier hs-var">tail_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057356"><span class="hs-identifier hs-var">tail_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#mkHsEnvStackExpr"><span class="hs-identifier hs-type">mkHsEnvStackExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-273"></span><span id="mkHsEnvStackExpr"><span class="annot"><span class="annottext">mkHsEnvStackExpr :: [Id] -&gt; Id -&gt; LHsExpr (GhcPass 'Typechecked)
</span><a href="GHC.HsToCore.Arrows.html#mkHsEnvStackExpr"><span class="hs-identifier hs-var hs-var">mkHsEnvStackExpr</span></a></span></span><span> </span><span id="local-6989586621682057359"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057359"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span id="local-6989586621682057360"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057360"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Typechecked)]
-&gt; XExplicitTuple (GhcPass 'Typechecked)
-&gt; LHsExpr (GhcPass 'Typechecked)
forall (p :: Pass).
[LHsExpr (GhcPass p)]
-&gt; XExplicitTuple (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#mkLHsTupleExpr"><span class="hs-identifier hs-var">mkLHsTupleExpr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
-&gt; XExplicitTuple (GhcPass 'Typechecked)
-&gt; LHsExpr (GhcPass 'Typechecked)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
[IdP (GhcPass p)]
-&gt; XExplicitTuple (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#mkLHsVarTuple"><span class="hs-identifier hs-var">mkLHsVarTuple</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
[Id]
</span><a href="#local-6989586621682057359"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple (GhcPass 'Typechecked)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Typechecked) -&gt; LHsExpr (GhcPass 'Typechecked)
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Typechecked)
Id
</span><a href="#local-6989586621682057360"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-275"></span><span>                   </span><span class="annot"><span class="annottext">XExplicitTuple (GhcPass 'Typechecked)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-comment">-- Translation of arrow abstraction</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- D; xs |-a c : () --&gt; t'      ---&gt; c'</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- --------------------------</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- D |- proc p -&gt; c :: a t t'   ---&gt; premap (\ p -&gt; ((xs),())) c'</span><span>
</span><span id="line-282"></span><span class="hs-comment">--</span><span>
</span><span id="line-283"></span><span class="hs-comment">--              where (xs) is the tuple of variables bound by p</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsProcExpr"><span class="hs-identifier hs-type">dsProcExpr</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmdTop"><span class="hs-identifier hs-type">LHsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-289"></span><span id="dsProcExpr"><span class="annot"><span class="annottext">dsProcExpr :: LPat (GhcPass 'Typechecked)
-&gt; LHsCmdTop (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#dsProcExpr"><span class="hs-identifier hs-var hs-var">dsProcExpr</span></a></span></span><span> </span><span id="local-6989586621682057365"><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057365"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdTop"><span class="hs-identifier hs-type">HsCmdTop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#CmdTopTc"><span class="hs-identifier hs-type">CmdTopTc</span></a></span><span> </span><span id="local-6989586621682057369"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057369"><span class="hs-identifier hs-var">_unitTy</span></a></span></span><span> </span><span id="local-6989586621682057370"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057370"><span class="hs-identifier hs-var">cmd_ty</span></a></span></span><span> </span><span id="local-6989586621682057371"><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057371"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057372"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057372"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057373"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621682057373"><span class="hs-identifier hs-var">meth_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057374"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057374"><span class="hs-identifier hs-var">meth_ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked) -&gt; DsM ([CoreBind], DsCmdEnv)
</span><a href="GHC.HsToCore.Arrows.html#mkCmdEnv"><span class="hs-identifier hs-var">mkCmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057371"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057375"><span class="annot"><span class="annottext">locals :: VarSet
</span><a href="#local-6989586621682057375"><span class="hs-identifier hs-var hs-var">locals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; LPat (GhcPass 'Typechecked) -&gt; [IdP (GhcPass 'Typechecked)]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057365"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057379"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057379"><span class="hs-identifier hs-var">core_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057380"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057380"><span class="hs-identifier hs-var">_free_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057381"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057381"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057374"><span class="hs-identifier hs-var">meth_ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057375"><span class="hs-identifier hs-var">locals</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057370"><span class="hs-identifier hs-var">cmd_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057372"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057384"><span class="annot"><span class="annottext">env_ty :: Type
</span><a href="#local-6989586621682057384"><span class="hs-identifier hs-var hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057381"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057385"><span class="annot"><span class="annottext">env_stk_ty :: Type
</span><a href="#local-6989586621682057385"><span class="hs-identifier hs-var hs-var">env_stk_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057384"><span class="hs-identifier hs-var">env_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057386"><span class="annot"><span class="annottext">env_stk_expr :: CoreExpr
</span><a href="#local-6989586621682057386"><span class="hs-identifier hs-var hs-var">env_stk_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057381"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCoreUnitExpr"><span class="hs-identifier hs-var">mkCoreUnitExpr</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621682057387"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057387"><span class="hs-identifier hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkFailExpr"><span class="hs-identifier hs-var">mkFailExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsArrowMatchContext -&gt; HsMatchContext GhcRn
forall p. HsArrowMatchContext -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-var">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrowMatchContext
</span><a href="Language.Haskell.Syntax.Expr.html#ProcExpr"><span class="hs-identifier hs-var">ProcExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057385"><span class="hs-identifier hs-var">env_stk_ty</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621682057391"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057391"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; LPat (GhcPass 'Typechecked) -&gt; DsM Id
</span><a href="GHC.HsToCore.Utils.html#selectSimpleMatchVarL"><span class="hs-identifier hs-var">selectSimpleMatchVarL</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057365"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621682057393"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057393"><span class="hs-identifier hs-var">match_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; HsMatchContext GhcRn
-&gt; LPat (GhcPass 'Typechecked)
-&gt; CoreExpr
-&gt; CoreExpr
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Match.html#matchSimply"><span class="hs-identifier hs-var">matchSimply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057391"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsArrowMatchContext -&gt; HsMatchContext GhcRn
forall p. HsArrowMatchContext -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-var">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrowMatchContext
</span><a href="Language.Haskell.Syntax.Expr.html#ProcExpr"><span class="hs-identifier hs-var">ProcExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057365"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057386"><span class="hs-identifier hs-var">env_stk_expr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057387"><span class="hs-identifier hs-var">fail_expr</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057395"><span class="annot"><span class="annottext">pat_ty :: Type
</span><a href="#local-6989586621682057395"><span class="hs-identifier hs-var hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked) -&gt; Type
</span><a href="GHC.Hs.Syn.Type.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057365"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057397"><span class="annot"><span class="annottext">proc_code :: CoreExpr
</span><a href="#local-6989586621682057397"><span class="hs-identifier hs-var hs-var">proc_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057374"><span class="hs-identifier hs-var">meth_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057395"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057385"><span class="hs-identifier hs-var">env_stk_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057370"><span class="hs-identifier hs-var">cmd_ty</span></a></span><span>
</span><span id="line-302"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057391"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057393"><span class="hs-identifier hs-var">match_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>                    </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057379"><span class="hs-identifier hs-var">core_cmd</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreBind] -&gt; CoreExpr -&gt; CoreExpr
forall b. [Bind b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621682057373"><span class="hs-identifier hs-var">meth_binds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057397"><span class="hs-identifier hs-var">proc_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">{-
Translation of a command judgement of the form

        D; xs |-a c : stk --&gt; t

to an expression e such that

        D |- e :: a (xs, stk) t
-}</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsLCmd"><span class="hs-identifier hs-type">dsLCmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-317"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span id="dsLCmd"><span class="annot"><span class="annottext">dsLCmd :: DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsLCmd"><span class="hs-identifier hs-var hs-var">dsLCmd</span></a></span></span><span> </span><span id="local-6989586621682057401"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057401"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057402"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057402"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057403"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057403"><span class="hs-identifier hs-var">stk_ty</span></a></span></span><span> </span><span id="local-6989586621682057404"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057404"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682057405"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057405"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621682057406"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057406"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; HsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057401"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057402"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057403"><span class="hs-identifier hs-var">stk_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057404"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (HsCmd (GhcPass 'Typechecked))
-&gt; HsCmd (GhcPass 'Typechecked)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
LocatedA (HsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057405"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057406"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-type">dsCmd</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>             </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this command</span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                 </span><span class="hs-comment">-- type of the stack (right-nested tuple)</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                 </span><span class="hs-comment">-- return type of the command</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmd"><span class="hs-identifier hs-type">HsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>           </span><span class="hs-comment">-- command to desugar</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- list of vars in the input to this command</span><span>
</span><span id="line-327"></span><span>                                </span><span class="hs-comment">-- This is typically fed back,</span><span>
</span><span id="line-328"></span><span>                                </span><span class="hs-comment">-- so don't pull on it too early</span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-330"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-- D |- fun :: a t1 t2</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- D, xs |- arg :: t1</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- -----------------------------</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- D; xs |-a fun -&lt; arg : stk --&gt; t2</span><span>
</span><span id="line-336"></span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span class="hs-comment">--              ---&gt; premap (\ ((xs), _stk) -&gt; arg) fun</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span id="dsCmd"><span class="annot"><span class="annottext">dsCmd :: DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; HsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var hs-var">dsCmd</span></a></span></span><span> </span><span id="local-6989586621682057409"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057409"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057410"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057410"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057411"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057411"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057412"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057412"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrApp"><span class="hs-identifier hs-type">HsCmdArrApp</span></a></span><span> </span><span id="local-6989586621682057414"><span class="annot"><span class="annottext">XCmdArrApp (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057414"><span class="hs-identifier hs-var">arrow_ty</span></a></span></span><span> </span><span id="local-6989586621682057415"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057415"><span class="hs-identifier hs-var">arrow</span></a></span></span><span> </span><span id="local-6989586621682057416"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057416"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsArrAppType
</span><a href="Language.Haskell.Syntax.Expr.html#HsFirstOrderApp"><span class="hs-identifier hs-var">HsFirstOrderApp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621682057418"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057418"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682057419"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057419"><span class="hs-identifier hs-var">a_arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057420"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057420"><span class="hs-identifier hs-var">_res_ty'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy"><span class="hs-identifier hs-var">tcSplitAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrApp (GhcPass 'Typechecked)
Type
</span><a href="#local-6989586621682057414"><span class="hs-identifier hs-var">arrow_ty</span></a></span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682057422"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057422"><span class="hs-identifier hs-var">_a_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057423"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057423"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy"><span class="hs-identifier hs-var">tcSplitAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057419"><span class="hs-identifier hs-var">a_arg_ty</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621682057424"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057424"><span class="hs-identifier hs-var">core_arrow</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057415"><span class="hs-identifier hs-var">arrow</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621682057425"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057425"><span class="hs-identifier hs-var">core_arg</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057416"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621682057426"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057426"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057411"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621682057427"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057427"><span class="hs-identifier hs-var">core_make_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057418"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057426"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057425"><span class="hs-identifier hs-var">core_arg</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057409"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-350"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057418"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057411"><span class="hs-identifier hs-var">stack_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>              </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057423"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-352"></span><span>              </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057412"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-353"></span><span>              </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057427"><span class="hs-identifier hs-var">core_make_arg</span></a></span><span>
</span><span id="line-354"></span><span>              </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057424"><span class="hs-identifier hs-var">core_arrow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-355"></span><span>            </span><span class="annot"><span class="annottext">CoreExpr -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprFreeIdsDSet"><span class="hs-identifier hs-var">exprFreeIdsDSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057425"><span class="hs-identifier hs-var">core_arg</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057410"><span class="hs-identifier hs-var">local_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- D, xs |- fun :: a t1 t2</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- D, xs |- arg :: t1</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- ------------------------------</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- D; xs |-a fun -&lt;&lt; arg : stk --&gt; t2</span><span>
</span><span id="line-361"></span><span class="hs-comment">--</span><span>
</span><span id="line-362"></span><span class="hs-comment">--              ---&gt; premap (\ ((xs), _stk) -&gt; (fun, arg)) app</span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057430"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057430"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057431"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057431"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057432"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057432"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057433"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057433"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrApp"><span class="hs-identifier hs-type">HsCmdArrApp</span></a></span><span> </span><span id="local-6989586621682057434"><span class="annot"><span class="annottext">XCmdArrApp (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057434"><span class="hs-identifier hs-var">arrow_ty</span></a></span></span><span> </span><span id="local-6989586621682057435"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057435"><span class="hs-identifier hs-var">arrow</span></a></span></span><span> </span><span id="local-6989586621682057436"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057436"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsArrAppType
</span><a href="Language.Haskell.Syntax.Expr.html#HsHigherOrderApp"><span class="hs-identifier hs-var">HsHigherOrderApp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>        </span><span id="local-6989586621682057438"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057438"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-368"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682057439"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057439"><span class="hs-identifier hs-var">a_arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057440"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057440"><span class="hs-identifier hs-var">_res_ty'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy"><span class="hs-identifier hs-var">tcSplitAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrApp (GhcPass 'Typechecked)
Type
</span><a href="#local-6989586621682057434"><span class="hs-identifier hs-var">arrow_ty</span></a></span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682057441"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057441"><span class="hs-identifier hs-var">_a_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057442"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057442"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitAppTy"><span class="hs-identifier hs-var">tcSplitAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057439"><span class="hs-identifier hs-var">a_arg_ty</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621682057443"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057443"><span class="hs-identifier hs-var">core_arrow</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057435"><span class="hs-identifier hs-var">arrow</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621682057444"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057444"><span class="hs-identifier hs-var">core_arg</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057436"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621682057445"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057445"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057432"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span id="local-6989586621682057446"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057446"><span class="hs-identifier hs-var">core_make_pair</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057438"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057445"><span class="hs-identifier hs-var">stack_id</span></a></span><span>
</span><span id="line-375"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057443"><span class="hs-identifier hs-var">core_arrow</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057444"><span class="hs-identifier hs-var">core_arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057430"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-378"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057438"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057432"><span class="hs-identifier hs-var">stack_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrApp (GhcPass 'Typechecked)
Type
</span><a href="#local-6989586621682057434"><span class="hs-identifier hs-var">arrow_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057442"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>              </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057433"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-381"></span><span>              </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057446"><span class="hs-identifier hs-var">core_make_pair</span></a></span><span>
</span><span id="line-382"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_app"><span class="hs-identifier hs-var">do_app</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057430"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057442"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057433"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-383"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr] -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprsFreeIdsDSet"><span class="hs-identifier hs-var">exprsFreeIdsDSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057443"><span class="hs-identifier hs-var">core_arrow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057444"><span class="hs-identifier hs-var">core_arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>              </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057431"><span class="hs-identifier hs-var">local_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- D; ys |-a cmd : (t,stk) --&gt; t'</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- D, xs |-  exp :: t</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- ------------------------</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- D; xs |-a cmd exp : stk --&gt; t'</span><span>
</span><span id="line-390"></span><span class="hs-comment">--</span><span>
</span><span id="line-391"></span><span class="hs-comment">--              ---&gt; premap (\ ((xs),stk) -&gt; ((ys),(e,stk))) cmd</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057448"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057448"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057449"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057450"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057450"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057451"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057451"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdApp"><span class="hs-identifier hs-type">HsCmdApp</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdApp (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057453"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057453"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621682057454"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057454"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057455"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057455"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621682057456"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057456"><span class="hs-identifier hs-var">core_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057454"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-396"></span><span>        </span><span id="local-6989586621682057457"><span class="annot"><span class="annottext">arg_ty :: Type
</span><a href="#local-6989586621682057457"><span class="hs-identifier hs-var hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; CoreExpr -&gt; Type
CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057456"><span class="hs-identifier hs-var">core_arg</span></a></span><span>
</span><span id="line-397"></span><span>        </span><span id="local-6989586621682057458"><span class="annot"><span class="annottext">stack_ty' :: Type
</span><a href="#local-6989586621682057458"><span class="hs-identifier hs-var hs-var">stack_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057457"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057450"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057459"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057459"><span class="hs-identifier hs-var">core_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057460"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057460"><span class="hs-identifier hs-var">free_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057461"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057461"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057448"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057458"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057451"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057453"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621682057462"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057462"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057450"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621682057463"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057463"><span class="hs-identifier hs-var">arg_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057457"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-comment">-- push the argument expression onto the stack</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-404"></span><span>        </span><span id="local-6989586621682057464"><span class="annot"><span class="annottext">stack' :: CoreExpr
</span><a href="#local-6989586621682057464"><span class="hs-identifier hs-var hs-var">stack'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057463"><span class="hs-identifier hs-var">arg_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057462"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>        </span><span id="local-6989586621682057465"><span class="annot"><span class="annottext">core_body :: CoreExpr
</span><a href="#local-6989586621682057465"><span class="hs-identifier hs-var hs-var">core_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Id -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
Id -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#bindNonRec"><span class="hs-identifier hs-var">bindNonRec</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057463"><span class="hs-identifier hs-var">arg_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057456"><span class="hs-identifier hs-var">core_arg</span></a></span><span>
</span><span id="line-406"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057461"><span class="hs-identifier hs-var">env_ids'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057464"><span class="hs-identifier hs-var">stack'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-comment">-- match the environment and stack against the input</span><span>
</span><span id="line-409"></span><span>    </span><span id="local-6989586621682057467"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057467"><span class="hs-identifier hs-var">core_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057455"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057462"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057465"><span class="hs-identifier hs-var">core_body</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057448"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-411"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057455"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057450"><span class="hs-identifier hs-var">stack_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057461"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057458"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>                      </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057451"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-414"></span><span>                      </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057467"><span class="hs-identifier hs-var">core_map</span></a></span><span>
</span><span id="line-415"></span><span>                      </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057459"><span class="hs-identifier hs-var">core_cmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-416"></span><span>            </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057460"><span class="hs-identifier hs-var">free_vars</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; DIdSet -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSet"><span class="hs-operator hs-var">`unionDVarSet`</span></a></span><span>
</span><span id="line-417"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprFreeIdsDSet"><span class="hs-identifier hs-var">exprFreeIdsDSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057456"><span class="hs-identifier hs-var">core_arg</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057449"><span class="hs-identifier hs-var">local_vars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057469"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057469"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057470"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057470"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057471"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057471"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057472"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057472"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLam"><span class="hs-identifier hs-type">HsCmdLam</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdLam (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span>
</span><span id="line-421"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_pats :: forall p body. Match p body -&gt; [LPat p]
</span><a href="Language.Haskell.Syntax.Expr.html#m_pats"><span class="hs-identifier hs-var">m_pats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057478"><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057478"><span class="hs-identifier hs-var">pats</span></a></span></span><span>
</span><span id="line-422"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">m_grhss :: forall p body. Match p body -&gt; GRHSs p body
</span><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHSs
  (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked)))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHS
  (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked)))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682057482"><span class="annot"><span class="annottext">LocatedA (HsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057482"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>        </span><span id="local-6989586621682057483"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057483"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; [LPat (GhcPass 'Typechecked)]
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdLam"><span class="hs-identifier hs-var">dsCmdLam</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057469"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057470"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057471"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057472"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057478"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
LocatedA (HsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057482"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057483"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057485"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057485"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057486"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057486"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057487"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057487"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057488"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057488"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdPar"><span class="hs-identifier hs-type">HsCmdPar</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdPar (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;(&quot; (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057490"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057490"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;)&quot; (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057491"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057491"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsLCmd"><span class="hs-identifier hs-var">dsLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057485"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057486"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057487"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057488"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057490"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057491"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-comment">-- D, xs |- e :: Bool</span><span>
</span><span id="line-430"></span><span class="hs-comment">-- D; xs1 |-a c1 : stk --&gt; t</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- D; xs2 |-a c2 : stk --&gt; t</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- ----------------------------------------</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- D; xs |-a if e then c1 else c2 : stk --&gt; t</span><span>
</span><span id="line-434"></span><span class="hs-comment">--</span><span>
</span><span id="line-435"></span><span class="hs-comment">--              ---&gt; premap (\ ((xs),stk) -&gt;</span><span>
</span><span id="line-436"></span><span class="hs-comment">--                       if e then Left ((xs1),stk) else Right ((xs2),stk))</span><span>
</span><span id="line-437"></span><span class="hs-comment">--                     (c1 ||| c2)</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057492"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057492"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057493"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057493"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057494"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057494"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057495"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057495"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdIf"><span class="hs-identifier hs-type">HsCmdIf</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdIf (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057497"><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057497"><span class="hs-identifier hs-var">mb_fun</span></a></span></span><span> </span><span id="local-6989586621682057498"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057498"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621682057499"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057499"><span class="hs-identifier hs-var">then_cmd</span></a></span></span><span> </span><span id="local-6989586621682057500"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057500"><span class="hs-identifier hs-var">else_cmd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>        </span><span id="local-6989586621682057501"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057501"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621682057502"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057502"><span class="hs-identifier hs-var">core_cond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057498"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057503"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057503"><span class="hs-identifier hs-var">core_then</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057504"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057504"><span class="hs-identifier hs-var">fvs_then</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057505"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057505"><span class="hs-identifier hs-var">then_ids</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057492"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057493"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057494"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057495"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057499"><span class="hs-identifier hs-var">then_cmd</span></a></span><span>
</span><span id="line-444"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057506"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057506"><span class="hs-identifier hs-var">core_else</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057507"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057507"><span class="hs-identifier hs-var">fvs_else</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057508"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057508"><span class="hs-identifier hs-var">else_ids</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057492"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057493"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057494"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057495"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057500"><span class="hs-identifier hs-var">else_cmd</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621682057509"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057509"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057494"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621682057510"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682057510"><span class="hs-identifier hs-var">either_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var">dsLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#eitherTyConName"><span class="hs-identifier hs-var">eitherTyConName</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span id="local-6989586621682057513"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057513"><span class="hs-identifier hs-var">left_con</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM DataCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-var">dsLookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#leftDataConName"><span class="hs-identifier hs-var">leftDataConName</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621682057516"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057516"><span class="hs-identifier hs-var">right_con</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM DataCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-var">dsLookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#rightDataConName"><span class="hs-identifier hs-var">rightDataConName</span></a></span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057518"><span class="annot"><span class="annottext">mk_left_expr :: Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057518"><span class="hs-identifier hs-var hs-var">mk_left_expr</span></a></span></span><span> </span><span id="local-6989586621682057519"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057519"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682057520"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057520"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682057521"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057521"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057513"><span class="hs-identifier hs-var">left_con</span></a></span><span>   </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057519"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057520"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057521"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-452"></span><span>        </span><span id="local-6989586621682057523"><span class="annot"><span class="annottext">mk_right_expr :: Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057523"><span class="hs-identifier hs-var hs-var">mk_right_expr</span></a></span></span><span> </span><span id="local-6989586621682057524"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057524"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682057525"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057525"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682057526"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057526"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057516"><span class="hs-identifier hs-var">right_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057524"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057525"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057526"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span>        </span><span id="local-6989586621682057527"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057527"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057501"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057494"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-455"></span><span>        </span><span id="local-6989586621682057528"><span class="annot"><span class="annottext">then_ty :: Type
</span><a href="#local-6989586621682057528"><span class="hs-identifier hs-var hs-var">then_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057505"><span class="hs-identifier hs-var">then_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057494"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-456"></span><span>        </span><span id="local-6989586621682057529"><span class="annot"><span class="annottext">else_ty :: Type
</span><a href="#local-6989586621682057529"><span class="hs-identifier hs-var hs-var">else_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057508"><span class="hs-identifier hs-var">else_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057494"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-457"></span><span>        </span><span id="local-6989586621682057530"><span class="annot"><span class="annottext">sum_ty :: Type
</span><a href="#local-6989586621682057530"><span class="hs-identifier hs-var hs-var">sum_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682057510"><span class="hs-identifier hs-var">either_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057528"><span class="hs-identifier hs-var">then_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057529"><span class="hs-identifier hs-var">else_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>        </span><span id="local-6989586621682057532"><span class="annot"><span class="annottext">fvs_cond :: DIdSet
</span><a href="#local-6989586621682057532"><span class="hs-identifier hs-var hs-var">fvs_cond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprFreeIdsDSet"><span class="hs-identifier hs-var">exprFreeIdsDSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057502"><span class="hs-identifier hs-var">core_cond</span></a></span><span>
</span><span id="line-459"></span><span>                   </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057493"><span class="hs-identifier hs-var">local_vars</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>        </span><span id="local-6989586621682057533"><span class="annot"><span class="annottext">core_left :: CoreExpr
</span><a href="#local-6989586621682057533"><span class="hs-identifier hs-var hs-var">core_left</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057518"><span class="hs-identifier hs-var">mk_left_expr</span></a></span><span>  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057528"><span class="hs-identifier hs-var">then_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057529"><span class="hs-identifier hs-var">else_ty</span></a></span><span>
</span><span id="line-462"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-var">buildEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057505"><span class="hs-identifier hs-var">then_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057509"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>        </span><span id="local-6989586621682057534"><span class="annot"><span class="annottext">core_right :: CoreExpr
</span><a href="#local-6989586621682057534"><span class="hs-identifier hs-var hs-var">core_right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057523"><span class="hs-identifier hs-var">mk_right_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057528"><span class="hs-identifier hs-var">then_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057529"><span class="hs-identifier hs-var">else_ty</span></a></span><span>
</span><span id="line-464"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-var">buildEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057508"><span class="hs-identifier hs-var">else_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057509"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>    </span><span id="local-6989586621682057535"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057535"><span class="hs-identifier hs-var">core_if</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057497"><span class="hs-identifier hs-var">mb_fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-467"></span><span>       </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
SyntaxExprTc
</span><a href="GHC.Hs.Expr.html#NoSyntaxExprTc"><span class="hs-identifier hs-var">NoSyntaxExprTc</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057501"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057509"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; DsM CoreExpr) -&gt; CoreExpr -&gt; DsM CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-468"></span><span>                          </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkIfThenElse"><span class="hs-identifier hs-var">mkIfThenElse</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057502"><span class="hs-identifier hs-var">core_cond</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057533"><span class="hs-identifier hs-var">core_left</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057534"><span class="hs-identifier hs-var">core_right</span></a></span><span>
</span><span id="line-469"></span><span>       </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621682057538"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057538"><span class="hs-identifier hs-var">fun_apps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked) -&gt; [CoreExpr] -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsSyntaxExpr"><span class="hs-identifier hs-var">dsSyntaxExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057497"><span class="hs-identifier hs-var">mb_fun</span></a></span><span>
</span><span id="line-470"></span><span>                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057502"><span class="hs-identifier hs-var">core_cond</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057533"><span class="hs-identifier hs-var">core_left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057534"><span class="hs-identifier hs-var">core_right</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-471"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057501"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057509"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057538"><span class="hs-identifier hs-var">fun_apps</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057492"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057527"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057530"><span class="hs-identifier hs-var">sum_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057495"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-474"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057535"><span class="hs-identifier hs-var">core_if</span></a></span><span>
</span><span id="line-475"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_choice"><span class="hs-identifier hs-var">do_choice</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057492"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057528"><span class="hs-identifier hs-var">then_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057529"><span class="hs-identifier hs-var">else_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057495"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057503"><span class="hs-identifier hs-var">core_then</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057506"><span class="hs-identifier hs-var">core_else</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057532"><span class="hs-identifier hs-var">fvs_cond</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; DIdSet -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSet"><span class="hs-operator hs-var">`unionDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057504"><span class="hs-identifier hs-var">fvs_then</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; DIdSet -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSet"><span class="hs-operator hs-var">`unionDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057507"><span class="hs-identifier hs-var">fvs_else</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">{-
Note [Desugaring HsCmdCase]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Case commands are treated in much the same way as if commands
(see above) except that there are more alternatives.  For example

        case e of { p1 -&gt; c1; p2 -&gt; c2; p3 -&gt; c3 }

is translated to

        premap (\ ((xs)*ts) -&gt; case e of
                p1 -&gt; (Left (Left (xs1)*ts))
                p2 -&gt; Left ((Right (xs2)*ts))
                p3 -&gt; Right ((xs3)*ts))
        ((c1 ||| c2) ||| c3)

The idea is to extract the commands from the case, build a balanced tree
of choices, and replace the commands with expressions that build tagged
tuples, obtaining a case expression that can be desugared normally.
To build all this, we use triples describing segments of the list of
case bodies, containing the following fields:
 * a list of expressions of the form (Left|Right)* ((xs)*ts), to be put
   into the case replacing the commands
 * a sum type that is the common type of these expressions, and also the
   input type of the arrow
 * a CoreExpr for an arrow built by combining the translated command
   bodies with |||.
-}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057539"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057539"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057540"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057540"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057541"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057541"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057542"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057542"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdCase"><span class="hs-identifier hs-type">HsCmdCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdCase (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057544"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057544"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621682057545"><span class="annot"><span class="annottext">MatchGroup (GhcPass 'Typechecked) (LHsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057545"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057546"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057546"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621682057547"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057547"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057541"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057548"><span class="annot"><span class="annottext">MatchGroup
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057548"><span class="hs-identifier hs-var">match'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057549"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057549"><span class="hs-identifier hs-var">core_choices</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Id
-&gt; Type
-&gt; Type
-&gt; MatchGroup
     (GhcPass 'Typechecked) (LHsCmd (GhcPass 'Typechecked))
-&gt; DsM
     (MatchGroup
        (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked)),
      CoreExpr)
</span><a href="GHC.HsToCore.Arrows.html#dsCases"><span class="hs-identifier hs-var">dsCases</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057539"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057540"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057547"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057541"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057542"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup (GhcPass 'Typechecked) (LHsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057545"><span class="hs-identifier hs-var">match</span></a></span><span>
</span><span id="line-511"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_ext :: forall p body. MatchGroup p body -&gt; XMG p body
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-type">MatchGroupTc</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057553"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057553"><span class="hs-identifier hs-var">sum_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Origin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057548"><span class="hs-identifier hs-var">match'</span></a></span><span>
</span><span id="line-512"></span><span>        </span><span id="local-6989586621682057554"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057554"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057546"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057541"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621682057555"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057555"><span class="hs-identifier hs-var">core_body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCase (GhcPass 'Typechecked)
-&gt; LHsExpr (GhcPass 'Typechecked)
-&gt; MatchGroup
     (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked))
-&gt; HsExpr (GhcPass 'Typechecked)
forall p.
XCase p -&gt; LHsExpr p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsCase"><span class="hs-identifier hs-var">HsCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCase (GhcPass 'Typechecked)
NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057544"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked))
MatchGroup
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057548"><span class="hs-identifier hs-var">match'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span>    </span><span id="local-6989586621682057557"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057557"><span class="hs-identifier hs-var">core_matches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057546"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057547"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057555"><span class="hs-identifier hs-var">core_body</span></a></span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057539"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057554"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057553"><span class="hs-identifier hs-var">sum_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057542"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057557"><span class="hs-identifier hs-var">core_matches</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057549"><span class="hs-identifier hs-var">core_choices</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>            </span><span class="annot"><span class="annottext">CoreExpr -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprFreeIdsDSet"><span class="hs-identifier hs-var">exprFreeIdsDSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057555"><span class="hs-identifier hs-var">core_body</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057540"><span class="hs-identifier hs-var">local_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span class="hs-comment">{-
\cases and \case are desugared analogously to a case command (see above).
For example

        \cases {p1 q1 -&gt; c1; p2 q2 -&gt; c2; p3 q3 -&gt; c3 }

is translated to

        premap (\ ((xs), (e1, (e2,stk))) -&gt; cases e1 e2 of
                  p1 q1 -&gt; (Left (Left (xs1), stk))
                  p2 q2 -&gt; Left ((Right (xs2), stk))
                  p3 q3 -&gt; Right ((xs3), stk))
        ((c1 ||| c2) ||| c3)

(cases...of is hypothetical notation that works like case...of but with
multiple scrutinees)

-}</span><span>
</span><span id="line-538"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057558"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057558"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057559"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057559"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057560"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057560"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057561"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057561"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-539"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLamCase"><span class="hs-identifier hs-type">HsCmdLamCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdLamCase (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057563"><span class="annot"><span class="annottext">LamCaseVariant
</span><a href="#local-6989586621682057563"><span class="hs-identifier hs-var">lc_variant</span></a></span></span><span> </span><span id="local-6989586621682057564"><span class="annot"><span class="annottext">match :: MatchGroup (GhcPass 'Typechecked) (LHsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057564"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_ext :: forall p body. MatchGroup p body -&gt; XMG p body
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-type">MatchGroupTc</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">mg_arg_tys :: MatchGroupTc -&gt; [Scaled Type]
</span><a href="GHC.Hs.Expr.html#mg_arg_tys"><span class="hs-identifier hs-var">mg_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057566"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682057566"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>      </span><span id="local-6989586621682057567"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057567"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>    </span><span id="local-6989586621682057568"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057568"><span class="hs-identifier hs-var">arg_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; DsM [Id]
</span><a href="GHC.HsToCore.Monad.html#newSysLocalsDs"><span class="hs-identifier hs-var">newSysLocalsDs</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682057566"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057570"><span class="annot"><span class="annottext">match_ctxt :: HsArrowMatchContext
</span><a href="#local-6989586621682057570"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LamCaseVariant -&gt; HsArrowMatchContext
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowLamCaseAlt"><span class="hs-identifier hs-var">ArrowLamCaseAlt</span></a></span><span> </span><span class="annot"><span class="annottext">LamCaseVariant
</span><a href="#local-6989586621682057563"><span class="hs-identifier hs-var">lc_variant</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span id="local-6989586621682057572"><span class="annot"><span class="annottext">pat_vars :: VarSet
</span><a href="#local-6989586621682057572"><span class="hs-identifier hs-var hs-var">pat_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057568"><span class="hs-identifier hs-var">arg_ids</span></a></span><span>
</span><span id="line-545"></span><span>        </span><span id="local-6989586621682057573"><span class="annot"><span class="annottext">local_vars' :: VarSet
</span><a href="#local-6989586621682057573"><span class="hs-identifier hs-var hs-var">local_vars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057572"><span class="hs-identifier hs-var">pat_vars</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057559"><span class="hs-identifier hs-var">local_vars</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682057575"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682057575"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057576"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">stack_ty'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; ([Type], Type)
</span><a href="GHC.HsToCore.Arrows.html#splitTypeAt"><span class="hs-identifier hs-var">splitTypeAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682057566"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057560"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-comment">-- construct and desugar a case expression with multiple scrutinees</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057578"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057578"><span class="hs-identifier hs-var">core_body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057579"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057579"><span class="hs-identifier hs-var">free_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057580"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057580"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; DsM (CoreExpr, DIdSet)) -&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#trimInput"><span class="hs-identifier hs-var">trimInput</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682057582"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057582"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-550"></span><span>      </span><span id="local-6989586621682057583"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057583"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682057584"><span class="annot"><span class="annottext">MatchGroup
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057584"><span class="hs-identifier hs-var">match'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057585"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057585"><span class="hs-identifier hs-var">core_choices</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Id
-&gt; Type
-&gt; Type
-&gt; MatchGroup
     (GhcPass 'Typechecked) (LHsCmd (GhcPass 'Typechecked))
-&gt; DsM
     (MatchGroup
        (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked)),
      CoreExpr)
</span><a href="GHC.HsToCore.Arrows.html#dsCases"><span class="hs-identifier hs-var">dsCases</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057558"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057573"><span class="hs-identifier hs-var">local_vars'</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057583"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057561"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup (GhcPass 'Typechecked) (LHsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057564"><span class="hs-identifier hs-var">match</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_ext :: forall p body. MatchGroup p body -&gt; XMG p body
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-type">MatchGroupTc</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057586"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057586"><span class="hs-identifier hs-var">sum_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Origin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MatchGroup
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057584"><span class="hs-identifier hs-var">match'</span></a></span><span>
</span><span id="line-555"></span><span>          </span><span id="local-6989586621682057587"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057587"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057582"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span>
</span><span id="line-556"></span><span>          </span><span id="local-6989586621682057588"><span class="annot"><span class="annottext">discrims :: [LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057588"><span class="hs-identifier hs-var hs-var">discrims</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; LocatedA (HsExpr (GhcPass 'Typechecked)))
-&gt; [Id] -&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Typechecked) -&gt; LHsExpr (GhcPass 'Typechecked)
Id -&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057568"><span class="hs-identifier hs-var">arg_ids</span></a></span><span>
</span><span id="line-557"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621682057589"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057589"><span class="hs-identifier hs-var">discrim_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057590"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057590"><span class="hs-identifier hs-var">matching_code</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
-&gt; Maybe [LHsExpr (GhcPass 'Typechecked)]
-&gt; MatchGroup
     (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked))
-&gt; DsM ([Id], CoreExpr)
</span><a href="GHC.HsToCore.Match.html#matchWrapper"><span class="hs-identifier hs-var">matchWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsArrowMatchContext -&gt; HsMatchContext GhcRn
forall p. HsArrowMatchContext -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-var">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrowMatchContext
</span><a href="#local-6989586621682057570"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; Maybe [LocatedA (HsExpr (GhcPass 'Typechecked))]
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057588"><span class="hs-identifier hs-var">discrims</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchGroup (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked))
MatchGroup
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057584"><span class="hs-identifier hs-var">match'</span></a></span><span>
</span><span id="line-559"></span><span>      </span><span id="local-6989586621682057592"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057592"><span class="hs-identifier hs-var">core_body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([CoreExpr] -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#flip/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [CoreExpr] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057594"><span class="hs-identifier hs-var">bind_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057589"><span class="hs-identifier hs-var">discrim_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057590"><span class="hs-identifier hs-var">matching_code</span></a></span><span> </span><span class="annot"><span class="annottext">([CoreExpr] -&gt; CoreExpr)
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [CoreExpr] -&gt; DsM CoreExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-560"></span><span>        </span><span class="annot"><span class="annottext">(LocatedA (HsExpr (GhcPass 'Typechecked)) -&gt; DsM CoreExpr)
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [CoreExpr]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#traverse/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
LocatedA (HsExpr (GhcPass 'Typechecked)) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057588"><span class="hs-identifier hs-var">discrims</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>      </span><span id="local-6989586621682057597"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057597"><span class="hs-identifier hs-var">core_matches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057582"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057583"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057592"><span class="hs-identifier hs-var">core_body</span></a></span><span>
</span><span id="line-563"></span><span>      </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057558"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057587"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057586"><span class="hs-identifier hs-var">sum_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057561"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057597"><span class="hs-identifier hs-var">core_matches</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057585"><span class="hs-identifier hs-var">core_choices</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-564"></span><span>              </span><span class="annot"><span class="annottext">CoreExpr -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprFreeIdsDSet"><span class="hs-identifier hs-var">exprFreeIdsDSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057592"><span class="hs-identifier hs-var">core_body</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057573"><span class="hs-identifier hs-var">local_vars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>    </span><span id="local-6989586621682057598"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057598"><span class="hs-identifier hs-var">param_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; DsM Id) -&gt; [Type] -&gt; DsM [Id]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682057575"><span class="hs-identifier hs-var">pat_tys</span></a></span><span>
</span><span id="line-567"></span><span>    </span><span id="local-6989586621682057600"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057600"><span class="hs-identifier hs-var">stack_id'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>    </span><span class="hs-comment">-- the expression is built from the inside out, so the actions</span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-comment">-- are presented in reverse order</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- build a new environment, plus what's left of the stack</span><span>
</span><span id="line-573"></span><span>        </span><span id="local-6989586621682057601"><span class="annot"><span class="annottext">core_expr :: CoreExpr
</span><a href="#local-6989586621682057601"><span class="hs-identifier hs-var hs-var">core_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-var">buildEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057580"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057600"><span class="hs-identifier hs-var">stack_id'</span></a></span><span>
</span><span id="line-574"></span><span>        </span><span id="local-6989586621682057602"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057602"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057567"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057560"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span id="local-6989586621682057603"><span class="annot"><span class="annottext">in_ty' :: Type
</span><a href="#local-6989586621682057603"><span class="hs-identifier hs-var hs-var">in_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057580"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057576"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-comment">-- bind the scrutinees to the parameters</span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057604"><span class="annot"><span class="annottext">match_code :: CoreExpr
</span><a href="#local-6989586621682057604"><span class="hs-identifier hs-var hs-var">match_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [CoreExpr] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057594"><span class="hs-identifier hs-var">bind_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057568"><span class="hs-identifier hs-var">arg_ids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; [Id] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057598"><span class="hs-identifier hs-var">param_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057601"><span class="hs-identifier hs-var">core_expr</span></a></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-comment">-- match the parameters against the top of the old stack</span><span>
</span><span id="line-581"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057605"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057605"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057606"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057606"><span class="hs-identifier hs-var">param_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM (Id, CoreExpr)
</span><a href="GHC.HsToCore.Arrows.html#matchVarStack"><span class="hs-identifier hs-var">matchVarStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057598"><span class="hs-identifier hs-var">param_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057600"><span class="hs-identifier hs-var">stack_id'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057604"><span class="hs-identifier hs-var">match_code</span></a></span><span>
</span><span id="line-582"></span><span>    </span><span class="hs-comment">-- match the old environment and stack against the input</span><span>
</span><span id="line-583"></span><span>    </span><span id="local-6989586621682057607"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057607"><span class="hs-identifier hs-var">select_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057567"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057605"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057606"><span class="hs-identifier hs-var">param_code</span></a></span><span>
</span><span id="line-584"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057558"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057602"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057603"><span class="hs-identifier hs-var">in_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057561"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057607"><span class="hs-identifier hs-var">select_code</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057578"><span class="hs-identifier hs-var">core_body</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-585"></span><span>            </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057579"><span class="hs-identifier hs-var">free_vars</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetMinusUniqSet"><span class="hs-operator hs-var">`uniqDSetMinusUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057572"><span class="hs-identifier hs-var">pat_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-587"></span><span>      </span><span id="local-6989586621682057594"><span class="annot"><span class="annottext">bind_vars :: [Id] -&gt; [CoreExpr] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057594"><span class="hs-identifier hs-var hs-var">bind_vars</span></a></span></span><span> </span><span id="local-6989586621682057611"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057611"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span id="local-6989586621682057612"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057612"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span id="local-6989586621682057613"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057613"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, CoreExpr) -&gt; CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr -&gt; [(Id, CoreExpr)] -&gt; CoreExpr
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr)
-&gt; (Id, CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#uncurry/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Id -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
Id -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Utils.html#bindNonRec"><span class="hs-identifier hs-var">bindNonRec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057613"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">([(Id, CoreExpr)] -&gt; CoreExpr) -&gt; [(Id, CoreExpr)] -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [CoreExpr] -&gt; [(Id, CoreExpr)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#zip/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057611"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057612"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="hs-comment">-- D; ys |-a cmd : stk --&gt; t</span><span>
</span><span id="line-590"></span><span class="hs-comment">-- ----------------------------------</span><span>
</span><span id="line-591"></span><span class="hs-comment">-- D; xs |-a let binds in cmd : stk --&gt; t</span><span>
</span><span id="line-592"></span><span class="hs-comment">--</span><span>
</span><span id="line-593"></span><span class="hs-comment">--              ---&gt; premap (\ ((xs),stk) -&gt; let binds in ((ys),stk)) c</span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057616"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057616"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057617"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057617"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057618"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057618"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057619"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057619"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdLet"><span class="hs-identifier hs-type">HsCmdLet</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdLet (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;let&quot; (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057621"><span class="annot"><span class="annottext">lbinds :: HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057621"><span class="hs-identifier hs-var">lbinds</span></a></span></span><span class="hs-glyph">@</span><span id="local-6989586621682057622"><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057622"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsToken &quot;in&quot; (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057623"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057623"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057624"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057624"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-597"></span><span>        </span><span id="local-6989586621682057625"><span class="annot"><span class="annottext">defined_vars :: VarSet
</span><a href="#local-6989586621682057625"><span class="hs-identifier hs-var hs-var">defined_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; HsLocalBinds (GhcPass 'Typechecked)
-&gt; [IdP (GhcPass 'Typechecked)]
forall (idL :: Pass) (idR :: Pass).
CollectPass (GhcPass idL) =&gt;
CollectFlag (GhcPass idL)
-&gt; HsLocalBindsLR (GhcPass idL) (GhcPass idR)
-&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLocalBinders"><span class="hs-identifier hs-var">collectLocalBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057622"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>        </span><span id="local-6989586621682057627"><span class="annot"><span class="annottext">local_vars' :: VarSet
</span><a href="#local-6989586621682057627"><span class="hs-identifier hs-var hs-var">local_vars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057625"><span class="hs-identifier hs-var">defined_vars</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057617"><span class="hs-identifier hs-var">local_vars</span></a></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057628"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057628"><span class="hs-identifier hs-var">core_body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057629"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057629"><span class="hs-identifier hs-var">_free_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057630"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057630"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057616"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057627"><span class="hs-identifier hs-var">local_vars'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057618"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057619"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057623"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-602"></span><span>    </span><span id="local-6989586621682057631"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057631"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057618"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-603"></span><span>    </span><span class="hs-comment">-- build a new environment, plus the stack, using the let bindings</span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621682057632"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057632"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked) -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLocalBinds"><span class="hs-identifier hs-var">dsLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057621"><span class="hs-identifier hs-var">lbinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-var">buildEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057630"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057631"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>    </span><span class="hs-comment">-- match the old environment and stack against the input</span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621682057633"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057633"><span class="hs-identifier hs-var">core_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057624"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057631"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057632"><span class="hs-identifier hs-var">core_binds</span></a></span><span>
</span><span id="line-607"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057616"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-608"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057624"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057618"><span class="hs-identifier hs-var">stack_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057630"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057618"><span class="hs-identifier hs-var">stack_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>                        </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057619"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-611"></span><span>                        </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057633"><span class="hs-identifier hs-var">core_map</span></a></span><span>
</span><span id="line-612"></span><span>                        </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057628"><span class="hs-identifier hs-var">core_body</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-613"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprFreeIdsDSet"><span class="hs-identifier hs-var">exprFreeIdsDSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057632"><span class="hs-identifier hs-var">core_binds</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057617"><span class="hs-identifier hs-var">local_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="hs-comment">-- D; xs |-a ss : t</span><span>
</span><span id="line-616"></span><span class="hs-comment">-- ----------------------------------</span><span>
</span><span id="line-617"></span><span class="hs-comment">-- D; xs |-a do { ss } : () --&gt; t</span><span>
</span><span id="line-618"></span><span class="hs-comment">--</span><span>
</span><span id="line-619"></span><span class="hs-comment">--              ---&gt; premap (\ (env,stk) -&gt; env) c</span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057634"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057634"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057635"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057635"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057636"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057636"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057637"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057637"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdDo"><span class="hs-identifier hs-type">HsCmdDo</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdDo (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057639"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (StmtLR
      (GhcPass 'Typechecked)
      (GhcPass 'Typechecked)
      (LocatedA (HsCmd (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057639"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057640"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057640"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-622"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057641"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057641"><span class="hs-identifier hs-var">core_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057642"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057642"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdDo"><span class="hs-identifier hs-var">dsCmdDo</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057634"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057635"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057637"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
[GenLocated
   SrcSpanAnnA
   (StmtLR
      (GhcPass 'Typechecked)
      (GhcPass 'Typechecked)
      (LocatedA (HsCmd (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057639"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057640"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-623"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057644"><span class="annot"><span class="annottext">env_ty :: Type
</span><a href="#local-6989586621682057644"><span class="hs-identifier hs-var hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057640"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-624"></span><span>    </span><span id="local-6989586621682057645"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057645"><span class="hs-identifier hs-var">core_fst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkFstExpr"><span class="hs-identifier hs-var">mkFstExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057644"><span class="hs-identifier hs-var">env_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057636"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-625"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057634"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-626"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057644"><span class="hs-identifier hs-var">env_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057636"><span class="hs-identifier hs-var">stack_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>                </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057644"><span class="hs-identifier hs-var">env_ty</span></a></span><span>
</span><span id="line-628"></span><span>                </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057637"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-629"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057645"><span class="hs-identifier hs-var">core_fst</span></a></span><span>
</span><span id="line-630"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057641"><span class="hs-identifier hs-var">core_stmts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-631"></span><span>        </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057642"><span class="hs-identifier hs-var">env_ids'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="hs-comment">-- D |- e :: forall e. a1 (e,stk1) t1 -&gt; ... an (e,stkn) tn -&gt; a (e,stk) t</span><span>
</span><span id="line-634"></span><span class="hs-comment">-- D; xs |-a ci :: stki --&gt; ti</span><span>
</span><span id="line-635"></span><span class="hs-comment">-- -----------------------------------</span><span>
</span><span id="line-636"></span><span class="hs-comment">-- D; xs |-a (|e c1 ... cn|) :: stk --&gt; t       ---&gt; e [t_xs] c1 ... cn</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057646"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057646"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057647"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057647"><span class="hs-identifier hs-var">_stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057648"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057648"><span class="hs-identifier hs-var">_res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdArrForm"><span class="hs-identifier hs-type">HsCmdArrForm</span></a></span><span> </span><span class="annot"><span class="annottext">XCmdArrForm (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057650"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057650"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">LexicalFixity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Fixity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057651"><span class="annot"><span class="annottext">[LHsCmdTop (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057651"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057652"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057652"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-639"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057653"><span class="annot"><span class="annottext">env_ty :: Type
</span><a href="#local-6989586621682057653"><span class="hs-identifier hs-var hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057652"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-640"></span><span>    </span><span id="local-6989586621682057654"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057654"><span class="hs-identifier hs-var">core_op</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057650"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-641"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057655"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057655"><span class="hs-identifier hs-var">core_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057656"><span class="annot"><span class="annottext">[DIdSet]
</span><a href="#local-6989586621682057656"><span class="hs-identifier hs-var">fv_sets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated (SrcAnn NoEpAnns) (HsCmdTop (GhcPass 'Typechecked))
 -&gt; DsM (CoreExpr, DIdSet))
-&gt; [GenLocated (SrcAnn NoEpAnns) (HsCmdTop (GhcPass 'Typechecked))]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) ([CoreExpr], [DIdSet])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><a href="../../base-4.18.2.1/src/Control.Monad.html#mapAndUnzipM/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
-&gt; [Id]
-&gt; LHsCmdTop (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsTrimCmdArg"><span class="hs-identifier hs-var">dsTrimCmdArg</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057646"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057652"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsCmdTop (GhcPass 'Typechecked)]
[GenLocated (SrcAnn NoEpAnns) (HsCmdTop (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057651"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; [CoreExpr] -&gt; CoreExpr
forall b. Expr b -&gt; [Expr b] -&gt; Expr b
</span><a href="GHC.Core.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057654"><span class="hs-identifier hs-var">core_op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; CoreExpr
forall b. Type -&gt; Expr b
</span><a href="GHC.Core.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057653"><span class="hs-identifier hs-var">env_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057655"><span class="hs-identifier hs-var">core_args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-643"></span><span>            </span><span class="annot"><span class="annottext">[DIdSet] -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSets"><span class="hs-identifier hs-var">unionDVarSets</span></a></span><span> </span><span class="annot"><span class="annottext">[DIdSet]
</span><a href="#local-6989586621682057656"><span class="hs-identifier hs-var">fv_sets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span id="local-6989586621682057660"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057660"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057661"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057661"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057662"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057662"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057663"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057663"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#XCmd"><span class="hs-identifier hs-type">XCmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsWrap"><span class="hs-identifier hs-type">HsWrap</span></a></span><span> </span><span id="local-6989586621682057666"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682057666"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621682057667"><span class="annot"><span class="annottext">HsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057667"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057668"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057668"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057669"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057669"><span class="hs-identifier hs-var">core_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057670"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057670"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; HsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057660"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057661"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057662"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057663"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057667"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057668"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-647"></span><span>    </span><span id="local-6989586621682057671"><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057671"><span class="hs-identifier hs-var">core_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; DsM (CoreExpr -&gt; CoreExpr)
</span><a href="GHC.HsToCore.Binds.html#dsHsWrapper"><span class="hs-identifier hs-var">dsHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621682057666"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-648"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621682057671"><span class="hs-identifier hs-var">core_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057669"><span class="hs-identifier hs-var">core_cmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057670"><span class="hs-identifier hs-var">env_ids'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmd"><span class="hs-identifier hs-var">dsCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057672"><span class="annot"><span class="annottext">HsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057672"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM (CoreExpr, DIdSet)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsCmd&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsCmd (GhcPass 'Typechecked) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057672"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span class="hs-comment">-- D; ys |-a c : stk --&gt; t      (ys &lt;= xs)</span><span>
</span><span id="line-653"></span><span class="hs-comment">-- ---------------------</span><span>
</span><span id="line-654"></span><span class="hs-comment">-- D; xs |-a c : stk --&gt; t      ---&gt; premap (\ ((xs),stk) -&gt; ((ys),stk)) c</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsTrimCmdArg"><span class="hs-identifier hs-type">dsTrimCmdArg</span></a></span><span>
</span><span id="line-657"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this command</span><span>
</span><span id="line-658"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- list of vars in the input to this command</span><span>
</span><span id="line-659"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmdTop"><span class="hs-identifier hs-type">LHsCmdTop</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>       </span><span class="hs-comment">-- command argument to desugar</span><span>
</span><span id="line-660"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-661"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-662"></span><span id="dsTrimCmdArg"><span class="annot"><span class="annottext">dsTrimCmdArg :: VarSet
-&gt; [Id]
-&gt; LHsCmdTop (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsTrimCmdArg"><span class="hs-identifier hs-var hs-var">dsTrimCmdArg</span></a></span></span><span> </span><span id="local-6989586621682057673"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057673"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057674"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057674"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span>
</span><span id="line-663"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcAnn NoEpAnns
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsCmdTop"><span class="hs-identifier hs-type">HsCmdTop</span></a></span><span>
</span><span id="line-664"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#CmdTopTc"><span class="hs-identifier hs-type">CmdTopTc</span></a></span><span> </span><span id="local-6989586621682057675"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057675"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057676"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057676"><span class="hs-identifier hs-var">cmd_ty</span></a></span></span><span> </span><span id="local-6989586621682057677"><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057677"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057678"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057678"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-665"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057679"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621682057679"><span class="hs-identifier hs-var">meth_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057680"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057680"><span class="hs-identifier hs-var">meth_ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked) -&gt; DsM ([CoreBind], DsCmdEnv)
</span><a href="GHC.HsToCore.Arrows.html#mkCmdEnv"><span class="hs-identifier hs-var">mkCmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CmdSyntaxTable (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057677"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057681"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057681"><span class="hs-identifier hs-var">core_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057682"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057682"><span class="hs-identifier hs-var">free_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057683"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057683"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057680"><span class="hs-identifier hs-var">meth_ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057673"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057675"><span class="hs-identifier hs-var">stack_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057676"><span class="hs-identifier hs-var">cmd_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057678"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621682057684"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057684"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057675"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-669"></span><span>    </span><span id="local-6989586621682057685"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057685"><span class="hs-identifier hs-var">trim_code</span></a></span></span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057674"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057684"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-var">buildEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057683"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057684"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-672"></span><span>        </span><span id="local-6989586621682057686"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057686"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057674"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057675"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-673"></span><span>        </span><span id="local-6989586621682057687"><span class="annot"><span class="annottext">in_ty' :: Type
</span><a href="#local-6989586621682057687"><span class="hs-identifier hs-var hs-var">in_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057683"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057675"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-674"></span><span>        </span><span id="local-6989586621682057688"><span class="annot"><span class="annottext">arg_code :: CoreExpr
</span><a href="#local-6989586621682057688"><span class="hs-identifier hs-var hs-var">arg_code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057683"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; [Id] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057674"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057681"><span class="hs-identifier hs-var">core_cmd</span></a></span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-675"></span><span>                </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057680"><span class="hs-identifier hs-var">meth_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057686"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057687"><span class="hs-identifier hs-var">in_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057676"><span class="hs-identifier hs-var">cmd_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057685"><span class="hs-identifier hs-var">trim_code</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057681"><span class="hs-identifier hs-var">core_cmd</span></a></span><span>
</span><span id="line-676"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreBind] -&gt; CoreExpr -&gt; CoreExpr
forall b. [Bind b] -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#mkLets"><span class="hs-identifier hs-var">mkLets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621682057679"><span class="hs-identifier hs-var">meth_binds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057688"><span class="hs-identifier hs-var">arg_code</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057682"><span class="hs-identifier hs-var">free_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="hs-comment">-- Given D; xs |-a c : stk --&gt; t, builds c with xs fed back.</span><span>
</span><span id="line-679"></span><span class="hs-comment">-- Typically needs to be prefixed with arr (\(p, stk) -&gt; ((xs),stk))</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-type">dsfixCmd</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>             </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-683"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this command</span><span>
</span><span id="line-684"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                 </span><span class="hs-comment">-- type of the stack (right-nested tuple)</span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                 </span><span class="hs-comment">-- return type of the command</span><span>
</span><span id="line-686"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>         </span><span class="hs-comment">-- command to desugar</span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-688"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-689"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- the same local vars as a list, fed back</span><span>
</span><span id="line-690"></span><span id="dsfixCmd"><span class="annot"><span class="annottext">dsfixCmd :: DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var hs-var">dsfixCmd</span></a></span></span><span> </span><span id="local-6989586621682057689"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057689"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057690"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057690"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057691"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057691"><span class="hs-identifier hs-var">stk_ty</span></a></span></span><span> </span><span id="local-6989586621682057692"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057692"><span class="hs-identifier hs-var">cmd_ty</span></a></span></span><span> </span><span id="local-6989586621682057693"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057693"><span class="hs-identifier hs-var">cmd</span></a></span></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; DsM (CoreExpr, DIdSet)) -&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#trimInput"><span class="hs-identifier hs-var">trimInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsLCmd"><span class="hs-identifier hs-var">dsLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057689"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057690"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057691"><span class="hs-identifier hs-var">stk_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057692"><span class="hs-identifier hs-var">cmd_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057693"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span class="hs-comment">-- Feed back the list of local variables actually used a command,</span><span>
</span><span id="line-694"></span><span class="hs-comment">-- for use as the input tuple of the generated arrow.</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#trimInput"><span class="hs-identifier hs-type">trimInput</span></a></span><span>
</span><span id="line-697"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-699"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-700"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- same local vars as a list, fed back to</span><span>
</span><span id="line-701"></span><span>                                </span><span class="hs-comment">-- the inner function to form the tuple of</span><span>
</span><span id="line-702"></span><span>                                </span><span class="hs-comment">-- inputs to the arrow.</span><span>
</span><span id="line-703"></span><span id="trimInput"><span class="annot"><span class="annottext">trimInput :: ([Id] -&gt; DsM (CoreExpr, DIdSet)) -&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#trimInput"><span class="hs-identifier hs-var hs-var">trimInput</span></a></span></span><span> </span><span id="local-6989586621682057694"><span class="annot"><span class="annottext">[Id] -&gt; DsM (CoreExpr, DIdSet)
</span><a href="#local-6989586621682057694"><span class="hs-identifier hs-var">build_arrow</span></a></span></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((CoreExpr, DIdSet, [Id]) -&gt; DsM (CoreExpr, DIdSet, [Id]))
-&gt; DsM (CoreExpr, DIdSet, [Id])
forall a. (a -&gt; DsM a) -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#fixDs"><span class="hs-identifier hs-var">fixDs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">DIdSet
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621682057696"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057696"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-705"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682057697"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057697"><span class="hs-identifier hs-var">core_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057698"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057698"><span class="hs-identifier hs-var">free_vars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; DsM (CoreExpr, DIdSet)
</span><a href="#local-6989586621682057694"><span class="hs-identifier hs-var">build_arrow</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057696"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet, [Id]) -&gt; DsM (CoreExpr, DIdSet, [Id])
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057697"><span class="hs-identifier hs-var">core_cmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057698"><span class="hs-identifier hs-var">free_vars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; [Id]
</span><a href="GHC.Types.Var.Set.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057698"><span class="hs-identifier hs-var">free_vars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-comment">-- Desugaring for both HsCmdLam</span><span>
</span><span id="line-709"></span><span class="hs-comment">--</span><span>
</span><span id="line-710"></span><span class="hs-comment">-- D; ys |-a cmd : stk t'</span><span>
</span><span id="line-711"></span><span class="hs-comment">-- -----------------------------------------------</span><span>
</span><span id="line-712"></span><span class="hs-comment">-- D; xs |-a \ p1 ... pk -&gt; cmd : (t1,...(tk,stk)...) t'</span><span>
</span><span id="line-713"></span><span class="hs-comment">--</span><span>
</span><span id="line-714"></span><span class="hs-comment">--              ---&gt; premap (\ ((xs), (p1, ... (pk,stk)...)) -&gt; ((ys),stk)) cmd</span><span>
</span><span id="line-715"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdLam"><span class="hs-identifier hs-type">dsCmdLam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>            </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-716"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>               </span><span class="hs-comment">-- set of local vars available to this command</span><span>
</span><span id="line-717"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                </span><span class="hs-comment">-- type of the stack (right-nested tuple)</span><span>
</span><span id="line-718"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                </span><span class="hs-comment">-- return type of the command</span><span>
</span><span id="line-719"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- argument patterns to desugar</span><span>
</span><span id="line-720"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>        </span><span class="hs-comment">-- body to desugar</span><span>
</span><span id="line-721"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- list of vars in the input to this command</span><span>
</span><span id="line-722"></span><span>                                </span><span class="hs-comment">-- This is typically fed back,</span><span>
</span><span id="line-723"></span><span>                                </span><span class="hs-comment">-- so don't pull on it too early</span><span>
</span><span id="line-724"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-725"></span><span>                 </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-726"></span><span id="dsCmdLam"><span class="annot"><span class="annottext">dsCmdLam :: DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; [LPat (GhcPass 'Typechecked)]
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdLam"><span class="hs-identifier hs-var hs-var">dsCmdLam</span></a></span></span><span> </span><span id="local-6989586621682057700"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057700"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057701"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057701"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057702"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057702"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057703"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057703"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621682057704"><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057704"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span id="local-6989586621682057705"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057705"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682057706"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057706"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-727"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057707"><span class="annot"><span class="annottext">pat_vars :: VarSet
</span><a href="#local-6989586621682057707"><span class="hs-identifier hs-var hs-var">pat_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; [LPat (GhcPass 'Typechecked)] -&gt; [IdP (GhcPass 'Typechecked)]
forall p. CollectPass p =&gt; CollectFlag p -&gt; [LPat p] -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatsBinders"><span class="hs-identifier hs-var">collectPatsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057704"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057709"><span class="annot"><span class="annottext">local_vars' :: VarSet
</span><a href="#local-6989586621682057709"><span class="hs-identifier hs-var hs-var">local_vars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057707"><span class="hs-identifier hs-var">pat_vars</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057701"><span class="hs-identifier hs-var">local_vars</span></a></span><span>
</span><span id="line-729"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682057710"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682057710"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057711"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">stack_ty'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; ([Type], Type)
</span><a href="GHC.HsToCore.Arrows.html#splitTypeAt"><span class="hs-identifier hs-var">splitTypeAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (Pat (GhcPass 'Typechecked))] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#length/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
[GenLocated SrcSpanAnnA (Pat (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057704"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057702"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-730"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057712"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057712"><span class="hs-identifier hs-var">core_body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057713"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057713"><span class="hs-identifier hs-var">free_vars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057714"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057714"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057700"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057709"><span class="hs-identifier hs-var">local_vars'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057703"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057705"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-732"></span><span>    </span><span id="local-6989586621682057715"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057715"><span class="hs-identifier hs-var">param_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; DsM Id) -&gt; [Type] -&gt; DsM [Id]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621682057710"><span class="hs-identifier hs-var">pat_tys</span></a></span><span>
</span><span id="line-733"></span><span>    </span><span id="local-6989586621682057716"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057716"><span class="hs-identifier hs-var">stack_id'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span>    </span><span class="hs-comment">-- the expression is built from the inside out, so the actions</span><span>
</span><span id="line-736"></span><span>    </span><span class="hs-comment">-- are presented in reverse order</span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- build a new environment, plus what's left of the stack</span><span>
</span><span id="line-739"></span><span>        </span><span id="local-6989586621682057717"><span class="annot"><span class="annottext">core_expr :: CoreExpr
</span><a href="#local-6989586621682057717"><span class="hs-identifier hs-var hs-var">core_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#buildEnvStack"><span class="hs-identifier hs-var">buildEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057714"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057716"><span class="hs-identifier hs-var">stack_id'</span></a></span><span>
</span><span id="line-740"></span><span>        </span><span id="local-6989586621682057718"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057718"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057706"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057702"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-741"></span><span>        </span><span id="local-6989586621682057719"><span class="annot"><span class="annottext">in_ty' :: Type
</span><a href="#local-6989586621682057719"><span class="hs-identifier hs-var hs-var">in_ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057714"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057711"><span class="hs-identifier hs-var">stack_ty'</span></a></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span>    </span><span id="local-6989586621682057720"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057720"><span class="hs-identifier hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkFailExpr"><span class="hs-identifier hs-var">mkFailExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsArrowMatchContext -&gt; HsMatchContext GhcRn
forall p. HsArrowMatchContext -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-var">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrowMatchContext
</span><a href="Language.Haskell.Syntax.Expr.html#KappaExpr"><span class="hs-identifier hs-var">KappaExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057719"><span class="hs-identifier hs-var">in_ty'</span></a></span><span>
</span><span id="line-744"></span><span>    </span><span class="hs-comment">-- match the patterns against the parameters</span><span>
</span><span id="line-745"></span><span>    </span><span id="local-6989586621682057722"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057722"><span class="hs-identifier hs-var">match_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
-&gt; HsMatchContext GhcRn
-&gt; [LPat (GhcPass 'Typechecked)]
-&gt; CoreExpr
-&gt; CoreExpr
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchSimplys"><span class="hs-identifier hs-var">matchSimplys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; [Id] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057715"><span class="hs-identifier hs-var">param_ids</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsArrowMatchContext -&gt; HsMatchContext GhcRn
forall p. HsArrowMatchContext -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-var">ArrowMatchCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrowMatchContext
</span><a href="Language.Haskell.Syntax.Expr.html#KappaExpr"><span class="hs-identifier hs-var">KappaExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057704"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057717"><span class="hs-identifier hs-var">core_expr</span></a></span><span>
</span><span id="line-746"></span><span>                    </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057720"><span class="hs-identifier hs-var">fail_expr</span></a></span><span>
</span><span id="line-747"></span><span>    </span><span class="hs-comment">-- match the parameters against the top of the old stack</span><span>
</span><span id="line-748"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057724"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057724"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057725"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057725"><span class="hs-identifier hs-var">param_code</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM (Id, CoreExpr)
</span><a href="GHC.HsToCore.Arrows.html#matchVarStack"><span class="hs-identifier hs-var">matchVarStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057715"><span class="hs-identifier hs-var">param_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057716"><span class="hs-identifier hs-var">stack_id'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057722"><span class="hs-identifier hs-var">match_code</span></a></span><span>
</span><span id="line-749"></span><span>    </span><span class="hs-comment">-- match the old environment and stack against the input</span><span>
</span><span id="line-750"></span><span>    </span><span id="local-6989586621682057726"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057726"><span class="hs-identifier hs-var">select_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057706"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057724"><span class="hs-identifier hs-var">stack_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057725"><span class="hs-identifier hs-var">param_code</span></a></span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057700"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057718"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057719"><span class="hs-identifier hs-var">in_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057703"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057726"><span class="hs-identifier hs-var">select_code</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057712"><span class="hs-identifier hs-var">core_body</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-752"></span><span>            </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057713"><span class="hs-identifier hs-var">free_vars</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetMinusUniqSet"><span class="hs-operator hs-var">`uniqDSetMinusUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057707"><span class="hs-identifier hs-var">pat_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="hs-comment">-- Used for case and \case(s)</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- See Note [Desugaring HsCmdCase]</span><span>
</span><span id="line-756"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCases"><span class="hs-identifier hs-type">dsCases</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>                               </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                                  </span><span class="hs-comment">-- set of local vars available to this command</span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>                                     </span><span class="hs-comment">-- stack id</span><span>
</span><span id="line-759"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                                   </span><span class="hs-comment">-- type of the stack (right-nested tuple)</span><span>
</span><span id="line-760"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                                   </span><span class="hs-comment">-- return type of the command</span><span>
</span><span id="line-761"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsCmd"><span class="hs-identifier hs-type">LHsCmd</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- match group to desugar</span><span>
</span><span id="line-762"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- match group with choice tree</span><span>
</span><span id="line-763"></span><span>                </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>                         </span><span class="hs-comment">-- desugared choices</span><span>
</span><span id="line-764"></span><span id="dsCases"><span class="annot"><span class="annottext">dsCases :: DsCmdEnv
-&gt; VarSet
-&gt; Id
-&gt; Type
-&gt; Type
-&gt; MatchGroup
     (GhcPass 'Typechecked) (LHsCmd (GhcPass 'Typechecked))
-&gt; DsM
     (MatchGroup
        (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked)),
      CoreExpr)
</span><a href="GHC.HsToCore.Arrows.html#dsCases"><span class="hs-identifier hs-var hs-var">dsCases</span></a></span></span><span> </span><span id="local-6989586621682057727"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057727"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057728"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057728"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057729"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057729"><span class="hs-identifier hs-var">stack_id</span></a></span></span><span> </span><span id="local-6989586621682057730"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057730"><span class="hs-identifier hs-var">stack_ty</span></a></span></span><span> </span><span id="local-6989586621682057731"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057731"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-765"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: forall p body. MatchGroup p body -&gt; XRec p [LMatch p body]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682057732"><span class="annot"><span class="annottext">SrcSpanAnnL
</span><a href="#local-6989586621682057732"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621682057733"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (Match
      (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057733"><span class="hs-identifier hs-var">matches</span></a></span></span><span>
</span><span id="line-766"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_ext :: forall p body. MatchGroup p body -&gt; XMG p body
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-type">MatchGroupTc</span></a></span><span> </span><span id="local-6989586621682057734"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682057734"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057735"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682057735"><span class="hs-identifier hs-var">origin</span></a></span></span><span>
</span><span id="line-767"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-comment">-- Extract and desugar the leaf commands in the case, building tuple</span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-comment">-- expressions that will (after tagging) replace these leaves</span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057736"><span class="annot"><span class="annottext">leaves :: [(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)]
</span><a href="#local-6989586621682057736"><span class="hs-identifier hs-var hs-var">leaves</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated
   SrcSpanAnnA
   (Match
      (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))
 -&gt; [(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)])
-&gt; [GenLocated
      SrcSpanAnnA
      (Match
         (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))]
-&gt; [(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">LMatch
  (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked)))
-&gt; [(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)]
GenLocated
  SrcSpanAnnA
  (Match
     (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))
-&gt; [(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)]
forall (body :: * -&gt; *).
LMatch
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
-&gt; [(LocatedA (body (GhcPass 'Typechecked)), VarSet)]
</span><a href="GHC.HsToCore.Arrows.html#leavesMatch"><span class="hs-identifier hs-var">leavesMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (Match
      (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057733"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-773"></span><span>      </span><span id="local-6989586621682057739"><span class="annot"><span class="annottext">make_branch :: (LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
</span><a href="#local-6989586621682057739"><span class="hs-identifier hs-var hs-var">make_branch</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057740"><span class="annot"><span class="annottext">LocatedA (HsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057740"><span class="hs-identifier hs-var">leaf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057741"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057741"><span class="hs-identifier hs-var">bound_vars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-774"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621682057742"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057742"><span class="hs-identifier hs-var">core_leaf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057743"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057743"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057744"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057744"><span class="hs-identifier hs-var">leaf_ids</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057727"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057741"><span class="hs-identifier hs-var">bound_vars</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057728"><span class="hs-identifier hs-var">local_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057730"><span class="hs-identifier hs-var">stack_ty</span></a></span><span>
</span><span id="line-776"></span><span>                  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057731"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
LocatedA (HsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057740"><span class="hs-identifier hs-var">leaf</span></a></span><span>
</span><span id="line-777"></span><span>          </span><span class="annot"><span class="annottext">([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; LHsExpr (GhcPass 'Typechecked)
</span><a href="GHC.HsToCore.Arrows.html#mkHsEnvStackExpr"><span class="hs-identifier hs-var">mkHsEnvStackExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057744"><span class="hs-identifier hs-var">leaf_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057729"><span class="hs-identifier hs-var">stack_id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-778"></span><span>                  </span><span class="annot"><span class="annottext">[Id] -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#envStackType"><span class="hs-identifier hs-var">envStackType</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057744"><span class="hs-identifier hs-var">leaf_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057730"><span class="hs-identifier hs-var">stack_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-779"></span><span>                  </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057742"><span class="hs-identifier hs-var">core_leaf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>
</span><span id="line-781"></span><span>  </span><span id="local-6989586621682057745"><span class="annot"><span class="annottext">[([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)]
</span><a href="#local-6989586621682057745"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)
 -&gt; IOEnv
      (Env DsGblEnv DsLclEnv)
      ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr))
-&gt; [(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)]
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     [([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
</span><a href="#local-6989586621682057739"><span class="hs-identifier hs-var">make_branch</span></a></span><span> </span><span class="annot"><span class="annottext">[(LocatedA (HsCmd (GhcPass 'Typechecked)), VarSet)]
</span><a href="#local-6989586621682057736"><span class="hs-identifier hs-var">leaves</span></a></span><span>
</span><span id="line-782"></span><span>  </span><span id="local-6989586621682057746"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682057746"><span class="hs-identifier hs-var">either_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var">dsLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#eitherTyConName"><span class="hs-identifier hs-var">eitherTyConName</span></a></span><span>
</span><span id="line-783"></span><span>  </span><span id="local-6989586621682057747"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057747"><span class="hs-identifier hs-var">left_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM DataCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-var">dsLookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#leftDataConName"><span class="hs-identifier hs-var">leftDataConName</span></a></span><span>
</span><span id="line-784"></span><span>  </span><span id="local-6989586621682057748"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057748"><span class="hs-identifier hs-var">right_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM DataCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupDataCon"><span class="hs-identifier hs-var">dsLookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#rightDataConName"><span class="hs-identifier hs-var">rightDataConName</span></a></span><span>
</span><span id="line-785"></span><span>  </span><span id="local-6989586621682057749"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057749"><span class="hs-identifier hs-var">void_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; Type) -&gt; DsM TyCon -&gt; IOEnv (Env DsGblEnv DsLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; DsM TyCon
</span><a href="GHC.HsToCore.Monad.html#dsLookupTyCon"><span class="hs-identifier hs-var">dsLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#voidTyConName"><span class="hs-identifier hs-var">voidTyConName</span></a></span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-787"></span><span>      </span><span id="local-6989586621682057752"><span class="annot"><span class="annottext">left_id :: HsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057752"><span class="hs-identifier hs-var hs-var">left_id</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; HsExpr (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#mkConLikeTc"><span class="hs-identifier hs-var">mkConLikeTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057747"><span class="hs-identifier hs-var">left_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>      </span><span id="local-6989586621682057755"><span class="annot"><span class="annottext">right_id :: HsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057755"><span class="hs-identifier hs-var hs-var">right_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; HsExpr (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#mkConLikeTc"><span class="hs-identifier hs-var">mkConLikeTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621682057748"><span class="hs-identifier hs-var">right_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>      </span><span id="local-6989586621682057756"><span class="annot"><span class="annottext">left_expr :: Type
-&gt; Type
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057756"><span class="hs-identifier hs-var hs-var">left_expr</span></a></span></span><span>  </span><span id="local-6989586621682057757"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057757"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682057758"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057758"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682057759"><span class="annot"><span class="annottext">LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057759"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr (GhcPass 'Typechecked)
 -&gt; LocatedA (HsExpr (GhcPass 'Typechecked)))
-&gt; HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass 'Typechecked)
-&gt; LHsExpr (GhcPass 'Typechecked)
-&gt; LHsExpr (GhcPass 'Typechecked)
-&gt; HsExpr (GhcPass 'Typechecked)
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass 'Typechecked)
EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span>
</span><span id="line-790"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr (GhcPass 'Typechecked)
 -&gt; LocatedA (HsExpr (GhcPass 'Typechecked)))
-&gt; HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
-&gt; HsExpr (GhcPass 'Typechecked) -&gt; HsExpr (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057757"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057758"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057752"><span class="hs-identifier hs-var">left_id</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057759"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-791"></span><span>      </span><span id="local-6989586621682057765"><span class="annot"><span class="annottext">right_expr :: Type
-&gt; Type
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057765"><span class="hs-identifier hs-var hs-var">right_expr</span></a></span></span><span> </span><span id="local-6989586621682057766"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057766"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621682057767"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057767"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621682057768"><span class="annot"><span class="annottext">LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057768"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr (GhcPass 'Typechecked)
 -&gt; LocatedA (HsExpr (GhcPass 'Typechecked)))
-&gt; HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass 'Typechecked)
-&gt; LHsExpr (GhcPass 'Typechecked)
-&gt; LHsExpr (GhcPass 'Typechecked)
-&gt; HsExpr (GhcPass 'Typechecked)
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass 'Typechecked)
EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span>
</span><span id="line-792"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr (GhcPass 'Typechecked)
 -&gt; LocatedA (HsExpr (GhcPass 'Typechecked)))
-&gt; HsExpr (GhcPass 'Typechecked)
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
-&gt; HsExpr (GhcPass 'Typechecked) -&gt; HsExpr (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057766"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057767"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057755"><span class="hs-identifier hs-var">right_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Typechecked)
LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057768"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>      </span><span class="hs-comment">-- Prefix each tuple with a distinct series of Left's and Right's,</span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-comment">-- in a balanced way, keeping track of the types.</span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span>      </span><span class="annot"><a href="#local-6989586621682057769"><span class="hs-identifier hs-type">merge_branches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- AZ</span><span>
</span><span id="line-800"></span><span>      </span><span id="local-6989586621682057769"><span class="annot"><span class="annottext">merge_branches :: ([LHsExpr (GhcPass 'Typechecked)], Type, CoreExpr)
-&gt; ([LHsExpr (GhcPass 'Typechecked)], Type, CoreExpr)
-&gt; ([LHsExpr (GhcPass 'Typechecked)], Type, CoreExpr)
</span><a href="#local-6989586621682057769"><span class="hs-identifier hs-var hs-var">merge_branches</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057770"><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057770"><span class="hs-identifier hs-var">builds1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057771"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057771"><span class="hs-identifier hs-var">in_ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057772"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057772"><span class="hs-identifier hs-var">core_exp1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>                     </span><span class="hs-special">(</span><span id="local-6989586621682057773"><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057773"><span class="hs-identifier hs-var">builds2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057774"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057774"><span class="hs-identifier hs-var">in_ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057775"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057775"><span class="hs-identifier hs-var">core_exp2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocatedA (HsExpr (GhcPass 'Typechecked))
 -&gt; LocatedA (HsExpr (GhcPass 'Typechecked)))
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
-&gt; Type
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057756"><span class="hs-identifier hs-var">left_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057771"><span class="hs-identifier hs-var">in_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057774"><span class="hs-identifier hs-var">in_ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Typechecked)]
[LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057770"><span class="hs-identifier hs-var">builds1</span></a></span><span> </span><span class="annot"><span class="annottext">[LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-803"></span><span>              </span><span class="annot"><span class="annottext">(LocatedA (HsExpr (GhcPass 'Typechecked))
 -&gt; LocatedA (HsExpr (GhcPass 'Typechecked)))
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
-&gt; Type
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
-&gt; LocatedA (HsExpr (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057765"><span class="hs-identifier hs-var">right_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057771"><span class="hs-identifier hs-var">in_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057774"><span class="hs-identifier hs-var">in_ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExpr (GhcPass 'Typechecked)]
[LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057773"><span class="hs-identifier hs-var">builds2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-804"></span><span>           </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621682057746"><span class="hs-identifier hs-var">either_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057771"><span class="hs-identifier hs-var">in_ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057774"><span class="hs-identifier hs-var">in_ty2</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-805"></span><span>           </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_choice"><span class="hs-identifier hs-var">do_choice</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057727"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057771"><span class="hs-identifier hs-var">in_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057774"><span class="hs-identifier hs-var">in_ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057731"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057772"><span class="hs-identifier hs-var">core_exp1</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057775"><span class="hs-identifier hs-var">core_exp2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-806"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682057776"><span class="annot"><span class="annottext">[LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057776"><span class="hs-identifier hs-var">leaves'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057777"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057777"><span class="hs-identifier hs-var">sum_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057778"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057778"><span class="hs-identifier hs-var">core_choices</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)]
-&gt; Maybe
     (NonEmpty
        ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr))
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.18.2.1/src/Data.List.NonEmpty.html#nonEmpty/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">nonEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">[([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)]
</span><a href="#local-6989586621682057745"><span class="hs-identifier hs-var">branches</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-807"></span><span>    </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682057779"><span class="annot"><span class="annottext">NonEmpty
  ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
</span><a href="#local-6989586621682057779"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
 -&gt; IOEnv
      (Env DsGblEnv DsLclEnv)
      ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr))
-&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
 -&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
 -&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr))
-&gt; NonEmpty
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
-&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
forall a. (a -&gt; a -&gt; a) -&gt; NonEmpty a -&gt; a
</span><a href="GHC.HsToCore.Arrows.html#foldb"><span class="hs-identifier hs-var">foldb</span></a></span><span> </span><span class="annot"><span class="annottext">([LHsExpr (GhcPass 'Typechecked)], Type, CoreExpr)
-&gt; ([LHsExpr (GhcPass 'Typechecked)], Type, CoreExpr)
-&gt; ([LHsExpr (GhcPass 'Typechecked)], Type, CoreExpr)
([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
-&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
-&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
</span><a href="#local-6989586621682057769"><span class="hs-identifier hs-var">merge_branches</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
</span><a href="#local-6989586621682057779"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-comment">-- when the case command has no alternatives, the sum type from</span><span>
</span><span id="line-809"></span><span>    </span><span class="hs-comment">-- Note [Desugaring HsCmdCase] becomes the empty sum type,</span><span>
</span><span id="line-810"></span><span>    </span><span class="hs-comment">-- i.e. Void. The choices then effectively become `arr absurd`,</span><span>
</span><span id="line-811"></span><span>    </span><span class="hs-comment">-- implemented as `arr \case {}`.</span><span>
</span><span id="line-812"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (NonEmpty
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr))
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057749"><span class="hs-identifier hs-var">void_ty</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr
 -&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr))
-&gt; (CoreExpr -&gt; CoreExpr)
-&gt; CoreExpr
-&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var">do_arr</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057727"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057749"><span class="hs-identifier hs-var">void_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057731"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr
 -&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr))
-&gt; DsM CoreExpr
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     ([LocatedA (HsExpr (GhcPass 'Typechecked))], Type, CoreExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-813"></span><span>      </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLamCase (GhcPass 'Typechecked)
-&gt; LamCaseVariant
-&gt; MatchGroup
     (GhcPass 'Typechecked) (LHsExpr (GhcPass 'Typechecked))
-&gt; HsExpr (GhcPass 'Typechecked)
forall p.
XLamCase p
-&gt; LamCaseVariant -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLamCase"><span class="hs-identifier hs-var">HsLamCase</span></a></span><span> </span><span class="annot"><span class="annottext">XLamCase (GhcPass 'Typechecked)
EpAnn [AddEpAnn]
forall ann. EpAnn ann
</span><a href="GHC.Parser.Annotation.html#EpAnnNotUsed"><span class="hs-identifier hs-var">EpAnnNotUsed</span></a></span><span> </span><span class="annot"><span class="annottext">LamCaseVariant
</span><a href="Language.Haskell.Syntax.Expr.html#LamCase"><span class="hs-identifier hs-var">LamCase</span></a></span><span>
</span><span id="line-814"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: XRec
  (GhcPass 'Typechecked)
  [LMatch
     (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[GenLocated
   (Anno
      (Match
         (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))))
   (Match
      (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))))]
-&gt; LocatedAn
     AnnList
     [GenLocated
        (Anno
           (Match
              (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))))
        (Match
           (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))))]
forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-815"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_ext :: XMG
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Type -&gt; Origin -&gt; MatchGroupTc
</span><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-var">MatchGroupTc</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057749"><span class="hs-identifier hs-var">void_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057731"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#Generated"><span class="hs-identifier hs-var">Generated</span></a></span><span>
</span><span id="line-816"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span>      </span><span class="hs-comment">-- Replace the commands in the case with these tagged tuples,</span><span>
</span><span id="line-819"></span><span>      </span><span class="hs-comment">-- yielding a HsExpr Id we can feed to dsExpr.</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057787"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (Match
      (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057787"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([LocatedA (HsExpr (GhcPass 'Typechecked))]
 -&gt; GenLocated
      SrcSpanAnnA
      (Match
         (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))
 -&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))],
     GenLocated
       SrcSpanAnnA
       (Match
          (GhcPass 'Typechecked)
          (LocatedA (HsExpr (GhcPass 'Typechecked))))))
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; [GenLocated
      SrcSpanAnnA
      (Match
         (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))]
-&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))],
    [GenLocated
       SrcSpanAnnA
       (Match
          (GhcPass 'Typechecked)
          (LocatedA (HsExpr (GhcPass 'Typechecked))))])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
-&gt; [LocatedA (HsExpr (GhcPass 'Typechecked))]
-&gt; LMatch
     (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked)))
-&gt; ([LocatedA (HsExpr (GhcPass 'Typechecked))],
    LMatch
      (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))))
forall (body' :: * -&gt; *) (body :: * -&gt; *).
(Anno
   (Match
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (Match
        (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))),
 Anno
   (GRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (GRHS
        (GhcPass 'Typechecked)
        (LocatedA (body (GhcPass 'Typechecked))))) =&gt;
Type
-&gt; [LocatedA (body' (GhcPass 'Typechecked))]
-&gt; LMatch
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    LMatch
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
</span><a href="GHC.HsToCore.Arrows.html#replaceLeavesMatch"><span class="hs-identifier hs-var">replaceLeavesMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057731"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LocatedA (HsExpr (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682057776"><span class="hs-identifier hs-var">leaves'</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (Match
      (GhcPass 'Typechecked) (LocatedA (HsCmd (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057733"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-comment">-- Note that we replace the MatchGroup result type by sum_ty,</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-comment">-- which is the type of matches'</span><span>
</span><span id="line-825"></span><span>  </span><span class="annot"><span class="annottext">(MatchGroup
   (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))),
 CoreExpr)
-&gt; IOEnv
     (Env DsGblEnv DsLclEnv)
     (MatchGroup
        (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))),
      CoreExpr)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#MG"><span class="hs-identifier hs-type">MG</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_alts :: XRec
  (GhcPass 'Typechecked)
  [LMatch
     (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))]
</span><a href="Language.Haskell.Syntax.Expr.html#mg_alts"><span class="hs-identifier hs-var">mg_alts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
-&gt; [GenLocated
      SrcSpanAnnA
      (Match
         (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))))]
-&gt; GenLocated
     SrcSpanAnnL
     [GenLocated
        SrcSpanAnnA
        (Match
           (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))))]
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><a href="#local-6989586621682057732"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (Match
      (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057787"><span class="hs-identifier hs-var">matches'</span></a></span><span>
</span><span id="line-826"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_ext :: XMG
  (GhcPass 'Typechecked) (LocatedA (HsExpr (GhcPass 'Typechecked)))
</span><a href="Language.Haskell.Syntax.Expr.html#mg_ext"><span class="hs-identifier hs-var">mg_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Type -&gt; Origin -&gt; MatchGroupTc
</span><a href="GHC.Hs.Expr.html#MatchGroupTc"><span class="hs-identifier hs-var">MatchGroupTc</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621682057734"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057777"><span class="hs-identifier hs-var">sum_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621682057735"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-827"></span><span>             </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-828"></span><span>          </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057778"><span class="hs-identifier hs-var">core_choices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="hs-comment">{-
Translation of command judgements of the form

        D |-a do { ss } : t
-}</span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdDo"><span class="hs-identifier hs-type">dsCmdDo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>             </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-837"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this statement</span><span>
</span><span id="line-838"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                 </span><span class="hs-comment">-- return type of the statement</span><span>
</span><span id="line-839"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CmdLStmt"><span class="hs-identifier hs-type">CmdLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- statements to desugar</span><span>
</span><span id="line-840"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- list of vars in the input to this statement</span><span>
</span><span id="line-841"></span><span>                                </span><span class="hs-comment">-- This is typically fed back,</span><span>
</span><span id="line-842"></span><span>                                </span><span class="hs-comment">-- so don't pull on it too early</span><span>
</span><span id="line-843"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-844"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span id="dsCmdDo"><span class="annot"><span class="annottext">dsCmdDo :: DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdDo"><span class="hs-identifier hs-var hs-var">dsCmdDo</span></a></span></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DsM (CoreExpr, DIdSet)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsCmdDo&quot;</span></span><span>
</span><span id="line-847"></span><span>
</span><span id="line-848"></span><span class="hs-comment">-- D; xs |-a c : () --&gt; t</span><span>
</span><span id="line-849"></span><span class="hs-comment">-- --------------------------</span><span>
</span><span id="line-850"></span><span class="hs-comment">-- D; xs |-a do { c } : t</span><span>
</span><span id="line-851"></span><span class="hs-comment">--</span><span>
</span><span id="line-852"></span><span class="hs-comment">--              ---&gt; premap (\ (xs) -&gt; ((xs), ())) c</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdDo"><span class="hs-identifier hs-var">dsCmdDo</span></a></span><span> </span><span id="local-6989586621682057790"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057790"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057791"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057791"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057792"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057792"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LastStmt"><span class="hs-identifier hs-type">LastStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLastStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LocatedA (HsCmd (GhcPass 'Typechecked)))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057794"><span class="annot"><span class="annottext">LocatedA (HsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057794"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682057795"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057795"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057796"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057796"><span class="hs-identifier hs-var">core_body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057797"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057797"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsLCmd"><span class="hs-identifier hs-var">dsLCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057790"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057791"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057792"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
LocatedA (HsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057794"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057795"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-856"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057798"><span class="annot"><span class="annottext">env_ty :: Type
</span><a href="#local-6989586621682057798"><span class="hs-identifier hs-var hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057795"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-857"></span><span>    </span><span id="local-6989586621682057799"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057799"><span class="hs-identifier hs-var">env_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057798"><span class="hs-identifier hs-var">env_ty</span></a></span><span>
</span><span id="line-858"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057800"><span class="annot"><span class="annottext">core_map :: CoreExpr
</span><a href="#local-6989586621682057800"><span class="hs-identifier hs-var hs-var">core_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057799"><span class="hs-identifier hs-var">env_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057799"><span class="hs-identifier hs-var">env_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCoreUnitExpr"><span class="hs-identifier hs-var">mkCoreUnitExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057790"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-860"></span><span>                        </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057798"><span class="hs-identifier hs-var">env_ty</span></a></span><span>
</span><span id="line-861"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057798"><span class="hs-identifier hs-var">env_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-862"></span><span>                        </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057792"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-863"></span><span>                        </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057800"><span class="hs-identifier hs-var">core_map</span></a></span><span>
</span><span id="line-864"></span><span>                        </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057796"><span class="hs-identifier hs-var">core_body</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-865"></span><span>        </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057797"><span class="hs-identifier hs-var">env_ids'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdDo"><span class="hs-identifier hs-var">dsCmdDo</span></a></span><span> </span><span id="local-6989586621682057801"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057801"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057802"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057802"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057803"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057803"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057804"><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057804"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682057805"><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057805"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057806"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057806"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057807"><span class="annot"><span class="annottext">bound_vars :: VarSet
</span><a href="#local-6989586621682057807"><span class="hs-identifier hs-var hs-var">bound_vars</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; LStmtLR
     (GhcPass 'Typechecked)
     (GhcPass 'Typechecked)
     (LocatedA (HsCmd (GhcPass 'Typechecked)))
-&gt; [IdP (GhcPass 'Typechecked)]
forall (idL :: Pass) (idR :: Pass) body.
CollectPass (GhcPass idL) =&gt;
CollectFlag (GhcPass idL)
-&gt; LStmtLR (GhcPass idL) (GhcPass idR) body -&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLStmtBinders"><span class="hs-identifier hs-var">collectLStmtBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
LStmtLR
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LocatedA (HsCmd (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057804"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057809"><span class="annot"><span class="annottext">local_vars' :: VarSet
</span><a href="#local-6989586621682057809"><span class="hs-identifier hs-var hs-var">local_vars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057807"><span class="hs-identifier hs-var">bound_vars</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057802"><span class="hs-identifier hs-var">local_vars</span></a></span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057810"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057810"><span class="hs-identifier hs-var">core_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057811"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057811"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; DsM (CoreExpr, DIdSet)) -&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#trimInput"><span class="hs-identifier hs-var">trimInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdDo"><span class="hs-identifier hs-var">dsCmdDo</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057801"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057809"><span class="hs-identifier hs-var">local_vars'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057803"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057805"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057812"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057812"><span class="hs-identifier hs-var">core_stmt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057813"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057813"><span class="hs-identifier hs-var">fv_stmt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; CmdLStmt (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdLStmt"><span class="hs-identifier hs-var">dsCmdLStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057801"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057802"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057811"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057804"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057806"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-872"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var">do_compose</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057801"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-873"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057806"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057811"><span class="hs-identifier hs-var">env_ids'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span>                </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057803"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-876"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057812"><span class="hs-identifier hs-var">core_stmt</span></a></span><span>
</span><span id="line-877"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057810"><span class="hs-identifier hs-var">core_stmts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-878"></span><span>              </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057813"><span class="hs-identifier hs-var">fv_stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span class="hs-comment">{-
A statement maps one local environment to another, and is represented
as an arrow from one tuple type to another.  A statement sequence is
translated to a composition of such arrows.
-}</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdLStmt"><span class="hs-identifier hs-type">dsCmdLStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CmdLStmt"><span class="hs-identifier hs-type">CmdLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-887"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span id="dsCmdLStmt"><span class="annot"><span class="annottext">dsCmdLStmt :: DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; CmdLStmt (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdLStmt"><span class="hs-identifier hs-var hs-var">dsCmdLStmt</span></a></span></span><span> </span><span id="local-6989586621682057815"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057815"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057816"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057816"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057817"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057817"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span> </span><span id="local-6989586621682057818"><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057818"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621682057819"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057819"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span>
</span><span id="line-889"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; CmdStmt (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdStmt"><span class="hs-identifier hs-var">dsCmdStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057815"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057816"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057817"><span class="hs-identifier hs-var">out_ids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Typechecked)
     (GhcPass 'Typechecked)
     (LocatedA (HsCmd (GhcPass 'Typechecked))))
-&gt; StmtLR
     (GhcPass 'Typechecked)
     (GhcPass 'Typechecked)
     (LocatedA (HsCmd (GhcPass 'Typechecked)))
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
GenLocated
  SrcSpanAnnA
  (StmtLR
     (GhcPass 'Typechecked)
     (GhcPass 'Typechecked)
     (LocatedA (HsCmd (GhcPass 'Typechecked))))
</span><a href="#local-6989586621682057818"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057819"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmt"><span class="hs-identifier hs-type">dsCmdStmt</span></a></span><span>
</span><span id="line-892"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>             </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-893"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this statement</span><span>
</span><span id="line-894"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- list of vars in the output of this statement</span><span>
</span><span id="line-895"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CmdStmt"><span class="hs-identifier hs-type">CmdStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>        </span><span class="hs-comment">-- statement to desugar</span><span>
</span><span id="line-896"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- list of vars in the input to this statement</span><span>
</span><span id="line-897"></span><span>                                </span><span class="hs-comment">-- This is typically fed back,</span><span>
</span><span id="line-898"></span><span>                                </span><span class="hs-comment">-- so don't pull on it too early</span><span>
</span><span id="line-899"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-900"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span class="hs-comment">-- D; xs1 |-a c : () --&gt; t</span><span>
</span><span id="line-903"></span><span class="hs-comment">-- D; xs' |-a do { ss } : t'</span><span>
</span><span id="line-904"></span><span class="hs-comment">-- ------------------------------</span><span>
</span><span id="line-905"></span><span class="hs-comment">-- D; xs  |-a do { c; ss } : t'</span><span>
</span><span id="line-906"></span><span class="hs-comment">--</span><span>
</span><span id="line-907"></span><span class="hs-comment">--              ---&gt; premap (\ ((xs)) -&gt; (((xs1),()),(xs')))</span><span>
</span><span id="line-908"></span><span class="hs-comment">--                      (first c &gt;&gt;&gt; arr snd) &gt;&gt;&gt; ss</span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span id="dsCmdStmt"><span class="annot"><span class="annottext">dsCmdStmt :: DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; CmdStmt (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdStmt"><span class="hs-identifier hs-var hs-var">dsCmdStmt</span></a></span></span><span> </span><span id="local-6989586621682057821"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057821"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057822"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057822"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057823"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057823"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span id="local-6989586621682057825"><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LHsCmd (GhcPass 'Typechecked))
</span><a href="#local-6989586621682057825"><span class="hs-identifier hs-var">c_ty</span></a></span></span><span> </span><span id="local-6989586621682057826"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057826"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057827"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057827"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-911"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057828"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057828"><span class="hs-identifier hs-var">core_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057829"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057829"><span class="hs-identifier hs-var">fv_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057830"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057830"><span class="hs-identifier hs-var">env_ids1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057821"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057822"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LHsCmd (GhcPass 'Typechecked))
Type
</span><a href="#local-6989586621682057825"><span class="hs-identifier hs-var">c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057826"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-912"></span><span>    </span><span id="local-6989586621682057831"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057831"><span class="hs-identifier hs-var">core_mux</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnv"><span class="hs-identifier hs-var">matchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057827"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-913"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span>
</span><span id="line-914"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057830"><span class="hs-identifier hs-var">env_ids1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCoreUnitExpr"><span class="hs-identifier hs-var">mkCoreUnitExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057823"><span class="hs-identifier hs-var">out_ids</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-917"></span><span>        </span><span id="local-6989586621682057832"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057832"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057827"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-918"></span><span>        </span><span id="local-6989586621682057833"><span class="annot"><span class="annottext">in_ty1 :: Type
</span><a href="#local-6989586621682057833"><span class="hs-identifier hs-var hs-var">in_ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057830"><span class="hs-identifier hs-var">env_ids1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span>
</span><span id="line-919"></span><span>        </span><span id="local-6989586621682057834"><span class="annot"><span class="annottext">out_ty :: Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var hs-var">out_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057823"><span class="hs-identifier hs-var">out_ids</span></a></span><span>
</span><span id="line-920"></span><span>        </span><span id="local-6989586621682057835"><span class="annot"><span class="annottext">before_c_ty :: Type
</span><a href="#local-6989586621682057835"><span class="hs-identifier hs-var hs-var">before_c_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057833"><span class="hs-identifier hs-var">in_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-921"></span><span>        </span><span id="local-6989586621682057836"><span class="annot"><span class="annottext">after_c_ty :: Type
</span><a href="#local-6989586621682057836"><span class="hs-identifier hs-var hs-var">after_c_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LHsCmd (GhcPass 'Typechecked))
Type
</span><a href="#local-6989586621682057825"><span class="hs-identifier hs-var">c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-922"></span><span>    </span><span id="local-6989586621682057837"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057837"><span class="hs-identifier hs-var">snd_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkSndExpr"><span class="hs-identifier hs-var">mkSndExpr</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LHsCmd (GhcPass 'Typechecked))
Type
</span><a href="#local-6989586621682057825"><span class="hs-identifier hs-var">c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-923"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057821"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057832"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057835"><span class="hs-identifier hs-var">before_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var">out_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057831"><span class="hs-identifier hs-var">core_mux</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-924"></span><span>                </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var">do_compose</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057821"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057835"><span class="hs-identifier hs-var">before_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057836"><span class="hs-identifier hs-var">after_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-925"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_first"><span class="hs-identifier hs-var">do_first</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057821"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057833"><span class="hs-identifier hs-var">in_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LHsCmd (GhcPass 'Typechecked))
Type
</span><a href="#local-6989586621682057825"><span class="hs-identifier hs-var">c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var">out_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057828"><span class="hs-identifier hs-var">core_cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-926"></span><span>                </span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var">do_arr</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057821"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057836"><span class="hs-identifier hs-var">after_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057834"><span class="hs-identifier hs-var">out_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057837"><span class="hs-identifier hs-var">snd_fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-927"></span><span>              </span><span class="annot"><span class="annottext">DIdSet -&gt; [Id] -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#extendDVarSetList"><span class="hs-identifier hs-var">extendDVarSetList</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057829"><span class="hs-identifier hs-var">fv_cmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057823"><span class="hs-identifier hs-var">out_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span class="hs-comment">-- D; xs1 |-a c : () --&gt; t</span><span>
</span><span id="line-930"></span><span class="hs-comment">-- D; xs' |-a do { ss } : t'            xs2 = xs' - defs(p)</span><span>
</span><span id="line-931"></span><span class="hs-comment">-- -----------------------------------</span><span>
</span><span id="line-932"></span><span class="hs-comment">-- D; xs  |-a do { p &lt;- c; ss } : t'</span><span>
</span><span id="line-933"></span><span class="hs-comment">--</span><span>
</span><span id="line-934"></span><span class="hs-comment">--              ---&gt; premap (\ (xs) -&gt; (((xs1),()),(xs2)))</span><span>
</span><span id="line-935"></span><span class="hs-comment">--                      (first c &gt;&gt;&gt; arr (\ (p, (xs2)) -&gt; (xs'))) &gt;&gt;&gt; ss</span><span>
</span><span id="line-936"></span><span class="hs-comment">--</span><span>
</span><span id="line-937"></span><span class="hs-comment">-- It would be simpler and more consistent to do this using second,</span><span>
</span><span id="line-938"></span><span class="hs-comment">-- but that's likely to be defined in terms of first.</span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmt"><span class="hs-identifier hs-var">dsCmdStmt</span></a></span><span> </span><span id="local-6989586621682057839"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057840"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057840"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057841"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057841"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#BindStmt"><span class="hs-identifier hs-type">BindStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBindStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LHsCmd (GhcPass 'Typechecked))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057843"><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057843"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621682057844"><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057844"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057845"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057845"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057846"><span class="annot"><span class="annottext">pat_ty :: Type
</span><a href="#local-6989586621682057846"><span class="hs-identifier hs-var hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked) -&gt; Type
</span><a href="GHC.Hs.Syn.Type.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057843"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057847"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057847"><span class="hs-identifier hs-var">core_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057848"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057848"><span class="hs-identifier hs-var">fv_cmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057849"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057849"><span class="hs-identifier hs-var">env_ids1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; Type
-&gt; Type
-&gt; LHsCmd (GhcPass 'Typechecked)
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmd"><span class="hs-identifier hs-var">dsfixCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057840"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057846"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmd (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057844"><span class="hs-identifier hs-var">cmd</span></a></span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057850"><span class="annot"><span class="annottext">pat_vars :: VarSet
</span><a href="#local-6989586621682057850"><span class="hs-identifier hs-var hs-var">pat_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; LPat (GhcPass 'Typechecked) -&gt; [IdP (GhcPass 'Typechecked)]
forall p. CollectPass p =&gt; CollectFlag p -&gt; LPat p -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatBinders"><span class="hs-identifier hs-var">collectPatBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057843"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-945"></span><span>        </span><span id="local-6989586621682057851"><span class="annot"><span class="annottext">env_ids2 :: [Id]
</span><a href="#local-6989586621682057851"><span class="hs-identifier hs-var hs-var">env_ids2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057850"><span class="hs-identifier hs-var">pat_vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057841"><span class="hs-identifier hs-var">out_ids</span></a></span><span>
</span><span id="line-946"></span><span>        </span><span id="local-6989586621682057854"><span class="annot"><span class="annottext">env_ty2 :: Type
</span><a href="#local-6989586621682057854"><span class="hs-identifier hs-var hs-var">env_ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057851"><span class="hs-identifier hs-var">env_ids2</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-comment">-- multiplexing function</span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-comment">--          \ (xs) -&gt; (((xs1),()),(xs2))</span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span>    </span><span id="local-6989586621682057855"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057855"><span class="hs-identifier hs-var">core_mux</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnv"><span class="hs-identifier hs-var">matchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057845"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-952"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span>
</span><span id="line-953"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057849"><span class="hs-identifier hs-var">env_ids1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCoreUnitExpr"><span class="hs-identifier hs-var">mkCoreUnitExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057851"><span class="hs-identifier hs-var">env_ids2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span>    </span><span class="hs-comment">-- projection function</span><span>
</span><span id="line-957"></span><span>    </span><span class="hs-comment">--          \ (p, (xs2)) -&gt; (zs)</span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span>    </span><span id="local-6989586621682057856"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057856"><span class="hs-identifier hs-var">env_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057854"><span class="hs-identifier hs-var">env_ty2</span></a></span><span>
</span><span id="line-960"></span><span>    </span><span id="local-6989586621682057857"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057857"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span><span>
</span><span id="line-961"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-962"></span><span>       </span><span id="local-6989586621682057858"><span class="annot"><span class="annottext">after_c_ty :: Type
</span><a href="#local-6989586621682057858"><span class="hs-identifier hs-var hs-var">after_c_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057846"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057854"><span class="hs-identifier hs-var">env_ty2</span></a></span><span>
</span><span id="line-963"></span><span>       </span><span id="local-6989586621682057859"><span class="annot"><span class="annottext">out_ty :: Type
</span><a href="#local-6989586621682057859"><span class="hs-identifier hs-var hs-var">out_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057841"><span class="hs-identifier hs-var">out_ids</span></a></span><span>
</span><span id="line-964"></span><span>       </span><span id="local-6989586621682057860"><span class="annot"><span class="annottext">body_expr :: CoreExpr
</span><a href="#local-6989586621682057860"><span class="hs-identifier hs-var hs-var">body_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; Id -&gt; [Id] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCaseTuple"><span class="hs-identifier hs-var">coreCaseTuple</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057857"><span class="hs-identifier hs-var">uniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057856"><span class="hs-identifier hs-var">env_id</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057851"><span class="hs-identifier hs-var">env_ids2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057841"><span class="hs-identifier hs-var">out_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span>    </span><span id="local-6989586621682057861"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057861"><span class="hs-identifier hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn -&gt; Type -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Utils.html#mkFailExpr"><span class="hs-identifier hs-var">mkFailExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsStmtContext GhcRn -&gt; HsMatchContext GhcRn
forall p. HsStmtContext p -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-var">StmtCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext GhcRn
forall p. HsDoFlavour -&gt; HsStmtContext p
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-var">DoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057859"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-967"></span><span>    </span><span id="local-6989586621682057865"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057865"><span class="hs-identifier hs-var">pat_id</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; LPat (GhcPass 'Typechecked) -&gt; DsM Id
</span><a href="GHC.HsToCore.Utils.html#selectSimpleMatchVarL"><span class="hs-identifier hs-var">selectSimpleMatchVarL</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057843"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-968"></span><span>    </span><span id="local-6989586621682057866"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057866"><span class="hs-identifier hs-var">match_code</span></a></span></span><span>
</span><span id="line-969"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; HsMatchContext GhcRn
-&gt; LPat (GhcPass 'Typechecked)
-&gt; CoreExpr
-&gt; CoreExpr
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Match.html#matchSimply"><span class="hs-identifier hs-var">matchSimply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057865"><span class="hs-identifier hs-var">pat_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsStmtContext GhcRn -&gt; HsMatchContext GhcRn
forall p. HsStmtContext p -&gt; HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#StmtCtxt"><span class="hs-identifier hs-var">StmtCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDoFlavour -&gt; HsStmtContext GhcRn
forall p. HsDoFlavour -&gt; HsStmtContext p
</span><a href="Language.Haskell.Syntax.Expr.html#HsDoStmt"><span class="hs-identifier hs-var">HsDoStmt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ModuleName -&gt; HsDoFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#DoExpr"><span class="hs-identifier hs-var">DoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057843"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057860"><span class="hs-identifier hs-var">body_expr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057861"><span class="hs-identifier hs-var">fail_expr</span></a></span><span>
</span><span id="line-970"></span><span>    </span><span id="local-6989586621682057867"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057867"><span class="hs-identifier hs-var">pair_id</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057858"><span class="hs-identifier hs-var">after_c_ty</span></a></span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-972"></span><span>        </span><span id="local-6989586621682057868"><span class="annot"><span class="annottext">proj_expr :: CoreExpr
</span><a href="#local-6989586621682057868"><span class="hs-identifier hs-var hs-var">proj_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="GHC.Core.html#Lam"><span class="hs-identifier hs-var">Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057867"><span class="hs-identifier hs-var">pair_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCasePair"><span class="hs-identifier hs-var">coreCasePair</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057867"><span class="hs-identifier hs-var">pair_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057865"><span class="hs-identifier hs-var">pat_id</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057856"><span class="hs-identifier hs-var">env_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057866"><span class="hs-identifier hs-var">match_code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span>    </span><span class="hs-comment">-- put it all together</span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-976"></span><span>        </span><span id="local-6989586621682057869"><span class="annot"><span class="annottext">in_ty :: Type
</span><a href="#local-6989586621682057869"><span class="hs-identifier hs-var hs-var">in_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057845"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-977"></span><span>        </span><span id="local-6989586621682057870"><span class="annot"><span class="annottext">in_ty1 :: Type
</span><a href="#local-6989586621682057870"><span class="hs-identifier hs-var hs-var">in_ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057849"><span class="hs-identifier hs-var">env_ids1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span>
</span><span id="line-978"></span><span>        </span><span id="local-6989586621682057871"><span class="annot"><span class="annottext">in_ty2 :: Type
</span><a href="#local-6989586621682057871"><span class="hs-identifier hs-var hs-var">in_ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057851"><span class="hs-identifier hs-var">env_ids2</span></a></span><span>
</span><span id="line-979"></span><span>        </span><span id="local-6989586621682057872"><span class="annot"><span class="annottext">before_c_ty :: Type
</span><a href="#local-6989586621682057872"><span class="hs-identifier hs-var hs-var">before_c_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057870"><span class="hs-identifier hs-var">in_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057871"><span class="hs-identifier hs-var">in_ty2</span></a></span><span>
</span><span id="line-980"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057869"><span class="hs-identifier hs-var">in_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057872"><span class="hs-identifier hs-var">before_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057859"><span class="hs-identifier hs-var">out_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057855"><span class="hs-identifier hs-var">core_mux</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-981"></span><span>                </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var">do_compose</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057872"><span class="hs-identifier hs-var">before_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057858"><span class="hs-identifier hs-var">after_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057859"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-982"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_first"><span class="hs-identifier hs-var">do_first</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057870"><span class="hs-identifier hs-var">in_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057846"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057871"><span class="hs-identifier hs-var">in_ty2</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057847"><span class="hs-identifier hs-var">core_cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-983"></span><span>                </span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var">do_arr</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057839"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057858"><span class="hs-identifier hs-var">after_c_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057859"><span class="hs-identifier hs-var">out_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057868"><span class="hs-identifier hs-var">proj_expr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-984"></span><span>              </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057848"><span class="hs-identifier hs-var">fv_cmd</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; DIdSet -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSet"><span class="hs-operator hs-var">`unionDVarSet`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#mkDVarSet"><span class="hs-identifier hs-var">mkDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057841"><span class="hs-identifier hs-var">out_ids</span></a></span><span>
</span><span id="line-985"></span><span>                                     </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetMinusUniqSet"><span class="hs-operator hs-var">`uniqDSetMinusUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057850"><span class="hs-identifier hs-var">pat_vars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span class="hs-comment">-- D; xs' |-a do { ss } : t</span><span>
</span><span id="line-988"></span><span class="hs-comment">-- --------------------------------------</span><span>
</span><span id="line-989"></span><span class="hs-comment">-- D; xs  |-a do { let binds; ss } : t</span><span>
</span><span id="line-990"></span><span class="hs-comment">--</span><span>
</span><span id="line-991"></span><span class="hs-comment">--              ---&gt; arr (\ (xs) -&gt; let binds in (xs')) &gt;&gt;&gt; ss</span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmt"><span class="hs-identifier hs-var">dsCmdStmt</span></a></span><span> </span><span id="local-6989586621682057874"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057874"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057875"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057875"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057876"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057876"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LetStmt"><span class="hs-identifier hs-type">LetStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XLetStmt
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LHsCmd (GhcPass 'Typechecked))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057878"><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057878"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057879"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057879"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-994"></span><span>    </span><span class="hs-comment">-- build a new environment using the let bindings</span><span>
</span><span id="line-995"></span><span>    </span><span id="local-6989586621682057880"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057880"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked) -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLocalBinds"><span class="hs-identifier hs-var">dsLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057878"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057876"><span class="hs-identifier hs-var">out_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>    </span><span class="hs-comment">-- match the old environment against the input</span><span>
</span><span id="line-997"></span><span>    </span><span id="local-6989586621682057881"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057881"><span class="hs-identifier hs-var">core_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnv"><span class="hs-identifier hs-var">matchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057879"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057880"><span class="hs-identifier hs-var">core_binds</span></a></span><span>
</span><span id="line-998"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var">do_arr</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057874"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-999"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057879"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057876"><span class="hs-identifier hs-var">out_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1001"></span><span>                        </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057881"><span class="hs-identifier hs-var">core_map</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1002"></span><span>            </span><span class="annot"><span class="annottext">CoreExpr -&gt; DIdSet
</span><a href="GHC.Core.FVs.html#exprFreeIdsDSet"><span class="hs-identifier hs-var">exprFreeIdsDSet</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057880"><span class="hs-identifier hs-var">core_binds</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetIntersectUniqSet"><span class="hs-operator hs-var">`uniqDSetIntersectUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057875"><span class="hs-identifier hs-var">local_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span class="hs-comment">-- D; ys  |-a do { ss; returnA -&lt; ((xs1), (ys2)) } : ...</span><span>
</span><span id="line-1005"></span><span class="hs-comment">-- D; xs' |-a do { ss' } : t</span><span>
</span><span id="line-1006"></span><span class="hs-comment">-- ------------------------------------</span><span>
</span><span id="line-1007"></span><span class="hs-comment">-- D; xs  |-a do { rec ss; ss' } : t</span><span>
</span><span id="line-1008"></span><span class="hs-comment">--</span><span>
</span><span id="line-1009"></span><span class="hs-comment">--                      xs1 = xs' /\ defs(ss)</span><span>
</span><span id="line-1010"></span><span class="hs-comment">--                      xs2 = xs' - defs(ss)</span><span>
</span><span id="line-1011"></span><span class="hs-comment">--                      ys1 = ys - defs(ss)</span><span>
</span><span id="line-1012"></span><span class="hs-comment">--                      ys2 = ys /\ defs(ss)</span><span>
</span><span id="line-1013"></span><span class="hs-comment">--</span><span>
</span><span id="line-1014"></span><span class="hs-comment">--              ---&gt; arr (\(xs) -&gt; ((ys1),(xs2))) &gt;&gt;&gt;</span><span>
</span><span id="line-1015"></span><span class="hs-comment">--                      first (loop (arr (\((ys1),~(ys2)) -&gt; (ys)) &gt;&gt;&gt; ss)) &gt;&gt;&gt;</span><span>
</span><span id="line-1016"></span><span class="hs-comment">--                      arr (\((xs1),(xs2)) -&gt; (xs')) &gt;&gt;&gt; ss'</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmt"><span class="hs-identifier hs-var">dsCmdStmt</span></a></span><span> </span><span id="local-6989586621682057882"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057882"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057883"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057883"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057884"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057884"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span>
</span><span id="line-1019"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#RecStmt"><span class="hs-identifier hs-type">RecStmt</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recS_stmts :: forall idL idR body.
StmtLR idL idR body -&gt; XRec idR [LStmtLR idL idR body]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_stmts"><span class="hs-identifier hs-var">recS_stmts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnL
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057887"><span class="annot"><span class="annottext">[GenLocated
   SrcSpanAnnA
   (StmtLR
      (GhcPass 'Typechecked)
      (GhcPass 'Typechecked)
      (LocatedA (HsCmd (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057887"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-1020"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_later_ids :: forall idL idR body. StmtLR idL idR body -&gt; [IdP idR]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_later_ids"><span class="hs-identifier hs-var">recS_later_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057889"><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057889"><span class="hs-identifier hs-var">later_ids</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_rec_ids :: forall idL idR body. StmtLR idL idR body -&gt; [IdP idR]
</span><a href="Language.Haskell.Syntax.Expr.html#recS_rec_ids"><span class="hs-identifier hs-var">recS_rec_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057891"><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057891"><span class="hs-identifier hs-var">rec_ids</span></a></span></span><span>
</span><span id="line-1021"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_ext :: forall idL idR body. StmtLR idL idR body -&gt; XRecStmt idL idR body
</span><a href="Language.Haskell.Syntax.Expr.html#recS_ext"><span class="hs-identifier hs-var">recS_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#RecStmtTc"><span class="hs-identifier hs-type">RecStmtTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">recS_later_rets :: RecStmtTc -&gt; [HsExpr (GhcPass 'Typechecked)]
</span><a href="GHC.Hs.Expr.html#recS_later_rets"><span class="hs-identifier hs-var">recS_later_rets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057895"><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057895"><span class="hs-identifier hs-var">later_rets</span></a></span></span><span>
</span><span id="line-1022"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recS_rec_rets :: RecStmtTc -&gt; [HsExpr (GhcPass 'Typechecked)]
</span><a href="GHC.Hs.Expr.html#recS_rec_rets"><span class="hs-identifier hs-var">recS_rec_rets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057897"><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057897"><span class="hs-identifier hs-var">rec_rets</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>        </span><span id="local-6989586621682057898"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057898"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1025"></span><span>        </span><span id="local-6989586621682057899"><span class="annot"><span class="annottext">later_ids_set :: VarSet
</span><a href="#local-6989586621682057899"><span class="hs-identifier hs-var hs-var">later_ids_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
[Id]
</span><a href="#local-6989586621682057889"><span class="hs-identifier hs-var">later_ids</span></a></span><span>
</span><span id="line-1026"></span><span>        </span><span id="local-6989586621682057900"><span class="annot"><span class="annottext">env2_ids :: [Id]
</span><a href="#local-6989586621682057900"><span class="hs-identifier hs-var hs-var">env2_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057899"><span class="hs-identifier hs-var">later_ids_set</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057884"><span class="hs-identifier hs-var">out_ids</span></a></span><span>
</span><span id="line-1027"></span><span>        </span><span id="local-6989586621682057901"><span class="annot"><span class="annottext">env2_id_set :: DIdSet
</span><a href="#local-6989586621682057901"><span class="hs-identifier hs-var hs-var">env2_id_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#mkDVarSet"><span class="hs-identifier hs-var">mkDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057900"><span class="hs-identifier hs-var">env2_ids</span></a></span><span>
</span><span id="line-1028"></span><span>        </span><span id="local-6989586621682057902"><span class="annot"><span class="annottext">env2_ty :: Type
</span><a href="#local-6989586621682057902"><span class="hs-identifier hs-var hs-var">env2_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057900"><span class="hs-identifier hs-var">env2_ids</span></a></span><span>
</span><span id="line-1029"></span><span>
</span><span id="line-1030"></span><span>    </span><span class="hs-comment">-- post_loop_fn = \((later_ids),(env2_ids)) -&gt; (out_ids)</span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span>    </span><span id="local-6989586621682057903"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057903"><span class="hs-identifier hs-var">uniqs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf DsGblEnv DsLclEnv UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span><span>
</span><span id="line-1033"></span><span>    </span><span id="local-6989586621682057904"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057904"><span class="hs-identifier hs-var">env2_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057902"><span class="hs-identifier hs-var">env2_ty</span></a></span><span>
</span><span id="line-1034"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1035"></span><span>        </span><span id="local-6989586621682057905"><span class="annot"><span class="annottext">later_ty :: Type
</span><a href="#local-6989586621682057905"><span class="hs-identifier hs-var hs-var">later_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
[Id]
</span><a href="#local-6989586621682057889"><span class="hs-identifier hs-var">later_ids</span></a></span><span>
</span><span id="line-1036"></span><span>        </span><span id="local-6989586621682057906"><span class="annot"><span class="annottext">post_pair_ty :: Type
</span><a href="#local-6989586621682057906"><span class="hs-identifier hs-var hs-var">post_pair_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057905"><span class="hs-identifier hs-var">later_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057902"><span class="hs-identifier hs-var">env2_ty</span></a></span><span>
</span><span id="line-1037"></span><span>        </span><span id="local-6989586621682057907"><span class="annot"><span class="annottext">post_loop_body :: CoreExpr
</span><a href="#local-6989586621682057907"><span class="hs-identifier hs-var hs-var">post_loop_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSupply -&gt; Id -&gt; [Id] -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#coreCaseTuple"><span class="hs-identifier hs-var">coreCaseTuple</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621682057903"><span class="hs-identifier hs-var">uniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057904"><span class="hs-identifier hs-var">env2_id</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057900"><span class="hs-identifier hs-var">env2_ids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057884"><span class="hs-identifier hs-var">out_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span>    </span><span id="local-6989586621682057908"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057908"><span class="hs-identifier hs-var">post_loop_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
[Id]
</span><a href="#local-6989586621682057889"><span class="hs-identifier hs-var">later_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057904"><span class="hs-identifier hs-var">env2_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057907"><span class="hs-identifier hs-var">post_loop_body</span></a></span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span>    </span><span class="hs-comment">--- loop (...)</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057909"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057909"><span class="hs-identifier hs-var">core_loop</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057910"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057910"><span class="hs-identifier hs-var">env1_id_set</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057911"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057911"><span class="hs-identifier hs-var">env1_ids</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1044"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; [HsExpr (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; [HsExpr (GhcPass 'Typechecked)]
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsRecCmd"><span class="hs-identifier hs-var">dsRecCmd</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057882"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057883"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
[GenLocated
   SrcSpanAnnA
   (StmtLR
      (GhcPass 'Typechecked)
      (GhcPass 'Typechecked)
      (LocatedA (HsCmd (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057887"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
[Id]
</span><a href="#local-6989586621682057889"><span class="hs-identifier hs-var">later_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057895"><span class="hs-identifier hs-var">later_rets</span></a></span><span> </span><span class="annot"><span class="annottext">[IdP (GhcPass 'Typechecked)]
[Id]
</span><a href="#local-6989586621682057891"><span class="hs-identifier hs-var">rec_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057897"><span class="hs-identifier hs-var">rec_rets</span></a></span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span>    </span><span class="hs-comment">-- pre_loop_fn = \(env_ids) -&gt; ((env1_ids),(env2_ids))</span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1049"></span><span>        </span><span id="local-6989586621682057913"><span class="annot"><span class="annottext">env1_ty :: Type
</span><a href="#local-6989586621682057913"><span class="hs-identifier hs-var hs-var">env1_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057911"><span class="hs-identifier hs-var">env1_ids</span></a></span><span>
</span><span id="line-1050"></span><span>        </span><span id="local-6989586621682057914"><span class="annot"><span class="annottext">pre_pair_ty :: Type
</span><a href="#local-6989586621682057914"><span class="hs-identifier hs-var hs-var">pre_pair_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057913"><span class="hs-identifier hs-var">env1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057902"><span class="hs-identifier hs-var">env2_ty</span></a></span><span>
</span><span id="line-1051"></span><span>        </span><span id="local-6989586621682057915"><span class="annot"><span class="annottext">pre_loop_body :: CoreExpr
</span><a href="#local-6989586621682057915"><span class="hs-identifier hs-var hs-var">pre_loop_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057911"><span class="hs-identifier hs-var">env1_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1052"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057900"><span class="hs-identifier hs-var">env2_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span>    </span><span id="local-6989586621682057916"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057916"><span class="hs-identifier hs-var">pre_loop_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnv"><span class="hs-identifier hs-var">matchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057898"><span class="hs-identifier hs-var">env_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057915"><span class="hs-identifier hs-var">pre_loop_body</span></a></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>    </span><span class="hs-comment">-- arr pre_loop_fn &gt;&gt;&gt; first (loop (...)) &gt;&gt;&gt; arr post_loop_fn</span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1059"></span><span>        </span><span id="local-6989586621682057917"><span class="annot"><span class="annottext">env_ty :: Type
</span><a href="#local-6989586621682057917"><span class="hs-identifier hs-var hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057898"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-1060"></span><span>        </span><span id="local-6989586621682057918"><span class="annot"><span class="annottext">out_ty :: Type
</span><a href="#local-6989586621682057918"><span class="hs-identifier hs-var hs-var">out_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057884"><span class="hs-identifier hs-var">out_ids</span></a></span><span>
</span><span id="line-1061"></span><span>        </span><span id="local-6989586621682057919"><span class="annot"><span class="annottext">core_body :: CoreExpr
</span><a href="#local-6989586621682057919"><span class="hs-identifier hs-var hs-var">core_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057882"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057917"><span class="hs-identifier hs-var">env_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057914"><span class="hs-identifier hs-var">pre_pair_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057918"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-1062"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057916"><span class="hs-identifier hs-var">pre_loop_fn</span></a></span><span>
</span><span id="line-1063"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var">do_compose</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057882"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057914"><span class="hs-identifier hs-var">pre_pair_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057906"><span class="hs-identifier hs-var">post_pair_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057918"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-1064"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_first"><span class="hs-identifier hs-var">do_first</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057882"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057913"><span class="hs-identifier hs-var">env1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057905"><span class="hs-identifier hs-var">later_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057902"><span class="hs-identifier hs-var">env2_ty</span></a></span><span>
</span><span id="line-1065"></span><span>                                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057909"><span class="hs-identifier hs-var">core_loop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var">do_arr</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057882"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057906"><span class="hs-identifier hs-var">post_pair_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057918"><span class="hs-identifier hs-var">out_ty</span></a></span><span>
</span><span id="line-1067"></span><span>                                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057908"><span class="hs-identifier hs-var">post_loop_fn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057919"><span class="hs-identifier hs-var">core_body</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057910"><span class="hs-identifier hs-var">env1_id_set</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; DIdSet -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#unionDVarSet"><span class="hs-operator hs-var">`unionDVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057901"><span class="hs-identifier hs-var">env2_id_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>
</span><span id="line-1071"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmt"><span class="hs-identifier hs-var">dsCmdStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CmdStmt (GhcPass 'Typechecked)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057920"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057920"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM (CoreExpr, DIdSet)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsCmdStmt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057920"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span class="hs-comment">--      loop (premap (\ ((env1_ids), ~(rec_ids)) -&gt; (env_ids))</span><span>
</span><span id="line-1074"></span><span class="hs-comment">--            (ss &gt;&gt;&gt; arr (\ (out_ids) -&gt; ((later_rets),(rec_rets))))) &gt;&gt;&gt;</span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsRecCmd"><span class="hs-identifier hs-type">dsRecCmd</span></a></span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>             </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-1078"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this statement</span><span>
</span><span id="line-1079"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CmdLStmt"><span class="hs-identifier hs-type">CmdLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- list of statements inside the RecCmd</span><span>
</span><span id="line-1080"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- list of vars defined here and used later</span><span>
</span><span id="line-1081"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- expressions corresponding to later_ids</span><span>
</span><span id="line-1082"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- list of vars fed back through the loop</span><span>
</span><span id="line-1083"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- expressions corresponding to rec_ids</span><span>
</span><span id="line-1084"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared statement</span><span>
</span><span id="line-1085"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-1086"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- same local vars as a list</span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span id="dsRecCmd"><span class="annot"><span class="annottext">dsRecCmd :: DsCmdEnv
-&gt; VarSet
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; [HsExpr (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; [HsExpr (GhcPass 'Typechecked)]
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsRecCmd"><span class="hs-identifier hs-var hs-var">dsRecCmd</span></a></span></span><span> </span><span id="local-6989586621682057921"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057921"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057922"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057922"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057923"><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057923"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621682057924"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057924"><span class="hs-identifier hs-var">later_ids</span></a></span></span><span> </span><span id="local-6989586621682057925"><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057925"><span class="hs-identifier hs-var">later_rets</span></a></span></span><span> </span><span id="local-6989586621682057926"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057926"><span class="hs-identifier hs-var">rec_ids</span></a></span></span><span> </span><span id="local-6989586621682057927"><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057927"><span class="hs-identifier hs-var">rec_rets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1089"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1090"></span><span>        </span><span id="local-6989586621682057928"><span class="annot"><span class="annottext">later_id_set :: VarSet
</span><a href="#local-6989586621682057928"><span class="hs-identifier hs-var hs-var">later_id_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057924"><span class="hs-identifier hs-var">later_ids</span></a></span><span>
</span><span id="line-1091"></span><span>        </span><span id="local-6989586621682057929"><span class="annot"><span class="annottext">rec_id_set :: VarSet
</span><a href="#local-6989586621682057929"><span class="hs-identifier hs-var hs-var">rec_id_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057926"><span class="hs-identifier hs-var">rec_ids</span></a></span><span>
</span><span id="line-1092"></span><span>        </span><span id="local-6989586621682057930"><span class="annot"><span class="annottext">local_vars' :: VarSet
</span><a href="#local-6989586621682057930"><span class="hs-identifier hs-var hs-var">local_vars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057929"><span class="hs-identifier hs-var">rec_id_set</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057928"><span class="hs-identifier hs-var">later_id_set</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057922"><span class="hs-identifier hs-var">local_vars</span></a></span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span>    </span><span class="hs-comment">-- mk_pair_fn = \ (out_ids) -&gt; ((later_rets),(rec_rets))</span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>    </span><span id="local-6989586621682057931"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057931"><span class="hs-identifier hs-var">core_later_rets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr)
-&gt; [HsExpr (GhcPass 'Typechecked)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [CoreExpr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057925"><span class="hs-identifier hs-var">later_rets</span></a></span><span>
</span><span id="line-1097"></span><span>    </span><span id="local-6989586621682057932"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057932"><span class="hs-identifier hs-var">core_rec_rets</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr)
-&gt; [HsExpr (GhcPass 'Typechecked)]
-&gt; IOEnv (Env DsGblEnv DsLclEnv) [CoreExpr]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Typechecked) -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">[HsExpr (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057927"><span class="hs-identifier hs-var">rec_rets</span></a></span><span>
</span><span id="line-1098"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1099"></span><span>        </span><span class="hs-comment">-- possibly polymorphic version of vars of later_ids and rec_ids</span><span>
</span><span id="line-1100"></span><span>        </span><span id="local-6989586621682057933"><span class="annot"><span class="annottext">out_ids :: [Id]
</span><a href="#local-6989586621682057933"><span class="hs-identifier hs-var hs-var">out_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; [Id]
</span><a href="GHC.Core.FVs.html#exprsFreeIdsList"><span class="hs-identifier hs-var">exprsFreeIdsList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057931"><span class="hs-identifier hs-var">core_later_rets</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; [CoreExpr] -&gt; [CoreExpr]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057932"><span class="hs-identifier hs-var">core_rec_rets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1101"></span><span>        </span><span id="local-6989586621682057935"><span class="annot"><span class="annottext">out_ty :: Type
</span><a href="#local-6989586621682057935"><span class="hs-identifier hs-var hs-var">out_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057933"><span class="hs-identifier hs-var">out_ids</span></a></span><span>
</span><span id="line-1102"></span><span>
</span><span id="line-1103"></span><span>        </span><span id="local-6989586621682057936"><span class="annot"><span class="annottext">later_tuple :: CoreExpr
</span><a href="#local-6989586621682057936"><span class="hs-identifier hs-var hs-var">later_tuple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreTup"><span class="hs-identifier hs-var">mkBigCoreTup</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057931"><span class="hs-identifier hs-var">core_later_rets</span></a></span><span>
</span><span id="line-1104"></span><span>        </span><span id="local-6989586621682057938"><span class="annot"><span class="annottext">later_ty :: Type
</span><a href="#local-6989586621682057938"><span class="hs-identifier hs-var hs-var">later_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057924"><span class="hs-identifier hs-var">later_ids</span></a></span><span>
</span><span id="line-1105"></span><span>
</span><span id="line-1106"></span><span>        </span><span id="local-6989586621682057939"><span class="annot"><span class="annottext">rec_tuple :: CoreExpr
</span><a href="#local-6989586621682057939"><span class="hs-identifier hs-var hs-var">rec_tuple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreTup"><span class="hs-identifier hs-var">mkBigCoreTup</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057932"><span class="hs-identifier hs-var">core_rec_rets</span></a></span><span>
</span><span id="line-1107"></span><span>        </span><span id="local-6989586621682057940"><span class="annot"><span class="annottext">rec_ty :: Type
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var hs-var">rec_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057926"><span class="hs-identifier hs-var">rec_ids</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>        </span><span id="local-6989586621682057941"><span class="annot"><span class="annottext">out_pair :: CoreExpr
</span><a href="#local-6989586621682057941"><span class="hs-identifier hs-var hs-var">out_pair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairExpr"><span class="hs-identifier hs-var">mkCorePairExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057936"><span class="hs-identifier hs-var">later_tuple</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057939"><span class="hs-identifier hs-var">rec_tuple</span></a></span><span>
</span><span id="line-1110"></span><span>        </span><span id="local-6989586621682057942"><span class="annot"><span class="annottext">out_pair_ty :: Type
</span><a href="#local-6989586621682057942"><span class="hs-identifier hs-var hs-var">out_pair_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057938"><span class="hs-identifier hs-var">later_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var">rec_ty</span></a></span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span>    </span><span id="local-6989586621682057943"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057943"><span class="hs-identifier hs-var">mk_pair_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnv"><span class="hs-identifier hs-var">matchEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057933"><span class="hs-identifier hs-var">out_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057941"><span class="hs-identifier hs-var">out_pair</span></a></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span>    </span><span class="hs-comment">-- ss</span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057944"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057944"><span class="hs-identifier hs-var">core_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057945"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057945"><span class="hs-identifier hs-var">fv_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057946"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057946"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmdStmts"><span class="hs-identifier hs-var">dsfixCmdStmts</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057921"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057930"><span class="hs-identifier hs-var">local_vars'</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057933"><span class="hs-identifier hs-var">out_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057923"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-1117"></span><span>
</span><span id="line-1118"></span><span>    </span><span class="hs-comment">-- squash_pair_fn = \ ((env1_ids), ~(rec_ids)) -&gt; (env_ids)</span><span>
</span><span id="line-1119"></span><span>
</span><span id="line-1120"></span><span>    </span><span id="local-6989586621682057948"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057948"><span class="hs-identifier hs-var">rec_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Monad.html#newSysLocalDs"><span class="hs-identifier hs-var">newSysLocalDs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#ManyTy"><span class="hs-identifier hs-var">ManyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var">rec_ty</span></a></span><span>
</span><span id="line-1121"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1122"></span><span>        </span><span id="local-6989586621682057949"><span class="annot"><span class="annottext">env1_id_set :: DIdSet
</span><a href="#local-6989586621682057949"><span class="hs-identifier hs-var hs-var">env1_id_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057945"><span class="hs-identifier hs-var">fv_stmts</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; VarSet -&gt; DIdSet
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetMinusUniqSet"><span class="hs-operator hs-var">`uniqDSetMinusUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057929"><span class="hs-identifier hs-var">rec_id_set</span></a></span><span>
</span><span id="line-1123"></span><span>        </span><span id="local-6989586621682057950"><span class="annot"><span class="annottext">env1_ids :: [Id]
</span><a href="#local-6989586621682057950"><span class="hs-identifier hs-var hs-var">env1_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; [Id]
</span><a href="GHC.Types.Var.Set.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057949"><span class="hs-identifier hs-var">env1_id_set</span></a></span><span>
</span><span id="line-1124"></span><span>        </span><span id="local-6989586621682057951"><span class="annot"><span class="annottext">env1_ty :: Type
</span><a href="#local-6989586621682057951"><span class="hs-identifier hs-var hs-var">env1_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057950"><span class="hs-identifier hs-var">env1_ids</span></a></span><span>
</span><span id="line-1125"></span><span>        </span><span id="local-6989586621682057952"><span class="annot"><span class="annottext">in_pair_ty :: Type
</span><a href="#local-6989586621682057952"><span class="hs-identifier hs-var hs-var">in_pair_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.HsToCore.Arrows.html#mkCorePairTy"><span class="hs-identifier hs-var">mkCorePairTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057951"><span class="hs-identifier hs-var">env1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var">rec_ty</span></a></span><span>
</span><span id="line-1126"></span><span>        </span><span id="local-6989586621682057953"><span class="annot"><span class="annottext">core_body :: CoreExpr
</span><a href="#local-6989586621682057953"><span class="hs-identifier hs-var hs-var">core_body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigCoreTup"><span class="hs-identifier hs-var">mkBigCoreTup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; CoreExpr) -&gt; [Id] -&gt; [CoreExpr]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
</span><a href="#local-6989586621682057954"><span class="hs-identifier hs-var">selectVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057946"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1127"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1128"></span><span>            </span><span id="local-6989586621682057954"><span class="annot"><span class="annottext">selectVar :: Id -&gt; CoreExpr
</span><a href="#local-6989586621682057954"><span class="hs-identifier hs-var hs-var">selectVar</span></a></span></span><span> </span><span id="local-6989586621682057955"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057955"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-1129"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057955"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057929"><span class="hs-identifier hs-var">rec_id_set</span></a></span><span>
</span><span id="line-1130"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; Id -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkBigTupleSelector"><span class="hs-identifier hs-var">mkBigTupleSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057926"><span class="hs-identifier hs-var">rec_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057955"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057948"><span class="hs-identifier hs-var">rec_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057948"><span class="hs-identifier hs-var">rec_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1131"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; CoreExpr
forall b. Id -&gt; Expr b
</span><a href="GHC.Core.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057955"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1132"></span><span>
</span><span id="line-1133"></span><span>    </span><span id="local-6989586621682057957"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057957"><span class="hs-identifier hs-var">squash_pair_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Id -&gt; CoreExpr -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchEnvStack"><span class="hs-identifier hs-var">matchEnvStack</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057950"><span class="hs-identifier hs-var">env1_ids</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621682057948"><span class="hs-identifier hs-var">rec_id</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057953"><span class="hs-identifier hs-var">core_body</span></a></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span>    </span><span class="hs-comment">-- loop (premap squash_pair_fn (ss &gt;&gt;&gt; arr mk_pair_fn))</span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1138"></span><span>        </span><span id="local-6989586621682057958"><span class="annot"><span class="annottext">env_ty :: Type
</span><a href="#local-6989586621682057958"><span class="hs-identifier hs-var hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057946"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-1139"></span><span>        </span><span id="local-6989586621682057959"><span class="annot"><span class="annottext">core_loop :: CoreExpr
</span><a href="#local-6989586621682057959"><span class="hs-identifier hs-var hs-var">core_loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_loop"><span class="hs-identifier hs-var">do_loop</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057921"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057951"><span class="hs-identifier hs-var">env1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057938"><span class="hs-identifier hs-var">later_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057940"><span class="hs-identifier hs-var">rec_ty</span></a></span><span>
</span><span id="line-1140"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_premap"><span class="hs-identifier hs-var">do_premap</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057921"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057952"><span class="hs-identifier hs-var">in_pair_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057958"><span class="hs-identifier hs-var">env_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057942"><span class="hs-identifier hs-var">out_pair_ty</span></a></span><span>
</span><span id="line-1141"></span><span>                        </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057957"><span class="hs-identifier hs-var">squash_pair_fn</span></a></span><span>
</span><span id="line-1142"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var">do_compose</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057921"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057958"><span class="hs-identifier hs-var">env_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057935"><span class="hs-identifier hs-var">out_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057942"><span class="hs-identifier hs-var">out_pair_ty</span></a></span><span>
</span><span id="line-1143"></span><span>                                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057944"><span class="hs-identifier hs-var">core_stmts</span></a></span><span>
</span><span id="line-1144"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_arr"><span class="hs-identifier hs-var">do_arr</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057921"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057935"><span class="hs-identifier hs-var">out_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682057942"><span class="hs-identifier hs-var">out_pair_ty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057943"><span class="hs-identifier hs-var">mk_pair_fn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet, [Id]) -&gt; DsM (CoreExpr, DIdSet, [Id])
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057959"><span class="hs-identifier hs-var">core_loop</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057949"><span class="hs-identifier hs-var">env1_id_set</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057950"><span class="hs-identifier hs-var">env1_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span>
</span><span id="line-1148"></span><span class="hs-comment">{-
A sequence of statements (as in a rec) is desugared to an arrow between
two environments (no stack)
-}</span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsfixCmdStmts"><span class="hs-identifier hs-type">dsfixCmdStmts</span></a></span><span>
</span><span id="line-1154"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>             </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-1155"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this statement</span><span>
</span><span id="line-1156"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- output vars of these statements</span><span>
</span><span id="line-1157"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CmdLStmt"><span class="hs-identifier hs-type">CmdLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- statements to desugar</span><span>
</span><span id="line-1158"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-1159"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-1160"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- same local vars as a list</span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span id="dsfixCmdStmts"><span class="annot"><span class="annottext">dsfixCmdStmts :: DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmdStmts"><span class="hs-identifier hs-var hs-var">dsfixCmdStmts</span></a></span></span><span> </span><span id="local-6989586621682057960"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057960"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057961"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057961"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057962"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057962"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span> </span><span id="local-6989586621682057963"><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057963"><span class="hs-identifier hs-var">stmts</span></a></span></span><span>
</span><span id="line-1163"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; DsM (CoreExpr, DIdSet)) -&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#trimInput"><span class="hs-identifier hs-var">trimInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdStmts"><span class="hs-identifier hs-var">dsCmdStmts</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057960"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057961"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057962"><span class="hs-identifier hs-var">out_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057963"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>   </span><span class="hs-comment">-- TODO: Add representation polymorphism check for the resulting expression.</span><span>
</span><span id="line-1165"></span><span>   </span><span class="hs-comment">-- But I (Richard E.) don't know enough about arrows to do so.</span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmts"><span class="hs-identifier hs-type">dsCmdStmts</span></a></span><span>
</span><span id="line-1168"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Arrows.html#DsCmdEnv"><span class="hs-identifier hs-type">DsCmdEnv</span></a></span><span>             </span><span class="hs-comment">-- arrow combinators</span><span>
</span><span id="line-1169"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span>                </span><span class="hs-comment">-- set of local vars available to this statement</span><span>
</span><span id="line-1170"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- output vars of these statements</span><span>
</span><span id="line-1171"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#CmdLStmt"><span class="hs-identifier hs-type">CmdLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- statements to desugar</span><span>
</span><span id="line-1172"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- list of vars in the input to these statements</span><span>
</span><span id="line-1173"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- desugared expression</span><span>
</span><span id="line-1174"></span><span>                </span><span class="annot"><a href="GHC.Types.Var.Set.html#DIdSet"><span class="hs-identifier hs-type">DIdSet</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- subset of local vars that occur free</span><span>
</span><span id="line-1175"></span><span>
</span><span id="line-1176"></span><span id="dsCmdStmts"><span class="annot"><span class="annottext">dsCmdStmts :: DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdStmts"><span class="hs-identifier hs-var hs-var">dsCmdStmts</span></a></span></span><span> </span><span id="local-6989586621682057965"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057965"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057966"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057966"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057967"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057967"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621682057968"><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057968"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621682057969"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057969"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span>
</span><span id="line-1177"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; CmdLStmt (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdLStmt"><span class="hs-identifier hs-var">dsCmdLStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057965"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057966"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057967"><span class="hs-identifier hs-var">out_ids</span></a></span><span> </span><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057968"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057969"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmts"><span class="hs-identifier hs-var">dsCmdStmts</span></a></span><span> </span><span id="local-6989586621682057970"><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057970"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621682057971"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057971"><span class="hs-identifier hs-var">local_vars</span></a></span></span><span> </span><span id="local-6989586621682057972"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057972"><span class="hs-identifier hs-var">out_ids</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057973"><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057973"><span class="hs-identifier hs-var">stmt</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682057974"><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057974"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057975"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057975"><span class="hs-identifier hs-var">env_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1180"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057976"><span class="annot"><span class="annottext">bound_vars :: VarSet
</span><a href="#local-6989586621682057976"><span class="hs-identifier hs-var hs-var">bound_vars</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; LStmtLR
     (GhcPass 'Typechecked)
     (GhcPass 'Typechecked)
     (LocatedA (HsCmd (GhcPass 'Typechecked)))
-&gt; [IdP (GhcPass 'Typechecked)]
forall (idL :: Pass) (idR :: Pass) body.
CollectPass (GhcPass idL) =&gt;
CollectFlag (GhcPass idL)
-&gt; LStmtLR (GhcPass idL) (GhcPass idR) body -&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLStmtBinders"><span class="hs-identifier hs-var">collectLStmtBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
LStmtLR
  (GhcPass 'Typechecked)
  (GhcPass 'Typechecked)
  (LocatedA (HsCmd (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682057973"><span class="hs-identifier hs-var">stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1181"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682057977"><span class="annot"><span class="annottext">local_vars' :: VarSet
</span><a href="#local-6989586621682057977"><span class="hs-identifier hs-var hs-var">local_vars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057976"><span class="hs-identifier hs-var">bound_vars</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057971"><span class="hs-identifier hs-var">local_vars</span></a></span><span>
</span><span id="line-1182"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057978"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057978"><span class="hs-identifier hs-var">core_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057979"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057979"><span class="hs-identifier hs-var">_fv_stmts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057980"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057980"><span class="hs-identifier hs-var">env_ids'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; [CmdLStmt (GhcPass 'Typechecked)]
-&gt; DsM (CoreExpr, DIdSet, [Id])
</span><a href="GHC.HsToCore.Arrows.html#dsfixCmdStmts"><span class="hs-identifier hs-var">dsfixCmdStmts</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057970"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057977"><span class="hs-identifier hs-var">local_vars'</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057972"><span class="hs-identifier hs-var">out_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[CmdLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057974"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-1183"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621682057981"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057981"><span class="hs-identifier hs-var">core_stmt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682057982"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057982"><span class="hs-identifier hs-var">fv_stmt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; VarSet
-&gt; [Id]
-&gt; CmdLStmt (GhcPass 'Typechecked)
-&gt; [Id]
-&gt; DsM (CoreExpr, DIdSet)
</span><a href="GHC.HsToCore.Arrows.html#dsCmdLStmt"><span class="hs-identifier hs-var">dsCmdLStmt</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057970"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682057971"><span class="hs-identifier hs-var">local_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057980"><span class="hs-identifier hs-var">env_ids'</span></a></span><span> </span><span class="annot"><span class="annottext">CmdLStmt (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057973"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057975"><span class="hs-identifier hs-var">env_ids</span></a></span><span>
</span><span id="line-1184"></span><span>    </span><span class="annot"><span class="annottext">(CoreExpr, DIdSet) -&gt; DsM (CoreExpr, DIdSet)
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DsCmdEnv
-&gt; Type -&gt; Type -&gt; Type -&gt; CoreExpr -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#do_compose"><span class="hs-identifier hs-var">do_compose</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><a href="#local-6989586621682057970"><span class="hs-identifier hs-var">ids</span></a></span><span>
</span><span id="line-1185"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057975"><span class="hs-identifier hs-var">env_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057980"><span class="hs-identifier hs-var">env_ids'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1187"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Type
</span><a href="GHC.Core.Make.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621682057972"><span class="hs-identifier hs-var">out_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1188"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057981"><span class="hs-identifier hs-var">core_stmt</span></a></span><span>
</span><span id="line-1189"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057978"><span class="hs-identifier hs-var">core_stmts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1190"></span><span>              </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621682057982"><span class="hs-identifier hs-var">fv_stmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#dsCmdStmts"><span class="hs-identifier hs-var">dsCmdStmts</span></a></span><span> </span><span class="annot"><span class="annottext">DsCmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DsM (CoreExpr, DIdSet)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dsCmdStmts []&quot;</span></span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span class="hs-comment">-- Match a list of expressions against a list of patterns, left-to-right.</span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#matchSimplys"><span class="hs-identifier hs-type">matchSimplys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- Scrutinees</span><span>
</span><span id="line-1197"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>    </span><span class="hs-comment">-- Match kind</span><span>
</span><span id="line-1198"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- Patterns they should match</span><span>
</span><span id="line-1199"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>                </span><span class="hs-comment">-- Return this if they all match</span><span>
</span><span id="line-1200"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>                </span><span class="hs-comment">-- Return this if they don't</span><span>
</span><span id="line-1201"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-1202"></span><span id="matchSimplys"><span class="annot"><span class="annottext">matchSimplys :: [CoreExpr]
-&gt; HsMatchContext GhcRn
-&gt; [LPat (GhcPass 'Typechecked)]
-&gt; CoreExpr
-&gt; CoreExpr
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchSimplys"><span class="hs-identifier hs-var hs-var">matchSimplys</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682057983"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621682057983"><span class="hs-identifier hs-var">_ctxt</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621682057984"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057984"><span class="hs-identifier hs-var">result_expr</span></a></span></span><span> </span><span id="local-6989586621682057985"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057985"><span class="hs-identifier hs-var">_fail_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; DsM CoreExpr
forall a. a -&gt; IOEnv (Env DsGblEnv DsLclEnv) a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057984"><span class="hs-identifier hs-var">result_expr</span></a></span><span>
</span><span id="line-1203"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#matchSimplys"><span class="hs-identifier hs-var">matchSimplys</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057986"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057986"><span class="hs-identifier hs-var">exp</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682057987"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057987"><span class="hs-identifier hs-var">exps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057988"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621682057988"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682057989"><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057989"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682057990"><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057990"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621682057991"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057991"><span class="hs-identifier hs-var">result_expr</span></a></span></span><span> </span><span id="local-6989586621682057992"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057992"><span class="hs-identifier hs-var">fail_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1204"></span><span>    </span><span id="local-6989586621682057993"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057993"><span class="hs-identifier hs-var">match_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
-&gt; HsMatchContext GhcRn
-&gt; [LPat (GhcPass 'Typechecked)]
-&gt; CoreExpr
-&gt; CoreExpr
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Arrows.html#matchSimplys"><span class="hs-identifier hs-var">matchSimplys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621682057987"><span class="hs-identifier hs-var">exps</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621682057988"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057990"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057991"><span class="hs-identifier hs-var">result_expr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057992"><span class="hs-identifier hs-var">fail_expr</span></a></span><span>
</span><span id="line-1205"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr
-&gt; HsMatchContext GhcRn
-&gt; LPat (GhcPass 'Typechecked)
-&gt; CoreExpr
-&gt; CoreExpr
-&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Match.html#matchSimply"><span class="hs-identifier hs-var">matchSimply</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057986"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621682057988"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057989"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057993"><span class="hs-identifier hs-var">match_code</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621682057992"><span class="hs-identifier hs-var">fail_expr</span></a></span><span>
</span><span id="line-1206"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#matchSimplys"><span class="hs-identifier hs-var">matchSimplys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; DsM CoreExpr
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchSimplys&quot;</span></span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span class="hs-comment">-- List of leaf expressions, with set of variables bound in each</span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span id="local-6989586621682056840"><span class="annot"><a href="GHC.HsToCore.Arrows.html#leavesMatch"><span class="hs-identifier hs-type">leavesMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056840"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056840"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-1212"></span><span id="leavesMatch"><span class="annot"><span class="annottext">leavesMatch :: forall (body :: * -&gt; *).
LMatch
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
-&gt; [(LocatedA (body (GhcPass 'Typechecked)), VarSet)]
</span><a href="GHC.HsToCore.Arrows.html#leavesMatch"><span class="hs-identifier hs-var hs-var">leavesMatch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">Anno
  (Match
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_pats :: forall p body. Match p body -&gt; [LPat p]
</span><a href="Language.Haskell.Syntax.Expr.html#m_pats"><span class="hs-identifier hs-var">m_pats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682057997"><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057997"><span class="hs-identifier hs-var">pats</span></a></span></span><span>
</span><span id="line-1213"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">m_grhss :: forall p body. Match p body -&gt; GRHSs p body
</span><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHSs
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682057998"><span class="annot"><span class="annottext">[LGRHS
   (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))]
</span><a href="#local-6989586621682057998"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span id="local-6989586621682057999"><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057999"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1215"></span><span>        </span><span id="local-6989586621682058000"><span class="annot"><span class="annottext">defined_vars :: VarSet
</span><a href="#local-6989586621682058000"><span class="hs-identifier hs-var hs-var">defined_vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; [LPat (GhcPass 'Typechecked)] -&gt; [IdP (GhcPass 'Typechecked)]
forall p. CollectPass p =&gt; CollectFlag p -&gt; [LPat p] -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectPatsBinders"><span class="hs-identifier hs-var">collectPatsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682057997"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>                        </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span>
</span><span id="line-1217"></span><span>                       </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; HsLocalBinds (GhcPass 'Typechecked)
-&gt; [IdP (GhcPass 'Typechecked)]
forall (idL :: Pass) (idR :: Pass).
CollectPass (GhcPass idL) =&gt;
CollectFlag (GhcPass idL)
-&gt; HsLocalBindsLR (GhcPass idL) (GhcPass idR)
-&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLocalBinders"><span class="hs-identifier hs-var">collectLocalBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682057999"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-1219"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocatedA (body (GhcPass 'Typechecked))
</span><a href="#local-6989586621682058001"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1220"></span><span>      </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
-&gt; [LStmtLR
      (GhcPass 'Typechecked)
      (GhcPass 'Typechecked)
      (LocatedA (HsExpr (GhcPass 'Typechecked)))]
-&gt; [IdP (GhcPass 'Typechecked)]
forall (idL :: Pass) (idR :: Pass) body.
CollectPass (GhcPass idL) =&gt;
CollectFlag (GhcPass idL)
-&gt; [LStmtLR (GhcPass idL) (GhcPass idR) body]
-&gt; [IdP (GhcPass idL)]
</span><a href="GHC.Hs.Utils.html#collectLStmtsBinders"><span class="hs-identifier hs-var">collectLStmtsBinders</span></a></span><span> </span><span class="annot"><span class="annottext">CollectFlag (GhcPass 'Typechecked)
</span><a href="GHC.Hs.Utils.html#CollWithDictBinders"><span class="hs-identifier hs-var">CollWithDictBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt (GhcPass 'Typechecked)]
[LStmtLR
   (GhcPass 'Typechecked)
   (GhcPass 'Typechecked)
   (LocatedA (HsExpr (GhcPass 'Typechecked)))]
</span><a href="#local-6989586621682058003"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>        </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621682058000"><span class="hs-identifier hs-var">defined_vars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">Anno
  (GRHS
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHS
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682058003"><span class="annot"><span class="annottext">[GuardLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682058003"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span id="local-6989586621682058001"><span class="annot"><span class="annottext">LocatedA (body (GhcPass 'Typechecked))
</span><a href="#local-6989586621682058001"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LGRHS
   (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))]
[GenLocated
   (Anno
      (GRHS
         (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
   (GRHS
      (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682057998"><span class="hs-identifier hs-var">grhss</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span class="hs-comment">-- Replace the leaf commands in a match</span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span id="local-6989586621682056862"><span id="local-6989586621682056863"><span class="annot"><a href="GHC.HsToCore.Arrows.html#replaceLeavesMatch"><span class="hs-identifier hs-type">replaceLeavesMatch</span></a></span><span>
</span><span id="line-1227"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056862"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056863"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056862"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056863"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>                                 </span><span class="hs-comment">-- new result type</span><span>
</span><span id="line-1230"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056862"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- replacement leaf expressions of that type</span><span>
</span><span id="line-1231"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056863"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- the matches of a case command</span><span>
</span><span id="line-1232"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056862"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- remaining leaf expressions</span><span>
</span><span id="line-1233"></span><span>            </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LMatch"><span class="hs-identifier hs-type">LMatch</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056862"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span> </span><span class="hs-comment">-- updated match</span><span>
</span><span id="line-1234"></span><span id="replaceLeavesMatch"><span class="annot"><span class="annottext">replaceLeavesMatch :: forall (body' :: * -&gt; *) (body :: * -&gt; *).
(Anno
   (Match
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (Match
        (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))),
 Anno
   (GRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (GRHS
        (GhcPass 'Typechecked)
        (LocatedA (body (GhcPass 'Typechecked))))) =&gt;
Type
-&gt; [LocatedA (body' (GhcPass 'Typechecked))]
-&gt; LMatch
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    LMatch
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
</span><a href="GHC.HsToCore.Arrows.html#replaceLeavesMatch"><span class="hs-identifier hs-var hs-var">replaceLeavesMatch</span></a></span></span><span> </span><span id="local-6989586621682058013"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621682058013"><span class="hs-identifier hs-var">_res_ty</span></a></span></span><span> </span><span id="local-6989586621682058014"><span class="annot"><span class="annottext">[LocatedA (body' (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682058014"><span class="hs-identifier hs-var">leaves</span></a></span></span><span>
</span><span id="line-1235"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682058015"><span class="annot"><span class="annottext">Anno
  (Match
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
</span><a href="#local-6989586621682058015"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-1236"></span><span>                          </span><span id="local-6989586621682058016"><span class="annot"><span class="annottext">match :: Match
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682058016"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">m_grhss :: forall p body. Match p body -&gt; GRHSs p body
</span><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span id="local-6989586621682058017"><span class="annot"><span class="annottext">XCGRHSs
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682058017"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682058018"><span class="annot"><span class="annottext">[LGRHS
   (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))]
</span><a href="#local-6989586621682058018"><span class="hs-identifier hs-var">grhss</span></a></span></span><span> </span><span id="local-6989586621682058019"><span class="annot"><span class="annottext">HsLocalBinds (GhcPass 'Typechecked)
</span><a href="#local-6989586621682058019"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-1238"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682058020"><span class="annot"><span class="annottext">[LocatedA (body' (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682058020"><span class="hs-identifier hs-var">leaves'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682058021"><span class="annot"><span class="annottext">[GenLocated
   (Anno
      (GRHS
         (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
   (GRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682058021"><span class="hs-identifier hs-var">grhss'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([LocatedA (body' (GhcPass 'Typechecked))]
 -&gt; GenLocated
      (Anno
         (GRHS
            (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
      (GRHS
         (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
 -&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
     GenLocated
       (Anno
          (GRHS
             (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
       (GRHS
          (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))))
-&gt; [LocatedA (body' (GhcPass 'Typechecked))]
-&gt; [GenLocated
      (Anno
         (GRHS
            (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
      (GRHS
         (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))]
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    [GenLocated
       (Anno
          (GRHS
             (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
       (GRHS
          (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapAccumL/Data.Traversable.html#mapAccumL"><span class="hs-identifier hs-var">mapAccumL</span></a></span><span> </span><span class="annot"><span class="annottext">[LocatedA (body' (GhcPass 'Typechecked))]
-&gt; LGRHS
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    LGRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
[LocatedA (body' (GhcPass 'Typechecked))]
-&gt; GenLocated
     (Anno
        (GRHS
           (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
     (GRHS
        (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    GenLocated
      (Anno
         (GRHS
            (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
      (GRHS
         (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked)))))
forall (body' :: * -&gt; *) (body :: * -&gt; *).
(Anno
   (Match
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (Match
        (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))),
 Anno
   (GRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (GRHS
        (GhcPass 'Typechecked)
        (LocatedA (body (GhcPass 'Typechecked))))) =&gt;
[LocatedA (body' (GhcPass 'Typechecked))]
-&gt; LGRHS
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    LGRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
</span><a href="GHC.HsToCore.Arrows.html#replaceLeavesGRHS"><span class="hs-identifier hs-var">replaceLeavesGRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[LocatedA (body' (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682058014"><span class="hs-identifier hs-var">leaves</span></a></span><span> </span><span class="annot"><span class="annottext">[LGRHS
   (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))]
[GenLocated
   (Anno
      (GRHS
         (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
   (GRHS
      (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))]
</span><a href="#local-6989586621682058018"><span class="hs-identifier hs-var">grhss</span></a></span><span>
</span><span id="line-1239"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-1240"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocatedA (body' (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682058020"><span class="hs-identifier hs-var">leaves'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Anno
  (Match
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
-&gt; Match
     (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked)))
-&gt; GenLocated
     (Anno
        (Match
           (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
     (Match
        (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">Anno
  (Match
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
</span><a href="#local-6989586621682058015"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Match
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682058016"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#m_ext"><span class="hs-identifier hs-var">m_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-type">noAnn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#m_grhss"><span class="hs-identifier hs-var">m_grhss</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058017"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058021"><span class="hs-identifier hs-type">grhss'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682058019"><span class="hs-identifier hs-type">binds</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span id="local-6989586621682056898"><span id="local-6989586621682056899"><span class="annot"><a href="GHC.HsToCore.Arrows.html#replaceLeavesGRHS"><span class="hs-identifier hs-type">replaceLeavesGRHS</span></a></span><span>
</span><span id="line-1243"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056898"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056899"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056898"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Extension.html#Anno"><span class="hs-identifier hs-type">Anno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056899"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056898"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- replacement leaf expressions of that type</span><span>
</span><span id="line-1246"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LGRHS"><span class="hs-identifier hs-type">LGRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056899"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- rhss of a case command</span><span>
</span><span id="line-1247"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056898"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>              </span><span class="hs-comment">-- remaining leaf expressions</span><span>
</span><span id="line-1248"></span><span>            </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LGRHS"><span class="hs-identifier hs-type">LGRHS</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedA"><span class="hs-identifier hs-type">LocatedA</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056898"><span class="hs-identifier hs-type">body'</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>  </span><span class="hs-comment">-- updated GRHS</span><span>
</span><span id="line-1249"></span><span id="replaceLeavesGRHS"><span class="annot"><span class="annottext">replaceLeavesGRHS :: forall (body' :: * -&gt; *) (body :: * -&gt; *).
(Anno
   (Match
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (Match
        (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))),
 Anno
   (GRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
 ~ Anno
     (GRHS
        (GhcPass 'Typechecked)
        (LocatedA (body (GhcPass 'Typechecked))))) =&gt;
[LocatedA (body' (GhcPass 'Typechecked))]
-&gt; LGRHS
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    LGRHS
      (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
</span><a href="GHC.HsToCore.Arrows.html#replaceLeavesGRHS"><span class="hs-identifier hs-var hs-var">replaceLeavesGRHS</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058030"><span class="annot"><span class="annottext">LocatedA (body' (GhcPass 'Typechecked))
</span><a href="#local-6989586621682058030"><span class="hs-identifier hs-var">leaf</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682058031"><span class="annot"><span class="annottext">[LocatedA (body' (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682058031"><span class="hs-identifier hs-var">leaves</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621682058032"><span class="annot"><span class="annottext">Anno
  (GRHS
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
</span><a href="#local-6989586621682058032"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-type">GRHS</span></a></span><span> </span><span id="local-6989586621682058033"><span class="annot"><span class="annottext">XCGRHS
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682058033"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682058034"><span class="annot"><span class="annottext">[GuardLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682058034"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="annot"><span class="annottext">LocatedA (body (GhcPass 'Typechecked))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LocatedA (body' (GhcPass 'Typechecked))]
</span><a href="#local-6989586621682058031"><span class="hs-identifier hs-var">leaves</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Anno
  (GRHS
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
-&gt; GRHS
     (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked)))
-&gt; GenLocated
     (Anno
        (GRHS
           (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
     (GRHS
        (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked))))
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">Anno
  (GRHS
     (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked))))
</span><a href="#local-6989586621682058032"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCGRHS
  (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked)))
-&gt; [GuardLStmt (GhcPass 'Typechecked)]
-&gt; LocatedA (body' (GhcPass 'Typechecked))
-&gt; GRHS
     (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked)))
forall p body.
XCGRHS p body -&gt; [GuardLStmt p] -&gt; body -&gt; GRHS p body
</span><a href="Language.Haskell.Syntax.Expr.html#GRHS"><span class="hs-identifier hs-var">GRHS</span></a></span><span> </span><span class="annot"><span class="annottext">XCGRHS
  (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked)))
XCGRHS
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><a href="#local-6989586621682058033"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[GuardLStmt (GhcPass 'Typechecked)]
</span><a href="#local-6989586621682058034"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">LocatedA (body' (GhcPass 'Typechecked))
</span><a href="#local-6989586621682058030"><span class="hs-identifier hs-var">leaf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#replaceLeavesGRHS"><span class="hs-identifier hs-var">replaceLeavesGRHS</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">LGRHS
  (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; ([LocatedA (body' (GhcPass 'Typechecked))],
    GenLocated
      (Anno
         (GRHS
            (GhcPass 'Typechecked) (LocatedA (body (GhcPass 'Typechecked)))))
      (GRHS
         (GhcPass 'Typechecked) (LocatedA (body' (GhcPass 'Typechecked)))))
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;replaceLeavesGRHS []&quot;</span></span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span class="hs-comment">-- Balanced fold of a non-empty list.</span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span id="local-6989586621682056849"><span class="annot"><a href="GHC.HsToCore.Arrows.html#foldb"><span class="hs-identifier hs-type">foldb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682056849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056849"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#NonEmpty/GHC.Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682056849"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1256"></span><span id="foldb"><span class="annot"><span class="annottext">foldb :: forall a. (a -&gt; a -&gt; a) -&gt; NonEmpty a -&gt; a
</span><a href="GHC.HsToCore.Arrows.html#foldb"><span class="hs-identifier hs-var hs-var">foldb</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058035"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058035"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#%3A%7C/GHC.Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058035"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1257"></span><span class="annot"><a href="GHC.HsToCore.Arrows.html#foldb"><span class="hs-identifier hs-var">foldb</span></a></span><span> </span><span id="local-6989586621682058037"><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621682058037"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621682058038"><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621682058038"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; NonEmpty a -&gt; a
forall a. (a -&gt; a -&gt; a) -&gt; NonEmpty a -&gt; a
</span><a href="GHC.HsToCore.Arrows.html#foldb"><span class="hs-identifier hs-var">foldb</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621682058037"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty a -&gt; NonEmpty a
</span><a href="#local-6989586621682058039"><span class="hs-identifier hs-var">fold_pairs</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621682058038"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1259"></span><span>    </span><span id="local-6989586621682058039"><span class="annot"><span class="annottext">fold_pairs :: NonEmpty a -&gt; NonEmpty a
</span><a href="#local-6989586621682058039"><span class="hs-identifier hs-var hs-var">fold_pairs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682058040"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058040"><span class="hs-identifier hs-var">x1</span></a></span></span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#%3A%7C/GHC.Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span id="local-6989586621682058041"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058041"><span class="hs-identifier hs-var">x2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682058042"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682058042"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
</span><a href="#local-6989586621682058037"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058040"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682058041"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; NonEmpty a
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%3A%7C/GHC.Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty a -&gt; NonEmpty a) -&gt; [a] -&gt; [a]
forall a. (NonEmpty a -&gt; NonEmpty a) -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621682058043"><span class="hs-identifier hs-var">keep_empty</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; NonEmpty a
</span><a href="#local-6989586621682058039"><span class="hs-identifier hs-var">fold_pairs</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621682058042"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1260"></span><span>    </span><span class="annot"><a href="#local-6989586621682058039"><span class="hs-identifier hs-var">fold_pairs</span></a></span><span> </span><span id="local-6989586621682058044"><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621682058044"><span class="hs-identifier hs-var">xs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty a
</span><a href="#local-6989586621682058044"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1261"></span><span>
</span><span id="line-1262"></span><span>    </span><span id="local-6989586621682056909"><span class="annot"><a href="#local-6989586621682058043"><span class="hs-identifier hs-type">keep_empty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#NonEmpty/GHC.Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056909"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#NonEmpty/GHC.Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682056909"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682056909"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621682056909"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-1263"></span><span>    </span><span id="local-6989586621682058043"><span class="annot"><span class="annottext">keep_empty :: forall a. (NonEmpty a -&gt; NonEmpty a) -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621682058043"><span class="hs-identifier hs-var hs-var">keep_empty</span></a></span></span><span> </span><span id="local-6989586621682058047"><span class="annot"><span class="annottext">NonEmpty a -&gt; NonEmpty a
</span><a href="#local-6989586621682058047"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; (NonEmpty a -&gt; [a]) -&gt; Maybe (NonEmpty a) -&gt; [a]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty a -&gt; [a]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#toList/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty a -&gt; [a])
-&gt; (NonEmpty a -&gt; NonEmpty a) -&gt; NonEmpty a -&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; NonEmpty a
</span><a href="#local-6989586621682058047"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (NonEmpty a) -&gt; [a])
-&gt; ([a] -&gt; Maybe (NonEmpty a)) -&gt; [a] -&gt; [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe (NonEmpty a)
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.18.2.1/src/Data.List.NonEmpty.html#nonEmpty/Data.List.NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">nonEmpty</span></a></span><span>
</span><span id="line-1264"></span></pre></body></html>