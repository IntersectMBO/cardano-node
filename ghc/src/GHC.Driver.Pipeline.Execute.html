<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span class="hs-cpp">
#include &lt;ghcplatform.h&gt;
</span><span>
</span><span id="line-10"></span><span class="hs-comment">{- Functions for providing the default interpretation of the 'TPhase' actions
-}</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.Pipeline.Execute</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#/Control.Monad.IO.Class.html"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#/Control.Monad.Catch.html"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#/Control.Monad.Trans.Reader.html"><span class="hs-identifier">Control.Monad.Trans.Reader</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html"><span class="hs-identifier">GHC.Driver.Pipeline.Monad</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html"><span class="hs-identifier">GHC.Driver.Pipeline.Phases</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#Hsc"><span class="hs-identifier">Hsc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html"><span class="hs-identifier">GHC.Unit.Module.Location</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html"><span class="hs-identifier">GHC.Driver.Phases</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html"><span class="hs-identifier">GHC.Unit.Types</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html"><span class="hs-identifier">GHC.Types.SourceFile</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html"><span class="hs-identifier">GHC.Unit.Module.Status</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html"><span class="hs-identifier">GHC.Unit.Module.ModIface</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html"><span class="hs-identifier">GHC.Driver.Backend</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.CmdLine.html"><span class="hs-identifier">GHC.Driver.CmdLine</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html"><span class="hs-identifier">GHC.Unit.Module.ModSummary</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.6/src/GHC.LanguageExtensions.html#/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html"><span class="hs-identifier">GHC.Driver.Main</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Error.html"><span class="hs-identifier">GHC.Types.Error</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html"><span class="hs-identifier">GHC.Driver.Errors.Types</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Fingerprint.html#/GHC.Fingerprint.html"><span class="hs-identifier">GHC.Fingerprint</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html"><span class="hs-identifier">GHC.Utils.TmpFs</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.html"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.List.html#/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/Data.OldList.html#intercalate/Data.OldList.html#intercalate"><span class="hs-identifier">intercalate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.OldList.html#isInfixOf/Data.OldList.html#isInfixOf"><span class="hs-identifier">isInfixOf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html"><span class="hs-identifier">GHC.Unit.Env</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Maybe.html#/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToLlvm.Mangler.html"><span class="hs-identifier">GHC.CmmToLlvm.Mangler</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.html"><span class="hs-identifier">GHC.SysTools</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.Cpp.html"><span class="hs-identifier">GHC.SysTools.Cpp</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.Plain.html"><span class="hs-identifier">GHC.Utils.Panic.Plain</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory-1.3.8.5/src/System.Directory.html#/System.Directory.html"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../template-haskell-2.20.0.0/src/System.FilePath.html#/System.FilePath.html"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html"><span class="hs-identifier">GHC.Unit.Info</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.html"><span class="hs-identifier">GHC.Unit.Home</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html"><span class="hs-identifier">GHC.Iface.Make</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Parser.html"><span class="hs-identifier">GHC.Driver.Config.Parser</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Header.html"><span class="hs-identifier">GHC.Parser.Header</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html"><span class="hs-identifier">GHC.Data.StringBuffer</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceError.html"><span class="hs-identifier">GHC.Types.SourceError</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Finder.html"><span class="hs-identifier">GHC.Unit.Finder</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.IORef.html#/Data.IORef.html"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.LlvmConfigCache.html"><span class="hs-identifier">GHC.Driver.LlvmConfigCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.LlvmConfigCache.html#readLlvmConfigCache"><span class="hs-identifier">readLlvmConfigCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToLlvm.Config.html"><span class="hs-identifier">GHC.CmmToLlvm.Config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToLlvm.Config.html#LlvmTarget"><span class="hs-identifier">LlvmTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToLlvm.Config.html#LlvmConfig"><span class="hs-identifier">LlvmConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html"><span class="hs-identifier">GHC.Driver.Pipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier">compileForeign</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileEmptyStub"><span class="hs-identifier">compileEmptyStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.html"><span class="hs-identifier">GHC.Settings</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/System.IO.html#/System.IO.html"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.ExtraObj.html"><span class="hs-identifier">GHC.Linker.ExtraObj</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Linker.Dynamic.html"><span class="hs-identifier">GHC.Linker.Dynamic</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Env.html"><span class="hs-identifier">GHC.Unit.Module.Env</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html"><span class="hs-identifier">GHC.Driver.Env.KnotVars</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Finder.html"><span class="hs-identifier">GHC.Driver.Config.Finder</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Names.html"><span class="hs-identifier">GHC.Rename.Names</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html"><span class="hs-identifier">GHC.StgToJS.Linker.Linker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToJS.Linker.Linker.html#embedJsFile"><span class="hs-identifier">embedJsFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html"><span class="hs-identifier">Language.Haskell.Syntax.Module.Name</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html"><span class="hs-identifier">GHC.Unit.Home.ModInfo</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html"><span class="hs-identifier">GHC.Runtime.Loader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier">initializePlugins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">newtype</span><span> </span><span id="HookedUse"><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#HookedUse"><span class="hs-identifier hs-var">HookedUse</span></a></span></span><span> </span><span id="local-6989586621682082835"><span class="annot"><a href="#local-6989586621682082835"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HookedUse"><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#HookedUse"><span class="hs-identifier hs-var">HookedUse</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="runHookedUse"><span class="annot"><span class="annottext">forall a. HookedUse a -&gt; (Hooks, PhaseHook) -&gt; IO a
</span><a href="GHC.Driver.Pipeline.Execute.html#runHookedUse"><span class="hs-identifier hs-var hs-var">runHookedUse</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Hooks.html#Hooks"><span class="hs-identifier hs-type">Hooks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#PhaseHook"><span class="hs-identifier hs-type">PhaseHook</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682082835"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682083286"><span id="local-6989586621682083292"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b)
-&gt; (forall a b. a -&gt; HookedUse b -&gt; HookedUse a)
-&gt; Functor HookedUse
forall a b. a -&gt; HookedUse b -&gt; HookedUse a
forall a b. (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b
fmap :: forall a b. (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b
$c&lt;$ :: forall a b. a -&gt; HookedUse b -&gt; HookedUse a
&lt;$ :: forall a b. a -&gt; HookedUse b -&gt; HookedUse a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#Functor/GHC.Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083302"><span id="local-6989586621682083307"><span id="local-6989586621682083311"><span id="local-6989586621682083315"><span id="local-6989586621682083319"><span class="annot"><span class="annottext">Functor HookedUse
Functor HookedUse =&gt;
(forall a. a -&gt; HookedUse a)
-&gt; (forall a b. HookedUse (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; HookedUse a -&gt; HookedUse b -&gt; HookedUse c)
-&gt; (forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b)
-&gt; (forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse a)
-&gt; Applicative HookedUse
forall a. a -&gt; HookedUse a
forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse a
forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b
forall a b. HookedUse (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b
forall a b c.
(a -&gt; b -&gt; c) -&gt; HookedUse a -&gt; HookedUse b -&gt; HookedUse c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
$cpure :: forall a. a -&gt; HookedUse a
pure :: forall a. a -&gt; HookedUse a
$c&lt;*&gt; :: forall a b. HookedUse (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b
&lt;*&gt; :: forall a b. HookedUse (a -&gt; b) -&gt; HookedUse a -&gt; HookedUse b
$cliftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; HookedUse a -&gt; HookedUse b -&gt; HookedUse c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; HookedUse a -&gt; HookedUse b -&gt; HookedUse c
$c*&gt; :: forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b
*&gt; :: forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b
$c&lt;* :: forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse a
&lt;* :: forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#Applicative/GHC.Base.html#Applicative"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083327"><span id="local-6989586621682083332"><span id="local-6989586621682083336"><span class="annot"><span class="annottext">Applicative HookedUse
Applicative HookedUse =&gt;
(forall a b. HookedUse a -&gt; (a -&gt; HookedUse b) -&gt; HookedUse b)
-&gt; (forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b)
-&gt; (forall a. a -&gt; HookedUse a)
-&gt; Monad HookedUse
forall a. a -&gt; HookedUse a
forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b
forall a b. HookedUse a -&gt; (a -&gt; HookedUse b) -&gt; HookedUse b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall a b. HookedUse a -&gt; (a -&gt; HookedUse b) -&gt; HookedUse b
&gt;&gt;= :: forall a b. HookedUse a -&gt; (a -&gt; HookedUse b) -&gt; HookedUse b
$c&gt;&gt; :: forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b
&gt;&gt; :: forall a b. HookedUse a -&gt; HookedUse b -&gt; HookedUse b
$creturn :: forall a. a -&gt; HookedUse a
return :: forall a. a -&gt; HookedUse a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#Monad/GHC.Base.html#Monad"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083344"><span class="annot"><span class="annottext">Monad HookedUse
Monad HookedUse =&gt;
(forall a. IO a -&gt; HookedUse a) -&gt; MonadIO HookedUse
forall a. IO a -&gt; HookedUse a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall a. IO a -&gt; m a) -&gt; MonadIO m
$cliftIO :: forall a. IO a -&gt; HookedUse a
liftIO :: forall a. IO a -&gt; HookedUse a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#MonadIO/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadIO</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083358"><span class="annot"><span class="annottext">Monad HookedUse
Monad HookedUse =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; HookedUse a)
-&gt; MonadThrow HookedUse
forall e a. (HasCallStack, Exception e) =&gt; e -&gt; HookedUse a
forall (m :: * -&gt; *).
Monad m =&gt;
(forall e a. (HasCallStack, Exception e) =&gt; e -&gt; m a)
-&gt; MonadThrow m
$cthrowM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; HookedUse a
throwM :: forall e a. (HasCallStack, Exception e) =&gt; e -&gt; HookedUse a
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#MonadThrow/Control.Monad.Catch.html#MonadThrow"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083379"><span class="annot"><span class="annottext">MonadThrow HookedUse
MonadThrow HookedUse =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 HookedUse a -&gt; (e -&gt; HookedUse a) -&gt; HookedUse a)
-&gt; MonadCatch HookedUse
forall e a.
(HasCallStack, Exception e) =&gt;
HookedUse a -&gt; (e -&gt; HookedUse a) -&gt; HookedUse a
forall (m :: * -&gt; *).
MonadThrow m =&gt;
(forall e a.
 (HasCallStack, Exception e) =&gt;
 m a -&gt; (e -&gt; m a) -&gt; m a)
-&gt; MonadCatch m
$ccatch :: forall e a.
(HasCallStack, Exception e) =&gt;
HookedUse a -&gt; (e -&gt; HookedUse a) -&gt; HookedUse a
catch :: forall e a.
(HasCallStack, Exception e) =&gt;
HookedUse a -&gt; (e -&gt; HookedUse a) -&gt; HookedUse a
</span><a href="../../exceptions-0.10.7/src/Control.Monad.Catch.html#MonadCatch/Control.Monad.Catch.html#MonadCatch"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">MonadCatch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Hooks.html#Hooks"><span class="hs-identifier hs-type">Hooks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#PhaseHook"><span class="hs-identifier hs-type">PhaseHook</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#MonadUse"><span class="hs-identifier hs-type">MonadUse</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#TPhase"><span class="hs-identifier hs-type">TPhase</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#HookedUse"><span class="hs-identifier hs-type">HookedUse</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621682083395"><span class="annot"><span class="annottext">use :: forall a. TPhase a -&gt; HookedUse a
</span><a href="#local-6989586621682083395"><span class="hs-identifier hs-var hs-var hs-var hs-var">use</span></a></span></span><span> </span><span id="local-6989586621682083397"><span class="annot"><span class="annottext">TPhase a
</span><a href="#local-6989586621682083397"><span class="hs-identifier hs-var">fa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Hooks, PhaseHook) -&gt; IO a) -&gt; HookedUse a
forall a. ((Hooks, PhaseHook) -&gt; IO a) -&gt; HookedUse a
</span><a href="GHC.Driver.Pipeline.Execute.html#HookedUse"><span class="hs-identifier hs-var">HookedUse</span></a></span><span> </span><span class="annot"><span class="annottext">(((Hooks, PhaseHook) -&gt; IO a) -&gt; HookedUse a)
-&gt; ((Hooks, PhaseHook) -&gt; IO a) -&gt; HookedUse a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682083398"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621682083398"><span class="hs-identifier hs-var">hooks</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#PhaseHook"><span class="hs-identifier hs-type">PhaseHook</span></a></span><span> </span><span id="local-6989586621682083400"><span class="annot"><span class="annottext">forall a. TPhase a -&gt; IO a
</span><a href="#local-6989586621682083400"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Hooks -&gt; Maybe PhaseHook
</span><a href="GHC.Driver.Hooks.html#runPhaseHook"><span class="hs-identifier hs-var">runPhaseHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621682083398"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-92"></span><span>      </span><span class="annot"><span class="annottext">Maybe PhaseHook
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TPhase a -&gt; IO a
forall a. TPhase a -&gt; IO a
</span><a href="#local-6989586621682083400"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">TPhase a
</span><a href="#local-6989586621682083397"><span class="hs-identifier hs-var">fa</span></a></span><span>
</span><span id="line-93"></span><span>      </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#PhaseHook"><span class="hs-identifier hs-type">PhaseHook</span></a></span><span> </span><span id="local-6989586621682083402"><span class="annot"><span class="annottext">forall a. TPhase a -&gt; IO a
</span><a href="#local-6989586621682083402"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TPhase a -&gt; IO a
forall a. TPhase a -&gt; IO a
</span><a href="#local-6989586621682083402"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">TPhase a
</span><a href="#local-6989586621682083397"><span class="hs-identifier hs-var">fa</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><span class="hs-comment">-- | The default mechanism to run a pipeline, see Note [The Pipeline Monad]</span></span><span>
</span><span id="line-96"></span><span id="local-6989586621682082925"><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPipeline"><span class="hs-identifier hs-type">runPipeline</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html#Hooks"><span class="hs-identifier hs-type">Hooks</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#HookedUse"><span class="hs-identifier hs-type">HookedUse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682082925"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682082925"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-97"></span><span id="runPipeline"><span class="annot"><span class="annottext">runPipeline :: forall a. Hooks -&gt; HookedUse a -&gt; IO a
</span><a href="GHC.Driver.Pipeline.Execute.html#runPipeline"><span class="hs-identifier hs-var hs-var">runPipeline</span></a></span></span><span> </span><span id="local-6989586621682083404"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621682083404"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span id="local-6989586621682083405"><span class="annot"><span class="annottext">HookedUse a
</span><a href="#local-6989586621682083405"><span class="hs-identifier hs-var">pipeline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HookedUse a -&gt; (Hooks, PhaseHook) -&gt; IO a
forall a. HookedUse a -&gt; (Hooks, PhaseHook) -&gt; IO a
</span><a href="GHC.Driver.Pipeline.Execute.html#runHookedUse"><span class="hs-identifier hs-var">runHookedUse</span></a></span><span> </span><span class="annot"><span class="annottext">HookedUse a
</span><a href="#local-6989586621682083405"><span class="hs-identifier hs-var">pipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621682083404"><span class="hs-identifier hs-var">hooks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall a. TPhase a -&gt; IO a) -&gt; PhaseHook
</span><a href="GHC.Driver.Pipeline.Phases.html#PhaseHook"><span class="hs-identifier hs-var">PhaseHook</span></a></span><span> </span><span class="annot"><span class="annottext">TPhase a -&gt; IO a
forall a. TPhase a -&gt; IO a
</span><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="annot"><span class="hs-comment">-- | Default interpretation of each phase, in terms of IO.</span></span><span>
</span><span id="line-100"></span><span id="local-6989586621682083407"><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-type">runPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#TPhase"><span class="hs-identifier hs-type">TPhase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682083407"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621682083407"><span class="hs-identifier hs-type">out</span></a></span></span><span>
</span><span id="line-101"></span><span id="runPhase"><span class="annot"><span class="annottext">runPhase :: forall a. TPhase a -&gt; IO a
</span><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var hs-var">runPhase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_Unlit"><span class="hs-identifier hs-type">T_Unlit</span></a></span><span> </span><span id="local-6989586621682083411"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083411"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083412"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083412"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083413"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083413"><span class="hs-identifier hs-var">inp_path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621682083414"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083414"><span class="hs-identifier hs-var">out_path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#Cpp"><span class="hs-identifier hs-var">Cpp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083411"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083412"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runUnlitPhase"><span class="hs-identifier hs-var">runUnlitPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083412"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083413"><span class="hs-identifier hs-var">inp_path</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083414"><span class="hs-identifier hs-var">out_path</span></a></span><span>
</span><span id="line-104"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_FileArgs"><span class="hs-identifier hs-type">T_FileArgs</span></a></span><span> </span><span id="local-6989586621682083421"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083421"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083422"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083422"><span class="hs-identifier hs-var">inp_path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; IO (DynFlags, Messages PsMessage, [Warn])
</span><a href="GHC.Driver.Pipeline.Execute.html#getFileArgs"><span class="hs-identifier hs-var">getFileArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083421"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083422"><span class="hs-identifier hs-var">inp_path</span></a></span><span>
</span><span id="line-105"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_Cpp"><span class="hs-identifier hs-type">T_Cpp</span></a></span><span> </span><span id="local-6989586621682083427"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083427"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083428"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083428"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083429"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083429"><span class="hs-identifier hs-var">inp_path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621682083430"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083430"><span class="hs-identifier hs-var">out_path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-var">HsPp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083427"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083428"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runCppPhase"><span class="hs-identifier hs-var">runCppPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083428"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083429"><span class="hs-identifier hs-var">inp_path</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083430"><span class="hs-identifier hs-var">out_path</span></a></span><span>
</span><span id="line-108"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_HsPp"><span class="hs-identifier hs-type">T_HsPp</span></a></span><span> </span><span id="local-6989586621682083436"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083436"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083437"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083437"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083438"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083438"><span class="hs-identifier hs-var">origin_path</span></a></span></span><span> </span><span id="local-6989586621682083439"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083439"><span class="hs-identifier hs-var">inp_path</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621682083440"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083440"><span class="hs-identifier hs-var">out_path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083436"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083437"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runHsPpPhase"><span class="hs-identifier hs-var">runHsPpPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083437"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083438"><span class="hs-identifier hs-var">origin_path</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083439"><span class="hs-identifier hs-var">inp_path</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083440"><span class="hs-identifier hs-var">out_path</span></a></span><span>
</span><span id="line-111"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_HscRecomp"><span class="hs-identifier hs-type">T_HscRecomp</span></a></span><span> </span><span id="local-6989586621682083445"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083445"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083446"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083446"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083447"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083447"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621682083448"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083448"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv
-&gt; HscEnv
-&gt; String
-&gt; HscSource
-&gt; IO (HscEnv, ModSummary, HscRecompStatus)
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscPhase"><span class="hs-identifier hs-var">runHscPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083445"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083446"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083447"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083448"><span class="hs-identifier hs-var">hsc_src</span></a></span><span>
</span><span id="line-113"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_Hsc"><span class="hs-identifier hs-type">T_Hsc</span></a></span><span> </span><span id="local-6989586621682083452"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083452"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083453"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682083453"><span class="hs-identifier hs-var">mod_sum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; IO (FrontendResult, Messages GhcMessage)
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscTcPhase"><span class="hs-identifier hs-var">runHscTcPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083452"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682083453"><span class="hs-identifier hs-var">mod_sum</span></a></span><span>
</span><span id="line-114"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_HscPostTc"><span class="hs-identifier hs-type">T_HscPostTc</span></a></span><span> </span><span id="local-6989586621682083457"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083457"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083458"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682083458"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span id="local-6989586621682083459"><span class="annot"><span class="annottext">FrontendResult
</span><a href="#local-6989586621682083459"><span class="hs-identifier hs-var">fer</span></a></span></span><span> </span><span id="local-6989586621682083460"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621682083460"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621682083461"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682083461"><span class="hs-identifier hs-var">mfi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModSummary
-&gt; FrontendResult
-&gt; Messages GhcMessage
-&gt; Maybe Fingerprint
-&gt; IO HscBackendAction
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscPostTcPhase"><span class="hs-identifier hs-var">runHscPostTcPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083457"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682083458"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">FrontendResult
</span><a href="#local-6989586621682083459"><span class="hs-identifier hs-var">fer</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621682083460"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682083461"><span class="hs-identifier hs-var">mfi</span></a></span><span>
</span><span id="line-116"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_HscBackend"><span class="hs-identifier hs-type">T_HscBackend</span></a></span><span> </span><span id="local-6989586621682083465"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083465"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083466"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083466"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083467"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083467"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span id="local-6989586621682083468"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083468"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span> </span><span id="local-6989586621682083469"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083469"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083470"><span class="annot"><span class="annottext">HscBackendAction
</span><a href="#local-6989586621682083470"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv
-&gt; HscEnv
-&gt; ModuleName
-&gt; HscSource
-&gt; ModLocation
-&gt; HscBackendAction
-&gt; IO ([String], ModIface, HomeModLinkable, String)
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscBackendPhase"><span class="hs-identifier hs-var">runHscBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083465"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083466"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083467"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083468"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083469"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">HscBackendAction
</span><a href="#local-6989586621682083470"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-118"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_CmmCpp"><span class="hs-identifier hs-type">T_CmmCpp</span></a></span><span> </span><span id="local-6989586621682083477"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083477"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083478"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083478"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083479"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083479"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621682083480"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083480"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cmm"><span class="hs-identifier hs-var">Cmm</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083477"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs
-&gt; DynFlags
-&gt; UnitEnv
-&gt; CppOpts
-&gt; String
-&gt; String
-&gt; IO ()
</span><a href="GHC.SysTools.Cpp.html#doCpp"><span class="hs-identifier hs-var">doCpp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.SysTools.Cpp.html#CppOpts"><span class="hs-identifier hs-type">CppOpts</span></a></span><span>
</span><span id="line-125"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cppUseCc :: Bool
</span><a href="GHC.SysTools.Cpp.html#cppUseCc"><span class="hs-identifier hs-var">cppUseCc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-126"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cppLinePragmas :: Bool
</span><a href="GHC.SysTools.Cpp.html#cppLinePragmas"><span class="hs-identifier hs-var">cppLinePragmas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-127"></span><span>          </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083479"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083480"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="annottext">out -&gt; IO out
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">out
String
</span><a href="#local-6989586621682083480"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-130"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_Js"><span class="hs-identifier hs-type">T_Js</span></a></span><span> </span><span id="local-6989586621682083492"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083492"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083493"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083493"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083494"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083494"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083495"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083495"><span class="hs-identifier hs-var">js_src</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runJsPhase"><span class="hs-identifier hs-var">runJsPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083492"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083493"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083494"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083495"><span class="hs-identifier hs-var">js_src</span></a></span><span>
</span><span id="line-132"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_ForeignJs"><span class="hs-identifier hs-type">T_ForeignJs</span></a></span><span> </span><span id="local-6989586621682083499"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083499"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083500"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083500"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083501"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083501"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083502"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083502"><span class="hs-identifier hs-var">js_src</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runForeignJsPhase"><span class="hs-identifier hs-var">runForeignJsPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083499"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083500"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083501"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083502"><span class="hs-identifier hs-var">js_src</span></a></span><span>
</span><span id="line-134"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_Cmm"><span class="hs-identifier hs-type">T_Cmm</span></a></span><span> </span><span id="local-6989586621682083512"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083512"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083513"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083513"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083514"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083514"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083515"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083515"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083513"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083516"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621682083516"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; Backend -&gt; Phase
</span><a href="GHC.Driver.Pipeline.Execute.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083515"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621682083519"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083519"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083516"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083512"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083513"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span id="local-6989586621682083520"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083520"><span class="hs-identifier hs-var">mstub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; String -&gt; String -&gt; IO (Maybe String)
</span><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier hs-var">hscCompileCmmFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083513"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_filename"><span class="hs-identifier hs-var">src_filename</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083512"><span class="hs-identifier hs-var">pipe_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083514"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083519"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span id="local-6989586621682083523"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083523"><span class="hs-identifier hs-var">stub_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; Maybe String -&gt; IO (Maybe String)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Maybe a -&gt; m (Maybe b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#compileStub"><span class="hs-identifier hs-var">compileStub</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083513"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083520"><span class="hs-identifier hs-var">mstub</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083526"><span class="annot"><span class="annottext">foreign_os :: [String]
</span><a href="#local-6989586621682083526"><span class="hs-identifier hs-var hs-var">foreign_os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; [String]
forall a. Maybe a -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybeToList/Data.Maybe.html#maybeToList"><span class="hs-identifier hs-var">maybeToList</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083523"><span class="hs-identifier hs-var">stub_o</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="annottext">out -&gt; IO out
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083526"><span class="hs-identifier hs-var">foreign_os</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083519"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_Cc"><span class="hs-identifier hs-type">T_Cc</span></a></span><span> </span><span id="local-6989586621682083530"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083530"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span id="local-6989586621682083531"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083531"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083532"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083532"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083533"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083533"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083534"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083534"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runCcPhase"><span class="hs-identifier hs-var">runCcPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083530"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083531"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083532"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083533"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083534"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-144"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_As"><span class="hs-identifier hs-type">T_As</span></a></span><span> </span><span id="local-6989586621682083538"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083538"><span class="hs-identifier hs-var">cpp</span></a></span></span><span> </span><span id="local-6989586621682083539"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083539"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083540"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083540"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083541"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083541"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083542"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083542"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runAsPhase"><span class="hs-identifier hs-var">runAsPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083538"><span class="hs-identifier hs-var">cpp</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083539"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083540"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083541"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083542"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-146"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_LlvmOpt"><span class="hs-identifier hs-type">T_LlvmOpt</span></a></span><span> </span><span id="local-6989586621682083546"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083546"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083547"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083547"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083548"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083548"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv -&gt; HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runLlvmOptPhase"><span class="hs-identifier hs-var">runLlvmOptPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083546"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083547"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083548"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-148"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_LlvmLlc"><span class="hs-identifier hs-type">T_LlvmLlc</span></a></span><span> </span><span id="local-6989586621682083552"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083552"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083553"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083553"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083554"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083554"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv -&gt; HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runLlvmLlcPhase"><span class="hs-identifier hs-var">runLlvmLlcPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083552"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083553"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083554"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-150"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_LlvmMangle"><span class="hs-identifier hs-type">T_LlvmMangle</span></a></span><span> </span><span id="local-6989586621682083558"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083558"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083559"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083559"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083560"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083560"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv -&gt; HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runLlvmManglePhase"><span class="hs-identifier hs-var">runLlvmManglePhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083558"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083559"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083560"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-152"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Phases.html#T_MergeForeign"><span class="hs-identifier hs-type">T_MergeForeign</span></a></span><span> </span><span id="local-6989586621682083564"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083564"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083565"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083565"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083566"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083566"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621682083567"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083567"><span class="hs-identifier hs-var">fos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="annottext">PipeEnv -&gt; HscEnv -&gt; String -&gt; [String] -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runMergeForeign"><span class="hs-identifier hs-var">runMergeForeign</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083564"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083565"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083566"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083567"><span class="hs-identifier hs-var">fos</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runLlvmManglePhase"><span class="hs-identifier hs-type">runLlvmManglePhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span id="runLlvmManglePhase"><span class="annot"><span class="annottext">runLlvmManglePhase :: PipeEnv -&gt; HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runLlvmManglePhase"><span class="hs-identifier hs-var hs-var">runLlvmManglePhase</span></a></span></span><span> </span><span id="local-6989586621682083570"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083570"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083571"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083571"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083572"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083572"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083573"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621682083573"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Phase
</span><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-var">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-158"></span><span>      </span><span id="local-6989586621682083575"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083575"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083573"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083570"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083571"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083576"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083576"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083571"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="annot"><span class="annottext">Platform -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.CmmToLlvm.Mangler.html#llvmFixupAsm"><span class="hs-identifier hs-var">llvmFixupAsm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083576"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083572"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083575"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083575"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runMergeForeign"><span class="hs-identifier hs-type">runMergeForeign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-164"></span><span id="runMergeForeign"><span class="annot"><span class="annottext">runMergeForeign :: PipeEnv -&gt; HscEnv -&gt; String -&gt; [String] -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runMergeForeign"><span class="hs-identifier hs-var hs-var">runMergeForeign</span></a></span></span><span> </span><span id="local-6989586621682083579"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083579"><span class="hs-identifier hs-var">_pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083580"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083580"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083581"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083581"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621682083582"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083582"><span class="hs-identifier hs-var">foreign_os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083582"><span class="hs-identifier hs-var">foreign_os</span></a></span><span>
</span><span id="line-166"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083581"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-167"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>         </span><span class="hs-comment">-- Work around a binutil &lt; 2.31 bug where you can't merge objects if the output file</span><span>
</span><span id="line-169"></span><span>         </span><span class="hs-comment">-- is one of the inputs</span><span>
</span><span id="line-170"></span><span>         </span><span id="local-6989586621682083584"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083584"><span class="hs-identifier hs-var">new_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083580"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083580"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083580"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>                              </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;o&quot;</span></span><span>
</span><span id="line-174"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#copyFile/System.Directory.html#copyFile"><span class="hs-identifier hs-var">copyFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083581"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083584"><span class="hs-identifier hs-var">new_o</span></a></span><span>
</span><span id="line-175"></span><span>         </span><span class="annot"><span class="annottext">HscEnv -&gt; [String] -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#joinObjectFiles"><span class="hs-identifier hs-var">joinObjectFiles</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083580"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083584"><span class="hs-identifier hs-var">new_o</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083582"><span class="hs-identifier hs-var">foreign_os</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083581"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-176"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083581"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runLlvmLlcPhase"><span class="hs-identifier hs-type">runLlvmLlcPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-179"></span><span id="runLlvmLlcPhase"><span class="annot"><span class="annottext">runLlvmLlcPhase :: PipeEnv -&gt; HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runLlvmLlcPhase"><span class="hs-identifier hs-var hs-var">runLlvmLlcPhase</span></a></span></span><span> </span><span id="local-6989586621682083590"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083590"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083591"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083591"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083592"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083592"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- Note [Clamping of llc optimizations]</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- See #13724</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-comment">-- we clamp the llc optimization between [1,2]. This is because passing -O0</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- to llc 3.9 or llc 4.0, the naive register allocator can fail with</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">--   Error while trying to spill R1 from class GPR: Cannot scavenge register</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-comment">--   without an emergency spill slot!</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- Observed at least with target 'arm-unknown-linux-gnueabihf'.</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- With LLVM4, llc -O3 crashes when ghc-stage1 tries to compile</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">--   rts/HeapStackCheck.cmm</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-comment">-- llc -O3 '-mtriple=arm-unknown-linux-gnueabihf' -enable-tbaa /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_6.bc -o /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_7.lm_s</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-comment">-- 0  llc                      0x0000000102ae63e8 llvm::sys::PrintStackTrace(llvm::raw_ostream&amp;) + 40</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">-- 1  llc                      0x0000000102ae69a6 SignalHandler(int) + 358</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-comment">-- 2  libsystem_platform.dylib 0x00007fffc23f4b3a _sigtramp + 26</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">-- 3  libsystem_c.dylib        0x00007fffc226498b __vfprintf + 17876</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">-- 4  llc                      0x00000001029d5123 llvm::SelectionDAGISel::LowerArguments(llvm::Function const&amp;) + 5699</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">-- 5  llc                      0x0000000102a21a35 llvm::SelectionDAGISel::SelectAllBasicBlocks(llvm::Function const&amp;) + 3381</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- 6  llc                      0x0000000102a202b1 llvm::SelectionDAGISel::runOnMachineFunction(llvm::MachineFunction&amp;) + 1457</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- 7  llc                      0x0000000101bdc474 (anonymous namespace)::ARMDAGToDAGISel::runOnMachineFunction(llvm::MachineFunction&amp;) + 20</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- 8  llc                      0x00000001025573a6 llvm::MachineFunctionPass::runOnFunction(llvm::Function&amp;) + 134</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- 9  llc                      0x000000010274fb12 llvm::FPPassManager::runOnFunction(llvm::Function&amp;) + 498</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- 10 llc                      0x000000010274fd23 llvm::FPPassManager::runOnModule(llvm::Module&amp;) + 67</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- 11 llc                      0x00000001027501b8 llvm::legacy::PassManagerImpl::run(llvm::Module&amp;) + 920</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- 12 llc                      0x000000010195f075 compileModule(char**, llvm::LLVMContext&amp;) + 12133</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">-- 13 llc                      0x000000010195bf0b main + 491</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- 14 libdyld.dylib            0x00007fffc21e5235 start + 1</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-comment">-- Stack dump:</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-comment">-- 0.  Program arguments: llc -O3 -mtriple=arm-unknown-linux-gnueabihf -enable-tbaa /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_6.bc -o /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_7.lm_s</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- 1.  Running pass 'Function Pass Manager' on module '/var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_6.bc'.</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">-- 2.  Running pass 'ARM Instruction Selection' on function '@&quot;stg_gc_f1$def&quot;'</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-comment">-- Observed at least with -mtriple=arm-unknown-linux-gnueabihf -enable-tbaa</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621682083593"><span class="annot"><span class="annottext">LlvmConfig
</span><a href="#local-6989586621682083593"><span class="hs-identifier hs-var">llvm_config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LlvmConfigCache -&gt; IO LlvmConfig
</span><a href="GHC.Driver.LlvmConfigCache.html#readLlvmConfigCache"><span class="hs-identifier hs-var">readLlvmConfigCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; LlvmConfigCache
</span><a href="GHC.Driver.Env.Types.html#hsc_llvm_config"><span class="hs-identifier hs-var">hsc_llvm_config</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083591"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083595"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083595"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083591"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621682083596"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083596"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083591"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-222"></span><span>        </span><span id="local-6989586621682083597"><span class="annot"><span class="annottext">llvmOpts :: String
</span><a href="#local-6989586621682083597"><span class="hs-identifier hs-var hs-var">llvmOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#llvmOptLevel"><span class="hs-identifier hs-var">llvmOptLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083595"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O1&quot;</span></span><span> </span><span class="hs-comment">-- required to get the non-naive reg allocator. Passing -regalloc=greedy is not sufficient.</span><span>
</span><span id="line-224"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O1&quot;</span></span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O2&quot;</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>        </span><span id="local-6989586621682083599"><span class="annot"><span class="annottext">defaultOptions :: [Option]
</span><a href="#local-6989586621682083599"><span class="hs-identifier hs-var hs-var">defaultOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [Option]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; [String] -&gt; [String]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concatMap/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#words/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([String], [String]) -&gt; [String]
forall a b. (a, b) -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#snd/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span>
</span><span id="line-228"></span><span>                         </span><span class="annot"><span class="annottext">(([String], [String]) -&gt; [Option])
-&gt; ([String], [String]) -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)] -&gt; ([String], [String])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LlvmConfig -&gt; DynFlags -&gt; [(String, String)]
</span><a href="GHC.Driver.Pipeline.Execute.html#llvmOptions"><span class="hs-identifier hs-var">llvmOptions</span></a></span><span> </span><span class="annot"><span class="annottext">LlvmConfig
</span><a href="#local-6989586621682083593"><span class="hs-identifier hs-var">llvm_config</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083595"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>        </span><span id="local-6989586621682083607"><span class="annot"><span class="annottext">optFlag :: [Option]
</span><a href="#local-6989586621682083607"><span class="hs-identifier hs-var hs-var">optFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083595"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_lc"><span class="hs-identifier hs-var">opt_lc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option]) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#words/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083597"><span class="hs-identifier hs-var">llvmOpts</span></a></span><span>
</span><span id="line-231"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621682083610"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083610"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-comment">-- hidden debugging flag '-dno-llvm-mangler' to skip mangling</span><span>
</span><span id="line-234"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_NoLlvmMangler"><span class="hs-identifier hs-var">Opt_NoLlvmMangler</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083595"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; IO Phase
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Phase
</span><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-var">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; IO Phase
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmMangle"><span class="hs-identifier hs-var">LlvmMangle</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621682083614"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083614"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083610"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083590"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083591"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runLlvmLlc"><span class="hs-identifier hs-var">GHC.SysTools.runLlvmLlc</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083596"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083595"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-special">(</span><span>  </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682083607"><span class="hs-identifier hs-var">optFlag</span></a></span><span>
</span><span id="line-241"></span><span>                </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682083599"><span class="hs-identifier hs-var">defaultOptions</span></a></span><span>
</span><span id="line-242"></span><span>                </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083592"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-243"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-244"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083614"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-245"></span><span>                   </span><span class="hs-special">]</span><span>
</span><span id="line-246"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083614"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runLlvmOptPhase"><span class="hs-identifier hs-type">runLlvmOptPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-251"></span><span id="runLlvmOptPhase"><span class="annot"><span class="annottext">runLlvmOptPhase :: PipeEnv -&gt; HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runLlvmOptPhase"><span class="hs-identifier hs-var hs-var">runLlvmOptPhase</span></a></span></span><span> </span><span id="local-6989586621682083617"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083617"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083618"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083618"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083619"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083619"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083620"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083620"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083618"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-253"></span><span>        </span><span id="local-6989586621682083621"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083621"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083618"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621682083622"><span class="annot"><span class="annottext">LlvmConfig
</span><a href="#local-6989586621682083622"><span class="hs-identifier hs-var">llvm_config</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LlvmConfigCache -&gt; IO LlvmConfig
</span><a href="GHC.Driver.LlvmConfigCache.html#readLlvmConfigCache"><span class="hs-identifier hs-var">readLlvmConfigCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; LlvmConfigCache
</span><a href="GHC.Driver.Env.Types.html#hsc_llvm_config"><span class="hs-identifier hs-var">hsc_llvm_config</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083618"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- we always (unless -optlo specified) run Opt since we rely on it to</span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-comment">-- fix up some pretty big deficiencies in the code we generate</span><span>
</span><span id="line-257"></span><span>        </span><span id="local-6989586621682083623"><span class="annot"><span class="annottext">optIdx :: Int
</span><a href="#local-6989586621682083623"><span class="hs-identifier hs-var hs-var">optIdx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#llvmOptLevel"><span class="hs-identifier hs-var">llvmOptLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083620"><span class="hs-identifier hs-var">dflags</span></a></span><span>  </span><span class="hs-comment">-- ensure we're in [0,2]</span><span>
</span><span id="line-258"></span><span>        </span><span id="local-6989586621682083626"><span class="annot"><span class="annottext">llvmOpts :: String
</span><a href="#local-6989586621682083626"><span class="hs-identifier hs-var hs-var">llvmOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Int, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.18.2.1/src/GHC.List.html#lookup/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682083623"><span class="hs-identifier hs-var">optIdx</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, String)] -&gt; Maybe String)
-&gt; [(Int, String)] -&gt; Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LlvmConfig -&gt; [(Int, String)]
</span><a href="GHC.CmmToLlvm.Config.html#llvmPasses"><span class="hs-identifier hs-var">llvmPasses</span></a></span><span> </span><span class="annot"><span class="annottext">LlvmConfig
</span><a href="#local-6989586621682083622"><span class="hs-identifier hs-var">llvm_config</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-259"></span><span>                    </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682083629"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083629"><span class="hs-identifier hs-var">passes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083629"><span class="hs-identifier hs-var">passes</span></a></span><span>
</span><span id="line-260"></span><span>                    </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runPhase LlvmOpt: llvm-passes file &quot;</span></span><span>
</span><span id="line-261"></span><span>                                      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is missing passes for level &quot;</span></span><span>
</span><span id="line-262"></span><span>                                      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682083623"><span class="hs-identifier hs-var">optIdx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>        </span><span id="local-6989586621682083632"><span class="annot"><span class="annottext">defaultOptions :: [Option]
</span><a href="#local-6989586621682083632"><span class="hs-identifier hs-var hs-var">defaultOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [Option]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[[String]] -&gt; [String]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[String]] -&gt; [String])
-&gt; (([String], [String]) -&gt; [[String]])
-&gt; ([String], [String])
-&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; [String] -&gt; [[String]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#words/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [[String]])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [[String]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([String], [String]) -&gt; [String]
forall a b. (a, b) -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#fst/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span>
</span><span id="line-264"></span><span>                         </span><span class="annot"><span class="annottext">(([String], [String]) -&gt; [Option])
-&gt; ([String], [String]) -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)] -&gt; ([String], [String])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base-4.18.2.1/src/GHC.List.html#unzip/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LlvmConfig -&gt; DynFlags -&gt; [(String, String)]
</span><a href="GHC.Driver.Pipeline.Execute.html#llvmOptions"><span class="hs-identifier hs-var">llvmOptions</span></a></span><span> </span><span class="annot"><span class="annottext">LlvmConfig
</span><a href="#local-6989586621682083622"><span class="hs-identifier hs-var">llvm_config</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083620"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-comment">-- don't specify anything if user has specified commands. We do this</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-comment">-- for opt but not llc since opt is very specifically for optimisation</span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-comment">-- passes only, so if the user is passing us extra options we assume</span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-comment">-- they know what they are doing and don't get in the way.</span><span>
</span><span id="line-270"></span><span>        </span><span id="local-6989586621682083635"><span class="annot"><span class="annottext">optFlag :: [Option]
</span><a href="#local-6989586621682083635"><span class="hs-identifier hs-var hs-var">optFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083620"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_lo"><span class="hs-identifier hs-var">opt_lo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option]) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#words/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083626"><span class="hs-identifier hs-var">llvmOpts</span></a></span><span>
</span><span id="line-272"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621682083637"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083637"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmLlc"><span class="hs-identifier hs-var">LlvmLlc</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083617"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083618"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runLlvmOpt"><span class="hs-identifier hs-var">GHC.SysTools.runLlvmOpt</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083621"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083620"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-277"></span><span>               </span><span class="hs-special">(</span><span>   </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682083635"><span class="hs-identifier hs-var">optFlag</span></a></span><span>
</span><span id="line-278"></span><span>                </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682083632"><span class="hs-identifier hs-var">defaultOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-279"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083619"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-280"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-281"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083637"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083637"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runAsPhase"><span class="hs-identifier hs-type">runAsPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-288"></span><span id="runAsPhase"><span class="annot"><span class="annottext">runAsPhase :: Bool
-&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runAsPhase"><span class="hs-identifier hs-var hs-var">runAsPhase</span></a></span></span><span> </span><span id="local-6989586621682083640"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083640"><span class="hs-identifier hs-var">with_cpp</span></a></span></span><span> </span><span id="local-6989586621682083641"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083641"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083642"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083642"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083643"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083643"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083644"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083644"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-289"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083645"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span>   </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083642"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083646"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083646"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span>   </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083642"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083647"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621682083647"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083642"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083648"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682083648"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Platform
</span><a href="GHC.Unit.Env.html#ue_platform"><span class="hs-identifier hs-var">ue_platform</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682083647"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-comment">-- LLVM from version 3.0 onwards doesn't support the OS X system</span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-comment">-- assembler, so we use clang as the assembler instead. (#5636)</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682083650"><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; Platform -&gt; [Option] -&gt; IO ()
</span><a href="#local-6989586621682083650"><span class="hs-identifier hs-var">as_prog</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083651"><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; Platform -&gt; IO CompilerInfo
</span><a href="#local-6989586621682083651"><span class="hs-identifier hs-var">get_asm_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerProg
-&gt; Logger -&gt; DynFlags -&gt; Platform -&gt; [Option] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerProg"><span class="hs-identifier hs-var">applyAssemblerProg</span></a></span><span> </span><span class="annot"><span class="annottext">(DefunctionalizedAssemblerProg
 -&gt; Logger -&gt; DynFlags -&gt; Platform -&gt; [Option] -&gt; IO ())
-&gt; DefunctionalizedAssemblerProg
-&gt; Logger
-&gt; DynFlags
-&gt; Platform
-&gt; [Option]
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Backend -&gt; DefunctionalizedAssemblerProg
</span><a href="GHC.Driver.Backend.html#backendAssemblerProg"><span class="hs-identifier hs-var">backendAssemblerProg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerInfoGetter
-&gt; Logger -&gt; DynFlags -&gt; Platform -&gt; IO CompilerInfo
</span><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerInfoGetter"><span class="hs-identifier hs-var">applyAssemblerInfoGetter</span></a></span><span> </span><span class="annot"><span class="annottext">(DefunctionalizedAssemblerInfoGetter
 -&gt; Logger -&gt; DynFlags -&gt; Platform -&gt; IO CompilerInfo)
-&gt; DefunctionalizedAssemblerInfoGetter
-&gt; Logger
-&gt; DynFlags
-&gt; Platform
-&gt; IO CompilerInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Backend -&gt; DefunctionalizedAssemblerInfoGetter
</span><a href="GHC.Driver.Backend.html#backendAssemblerInfoGetter"><span class="hs-identifier hs-var">backendAssemblerInfoGetter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>        </span><span id="local-6989586621682083656"><span class="annot"><span class="annottext">CompilerInfo
</span><a href="#local-6989586621682083656"><span class="hs-identifier hs-var">asmInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; Platform -&gt; IO CompilerInfo
</span><a href="#local-6989586621682083651"><span class="hs-identifier hs-var">get_asm_info</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083646"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083648"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083657"><span class="annot"><span class="annottext">cmdline_include_paths :: IncludeSpecs
</span><a href="#local-6989586621682083657"><span class="hs-identifier hs-var hs-var">cmdline_include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083659"><span class="annot"><span class="annottext">pic_c_flags :: [String]
</span><a href="#local-6989586621682083659"><span class="hs-identifier hs-var hs-var">pic_c_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#picCCOpts"><span class="hs-identifier hs-var">picCCOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>        </span><span id="local-6989586621682083661"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083661"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083641"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083642"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083643"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-comment">-- we create directories for the object file, because it</span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-comment">-- might be a hierarchical module.</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#createDirectoryIfMissing/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#takeDirectory/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083661"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083665"><span class="annot"><span class="annottext">global_includes :: [Option]
</span><a href="#local-6989586621682083665"><span class="hs-identifier hs-var hs-var">global_includes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-I&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083666"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682083666"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083666"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsGlobal"><span class="hs-identifier hs-var">includePathsGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621682083657"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-313"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083668"><span class="annot"><span class="annottext">local_includes :: [Option]
</span><a href="#local-6989586621682083668"><span class="hs-identifier hs-var hs-var">local_includes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-iquote&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083669"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621682083669"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083669"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuote"><span class="hs-identifier hs-var">includePathsQuote</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621682083657"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-315"></span><span>                                </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuoteImplicit"><span class="hs-identifier hs-var">includePathsQuoteImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621682083657"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083672"><span class="annot"><span class="annottext">runAssembler :: String -&gt; String -&gt; IO ()
</span><a href="#local-6989586621682083672"><span class="hs-identifier hs-var hs-var">runAssembler</span></a></span></span><span> </span><span id="local-6989586621682083673"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083673"><span class="hs-identifier hs-var">inputFilename</span></a></span></span><span> </span><span id="local-6989586621682083674"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083674"><span class="hs-identifier hs-var">outputFilename</span></a></span></span><span>
</span><span id="line-317"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
String -&gt; (String -&gt; m a) -&gt; m a
</span><a href="GHC.Utils.Misc.html#withAtomicRename"><span class="hs-identifier hs-var">withAtomicRename</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083674"><span class="hs-identifier hs-var">outputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">((String -&gt; IO ()) -&gt; IO ()) -&gt; (String -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682083676"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083676"><span class="hs-identifier hs-var">temp_outputFilename</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-318"></span><span>                    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; Platform -&gt; [Option] -&gt; IO ()
</span><a href="#local-6989586621682083650"><span class="hs-identifier hs-var">as_prog</span></a></span><span>
</span><span id="line-319"></span><span>                       </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083646"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-320"></span><span>                       </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083648"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-321"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682083668"><span class="hs-identifier hs-var">local_includes</span></a></span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682083665"><span class="hs-identifier hs-var">global_includes</span></a></span><span>
</span><span id="line-322"></span><span>                       </span><span class="hs-comment">-- See Note [-fPIC for assembler]</span><span>
</span><span id="line-323"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083659"><span class="hs-identifier hs-var">pic_c_flags</span></a></span><span>
</span><span id="line-324"></span><span>                       </span><span class="hs-comment">-- See Note [Produce big objects on Windows]</span><span>
</span><span id="line-325"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wa,-mbig-obj&quot;</span></span><span>
</span><span id="line-326"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSMinGW32/GHC.Platform.ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span>
</span><span id="line-327"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#target32Bit"><span class="hs-identifier hs-var">target32Bit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>                       </span><span class="hs-comment">-- See Note [-Wa,--no-type-check on wasm32]</span><span>
</span><span id="line-331"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wa,--no-type-check&quot;</span></span><span>
</span><span id="line-332"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083645"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchWasm32/GHC.Platform.ArchOS.html#ArchWasm32"><span class="hs-identifier hs-var">ArchWasm32</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(CompilerInfo -&gt; Bool) -&gt; [CompilerInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="#local-6989586621682083656"><span class="hs-identifier hs-var">asmInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerInfo -&gt; CompilerInfo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#Clang"><span class="hs-identifier hs-var">Clang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#AppleClang"><span class="hs-identifier hs-var">AppleClang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#AppleClang51"><span class="hs-identifier hs-var">AppleClang51</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Qunused-arguments&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-336"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-x&quot;</span></span><span>
</span><span id="line-338"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083640"><span class="hs-identifier hs-var">with_cpp</span></a></span><span>
</span><span id="line-339"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;assembler-with-cpp&quot;</span></span><span>
</span><span id="line-340"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;assembler&quot;</span></span><span>
</span><span id="line-341"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-c&quot;</span></span><span>
</span><span id="line-342"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083673"><span class="hs-identifier hs-var">inputFilename</span></a></span><span>
</span><span id="line-343"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-344"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083676"><span class="hs-identifier hs-var">temp_outputFilename</span></a></span><span>
</span><span id="line-345"></span><span>                          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083646"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Running the assembler&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="#local-6989586621682083672"><span class="hs-identifier hs-var">runAssembler</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083644"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083661"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083661"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">-- Note [JS Backend .o file procedure]</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-355"></span><span class="hs-comment">--</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- The JS backend breaks some of the assumptions on file generation order</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- because it directly produces .o files. This violation breaks some of the</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- assumptions on file timestamps, particularly in the postHsc phase. The</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- postHsc phase for the JS backend is performed in 'runJsPhase'. Consider</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- what the NCG does:</span><span>
</span><span id="line-361"></span><span class="hs-comment">--</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- With other NCG backends we have the following order:</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- 1. The backend produces a .s file</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- 2. Then we write the interface file, .hi</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- 3. Then we generate a .o file in a postHsc phase (calling the asm phase etc.)</span><span>
</span><span id="line-366"></span><span class="hs-comment">--</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- For the JS Backend this order is different</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- 1. The JS Backend _directly_ produces .o files</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- 2. Then we write the interface file. Notice that this breaks the ordering</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- of .hi &gt; .o (step 2 and step 3 in the NCG above).</span><span>
</span><span id="line-371"></span><span class="hs-comment">--</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- This violation results in timestamp checks which pass on the NCG but fail</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- in the JS backend. In particular, checks that compare 'ms_obj_date', and</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- 'ms_iface_date' in 'GHC.Unit.Module.ModSummary'.</span><span>
</span><span id="line-375"></span><span class="hs-comment">--</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- Thus to fix this ordering we touch the object files we generated earlier</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- to ensure these timestamps abide by the proper ordering.</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><span class="hs-comment">-- | Run the JS Backend postHsc phase.</span></span><span>
</span><span id="line-380"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runJsPhase"><span class="hs-identifier hs-type">runJsPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-381"></span><span id="runJsPhase"><span class="annot"><span class="annottext">runJsPhase :: PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runJsPhase"><span class="hs-identifier hs-var hs-var">runJsPhase</span></a></span></span><span> </span><span id="local-6989586621682083689"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083689"><span class="hs-identifier hs-var">_pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083690"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083690"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083691"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083691"><span class="hs-identifier hs-var">_location</span></a></span></span><span> </span><span id="local-6989586621682083692"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083692"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083693"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083693"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span>   </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083690"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083694"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083694"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span>   </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083690"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-comment">-- The object file is already generated. We only touch it to ensure the</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- timestamp is refreshed, see Note [JS Backend .o file procedure].</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#touchObjectFile"><span class="hs-identifier hs-var">touchObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083694"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083693"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083692"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083692"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="annot"><span class="hs-comment">-- | Deal with foreign JS files (embed them into .o files)</span></span><span>
</span><span id="line-392"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runForeignJsPhase"><span class="hs-identifier hs-type">runForeignJsPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-393"></span><span id="runForeignJsPhase"><span class="annot"><span class="annottext">runForeignJsPhase :: PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runForeignJsPhase"><span class="hs-identifier hs-var hs-var">runForeignJsPhase</span></a></span></span><span> </span><span id="local-6989586621682083696"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083696"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083697"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083697"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083698"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083698"><span class="hs-identifier hs-var">_location</span></a></span></span><span> </span><span id="local-6989586621682083699"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083699"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083700"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083700"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span>   </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083697"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083701"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083701"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span>   </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083697"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083702"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621682083702"><span class="hs-identifier hs-var hs-var">tmpfs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span>    </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083697"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083703"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621682083703"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083697"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621682083704"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083704"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083696"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083697"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; TmpFs -&gt; UnitEnv -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.StgToJS.Linker.Linker.html#embedJsFile"><span class="hs-identifier hs-var">embedJsFile</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083701"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083700"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682083702"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682083703"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083699"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083704"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083704"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerInfoGetter"><span class="hs-identifier hs-type">applyAssemblerInfoGetter</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html#DefunctionalizedAssemblerInfoGetter"><span class="hs-identifier hs-type">DefunctionalizedAssemblerInfoGetter</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#CompilerInfo"><span class="hs-identifier hs-type">CompilerInfo</span></a></span><span>
</span><span id="line-407"></span><span id="applyAssemblerInfoGetter"><span class="annot"><span class="annottext">applyAssemblerInfoGetter :: DefunctionalizedAssemblerInfoGetter
-&gt; Logger -&gt; DynFlags -&gt; Platform -&gt; IO CompilerInfo
</span><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerInfoGetter"><span class="hs-identifier hs-var hs-var">applyAssemblerInfoGetter</span></a></span></span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerInfoGetter
</span><a href="GHC.Driver.Backend.html#StandardAssemblerInfoGetter"><span class="hs-identifier hs-var">StandardAssemblerInfoGetter</span></a></span><span> </span><span id="local-6989586621682083706"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083706"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682083707"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083707"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682083708"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083708"><span class="hs-identifier hs-var">_platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; IO CompilerInfo
</span><a href="GHC.SysTools.Info.html#getAssemblerInfo"><span class="hs-identifier hs-var">getAssemblerInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083706"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083707"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-409"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerInfoGetter"><span class="hs-identifier hs-var">applyAssemblerInfoGetter</span></a></span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerInfoGetter
</span><a href="GHC.Driver.Backend.html#JSAssemblerInfoGetter"><span class="hs-identifier hs-var">JSAssemblerInfoGetter</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Platform
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">CompilerInfo -&gt; IO CompilerInfo
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#Emscripten"><span class="hs-identifier hs-var">Emscripten</span></a></span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerInfoGetter"><span class="hs-identifier hs-var">applyAssemblerInfoGetter</span></a></span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerInfoGetter
</span><a href="GHC.Driver.Backend.html#DarwinClangAssemblerInfoGetter"><span class="hs-identifier hs-var">DarwinClangAssemblerInfoGetter</span></a></span><span> </span><span id="local-6989586621682083713"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083713"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682083714"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083714"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682083715"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083715"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083715"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-413"></span><span>        </span><span class="annot"><span class="annottext">CompilerInfo -&gt; IO CompilerInfo
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#pure/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#Clang"><span class="hs-identifier hs-var">Clang</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-415"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; IO CompilerInfo
</span><a href="GHC.SysTools.Info.html#getAssemblerInfo"><span class="hs-identifier hs-var">getAssemblerInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083713"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083714"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerProg"><span class="hs-identifier hs-type">applyAssemblerProg</span></a></span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html#DefunctionalizedAssemblerProg"><span class="hs-identifier hs-type">DefunctionalizedAssemblerProg</span></a></span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-type">Option</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span id="applyAssemblerProg"><span class="annot"><span class="annottext">applyAssemblerProg :: DefunctionalizedAssemblerProg
-&gt; Logger -&gt; DynFlags -&gt; Platform -&gt; [Option] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerProg"><span class="hs-identifier hs-var hs-var">applyAssemblerProg</span></a></span></span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerProg
</span><a href="GHC.Driver.Backend.html#StandardAssemblerProg"><span class="hs-identifier hs-var">StandardAssemblerProg</span></a></span><span> </span><span id="local-6989586621682083718"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083718"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682083719"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083719"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682083720"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083720"><span class="hs-identifier hs-var">_platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runAs"><span class="hs-identifier hs-var">runAs</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083718"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083719"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-422"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerProg"><span class="hs-identifier hs-var">applyAssemblerProg</span></a></span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerProg
</span><a href="GHC.Driver.Backend.html#JSAssemblerProg"><span class="hs-identifier hs-var">JSAssemblerProg</span></a></span><span> </span><span id="local-6989586621682083723"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083723"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682083724"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083724"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682083725"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083725"><span class="hs-identifier hs-var">_platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runEmscripten"><span class="hs-identifier hs-var">runEmscripten</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083723"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083724"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-424"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#applyAssemblerProg"><span class="hs-identifier hs-var">applyAssemblerProg</span></a></span><span> </span><span class="annot"><span class="annottext">DefunctionalizedAssemblerProg
</span><a href="GHC.Driver.Backend.html#DarwinClangAssemblerProg"><span class="hs-identifier hs-var">DarwinClangAssemblerProg</span></a></span><span> </span><span id="local-6989586621682083728"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083728"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682083729"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083729"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682083730"><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083730"><span class="hs-identifier hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083730"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSDarwin/GHC.Platform.ArchOS.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-426"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runClang"><span class="hs-identifier hs-var">runClang</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083728"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083729"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-428"></span><span>        </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runAs"><span class="hs-identifier hs-var">runAs</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083728"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083729"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runCcPhase"><span class="hs-identifier hs-type">runCcPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-433"></span><span id="runCcPhase"><span class="annot"><span class="annottext">runCcPhase :: Phase
-&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runCcPhase"><span class="hs-identifier hs-var hs-var">runCcPhase</span></a></span></span><span> </span><span id="local-6989586621682083732"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083732"><span class="hs-identifier hs-var">cc_phase</span></a></span></span><span> </span><span id="local-6989586621682083733"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083733"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083734"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083734"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083735"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083735"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083736"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083736"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083737"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083734"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083738"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083738"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083734"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083739"><span class="annot"><span class="annottext">unit_env :: UnitEnv
</span><a href="#local-6989586621682083739"><span class="hs-identifier hs-var hs-var">unit_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083734"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083740"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621682083740"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083734"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083742"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621682083742"><span class="hs-identifier hs-var hs-var">tmpfs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083734"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083743"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682083743"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; Platform
</span><a href="GHC.Unit.Env.html#ue_platform"><span class="hs-identifier hs-var">ue_platform</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682083739"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083744"><span class="annot"><span class="annottext">hcc :: Bool
</span><a href="#local-6989586621682083744"><span class="hs-identifier hs-var hs-var">hcc</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083732"><span class="hs-identifier hs-var">cc_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#eqPhase"><span class="hs-operator hs-var">`eqPhase`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083747"><span class="annot"><span class="annottext">cmdline_include_paths :: IncludeSpecs
</span><a href="#local-6989586621682083747"><span class="hs-identifier hs-var hs-var">cmdline_include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs -&gt; IncludeSpecs
</span><a href="GHC.SysTools.Cpp.html#offsetIncludePaths"><span class="hs-identifier hs-var">offsetIncludePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-comment">-- HC files have the dependent packages stamped into them</span><span>
</span><span id="line-445"></span><span>  </span><span id="local-6989586621682083749"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682083749"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083744"><span class="hs-identifier hs-var">hcc</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO [UnitId]
</span><a href="GHC.Driver.Pipeline.Execute.html#getHCFilePackages"><span class="hs-identifier hs-var">getHCFilePackages</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083736"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; IO [UnitId]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- add package include paths even if we're just compiling .c</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-comment">-- files; this is the Value Add(TM) that using ghc instead of</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-comment">-- gcc gives you :)</span><span>
</span><span id="line-450"></span><span>  </span><span id="local-6989586621682083751"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621682083751"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MaybeErr UnitErr [UnitInfo] -&gt; IO [UnitInfo]
forall a. MaybeErr UnitErr a -&gt; IO a
</span><a href="GHC.Unit.State.html#mayThrowUnitErr"><span class="hs-identifier hs-var">mayThrowUnitErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitEnv -&gt; [UnitId] -&gt; MaybeErr UnitErr [UnitInfo]
</span><a href="GHC.Unit.Env.html#preloadUnitsInfo%27"><span class="hs-identifier hs-var">preloadUnitsInfo'</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682083739"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682083749"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083754"><span class="annot"><span class="annottext">pkg_include_dirs :: [String]
</span><a href="#local-6989586621682083754"><span class="hs-identifier hs-var hs-var">pkg_include_dirs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [String]
</span><a href="GHC.Unit.Info.html#collectIncludeDirs"><span class="hs-identifier hs-var">collectIncludeDirs</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621682083751"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083756"><span class="annot"><span class="annottext">include_paths_global :: [String]
</span><a href="#local-6989586621682083756"><span class="hs-identifier hs-var hs-var">include_paths_global</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String] -&gt; [String])
-&gt; [String] -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682083758"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083758"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682083759"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083759"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-I&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083758"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083759"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsGlobal"><span class="hs-identifier hs-var">includePathsGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621682083747"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083754"><span class="hs-identifier hs-var">pkg_include_dirs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083760"><span class="annot"><span class="annottext">include_paths_quote :: [String]
</span><a href="#local-6989586621682083760"><span class="hs-identifier hs-var hs-var">include_paths_quote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String] -&gt; [String])
-&gt; [String] -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#foldr/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621682083761"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083761"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621682083762"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083762"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-iquote&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083761"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083762"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-455"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuote"><span class="hs-identifier hs-var">includePathsQuote</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621682083747"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-456"></span><span>         </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuoteImplicit"><span class="hs-identifier hs-var">includePathsQuoteImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621682083747"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083763"><span class="annot"><span class="annottext">include_paths :: [String]
</span><a href="#local-6989586621682083763"><span class="hs-identifier hs-var hs-var">include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083760"><span class="hs-identifier hs-var">include_paths_quote</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083756"><span class="hs-identifier hs-var">include_paths_global</span></a></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-comment">-- pass -D or -optP to preprocessor when compiling foreign C files</span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-comment">-- (#16737). Doing it in this way is simpler and also enable the C</span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-comment">-- compiler to perform preprocessing and parsing in a single pass,</span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-comment">-- but it may introduce inconsistency if a different pgm_P is specified.</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083764"><span class="annot"><span class="annottext">opts :: [String]
</span><a href="#local-6989586621682083764"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_P"><span class="hs-identifier hs-var">opt_P</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span id="local-6989586621682083766"><span class="annot"><span class="annottext">aug_imports :: [String]
</span><a href="#local-6989586621682083766"><span class="hs-identifier hs-var hs-var">aug_imports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [String]
</span><a href="GHC.SysTools.Tasks.html#augmentImports"><span class="hs-identifier hs-var">augmentImports</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083764"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span>      </span><span id="local-6989586621682083768"><span class="annot"><span class="annottext">more_preprocessor_opts :: [String]
</span><a href="#local-6989586621682083768"><span class="hs-identifier hs-var hs-var">more_preprocessor_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[String]] -&gt; [String]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#concat/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-467"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xpreprocessor&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083769"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083744"><span class="hs-identifier hs-var">hcc</span></a></span><span>
</span><span id="line-469"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083769"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083769"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083766"><span class="hs-identifier hs-var">aug_imports</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083770"><span class="annot"><span class="annottext">gcc_extra_viac_flags :: [String]
</span><a href="#local-6989586621682083770"><span class="hs-identifier hs-var hs-var">gcc_extra_viac_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#extraGccViaCFlags"><span class="hs-identifier hs-var">extraGccViaCFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083772"><span class="annot"><span class="annottext">pic_c_flags :: [String]
</span><a href="#local-6989586621682083772"><span class="hs-identifier hs-var hs-var">pic_c_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#picCCOpts"><span class="hs-identifier hs-var">picCCOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083773"><span class="annot"><span class="annottext">verbFlags :: [String]
</span><a href="#local-6989586621682083773"><span class="hs-identifier hs-var hs-var">verbFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#getVerbFlags"><span class="hs-identifier hs-var">getVerbFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-comment">-- cc-options are not passed when compiling .hc files.  Our</span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-comment">-- hc code doesn't not #include any header files anyway, so these</span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-comment">-- options aren't necessary.</span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083775"><span class="annot"><span class="annottext">pkg_extra_cc_opts :: [String]
</span><a href="#local-6989586621682083775"><span class="hs-identifier hs-var hs-var">pkg_extra_cc_opts</span></a></span></span><span>
</span><span id="line-481"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083744"><span class="hs-identifier hs-var">hcc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-482"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [String]
</span><a href="GHC.Unit.Info.html#collectExtraCcOpts"><span class="hs-identifier hs-var">collectExtraCcOpts</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621682083751"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083777"><span class="annot"><span class="annottext">framework_paths :: [String]
</span><a href="#local-6989586621682083777"><span class="hs-identifier hs-var hs-var">framework_paths</span></a></span></span><span>
</span><span id="line-485"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#platformUsesFrameworks"><span class="hs-identifier hs-var">platformUsesFrameworks</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083743"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-486"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083779"><span class="annot"><span class="annottext">pkgFrameworkPaths :: [String]
</span><a href="#local-6989586621682083779"><span class="hs-identifier hs-var hs-var">pkgFrameworkPaths</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitInfo] -&gt; [String]
</span><a href="GHC.Unit.Info.html#collectFrameworksDirs"><span class="hs-identifier hs-var">collectFrameworksDirs</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621682083751"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-487"></span><span>                </span><span id="local-6989586621682083781"><span class="annot"><span class="annottext">cmdlineFrameworkPaths :: [String]
</span><a href="#local-6989586621682083781"><span class="hs-identifier hs-var hs-var">cmdlineFrameworkPaths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#frameworkPaths"><span class="hs-identifier hs-var">frameworkPaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-488"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-F&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083781"><span class="hs-identifier hs-var">cmdlineFrameworkPaths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083779"><span class="hs-identifier hs-var">pkgFrameworkPaths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-490"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083783"><span class="annot"><span class="annottext">cc_opt :: [String]
</span><a href="#local-6989586621682083783"><span class="hs-identifier hs-var hs-var">cc_opt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#llvmOptLevel"><span class="hs-identifier hs-var">llvmOptLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O2&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-493"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#llvmOptLevel"><span class="hs-identifier hs-var">llvmOptLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-494"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span>  </span><span id="local-6989586621682083784"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083784"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083733"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083734"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682083735"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-comment">-- we create directories for the object file, because it</span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-comment">-- might be a hierarchical module.</span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#createDirectoryIfMissing/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#takeDirectory/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083784"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-503"></span><span>    </span><span id="local-6989586621682083785"><span class="annot"><span class="annottext">more_hcc_opts :: [String]
</span><a href="#local-6989586621682083785"><span class="hs-identifier hs-var hs-var">more_hcc_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-504"></span><span>          </span><span class="hs-comment">-- on x86 the floating point regs have greater precision</span><span>
</span><span id="line-505"></span><span>          </span><span class="hs-comment">-- than a double, which leads to unpredictable results.</span><span>
</span><span id="line-506"></span><span>          </span><span class="hs-comment">-- By default, we turn this off with -ffloat-store unless</span><span>
</span><span id="line-507"></span><span>          </span><span class="hs-comment">-- the user specified -fexcess-precision.</span><span>
</span><span id="line-508"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083743"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86/GHC.Platform.ArchOS.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-509"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ExcessPrecision"><span class="hs-identifier hs-var">Opt_ExcessPrecision</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-ffloat-store&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-511"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span>          </span><span class="hs-comment">-- gcc's -fstrict-aliasing allows two accesses to memory</span><span>
</span><span id="line-514"></span><span>          </span><span class="hs-comment">-- to be considered non-aliasing if they have different types.</span><span>
</span><span id="line-515"></span><span>          </span><span class="hs-comment">-- This interacts badly with the C code we generate, which is</span><span>
</span><span id="line-516"></span><span>          </span><span class="hs-comment">-- very weakly typed, being derived from C--.</span><span>
</span><span id="line-517"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-fno-strict-aliasing&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>  </span><span id="local-6989586621682083789"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083789"><span class="hs-identifier hs-var">ghcVersionH</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitEnv -&gt; IO String
</span><a href="GHC.SysTools.Cpp.html#getGhcVersionPathName"><span class="hs-identifier hs-var">getGhcVersionPathName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682083739"><span class="hs-identifier hs-var">unit_env</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
String -&gt; (String -&gt; m a) -&gt; m a
</span><a href="GHC.Utils.Misc.html#withAtomicRename"><span class="hs-identifier hs-var">withAtomicRename</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083784"><span class="hs-identifier hs-var">output_fn</span></a></span><span> </span><span class="annot"><span class="annottext">((String -&gt; IO ()) -&gt; IO ()) -&gt; (String -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682083791"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083791"><span class="hs-identifier hs-var">temp_outputFilename</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-522"></span><span>    </span><span class="annot"><span class="annottext">Maybe ForeignSrcLang
-&gt; Logger -&gt; TmpFs -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runCc"><span class="hs-identifier hs-var">GHC.SysTools.runCc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; Maybe ForeignSrcLang
</span><a href="GHC.Driver.Phases.html#phaseForeignLanguage"><span class="hs-identifier hs-var">phaseForeignLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083732"><span class="hs-identifier hs-var">cc_phase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083738"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682083742"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-523"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-c&quot;</span></span><span>
</span><span id="line-524"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083736"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-525"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-526"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083791"><span class="hs-identifier hs-var">temp_outputFilename</span></a></span><span>
</span><span id="line-527"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-528"></span><span>                 </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-529"></span><span>                    </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083772"><span class="hs-identifier hs-var">pic_c_flags</span></a></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span>                 </span><span class="hs-comment">-- See Note [Produce big objects on Windows]</span><span>
</span><span id="line-532"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wa,-mbig-obj&quot;</span></span><span>
</span><span id="line-533"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSMinGW32/GHC.Platform.ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span>
</span><span id="line-534"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#target32Bit"><span class="hs-identifier hs-var">target32Bit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083737"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>          </span><span class="hs-comment">-- Stub files generated for foreign exports references the runIO_closure</span><span>
</span><span id="line-538"></span><span>          </span><span class="hs-comment">-- and runNonIO_closure symbols, which are defined in the base package.</span><span>
</span><span id="line-539"></span><span>          </span><span class="hs-comment">-- These symbols are imported into the stub.c file via RtsAPI.h, and the</span><span>
</span><span id="line-540"></span><span>          </span><span class="hs-comment">-- way we do the import depends on whether we're currently compiling</span><span>
</span><span id="line-541"></span><span>          </span><span class="hs-comment">-- the base package or not.</span><span>
</span><span id="line-542"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682083743"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#OSMinGW32/GHC.Platform.ArchOS.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-543"></span><span>                        </span><span class="annot"><span class="annottext">HomeUnit -&gt; UnitId -&gt; Bool
forall u. GenHomeUnit u -&gt; UnitId -&gt; Bool
</span><a href="GHC.Unit.Home.html#isHomeUnitId"><span class="hs-identifier hs-var">isHomeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682083740"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#baseUnitId"><span class="hs-identifier hs-var">baseUnitId</span></a></span><span>
</span><span id="line-544"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-DCOMPILING_BASE_PACKAGE&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>                 </span><span class="hs-comment">-- GCC 4.6+ doesn't like -Wimplicit when compiling C++.</span><span>
</span><span id="line-548"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083732"><span class="hs-identifier hs-var">cc_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Ccxx"><span class="hs-identifier hs-var">Ccxx</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083732"><span class="hs-identifier hs-var">cc_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cobjcxx"><span class="hs-identifier hs-var">Cobjcxx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wimplicit&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-550"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083744"><span class="hs-identifier hs-var">hcc</span></a></span><span>
</span><span id="line-553"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083770"><span class="hs-identifier hs-var">gcc_extra_viac_flags</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083785"><span class="hs-identifier hs-var">more_hcc_opts</span></a></span><span>
</span><span id="line-554"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083773"><span class="hs-identifier hs-var">verbFlags</span></a></span><span>
</span><span id="line-556"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083783"><span class="hs-identifier hs-var">cc_opt</span></a></span><span>
</span><span id="line-557"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-include&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083789"><span class="hs-identifier hs-var">ghcVersionH</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-558"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083777"><span class="hs-identifier hs-var">framework_paths</span></a></span><span>
</span><span id="line-559"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083763"><span class="hs-identifier hs-var">include_paths</span></a></span><span>
</span><span id="line-560"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083768"><span class="hs-identifier hs-var">more_preprocessor_opts</span></a></span><span>
</span><span id="line-561"></span><span>                 </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083775"><span class="hs-identifier hs-var">pkg_extra_cc_opts</span></a></span><span>
</span><span id="line-562"></span><span>                 </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083784"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="hs-comment">-- This is where all object files get written from, for hs-boot and hsig files as well.</span><span>
</span><span id="line-567"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runHscBackendPhase"><span class="hs-identifier hs-type">runHscBackendPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span>
</span><span id="line-568"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-569"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-570"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-571"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-572"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscBackendAction"><span class="hs-identifier hs-type">HscBackendAction</span></a></span><span>
</span><span id="line-573"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModIface.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#HomeModLinkable"><span class="hs-identifier hs-type">HomeModLinkable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span id="runHscBackendPhase"><span class="annot"><span class="annottext">runHscBackendPhase :: PipeEnv
-&gt; HscEnv
-&gt; ModuleName
-&gt; HscSource
-&gt; ModLocation
-&gt; HscBackendAction
-&gt; IO ([String], ModIface, HomeModLinkable, String)
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscBackendPhase"><span class="hs-identifier hs-var hs-var">runHscBackendPhase</span></a></span></span><span> </span><span id="local-6989586621682083799"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083799"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083800"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083801"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083801"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span id="local-6989586621682083802"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083802"><span class="hs-identifier hs-var">src_flavour</span></a></span></span><span> </span><span id="local-6989586621682083803"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083803"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621682083804"><span class="annot"><span class="annottext">HscBackendAction
</span><a href="#local-6989586621682083804"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083805"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-576"></span><span>      </span><span id="local-6989586621682083806"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083806"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-577"></span><span>      </span><span id="local-6989586621682083807"><span class="annot"><span class="annottext">o_file :: String
</span><a href="#local-6989586621682083807"><span class="hs-identifier hs-var hs-var">o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dynamicNow"><span class="hs-identifier hs-var">dynamicNow</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083803"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083803"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="hs-comment">-- The real object file</span><span>
</span><span id="line-578"></span><span>      </span><span id="local-6989586621682083811"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621682083811"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; Backend -&gt; Phase
</span><a href="GHC.Driver.Pipeline.Execute.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083802"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscBackendAction
</span><a href="#local-6989586621682083804"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-580"></span><span>      </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscUpdate"><span class="hs-identifier hs-type">HscUpdate</span></a></span><span> </span><span id="local-6989586621682083813"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083813"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-581"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCode"><span class="hs-identifier hs-var">backendGeneratesCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-582"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; IO ([String], ModIface, HomeModLinkable, String)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HscUpdate not relevant for NoBackend&quot;</span></span><span>
</span><span id="line-583"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCodeForHsBoot"><span class="hs-identifier hs-var">backendGeneratesCodeForHsBoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-584"></span><span>                </span><span class="hs-comment">-- In Interpreter way, there is just no linkable for hs-boot files</span><span>
</span><span id="line-585"></span><span>                </span><span class="hs-comment">-- and we don't want to write an empty `o-boot` file when we're not</span><span>
</span><span id="line-586"></span><span>                </span><span class="hs-comment">-- supposed to be writing any .o files (#22669)</span><span>
</span><span id="line-587"></span><span>                </span><span class="annot"><span class="annottext">([String], ModIface, HomeModLinkable, String)
-&gt; IO ([String], ModIface, HomeModLinkable, String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083813"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083807"><span class="hs-identifier hs-var">o_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-589"></span><span>                 </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083802"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-590"></span><span>                   </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>                     </span><span class="hs-comment">-- We need to create a REAL but empty .o file</span><span>
</span><span id="line-592"></span><span>                     </span><span class="hs-comment">-- because we are going to attempt to put it in a library</span><span>
</span><span id="line-593"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083818"><span class="annot"><span class="annottext">input_fn :: String
</span><a href="#local-6989586621682083818"><span class="hs-identifier hs-var hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runPhase&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe String
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083803"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>                         </span><span id="local-6989586621682083821"><span class="annot"><span class="annottext">basename :: String
</span><a href="#local-6989586621682083821"><span class="hs-identifier hs-var hs-var">basename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#dropExtension/System.FilePath.Posix.html#dropExtension"><span class="hs-identifier hs-var">dropExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083818"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-595"></span><span>                     </span><span class="annot"><span class="annottext">DynFlags -&gt; HscEnv -&gt; String -&gt; ModLocation -&gt; ModuleName -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#compileEmptyStub"><span class="hs-identifier hs-var">compileEmptyStub</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083821"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083803"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083801"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>                   </span><span class="hs-comment">-- In the case of hs-boot files, generate a dummy .o-boot</span><span>
</span><span id="line-598"></span><span>                   </span><span class="hs-comment">-- stamp file for the benefit of Make</span><span>
</span><span id="line-599"></span><span>                   </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#touchObjectFile"><span class="hs-identifier hs-var">touchObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083806"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083807"><span class="hs-identifier hs-var">o_file</span></a></span><span>
</span><span id="line-600"></span><span>                   </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HscUpdate not relevant for HscSrcFile&quot;</span></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>                 </span><span class="hs-comment">-- MP: I wonder if there are any lurking bugs here because we</span><span>
</span><span id="line-603"></span><span>                 </span><span class="hs-comment">-- return Linkable == emptyHomeModInfoLinkable, despite the fact that there is a</span><span>
</span><span id="line-604"></span><span>                 </span><span class="hs-comment">-- linkable (.o-boot) which we check for in `Iface/Recomp.hs` and</span><span>
</span><span id="line-605"></span><span>                 </span><span class="hs-comment">-- then will carry around the linkable if we're doing</span><span>
</span><span id="line-606"></span><span>                 </span><span class="hs-comment">-- recompilation.</span><span>
</span><span id="line-607"></span><span>                 </span><span class="annot"><span class="annottext">([String], ModIface, HomeModLinkable, String)
-&gt; IO ([String], ModIface, HomeModLinkable, String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083813"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083807"><span class="hs-identifier hs-var">o_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>      </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscRecomp"><span class="hs-identifier hs-type">HscRecomp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hscs_guts :: HscBackendAction -&gt; CgGuts
</span><a href="GHC.Unit.Module.Status.html#hscs_guts"><span class="hs-identifier hs-var">hscs_guts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682083826"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621682083826"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-609"></span><span>                  </span><span class="annot"><span class="annottext">hscs_mod_location :: HscBackendAction -&gt; ModLocation
</span><a href="GHC.Unit.Module.Status.html#hscs_mod_location"><span class="hs-identifier hs-var">hscs_mod_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682083828"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083828"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-610"></span><span>                  </span><span class="annot"><span class="annottext">hscs_partial_iface :: HscBackendAction -&gt; PartialModIface
</span><a href="GHC.Unit.Module.Status.html#hscs_partial_iface"><span class="hs-identifier hs-var">hscs_partial_iface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682083830"><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621682083830"><span class="hs-identifier hs-var">partial_iface</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-611"></span><span>                  </span><span class="annot"><span class="annottext">hscs_old_iface_hash :: HscBackendAction -&gt; Maybe Fingerprint
</span><a href="GHC.Unit.Module.Status.html#hscs_old_iface_hash"><span class="hs-identifier hs-var">hscs_old_iface_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621682083832"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682083832"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span></span><span>
</span><span id="line-612"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCode"><span class="hs-identifier hs-var">backendGeneratesCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-614"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; IO ([String], ModIface, HomeModLinkable, String)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HscRecomp not relevant for NoBackend&quot;</span></span><span>
</span><span id="line-615"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendWritesFiles"><span class="hs-identifier hs-var">backendWritesFiles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-616"></span><span>             </span><span class="hs-keyword">do</span><span>
</span><span id="line-617"></span><span>              </span><span id="local-6989586621682083834"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083834"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var">phaseOutputFilenameNew</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682083811"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083799"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe ModLocation
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083803"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621682083835"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083835"><span class="hs-identifier hs-var">outputFilename</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083836"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083836"><span class="hs-identifier hs-var">mStub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083837"><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621682083837"><span class="hs-identifier hs-var">foreign_files</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083838"><span class="annot"><span class="annottext">Maybe StgCgInfos
</span><a href="#local-6989586621682083838"><span class="hs-identifier hs-var">stg_infos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083839"><span class="annot"><span class="annottext">Maybe CmmCgInfos
</span><a href="#local-6989586621682083839"><span class="hs-identifier hs-var">cg_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>                </span><span class="annot"><span class="annottext">HscEnv
-&gt; CgGuts
-&gt; ModLocation
-&gt; String
-&gt; IO
     (String, Maybe String, [(ForeignSrcLang, String)],
      Maybe StgCgInfos, Maybe CmmCgInfos)
</span><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier hs-var">hscGenHardCode</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621682083826"><span class="hs-identifier hs-var">cgguts</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083828"><span class="hs-identifier hs-var">mod_location</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083834"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-621"></span><span>              </span><span id="local-6989586621682083841"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083841"><span class="hs-identifier hs-var">final_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; PartialModIface
-&gt; Maybe StgCgInfos
-&gt; Maybe CmmCgInfos
-&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier hs-var">mkFullIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621682083830"><span class="hs-identifier hs-var">partial_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StgCgInfos
</span><a href="#local-6989586621682083838"><span class="hs-identifier hs-var">stg_infos</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CmmCgInfos
</span><a href="#local-6989586621682083839"><span class="hs-identifier hs-var">cg_infos</span></a></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>              </span><span class="hs-comment">-- See Note [Writing interface files]</span><span>
</span><span id="line-624"></span><span>              </span><span class="annot"><span class="annottext">Logger
-&gt; DynFlags
-&gt; Bool
-&gt; ModIface
-&gt; Maybe Fingerprint
-&gt; ModLocation
-&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-var">hscMaybeWriteIface</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083806"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083841"><span class="hs-identifier hs-var">final_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682083832"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083828"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-625"></span><span>              </span><span id="local-6989586621682083844"><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682083844"><span class="hs-identifier hs-var">mlinkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-626"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Bool
</span><a href="GHC.Driver.Backend.html#backendGeneratesCode"><span class="hs-identifier hs-var">backendGeneratesCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Backend
</span><a href="GHC.Driver.Session.html#backend"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ByteCodeAndObjectCode"><span class="hs-identifier hs-var">Opt_ByteCodeAndObjectCode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-627"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-628"></span><span>                    </span><span id="local-6989586621682083846"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682083846"><span class="hs-identifier hs-var">bc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModuleName -&gt; CgInteractiveGuts -&gt; ModLocation -&gt; IO Linkable
</span><a href="GHC.Driver.Main.html#generateFreshByteCode"><span class="hs-identifier hs-var">generateFreshByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083801"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgGuts -&gt; CgInteractiveGuts
</span><a href="GHC.Driver.Main.html#mkCgInteractiveGuts"><span class="hs-identifier hs-var">mkCgInteractiveGuts</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621682083826"><span class="hs-identifier hs-var">cgguts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083828"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-629"></span><span>                    </span><span class="annot"><span class="annottext">HomeModLinkable -&gt; IO HomeModLinkable
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModLinkable -&gt; IO HomeModLinkable)
-&gt; HomeModLinkable -&gt; IO HomeModLinkable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#homeMod_bytecode"><span class="hs-identifier hs-var">homeMod_bytecode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682083846"><span class="hs-identifier hs-type">bc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-630"></span><span>
</span><span id="line-631"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable -&gt; IO HomeModLinkable
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>              </span><span id="local-6989586621682083850"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083850"><span class="hs-identifier hs-var">stub_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; Maybe String -&gt; IO (Maybe String)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; Maybe a -&gt; m (Maybe b)
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#compileStub"><span class="hs-identifier hs-var">compileStub</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083836"><span class="hs-identifier hs-var">mStub</span></a></span><span>
</span><span id="line-635"></span><span>              </span><span id="local-6989586621682083851"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083851"><span class="hs-identifier hs-var">foreign_os</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-636"></span><span>                </span><span class="annot"><span class="annottext">((ForeignSrcLang, String) -&gt; IO String)
-&gt; [(ForeignSrcLang, String)] -&gt; IO [String]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="../../base-4.18.2.1/src/Data.Traversable.html#mapM/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForeignSrcLang -&gt; String -&gt; IO String)
-&gt; (ForeignSrcLang, String) -&gt; IO String
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base-4.18.2.1/src/Data.Tuple.html#uncurry/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; ForeignSrcLang -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-var">compileForeign</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621682083837"><span class="hs-identifier hs-var">foreign_files</span></a></span><span>
</span><span id="line-637"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083853"><span class="annot"><span class="annottext">fos :: [String]
</span><a href="#local-6989586621682083853"><span class="hs-identifier hs-var hs-var">fos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; (String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#maybe/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
forall a. a -&gt; [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083850"><span class="hs-identifier hs-var">stub_o</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083851"><span class="hs-identifier hs-var">foreign_os</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span>              </span><span class="hs-comment">-- This is awkward, no linkable is produced here because we still</span><span>
</span><span id="line-640"></span><span>              </span><span class="hs-comment">-- have some way to do before the object file is produced</span><span>
</span><span id="line-641"></span><span>              </span><span class="hs-comment">-- In future we can split up the driver logic more so that this function</span><span>
</span><span id="line-642"></span><span>              </span><span class="hs-comment">-- is in TPipeline and in this branch we can invoke the rest of the backend phase.</span><span>
</span><span id="line-643"></span><span>              </span><span class="annot"><span class="annottext">([String], ModIface, HomeModLinkable, String)
-&gt; IO ([String], ModIface, HomeModLinkable, String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682083853"><span class="hs-identifier hs-var">fos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083841"><span class="hs-identifier hs-var">final_iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="#local-6989586621682083844"><span class="hs-identifier hs-var">mlinkable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083835"><span class="hs-identifier hs-var">outputFilename</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>           </span><span class="hs-keyword">else</span><span>
</span><span id="line-646"></span><span>              </span><span class="hs-comment">-- In interpreted mode the regular codeGen backend is not run so we</span><span>
</span><span id="line-647"></span><span>              </span><span class="hs-comment">-- generate a interface without codeGen info.</span><span>
</span><span id="line-648"></span><span>            </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>              </span><span id="local-6989586621682083855"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083855"><span class="hs-identifier hs-var">final_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; PartialModIface
-&gt; Maybe StgCgInfos
-&gt; Maybe CmmCgInfos
-&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier hs-var">mkFullIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621682083830"><span class="hs-identifier hs-var">partial_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StgCgInfos
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CmmCgInfos
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-650"></span><span>              </span><span class="annot"><span class="annottext">Logger
-&gt; DynFlags
-&gt; Bool
-&gt; ModIface
-&gt; Maybe Fingerprint
-&gt; ModLocation
-&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-var">hscMaybeWriteIface</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083806"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083805"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083855"><span class="hs-identifier hs-var">final_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682083832"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083803"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-651"></span><span>              </span><span id="local-6989586621682083856"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621682083856"><span class="hs-identifier hs-var">bc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModuleName -&gt; CgInteractiveGuts -&gt; ModLocation -&gt; IO Linkable
</span><a href="GHC.Driver.Main.html#generateFreshByteCode"><span class="hs-identifier hs-var">generateFreshByteCode</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083800"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083801"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgGuts -&gt; CgInteractiveGuts
</span><a href="GHC.Driver.Main.html#mkCgInteractiveGuts"><span class="hs-identifier hs-var">mkCgInteractiveGuts</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621682083826"><span class="hs-identifier hs-var">cgguts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083828"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-652"></span><span>              </span><span class="annot"><span class="annottext">([String], ModIface, HomeModLinkable, String)
-&gt; IO ([String], ModIface, HomeModLinkable, String)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621682083855"><span class="hs-identifier hs-var">final_iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Home.ModInfo.html#homeMod_bytecode"><span class="hs-identifier hs-var">homeMod_bytecode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682083856"><span class="hs-identifier hs-type">bc</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;interpreter&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runUnlitPhase"><span class="hs-identifier hs-type">runUnlitPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-656"></span><span id="runUnlitPhase"><span class="annot"><span class="annottext">runUnlitPhase :: HscEnv -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runUnlitPhase"><span class="hs-identifier hs-var hs-var">runUnlitPhase</span></a></span></span><span> </span><span id="local-6989586621682083857"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083857"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083858"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083858"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621682083859"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083859"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-658"></span><span>       </span><span class="hs-comment">-- escape the characters \, &quot;, and ', but don't try to escape</span><span>
</span><span id="line-659"></span><span>       </span><span class="hs-comment">-- Unicode or anything else (so we don't use Util.charToC</span><span>
</span><span id="line-660"></span><span>       </span><span class="hs-comment">-- here).  If we get this wrong, then in</span><span>
</span><span id="line-661"></span><span>       </span><span class="hs-comment">-- GHC.HsToCore.Ticks.isGoodTickSrcSpan where we check that the filename in</span><span>
</span><span id="line-662"></span><span>       </span><span class="hs-comment">-- a SrcLoc is the same as the source filename, the two will</span><span>
</span><span id="line-663"></span><span>       </span><span class="hs-comment">-- look bogusly different. See test:</span><span>
</span><span id="line-664"></span><span>       </span><span class="hs-comment">-- libraries/hpc/tests/function/subdir/tough2.hs</span><span>
</span><span id="line-665"></span><span>       </span><span id="local-6989586621682083860"><span class="annot"><span class="annottext">escape :: String -&gt; String
</span><a href="#local-6989586621682083860"><span class="hs-identifier hs-var hs-var">escape</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682083861"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083861"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083861"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-666"></span><span>       </span><span class="annot"><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682083862"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083862"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083862"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-667"></span><span>       </span><span class="annot"><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682083863"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083863"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083863"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-668"></span><span>       </span><span class="annot"><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682083864"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682083864"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682083865"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083865"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621682083864"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083865"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-669"></span><span>       </span><span class="annot"><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083866"><span class="annot"><span class="annottext">flags :: [Option]
</span><a href="#local-6989586621682083866"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- The -h option passes the file name for unlit to</span><span>
</span><span id="line-672"></span><span>                  </span><span class="hs-comment">-- put in a #line directive</span><span>
</span><span id="line-673"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-h&quot;</span></span><span>
</span><span id="line-674"></span><span>                  </span><span class="hs-comment">-- See Note [Don't normalise input filenames].</span><span>
</span><span id="line-675"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; String -&gt; Option
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621682083860"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083858"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-676"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083858"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-677"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083859"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-678"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083867"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083867"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083857"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-681"></span><span>        </span><span id="local-6989586621682083868"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682083868"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083857"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-682"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runUnlit"><span class="hs-identifier hs-var">GHC.SysTools.runUnlit</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682083868"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083867"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682083866"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083859"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#getFileArgs"><span class="hs-identifier hs-type">getFileArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Parser.Errors.Types.html#PsMessage"><span class="hs-identifier hs-type">PsMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.CmdLine.html#Warn"><span class="hs-identifier hs-type">Warn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span id="getFileArgs"><span class="annot"><span class="annottext">getFileArgs :: HscEnv -&gt; String -&gt; IO (DynFlags, Messages PsMessage, [Warn])
</span><a href="GHC.Driver.Pipeline.Execute.html#getFileArgs"><span class="hs-identifier hs-var hs-var">getFileArgs</span></a></span></span><span> </span><span id="local-6989586621682083870"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083870"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083871"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083871"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083872"><span class="annot"><span class="annottext">dflags0 :: DynFlags
</span><a href="#local-6989586621682083872"><span class="hs-identifier hs-var hs-var">dflags0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083870"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-689"></span><span>      </span><span id="local-6989586621682083873"><span class="annot"><span class="annottext">parser_opts :: ParserOpts
</span><a href="#local-6989586621682083873"><span class="hs-identifier hs-var hs-var">parser_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ParserOpts
</span><a href="GHC.Driver.Config.Parser.html#initParserOpts"><span class="hs-identifier hs-var">initParserOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083872"><span class="hs-identifier hs-var">dflags0</span></a></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682083875"><span class="annot"><span class="annottext">Messages PsMessage
</span><a href="#local-6989586621682083875"><span class="hs-identifier hs-var">warns0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083876"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621682083876"><span class="hs-identifier hs-var">src_opts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ParserOpts -&gt; String -&gt; IO (Messages PsMessage, [Located String])
</span><a href="GHC.Parser.Header.html#getOptionsFromFile"><span class="hs-identifier hs-var">getOptionsFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOpts
</span><a href="#local-6989586621682083873"><span class="hs-identifier hs-var">parser_opts</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083871"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682083878"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083878"><span class="hs-identifier hs-var">dflags1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083879"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621682083879"><span class="hs-identifier hs-var">unhandled_flags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083880"><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621682083880"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [Located String] -&gt; IO (DynFlags, [Located String], [Warn])
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags
-&gt; [Located String] -&gt; m (DynFlags, [Located String], [Warn])
</span><a href="GHC.Driver.Session.html#parseDynamicFilePragma"><span class="hs-identifier hs-var">parseDynamicFilePragma</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083872"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621682083876"><span class="hs-identifier hs-var">src_opts</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><span class="annottext">[Located String] -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; [Located String] -&gt; m ()
</span><a href="GHC.Parser.Header.html#checkProcessArgsResult"><span class="hs-identifier hs-var">checkProcessArgsResult</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621682083879"><span class="hs-identifier hs-var">unhandled_flags</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span class="annot"><span class="annottext">(DynFlags, Messages PsMessage, [Warn])
-&gt; IO (DynFlags, Messages PsMessage, [Warn])
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083878"><span class="hs-identifier hs-var">dflags1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Messages PsMessage
</span><a href="#local-6989586621682083875"><span class="hs-identifier hs-var">warns0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621682083880"><span class="hs-identifier hs-var">warns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runCppPhase"><span class="hs-identifier hs-type">runCppPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-697"></span><span id="runCppPhase"><span class="annot"><span class="annottext">runCppPhase :: HscEnv -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runCppPhase"><span class="hs-identifier hs-var hs-var">runCppPhase</span></a></span></span><span> </span><span id="local-6989586621682083883"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083883"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682083884"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083884"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621682083885"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083885"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-698"></span><span>  </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs
-&gt; DynFlags
-&gt; UnitEnv
-&gt; CppOpts
-&gt; String
-&gt; String
-&gt; IO ()
</span><a href="GHC.SysTools.Cpp.html#doCpp"><span class="hs-identifier hs-var">doCpp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083883"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083883"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083883"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083883"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-702"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.SysTools.Cpp.html#CppOpts"><span class="hs-identifier hs-type">CppOpts</span></a></span><span>
</span><span id="line-703"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cppUseCc :: Bool
</span><a href="GHC.SysTools.Cpp.html#cppUseCc"><span class="hs-identifier hs-var">cppUseCc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-704"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cppLinePragmas :: Bool
</span><a href="GHC.SysTools.Cpp.html#cppLinePragmas"><span class="hs-identifier hs-var">cppLinePragmas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-705"></span><span>              </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>           </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083884"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083885"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-707"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083885"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runHscPhase"><span class="hs-identifier hs-type">runHscPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscRecompStatus"><span class="hs-identifier hs-type">HscRecompStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span id="runHscPhase"><span class="annot"><span class="annottext">runHscPhase :: PipeEnv
-&gt; HscEnv
-&gt; String
-&gt; HscSource
-&gt; IO (HscEnv, ModSummary, HscRecompStatus)
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscPhase"><span class="hs-identifier hs-var hs-var">runHscPhase</span></a></span></span><span> </span><span id="local-6989586621682083886"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083886"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083887"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083887"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621682083888"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083888"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621682083889"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083889"><span class="hs-identifier hs-var">src_flavour</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083890"><span class="annot"><span class="annottext">dflags0 :: DynFlags
</span><a href="#local-6989586621682083890"><span class="hs-identifier hs-var hs-var">dflags0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083887"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span>
</span><span id="line-717"></span><span>      </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">src_basename :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_basename"><span class="hs-identifier hs-var">src_basename</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682083893"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083893"><span class="hs-identifier hs-var">basename</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-718"></span><span>               </span><span class="annot"><span class="annottext">src_suffix :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_suffix"><span class="hs-identifier hs-var">src_suffix</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682083895"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083895"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083886"><span class="hs-identifier hs-var">pipe_env</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>  </span><span class="hs-comment">-- we add the current directory (i.e. the directory in which</span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-comment">-- the .hs files resides) to the include path, since this is</span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-comment">-- what gcc does, and it's probably what you want.</span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083896"><span class="annot"><span class="annottext">current_dir :: String
</span><a href="#local-6989586621682083896"><span class="hs-identifier hs-var hs-var">current_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#takeDirectory/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083893"><span class="hs-identifier hs-var">basename</span></a></span><span>
</span><span id="line-724"></span><span>      </span><span id="local-6989586621682083897"><span class="annot"><span class="annottext">new_includes :: IncludeSpecs
</span><a href="#local-6989586621682083897"><span class="hs-identifier hs-var hs-var">new_includes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String] -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#addImplicitQuoteInclude"><span class="hs-identifier hs-var">addImplicitQuoteInclude</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621682083899"><span class="hs-identifier hs-var">paths</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083896"><span class="hs-identifier hs-var">current_dir</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-725"></span><span>      </span><span id="local-6989586621682083899"><span class="annot"><span class="annottext">paths :: IncludeSpecs
</span><a href="#local-6989586621682083899"><span class="hs-identifier hs-var hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083890"><span class="hs-identifier hs-var">dflags0</span></a></span><span>
</span><span id="line-726"></span><span>      </span><span id="local-6989586621682083900"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682083900"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083890"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var">includePaths</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682083897"><span class="hs-identifier hs-type">new_includes</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-727"></span><span>      </span><span id="local-6989586621682083901"><span class="annot"><span class="annottext">hsc_env1 :: HscEnv
</span><a href="#local-6989586621682083901"><span class="hs-identifier hs-var hs-var">hsc_env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; DynFlags -&gt; HscEnv -&gt; HscEnv
DynFlags -&gt; HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Env.html#hscSetFlags"><span class="hs-identifier hs-var">hscSetFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083900"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083887"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-comment">-- Initialise plugins as the flags passed into runHscPhase might have local plugins just</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-comment">-- specific to this module.</span><span>
</span><span id="line-731"></span><span>  </span><span id="local-6989586621682083903"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083903"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
</span><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier hs-var">initializePlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083901"><span class="hs-identifier hs-var">hsc_env1</span></a></span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-comment">-- gather the imports and module name</span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621682083904"><span class="annot"><span class="annottext">Maybe StringBuffer
</span><a href="#local-6989586621682083904"><span class="hs-identifier hs-var">hspp_buf</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682083905"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083905"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682083906"><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083906"><span class="hs-identifier hs-var">imps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682083907"><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083907"><span class="hs-identifier hs-var">src_imps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083908"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083908"><span class="hs-identifier hs-var">ghc_prim_imp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-735"></span><span>    </span><span id="local-6989586621682083909"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621682083909"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO StringBuffer
</span><a href="GHC.Data.StringBuffer.html#hGetStringBuffer"><span class="hs-identifier hs-var">hGetStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083888"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-736"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083911"><span class="annot"><span class="annottext">imp_prelude :: Bool
</span><a href="#local-6989586621682083911"><span class="hs-identifier hs-var hs-var">imp_prelude</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.ImplicitPrelude</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083900"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-737"></span><span>        </span><span id="local-6989586621682083914"><span class="annot"><span class="annottext">popts :: ParserOpts
</span><a href="#local-6989586621682083914"><span class="hs-identifier hs-var hs-var">popts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ParserOpts
</span><a href="GHC.Driver.Config.Parser.html#initParserOpts"><span class="hs-identifier hs-var">initParserOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083900"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-738"></span><span>        </span><span id="local-6989586621682083915"><span class="annot"><span class="annottext">rn_pkg_qual :: ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="#local-6989586621682083915"><span class="hs-identifier hs-var hs-var">rn_pkg_qual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv -&gt; ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="GHC.Rename.Names.html#renameRawPkgQual"><span class="hs-identifier hs-var">renameRawPkgQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083903"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span>        </span><span id="local-6989586621682083917"><span class="annot"><span class="annottext">rn_imps :: [(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083917"><span class="hs-identifier hs-var hs-var">rn_imps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((RawPkgQual, GenLocated SrcSpan ModuleName)
 -&gt; (PkgQual, GenLocated SrcSpan ModuleName))
-&gt; [(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#fmap/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682083918"><span class="annot"><span class="annottext">RawPkgQual
</span><a href="#local-6989586621682083918"><span class="hs-identifier hs-var">rpk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083919"><span class="annot"><span class="annottext">lmn :: GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682083919"><span class="hs-identifier hs-var">lmn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682083921"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083921"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; RawPkgQual -&gt; PkgQual
</span><a href="#local-6989586621682083915"><span class="hs-identifier hs-var">rn_pkg_qual</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083921"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">RawPkgQual
</span><a href="#local-6989586621682083918"><span class="hs-identifier hs-var">rpk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621682083919"><span class="hs-identifier hs-var">lmn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>    </span><span id="local-6989586621682083922"><span class="annot"><span class="annottext">Either
  (Messages PsMessage)
  ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
   [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
   GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682083922"><span class="hs-identifier hs-var">eimps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ParserOpts
-&gt; Bool
-&gt; StringBuffer
-&gt; String
-&gt; String
-&gt; IO
     (Either
        (Messages PsMessage)
        ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
         [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
         GenLocated SrcSpan ModuleName))
</span><a href="GHC.Parser.Header.html#getImports"><span class="hs-identifier hs-var">getImports</span></a></span><span> </span><span class="annot"><span class="annottext">ParserOpts
</span><a href="#local-6989586621682083914"><span class="hs-identifier hs-var">popts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083911"><span class="hs-identifier hs-var">imp_prelude</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621682083909"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083888"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083893"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083895"><span class="hs-identifier hs-var">suff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  (Messages PsMessage)
  ([(RawPkgQual, GenLocated SrcSpan ModuleName)],
   [(RawPkgQual, GenLocated SrcSpan ModuleName)], Bool,
   GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621682083922"><span class="hs-identifier hs-var">eimps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-742"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Left/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682083925"><span class="annot"><span class="annottext">Messages PsMessage
</span><a href="#local-6989586621682083925"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
-&gt; IO
     (Maybe StringBuffer, ModuleName,
      [(PkgQual, GenLocated SrcSpan ModuleName)],
      [(PkgQual, GenLocated SrcSpan ModuleName)], Bool)
forall (io :: * -&gt; *) a. MonadIO io =&gt; Messages GhcMessage -&gt; io a
</span><a href="GHC.Types.SourceError.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsMessage -&gt; GhcMessage
</span><a href="GHC.Driver.Errors.Types.html#GhcPsMessage"><span class="hs-identifier hs-var">GhcPsMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(PsMessage -&gt; GhcMessage)
-&gt; Messages PsMessage -&gt; Messages GhcMessage
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.18.2.1/src/Data.Functor.html#%3C%24%3E/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Messages PsMessage
</span><a href="#local-6989586621682083925"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/Data.Either.html#Right/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621682083929"><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083929"><span class="hs-identifier hs-var">src_imps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682083930"><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083930"><span class="hs-identifier hs-var">imps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682083931"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083931"><span class="hs-identifier hs-var">ghc_prim_imp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682083932"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083932"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe StringBuffer, ModuleName,
 [(PkgQual, GenLocated SrcSpan ModuleName)],
 [(PkgQual, GenLocated SrcSpan ModuleName)], Bool)
-&gt; IO
     (Maybe StringBuffer, ModuleName,
      [(PkgQual, GenLocated SrcSpan ModuleName)],
      [(PkgQual, GenLocated SrcSpan ModuleName)], Bool)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-744"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StringBuffer -&gt; Maybe StringBuffer
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621682083909"><span class="hs-identifier hs-var">buf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083932"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083917"><span class="hs-identifier hs-var">rn_imps</span></a></span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083930"><span class="hs-identifier hs-var">imps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
-&gt; [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083917"><span class="hs-identifier hs-var">rn_imps</span></a></span><span> </span><span class="annot"><span class="annottext">[(RawPkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083929"><span class="hs-identifier hs-var">src_imps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083931"><span class="hs-identifier hs-var">ghc_prim_imp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>  </span><span class="hs-comment">-- Take -o into account if present</span><span>
</span><span id="line-747"></span><span>  </span><span class="hs-comment">-- Very like -ohi, but we must *only* do this if we aren't linking</span><span>
</span><span id="line-748"></span><span>  </span><span class="hs-comment">-- (If we're linking then the -o applies to the linked thing, not to</span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-comment">-- the object file for one module.)</span><span>
</span><span id="line-750"></span><span>  </span><span class="hs-comment">-- Note the nasty duplication with the same computation in compileFile above</span><span>
</span><span id="line-751"></span><span>  </span><span id="local-6989586621682083933"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083933"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipeEnv -&gt; DynFlags -&gt; HscSource -&gt; ModuleName -&gt; IO ModLocation
</span><a href="GHC.Driver.Pipeline.Execute.html#mkOneShotModLocation"><span class="hs-identifier hs-var">mkOneShotModLocation</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083886"><span class="hs-identifier hs-var">pipe_env</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083900"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083889"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083905"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083935"><span class="annot"><span class="annottext">o_file :: String
</span><a href="#local-6989586621682083935"><span class="hs-identifier hs-var hs-var">o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083933"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="hs-comment">-- The real object file</span><span>
</span><span id="line-753"></span><span>      </span><span id="local-6989586621682083936"><span class="annot"><span class="annottext">hi_file :: String
</span><a href="#local-6989586621682083936"><span class="hs-identifier hs-var hs-var">hi_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083933"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-754"></span><span>      </span><span id="local-6989586621682083938"><span class="annot"><span class="annottext">hie_file :: String
</span><a href="#local-6989586621682083938"><span class="hs-identifier hs-var hs-var">hie_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083933"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-755"></span><span>      </span><span id="local-6989586621682083940"><span class="annot"><span class="annottext">dyn_o_file :: String
</span><a href="#local-6989586621682083940"><span class="hs-identifier hs-var hs-var">dyn_o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083933"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>  </span><span id="local-6989586621682083941"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682083941"><span class="hs-identifier hs-var">src_hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Fingerprint
</span><a href="../../base-4.18.2.1/src/GHC.Fingerprint.html#getFileHash/GHC.Fingerprint.html#getFileHash"><span class="hs-identifier hs-var">getFileHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083893"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083895"><span class="hs-identifier hs-var">suff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>  </span><span id="local-6989586621682083943"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083943"><span class="hs-identifier hs-var">hi_date</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083936"><span class="hs-identifier hs-var">hi_file</span></a></span><span>
</span><span id="line-759"></span><span>  </span><span id="local-6989586621682083945"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083945"><span class="hs-identifier hs-var">hie_date</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083938"><span class="hs-identifier hs-var">hie_file</span></a></span><span>
</span><span id="line-760"></span><span>  </span><span id="local-6989586621682083946"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083946"><span class="hs-identifier hs-var">o_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083935"><span class="hs-identifier hs-var">o_file</span></a></span><span>
</span><span id="line-761"></span><span>  </span><span id="local-6989586621682083947"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083947"><span class="hs-identifier hs-var">dyn_o_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083940"><span class="hs-identifier hs-var">dyn_o_file</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-comment">-- Tell the finder cache about this module</span><span>
</span><span id="line-764"></span><span>  </span><span id="local-6989586621682083948"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682083948"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083949"><span class="annot"><span class="annottext">home_unit :: HomeUnit
</span><a href="#local-6989586621682083949"><span class="hs-identifier hs-var hs-var">home_unit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomeUnit
</span><a href="GHC.Driver.Env.html#hsc_home_unit"><span class="hs-identifier hs-var">hsc_home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083903"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-766"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083950"><span class="annot"><span class="annottext">fc :: FinderCache
</span><a href="#local-6989586621682083950"><span class="hs-identifier hs-var hs-var">fc</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; FinderCache
</span><a href="GHC.Driver.Env.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083903"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-767"></span><span>    </span><span class="annot"><span class="annottext">FinderCache -&gt; HomeUnit -&gt; ModuleName -&gt; ModLocation -&gt; IO Module
</span><a href="GHC.Unit.Finder.html#addHomeModuleToFinder"><span class="hs-identifier hs-var">addHomeModuleToFinder</span></a></span><span> </span><span class="annot"><span class="annottext">FinderCache
</span><a href="#local-6989586621682083950"><span class="hs-identifier hs-var">fc</span></a></span><span> </span><span class="annot"><span class="annottext">HomeUnit
</span><a href="#local-6989586621682083949"><span class="hs-identifier hs-var">home_unit</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083905"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083933"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-comment">-- Make the ModSummary to hand to hscMain</span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-771"></span><span>    </span><span id="local-6989586621682083953"><span class="annot"><span class="annottext">mod_summary :: ModSummary
</span><a href="#local-6989586621682083953"><span class="hs-identifier hs-var hs-var">mod_summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-special">{</span><span>  </span><span class="annot"><span class="annottext">ms_mod :: Module
</span><a href="GHC.Unit.Module.ModSummary.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621682083948"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-772"></span><span>                                </span><span class="annot"><span class="annottext">ms_hsc_src :: HscSource
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083889"><span class="hs-identifier hs-var">src_flavour</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-773"></span><span>                                </span><span class="annot"><span class="annottext">ms_hspp_file :: String
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_file"><span class="hs-identifier hs-var">ms_hspp_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083888"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-774"></span><span>                                </span><span class="annot"><span class="annottext">ms_hspp_opts :: DynFlags
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083900"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-775"></span><span>                                </span><span class="annot"><span class="annottext">ms_hspp_buf :: Maybe StringBuffer
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hspp_buf"><span class="hs-identifier hs-var">ms_hspp_buf</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe StringBuffer
</span><a href="#local-6989586621682083904"><span class="hs-identifier hs-var">hspp_buf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-776"></span><span>                                </span><span class="annot"><span class="annottext">ms_location :: ModLocation
</span><a href="GHC.Unit.Module.ModSummary.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083933"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-777"></span><span>                                </span><span class="annot"><span class="annottext">ms_hs_hash :: Fingerprint
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hs_hash"><span class="hs-identifier hs-var">ms_hs_hash</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621682083941"><span class="hs-identifier hs-var">src_hash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-778"></span><span>                                </span><span class="annot"><span class="annottext">ms_obj_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_obj_date"><span class="hs-identifier hs-var">ms_obj_date</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083946"><span class="hs-identifier hs-var">o_mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-779"></span><span>                                </span><span class="annot"><span class="annottext">ms_dyn_obj_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_dyn_obj_date"><span class="hs-identifier hs-var">ms_dyn_obj_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083947"><span class="hs-identifier hs-var">dyn_o_mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-780"></span><span>                                </span><span class="annot"><span class="annottext">ms_parsed_mod :: Maybe HsParsedModule
</span><a href="GHC.Unit.Module.ModSummary.html#ms_parsed_mod"><span class="hs-identifier hs-var">ms_parsed_mod</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HsParsedModule
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-781"></span><span>                                </span><span class="annot"><span class="annottext">ms_iface_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083943"><span class="hs-identifier hs-var">hi_date</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-782"></span><span>                                </span><span class="annot"><span class="annottext">ms_hie_date :: Maybe UTCTime
</span><a href="GHC.Unit.Module.ModSummary.html#ms_hie_date"><span class="hs-identifier hs-var">ms_hie_date</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621682083945"><span class="hs-identifier hs-var">hie_date</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-783"></span><span>                                </span><span class="annot"><span class="annottext">ms_ghc_prim_import :: Bool
</span><a href="GHC.Unit.Module.ModSummary.html#ms_ghc_prim_import"><span class="hs-identifier hs-var">ms_ghc_prim_import</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682083908"><span class="hs-identifier hs-var">ghc_prim_imp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-784"></span><span>                                </span><span class="annot"><span class="annottext">ms_textual_imps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_textual_imps"><span class="hs-identifier hs-var">ms_textual_imps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083906"><span class="hs-identifier hs-var">imps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-785"></span><span>                                </span><span class="annot"><span class="annottext">ms_srcimps :: [(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Unit.Module.ModSummary.html#ms_srcimps"><span class="hs-identifier hs-var">ms_srcimps</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PkgQual, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621682083907"><span class="hs-identifier hs-var">src_imps</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-comment">-- run the compiler!</span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621682083970"><span class="hs-identifier hs-type">msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-790"></span><span>      </span><span id="local-6989586621682083970"><span class="annot"><span class="annottext">msg :: Messager
</span><a href="#local-6989586621682083970"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621682083971"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083971"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682083972"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621682083972"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span class="annot"><span class="annottext">ModuleGraphNode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; RecompileRequired -&gt; IO ()
</span><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier hs-var">oneShotMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083971"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621682083972"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span>  </span><span class="hs-comment">-- Need to set the knot-tying mutable variable for interface</span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-comment">-- files. See GHC.Tc.Utils.TcGblEnv.tcg_type_env_var.</span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-comment">-- See also Note [hsc_type_env_var hack]</span><span>
</span><span id="line-795"></span><span>  </span><span id="local-6989586621682083974"><span class="annot"><span class="annottext">IORef (NameEnv TyThing)
</span><a href="#local-6989586621682083974"><span class="hs-identifier hs-var">type_env_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing -&gt; IO (IORef (NameEnv TyThing))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base-4.18.2.1/src/GHC.IORef.html#newIORef/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083977"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621682083977"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083903"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#hsc_type_env_vars"><span class="hs-identifier hs-var">hsc_type_env_vars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Env.KnotVars.html#knotVarsFromModuleEnv"><span class="hs-identifier hs-type">knotVarsFromModuleEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.Env.html#mkModuleEnv"><span class="hs-identifier hs-type">mkModuleEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621682083948"><span class="hs-identifier hs-type">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621682083974"><span class="hs-identifier hs-type">type_env_var</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span>  </span><span id="local-6989586621682083981"><span class="annot"><span class="annottext">HscRecompStatus
</span><a href="#local-6989586621682083981"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; Maybe ModIface
-&gt; HomeModLinkable
-&gt; (Int, Int)
-&gt; IO HscRecompStatus
</span><a href="GHC.Driver.Main.html#hscRecompStatus"><span class="hs-identifier hs-var">hscRecompStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messager -&gt; Maybe Messager
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621682083970"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083977"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682083953"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-799"></span><span>                        </span><span class="annot"><span class="annottext">Maybe ModIface
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModLinkable
</span><a href="GHC.Unit.Home.ModInfo.html#emptyHomeModInfoLinkable"><span class="hs-identifier hs-var">emptyHomeModInfoLinkable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span>  </span><span class="annot"><span class="annottext">(HscEnv, ModSummary, HscRecompStatus)
-&gt; IO (HscEnv, ModSummary, HscRecompStatus)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682083977"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682083953"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscRecompStatus
</span><a href="#local-6989586621682083981"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="hs-comment">-- | Calculate the ModLocation from the provided DynFlags. This function is only used</span><span>
</span><span id="line-804"></span><span class="hs-comment">-- in one-shot mode and therefore takes into account the effect of -o/-ohi flags</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- (which do nothing in --make mode)</span><span>
</span><span id="line-806"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#mkOneShotModLocation"><span class="hs-identifier hs-type">mkOneShotModLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-807"></span><span id="mkOneShotModLocation"><span class="annot"><span class="annottext">mkOneShotModLocation :: PipeEnv -&gt; DynFlags -&gt; HscSource -&gt; ModuleName -&gt; IO ModLocation
</span><a href="GHC.Driver.Pipeline.Execute.html#mkOneShotModLocation"><span class="hs-identifier hs-var hs-var">mkOneShotModLocation</span></a></span></span><span> </span><span id="local-6989586621682083983"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083983"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682083984"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682083985"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083985"><span class="hs-identifier hs-var">src_flavour</span></a></span></span><span> </span><span id="local-6989586621682083986"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083986"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">src_basename :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_basename"><span class="hs-identifier hs-var">src_basename</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682083987"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083987"><span class="hs-identifier hs-var">basename</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-809"></span><span>             </span><span class="annot"><span class="annottext">src_suffix :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_suffix"><span class="hs-identifier hs-var">src_suffix</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621682083988"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083988"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682083983"><span class="hs-identifier hs-var">pipe_env</span></a></span><span>
</span><span id="line-810"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083989"><span class="annot"><span class="annottext">location1 :: ModLocation
</span><a href="#local-6989586621682083989"><span class="hs-identifier hs-var hs-var">location1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FinderOpts -&gt; ModuleName -&gt; String -&gt; String -&gt; ModLocation
</span><a href="GHC.Unit.Finder.html#mkHomeModLocation2"><span class="hs-identifier hs-var">mkHomeModLocation2</span></a></span><span> </span><span class="annot"><span class="annottext">FinderOpts
</span><a href="#local-6989586621682083991"><span class="hs-identifier hs-var">fopts</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621682083986"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083987"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083988"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span>    </span><span class="hs-comment">-- Boot-ify it if necessary</span><span>
</span><span id="line-813"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083992"><span class="annot"><span class="annottext">location2 :: ModLocation
</span><a href="#local-6989586621682083992"><span class="hs-identifier hs-var hs-var">location2</span></a></span></span><span>
</span><span id="line-814"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621682083985"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; ModLocation
</span><a href="GHC.Unit.Module.Location.html#addBootSuffixLocnOut"><span class="hs-identifier hs-var">addBootSuffixLocnOut</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083989"><span class="hs-identifier hs-var">location1</span></a></span><span>
</span><span id="line-815"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083989"><span class="hs-identifier hs-var">location1</span></a></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span>    </span><span class="hs-comment">-- Take -ohi into account if present</span><span>
</span><span id="line-819"></span><span>    </span><span class="hs-comment">-- This can't be done in mkHomeModuleLocation because</span><span>
</span><span id="line-820"></span><span>    </span><span class="hs-comment">-- it only applies to the module being compiles</span><span>
</span><span id="line-821"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083994"><span class="annot"><span class="annottext">ohi :: Maybe String
</span><a href="#local-6989586621682083994"><span class="hs-identifier hs-var hs-var">ohi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputHi"><span class="hs-identifier hs-var">outputHi</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-822"></span><span>        </span><span id="local-6989586621682083996"><span class="annot"><span class="annottext">location3 :: ModLocation
</span><a href="#local-6989586621682083996"><span class="hs-identifier hs-var hs-var">location3</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682083997"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682083997"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083994"><span class="hs-identifier hs-var">ohi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083992"><span class="hs-identifier hs-var">location2</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682083997"><span class="hs-identifier hs-type">fn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-823"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083992"><span class="hs-identifier hs-var">location2</span></a></span><span>
</span><span id="line-824"></span><span>
</span><span id="line-825"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682083998"><span class="annot"><span class="annottext">dynohi :: Maybe String
</span><a href="#local-6989586621682083998"><span class="hs-identifier hs-var hs-var">dynohi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#dynOutputHi"><span class="hs-identifier hs-var">dynOutputHi</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-826"></span><span>        </span><span id="local-6989586621682084000"><span class="annot"><span class="annottext">location4 :: ModLocation
</span><a href="#local-6989586621682084000"><span class="hs-identifier hs-var hs-var">location4</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682084001"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084001"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682083998"><span class="hs-identifier hs-var">dynohi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083996"><span class="hs-identifier hs-var">location3</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_dyn_hi_file"><span class="hs-identifier hs-var">ml_dyn_hi_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682084001"><span class="hs-identifier hs-type">fn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-827"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682083996"><span class="hs-identifier hs-var">location3</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-comment">-- Take -o into account if present</span><span>
</span><span id="line-830"></span><span>    </span><span class="hs-comment">-- Very like -ohi, but we must *only* do this if we aren't linking</span><span>
</span><span id="line-831"></span><span>    </span><span class="hs-comment">-- (If we're linking then the -o applies to the linked thing, not to</span><span>
</span><span id="line-832"></span><span>    </span><span class="hs-comment">-- the object file for one module.)</span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-comment">-- Note the nasty duplication with the same computation in compileFile</span><span>
</span><span id="line-834"></span><span>    </span><span class="hs-comment">-- above</span><span>
</span><span id="line-835"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084003"><span class="annot"><span class="annottext">expl_o_file :: Maybe String
</span><a href="#local-6989586621682084003"><span class="hs-identifier hs-var hs-var">expl_o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputFile_"><span class="hs-identifier hs-var">outputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-836"></span><span>        </span><span id="local-6989586621682084005"><span class="annot"><span class="annottext">expl_dyn_o_file :: Maybe String
</span><a href="#local-6989586621682084005"><span class="hs-identifier hs-var hs-var">expl_dyn_o_file</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#dynOutputFile_"><span class="hs-identifier hs-var">dynOutputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-837"></span><span>        </span><span id="local-6989586621682084007"><span class="annot"><span class="annottext">location5 :: ModLocation
</span><a href="#local-6989586621682084007"><span class="hs-identifier hs-var hs-var">location5</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682084008"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084008"><span class="hs-identifier hs-var">ofile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682084003"><span class="hs-identifier hs-var">expl_o_file</span></a></span><span>
</span><span id="line-838"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084009"><span class="annot"><span class="annottext">dyn_ofile :: String
</span><a href="#local-6989586621682084009"><span class="hs-identifier hs-var hs-var">dyn_ofile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084008"><span class="hs-identifier hs-var">ofile</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#-%3C.%3E/System.FilePath.Posix.html#-%3C.%3E"><span class="hs-operator hs-var">-&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#dynObjectSuf_"><span class="hs-identifier hs-var">dynObjectSuf_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682084005"><span class="hs-identifier hs-var">expl_dyn_o_file</span></a></span><span>
</span><span id="line-839"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; Bool
</span><a href="GHC.Driver.Session.html#isNoLink"><span class="hs-identifier hs-var">isNoLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682084000"><span class="hs-identifier hs-var">location4</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682084008"><span class="hs-identifier hs-type">ofile</span></a></span><span>
</span><span id="line-841"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682084009"><span class="hs-identifier hs-type">dyn_ofile</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-842"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682084015"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084015"><span class="hs-identifier hs-var">dyn_ofile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682084005"><span class="hs-identifier hs-var">expl_dyn_o_file</span></a></span><span>
</span><span id="line-843"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682084000"><span class="hs-identifier hs-var">location4</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621682084015"><span class="hs-identifier hs-type">dyn_ofile</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-844"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682084000"><span class="hs-identifier hs-var">location4</span></a></span><span>
</span><span id="line-845"></span><span>    </span><span class="annot"><span class="annottext">ModLocation -&gt; IO ModLocation
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682084007"><span class="hs-identifier hs-var">location5</span></a></span><span>
</span><span id="line-846"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-847"></span><span>      </span><span id="local-6989586621682083991"><span class="annot"><span class="annottext">fopts :: FinderOpts
</span><a href="#local-6989586621682083991"><span class="hs-identifier hs-var hs-var">fopts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; FinderOpts
</span><a href="GHC.Driver.Config.Finder.html#initFinderOpts"><span class="hs-identifier hs-var">initFinderOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682083984"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runHscTcPhase"><span class="hs-identifier hs-type">runHscTcPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#FrontendResult"><span class="hs-identifier hs-type">FrontendResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span id="runHscTcPhase"><span class="annot"><span class="annottext">runHscTcPhase :: HscEnv -&gt; ModSummary -&gt; IO (FrontendResult, Messages GhcMessage)
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscTcPhase"><span class="hs-identifier hs-var hs-var">runHscTcPhase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; IO (FrontendResult, Messages GhcMessage)
</span><a href="GHC.Driver.Main.html#hscTypecheckAndGetWarnings"><span class="hs-identifier hs-var">hscTypecheckAndGetWarnings</span></a></span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runHscPostTcPhase"><span class="hs-identifier hs-type">runHscPostTcPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-853"></span><span>    </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModSummary.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-855"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#FrontendResult"><span class="hs-identifier hs-type">FrontendResult</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Errors.Types.html#GhcMessage"><span class="hs-identifier hs-type">GhcMessage</span></a></span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Fingerprint.Type.html#Fingerprint/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Status.html#HscBackendAction"><span class="hs-identifier hs-type">HscBackendAction</span></a></span><span>
</span><span id="line-859"></span><span id="runHscPostTcPhase"><span class="annot"><span class="annottext">runHscPostTcPhase :: HscEnv
-&gt; ModSummary
-&gt; FrontendResult
-&gt; Messages GhcMessage
-&gt; Maybe Fingerprint
-&gt; IO HscBackendAction
</span><a href="GHC.Driver.Pipeline.Execute.html#runHscPostTcPhase"><span class="hs-identifier hs-var hs-var">runHscPostTcPhase</span></a></span></span><span> </span><span id="local-6989586621682084018"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084018"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682084019"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682084019"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621682084020"><span class="annot"><span class="annottext">FrontendResult
</span><a href="#local-6989586621682084020"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span id="local-6989586621682084021"><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621682084021"><span class="hs-identifier hs-var">tc_warnings</span></a></span></span><span> </span><span id="local-6989586621682084022"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682084022"><span class="hs-identifier hs-var">mb_old_hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-860"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc HscBackendAction -&gt; IO HscBackendAction
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Env.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084018"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc HscBackendAction -&gt; IO HscBackendAction)
-&gt; Hsc HscBackendAction -&gt; IO HscBackendAction
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-861"></span><span>            </span><span class="annot"><span class="annottext">ModSummary
-&gt; FrontendResult
-&gt; Messages GhcMessage
-&gt; Maybe Fingerprint
-&gt; Hsc HscBackendAction
</span><a href="GHC.Driver.Main.html#hscDesugarAndSimplify"><span class="hs-identifier hs-var">hscDesugarAndSimplify</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621682084019"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">FrontendResult
</span><a href="#local-6989586621682084020"><span class="hs-identifier hs-var">tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">Messages GhcMessage
</span><a href="#local-6989586621682084021"><span class="hs-identifier hs-var">tc_warnings</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621682084022"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#runHsPpPhase"><span class="hs-identifier hs-type">runHsPpPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-865"></span><span id="runHsPpPhase"><span class="annot"><span class="annottext">runHsPpPhase :: HscEnv -&gt; String -&gt; String -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#runHsPpPhase"><span class="hs-identifier hs-var hs-var">runHsPpPhase</span></a></span></span><span> </span><span id="local-6989586621682084025"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084025"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682084026"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084026"><span class="hs-identifier hs-var">orig_fn</span></a></span></span><span> </span><span id="local-6989586621682084027"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084027"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621682084028"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084028"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-866"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084029"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682084029"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084025"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084030"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682084030"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084025"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-868"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runPp"><span class="hs-identifier hs-var">GHC.SysTools.runPp</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084030"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084029"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-869"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084026"><span class="hs-identifier hs-var">orig_fn</span></a></span><span>
</span><span id="line-870"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084027"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-871"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084028"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-872"></span><span>      </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-873"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084028"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-type">phaseOutputFilenameNew</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ The next phase</span></span><span>
</span><span id="line-876"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span>
</span><span id="line-877"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-878"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="annot"><span class="hs-comment">-- ^ A ModLocation, if we are compiling a Haskell source file</span></span><span>
</span><span id="line-879"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-880"></span><span id="phaseOutputFilenameNew"><span class="annot"><span class="annottext">phaseOutputFilenameNew :: Phase -&gt; PipeEnv -&gt; HscEnv -&gt; Maybe ModLocation -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#phaseOutputFilenameNew"><span class="hs-identifier hs-var hs-var">phaseOutputFilenameNew</span></a></span></span><span> </span><span id="local-6989586621682084032"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084032"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span> </span><span id="local-6989586621682084033"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682084033"><span class="hs-identifier hs-var">pipe_env</span></a></span></span><span> </span><span id="local-6989586621682084034"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084034"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682084035"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682084035"><span class="hs-identifier hs-var">maybe_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621682084036"><span class="annot"><span class="annottext">StopPhase
stop_phase :: StopPhase
stop_phase :: PipeEnv -&gt; StopPhase
</span><a href="#local-6989586621682084036"><span class="hs-identifier hs-var hs-var">stop_phase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682084038"><span class="annot"><span class="annottext">String
src_basename :: PipeEnv -&gt; String
src_basename :: String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_basename"><span class="hs-identifier hs-var hs-var">src_basename</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682084039"><span class="annot"><span class="annottext">PipelineOutput
output_spec :: PipelineOutput
output_spec :: PipeEnv -&gt; PipelineOutput
</span><a href="#local-6989586621682084039"><span class="hs-identifier hs-var hs-var">output_spec</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621682084033"><span class="hs-identifier hs-var">pipe_env</span></a></span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084041"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682084041"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084034"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-883"></span><span>      </span><span id="local-6989586621682084042"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682084042"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084034"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-884"></span><span>      </span><span id="local-6989586621682084043"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621682084043"><span class="hs-identifier hs-var hs-var">tmpfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084034"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-885"></span><span>  </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs
-&gt; Phase
-&gt; PipelineOutput
-&gt; String
-&gt; DynFlags
-&gt; Phase
-&gt; Maybe ModLocation
-&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#getOutputFilename"><span class="hs-identifier hs-var">getOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084042"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084043"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StopPhase -&gt; Phase
</span><a href="GHC.Driver.Phases.html#stopPhaseToPhase"><span class="hs-identifier hs-var">stopPhaseToPhase</span></a></span><span> </span><span class="annot"><span class="annottext">StopPhase
</span><a href="#local-6989586621682084036"><span class="hs-identifier hs-var">stop_phase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621682084039"><span class="hs-identifier hs-var">output_spec</span></a></span><span>
</span><span id="line-886"></span><span>                    </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084038"><span class="hs-identifier hs-var">src_basename</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084041"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084032"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682084035"><span class="hs-identifier hs-var">maybe_loc</span></a></span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span class="hs-comment">-- | Computes the next output filename for something in the compilation</span><span>
</span><span id="line-890"></span><span class="hs-comment">-- pipeline.  This is controlled by several variables:</span><span>
</span><span id="line-891"></span><span class="hs-comment">--</span><span>
</span><span id="line-892"></span><span class="hs-comment">--      1. 'Phase': the last phase to be run (e.g. 'stopPhase').  This</span><span>
</span><span id="line-893"></span><span class="hs-comment">--         is used to tell if we're in the last phase or not, because</span><span>
</span><span id="line-894"></span><span class="hs-comment">--         in that case flags like @-o@ may be important.</span><span>
</span><span id="line-895"></span><span class="hs-comment">--      2. 'PipelineOutput': is this intended to be a 'Temporary' or</span><span>
</span><span id="line-896"></span><span class="hs-comment">--         'Persistent' build output?  Temporary files just go in</span><span>
</span><span id="line-897"></span><span class="hs-comment">--         a fresh temporary name.</span><span>
</span><span id="line-898"></span><span class="hs-comment">--      3. 'String': what was the basename of the original input file?</span><span>
</span><span id="line-899"></span><span class="hs-comment">--      4. 'DynFlags': the obvious thing</span><span>
</span><span id="line-900"></span><span class="hs-comment">--      5. 'Phase': the phase we want to determine the output filename of.</span><span>
</span><span id="line-901"></span><span class="hs-comment">--      6. @Maybe ModLocation@: the 'ModLocation' of the module we're</span><span>
</span><span id="line-902"></span><span class="hs-comment">--         compiling; this can be used to override the default output</span><span>
</span><span id="line-903"></span><span class="hs-comment">--         of an object file.  (TODO: do we actually need this?)</span><span>
</span><span id="line-904"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#getOutputFilename"><span class="hs-identifier hs-type">getOutputFilename</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span>
</span><span id="line-907"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>
</span><span id="line-908"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipelineOutput"><span class="hs-identifier hs-type">PipelineOutput</span></a></span><span>
</span><span id="line-909"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-910"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-911"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="hs-comment">-- next phase</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-914"></span><span id="getOutputFilename"><span class="annot"><span class="annottext">getOutputFilename :: Logger
-&gt; TmpFs
-&gt; Phase
-&gt; PipelineOutput
-&gt; String
-&gt; DynFlags
-&gt; Phase
-&gt; Maybe ModLocation
-&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#getOutputFilename"><span class="hs-identifier hs-var hs-var">getOutputFilename</span></a></span></span><span> </span><span id="local-6989586621682084050"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084050"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682084051"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084051"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682084052"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084052"><span class="hs-identifier hs-var">stop_phase</span></a></span></span><span> </span><span id="local-6989586621682084053"><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621682084053"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621682084054"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084054"><span class="hs-identifier hs-var">basename</span></a></span></span><span> </span><span id="local-6989586621682084055"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682084056"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084056"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span> </span><span id="local-6989586621682084057"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682084057"><span class="hs-identifier hs-var">maybe_location</span></a></span></span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-comment">-- 1. If we are generating object files for a .hs file, then return the odir as the ModLocation</span><span>
</span><span id="line-916"></span><span>  </span><span class="hs-comment">-- will have been modified to point to the accurate locations</span><span>
</span><span id="line-917"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084056"><span class="hs-identifier hs-var">next_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682084058"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682084058"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621682084057"><span class="hs-identifier hs-var">maybe_location</span></a></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-918"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dynamicNow"><span class="hs-identifier hs-var">dynamicNow</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_dyn_obj_file"><span class="hs-identifier hs-var">ml_dyn_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682084058"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-919"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621682084058"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-920"></span><span> </span><span class="hs-comment">-- 2. If output style is persistent then</span><span>
</span><span id="line-921"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084059"><span class="hs-identifier hs-var">is_last_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Persistent"><span class="hs-identifier hs-var">Persistent</span></a></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621682084053"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="#local-6989586621682084060"><span class="hs-identifier hs-var">persistent_fn</span></a></span><span>
</span><span id="line-922"></span><span> </span><span class="hs-comment">-- 3. Specific file is only set when outputFile is set by -o</span><span>
</span><span id="line-923"></span><span> </span><span class="hs-comment">-- If we are in dynamic mode but -dyno is not set then write to the same path as</span><span>
</span><span id="line-924"></span><span> </span><span class="hs-comment">-- -o with a .dyn_* extension. This case is not triggered for object files which</span><span>
</span><span id="line-925"></span><span> </span><span class="hs-comment">-- are always handled by the ModLocation.</span><span>
</span><span id="line-926"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084059"><span class="hs-identifier hs-var">is_last_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#SpecificFile"><span class="hs-identifier hs-var">SpecificFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621682084053"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-927"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dynamicNow"><span class="hs-identifier hs-var">dynamicNow</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-929"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#dynOutputFile_"><span class="hs-identifier hs-var">dynOutputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-930"></span><span>                </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084062"><span class="annot"><span class="annottext">ofile :: String
</span><a href="#local-6989586621682084062"><span class="hs-identifier hs-var hs-var">ofile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="#local-6989586621682084063"><span class="hs-identifier hs-var">getOutputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-931"></span><span>                               </span><span id="local-6989586621682084064"><span class="annot"><span class="annottext">new_ext :: String
</span><a href="#local-6989586621682084064"><span class="hs-identifier hs-var hs-var">new_ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#takeExtension/System.FilePath.Posix.html#takeExtension"><span class="hs-identifier hs-var">takeExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084062"><span class="hs-identifier hs-var">ofile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-932"></span><span>                                            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dyn&quot;</span></span><span>
</span><span id="line-933"></span><span>                                            </span><span id="local-6989586621682084066"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084066"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dyn_&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.List.html#tail/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084066"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-934"></span><span>                           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#replaceExtension/System.FilePath.Posix.html#replaceExtension"><span class="hs-identifier hs-var">replaceExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084062"><span class="hs-identifier hs-var">ofile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084064"><span class="hs-identifier hs-var">new_ext</span></a></span><span>
</span><span id="line-935"></span><span>                </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682084069"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084069"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084069"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-936"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="#local-6989586621682084063"><span class="hs-identifier hs-var">getOutputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-937"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084070"><span class="hs-identifier hs-var">keep_this_output</span></a></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="#local-6989586621682084060"><span class="hs-identifier hs-var">persistent_fn</span></a></span><span>
</span><span id="line-938"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-type">Temporary</span></a></span><span> </span><span id="local-6989586621682084071"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621682084071"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621682084053"><span class="hs-identifier hs-var">output</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084050"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084051"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621682084071"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084072"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-939"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084050"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084051"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span>
</span><span id="line-940"></span><span>   </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084072"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-942"></span><span>          </span><span id="local-6989586621682084063"><span class="annot"><span class="annottext">getOutputFile_ :: DynFlags -&gt; String
</span><a href="#local-6989586621682084063"><span class="hs-identifier hs-var hs-var">getOutputFile_</span></a></span></span><span> </span><span id="local-6989586621682084079"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084079"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-943"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputFile_"><span class="hs-identifier hs-var">outputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084079"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-944"></span><span>              </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; String
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SpecificFile: No filename&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dynamicNow"><span class="hs-identifier hs-var">dynamicNow</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084079"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-945"></span><span>                                                               </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#fromMaybe/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#dynOutputFile_"><span class="hs-identifier hs-var">dynOutputFile_</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084079"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-946"></span><span>              </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682084083"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084083"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084083"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span>          </span><span id="local-6989586621682084084"><span class="annot"><span class="annottext">hcsuf :: String
</span><a href="#local-6989586621682084084"><span class="hs-identifier hs-var hs-var">hcsuf</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#hcSuf"><span class="hs-identifier hs-var">hcSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-949"></span><span>          </span><span id="local-6989586621682084086"><span class="annot"><span class="annottext">odir :: Maybe String
</span><a href="#local-6989586621682084086"><span class="hs-identifier hs-var hs-var">odir</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#objectDir"><span class="hs-identifier hs-var">objectDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-950"></span><span>          </span><span id="local-6989586621682084088"><span class="annot"><span class="annottext">osuf :: String
</span><a href="#local-6989586621682084088"><span class="hs-identifier hs-var hs-var">osuf</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#objectSuf"><span class="hs-identifier hs-var">objectSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-951"></span><span>          </span><span id="local-6989586621682084090"><span class="annot"><span class="annottext">keep_hc :: Bool
</span><a href="#local-6989586621682084090"><span class="hs-identifier hs-var hs-var">keep_hc</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepHcFiles"><span class="hs-identifier hs-var">Opt_KeepHcFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-952"></span><span>          </span><span id="local-6989586621682084092"><span class="annot"><span class="annottext">keep_hscpp :: Bool
</span><a href="#local-6989586621682084092"><span class="hs-identifier hs-var hs-var">keep_hscpp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepHscppFiles"><span class="hs-identifier hs-var">Opt_KeepHscppFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-953"></span><span>          </span><span id="local-6989586621682084094"><span class="annot"><span class="annottext">keep_s :: Bool
</span><a href="#local-6989586621682084094"><span class="hs-identifier hs-var hs-var">keep_s</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepSFiles"><span class="hs-identifier hs-var">Opt_KeepSFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-954"></span><span>          </span><span id="local-6989586621682084096"><span class="annot"><span class="annottext">keep_bc :: Bool
</span><a href="#local-6989586621682084096"><span class="hs-identifier hs-var hs-var">keep_bc</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepLlvmFiles"><span class="hs-identifier hs-var">Opt_KeepLlvmFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084055"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span>          </span><span id="local-6989586621682084098"><span class="annot"><span class="annottext">myPhaseInputExt :: Phase -&gt; String
</span><a href="#local-6989586621682084098"><span class="hs-identifier hs-var hs-var">myPhaseInputExt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084084"><span class="hs-identifier hs-var">hcsuf</span></a></span><span>
</span><span id="line-957"></span><span>          </span><span class="annot"><a href="#local-6989586621682084098"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#MergeForeign"><span class="hs-identifier hs-var">MergeForeign</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084088"><span class="hs-identifier hs-var">osuf</span></a></span><span>
</span><span id="line-958"></span><span>          </span><span class="annot"><a href="#local-6989586621682084098"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084088"><span class="hs-identifier hs-var">osuf</span></a></span><span>
</span><span id="line-959"></span><span>          </span><span class="annot"><a href="#local-6989586621682084098"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span id="local-6989586621682084100"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084100"><span class="hs-identifier hs-var">other</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
</span><a href="GHC.Driver.Phases.html#phaseInputExt"><span class="hs-identifier hs-var">phaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084100"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span>          </span><span id="local-6989586621682084059"><span class="annot"><span class="annottext">is_last_phase :: Bool
</span><a href="#local-6989586621682084059"><span class="hs-identifier hs-var hs-var">is_last_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084056"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#eqPhase"><span class="hs-operator hs-var">`eqPhase`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084052"><span class="hs-identifier hs-var">stop_phase</span></a></span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span>          </span><span class="hs-comment">-- sometimes, we keep output from intermediate stages</span><span>
</span><span id="line-964"></span><span>          </span><span id="local-6989586621682084070"><span class="annot"><span class="annottext">keep_this_output :: Bool
</span><a href="#local-6989586621682084070"><span class="hs-identifier hs-var hs-var">keep_this_output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-965"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084056"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-966"></span><span>                       </span><span class="annot"><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-type">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084094"><span class="hs-identifier hs-var">keep_s</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-967"></span><span>                       </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmOpt"><span class="hs-identifier hs-var">LlvmOpt</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084096"><span class="hs-identifier hs-var">keep_bc</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-968"></span><span>                       </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084090"><span class="hs-identifier hs-var">keep_hc</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-969"></span><span>                       </span><span class="annot"><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-type">HsPp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084092"><span class="hs-identifier hs-var">keep_hscpp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- See #10869</span><span>
</span><span id="line-970"></span><span>                       </span><span id="local-6989586621682084103"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084103"><span class="hs-identifier hs-var">_other</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-971"></span><span>
</span><span id="line-972"></span><span>          </span><span id="local-6989586621682084072"><span class="annot"><span class="annottext">suffix :: String
</span><a href="#local-6989586621682084072"><span class="hs-identifier hs-var hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
</span><a href="#local-6989586621682084098"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084056"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span>          </span><span class="hs-comment">-- persistent object files get put in odir</span><span>
</span><span id="line-975"></span><span>          </span><span id="local-6989586621682084060"><span class="annot"><span class="annottext">persistent_fn :: IO String
</span><a href="#local-6989586621682084060"><span class="hs-identifier hs-var hs-var">persistent_fn</span></a></span></span><span>
</span><span id="line-976"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621682084056"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084104"><span class="hs-identifier hs-var">odir_persistent</span></a></span><span>
</span><span id="line-977"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084105"><span class="hs-identifier hs-var">persistent</span></a></span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span>          </span><span id="local-6989586621682084105"><span class="annot"><span class="annottext">persistent :: String
</span><a href="#local-6989586621682084105"><span class="hs-identifier hs-var hs-var">persistent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084054"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#%3C.%3E/System.FilePath.Posix.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084072"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span>          </span><span id="local-6989586621682084104"><span class="annot"><span class="annottext">odir_persistent :: String
</span><a href="#local-6989586621682084104"><span class="hs-identifier hs-var hs-var">odir_persistent</span></a></span></span><span>
</span><span id="line-982"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682084106"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084106"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621682084086"><span class="hs-identifier hs-var">odir</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084106"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084105"><span class="hs-identifier hs-var">persistent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084105"><span class="hs-identifier hs-var">persistent</span></a></span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="hs-comment">-- | LLVM Options. These are flags to be passed to opt and llc, to ensure</span><span>
</span><span id="line-987"></span><span class="hs-comment">-- consistency we list them in pairs, so that they form groups.</span><span>
</span><span id="line-988"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#llvmOptions"><span class="hs-identifier hs-type">llvmOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.CmmToLlvm.Config.html#LlvmConfig"><span class="hs-identifier hs-type">LlvmConfig</span></a></span><span>
</span><span id="line-989"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-990"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="annot"><span class="hs-comment">-- ^ pairs of (opt, llc) arguments</span></span><span>
</span><span id="line-991"></span><span id="llvmOptions"><span class="annot"><span class="annottext">llvmOptions :: LlvmConfig -&gt; DynFlags -&gt; [(String, String)]
</span><a href="GHC.Driver.Pipeline.Execute.html#llvmOptions"><span class="hs-identifier hs-var hs-var">llvmOptions</span></a></span></span><span> </span><span id="local-6989586621682084108"><span class="annot"><span class="annottext">LlvmConfig
</span><a href="#local-6989586621682084108"><span class="hs-identifier hs-var">llvm_config</span></a></span></span><span> </span><span id="local-6989586621682084109"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-992"></span><span>       </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-enable-tbaa -tbaa&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-enable-tbaa&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_LlvmTBAA"><span class="hs-identifier hs-var">Opt_LlvmTBAA</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-993"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-relocation-model=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084111"><span class="hs-identifier hs-var">rmodel</span></a></span><span>
</span><span id="line-994"></span><span>        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-relocation-model=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084111"><span class="hs-identifier hs-var">rmodel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084111"><span class="hs-identifier hs-var">rmodel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-995"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-stack-alignment=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682084112"><span class="hs-identifier hs-var">align</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-stack-alignment=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.18.2.1/src/GHC.Show.html#show/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682084112"><span class="hs-identifier hs-var">align</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682084112"><span class="hs-identifier hs-var">align</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span>    </span><span class="hs-comment">-- Additional llc flags</span><span>
</span><span id="line-999"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mcpu=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084114"><span class="hs-identifier hs-var">mcpu</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084114"><span class="hs-identifier hs-var">mcpu</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#any/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#isInfixOf/Data.OldList.html#isInfixOf"><span class="hs-identifier hs-var">isInfixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mcpu&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_lc"><span class="hs-identifier hs-var">opt_lc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1001"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mattr=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084115"><span class="hs-identifier hs-var">attrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084115"><span class="hs-identifier hs-var">attrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1002"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-target-abi=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084116"><span class="hs-identifier hs-var">abi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084116"><span class="hs-identifier hs-var">abi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621682084117"><span class="annot"><span class="annottext">target :: String
</span><a href="#local-6989586621682084117"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlatformMisc -&gt; String
</span><a href="GHC.Platform.html#platformMisc_llvmTarget"><span class="hs-identifier hs-var">platformMisc_llvmTarget</span></a></span><span> </span><span class="annot"><span class="annottext">(PlatformMisc -&gt; String) -&gt; PlatformMisc -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PlatformMisc
</span><a href="GHC.Driver.Session.html#platformMisc"><span class="hs-identifier hs-var">platformMisc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1005"></span><span>        </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CmmToLlvm.Config.html#LlvmTarget"><span class="hs-identifier hs-type">LlvmTarget</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682084114"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084114"><span class="hs-identifier hs-var">mcpu</span></a></span></span><span> </span><span id="local-6989586621682084121"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084121"><span class="hs-identifier hs-var">mattr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, LlvmTarget)] -&gt; Maybe LlvmTarget
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base-4.18.2.1/src/GHC.List.html#lookup/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084117"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LlvmConfig -&gt; [(String, LlvmTarget)]
</span><a href="GHC.CmmToLlvm.Config.html#llvmTargets"><span class="hs-identifier hs-var">llvmTargets</span></a></span><span> </span><span class="annot"><span class="annottext">LlvmConfig
</span><a href="#local-6989586621682084108"><span class="hs-identifier hs-var">llvm_config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>        </span><span class="hs-comment">-- Relocation models</span><span>
</span><span id="line-1008"></span><span>        </span><span id="local-6989586621682084111"><span class="annot"><span class="annottext">rmodel :: String
</span><a href="#local-6989586621682084111"><span class="hs-identifier hs-var hs-var">rmodel</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_PIC"><span class="hs-identifier hs-var">Opt_PIC</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pic&quot;</span></span><span>
</span><span id="line-1009"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#positionIndependent"><span class="hs-identifier hs-var">positionIndependent</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pic&quot;</span></span><span>
</span><span id="line-1010"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Ways
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-operator hs-var">`hasWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dynamic-no-pic&quot;</span></span><span>
</span><span id="line-1011"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;static&quot;</span></span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span>        </span><span id="local-6989586621682084128"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621682084128"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span>        </span><span class="annot"><a href="#local-6989586621682084112"><span class="hs-identifier hs-type">align</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1016"></span><span>        </span><span id="local-6989586621682084112"><span class="annot"><span class="annottext">align :: Int
</span><a href="#local-6989586621682084112"><span class="hs-identifier hs-var hs-var">align</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682084128"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1017"></span><span>                  </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchX86_64/GHC.Platform.ArchOS.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvxEnabled"><span class="hs-identifier hs-var">isAvxEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span>
</span><span id="line-1018"></span><span>                  </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1019"></span><span>
</span><span id="line-1020"></span><span>        </span><span class="annot"><a href="#local-6989586621682084115"><span class="hs-identifier hs-type">attrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-1021"></span><span>        </span><span id="local-6989586621682084115"><span class="annot"><span class="annottext">attrs :: String
</span><a href="#local-6989586621682084115"><span class="hs-identifier hs-var hs-var">attrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#intercalate/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084121"><span class="hs-identifier hs-var">mattr</span></a></span><span>
</span><span id="line-1022"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+sse42&quot;</span></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isSse4_2Enabled"><span class="hs-identifier hs-var">isSse4_2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>   </span><span class="hs-special">]</span><span>
</span><span id="line-1023"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+sse2&quot;</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#isSse2Enabled"><span class="hs-identifier hs-var">isSse2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682084128"><span class="hs-identifier hs-var">platform</span></a></span><span>   </span><span class="hs-special">]</span><span>
</span><span id="line-1024"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+sse&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="GHC.Platform.html#isSseEnabled"><span class="hs-identifier hs-var">isSseEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621682084128"><span class="hs-identifier hs-var">platform</span></a></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1025"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512f&quot;</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512fEnabled"><span class="hs-identifier hs-var">isAvx512fEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-1026"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx2&quot;</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx2Enabled"><span class="hs-identifier hs-var">isAvx2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1027"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvxEnabled"><span class="hs-identifier hs-var">isAvxEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1028"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512cd&quot;</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512cdEnabled"><span class="hs-identifier hs-var">isAvx512cdEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1029"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512er&quot;</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512erEnabled"><span class="hs-identifier hs-var">isAvx512erEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1030"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512pf&quot;</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512pfEnabled"><span class="hs-identifier hs-var">isAvx512pfEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1031"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+bmi&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isBmiEnabled"><span class="hs-identifier hs-var">isBmiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1032"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+bmi2&quot;</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isBmi2Enabled"><span class="hs-identifier hs-var">isBmi2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span>        </span><span class="annot"><a href="#local-6989586621682084116"><span class="hs-identifier hs-type">abi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-1035"></span><span>        </span><span id="local-6989586621682084116"><span class="annot"><span class="annottext">abi :: String
</span><a href="#local-6989586621682084116"><span class="hs-identifier hs-var hs-var">abi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084109"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1036"></span><span>                </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchRISCV64/GHC.Platform.ArchOS.html#ArchRISCV64"><span class="hs-identifier hs-var">ArchRISCV64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lp64d&quot;</span></span><span>
</span><span id="line-1037"></span><span>                </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot-9.6.6/src/GHC.Platform.ArchOS.html#ArchLoongArch64/GHC.Platform.ArchOS.html#ArchLoongArch64"><span class="hs-identifier hs-var">ArchLoongArch64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lp64d&quot;</span></span><span>
</span><span id="line-1038"></span><span>                </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span class="annot"><span class="hs-comment">-- | What phase to run after one of the backend code generators has run</span></span><span>
</span><span id="line-1041"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#hscPostBackendPhase"><span class="hs-identifier hs-type">hscPostBackendPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SourceFile.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>
</span><span id="line-1042"></span><span id="hscPostBackendPhase"><span class="annot"><span class="annottext">hscPostBackendPhase :: HscSource -&gt; Backend -&gt; Phase
</span><a href="GHC.Driver.Pipeline.Execute.html#hscPostBackendPhase"><span class="hs-identifier hs-var hs-var">hscPostBackendPhase</span></a></span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="annot"><span class="annottext">Backend
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>
</span><span id="line-1043"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Types.SourceFile.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">Backend
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>
</span><span id="line-1044"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682084143"><span class="annot"><span class="annottext">Backend
</span><a href="#local-6989586621682084143"><span class="hs-identifier hs-var">bcknd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Phase
</span><a href="GHC.Driver.Backend.html#backendNormalSuccessorPhase"><span class="hs-identifier hs-var">backendNormalSuccessorPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Backend
</span><a href="#local-6989586621682084143"><span class="hs-identifier hs-var">bcknd</span></a></span><span>
</span><span id="line-1045"></span><span>
</span><span id="line-1046"></span><span>
</span><span id="line-1047"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#compileStub"><span class="hs-identifier hs-type">compileStub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-1048"></span><span id="compileStub"><span class="annot"><span class="annottext">compileStub :: HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.Execute.html#compileStub"><span class="hs-identifier hs-var hs-var">compileStub</span></a></span></span><span> </span><span id="local-6989586621682084145"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084145"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682084146"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084146"><span class="hs-identifier hs-var">stub_c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ForeignSrcLang -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-var">compileForeign</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084145"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><span class="hs-identifier hs-var">LangC</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084146"><span class="hs-identifier hs-var">stub_c</span></a></span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-1052"></span><span class="hs-comment">-- join object files into a single relocatable object file, using ld -r</span><span>
</span><span id="line-1053"></span><span>
</span><span id="line-1054"></span><span class="hs-comment">{-
Note [Produce big objects on Windows]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The Windows Portable Executable object format has a limit of 32k sections, which
we tend to blow through pretty easily. Thankfully, there is a &quot;big object&quot;
extension, which raises this limit to 2^32. However, it must be explicitly
enabled in the toolchain:

 * the assembler accepts the -mbig-obj flag, which causes it to produce a
   bigobj-enabled COFF object.

 * the linker accepts the --oformat pe-bigobj-x86-64 flag. Despite what the name
   suggests, this tells the linker to produce a bigobj-enabled COFF object, no a
   PE executable.

Previously when we used ld.bfd we had to enable bigobj output in a few places:

 * When merging object files (GHC.Driver.Pipeline.Execute.joinObjectFiles)

 * When assembling (GHC.Driver.Pipeline.runPhase (RealPhase As ...))

However, this is no longer necessary with ld.lld, which detects that the
object is large on its own.

Unfortunately the big object format is not supported on 32-bit targets so
none of this can be used in that case.


Note [Object merging]
~~~~~~~~~~~~~~~~~~~~~
On most platforms one can &quot;merge&quot; a set of relocatable object files into a new,
partially-linked-but-still-relocatable object. In a typical UNIX-style linker,
this is accomplished with the `ld -r` command. We rely on this for two ends:

 * We rely on `ld -r` to squash together split sections, making GHCi loading
   more efficient. See Note [Merging object files for GHCi].

 * We use merging to combine a module's object code (e.g. produced by the NCG)
   with its foreign stubs (typically produced by a C compiler).

The command used for object linking is set using the -pgmlm and -optlm
command-line options.

However, `ld -r` is broken in some cases:

 * The LLD linker that we use on Windows does not support the `-r`
   flag needed to support object merging (see #21068). For this reason
   on Windows we do not support GHCi objects.

In these cases, we bundle a module's own object file with its foreign
stub's object file, instead of merging them. Consequently, we can end
up producing `.o` files which are in fact static archives. This can
only work if `ar -L` is supported, so the archive `.o` files can be
properly added to the final static library.

Note that this has somewhat non-obvious consequences when producing
initializers and finalizers. See Note [Initializers and finalizers in Cmm]
in GHC.Cmm.InitFini for details.


Note [Merging object files for GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GHCi can usually loads standard linkable object files using GHC's linker
implementation. However, most users build their projects with -split-sections,
meaning that such object files can have an extremely high number of sections.
As the linker must map each of these sections individually, loading such object
files is very inefficient.

To avoid this inefficiency, we use the linker's `-r` flag and a linker script
to produce a merged relocatable object file. This file will contain a singe
text section section and can consequently be mapped far more efficiently. As
gcc tends to do unpredictable things to our linker command line, we opt to
invoke ld directly in this case, in contrast to our usual strategy of linking
via gcc.
-}</span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span class="annot"><span class="hs-comment">-- | See Note [Object merging].</span></span><span>
</span><span id="line-1131"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#joinObjectFiles"><span class="hs-identifier hs-type">joinObjectFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1132"></span><span id="joinObjectFiles"><span class="annot"><span class="annottext">joinObjectFiles :: HscEnv -&gt; [String] -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#joinObjectFiles"><span class="hs-identifier hs-var hs-var">joinObjectFiles</span></a></span></span><span> </span><span id="local-6989586621682084148"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621682084149"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084149"><span class="hs-identifier hs-var">o_files</span></a></span></span><span> </span><span id="local-6989586621682084150"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084150"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span>
</span><span id="line-1133"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084151"><span class="hs-identifier hs-var">can_merge_objs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1134"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084152"><span class="annot"><span class="annottext">toolSettings' :: ToolSettings
</span><a href="#local-6989586621682084152"><span class="hs-identifier hs-var hs-var">toolSettings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ToolSettings
</span><a href="GHC.Driver.Session.html#toolSettings"><span class="hs-identifier hs-var">toolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084154"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1135"></span><span>      </span><span id="local-6989586621682084155"><span class="annot"><span class="annottext">ldIsGnuLd :: Bool
</span><a href="#local-6989586621682084155"><span class="hs-identifier hs-var hs-var">ldIsGnuLd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldIsGnuLd"><span class="hs-identifier hs-var">toolSettings_ldIsGnuLd</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621682084152"><span class="hs-identifier hs-var">toolSettings'</span></a></span><span>
</span><span id="line-1136"></span><span>      </span><span id="local-6989586621682084157"><span class="annot"><span class="annottext">ld_r :: [Option] -&gt; IO ()
</span><a href="#local-6989586621682084157"><span class="hs-identifier hs-var hs-var">ld_r</span></a></span></span><span> </span><span id="local-6989586621682084158"><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682084158"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; TmpFs -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runMergeObjects"><span class="hs-identifier hs-var">GHC.SysTools.runMergeObjects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1137"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1138"></span><span>                          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084150"><span class="hs-identifier hs-var">output_fn</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1139"></span><span>                     </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621682084158"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084155"><span class="hs-identifier hs-var">ldIsGnuLd</span></a></span><span>
</span><span id="line-1142"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1143"></span><span>          </span><span id="local-6989586621682084160"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084160"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084161"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084162"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084154"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ldscript&quot;</span></span><span>
</span><span id="line-1144"></span><span>          </span><span id="local-6989586621682084163"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084163"><span class="hs-identifier hs-var">cwd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#getCurrentDirectory/System.Directory.html#getCurrentDirectory"><span class="hs-identifier hs-var">getCurrentDirectory</span></a></span><span>
</span><span id="line-1145"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682084165"><span class="annot"><span class="annottext">o_files_abs :: [String]
</span><a href="#local-6989586621682084165"><span class="hs-identifier hs-var hs-var">o_files_abs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621682084166"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084166"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084163"><span class="hs-identifier hs-var">cwd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#%3C%2F%3E/System.FilePath.Posix.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084166"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084149"><span class="hs-identifier hs-var">o_files</span></a></span><span>
</span><span id="line-1146"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/System.IO.html#writeFile/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084160"><span class="hs-identifier hs-var">script</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;INPUT(&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#unwords/Data.OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084165"><span class="hs-identifier hs-var">o_files_abs</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-1147"></span><span>          </span><span class="annot"><span class="annottext">[Option] -&gt; IO ()
</span><a href="#local-6989586621682084157"><span class="hs-identifier hs-var">ld_r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084160"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1148"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldSupportsFilelist"><span class="hs-identifier hs-var">toolSettings_ldSupportsFilelist</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621682084152"><span class="hs-identifier hs-var">toolSettings'</span></a></span><span>
</span><span id="line-1149"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1150"></span><span>          </span><span id="local-6989586621682084170"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084170"><span class="hs-identifier hs-var">filelist</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; TempDir -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.Utils.TmpFs.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084161"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084162"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; TempDir
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084154"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.Utils.TmpFs.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;filelist&quot;</span></span><span>
</span><span id="line-1151"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base-4.18.2.1/src/System.IO.html#writeFile/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084170"><span class="hs-identifier hs-var">filelist</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#unlines/Data.OldList.html#unlines"><span class="hs-identifier hs-var">unlines</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084149"><span class="hs-identifier hs-var">o_files</span></a></span><span>
</span><span id="line-1152"></span><span>          </span><span class="annot"><span class="annottext">[Option] -&gt; IO ()
</span><a href="#local-6989586621682084157"><span class="hs-identifier hs-var">ld_r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-filelist&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1153"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084170"><span class="hs-identifier hs-var">filelist</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1154"></span><span>     </span><span class="hs-keyword">else</span><span>
</span><span id="line-1155"></span><span>          </span><span class="annot"><span class="annottext">[Option] -&gt; IO ()
</span><a href="#local-6989586621682084157"><span class="hs-identifier hs-var">ld_r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084149"><span class="hs-identifier hs-var">o_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#otherwise/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1158"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
String -&gt; (String -&gt; m a) -&gt; m a
</span><a href="GHC.Utils.Misc.html#withAtomicRename"><span class="hs-identifier hs-var">withAtomicRename</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084150"><span class="hs-identifier hs-var">output_fn</span></a></span><span> </span><span class="annot"><span class="annottext">((String -&gt; IO ()) -&gt; IO ()) -&gt; (String -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682084172"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084172"><span class="hs-identifier hs-var">tmp_ar</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1159"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall a. IO a -&gt; IO a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.2.1/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; Maybe String -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runAr"><span class="hs-identifier hs-var">runAr</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084161"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084154"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base-4.18.2.1/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">([Option] -&gt; IO ()) -&gt; [Option] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option]) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qc&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084175"><span class="hs-identifier hs-var">dashL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084172"><span class="hs-identifier hs-var">tmp_ar</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084149"><span class="hs-identifier hs-var">o_files</span></a></span><span>
</span><span id="line-1160"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1161"></span><span>    </span><span id="local-6989586621682084176"><span class="annot"><span class="annottext">dashLSupported :: Bool
</span><a href="#local-6989586621682084176"><span class="hs-identifier hs-var hs-var">dashLSupported</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Settings -&gt; Bool
</span><a href="GHC.Settings.html#sArSupportsDashL"><span class="hs-identifier hs-var">sArSupportsDashL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Settings
</span><a href="GHC.Driver.Session.html#settings"><span class="hs-identifier hs-var">settings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084154"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span>    </span><span id="local-6989586621682084175"><span class="annot"><span class="annottext">dashL :: String
</span><a href="#local-6989586621682084175"><span class="hs-identifier hs-var hs-var">dashL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682084176"><span class="hs-identifier hs-var">dashLSupported</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;L&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-1163"></span><span>    </span><span id="local-6989586621682084151"><span class="annot"><span class="annottext">can_merge_objs :: Bool
</span><a href="#local-6989586621682084151"><span class="hs-identifier hs-var hs-var">can_merge_objs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (String, [Option]) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.18.2.1/src/Data.Maybe.html#isJust/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe (String, [Option])
</span><a href="GHC.Driver.Session.html#pgm_lm"><span class="hs-identifier hs-var">pgm_lm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>    </span><span id="local-6989586621682084154"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621682084154"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1165"></span><span>    </span><span id="local-6989586621682084162"><span class="annot"><span class="annottext">tmpfs :: TmpFs
</span><a href="#local-6989586621682084162"><span class="hs-identifier hs-var hs-var">tmpfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TmpFs
</span><a href="GHC.Driver.Env.Types.html#hsc_tmpfs"><span class="hs-identifier hs-var">hsc_tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1166"></span><span>    </span><span id="local-6989586621682084161"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621682084161"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621682084148"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1170"></span><span class="hs-comment">-- Look for the /* GHC_PACKAGES ... */ comment at the top of a .hc file</span><span>
</span><span id="line-1171"></span><span>
</span><span id="line-1172"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#getHCFilePackages"><span class="hs-identifier hs-type">getHCFilePackages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1173"></span><span id="getHCFilePackages"><span class="annot"><span class="annottext">getHCFilePackages :: String -&gt; IO [UnitId]
</span><a href="GHC.Driver.Pipeline.Execute.html#getHCFilePackages"><span class="hs-identifier hs-var hs-var">getHCFilePackages</span></a></span></span><span> </span><span id="local-6989586621682084181"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084181"><span class="hs-identifier hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1174"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IOMode -&gt; (Handle -&gt; IO [UnitId]) -&gt; IO [UnitId]
forall r. String -&gt; IOMode -&gt; (Handle -&gt; IO r) -&gt; IO r
</span><a href="../../base-4.18.2.1/src/GHC.IO.StdHandles.html#withFile/GHC.IO.StdHandles.html#withFile"><span class="hs-identifier hs-var">withFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084181"><span class="hs-identifier hs-var">filename</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="../../base-4.18.2.1/src/GHC.IO.IOMode.html#ReadMode/GHC.IO.IOMode.html#ReadMode"><span class="hs-identifier hs-var">ReadMode</span></a></span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; IO [UnitId]) -&gt; IO [UnitId])
-&gt; (Handle -&gt; IO [UnitId]) -&gt; IO [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682084184"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682084184"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1175"></span><span>    </span><span id="local-6989586621682084185"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084185"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><a href="../../base-4.18.2.1/src/GHC.IO.Handle.Text.html#hGetLine/GHC.IO.Handle.Text.html#hGetLine"><span class="hs-identifier hs-var">hGetLine</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621682084184"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1176"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084185"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1177"></span><span>      </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'G'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'H'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'C'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'P'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'C'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'K'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'G'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'E'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'S'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621682084187"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084187"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1178"></span><span>          </span><span class="annot"><span class="annottext">[UnitId] -&gt; IO [UnitId]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; UnitId) -&gt; [String] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#map/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; UnitId
</span><a href="GHC.Unit.Types.html#stringToUnitId"><span class="hs-identifier hs-var">stringToUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base-4.18.2.1/src/Data.OldList.html#words/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084187"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1179"></span><span>      </span><span id="local-6989586621682084189"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084189"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1180"></span><span>          </span><span class="annot"><span class="annottext">[UnitId] -&gt; IO [UnitId]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#linkDynLibCheck"><span class="hs-identifier hs-type">linkDynLibCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.TmpFs.html#TmpFs"><span class="hs-identifier hs-type">TmpFs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Env.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span id="linkDynLibCheck"><span class="annot"><span class="annottext">linkDynLibCheck :: Logger
-&gt; TmpFs -&gt; DynFlags -&gt; UnitEnv -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#linkDynLibCheck"><span class="hs-identifier hs-var hs-var">linkDynLibCheck</span></a></span></span><span> </span><span id="local-6989586621682084191"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084191"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682084192"><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084192"><span class="hs-identifier hs-var">tmpfs</span></a></span></span><span> </span><span id="local-6989586621682084193"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084193"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682084194"><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682084194"><span class="hs-identifier hs-var">unit_env</span></a></span></span><span> </span><span id="local-6989586621682084195"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084195"><span class="hs-identifier hs-var">o_files</span></a></span></span><span> </span><span id="local-6989586621682084196"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682084196"><span class="hs-identifier hs-var">dep_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1185"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#when/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Linker.ExtraObj.html#haveRtsOptsFlags"><span class="hs-identifier hs-var">haveRtsOptsFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084193"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1186"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; MessageClass -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#logMsg"><span class="hs-identifier hs-var">logMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084191"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">MessageClass
</span><a href="GHC.Types.Error.html#MCInfo"><span class="hs-identifier hs-var">MCInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-1187"></span><span>      </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-var">withPprStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="GHC.Utils.Outputable.html#defaultUserStyle"><span class="hs-identifier hs-var">defaultUserStyle</span></a></span><span>
</span><span id="line-1188"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Warning: -rtsopts and -with-rtsopts have no effect with -shared.&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1189"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    Call hs_init_ghc() from your main() function to set these options.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span>  </span><span class="annot"><span class="annottext">Logger
-&gt; TmpFs -&gt; DynFlags -&gt; UnitEnv -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Linker.Dynamic.html#linkDynLib"><span class="hs-identifier hs-var">linkDynLib</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084191"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">TmpFs
</span><a href="#local-6989586621682084192"><span class="hs-identifier hs-var">tmpfs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084193"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv
</span><a href="#local-6989586621682084194"><span class="hs-identifier hs-var">unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621682084195"><span class="hs-identifier hs-var">o_files</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621682084196"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1195"></span><span class="hs-comment">-- Misc.</span><span>
</span><span id="line-1196"></span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>
</span><span id="line-1199"></span><span class="annot"><a href="GHC.Driver.Pipeline.Execute.html#touchObjectFile"><span class="hs-identifier hs-type">touchObjectFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.2.1/src/GHC.IO.html#FilePath/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span id="touchObjectFile"><span class="annot"><span class="annottext">touchObjectFile :: Logger -&gt; DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.Execute.html#touchObjectFile"><span class="hs-identifier hs-var hs-var">touchObjectFile</span></a></span></span><span> </span><span id="local-6989586621682084205"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084205"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621682084206"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084206"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621682084207"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084207"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1201"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><a href="../../directory-1.3.8.5/src/System.Directory.html#createDirectoryIfMissing/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.2.1/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath-1.4.300.1/src/System.FilePath.Posix.html#takeDirectory/System.FilePath.Posix.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084207"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1202"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; DynFlags -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#touch"><span class="hs-identifier hs-var">GHC.SysTools.touch</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621682084205"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621682084206"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Touching object file&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682084207"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span class="hs-comment">-- Note [-fPIC for assembler]</span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1206"></span><span class="hs-comment">-- When compiling .c source file GHC's driver pipeline basically</span><span>
</span><span id="line-1207"></span><span class="hs-comment">-- does the following two things:</span><span>
</span><span id="line-1208"></span><span class="hs-comment">--   1. ${CC}              -S 'PIC_CFLAGS' source.c</span><span>
</span><span id="line-1209"></span><span class="hs-comment">--   2. ${CC} -x assembler -c 'PIC_CFLAGS' source.S</span><span>
</span><span id="line-1210"></span><span class="hs-comment">--</span><span>
</span><span id="line-1211"></span><span class="hs-comment">-- Why do we need to pass 'PIC_CFLAGS' both to C compiler and assembler?</span><span>
</span><span id="line-1212"></span><span class="hs-comment">-- Because on some architectures (at least sparc32) assembler also chooses</span><span>
</span><span id="line-1213"></span><span class="hs-comment">-- the relocation type!</span><span>
</span><span id="line-1214"></span><span class="hs-comment">-- Consider the following C module:</span><span>
</span><span id="line-1215"></span><span class="hs-comment">--</span><span>
</span><span id="line-1216"></span><span class="hs-comment">--     /* pic-sample.c */</span><span>
</span><span id="line-1217"></span><span class="hs-comment">--     int v;</span><span>
</span><span id="line-1218"></span><span class="hs-comment">--     void set_v (int n) { v = n; }</span><span>
</span><span id="line-1219"></span><span class="hs-comment">--     int  get_v (void)  { return v; }</span><span>
</span><span id="line-1220"></span><span class="hs-comment">--</span><span>
</span><span id="line-1221"></span><span class="hs-comment">--     $ gcc -S -fPIC pic-sample.c</span><span>
</span><span id="line-1222"></span><span class="hs-comment">--     $ gcc -c       pic-sample.s -o pic-sample.no-pic.o # incorrect binary</span><span>
</span><span id="line-1223"></span><span class="hs-comment">--     $ gcc -c -fPIC pic-sample.s -o pic-sample.pic.o    # correct binary</span><span>
</span><span id="line-1224"></span><span class="hs-comment">--</span><span>
</span><span id="line-1225"></span><span class="hs-comment">--     $ objdump -r -d pic-sample.pic.o    &gt; pic-sample.pic.o.od</span><span>
</span><span id="line-1226"></span><span class="hs-comment">--     $ objdump -r -d pic-sample.no-pic.o &gt; pic-sample.no-pic.o.od</span><span>
</span><span id="line-1227"></span><span class="hs-comment">--     $ diff -u pic-sample.pic.o.od pic-sample.no-pic.o.od</span><span>
</span><span id="line-1228"></span><span class="hs-comment">--</span><span>
</span><span id="line-1229"></span><span class="hs-comment">-- Most of architectures won't show any difference in this test, but on sparc32</span><span>
</span><span id="line-1230"></span><span class="hs-comment">-- the following assembly snippet:</span><span>
</span><span id="line-1231"></span><span class="hs-comment">--</span><span>
</span><span id="line-1232"></span><span class="hs-comment">--    sethi   %hi(_GLOBAL_OFFSET_TABLE_-8), %l7</span><span>
</span><span id="line-1233"></span><span class="hs-comment">--</span><span>
</span><span id="line-1234"></span><span class="hs-comment">-- generates two kinds or relocations, only 'R_SPARC_PC22' is correct:</span><span>
</span><span id="line-1235"></span><span class="hs-comment">--</span><span>
</span><span id="line-1236"></span><span class="hs-comment">--       3c:  2f 00 00 00     sethi  %hi(0), %l7</span><span>
</span><span id="line-1237"></span><span class="hs-comment">--    -                       3c: R_SPARC_PC22        _GLOBAL_OFFSET_TABLE_-0x8</span><span>
</span><span id="line-1238"></span><span class="hs-comment">--    +                       3c: R_SPARC_HI22        _GLOBAL_OFFSET_TABLE_-0x8</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span class="hs-comment">{- Note [Don't normalise input filenames]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Summary
  We used to normalise input filenames when starting the unlit phase. This
  broke hpc in `--make` mode with imported literate modules (#2991).

Introduction
  1) --main
  When compiling a module with --main, GHC scans its imports to find out which
  other modules it needs to compile too. It turns out that there is a small
  difference between saying `ghc --make A.hs`, when `A` imports `B`, and
  specifying both modules on the command line with `ghc --make A.hs B.hs`. In
  the former case, the filename for B is inferred to be './B.hs' instead of
  'B.hs'.

  2) unlit
  When GHC compiles a literate haskell file, the source code first needs to go
  through unlit, which turns it into normal Haskell source code. At the start
  of the unlit phase, in `Driver.Pipeline.runPhase`, we call unlit with the
  option `-h` and the name of the original file. We used to normalise this
  filename using System.FilePath.normalise, which among other things removes
  an initial './'. unlit then uses that filename in #line directives that it
  inserts in the transformed source code.

  3) SrcSpan
  A SrcSpan represents a portion of a source code file. It has fields
  linenumber, start column, end column, and also a reference to the file it
  originated from. The SrcSpans for a literate haskell file refer to the
  filename that was passed to unlit -h.

  4) -fhpc
  At some point during compilation with -fhpc, in the function
  `GHC.HsToCore.Ticks.isGoodTickSrcSpan`, we compare the filename that a
  `SrcSpan` refers to with the name of the file we are currently compiling.
  For some reason I don't yet understand, they can sometimes legitimately be
  different, and then hpc ignores that SrcSpan.

Problem
  When running `ghc --make -fhpc A.hs`, where `A.hs` imports the literate
  module `B.lhs`, `B` is inferred to be in the file `./B.lhs` (1). At the
  start of the unlit phase, the name `./B.lhs` is normalised to `B.lhs` (2).
  Therefore the SrcSpans of `B` refer to the file `B.lhs` (3), but we are
  still compiling `./B.lhs`. Hpc thinks these two filenames are different (4),
  doesn't include ticks for B, and we have unhappy customers (#2991).

Solution
  Do not normalise `input_fn` when starting the unlit phase.

Alternative solution
  Another option would be to not compare the two filenames on equality, but to
  use System.FilePath.equalFilePath. That function first normalises its
  arguments. The problem is that by the time we need to do the comparison, the
  filenames have been turned into FastStrings, probably for performance
  reasons, so System.FilePath.equalFilePath can not be used directly.

Archeology
  The call to `normalise` was added in a commit called &quot;Fix slash
  direction on Windows with the new filePath code&quot; (c9b6b5e8). The problem
  that commit was addressing has since been solved in a different manner, in a
  commit called &quot;Fix the filename passed to unlit&quot; (1eedbc6b). So the
  `normalise` is no longer necessary.
-}</span><span>
</span><span id="line-1302"></span><span>
</span><span id="line-1303"></span><span class="hs-comment">{-
Note [-Wa,--no-type-check on wasm32]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Wasm32 has a type system and corresponding validation rules, so it's
possible to produce syntactically valid object code that doesn't pass
validation.

We have no problem with that, but we do have a problem with clang.
When clang takes an assembly input for wasm32, it uses its internal
type-checker, which is a huge source of trouble (see llvm ticket
#56935 #58438): it may reject valid assembly, and even worse, it may
silently alter the output object code!!! The worsest of all, is the
person that added the wasm32 asm typechecker logic has moved on from
Google/LLVM, and while other LLVM devs may be knowledgable enough to
fix this mess, they likely got tons of other stuff on their table and
don't care enough.

We do have an escape hatch, just pass -Wa,--no-type-check to clang to
bypass the entire wasm32 asm typechecking logic. There's little point
in type-checking object code at compile-time anyway, the wasm engines
will do type-checking at run-time. And even if we want to add some
linting flag to do compile-time checks, we should just rely on
battle-tested external tools instead of a completely broken horror
story.
-}</span><span>
</span><span id="line-1329"></span></pre></body></html>