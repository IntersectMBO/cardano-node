<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[SimplCore]{Driver for simplifying @Core@ programs}
-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Core.Opt.Pipeline</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#core2core"><span class="hs-identifier">core2core</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.html#simplifyExpr"><span class="hs-identifier">simplifyExpr</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier">withPlugins</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html#installCoreToDos"><span class="hs-identifier">installCoreToDos</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.html"><span class="hs-identifier">GHC.Driver.Env</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.html"><span class="hs-identifier">GHC.Driver.Config.Core.Lint</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Lint.html#endPass"><span class="hs-identifier">endPass</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.LiberateCase.html"><span class="hs-identifier">GHC.Driver.Config.Core.Opt.LiberateCase</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.LiberateCase.html#initLiberateCaseOpts"><span class="hs-identifier">initLiberateCaseOpts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.Simplify.html"><span class="hs-identifier">GHC.Driver.Config.Core.Opt.Simplify</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initSimplifyOpts"><span class="hs-identifier">initSimplifyOpts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initSimplMode"><span class="hs-identifier">initSimplMode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initGentleSimplMode"><span class="hs-identifier">initGentleSimplMode</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.WorkWrap.html"><span class="hs-identifier">GHC.Driver.Config.Core.Opt.WorkWrap</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Opt.WorkWrap.html#initWorkWrapOpts"><span class="hs-identifier">initWorkWrapOpts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Rules.html"><span class="hs-identifier">GHC.Driver.Config.Core.Rules</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Config.Core.Rules.html#initRuleOpts"><span class="hs-identifier">initRuleOpts</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html"><span class="hs-identifier">GHC.Platform.Ways</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-identifier">hasWay</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Platform.Ways.html#Way"><span class="hs-identifier">Way</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Platform.Ways.html#WayProf"><span class="hs-identifier">WayProf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CSE.html"><span class="hs-identifier">GHC.Core.Opt.CSE</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CSE.html#cseProgram"><span class="hs-identifier">cseProgram</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html"><span class="hs-identifier">GHC.Core.Rules</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html#RuleBase"><span class="hs-identifier">RuleBase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html#mkRuleBase"><span class="hs-identifier">mkRuleBase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html#ruleCheckProgram"><span class="hs-identifier">ruleCheckProgram</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html#getRules"><span class="hs-identifier">getRules</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Ppr.html"><span class="hs-identifier">GHC.Core.Ppr</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Ppr.html#pprCoreBindings"><span class="hs-identifier">pprCoreBindings</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#dumpIdInfoOfProgram"><span class="hs-identifier">dumpIdInfoOfProgram</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Lint.html"><span class="hs-identifier">GHC.Core.Lint</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Lint.html#lintAnnots"><span class="hs-identifier">lintAnnots</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Lint.Interactive.html"><span class="hs-identifier">GHC.Core.Lint.Interactive</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier">interactiveInScope</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.html"><span class="hs-identifier">GHC.Core.Opt.Simplify</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.html#simplifyExpr"><span class="hs-identifier">simplifyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.html#simplifyPgm"><span class="hs-identifier">simplifyPgm</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Simplify.Monad.html"><span class="hs-identifier">GHC.Core.Opt.Simplify.Monad</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Monad.html"><span class="hs-identifier">GHC.Core.Opt.Monad</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html"><span class="hs-identifier">GHC.Core.Opt.Pipeline.Types</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.FloatIn.html"><span class="hs-identifier">GHC.Core.Opt.FloatIn</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.FloatIn.html#floatInwards"><span class="hs-identifier">floatInwards</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.FloatOut.html"><span class="hs-identifier">GHC.Core.Opt.FloatOut</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.FloatOut.html#floatOutwards"><span class="hs-identifier">floatOutwards</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.LiberateCase.html"><span class="hs-identifier">GHC.Core.Opt.LiberateCase</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.LiberateCase.html#liberateCase"><span class="hs-identifier">liberateCase</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.StaticArgs.html"><span class="hs-identifier">GHC.Core.Opt.StaticArgs</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.StaticArgs.html#doStaticArgs"><span class="hs-identifier">doStaticArgs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Specialise.html"><span class="hs-identifier">GHC.Core.Opt.Specialise</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Specialise.html#specProgram"><span class="hs-identifier">specProgram</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.SpecConstr.html"><span class="hs-identifier">GHC.Core.Opt.SpecConstr</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.SpecConstr.html#specConstrProgram"><span class="hs-identifier">specConstrProgram</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.DmdAnal.html"><span class="hs-identifier">GHC.Core.Opt.DmdAnal</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CprAnal.html"><span class="hs-identifier">GHC.Core.Opt.CprAnal</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CprAnal.html#cprAnalProgram"><span class="hs-identifier">cprAnalProgram</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CallArity.html"><span class="hs-identifier">GHC.Core.Opt.CallArity</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CallArity.html#callArityAnalProgram"><span class="hs-identifier">callArityAnalProgram</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Exitify.html"><span class="hs-identifier">GHC.Core.Opt.Exitify</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Exitify.html#exitifyProgram"><span class="hs-identifier">exitifyProgram</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.WorkWrap.html"><span class="hs-identifier">GHC.Core.Opt.WorkWrap</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.WorkWrap.html#wwTopBinds"><span class="hs-identifier">wwTopBinds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CallerCC.html"><span class="hs-identifier">GHC.Core.Opt.CallerCC</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Opt.CallerCC.html#addCallerCostCentres"><span class="hs-identifier">addCallerCostCentres</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.LateCC.html"><span class="hs-identifier">GHC.Core.LateCC</span></a></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.LateCC.html#addLateCostCentresMG"><span class="hs-identifier">addLateCostCentresMG</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Seq.html"><span class="hs-identifier">GHC.Core.Seq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Seq.html#seqBinds"><span class="hs-identifier">seqBinds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier">withTiming</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Logger</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html"><span class="hs-identifier">GHC.Unit.Module.ModGuts</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html"><span class="hs-identifier">GHC.Types.Demand</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier">zapDmdEnvSig</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Ppr.html"><span class="hs-identifier">GHC.Types.Name.Ppr</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier">Var</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/Control.Monad.html#/Control.Monad.html"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.6.7/src/GHC.LanguageExtensions.html#/GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{The driver for the simplifier}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#core2core"><span class="hs-identifier hs-type">core2core</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-76"></span><span id="core2core"><span class="annot"><span class="annottext">core2core :: HscEnv -&gt; ModGuts -&gt; IO ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#core2core"><span class="hs-identifier hs-var hs-var">core2core</span></a></span></span><span> </span><span id="local-6989586621681964125"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964125"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681964126"><span class="annot"><span class="annottext">guts :: ModGuts
</span><a href="#local-6989586621681964126"><span class="hs-identifier hs-var">guts</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mg_module :: ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681964129"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681964129"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-77"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_loc :: ModGuts -&gt; SrcSpan
</span><a href="GHC.Unit.Module.ModGuts.html#mg_loc"><span class="hs-identifier hs-var">mg_loc</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681964131"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681964131"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-78"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mg_rdr_env :: ModGuts -&gt; GlobalRdrEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rdr_env"><span class="hs-identifier hs-var">mg_rdr_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681964133"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681964133"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681964134"><span class="annot"><span class="annottext">builtin_passes :: [CoreToDo]
</span><a href="#local-6989586621681964134"><span class="hs-identifier hs-var hs-var">builtin_passes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; RuleBase -&gt; [CoreBndr] -&gt; [CoreToDo]
</span><a href="GHC.Core.Opt.Pipeline.html#getCoreToDo"><span class="hs-identifier hs-var">getCoreToDo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964136"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">RuleBase
</span><a href="#local-6989586621681964137"><span class="hs-identifier hs-var">hpt_rule_base</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBndr]
</span><a href="#local-6989586621681964138"><span class="hs-identifier hs-var">extra_vars</span></a></span><span>
</span><span id="line-80"></span><span>             </span><span id="local-6989586621681964139"><span class="annot"><span class="annottext">uniq_tag :: Char
</span><a href="#local-6989586621681964139"><span class="hs-identifier hs-var hs-var">uniq_tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'s'</span></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681964140"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964140"><span class="hs-identifier hs-var">guts2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681964141"><span class="annot"><span class="annottext">SimplCount
</span><a href="#local-6989586621681964141"><span class="hs-identifier hs-var">stats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; RuleBase
-&gt; Char
-&gt; Module
-&gt; NamePprCtx
-&gt; SrcSpan
-&gt; CoreM ModGuts
-&gt; IO (ModGuts, SimplCount)
forall a.
HscEnv
-&gt; RuleBase
-&gt; Char
-&gt; Module
-&gt; NamePprCtx
-&gt; SrcSpan
-&gt; CoreM a
-&gt; IO (a, SimplCount)
</span><a href="GHC.Core.Opt.Monad.html#runCoreM"><span class="hs-identifier hs-var">runCoreM</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964125"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">RuleBase
</span><a href="#local-6989586621681964137"><span class="hs-identifier hs-var">hpt_rule_base</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681964139"><span class="hs-identifier hs-var">uniq_tag</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681964129"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-83"></span><span>                                    </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="#local-6989586621681964143"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681964131"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreM ModGuts -&gt; IO (ModGuts, SimplCount))
-&gt; CoreM ModGuts -&gt; IO (ModGuts, SimplCount)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-84"></span><span>                           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681964144"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964144"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM HscEnv
</span><a href="GHC.Core.Opt.Monad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-85"></span><span>                              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681964146"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964146"><span class="hs-identifier hs-var">all_passes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Plugins
-&gt; PluginOperation CoreM [CoreToDo]
-&gt; [CoreToDo]
-&gt; CoreM [CoreToDo]
forall (m :: * -&gt; *) a.
Monad m =&gt;
Plugins -&gt; PluginOperation m a -&gt; a -&gt; m a
</span><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-var">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Plugins
</span><a href="GHC.Driver.Env.Types.html#hsc_plugins"><span class="hs-identifier hs-var">hsc_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964144"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                                                </span><span class="annot"><span class="annottext">PluginOperation CoreM [CoreToDo]
</span><a href="GHC.Driver.Plugins.html#installCoreToDos"><span class="hs-identifier hs-var">installCoreToDos</span></a></span><span>
</span><span id="line-87"></span><span>                                                </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964134"><span class="hs-identifier hs-var">builtin_passes</span></a></span><span>
</span><span id="line-88"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#runCorePasses"><span class="hs-identifier hs-var">runCorePasses</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964146"><span class="hs-identifier hs-var">all_passes</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964126"><span class="hs-identifier hs-var">guts</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">Logger.putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964150"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_simpl_stats"><span class="hs-identifier hs-var">Opt_D_dump_simpl_stats</span></a></span><span>
</span><span id="line-91"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Grand total simplifier statistics&quot;</span></span><span>
</span><span id="line-92"></span><span>             </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span>
</span><span id="line-93"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplCount -&gt; SDoc
</span><a href="GHC.Core.Opt.Stats.html#pprSimplCount"><span class="hs-identifier hs-var">pprSimplCount</span></a></span><span> </span><span class="annot"><span class="annottext">SimplCount
</span><a href="#local-6989586621681964141"><span class="hs-identifier hs-var">stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; IO ModGuts
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964140"><span class="hs-identifier hs-var">guts2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621681964136"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681964136"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Env.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964125"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621681964150"><span class="annot"><span class="annottext">logger :: Logger
</span><a href="#local-6989586621681964150"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Logger
</span><a href="GHC.Driver.Env.Types.html#hsc_logger"><span class="hs-identifier hs-var">hsc_logger</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964125"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621681964138"><span class="annot"><span class="annottext">extra_vars :: [CoreBndr]
</span><a href="#local-6989586621681964138"><span class="hs-identifier hs-var hs-var">extra_vars</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; [CoreBndr]
</span><a href="GHC.Core.Lint.Interactive.html#interactiveInScope"><span class="hs-identifier hs-var">interactiveInScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Env.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964125"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621681964157"><span class="annot"><span class="annottext">home_pkg_rules :: [CoreRule]
</span><a href="#local-6989586621681964157"><span class="hs-identifier hs-var hs-var">home_pkg_rules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; UnitId -&gt; ModuleNameWithIsBoot -&gt; [CoreRule]
</span><a href="GHC.Driver.Env.html#hptRules"><span class="hs-identifier hs-var">hptRules</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964125"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; UnitId
</span><a href="GHC.Unit.Types.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681964129"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681964129"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-101"></span><span>                                                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="Language.Haskell.Syntax.ImpExp.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621681964137"><span class="annot"><span class="annottext">hpt_rule_base :: RuleBase
</span><a href="#local-6989586621681964137"><span class="hs-identifier hs-var hs-var">hpt_rule_base</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreRule] -&gt; RuleBase
</span><a href="GHC.Core.Rules.html#mkRuleBase"><span class="hs-identifier hs-var">mkRuleBase</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621681964157"><span class="hs-identifier hs-var">home_pkg_rules</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621681964143"><span class="annot"><span class="annottext">name_ppr_ctx :: NamePprCtx
</span><a href="#local-6989586621681964143"><span class="hs-identifier hs-var hs-var">name_ppr_ctx</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnv -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#mkNamePprCtx"><span class="hs-identifier hs-var">mkNamePprCtx</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionTickContext
</span><a href="#local-6989586621681964166"><span class="hs-identifier hs-var">ptc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964125"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681964133"><span class="hs-identifier hs-var">rdr_env</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621681964166"><span class="annot"><span class="annottext">ptc :: PromotionTickContext
</span><a href="#local-6989586621681964166"><span class="hs-identifier hs-var hs-var">ptc</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.Session.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964136"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- mod: get the module out of the current HscEnv so we can retrieve it from the monad.</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- This is very convienent for the users of the monad (e.g. plugins do not have to</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- consume the ModGuts to find the module) but somewhat ugly because mg_module may</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-comment">-- _theoretically_ be changed during the Core pipeline (it's part of ModGuts), which</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-comment">-- would mean our cached value would go out of date.</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
           Generating the main optimisation pipeline
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#getCoreToDo"><span class="hs-identifier hs-type">getCoreToDo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Rules.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- This function builds the pipeline of optimisations</span><span>
</span><span id="line-121"></span><span id="getCoreToDo"><span class="annot"><span class="annottext">getCoreToDo :: DynFlags -&gt; RuleBase -&gt; [CoreBndr] -&gt; [CoreToDo]
</span><a href="GHC.Core.Opt.Pipeline.html#getCoreToDo"><span class="hs-identifier hs-var hs-var">getCoreToDo</span></a></span></span><span> </span><span id="local-6989586621681964169"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681964170"><span class="annot"><span class="annottext">RuleBase
</span><a href="#local-6989586621681964170"><span class="hs-identifier hs-var">hpt_rule_base</span></a></span></span><span> </span><span id="local-6989586621681964171"><span class="annot"><span class="annottext">[CoreBndr]
</span><a href="#local-6989586621681964171"><span class="hs-identifier hs-var">extra_vars</span></a></span></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo]
</span><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964173"><span class="hs-identifier hs-var">core_todo</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621681964174"><span class="annot"><span class="annottext">phases :: PhaseNum
</span><a href="#local-6989586621681964174"><span class="hs-identifier hs-var hs-var">phases</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PhaseNum
</span><a href="GHC.Driver.Session.html#simplPhases"><span class="hs-identifier hs-var">simplPhases</span></a></span><span>        </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621681964176"><span class="annot"><span class="annottext">max_iter :: PhaseNum
</span><a href="#local-6989586621681964176"><span class="hs-identifier hs-var hs-var">max_iter</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PhaseNum
</span><a href="GHC.Driver.Session.html#maxSimplIterations"><span class="hs-identifier hs-var">maxSimplIterations</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621681964178"><span class="annot"><span class="annottext">rule_check :: Maybe String
</span><a href="#local-6989586621681964178"><span class="hs-identifier hs-var hs-var">rule_check</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#ruleCheck"><span class="hs-identifier hs-var">ruleCheck</span></a></span><span>          </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621681964180"><span class="annot"><span class="annottext">const_fold :: Bool
</span><a href="#local-6989586621681964180"><span class="hs-identifier hs-var hs-var">const_fold</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_CoreConstantFolding"><span class="hs-identifier hs-var">Opt_CoreConstantFolding</span></a></span><span>          </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621681964183"><span class="annot"><span class="annottext">call_arity :: Bool
</span><a href="#local-6989586621681964183"><span class="hs-identifier hs-var hs-var">call_arity</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_CallArity"><span class="hs-identifier hs-var">Opt_CallArity</span></a></span><span>                    </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621681964185"><span class="annot"><span class="annottext">exitification :: Bool
</span><a href="#local-6989586621681964185"><span class="hs-identifier hs-var hs-var">exitification</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Exitification"><span class="hs-identifier hs-var">Opt_Exitification</span></a></span><span>                </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621681964187"><span class="annot"><span class="annottext">strictness :: Bool
</span><a href="#local-6989586621681964187"><span class="hs-identifier hs-var hs-var">strictness</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Strictness"><span class="hs-identifier hs-var">Opt_Strictness</span></a></span><span>                   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621681964189"><span class="annot"><span class="annottext">full_laziness :: Bool
</span><a href="#local-6989586621681964189"><span class="hs-identifier hs-var hs-var">full_laziness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_FullLaziness"><span class="hs-identifier hs-var">Opt_FullLaziness</span></a></span><span>                 </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621681964191"><span class="annot"><span class="annottext">do_specialise :: Bool
</span><a href="#local-6989586621681964191"><span class="hs-identifier hs-var hs-var">do_specialise</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Specialise"><span class="hs-identifier hs-var">Opt_Specialise</span></a></span><span>                   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621681964193"><span class="annot"><span class="annottext">do_float_in :: Bool
</span><a href="#local-6989586621681964193"><span class="hs-identifier hs-var hs-var">do_float_in</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_FloatIn"><span class="hs-identifier hs-var">Opt_FloatIn</span></a></span><span>                      </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621681964195"><span class="annot"><span class="annottext">cse :: Bool
</span><a href="#local-6989586621681964195"><span class="hs-identifier hs-var hs-var">cse</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_CSE"><span class="hs-identifier hs-var">Opt_CSE</span></a></span><span>                          </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621681964197"><span class="annot"><span class="annottext">spec_constr :: Bool
</span><a href="#local-6989586621681964197"><span class="hs-identifier hs-var hs-var">spec_constr</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_SpecConstr"><span class="hs-identifier hs-var">Opt_SpecConstr</span></a></span><span>                   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621681964199"><span class="annot"><span class="annottext">liberate_case :: Bool
</span><a href="#local-6989586621681964199"><span class="hs-identifier hs-var hs-var">liberate_case</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_LiberateCase"><span class="hs-identifier hs-var">Opt_LiberateCase</span></a></span><span>                 </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621681964201"><span class="annot"><span class="annottext">late_dmd_anal :: Bool
</span><a href="#local-6989586621681964201"><span class="hs-identifier hs-var hs-var">late_dmd_anal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_LateDmdAnal"><span class="hs-identifier hs-var">Opt_LateDmdAnal</span></a></span><span>                  </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621681964203"><span class="annot"><span class="annottext">late_specialise :: Bool
</span><a href="#local-6989586621681964203"><span class="hs-identifier hs-var hs-var">late_specialise</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_LateSpecialise"><span class="hs-identifier hs-var">Opt_LateSpecialise</span></a></span><span>             </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621681964205"><span class="annot"><span class="annottext">static_args :: Bool
</span><a href="#local-6989586621681964205"><span class="hs-identifier hs-var hs-var">static_args</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_StaticArgumentTransformation"><span class="hs-identifier hs-var">Opt_StaticArgumentTransformation</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621681964207"><span class="annot"><span class="annottext">rules_on :: Bool
</span><a href="#local-6989586621681964207"><span class="hs-identifier hs-var hs-var">rules_on</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_EnableRewriteRules"><span class="hs-identifier hs-var">Opt_EnableRewriteRules</span></a></span><span>           </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621681964209"><span class="annot"><span class="annottext">ww_on :: Bool
</span><a href="#local-6989586621681964209"><span class="hs-identifier hs-var hs-var">ww_on</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WorkerWrapper"><span class="hs-identifier hs-var">Opt_WorkerWrapper</span></a></span><span>                </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621681964211"><span class="annot"><span class="annottext">static_ptrs :: Bool
</span><a href="#local-6989586621681964211"><span class="hs-identifier hs-var hs-var">static_ptrs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.StaticPointers</span></span><span>           </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621681964214"><span class="annot"><span class="annottext">profiling :: Bool
</span><a href="#local-6989586621681964214"><span class="hs-identifier hs-var hs-var">profiling</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Ways
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Ways -&gt; Way -&gt; Bool
</span><a href="GHC.Platform.Ways.html#hasWay"><span class="hs-operator hs-var">`hasWay`</span></a></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Platform.Ways.html#WayProf"><span class="hs-identifier hs-var">WayProf</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621681964216"><span class="annot"><span class="annottext">do_presimplify :: Bool
</span><a href="#local-6989586621681964216"><span class="hs-identifier hs-var hs-var">do_presimplify</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964191"><span class="hs-identifier hs-var">do_specialise</span></a></span><span> </span><span class="hs-comment">-- TODO: any other optimizations benefit from pre-simplification?</span><span>
</span><span id="line-146"></span><span>    </span><span id="local-6989586621681964217"><span class="annot"><span class="annottext">do_simpl3 :: Bool
</span><a href="#local-6989586621681964217"><span class="hs-identifier hs-var hs-var">do_simpl3</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964180"><span class="hs-identifier hs-var">const_fold</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964207"><span class="hs-identifier hs-var">rules_on</span></a></span><span> </span><span class="hs-comment">-- TODO: any other optimizations benefit from three-phase simplification?</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621681964219"><span class="annot"><span class="annottext">maybe_rule_check :: CompilerPhase -&gt; CoreToDo
</span><a href="#local-6989586621681964219"><span class="hs-identifier hs-var hs-var">maybe_rule_check</span></a></span></span><span> </span><span id="local-6989586621681964220"><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964220"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; (String -&gt; CoreToDo) -&gt; CoreToDo
forall a. Maybe a -&gt; (a -&gt; CoreToDo) -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runMaybe"><span class="hs-identifier hs-var">runMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681964178"><span class="hs-identifier hs-var">rule_check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompilerPhase -&gt; String -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoRuleCheck"><span class="hs-identifier hs-var">CoreDoRuleCheck</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964220"><span class="hs-identifier hs-var">phase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621681964223"><span class="annot"><span class="annottext">maybe_strictness_before :: CompilerPhase -&gt; CoreToDo
</span><a href="#local-6989586621681964223"><span class="hs-identifier hs-var hs-var">maybe_strictness_before</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span id="local-6989586621681964225"><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964225"><span class="hs-identifier hs-var">phase</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964225"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum -&gt; [PhaseNum] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#elem/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [PhaseNum]
</span><a href="GHC.Driver.Session.html#strictnessBefore"><span class="hs-identifier hs-var">strictnessBefore</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoDemand"><span class="hs-identifier hs-var">CoreDoDemand</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="#local-6989586621681964223"><span class="hs-identifier hs-var">maybe_strictness_before</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621681964230"><span class="annot"><span class="annottext">simpl_phase :: CompilerPhase -&gt; String -&gt; PhaseNum -&gt; CoreToDo
</span><a href="#local-6989586621681964230"><span class="hs-identifier hs-var hs-var">simpl_phase</span></a></span></span><span> </span><span id="local-6989586621681964231"><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964231"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span id="local-6989586621681964232"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964232"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681964233"><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964233"><span class="hs-identifier hs-var">iter</span></a></span></span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><span class="annottext">([CoreToDo] -&gt; CoreToDo) -&gt; [CoreToDo] -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>   </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CompilerPhase -&gt; CoreToDo
</span><a href="#local-6989586621681964223"><span class="hs-identifier hs-var">maybe_strictness_before</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964231"><span class="hs-identifier hs-var">phase</span></a></span><span>
</span><span id="line-158"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SimplifyOpts -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSimplify"><span class="hs-identifier hs-var">CoreDoSimplify</span></a></span><span> </span><span class="annot"><span class="annottext">(SimplifyOpts -&gt; CoreToDo) -&gt; SimplifyOpts -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [CoreBndr] -&gt; PhaseNum -&gt; SimplMode -&gt; RuleBase -&gt; SimplifyOpts
</span><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initSimplifyOpts"><span class="hs-identifier hs-var">initSimplifyOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBndr]
</span><a href="#local-6989586621681964171"><span class="hs-identifier hs-var">extra_vars</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964233"><span class="hs-identifier hs-var">iter</span></a></span><span>
</span><span id="line-159"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; CompilerPhase -&gt; String -&gt; SimplMode
</span><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initSimplMode"><span class="hs-identifier hs-var">initSimplMode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964231"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964232"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RuleBase
</span><a href="#local-6989586621681964170"><span class="hs-identifier hs-var">hpt_rule_base</span></a></span><span>
</span><span id="line-160"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompilerPhase -&gt; CoreToDo
</span><a href="#local-6989586621681964219"><span class="hs-identifier hs-var">maybe_rule_check</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964231"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- Run GHC's internal simplification phase, after all rules have run.</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- See Note [Compiler phases] in GHC.Types.Basic</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621681964236"><span class="annot"><span class="annottext">simplify :: String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var hs-var">simplify</span></a></span></span><span> </span><span id="local-6989586621681964237"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964237"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilerPhase -&gt; String -&gt; PhaseNum -&gt; CoreToDo
</span><a href="#local-6989586621681964230"><span class="hs-identifier hs-var">simpl_phase</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="GHC.Types.Basic.html#FinalPhase"><span class="hs-identifier hs-var">FinalPhase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964237"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964176"><span class="hs-identifier hs-var">max_iter</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- initial simplify: mk specialiser happy: minimum effort please</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- See Note [Inline in InitialPhase]</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-comment">-- See Note [RULEs enabled in InitialPhase]</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621681964239"><span class="annot"><span class="annottext">simpl_gently :: CoreToDo
</span><a href="#local-6989586621681964239"><span class="hs-identifier hs-var hs-var">simpl_gently</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplifyOpts -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSimplify"><span class="hs-identifier hs-var">CoreDoSimplify</span></a></span><span> </span><span class="annot"><span class="annottext">(SimplifyOpts -&gt; CoreToDo) -&gt; SimplifyOpts -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [CoreBndr] -&gt; PhaseNum -&gt; SimplMode -&gt; RuleBase -&gt; SimplifyOpts
</span><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initSimplifyOpts"><span class="hs-identifier hs-var">initSimplifyOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBndr]
</span><a href="#local-6989586621681964171"><span class="hs-identifier hs-var">extra_vars</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964176"><span class="hs-identifier hs-var">max_iter</span></a></span><span>
</span><span id="line-170"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SimplMode
</span><a href="GHC.Driver.Config.Core.Opt.Simplify.html#initGentleSimplMode"><span class="hs-identifier hs-var">initGentleSimplMode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RuleBase
</span><a href="#local-6989586621681964170"><span class="hs-identifier hs-var">hpt_rule_base</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621681964240"><span class="annot"><span class="annottext">dmd_cpr_ww :: [CoreToDo]
</span><a href="#local-6989586621681964240"><span class="hs-identifier hs-var hs-var">dmd_cpr_ww</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964209"><span class="hs-identifier hs-var">ww_on</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoDemand"><span class="hs-identifier hs-var">CoreDoDemand</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoCpr"><span class="hs-identifier hs-var">CoreDoCpr</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoWorkerWrapper"><span class="hs-identifier hs-var">CoreDoWorkerWrapper</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-173"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoDemand"><span class="hs-identifier hs-var">CoreDoDemand</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- NB: No CPR! See Note [Don't change boxity without worker/wrapper]</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621681964243"><span class="annot"><span class="annottext">demand_analyser :: CoreToDo
</span><a href="#local-6989586621681964243"><span class="hs-identifier hs-var hs-var">demand_analyser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-177"></span><span>                           </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964240"><span class="hs-identifier hs-var">dmd_cpr_ww</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo] -&gt; [CoreToDo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-178"></span><span>                           </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;post-worker-wrapper&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>                           </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">-- Static forms are moved to the top level with the FloatOut pass.</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- See Note [Grand plan for static forms] in GHC.Iface.Tidy.StaticPtrTable.</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621681964244"><span class="annot"><span class="annottext">static_ptrs_float_outwards :: CoreToDo
</span><a href="#local-6989586621681964244"><span class="hs-identifier hs-var hs-var">static_ptrs_float_outwards</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964211"><span class="hs-identifier hs-var">static_ptrs</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964239"><span class="hs-identifier hs-var">simpl_gently</span></a></span><span> </span><span class="hs-comment">-- Float Out can't handle type lets (sometimes created</span><span>
</span><span id="line-186"></span><span>                       </span><span class="hs-comment">-- by simpleOptPgm via mkParallelBindings)</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FloatOutSwitches -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoFloatOutwards"><span class="hs-identifier hs-var">CoreDoFloatOutwards</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Monad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a></span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">floatOutLambdas :: Maybe PhaseNum
</span><a href="#local-6989586621681964248"><span class="hs-identifier hs-var">floatOutLambdas</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PhaseNum -&gt; Maybe PhaseNum
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><span class="hs-number">0</span></span><span>
</span><span id="line-189"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">floatOutConstants :: Bool
</span><a href="#local-6989586621681964249"><span class="hs-identifier hs-var">floatOutConstants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-190"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">floatOutOverSatApps :: Bool
</span><a href="#local-6989586621681964250"><span class="hs-identifier hs-var">floatOutOverSatApps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-191"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">floatToTopLevelOnly :: Bool
</span><a href="#local-6989586621681964251"><span class="hs-identifier hs-var">floatToTopLevelOnly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621681964252"><span class="annot"><span class="annottext">add_caller_ccs :: CoreToDo
</span><a href="#local-6989586621681964252"><span class="hs-identifier hs-var hs-var">add_caller_ccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964214"><span class="hs-identifier hs-var">profiling</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CallerCcFilter] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.18.3.0/src/Data.Foldable.html#null/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([CallerCcFilter] -&gt; Bool) -&gt; [CallerCcFilter] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [CallerCcFilter]
</span><a href="GHC.Driver.Session.html#callerCcFilters"><span class="hs-identifier hs-var">callerCcFilters</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreAddCallerCcs"><span class="hs-identifier hs-var">CoreAddCallerCcs</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621681964258"><span class="annot"><span class="annottext">add_late_ccs :: CoreToDo
</span><a href="#local-6989586621681964258"><span class="hs-identifier hs-var hs-var">add_late_ccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964214"><span class="hs-identifier hs-var">profiling</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ProfLateInlineCcs"><span class="hs-identifier hs-var">Opt_ProfLateInlineCcs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreAddLateCcs"><span class="hs-identifier hs-var">CoreAddLateCcs</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621681964173"><span class="annot"><span class="annottext">core_todo :: [CoreToDo]
</span><a href="#local-6989586621681964173"><span class="hs-identifier hs-var hs-var">core_todo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>     </span><span class="hs-special">[</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- We want to do the static argument transform before full laziness as it</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- may expose extra opportunities to float things outwards. However, to fix</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- up the output of the transformation we need at do at least one simplify</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- after this before anything else</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964205"><span class="hs-identifier hs-var">static_args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964239"><span class="hs-identifier hs-var">simpl_gently</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoStaticArgs"><span class="hs-identifier hs-var">CoreDoStaticArgs</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-comment">-- initial simplify: mk specialiser happy: minimum effort please</span><span>
</span><span id="line-210"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964216"><span class="hs-identifier hs-var">do_presimplify</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964239"><span class="hs-identifier hs-var">simpl_gently</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>        </span><span class="hs-comment">-- Specialisation is best done before full laziness</span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-comment">-- so that overloaded functions have all their dictionary lambdas manifest</span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964191"><span class="hs-identifier hs-var">do_specialise</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSpecialising"><span class="hs-identifier hs-var">CoreDoSpecialising</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964189"><span class="hs-identifier hs-var">full_laziness</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-217"></span><span>           </span><span class="annot"><span class="annottext">FloatOutSwitches -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoFloatOutwards"><span class="hs-identifier hs-var">CoreDoFloatOutwards</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Monad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-218"></span><span>                                 </span><span class="annot"><span class="annottext">floatOutLambdas :: Maybe PhaseNum
</span><a href="#local-6989586621681964248"><span class="hs-identifier hs-var">floatOutLambdas</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PhaseNum -&gt; Maybe PhaseNum
forall a. a -&gt; Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-219"></span><span>                                 </span><span class="annot"><span class="annottext">floatOutConstants :: Bool
</span><a href="#local-6989586621681964249"><span class="hs-identifier hs-var">floatOutConstants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>                                 </span><span class="annot"><span class="annottext">floatOutOverSatApps :: Bool
</span><a href="#local-6989586621681964250"><span class="hs-identifier hs-var">floatOutOverSatApps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>                                 </span><span class="annot"><span class="annottext">floatToTopLevelOnly :: Bool
</span><a href="#local-6989586621681964251"><span class="hs-identifier hs-var">floatToTopLevelOnly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-222"></span><span>                </span><span class="hs-comment">-- Was: gentleFloatOutSwitches</span><span>
</span><span id="line-223"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span>                </span><span class="hs-comment">-- I have no idea why, but not floating constants to</span><span>
</span><span id="line-225"></span><span>                </span><span class="hs-comment">-- top level is very bad in some cases.</span><span>
</span><span id="line-226"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span>                </span><span class="hs-comment">-- Notably: p_ident in spectral/rewrite</span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-comment">--          Changing from &quot;gentle&quot; to &quot;constantsOnly&quot;</span><span>
</span><span id="line-229"></span><span>                </span><span class="hs-comment">--          improved rewrite's allocation by 19%, and</span><span>
</span><span id="line-230"></span><span>                </span><span class="hs-comment">--          made 0.0% difference to any other nofib</span><span>
</span><span id="line-231"></span><span>                </span><span class="hs-comment">--          benchmark</span><span>
</span><span id="line-232"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-233"></span><span>                </span><span class="hs-comment">-- Not doing floatOutOverSatApps yet, we'll do</span><span>
</span><span id="line-234"></span><span>                </span><span class="hs-comment">-- that later on when we've had a chance to get more</span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-comment">-- accurate arity information.  In fact it makes no</span><span>
</span><span id="line-236"></span><span>                </span><span class="hs-comment">-- difference at all to performance if we do it here,</span><span>
</span><span id="line-237"></span><span>                </span><span class="hs-comment">-- but maybe we save some unnecessary to-and-fro in</span><span>
</span><span id="line-238"></span><span>                </span><span class="hs-comment">-- the simplifier.</span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-240"></span><span>           </span><span class="hs-comment">-- Even with full laziness turned off, we still need to float static</span><span>
</span><span id="line-241"></span><span>           </span><span class="hs-comment">-- forms to the top level. See Note [Grand plan for static forms] in</span><span>
</span><span id="line-242"></span><span>           </span><span class="hs-comment">-- GHC.Iface.Tidy.StaticPtrTable.</span><span>
</span><span id="line-243"></span><span>           </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964244"><span class="hs-identifier hs-var">static_ptrs_float_outwards</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-comment">-- Run the simplifier phases 2,1,0 to allow rewrite rules to fire</span><span>
</span><span id="line-246"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964217"><span class="hs-identifier hs-var">do_simpl3</span></a></span><span>
</span><span id="line-247"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span> </span><span class="annot"><span class="annottext">([CoreToDo] -&gt; CoreToDo) -&gt; [CoreToDo] -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CompilerPhase -&gt; String -&gt; PhaseNum -&gt; CoreToDo
</span><a href="#local-6989586621681964230"><span class="hs-identifier hs-var">simpl_phase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PhaseNum -&gt; CompilerPhase
</span><a href="GHC.Types.Basic.html#Phase"><span class="hs-identifier hs-var">Phase</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964263"><span class="hs-identifier hs-var">phase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964176"><span class="hs-identifier hs-var">max_iter</span></a></span><span>
</span><span id="line-248"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681964263"><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964263"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964174"><span class="hs-identifier hs-var">phases</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964174"><span class="hs-identifier hs-var">phases</span></a></span><span class="annot"><span class="annottext">PhaseNum -&gt; PhaseNum -&gt; PhaseNum
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Num.html#-/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">PhaseNum
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo] -&gt; [CoreToDo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-249"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CompilerPhase -&gt; String -&gt; PhaseNum -&gt; CoreToDo
</span><a href="#local-6989586621681964230"><span class="hs-identifier hs-var">simpl_phase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PhaseNum -&gt; CompilerPhase
</span><a href="GHC.Types.Basic.html#Phase"><span class="hs-identifier hs-var">Phase</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PhaseNum -&gt; PhaseNum -&gt; PhaseNum
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><a href="#local-6989586621681964176"><span class="hs-identifier hs-var">max_iter</span></a></span><span> </span><span class="annot"><span class="annottext">PhaseNum
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-250"></span><span>                </span><span class="hs-comment">-- Phase 0: allow all Ids to be inlined now</span><span>
</span><span id="line-251"></span><span>                </span><span class="hs-comment">-- This gets foldr inlined before strictness analysis</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>                </span><span class="hs-comment">-- At least 3 iterations because otherwise we land up with</span><span>
</span><span id="line-254"></span><span>                </span><span class="hs-comment">-- huge dead expressions because of an infelicity in the</span><span>
</span><span id="line-255"></span><span>                </span><span class="hs-comment">-- simplifier.</span><span>
</span><span id="line-256"></span><span>                </span><span class="hs-comment">--      let k = BIG in foldr k z xs</span><span>
</span><span id="line-257"></span><span>                </span><span class="hs-comment">-- ==&gt;  let k = BIG in letrec go = \xs -&gt; ...(k x).... in go xs</span><span>
</span><span id="line-258"></span><span>                </span><span class="hs-comment">-- ==&gt;  let k = BIG in letrec go = \xs -&gt; ...(BIG x).... in go xs</span><span>
</span><span id="line-259"></span><span>                </span><span class="hs-comment">-- Don't stop now!</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964193"><span class="hs-identifier hs-var">do_float_in</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoFloatInwards"><span class="hs-identifier hs-var">CoreDoFloatInwards</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-comment">-- Run float-inwards immediately before the strictness analyser</span><span>
</span><span id="line-263"></span><span>            </span><span class="hs-comment">-- Doing so pushes bindings nearer their use site and hence makes</span><span>
</span><span id="line-264"></span><span>            </span><span class="hs-comment">-- them more likely to be strict. These bindings might only show</span><span>
</span><span id="line-265"></span><span>            </span><span class="hs-comment">-- up after the inlining from simplification.  Example in fulsom,</span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-comment">-- Csg.calc, where an arg of timesDouble thereby becomes strict.</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964183"><span class="hs-identifier hs-var">call_arity</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoCallArity"><span class="hs-identifier hs-var">CoreDoCallArity</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;post-call-arity&quot;</span></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-comment">-- Strictness analysis</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964187"><span class="hs-identifier hs-var">strictness</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964243"><span class="hs-identifier hs-var">demand_analyser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964185"><span class="hs-identifier hs-var">exitification</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoExitify"><span class="hs-identifier hs-var">CoreDoExitify</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>            </span><span class="hs-comment">-- See Note [Placement of the exitification pass]</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964189"><span class="hs-identifier hs-var">full_laziness</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-280"></span><span>           </span><span class="annot"><span class="annottext">FloatOutSwitches -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoFloatOutwards"><span class="hs-identifier hs-var">CoreDoFloatOutwards</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Opt.Monad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-281"></span><span>                                 </span><span class="annot"><span class="annottext">floatOutLambdas :: Maybe PhaseNum
</span><a href="#local-6989586621681964248"><span class="hs-identifier hs-var">floatOutLambdas</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe PhaseNum
</span><a href="GHC.Driver.Session.html#floatLamArgs"><span class="hs-identifier hs-var">floatLamArgs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964169"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>                                 </span><span class="annot"><span class="annottext">floatOutConstants :: Bool
</span><a href="#local-6989586621681964249"><span class="hs-identifier hs-var">floatOutConstants</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>                                 </span><span class="annot"><span class="annottext">floatOutOverSatApps :: Bool
</span><a href="#local-6989586621681964250"><span class="hs-identifier hs-var">floatOutOverSatApps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>                                 </span><span class="annot"><span class="annottext">floatToTopLevelOnly :: Bool
</span><a href="#local-6989586621681964251"><span class="hs-identifier hs-var">floatToTopLevelOnly</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>                </span><span class="hs-comment">-- nofib/spectral/hartel/wang doubles in speed if you</span><span>
</span><span id="line-286"></span><span>                </span><span class="hs-comment">-- do full laziness late in the day.  It only happens</span><span>
</span><span id="line-287"></span><span>                </span><span class="hs-comment">-- after fusion and other stuff, so the early pass doesn't</span><span>
</span><span id="line-288"></span><span>                </span><span class="hs-comment">-- catch it.  For the record, the redex is</span><span>
</span><span id="line-289"></span><span>                </span><span class="hs-comment">--        f_el22 (f_el21 r_midblock)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964195"><span class="hs-identifier hs-var">cse</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreCSE"><span class="hs-identifier hs-var">CoreCSE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-293"></span><span>                </span><span class="hs-comment">-- We want CSE to follow the final full-laziness pass, because it may</span><span>
</span><span id="line-294"></span><span>                </span><span class="hs-comment">-- succeed in commoning up things floated out by full laziness.</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-comment">-- CSE used to rely on the no-shadowing invariant, but it doesn't any more</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964193"><span class="hs-identifier hs-var">do_float_in</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoFloatInwards"><span class="hs-identifier hs-var">CoreDoFloatInwards</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;final&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- Final tidy-up</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>        </span><span class="annot"><span class="annottext">CompilerPhase -&gt; CoreToDo
</span><a href="#local-6989586621681964219"><span class="hs-identifier hs-var">maybe_rule_check</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="GHC.Types.Basic.html#FinalPhase"><span class="hs-identifier hs-var">FinalPhase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-comment">--------  After this we have -O2 passes -----------------</span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-comment">-- None of them run with -O</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>                </span><span class="hs-comment">-- Case-liberation for -O2.  This should be after</span><span>
</span><span id="line-307"></span><span>                </span><span class="hs-comment">-- strictness analysis and the simplification which follows it.</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964199"><span class="hs-identifier hs-var">liberate_case</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span>
</span><span id="line-309"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreLiberateCase"><span class="hs-identifier hs-var">CoreLiberateCase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;post-liberate-case&quot;</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>           </span><span class="hs-comment">-- Run the simplifier after LiberateCase to vastly</span><span>
</span><span id="line-311"></span><span>           </span><span class="hs-comment">-- reduce the possibility of shadowing</span><span>
</span><span id="line-312"></span><span>           </span><span class="hs-comment">-- Reason: see Note [Shadowing] in GHC.Core.Opt.SpecConstr</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964197"><span class="hs-identifier hs-var">spec_constr</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span>
</span><span id="line-315"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSpecConstr"><span class="hs-identifier hs-var">CoreDoSpecConstr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;post-spec-constr&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>           </span><span class="hs-comment">-- See Note [Simplify after SpecConstr]</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">CompilerPhase -&gt; CoreToDo
</span><a href="#local-6989586621681964219"><span class="hs-identifier hs-var">maybe_rule_check</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="GHC.Types.Basic.html#FinalPhase"><span class="hs-identifier hs-var">FinalPhase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964203"><span class="hs-identifier hs-var">late_specialise</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span>
</span><span id="line-321"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSpecialising"><span class="hs-identifier hs-var">CoreDoSpecialising</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;post-late-spec&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>        </span><span class="hs-comment">-- LiberateCase can yield new CSE opportunities because it peels</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-comment">-- off one layer of a recursive function (concretely, I saw this</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-comment">-- in wheel-sieve1), and I'm guessing that SpecConstr can too</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-comment">-- And CSE is a very cheap pass. So it seems worth doing here.</span><span>
</span><span id="line-327"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964199"><span class="hs-identifier hs-var">liberate_case</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964197"><span class="hs-identifier hs-var">spec_constr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964195"><span class="hs-identifier hs-var">cse</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span>
</span><span id="line-328"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreCSE"><span class="hs-identifier hs-var">CoreCSE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;post-final-cse&quot;</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-comment">---------  End of -O2 passes --------------</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964201"><span class="hs-identifier hs-var">late_dmd_anal</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreToDo -&gt; CoreToDo) -&gt; CoreToDo -&gt; CoreToDo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964240"><span class="hs-identifier hs-var">dmd_cpr_ww</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo] -&gt; [CoreToDo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; CoreToDo
</span><a href="#local-6989586621681964236"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;post-late-ww&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-comment">-- Final run of the demand_analyser, ensures that one-shot thunks are</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-comment">-- really really one-shot thunks. Only needed if the demand analyser</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-comment">-- has run at all. See Note [Final Demand Analyser run] in GHC.Core.Opt.DmdAnal</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-comment">-- It is EXTREMELY IMPORTANT to run this pass, otherwise execution</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-comment">-- can become /exponentially/ more expensive. See #11731, #12996.</span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964187"><span class="hs-identifier hs-var">strictness</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964201"><span class="hs-identifier hs-var">late_dmd_anal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoDemand"><span class="hs-identifier hs-var">CoreDoDemand</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><span class="annottext">CompilerPhase -&gt; CoreToDo
</span><a href="#local-6989586621681964219"><span class="hs-identifier hs-var">maybe_rule_check</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="GHC.Types.Basic.html#FinalPhase"><span class="hs-identifier hs-var">FinalPhase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964252"><span class="hs-identifier hs-var">add_caller_ccs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964258"><span class="hs-identifier hs-var">add_late_ccs</span></a></span><span>
</span><span id="line-347"></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- Remove 'CoreDoNothing' and flatten 'CoreDoPasses' for clarity.</span><span>
</span><span id="line-350"></span><span>    </span><span id="local-6989586621681964172"><span class="annot"><span class="annottext">flatten_todos :: [CoreToDo] -&gt; [CoreToDo]
</span><a href="#local-6989586621681964172"><span class="hs-identifier hs-var hs-var">flatten_todos</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681964272"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964272"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo]
</span><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964272"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-type">CoreDoPasses</span></a></span><span> </span><span id="local-6989586621681964273"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964273"><span class="hs-identifier hs-var">passes</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681964274"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964274"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>      </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo]
</span><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964273"><span class="hs-identifier hs-var">passes</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo] -&gt; [CoreToDo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%2B%2B/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo]
</span><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964274"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681964275"><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964275"><span class="hs-identifier hs-var">todo</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681964276"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964276"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964275"><span class="hs-identifier hs-var">todo</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo -&gt; [CoreToDo] -&gt; [CoreToDo]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; [CoreToDo]
</span><a href="#local-6989586621681964172"><span class="hs-identifier hs-var">flatten_todos</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964276"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="hs-comment">-- The core-to-core pass ordering is derived from the DynFlags:</span><span>
</span><span id="line-357"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-type">runWhen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a></span><span>
</span><span id="line-358"></span><span id="runWhen"><span class="annot"><span class="annottext">runWhen :: Bool -&gt; CoreToDo -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var hs-var">runWhen</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621681964277"><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964277"><span class="hs-identifier hs-var">do_this</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964277"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-359"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span id="local-6989586621681963941"><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#runMaybe"><span class="hs-identifier hs-type">runMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Maybe/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681963941"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681963941"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a></span></span><span>
</span><span id="line-362"></span><span id="runMaybe"><span class="annot"><span class="annottext">runMaybe :: forall a. Maybe a -&gt; (a -&gt; CoreToDo) -&gt; CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.html#runMaybe"><span class="hs-identifier hs-var hs-var">runMaybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Just/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681964278"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681964278"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681964279"><span class="annot"><span class="annottext">a -&gt; CoreToDo
</span><a href="#local-6989586621681964279"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; CoreToDo
</span><a href="#local-6989586621681964279"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681964278"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#runMaybe"><span class="hs-identifier hs-var">runMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base-4.18.3.0/src/GHC.Maybe.html#Nothing/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="annot"><span class="annottext">a -&gt; CoreToDo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-comment">{- Note [Inline in InitialPhase]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In GHC 8 and earlier we did not inline anything in the InitialPhase. But that is
confusing for users because when they say INLINE they expect the function to inline
right away.

So now we do inlining immediately, even in the InitialPhase, assuming that the
Id's Activation allows it.

This is a surprisingly big deal. Compiler performance improved a lot
when I made this change:

   perf/compiler/T5837.run            T5837 [stat too good] (normal)
   perf/compiler/parsing001.run       parsing001 [stat too good] (normal)
   perf/compiler/T12234.run           T12234 [stat too good] (optasm)
   perf/compiler/T9020.run            T9020 [stat too good] (optasm)
   perf/compiler/T3064.run            T3064 [stat too good] (normal)
   perf/compiler/T9961.run            T9961 [stat too good] (normal)
   perf/compiler/T13056.run           T13056 [stat too good] (optasm)
   perf/compiler/T9872d.run           T9872d [stat too good] (normal)
   perf/compiler/T783.run             T783 [stat too good] (normal)
   perf/compiler/T12227.run           T12227 [stat too good] (normal)
   perf/should_run/lazy-bs-alloc.run  lazy-bs-alloc [stat too good] (normal)
   perf/compiler/T1969.run            T1969 [stat too good] (normal)
   perf/compiler/T9872a.run           T9872a [stat too good] (normal)
   perf/compiler/T9872c.run           T9872c [stat too good] (normal)
   perf/compiler/T9872b.run           T9872b [stat too good] (normal)
   perf/compiler/T9872d.run           T9872d [stat too good] (normal)

Note [RULEs enabled in InitialPhase]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
RULES are enabled when doing &quot;gentle&quot; simplification in InitialPhase,
or with -O0.  Two reasons:

  * We really want the class-op cancellation to happen:
        op (df d1 d2) --&gt; $cop3 d1 d2
    because this breaks the mutual recursion between 'op' and 'df'

  * I wanted the RULE
        lift String ===&gt; ...
    to work in Template Haskell when simplifying
    splices, so we get simpler code for literal strings

But watch out: list fusion can prevent floating.  So use phase control
to switch off those rules until after floating.

Note [Simplify after SpecConstr]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We want to run the simplifier after SpecConstr, and before late-Specialise,
for two reasons, both shown up in test perf/compiler/T16473,
with -O2 -flate-specialise

1.  I found that running late-Specialise after SpecConstr, with no
    simplification in between meant that the carefully constructed
    SpecConstr rule never got to fire.  (It was something like
          lvl = f a   -- Arity 1
          ....g lvl....
    SpecConstr specialised g for argument lvl; but Specialise then
    specialised lvl = f a to lvl = $sf, and inlined. Or something like
    that.)

2.  Specialise relies on unfoldings being available for top-level dictionary
    bindings; but SpecConstr kills them all!  The Simplifer restores them.

This extra run of the simplifier has a cost, but this is only with -O2.


************************************************************************
*                                                                      *
                  The CoreToDo interpreter
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#runCorePasses"><span class="hs-identifier hs-type">runCorePasses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Monad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-440"></span><span id="runCorePasses"><span class="annot"><span class="annottext">runCorePasses :: [CoreToDo] -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#runCorePasses"><span class="hs-identifier hs-var hs-var">runCorePasses</span></a></span></span><span> </span><span id="local-6989586621681964280"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964280"><span class="hs-identifier hs-var">passes</span></a></span></span><span> </span><span id="local-6989586621681964281"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964281"><span class="hs-identifier hs-var">guts</span></a></span></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModGuts -&gt; CoreToDo -&gt; CoreM ModGuts)
-&gt; ModGuts -&gt; [CoreToDo] -&gt; CoreM ModGuts
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.18.3.0/src/Control.Monad.html#foldM/Control.Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreToDo -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964283"><span class="hs-identifier hs-var">do_pass</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964281"><span class="hs-identifier hs-var">guts</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964280"><span class="hs-identifier hs-var">passes</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-443"></span><span>    </span><span id="local-6989586621681964283"><span class="annot"><span class="annottext">do_pass :: ModGuts -&gt; CoreToDo -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964283"><span class="hs-identifier hs-var hs-var">do_pass</span></a></span></span><span> </span><span id="local-6989586621681964284"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964284"><span class="hs-identifier hs-var">guts</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
forall a. a -&gt; CoreM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964284"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><a href="#local-6989586621681964283"><span class="hs-identifier hs-var">do_pass</span></a></span><span> </span><span id="local-6989586621681964285"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964285"><span class="hs-identifier hs-var">guts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-type">CoreDoPasses</span></a></span><span> </span><span id="local-6989586621681964286"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964286"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#runCorePasses"><span class="hs-identifier hs-var">runCorePasses</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964286"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964285"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><a href="#local-6989586621681964283"><span class="hs-identifier hs-var">do_pass</span></a></span><span> </span><span id="local-6989586621681964287"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964287"><span class="hs-identifier hs-var">guts</span></a></span></span><span> </span><span id="local-6989586621681964288"><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964288"><span class="hs-identifier hs-var">pass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>      </span><span id="local-6989586621681964289"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964289"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; (ModGuts -&gt; ()) -&gt; CoreM ModGuts -&gt; CoreM ModGuts
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964289"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964288"><span class="hs-identifier hs-var">pass</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681964294"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ModGuts -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreM ModGuts -&gt; CoreM ModGuts) -&gt; CoreM ModGuts -&gt; CoreM ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-449"></span><span>            </span><span id="local-6989586621681964296"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964296"><span class="hs-identifier hs-var">guts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; (ModGuts -&gt; CoreM ModGuts) -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Lint.html#lintAnnots"><span class="hs-identifier hs-var">lintAnnots</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964288"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#doCorePass"><span class="hs-identifier hs-var">doCorePass</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964288"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964287"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-450"></span><span>            </span><span class="annot"><span class="annottext">CoreToDo -&gt; CoreProgram -&gt; [CoreRule] -&gt; CoreM ()
</span><a href="GHC.Driver.Config.Core.Lint.html#endPass"><span class="hs-identifier hs-var">endPass</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964288"><span class="hs-identifier hs-var">pass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964296"><span class="hs-identifier hs-var">guts'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; [CoreRule]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rules"><span class="hs-identifier hs-var">mg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964296"><span class="hs-identifier hs-var">guts'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>            </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
forall a. a -&gt; CoreM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964296"><span class="hs-identifier hs-var">guts'</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>    </span><span id="local-6989586621681964294"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621681964294"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964281"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#doCorePass"><span class="hs-identifier hs-type">doCorePass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Monad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-456"></span><span id="doCorePass"><span class="annot"><span class="annottext">doCorePass :: CoreToDo -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#doCorePass"><span class="hs-identifier hs-var hs-var">doCorePass</span></a></span></span><span> </span><span id="local-6989586621681964300"><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964300"><span class="hs-identifier hs-var">pass</span></a></span></span><span> </span><span id="local-6989586621681964301"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>  </span><span id="local-6989586621681964302"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964302"><span class="hs-identifier hs-var">logger</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span id="local-6989586621681964303"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964303"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM HscEnv
</span><a href="GHC.Core.Opt.Monad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621681964304"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964304"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span id="local-6989586621681964306"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681964306"><span class="hs-identifier hs-var">us</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM UniqSupply
forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span><span>
</span><span id="line-461"></span><span>  </span><span id="local-6989586621681964308"><span class="annot"><span class="annottext">PackageFamInstEnv
</span><a href="#local-6989586621681964308"><span class="hs-identifier hs-var">p_fam_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM PackageFamInstEnv
</span><a href="GHC.Core.Opt.Monad.html#getPackageFamInstEnv"><span class="hs-identifier hs-var">getPackageFamInstEnv</span></a></span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681964310"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681964310"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964304"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681964312"><span class="annot"><span class="annottext">fam_envs :: (PackageFamInstEnv, PackageFamInstEnv)
</span><a href="#local-6989586621681964312"><span class="hs-identifier hs-var hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackageFamInstEnv
</span><a href="#local-6989586621681964308"><span class="hs-identifier hs-var">p_fam_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; PackageFamInstEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_fam_inst_env"><span class="hs-identifier hs-var">mg_fam_inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681964314"><span class="annot"><span class="annottext">updateBinds :: (CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var hs-var">updateBinds</span></a></span></span><span>  </span><span id="local-6989586621681964315"><span class="annot"><span class="annottext">CoreProgram -&gt; CoreProgram
</span><a href="#local-6989586621681964315"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
forall a. a -&gt; CoreM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModGuts -&gt; CoreM ModGuts) -&gt; ModGuts -&gt; CoreM ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681964315"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681964301"><span class="hs-identifier hs-type">guts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681964316"><span class="annot"><span class="annottext">updateBindsM :: (CoreProgram -&gt; CoreM CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964316"><span class="hs-identifier hs-var hs-var">updateBindsM</span></a></span></span><span> </span><span id="local-6989586621681964317"><span class="annot"><span class="annottext">CoreProgram -&gt; CoreM CoreProgram
</span><a href="#local-6989586621681964317"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; CoreM CoreProgram
</span><a href="#local-6989586621681964317"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreM CoreProgram
-&gt; (CoreProgram -&gt; CoreM ModGuts) -&gt; CoreM ModGuts
forall a b. CoreM a -&gt; (a -&gt; CoreM b) -&gt; CoreM b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E%3D/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681964318"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964318"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
forall a. a -&gt; CoreM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModGuts -&gt; CoreM ModGuts) -&gt; ModGuts -&gt; CoreM ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621681964318"><span class="hs-identifier hs-type">b'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681964319"><span class="annot"><span class="annottext">name_ppr_ctx :: NamePprCtx
</span><a href="#local-6989586621681964319"><span class="hs-identifier hs-var hs-var">name_ppr_ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-467"></span><span>        </span><span class="annot"><span class="annottext">PromotionTickContext -&gt; UnitEnv -&gt; GlobalRdrEnv -&gt; NamePprCtx
</span><a href="GHC.Types.Name.Ppr.html#mkNamePprCtx"><span class="hs-identifier hs-var">mkNamePprCtx</span></a></span><span>
</span><span id="line-468"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; PromotionTickContext
</span><a href="GHC.Driver.Session.html#initPromotionTickContext"><span class="hs-identifier hs-var">initPromotionTickContext</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964304"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964303"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; GlobalRdrEnv
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rdr_env"><span class="hs-identifier hs-var">mg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964300"><span class="hs-identifier hs-var">pass</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSimplify"><span class="hs-identifier hs-type">CoreDoSimplify</span></a></span><span> </span><span id="local-6989586621681964320"><span class="annot"><span class="annottext">SimplifyOpts
</span><a href="#local-6989586621681964320"><span class="hs-identifier hs-var">opts</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Simplify&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-474"></span><span>                                 </span><span class="annot"><span class="annottext">IO (SimplCount, ModGuts) -&gt; CoreM ModGuts
forall a. IO (SimplCount, a) -&gt; CoreM a
</span><a href="GHC.Core.Opt.Monad.html#liftIOWithCount"><span class="hs-identifier hs-var">liftIOWithCount</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (SimplCount, ModGuts) -&gt; CoreM ModGuts)
-&gt; IO (SimplCount, ModGuts) -&gt; CoreM ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; UnitEnv
-&gt; NamePprCtx
-&gt; SimplifyOpts
-&gt; ModGuts
-&gt; IO (SimplCount, ModGuts)
</span><a href="GHC.Core.Opt.Simplify.html#simplifyPgm"><span class="hs-identifier hs-var">simplifyPgm</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; UnitEnv
</span><a href="GHC.Driver.Env.Types.html#hsc_unit_env"><span class="hs-identifier hs-var">hsc_unit_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681964303"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamePprCtx
</span><a href="#local-6989586621681964319"><span class="hs-identifier hs-var">name_ppr_ctx</span></a></span><span> </span><span class="annot"><span class="annottext">SimplifyOpts
</span><a href="#local-6989586621681964320"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreCSE"><span class="hs-identifier hs-var">CoreCSE</span></a></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CommonSubExpr&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-477"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var">updateBinds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; CoreProgram
</span><a href="GHC.Core.Opt.CSE.html#cseProgram"><span class="hs-identifier hs-var">cseProgram</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreLiberateCase"><span class="hs-identifier hs-var">CoreLiberateCase</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;LiberateCase&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-480"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var">updateBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LibCaseOpts -&gt; CoreProgram -&gt; CoreProgram
</span><a href="GHC.Core.Opt.LiberateCase.html#liberateCase"><span class="hs-identifier hs-var">liberateCase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; LibCaseOpts
</span><a href="GHC.Driver.Config.Core.Opt.LiberateCase.html#initLiberateCaseOpts"><span class="hs-identifier hs-var">initLiberateCaseOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964304"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoFloatInwards"><span class="hs-identifier hs-var">CoreDoFloatInwards</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;FloatInwards&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-483"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var">updateBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; CoreProgram -&gt; CoreProgram
</span><a href="GHC.Core.Opt.FloatIn.html#floatInwards"><span class="hs-identifier hs-var">floatInwards</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681964310"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoFloatOutwards"><span class="hs-identifier hs-type">CoreDoFloatOutwards</span></a></span><span> </span><span id="local-6989586621681964322"><span class="annot"><span class="annottext">FloatOutSwitches
</span><a href="#local-6989586621681964322"><span class="hs-identifier hs-var">f</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;FloatOutwards&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-486"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreM CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964316"><span class="hs-identifier hs-var">updateBindsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO CoreProgram -&gt; CoreM CoreProgram
forall a. IO a -&gt; CoreM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO CoreProgram -&gt; CoreM CoreProgram)
-&gt; (CoreProgram -&gt; IO CoreProgram)
-&gt; CoreProgram
-&gt; CoreM CoreProgram
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; FloatOutSwitches -&gt; UniqSupply -&gt; CoreProgram -&gt; IO CoreProgram
</span><a href="GHC.Core.Opt.FloatOut.html#floatOutwards"><span class="hs-identifier hs-var">floatOutwards</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">FloatOutSwitches
</span><a href="#local-6989586621681964322"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681964306"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoStaticArgs"><span class="hs-identifier hs-var">CoreDoStaticArgs</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;StaticArgs&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-489"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var">updateBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; CoreProgram -&gt; CoreProgram
</span><a href="GHC.Core.Opt.StaticArgs.html#doStaticArgs"><span class="hs-identifier hs-var">doStaticArgs</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681964306"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoCallArity"><span class="hs-identifier hs-var">CoreDoCallArity</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CallArity&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-492"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var">updateBinds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; CoreProgram
</span><a href="GHC.Core.Opt.CallArity.html#callArityAnalProgram"><span class="hs-identifier hs-var">callArityAnalProgram</span></a></span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoExitify"><span class="hs-identifier hs-var">CoreDoExitify</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Exitify&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-495"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var">updateBinds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; CoreProgram
</span><a href="GHC.Core.Opt.Exitify.html#exitifyProgram"><span class="hs-identifier hs-var">exitifyProgram</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>    </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoDemand"><span class="hs-identifier hs-type">CoreDoDemand</span></a></span><span> </span><span id="local-6989586621681964325"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964325"><span class="hs-identifier hs-var">before_ww</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;DmdAnal&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-498"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreM CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964316"><span class="hs-identifier hs-var">updateBindsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO CoreProgram -&gt; CoreM CoreProgram
forall a. IO a -&gt; CoreM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO CoreProgram -&gt; CoreM CoreProgram)
-&gt; (CoreProgram -&gt; IO CoreProgram)
-&gt; CoreProgram
-&gt; CoreM CoreProgram
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; Bool
-&gt; DynFlags
-&gt; (PackageFamInstEnv, PackageFamInstEnv)
-&gt; [CoreRule]
-&gt; CoreProgram
-&gt; IO CoreProgram
</span><a href="GHC.Core.Opt.Pipeline.html#dmdAnal"><span class="hs-identifier hs-var">dmdAnal</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964325"><span class="hs-identifier hs-var">before_ww</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964304"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(PackageFamInstEnv, PackageFamInstEnv)
</span><a href="#local-6989586621681964312"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; [CoreRule]
</span><a href="GHC.Unit.Module.ModGuts.html#mg_rules"><span class="hs-identifier hs-var">mg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoCpr"><span class="hs-identifier hs-var">CoreDoCpr</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CprAnal&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-501"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreM CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964316"><span class="hs-identifier hs-var">updateBindsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO CoreProgram -&gt; CoreM CoreProgram
forall a. IO a -&gt; CoreM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO CoreProgram -&gt; CoreM CoreProgram)
-&gt; (CoreProgram -&gt; IO CoreProgram)
-&gt; CoreProgram
-&gt; CoreM CoreProgram
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
-&gt; (PackageFamInstEnv, PackageFamInstEnv)
-&gt; CoreProgram
-&gt; IO CoreProgram
</span><a href="GHC.Core.Opt.CprAnal.html#cprAnalProgram"><span class="hs-identifier hs-var">cprAnalProgram</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(PackageFamInstEnv, PackageFamInstEnv)
</span><a href="#local-6989586621681964312"><span class="hs-identifier hs-var">fam_envs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoWorkerWrapper"><span class="hs-identifier hs-var">CoreDoWorkerWrapper</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;WorkWrap&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-504"></span><span>                                 </span><span class="annot"><span class="annottext">(CoreProgram -&gt; CoreProgram) -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964314"><span class="hs-identifier hs-var">updateBinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WwOpts -&gt; UniqSupply -&gt; CoreProgram -&gt; CoreProgram
</span><a href="GHC.Core.Opt.WorkWrap.html#wwTopBinds"><span class="hs-identifier hs-var">wwTopBinds</span></a></span><span>
</span><span id="line-505"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
-&gt; DynFlags -&gt; (PackageFamInstEnv, PackageFamInstEnv) -&gt; WwOpts
</span><a href="GHC.Driver.Config.Core.Opt.WorkWrap.html#initWorkWrapOpts"><span class="hs-identifier hs-var">initWorkWrapOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964304"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(PackageFamInstEnv, PackageFamInstEnv)
</span><a href="#local-6989586621681964312"><span class="hs-identifier hs-var">fam_envs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>                                               </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681964306"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSpecialising"><span class="hs-identifier hs-var">CoreDoSpecialising</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Specialise&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-509"></span><span>                                 </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Specialise.html#specProgram"><span class="hs-identifier hs-var">specProgram</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoSpecConstr"><span class="hs-identifier hs-var">CoreDoSpecConstr</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;SpecConstr&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-512"></span><span>                                 </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.SpecConstr.html#specConstrProgram"><span class="hs-identifier hs-var">specConstrProgram</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreAddCallerCcs"><span class="hs-identifier hs-var">CoreAddCallerCcs</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;AddCallerCcs&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-515"></span><span>                                 </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.CallerCC.html#addCallerCostCentres"><span class="hs-identifier hs-var">addCallerCostCentres</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreAddLateCcs"><span class="hs-identifier hs-var">CoreAddLateCcs</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;AddLateCcs&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-518"></span><span>                                 </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.LateCC.html#addLateCostCentresMG"><span class="hs-identifier hs-var">addLateCostCentresMG</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPrintCore"><span class="hs-identifier hs-var">CoreDoPrintCore</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;PrintCore&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-521"></span><span>                                 </span><span class="annot"><span class="annottext">IO ModGuts -&gt; CoreM ModGuts
forall a. IO a -&gt; CoreM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModGuts -&gt; CoreM ModGuts) -&gt; IO ModGuts -&gt; CoreM ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; CoreProgram -&gt; IO ()
</span><a href="GHC.Core.Opt.Pipeline.html#printCore"><span class="hs-identifier hs-var">printCore</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964302"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ModGuts -&gt; IO ModGuts
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%3E%3E/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; IO ModGuts
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoRuleCheck"><span class="hs-identifier hs-type">CoreDoRuleCheck</span></a></span><span> </span><span id="local-6989586621681964329"><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964329"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span id="local-6989586621681964330"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964330"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;RuleCheck&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-524"></span><span>                                 </span><span class="annot"><span class="annottext">CompilerPhase -&gt; String -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#ruleCheckPass"><span class="hs-identifier hs-var">ruleCheckPass</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964329"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964330"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
forall a. a -&gt; CoreM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPasses"><span class="hs-identifier hs-type">CoreDoPasses</span></a></span><span> </span><span id="local-6989586621681964332"><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964332"><span class="hs-identifier hs-var">passes</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreToDo] -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#runCorePasses"><span class="hs-identifier hs-var">runCorePasses</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreToDo]
</span><a href="#local-6989586621681964332"><span class="hs-identifier hs-var">passes</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span>    </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDoPluginPass"><span class="hs-identifier hs-type">CoreDoPluginPass</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681964334"><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964334"><span class="hs-identifier hs-var">p</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Plugin&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
</span><a href="#local-6989586621681964334"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964301"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDesugar"><span class="hs-identifier hs-var">CoreDesugar</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CoreM ModGuts
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doCorePass&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964300"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreDesugarOpt"><span class="hs-identifier hs-var">CoreDesugarOpt</span></a></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CoreM ModGuts
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doCorePass&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964300"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CoreTidy"><span class="hs-identifier hs-var">CoreTidy</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CoreM ModGuts
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doCorePass&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964300"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="GHC.Core.Opt.Pipeline.Types.html#CorePrep"><span class="hs-identifier hs-var">CorePrep</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; CoreM ModGuts
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;doCorePass&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreToDo -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreToDo
</span><a href="#local-6989586621681964300"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Core pass combinators}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#printCore"><span class="hs-identifier hs-type">printCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span id="printCore"><span class="annot"><span class="annottext">printCore :: Logger -&gt; CoreProgram -&gt; IO ()
</span><a href="GHC.Core.Opt.Pipeline.html#printCore"><span class="hs-identifier hs-var hs-var">printCore</span></a></span></span><span> </span><span id="local-6989586621681964340"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964340"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681964341"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964341"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Logger -&gt; String -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#logDumpMsg"><span class="hs-identifier hs-var">Logger.logDumpMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964340"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Print Core&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreProgram -&gt; SDoc
forall b. OutputableBndr b =&gt; [Bind b] -&gt; SDoc
</span><a href="GHC.Core.Ppr.html#pprCoreBindings"><span class="hs-identifier hs-var">pprCoreBindings</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964341"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#ruleCheckPass"><span class="hs-identifier hs-type">ruleCheckPass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.18.3.0/src/GHC.Base.html#String/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Monad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.ModGuts.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-548"></span><span id="ruleCheckPass"><span class="annot"><span class="annottext">ruleCheckPass :: CompilerPhase -&gt; String -&gt; ModGuts -&gt; CoreM ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#ruleCheckPass"><span class="hs-identifier hs-var hs-var">ruleCheckPass</span></a></span></span><span> </span><span id="local-6989586621681964343"><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964343"><span class="hs-identifier hs-var">current_phase</span></a></span></span><span> </span><span id="local-6989586621681964344"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964344"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681964345"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964345"><span class="hs-identifier hs-var">guts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>    </span><span id="local-6989586621681964346"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964346"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621681964347"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964347"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreM Logger
forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><span class="annottext">Logger -&gt; SDoc -&gt; (ModGuts -&gt; ()) -&gt; CoreM ModGuts -&gt; CoreM ModGuts
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
Logger -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964347"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RuleCheck&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; SDoc) -&gt; Module -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; Module
</span><a href="GHC.Unit.Module.ModGuts.html#mg_module"><span class="hs-identifier hs-var">mg_module</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964345"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ModGuts -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#const/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreM ModGuts -&gt; CoreM ModGuts) -&gt; CoreM ModGuts -&gt; CoreM ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span>        </span><span id="local-6989586621681964349"><span class="annot"><span class="annottext">RuleEnv
</span><a href="#local-6989586621681964349"><span class="hs-identifier hs-var">rule_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM RuleEnv
</span><a href="GHC.Core.Opt.Monad.html#initRuleEnv"><span class="hs-identifier hs-var">initRuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964345"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-554"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681964351"><span class="annot"><span class="annottext">rule_fn :: CoreBndr -&gt; [CoreRule]
</span><a href="#local-6989586621681964351"><span class="hs-identifier hs-var hs-var">rule_fn</span></a></span></span><span> </span><span id="local-6989586621681964352"><span class="annot"><span class="annottext">CoreBndr
</span><a href="#local-6989586621681964352"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleEnv -&gt; CoreBndr -&gt; [CoreRule]
</span><a href="GHC.Core.Rules.html#getRules"><span class="hs-identifier hs-var">getRules</span></a></span><span> </span><span class="annot"><span class="annottext">RuleEnv
</span><a href="#local-6989586621681964349"><span class="hs-identifier hs-var">rule_env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBndr
</span><a href="#local-6989586621681964352"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-555"></span><span>            </span><span id="local-6989586621681964353"><span class="annot"><span class="annottext">ropts :: RuleOpts
</span><a href="#local-6989586621681964353"><span class="hs-identifier hs-var hs-var">ropts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; RuleOpts
</span><a href="GHC.Driver.Config.Core.Rules.html#initRuleOpts"><span class="hs-identifier hs-var">initRuleOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964346"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-556"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; CoreM ()
forall a. IO a -&gt; CoreM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.18.3.0/src/Control.Monad.IO.Class.html#liftIO/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CoreM ()) -&gt; IO () -&gt; CoreM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Logger -&gt; String -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#logDumpMsg"><span class="hs-identifier hs-var">logDumpMsg</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964347"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Rule check&quot;</span></span><span>
</span><span id="line-557"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RuleOpts
-&gt; CompilerPhase
-&gt; String
-&gt; (CoreBndr -&gt; [CoreRule])
-&gt; CoreProgram
-&gt; SDoc
</span><a href="GHC.Core.Rules.html#ruleCheckProgram"><span class="hs-identifier hs-var">ruleCheckProgram</span></a></span><span> </span><span class="annot"><span class="annottext">RuleOpts
</span><a href="#local-6989586621681964353"><span class="hs-identifier hs-var">ropts</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerPhase
</span><a href="#local-6989586621681964343"><span class="hs-identifier hs-var">current_phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681964344"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-558"></span><span>                        </span><span class="annot"><span class="annottext">CoreBndr -&gt; [CoreRule]
</span><a href="#local-6989586621681964351"><span class="hs-identifier hs-var">rule_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; CoreProgram
</span><a href="GHC.Unit.Module.ModGuts.html#mg_binds"><span class="hs-identifier hs-var">mg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964345"><span class="hs-identifier hs-var">guts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>        </span><span class="annot"><span class="annottext">ModGuts -&gt; CoreM ModGuts
forall a. a -&gt; CoreM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681964345"><span class="hs-identifier hs-var">guts</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html#dmdAnal"><span class="hs-identifier hs-type">dmdAnal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#Logger"><span class="hs-identifier hs-type">Logger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-562"></span><span id="dmdAnal"><span class="annot"><span class="annottext">dmdAnal :: Logger
-&gt; Bool
-&gt; DynFlags
-&gt; (PackageFamInstEnv, PackageFamInstEnv)
-&gt; [CoreRule]
-&gt; CoreProgram
-&gt; IO CoreProgram
</span><a href="GHC.Core.Opt.Pipeline.html#dmdAnal"><span class="hs-identifier hs-var hs-var">dmdAnal</span></a></span></span><span> </span><span id="local-6989586621681964355"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964355"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681964356"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964356"><span class="hs-identifier hs-var">before_ww</span></a></span></span><span> </span><span id="local-6989586621681964357"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964357"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681964358"><span class="annot"><span class="annottext">(PackageFamInstEnv, PackageFamInstEnv)
</span><a href="#local-6989586621681964358"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span id="local-6989586621681964359"><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621681964359"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span id="local-6989586621681964360"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964360"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681964361"><span class="annot"><span class="annottext">opts :: DmdAnalOpts
</span><a href="#local-6989586621681964361"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.Opt.DmdAnal.html#DmdAnalOpts"><span class="hs-identifier hs-type">DmdAnalOpts</span></a></span><span>
</span><span id="line-564"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dmd_strict_dicts :: Bool
</span><a href="GHC.Core.Opt.DmdAnal.html#dmd_strict_dicts"><span class="hs-identifier hs-var">dmd_strict_dicts</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_DictsStrict"><span class="hs-identifier hs-var">Opt_DictsStrict</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964357"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-565"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dmd_do_boxity :: Bool
</span><a href="GHC.Core.Opt.DmdAnal.html#dmd_do_boxity"><span class="hs-identifier hs-var">dmd_do_boxity</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681964356"><span class="hs-identifier hs-var">before_ww</span></a></span><span> </span><span class="hs-comment">-- only run Boxity Analysis immediately preceding WW</span><span>
</span><span id="line-566"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dmd_unbox_width :: PhaseNum
</span><a href="GHC.Core.Opt.DmdAnal.html#dmd_unbox_width"><span class="hs-identifier hs-var">dmd_unbox_width</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PhaseNum
</span><a href="GHC.Driver.Session.html#dmdUnboxWidth"><span class="hs-identifier hs-var">dmdUnboxWidth</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964357"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-567"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dmd_max_worker_args :: PhaseNum
</span><a href="GHC.Core.Opt.DmdAnal.html#dmd_max_worker_args"><span class="hs-identifier hs-var">dmd_max_worker_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PhaseNum
</span><a href="GHC.Driver.Session.html#maxWorkerArgs"><span class="hs-identifier hs-var">maxWorkerArgs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964357"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-568"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-569"></span><span>      </span><span id="local-6989586621681964370"><span class="annot"><span class="annottext">binds_plus_dmds :: CoreProgram
</span><a href="#local-6989586621681964370"><span class="hs-identifier hs-var hs-var">binds_plus_dmds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdAnalOpts
-&gt; (PackageFamInstEnv, PackageFamInstEnv)
-&gt; [CoreRule]
-&gt; CoreProgram
-&gt; CoreProgram
</span><a href="GHC.Core.Opt.DmdAnal.html#dmdAnalProgram"><span class="hs-identifier hs-var">dmdAnalProgram</span></a></span><span> </span><span class="annot"><span class="annottext">DmdAnalOpts
</span><a href="#local-6989586621681964361"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">(PackageFamInstEnv, PackageFamInstEnv)
</span><a href="#local-6989586621681964358"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreRule]
</span><a href="#local-6989586621681964359"><span class="hs-identifier hs-var">rules</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964360"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><span class="annottext">Logger -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Logger.html#putDumpFileMaybe"><span class="hs-identifier hs-var">Logger.putDumpFileMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681964355"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_str_signatures"><span class="hs-identifier hs-var">Opt_D_dump_str_signatures</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Strictness signatures&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#%24/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; (IdInfo -&gt; SDoc) -&gt; CoreProgram -&gt; SDoc
</span><a href="GHC.Core.Utils.html#dumpIdInfoOfProgram"><span class="hs-identifier hs-var">dumpIdInfoOfProgram</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#hasPprDebug"><span class="hs-identifier hs-var">hasPprDebug</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681964357"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdSig -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdSig -&gt; SDoc) -&gt; (IdInfo -&gt; DmdSig) -&gt; IdInfo -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DmdSig -&gt; DmdSig
</span><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier hs-var">zapDmdEnvSig</span></a></span><span> </span><span class="annot"><span class="annottext">(DmdSig -&gt; DmdSig) -&gt; (IdInfo -&gt; DmdSig) -&gt; IdInfo -&gt; DmdSig
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#./GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IdInfo -&gt; DmdSig
</span><a href="GHC.Types.Id.Info.html#dmdSigInfo"><span class="hs-identifier hs-var">dmdSigInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964370"><span class="hs-identifier hs-var">binds_plus_dmds</span></a></span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-comment">-- See Note [Stamp out space leaks in demand analysis] in GHC.Core.Opt.DmdAnal</span><span>
</span><span id="line-573"></span><span>  </span><span class="annot"><span class="annottext">CoreProgram -&gt; ()
</span><a href="GHC.Core.Seq.html#seqBinds"><span class="hs-identifier hs-var">seqBinds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964370"><span class="hs-identifier hs-var">binds_plus_dmds</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO CoreProgram -&gt; IO CoreProgram
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; IO CoreProgram
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.18.3.0/src/GHC.Base.html#return/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681964370"><span class="hs-identifier hs-var">binds_plus_dmds</span></a></span><span>
</span><span id="line-574"></span></pre></body></html>